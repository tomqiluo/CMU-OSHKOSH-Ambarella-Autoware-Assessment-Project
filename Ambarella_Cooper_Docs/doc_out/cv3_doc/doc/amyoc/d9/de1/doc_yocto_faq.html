<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Build System: Yocto FAQ</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Build System"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Build System<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/de1/doc_yocto_faq.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Yocto FAQ </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="yocto_faq1"></a>
Question 1: What are the Yocto official documents to learn?</h1>
<p ><b>Answer:</b> As shown below:<br  />
 ★★★: Three-star documents are suggested to be mastered well<br  />
 ★★☆: Two-star documents can be mastered basically<br  />
 ★☆☆: One-star documents can be used as reference<br  />
</p>
<ul>
<li>Getting Started Knowledge:<ul>
<li>Yocto Project Quick Build ★★★ <a href="https://docs.yoctoproject.org/brief-yoctoprojectqs/index.html">https://docs.yoctoproject.org/brief-yoctoprojectqs/index.html</a></li>
<li>Usage Advice ★★☆ <a href="https://docs.yoctoproject.org/what-i-wish-id-known.html">https://docs.yoctoproject.org/what-i-wish-id-known.html</a></li>
<li>Introducing the Yocto Project ★★☆ <a href="https://docs.yoctoproject.org/overview-manual/yp-intro.html">https://docs.yoctoproject.org/overview-manual/yp-intro.html</a></li>
<li>Yocto Project Concepts ★★★ <a href="https://docs.yoctoproject.org/overview-manual/concepts.html">https://docs.yoctoproject.org/overview-manual/concepts.html</a></li>
</ul>
</li>
<li>Reference Manual (<a href="https://docs.yoctoproject.org/ref-manual/index.html">https://docs.yoctoproject.org/ref-manual/index.html</a>)<ul>
<li>Source Directory Structure ★★★ <a href="https://docs.yoctoproject.org/ref-manual/structure.html">https://docs.yoctoproject.org/ref-manual/structure.html</a></li>
<li>Classes ★☆☆ <a href="https://docs.yoctoproject.org/ref-manual/classes.html">https://docs.yoctoproject.org/ref-manual/classes.html</a><ul>
<li>QA check, insane.bbclass ★★☆ <a href="https://docs.yoctoproject.org/ref-manual/classes.html#insane-bbclass">https://docs.yoctoproject.org/ref-manual/classes.html#insane-bbclass</a></li>
</ul>
</li>
<li>Tasks ★★★ <a href="https://docs.yoctoproject.org/ref-manual/tasks.html">https://docs.yoctoproject.org/ref-manual/tasks.html</a></li>
<li>Devtool Quick Reference ★☆☆ <a href="https://docs.yoctoproject.org/ref-manual/devtool-reference.html">https://docs.yoctoproject.org/ref-manual/devtool-reference.html</a></li>
<li>QA Error and Warning Messages ★★☆ <a href="https://docs.yoctoproject.org/ref-manual/qa-checks.html">https://docs.yoctoproject.org/ref-manual/qa-checks.html</a></li>
<li>Variables Glossary ★☆☆ <a href="https://docs.yoctoproject.org/ref-manual/variables.html">https://docs.yoctoproject.org/ref-manual/variables.html</a></li>
</ul>
</li>
<li>Development Manual:<ul>
<li>Board support packages (BSP) — Developer’s Guide ★★☆ <a href="https://docs.yoctoproject.org/bsp-guide/bsp.html">https://docs.yoctoproject.org/bsp-guide/bsp.html</a></li>
<li>Yocto Project Linux Kernel Development Manual ★★☆ <a href="https://docs.yoctoproject.org/kernel-dev/index.html">https://docs.yoctoproject.org/kernel-dev/index.html</a></li>
<li>Common Tasks ★★☆ <a href="https://docs.yoctoproject.org/dev-manual/common-tasks.html">https://docs.yoctoproject.org/dev-manual/common-tasks.html</a><ul>
<li>Understanding and Creating Layers ★★★ <a href="https://docs.yoctoproject.org/dev-manual/common-tasks.html#understanding-and-creating-layers">https://docs.yoctoproject.org/dev-manual/common-tasks.html#understanding-and-creating-layers</a></li>
<li>Customizing Images ★★★ <a href="https://docs.yoctoproject.org/dev-manual/common-tasks.html#customizing-images">https://docs.yoctoproject.org/dev-manual/common-tasks.html#customizing-images</a></li>
<li>Writing a New Recipe ★★★ <a href="https://docs.yoctoproject.org/dev-manual/common-tasks.html#writing-a-new-recipe">https://docs.yoctoproject.org/dev-manual/common-tasks.html#writing-a-new-recipe</a></li>
<li>Adding a New Machine ★★★ <a href="https://docs.yoctoproject.org/dev-manual/common-tasks.html#adding-a-new-machine">https://docs.yoctoproject.org/dev-manual/common-tasks.html#adding-a-new-machine</a></li>
<li>Understanding package ★★★ <a href="https://docs.yoctoproject.org/dev-manual/common-tasks.html#working-with-pre-built-libraries">https://docs.yoctoproject.org/dev-manual/common-tasks.html#working-with-pre-built-libraries</a></li>
</ul>
</li>
</ul>
</li>
<li>BitBake User Manual (<a href="https://docs.yoctoproject.org/bitbake/2.0/index.html">https://docs.yoctoproject.org/bitbake/2.0/index.html</a>)<ul>
<li>Overview ★★☆ <a href="https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-intro.html">https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-intro.html</a></li>
<li>Execution ★☆☆ <a href="https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-execution.html">https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-execution.html</a></li>
<li>Syntax and Operators ★★★ <a href="https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-metadata.html">https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-metadata.html</a></li>
<li>File Download Support ★☆☆ <a href="https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-fetching.html">https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-fetching.html</a></li>
<li>Variables Glossary ★☆☆ <a href="https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-ref-variables.html">https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-ref-variables.html</a></li>
</ul>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="yocto_faq2"></a>
Question 2: Which is better: Yocto or Buildroot?</h1>
<p ><b>Answer:</b> There is no clear answer which is better, but one may be better or worse for use cases for embedded systems.</p>
<ul>
<li><code>Yocto</code>: Yocto is more suitable for larger projects because it is widely used and is actively supported by the community with more tools, features, and open source software (OSS) packages available.<ul>
<li><b>Pros:</b><ul>
<li>Yocto is widely used with many semiconductors. This makes it more compatible with a wider number of embedded device boards.</li>
<li>It is widely and actively supported by the community, and has more tools, features, and OSS packages available.</li>
<li>Based on its implementation of layers, it is much easier for users to integrate their own layers of software packages into the Yocto software development kit (SDK) provided by the system on chip (SoC) or board vendors.</li>
</ul>
</li>
<li><b>Cons:</b><ul>
<li>The learning curve is relatively steep when getting started.</li>
<li>The build time is quite long with super huge temporary files.</li>
</ul>
</li>
</ul>
</li>
<li><code>Buildroot</code>: Buildroot is more practical for smaller projects because it is built to be simple and quick to deploy, especially when compared to Yocto, whose learning curve is relatively steep when getting started.<ul>
<li><b>Pros:</b><ul>
<li>Buildroot is built to be easy. Its core build system is written in Make and is small enough for users to understand quickly.</li>
<li>The build time is significantly shorter than that of Yocto build.</li>
</ul>
</li>
<li><b>Cons:</b><ul>
<li>Buildroot has less popularity than Yocto, which means that it is maintained and supported by a smaller community with a less-active ecosystem.</li>
<li>There is a lack of incremental builds. When users want to make an update, even a small change, users must rebuild the entire image.</li>
<li>Buildroot focuses on simplicity, which means that it is much harder to customize.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p >Users can refer to this link for more comments about the pros and cons of Yocto and Buildroot: <a href="https://www.incredibuild.com/blog/yocto-or-buildroot-which-to-use-when-building-your-custom-embedded-systems">https://www.incredibuild.com/blog/yocto-or-buildroot-which-to-use-when-building-your-custom-embedded-systems</a></p>
<hr  />
<h1><a class="anchor" id="yocto_faq3"></a>
Question 3: Can customers download and use Poky from the Yocto community?</h1>
<p ><b>Answer:</b> Yes. Customers can download and use Poky directly from the Yocto community. Ambarella suggests using 4.0 (Kirstone) or a higher version. For Poky included in the Cooper SDK base package, it will be upgraded to Kirstone 4.0.5.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq4"></a>
Question 4: Can customers download and use the Linux kernel from the community?</h1>
<p ><b>Answer:</b> Yes, but Ambarella suggests using the same kernel version as the SDK. In the formal Cooper SDK, Ambarella provides the kernel package in the format of linux-5.15.tar.bz2 (for example, kernel 5.15.76 in the Cooper SDK base package) + linux-5.15-ambarella.patch. With linux-5.15-ambarella.patch, customers can download pure Linux from the community and then apply this patch.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq5"></a>
Question 5: How does the Cooper SDK Yocto build manage the OSS supported by Yocto Poky?</h1>
<p ><b>Answer:</b> For Yocto build, all OSS (including BusyBox) use the ones supported by Poky from the community. Ambarella only keeps the prebuild ones that are now NOT supported by Poky. For Amba build, it will keep using prebuild OSS libs.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq6"></a>
Question 6: What is the main difference between Yocto compilation and regular compilation?</h1>
<p ><b>Answer:</b> Regular compilation uses the host build environment; Yocto compiles each package with its own output directory WORKDIR (<a href="https://docs.yoctoproject.org/ref-manual/variables.html#term-WORKDIR">https://docs.yoctoproject.org/ref-manual/variables.html#term-WORKDIR</a>), and configures the compilation environment in the output directory.</p>
<ul>
<li><code>${WORKDIR}/build</code>: compiled output directory (only for source code and compiled output separately)</li>
<li><code>${WORKDIR}/recipe-sysroot</code>: system dependencies root folder</li>
<li><code>${WORKDIR}/recipe-sysroot-native</code>: build host software tool root folder</li>
<li><code>${WORKDIR}/image</code>: installation root directory</li>
<li><code>${WORKDIR}/temp</code>: directory for storing compiled logs and scripts</li>
</ul>
<p >Yocto copies the required host tools and dependent files to its own working directory and creates a clean shell environment to run tasks.</p>
<p >Yocto manages the relationships between packages according to certain rules.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq7"></a>
Question 7: How does Yocto export environment variables?</h1>
<p ><b>Answer:</b> Yocto cannot use the environment variables exported in the shell. The environment variables in Yocto are defined in <code>conf/local.conf</code> in the output directory and are exported one by one in the recipe file via <b>export &lt;varname&gt;</b>.</p>
<p >Users can check which variables are exported in the <code>${WORKDIR}/temp/run.do_compile</code> file.</p>
<p >For more details about exporting variables to the environment, refer to the page (<a href="https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html?highlight=nostamp#exporting-variables-to-the-environment">https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html?highlight=nostamp#exporting-variables-to-the-environment</a>)</p>
<hr  />
<h1><a class="anchor" id="yocto_faq8"></a>
Question 8: What are the common Yocto commands?</h1>
<p ><b>Answer:</b> The main commands are as follows:</p>
<ul>
<li>bitbake command (<a href="https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-intro.html#the-bitbake-command">https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-intro.html#the-bitbake-command</a>)<ul>
<li>bitbake packagename: build packagename</li>
<li>bitbake -c taskname packagename: execute the "taskname" task of packagename</li>
<li>bitbake -e packagename: display the generated task environment script</li>
</ul>
</li>
<li>recipetool command (<a href="https://docs.yoctoproject.org/dev-manual/common-tasks.html#locate-or-automatically-create-a-base-recipe">https://docs.yoctoproject.org/dev-manual/common-tasks.html#locate-or-automatically-create-a-base-recipe</a>)<ul>
<li>recipetool create -o xxx.bb src_path: generate a recipe based on source code</li>
</ul>
</li>
<li>bitbake-layers command (<a href="https://docs.yoctoproject.org/bsp-guide/bsp.html?highlight=bitbake+layers#creating-a-new-bsp-layer-using-the-bitbake-layers-script">https://docs.yoctoproject.org/bsp-guide/bsp.html?highlight=bitbake+layers#creating-a-new-bsp-layer-using-the-bitbake-layers-script</a>)<ul>
<li>bitbake-layers create-layer xxx &amp;&amp; mv xxx meta-xxx: create a new general layer</li>
<li>bitbake-layers add-layer meta-xxx: add a layer to the current configuration</li>
</ul>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="yocto_faq9"></a>
Question 9: Which configuration files should users pay attention to in Yocto build?</h1>
<p ><b>Answer:</b> The main configuration files are as follows:</p>
<ul>
<li><code>TOPDIR</code>: points to the build directory. BitBake automatically sets this variable. <a href="https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-ref-variables.html#term-TOPDIR">https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-ref-variables.html#term-TOPDIR</a></li>
<li><code>poky/meta/conf/bitbake.conf</code>: default configuration file; most variables are defined here. <a href="https://docs.yoctoproject.org/ref-manual/structure.html?highlight=bitbake+conf#meta-conf">https://docs.yoctoproject.org/ref-manual/structure.html?highlight=bitbake+conf#meta-conf</a></li>
<li><code>${TOPDIR}/conf/local.conf</code>: this configuration file contains all local user configurations for the build environment. Any variable set here overrides any variable set elsewhere within the environment <a href="https://docs.yoctoproject.org/ref-manual/structure.html?highlight=local+conf#build-conf-local-conf">https://docs.yoctoproject.org/ref-manual/structure.html?highlight=local+conf#build-conf-local-conf</a></li>
<li><code>${TOPDIR}/conf/bblayers.conf</code>: the configuration of the layers in the current configuration can be found in this file. <a href="https://docs.yoctoproject.org/ref-manual/structure.html?highlight=local+conf#build-conf-bblayers-conf">https://docs.yoctoproject.org/ref-manual/structure.html?highlight=local+conf#build-conf-bblayers-conf</a></li>
<li><code>meta-xxx/conf/layer.conf</code>: this configuration file primarily configures how the build system finds the recipe file configurations. <a href="https://docs.yoctoproject.org/dev-manual/common-tasks.html?highlight=layer+conf#creating-your-own-layer">https://docs.yoctoproject.org/dev-manual/common-tasks.html?highlight=layer+conf#creating-your-own-layer</a></li>
<li><code>meta-xxx/conf/machine/xxx.conf</code>: machine configuration. The layer with the machine configuration is the BSP layer. Meanwhile, each BSP layer requires at least one machine file. <a href="https://docs.yoctoproject.org/bsp-guide/bsp.html?highlight=machine+conf#hardware-configuration-options">https://docs.yoctoproject.org/bsp-guide/bsp.html?highlight=machine+conf#hardware-configuration-options</a></li>
</ul>
<hr  />
<h1><a class="anchor" id="yocto_faq10"></a>
Question 10: How are variables used in Yocto?</h1>
<p ><b>Answer:</b> For more information, refer to the basic syntax page (<a href="https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#basic-syntax">https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#basic-syntax</a>) and the conditional syntax page (<a href="https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#conditional-syntax-overrides">https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#conditional-syntax-overrides</a>).</p>
<ul>
<li>To get the value of a variable, users should use braces <b>${var}</b></li>
<li>Unlike in Bourne shells, single quotes function identically to double quotes in all other ways. They do not suppress variable expansions</li>
<li>The operators that define or modify variables are as shown below:<ul>
<li><b>assign</b>: = := ? = ?? =<ul>
<li><b>= ?= ??=</b> : when a variable exists as the value left of the equal sign, the variable to the right of the equal sign is the last extension (the final value of the variable)</li>
<li><b>:= :</b> the variable to the left of the equal sign is the immediate extension (the value of the variable at the current position)</li>
<li><b>?=</b> : sets the default value (assign value only when the variable is empty)</li>
<li><b>??=</b> : sets weak defaults (parse the statement at the end of the parsing process. When the variable is not defined, the value is retained; and the last is valid when multiple "??=" exist)</li>
</ul>
</li>
<li><b>Append</b> : += =+ .= =. :append :prepend; <b>Delete</b> : :remove<ul>
<li><b>+= .= :append</b> post-append (the new value is placed after the original value) <b>=+ =. :prepend</b> preappend (the new value is placed before the original value)</li>
<li><b>+= =+</b> automatically adds a space between the new value and the original value <b>.= =. :append :prepend</b> does not add a space between the new value and the original value; users must add it manually</li>
<li><b>+= =+ .= =.</b> immediately parses (append immediately when parsing the current statement) <b>:append :prepend</b> final parsing (append when parsing the statement after the parsing process is finished)</li>
<li><b>:remove</b> removes all existing values (multiple values separated by spaces) that are the same as the set value</li>
</ul>
</li>
<li><b>Conditions</b>: OVERRIDES<ul>
<li>The condition declaration uses the <b>OVERRIDES</b> keyword; only lowercase characters, numbers, and underscores can be used for condition names; multiple conditions are separated by colons<ul>
<li>OVERRIDES = "cond1:cond2"</li>
<li>OVERRIDES:append = ":cond3"</li>
</ul>
</li>
<li>Defines or modifies the corresponding variable only when the condition is defined; for example, var:cond1:append = "xxx"</li>
</ul>
</li>
</ul>
</li>
<li>Unset variable: unset</li>
<li>Define flag: var[flag_name]; users can use the brackets var[flag_name] to define the flag of a variable<ul>
<li>Defining a new variable's flag can be interpreted as creating a new variable. It is similar to treating a variable as an array, with the variable name corresponding to the array name and the flag corresponding to the index subscript of the array</li>
<li>Task variables have some public flags. <a href="https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#variable-flags">https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#variable-flags</a></li>
<li>The operators that define or modify a variable and unset can be used in the variable's flag</li>
</ul>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="yocto_faq11"></a>
Question 11: How can shared files be included in Yocto?</h1>
<p ><b>Answer:</b> The four ways to include shared files in Yocto are as shown below: <a href="https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#sharing-functionality">https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#sharing-functionality</a></p>
<ul>
<li>Inherited classes: <b>inherit &lt;class_name&gt;</b> and <b>INHERIT += &lt;class_name&gt;</b><ul>
<li>Only inherit class files (<code>*.bbclass</code>)</li>
<li>Inherit can only be used in recipe and class files (<code>*.bb</code> / <code>*.bbappend</code> / <code>*.bbclass</code>), <b>INHERIT</b> can only be used in configuration files (<code>*.conf</code>)</li>
<li>Class files can be retrieved not only in the current layer directory, but also in other layer directories defined by BBLAYER variables in the <code>conf/bblayers.conf</code> file BBLAYER variables: <a href="https://docs.yoctoproject.org/ref-manual/variables.html?highlight=bblayers#term-BBLAYERS">https://docs.yoctoproject.org/ref-manual/variables.html?highlight=bblayers#term-BBLAYERS</a></li>
</ul>
</li>
<li>Include files: <b>include &lt;file_path&gt;</b> and <b>require &lt;file_path&gt;</b><ul>
<li>The included file can be any type of file, but Ambarella generally names it *.inc</li>
<li>The include and require directives can be used in any type of file</li>
<li>The include directive does not report an error if the file it contains does not exist, while the require directive does</li>
<li>If <code>&lt;file_path&gt;</code> is a relative path, then the base path is from the BBLAYER variable in the <code>conf/bblayers.conf</code> file to find the first match</li>
<li>The recipe file(*.bb) can use the THISDIR variable to indicate the directory where the recipe file is located. For example, include <code>usertask.inc</code>: include ${THISDIR}/usertask.inc THISDIR variable: <a href="https://docs.yoctoproject.org/ref-manual/variables.html?highlight=thisdir#term-THISDIR">https://docs.yoctoproject.org/ref-manual/variables.html?highlight=thisdir#term-THISDIR</a></li>
</ul>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="yocto_faq12"></a>
Question 12: How does Yocto build function under network file system (NFS)?</h1>
<p ><b>Answer:</b> Yocto does not support compiling under NFS by default, because the compilation speed is slow and there may be permission problems. For more information, refer to the page <a href="https://bugzilla.yoctoproject.org/show_bug.cgi?id=5442#c8">https://bugzilla.yoctoproject.org/show_bug.cgi?id=5442#c8</a>.</p>
<p >Users can disable the NFS checks in the official Poky project to make it compile successfully using the following method; however, but there is no guarantee that other problems will not occur. </p><div class="fragment"><div class="line">diff --git a/meta/classes/sanity.bbclass <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a>/meta/classes/sanity.bbclass</div>
<div class="line"><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> b1fac107d5..afbafe2382 100644</div>
<div class="line">--- a/meta/classes/sanity.bbclass</div>
<div class="line">+++ <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a>/meta/classes/sanity.bbclass</div>
<div class="line">@@ -722,7 +722,7 @@ def check_sanity_version_change(status, d):</div>
<div class="line">     status.addresult(check_path_length(tmpdir, <span class="stringliteral">&quot;TMPDIR&quot;</span>, 410))</div>
<div class="line"> </div>
<div class="line">     # Check that TMPDIR isn<span class="stringliteral">&#39;t located on nfs</span></div>
<div class="line"><span class="stringliteral">-    status.addresult(check_not_nfs(tmpdir, &quot;TMPDIR&quot;))</span></div>
<div class="line"><span class="stringliteral">+    #status.addresult(check_not_nfs(tmpdir, &quot;TMPDIR&quot;))</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">     # Check for case-insensitive file systems (such as Linux in Docker on</span></div>
<div class="line"><span class="stringliteral">     # macOS with default HFS+ file system)</span></div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
<div class="ttc" id="acJSON_8h_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="yocto_faq13"></a>
Question 13: Where is the Yocto directory structure defined?</h1>
<p ><b>Answer:</b> To understand the role of directories, refer to the page (<a href="https://docs.yoctoproject.org/ref-manual/structure.html">https://docs.yoctoproject.org/ref-manual/structure.html</a>). Check the Poky configuration file <code>meta/conf/bitbake.conf</code> for detailed definitions of directory variables.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq14"></a>
Question 14: What do downloads and sstate-cache have?</h1>
<p ><b>Answer:</b> <code>downloads</code> stores the source code; <code>sstate-cache</code> stores the compiled files. They can use the variables <b>DL_DIR</b> and <b>SSTATE_DIR</b> to specify the save directory respectively. DL_DIR: <a href="https://docs.yoctoproject.org/ref-manual/variables.html?highlight=dl_dir#term-DL_DIR">https://docs.yoctoproject.org/ref-manual/variables.html?highlight=dl_dir#term-DL_DIR</a> SSTATE_DIR: <a href="https://docs.yoctoproject.org/ref-manual/variables.html#term-SSTATE_DIR">https://docs.yoctoproject.org/ref-manual/variables.html#term-SSTATE_DIR</a></p>
<p >As shown below, they are stored in a common location so that all boards can share a resource. </p><div class="fragment"><div class="line">DL_DIR = <span class="stringliteral">&quot;${TOPDIR}/../downloads&quot;</span></div>
<div class="line">SSTATE_DIR = <span class="stringliteral">&quot;${TOPDIR}/../sstate-cache&quot;</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="yocto_faq15"></a>
Question 15: How can users establish local mirror servers to speed up the build?</h1>
<p ><b>Answer:</b> The first time building firmware through Yocto build usually takes many hours. This is because all required aspects, including compiler tools and OSS software packages, must be downloaded in advance. This is quite time-consuming. To save time, Ambarella suggests establishing the mirror server so that the required tools are only downloaded once, and then can be shared with other users. Users can follow the directions below to establish the mirror server.<br  />
</p><ol type="1">
<li>Copy the <code>downloads</code> and <code>sstate-cache</code> generated by the first build to a specific directory, such as <code>mirror</code>.</li>
<li>Run the HTTP server in the <code>mirror</code> directory; for example, <b>python -m http.server 8080</b>.</li>
<li>Add a setting to <code>conf/local.conf</code> in the output directory, for example:</li>
</ol>
<div class="fragment"><div class="line">SSTATE_MIRRORS = <span class="stringliteral">&quot;file://.* http://127.0.0.1:8080/sstate-cache/PATH;downloadfilename=PATH&quot;</span></div>
<div class="line">SOURCE_MIRROR_URL = <span class="stringliteral">&quot;http://127.0.0.1:8080/downloads&quot;</span></div>
<div class="line">INHERIT += <span class="stringliteral">&quot;own-mirrors&quot;</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="yocto_faq16"></a>
Question 16: What are the Yocto rules for getting source code and not recompiling?</h1>
<p ><b>Answer:</b> The rule that Yocto does not recompile is shown below: (<a href="https://docs.yoctoproject.org/overview-manual/concepts.html#shared-state-cache">https://docs.yoctoproject.org/overview-manual/concepts.html#shared-state-cache</a>):</p><ul>
<li>Check if there is a compiled package with the same timestamp in the local <code>SSTATE_DIR</code> folder; if yes, there is no requirement to recompile. Otherwise, check the next. For information about <b>recompile</b>, refer to the page <a href="https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-execution.html#setscene">https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-execution.html#setscene</a>.</li>
<li>Check if there is a compiled package with the same timestamp in the <code>SSTATE_MIRRORS</code> folder on the network. If so, copy the compiled package from the network directly to the local SSTATE_DIR without recompiling. Otherwise, check the next line.</li>
<li>Get the source code to compile and copy the compiled package to the local <code>SSTATE_DIR</code>.</li>
</ul>
<p >The rule for Yocto to get the source code is shown below: (<a href="https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-fetching.html">https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-fetching.html</a>):</p><ul>
<li>If the downloaded source code exists in the local <code>DL_DIR</code> directory with the same hash value, unzip it directly from the local directory.</li>
<li>If the downloaded source code exists in the <code>SORUCE_MIRROR_URL</code> folder on the network with the same hash value, download it to the local directory and then decompress. Otherwise, check the next.</li>
<li>Download the source code from the <code>SRC_URI</code> link specified in the recipe file if the download fails.</li>
<li>Download the source code from the official Yocto mirror.</li>
</ul>
<hr  />
<h1><a class="anchor" id="yocto_faq17"></a>
Question 17: How are official open source package compilation errors managed?</h1>
<p ><b>Answer:</b> The Yocto official recipe is used to compile the open source package. The <b>cache</b> may cause this error, or there may be insufficient system memory causing compilation errors. Running clean-up may resolve the issue. See the example below:</p>
<p >error log: </p><div class="fragment"><div class="line">ERROR: Task (USER_AMYOC_SDK_FOLDER/ambarella/build/poky/meta/recipes-connectivity/openssl/openssl_3.0.4.bb:do_package_write_rpm) failed with exit code <span class="charliteral">&#39;1&#39;</span></div>
<div class="line">ERROR: Task (USER_AMYOC_SDK_FOLDER/ambarella/build/poky/meta/recipes-devtools/gcc/gcc_11.3.bb:do_compile) failed with exit code <span class="charliteral">&#39;1&#39;</span></div>
</div><!-- fragment --><p >Solution: </p><div class="fragment"><div class="line">build # bitbake -c clean openssl &amp;&amp; bitbake openssl  # openssl_3.0.4.bb</div>
<div class="line">build # bitbake -c clean gcc &amp;&amp; bitbake gcc          # gcc_11.3.bb</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="yocto_faq18"></a>
Question 18: Why does the recipe file name of an external Linux module start with kernel-module-?</h1>
<p ><b>Answer:</b> See Poky's source code for <code>meta/classes/module.bbclass</code>. </p><div class="fragment"><div class="line">python __anonymous () {</div>
<div class="line">depends = d.getVar(<span class="stringliteral">&#39;DEPENDS&#39;</span>)</div>
<div class="line">extra_symbols = []</div>
<div class="line"><span class="keywordflow">for</span> dep in depends.split():</div>
<div class="line">  <span class="keywordflow">if</span> dep.startswith(<span class="stringliteral">&quot;kernel-module-&quot;</span>):</div>
<div class="line">      extra_symbols.append(<span class="stringliteral">&quot;${STAGING_INCDIR}/&quot;</span> + dep + <span class="stringliteral">&quot;/Module.symvers&quot;</span>)</div>
<div class="line">d.setVar(<span class="stringliteral">&#39;KBUILD_EXTRA_SYMBOLS&#39;</span>, <span class="stringliteral">&quot; &quot;</span>.join(extra_symbols))</div>
<div class="line">}</div>
</div><!-- fragment --><p >The module class automatically adds the symbol export file <code>Module.symvers</code> of dependent modules to the <b>KBUILD_EXTRA_SYMBOLS</b> variable. <b>KBUILD_EXTRA_SYMBOLS</b>: <a href="https://www.kernel.org/doc/html/latest/kbuild/kbuild.html?highlight=kbuild_extra_symbols">https://www.kernel.org/doc/html/latest/kbuild/kbuild.html?highlight=kbuild_extra_symbols</a></p>
<p ><code>Module.symvers</code> contains a list of <b>EXPORT_SYMBOL(func)</b> exported symbols. If users do not specify this file for the dependency package, the compilation will fail.</p>
<p >The inc.mod.mk template automatically adds Module.symvers, so it is acceptable to name it kernel-module-.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq19"></a>
Question 19: How can the compiler be prevented from creating symlinks</h1>
<p >oe/workdir / oe-logs in the source code directory? <b>Answer:</b> Look for the <b>EXTERNALSRC_SYMLINKS</b> variable (EXTERNALSRC_SYMLINKS?= "oe-workdir:${WORKDIR} oe-logs:${T}") in the Poky project source code of <code>meta/classes/externalsrc.bbclass</code>, and set this variable to null(EXTERNALSRC_SYMLINKS ?= "") in <code>conf/local.conf</code> in the output directory to disable its creation.</p>
<ul>
<li>Oe-workdir: points to the root directory of the package output <code>${WORKDIR}</code></li>
<li>Oe-logs: points to the package output log and script directory <code>${WORKDIR}/temp</code></li>
</ul>
<hr  />
<h1><a class="anchor" id="yocto_faq20"></a>
Question 20: How is the error message "ERROR: Please use a umask which allows a+rx and u+rwx" resolved and managed?</h1>
<p ><b>Answer:</b> The Yocto build system requires permissions of the created folder to be at least 755, and the permissions of the created file to be at least 644. If the following error occurs, check the umask value of the current shell environment configuration. Users can run the <b>"umask 022"</b> command to fix the issue.</p>
<p >For directories, the maximum default permission is 777; for files, the maximum default permission is 666. The initial permissions for files and directories are obtained by calculating the following: <b>initial permission = maximum default permission - umask permission</b>.</p>
<div class="fragment"><div class="line">  $ make</div>
<div class="line">  Clean done!</div>
<div class="line">  /usr/lib/python3/dist-packages/html5lib/_trie/_base.py:3: DeprecationWarning: Using or importing the ABCs from <span class="stringliteral">&#39;collections&#39;</span> instead of from <span class="stringliteral">&#39;collections.abc&#39;</span> is deprecated since Python 3.3, and in 3.10 it will stop working</div>
<div class="line">    from collections <span class="keyword">import</span> Mapping</div>
<div class="line">*WARNING: You are <span class="keyword">using</span> a local hash equivalence server but have configured an sstate mirror. This will likely mean no sstate will match from the mirror. You may wish to disable the hash equivalence use (BB_HASHSERVE), or use a hash equivalence server alongside the sstate mirror.</div>
<div class="line">*ERROR:  OE-core<span class="stringliteral">&#39;s config sanity checker detected a potential misconfiguration.</span></div>
<div class="line"><span class="stringliteral">     Either fix the cause of this error or at your own risk disable the checker (see sanity.conf).</span></div>
<div class="line"><span class="stringliteral">     Following is the list of potential problems / advisories:</span></div>
<div class="line"><span class="stringliteral"> </span></div>
<div class="line"><span class="stringliteral">     Please use a umask which allows a+rx and u+rwx</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="yocto_faq21"></a>
Question 21: How is the quality assurance (QA) issue [ldflags] resolved?</h1>
<p ><b>Answer</b> Error log: </p><div class="fragment"><div class="line">File <span class="stringliteral">&#39;&lt;file&gt;&#39;</span> in <span class="keyword">package </span>&#39;&lt;package&gt;&#39; doesn&#39;t have GNU_HASH (didn&#39;t pass LDFLAGS?)</div>
</div><!-- fragment --><p >This error occurs because LDFLAGS passes the link parameter <b>-Wl,&ndash;hash-style=gnu</b> by default, but not the compile library without using this link parameter.</p>
<p >Three solutions are as shown below:</p><ul>
<li>Compile the dynamic library with the linking parameter <b>-Wl,&ndash;hash-style=gnu</b></li>
<li>Change the default link parameter to sysv; add <b>LINKER_HASH_STYLE = "sysv"</b> to <code>conf/local.conf</code> in the output directory</li>
<li>Ignore the error; add <b>INSANE_SKIP:${PN} += "ldflags"</b> to the recipe file</li>
</ul>
<p >For more details regarding the difference between gnu and sysv, refer to the page <a href="https://answerywj.com/2020/05/14/ld-hash-style/">https://answerywj.com/2020/05/14/ld-hash-style/</a>.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq22"></a>
Question 22: How is the QA issue [dev-so] resolved?</h1>
<p ><b>Answer:</b> Error log: </p><div class="fragment"><div class="line">non -dev/-dbg/nativesdk- <span class="keyword">package </span>contains symlink .so: &lt;packagename&gt; path &#39;&lt;path&gt;&#39; [dev-so]</div>
</div><!-- fragment --><p >This error occurs beause the release package is packed with symbolic links. For more details, refer to the page <a href="https://docs.yoctoproject.org/dev-manual/common-tasks.html#working-with-pre-built-libraries">https://docs.yoctoproject.org/dev-manual/common-tasks.html#working-with-pre-built-libraries</a>.</p>
<p >The two solutions are as follows:</p><ul>
<li>Ignore the error and add <b>INSANE_SKIP:${PN} += "dev-so"</b> to the recipe file (Ambarella Yocto build is the current methods used)</li>
<li>More detailed descriptions of packaged objects are in the recipe, as shown below: <div class="fragment"><div class="line">FILES:${PN}-dev = <span class="stringliteral">&quot;${includedir} ${libdir}/lib*.so&quot;</span></div>
<div class="line">FILES:${PN} = <span class="stringliteral">&quot;${libdir}/lib*.so.*.*.*&quot;</span></div>
</div><!-- fragment --></li>
</ul>
<hr  />
<h1><a class="anchor" id="yocto_faq23"></a>
Question 23: How is the QA issue [file-rdeps] resolved?</h1>
<p ><b>Answer:</b> Error log: </p><div class="fragment"><div class="line">&lt;packagename&gt; requires &lt;files&gt;, but no providers in its RDEPENDS [file-rdeps]</div>
</div><!-- fragment --><p >If LDFLAGS specifies <b>-lsonamea</b> when compiling, users must add <b>RDEPENDS:${PN} += "packagename1 packagename2"</b> to the recipe file. If the error persists and the dependent dynamic library is versioned, compile the dependent dynamic library with the link parameter <b>-Wl,-soname=libxxx.so</b>.</p>
<p >For more details about link parameters, refer to the page <a href="https://www.cnblogs.com/wangshaowei/p/11285332.html">https://www.cnblogs.com/wangshaowei/p/11285332.html</a>.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq24"></a>
Question 24: How is the QA issue [already-stripped] resolved?</h1>
<p ><b>Answer:</b> Error log: </p><div class="fragment"><div class="line">File <span class="stringliteral">&#39;&lt;file&gt;&#39;</span> from &lt;recipename&gt; was already stripped, <span class="keyword">this</span> will prevent future debugging! [already-stripped]</div>
</div><!-- fragment --><p >This error occurs because the installed executable or dynamic library used the strip command to remove debugging information. The user installation file should not run first with the <b></b> command.</p>
<p >If the user is unable to rebuild the library, the problem can be solved by ignoring the error. Add <b>INSANE_SKIP:${PN} += "already-stripped"</b> to the recipe file.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq25"></a>
Question 25: How is the error message "Error: Unable to find a match: &lt;packagename&gt;" managed?</h1>
<p ><b>Answer:</b> This error occurs during the do_rootfs task and is caused because a package does not have any output, or the output is only header files and / or static library files.</p>
<p >Two solutions are as shown below:</p><ul>
<li>Ignore the error and add <b>ALLOW_EMPTY:${PN} = "1"</b> to the recipe file.<br  />
</li>
<li>Do not add this error package to the do_rootfs task variable <b>IMAGE_INSTALL:append</b>, and modify the <b>IGNORES_RECIPES</b> variable in <code>build/bin/yocto/inc-yocto-build.mk</code>.</li>
</ul>
<hr  />
<h1><a class="anchor" id="yocto_faq26"></a>
Question 26: How are errors such as "Error: Transaction test error" managed?</h1>
<p ><b>Answer:</b> Error log: </p><div class="fragment"><div class="line">xxx do_rootfs: Could not invoke dnf. Command...</div>
<div class="line">package_xxx</div>
<div class="line">package_xxxx</div>
<div class="line">....</div>
<div class="line">Error: Transaction test error: file xxx conflicts between attempted installs of xxx and xxx</div>
</div><!-- fragment --><p >The error is caused by the fact that the pathname of the file installed by a package is the same as the pathname of the file installed by other packages. Users can only change the file installed by one of the packages.</p>
<p >Sometimes, users use their own recipe to compile open source packages, and the Yocto build system also has a default recipe. The <b>do_rootfs</b> task may also run with errors. For example, if users use their own recipe to compile the zlib open source library, the <b>do_rootfs</b> task will report the following error: </p><div class="fragment"><div class="line">Error:</div>
<div class="line"> Problem: <span class="keyword">package </span>libkmod2-29-r0.cortexa53 requires libz1 &gt;= 1.2.11, but none of the providers can be installed</div>
<div class="line">  - package systemd-1:250.5-r0.cortexa53 requires libkmod.so.2()(64bit), but none of the providers can be installed</div>
<div class="line">  - package systemd-1:250.5-r0.cortexa53 requires libkmod.so.2(LIBKMOD_5)(64bit), but none of the providers can be installed</div>
<div class="line">  - package systemd-1:250.5-r0.cortexa53 requires libkmod2 &gt;= 29, but none of the providers can be installed</div>
<div class="line">  - cannot install both libz1-1.2.11-r0.cortexa53 and libz1-1.0-r0.cortexa53</div>
<div class="line">  - package packagegroup-core-boot-1.0-r17.v5 requires systemd, but none of the providers can be installed</div>
<div class="line">  - conflicting requests</div>
<div class="line">(try to add &#39;--allowerasing&#39; to command line to replace conflicting packages or &#39;--skip-broken&#39; to skip uninstallable packages)</div>
</div><!-- fragment --><p >Then, users can delete the custom recipe and use the official recipe instead.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq27"></a>
Question 27: How can the recipe be prepared so that the package can be recompiled at each time?</h1>
<p ><b>Answer:</b> If a package is to be recompiled in each build, such as in AMBoot, the user can use <b>bitbake -f packagename</b> to force the build; however, the following warning will appear: <b>WARNING: xxx.bb:do_build is tainted from a forced run</b> If a package does not require mandatory compilation but requires recompilation each time, the user must set the task attribute <b>do_compile[nostamp] = "1"</b> in the recipe file. For more information about variable flags, refer to the page <a href="https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html?highlight=nostamp#variable-flags">https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html?highlight=nostamp#variable-flags</a>.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq28"></a>
Question 28: How are new user-customized tasks created?</h1>
<p ><b>Answer:</b> Users require at least three elements to create a task: task function, execution directory, and task declaration. If the task depends on other packages, users must also set the dependencies.</p>
<p >The dirs depends and postfuncs properties are referenced in variable flags (<a href="https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html?highlight=nostamp#variable-flags">https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html?highlight=nostamp#variable-flags</a>), where the last directory listed in dirs is used as the task's current working directory. The addtask can also be added before (run this task before other tasks) and after (run this task before other tasks) instructions. </p><div class="fragment"><div class="line">do_${task_name} () {</div>
<div class="line">  oe_runmake ${task_name}</div>
<div class="line">}</div>
<div class="line">do_${task_name}[dirs] = <span class="stringliteral">&quot;${B}&quot;</span></div>
<div class="line">do_${task_name}[depends] += <span class="stringliteral">&quot;depend_package_name1:task_name depend_package_name2:task_name&quot;</span></div>
<div class="line">addtask ${task_name}</div>
</div><!-- fragment --><p >Add task to the board's build recipe: add the cv25_yocto_config task to load specific Kconfig configuration. </p><div class="fragment"><div class="line">do_cv25_yocto_config () {</div>
<div class="line">  oe_runmake -f amba.mk cv25_yocto_config</div>
<div class="line">}</div>
<div class="line">do_cv25_yocto_config[dirs] = <span class="stringliteral">&quot;${B}&quot;</span></div>
<div class="line">do_cv25_yocto_config[nostamp] = <span class="stringliteral">&quot;1&quot;</span></div>
<div class="line">do_cv25_yocto_config[depends] += <span class="stringliteral">&quot;kconfig-native:do_populate_sysroot&quot;</span></div>
<div class="line">do_cv25_yocto_config[postfuncs] += <span class="stringliteral">&quot;do_setrecompile&quot;</span></div>
<div class="line">addtask cv25_yocto_config</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="yocto_faq29"></a>
Question 29: How are local Yocto builds accelerated?</h1>
<p ><b>Answer:</b> To save resources, Ambarella limits the maximum number of tasks which can run in parallel at any one time. Users can speed up a local Yocto build by explicitly modifying or simply deleting the <code>BB_NUMBER_THREADS</code> variable in the script <code>ambarella/build/envyocto-build.env</code>. If the user removes this variable in the script file, they set this variable to the maximum number of CPUs on the user local build host. For more information about the <code>BB_NUMBER_THREADS</code> variable, refer to the page <a href="https://docs.yoctoproject.org/4.0.6/singleindex.html#term-BB_NUMBER_THREADS">https://docs.yoctoproject.org/4.0.6/singleindex.html#term-BB_NUMBER_THREADS</a>.</p>
<p >For example, modify <code>BB_NUMBER_THREADS</code> to 64: </p><div class="fragment"><div class="line">ambarella/build/env/yocto-build.env</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"># Setting the machine in the <span class="stringliteral">&quot;meta-xxx/conf/machine/&quot;</span></div>
<div class="line">MACHINE = <span class="stringliteral">&quot;${AMBA_SOC_SERIES}&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Setting the maximum number of threads BitBake simultaneously executes</span></div>
<div class="line">BB_NUMBER_THREADS = <span class="stringliteral">&quot;64&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Setting the save path of image</span></div>
<div class="line">DEPLOY_DIR_IMAGE = <span class="stringliteral">&quot;\${TOPDIR}/images&quot;</span></div>
<div class="line">...</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The value of <code>BB_NUMBER_THREADS</code> should not be greater than the maximum number of CPUs on the user local build host.</dd></dl>
<hr  />
<h1><a class="anchor" id="yocto_faq30"></a>
Question 30: How is the fetcher issue "Fetcher failure for URL: 'https://yoctoproject.org/connectivity.html'." resolved?</h1>
<p ><b>Answer:</b> This issue is caused by inability to access the Yocto connectivity URL, the check is executed by the function <code>check_connectivity</code> in <code>build/poky/meta/classes/sanity.bbclass</code>. Users can directly close this check: add <code>CONNECTIVITY_CHECK_URIS = ""</code> to <code>ambarella/out/yocto_out/&lt;board&gt;/conf/local.conf</code>.</p>
<hr  />
<h1><a class="anchor" id="yocto_faq31"></a>
Question 31: How is the error message "meson: error: unrecognized arguments: --pkg-config-path" in Ubuntu resolved?</h1>
<p ><b>Answer:</b> Error log: </p><div class="fragment"><div class="line">meson: error: unrecognized arguments: --pkg-config-path=/home/mk/Code/cv2x_linux_sdk_4.0/out/amba_out/cv22_walnut/sysroot/usr/lib/pkgconfig</div>
<div class="line">amba.mk:543: recipe <span class="keywordflow">for</span> target <span class="stringliteral">&#39;all&#39;</span> failed</div>
<div class="line">make[2]: *** [all] Error 2</div>
<div class="line">/home/mk/Code/cv2x_linux_sdk_4.0/ambarella/out/amba_out/cv22_walnut/config/<span class="keyword">auto</span>.mk:12282: recipe <span class="keywordflow">for</span> target <span class="stringliteral">&#39;oryxv2&#39;</span> failed</div>
</div><!-- fragment --><p >This error occurs because the version of meson (0.45.1) used to compile oryxv2 module is too old. Following shell script can help users to upgrade meson to a new one. Before using the following shell script, users must install <b> python3 </b> and <b> python3-pip </b>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#!/bin/bash</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Version of meson should be greater than 0.56.0</span></div>
<div class="line">MESON_REFER_MAJOR=0</div>
<div class="line">MESON_REFER_MINOR=56</div>
<div class="line">MESON_REFER_PATCH=0</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Check whether meson has been installed or not</span></div>
<div class="line">MESON_PATH=$(which meson)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Flag indicates whether a newer meson needs to be installed.</span></div>
<div class="line">MESON_NEED_INSTALL_FLAG=0</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> [[ x$MESON_PATH != <a class="code hl_variableRef" target="_blank" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> ]]; then</div>
<div class="line"><span class="preprocessor">  # meson has been install, we need to check the version of meson.</span></div>
<div class="line">  MESON_VERSION=`meson --version`</div>
<div class="line">  MESON_VERSION_MAJOR=`echo $MESON_VERSION | cut -d <span class="charliteral">&#39;.&#39;</span> -f 1`</div>
<div class="line">  MESON_VERSION_MINOR=`echo $MESON_VERSION | cut -d <span class="charliteral">&#39;.&#39;</span> -f 2`</div>
<div class="line">  MESON_VERSION_PATCH=`echo $MESON_VERSION | cut -d <span class="charliteral">&#39;.&#39;</span> -f 3`</div>
<div class="line">  <span class="keywordflow">if</span> [[ $MESON_VERSION_MAJOR -lt $MESON_REFER_MAJOR ]]; then</div>
<div class="line">     MESON_NEED_INSTALL_FLAG=1</div>
<div class="line">     echo <span class="stringliteral">&quot;version of meson ($MESON_VERSION) in your building machine is too old and it will be reinstall.&quot;</span></div>
<div class="line">  elif [[ $MESON_VERSION_MAJOR -eq $MESON_REFER_MAJOR ]]; then</div>
<div class="line">     <span class="keywordflow">if</span> [[ $MESON_VERSION_MINOR -lt $MESON_REFER_MINOR ]]; then</div>
<div class="line">         MESON_NEED_INSTALL_FLAG=1</div>
<div class="line">         echo <span class="stringliteral">&quot;version of meson ($MESON_VERSION) in your building machine is too old and it will be reinstall.&quot;</span></div>
<div class="line">     elif [[ $MESON_VERSION_MINOR -eq $MESON_REFER_MINOR ]]; then</div>
<div class="line">         <span class="keywordflow">if</span> [[ $MESON_VERSION_PATCH -lt $MESON_REFER_PATCH ]]; then</div>
<div class="line">             MESON_NEED_INSTALL_FLAG=1</div>
<div class="line">             echo <span class="stringliteral">&quot;version of meson ($MESON_VERSION) in your building machine is too old and it will be reinstall.&quot;</span></div>
<div class="line">         fi</div>
<div class="line">     fi</div>
<div class="line">  fi</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">  # Check whether meson on building machine needs to be reinstall.</span></div>
<div class="line">  <span class="keywordflow">if</span> [[ $MESON_NEED_INSTALL_FLAG -eq 1 ]]; then</div>
<div class="line">    sudo apt-get purge meson</div>
<div class="line">  fi</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">   MESON_NEED_INSTALL_FLAG=1</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> [[ $MESON_NEED_INSTALL_FLAG -eq 1 ]]; then</div>
<div class="line">   echo <span class="stringliteral">&quot;Meson with version 1.0 will be installed.&quot;</span></div>
<div class="line">   sudo pip3 install meson==1.0</div>
<div class="line">fi</div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a></div><div class="ttdeci">u32 x</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="yocto_faq32"></a>
Question 32: How is the error message "Transaction test error: file /usr/lib/systemd conflicts between attempted installs" resolved?</h1>
<p ><b>Answer:</b> Error log: </p><div class="fragment"><div class="line">Error: Transaction test error:</div>
<div class="line">file /usr/lib/systemd conflicts between attempted installs of network-init-0.0.1-r0.cortexa53_crypto and dsp-reset-service-1.0-r0.cortexa53_crypto</div>
<div class="line">file /usr/lib/systemd/system conflicts between attempted installs of network-init-0.0.1-r0.cortexa53_crypto and dsp-reset-service-1.0-r0.cortexa53_crypto</div>
</div><!-- fragment --><p >This error is caused by files permissions, users can try this way to fix the issue. </p><div class="fragment"><div class="line">cooper_sdk/ambarella$ cd rootfs/network/</div>
<div class="line">cooper_sdk/ambarella/rootfs/network/$ find -type f -exec chmod 644 {} \;</div>
<div class="line">cooper_sdk/ambarella/rootfs/network/$ find -type d -exec chmod 755 {} \;</div>
</div><!-- fragment --><p> Then, users can re-compile (Do not delete 'out/' but must rerun make ipcam_config before make).</p>
<p >If this solution does not work, users can try another way (set the umask value to 0022 and pull the code again).</p>
<hr  />
<h1><a class="anchor" id="yocto_faq33"></a>
Question 33: How to prepare Yocto mirror and sstate-cache?</h1>
<p >Follow the steps below to prepare Yocto mirror and sstate-cache: </p><div class="fragment"><div class="line">1. Clean up the SDK output.</div>
<div class="line">   cooper_sdk/ambarella$ rm -rf out</div>
<div class="line">2. Initialize the Yocto environment. (such as cv22_walnut)</div>
<div class="line">   cooper_sdk/ambarella$ source build/env/yocto-build.env cv22_walnut</div>
<div class="line">3. Modify the local.conf to set the SSTATE_MIRRORS and SOURCE_MIRROR_URL to invalid values, and add a line: BB_GENERATE_MIRROR_TARBALLS = <span class="stringliteral">&quot;1&quot;</span></div>
<div class="line">   cooper_sdk/ambarella/out/yocto_out/cv22_walnut$ vi conf/local.conf</div>
<div class="line">4. Choose a config and select OSS as many as possible.</div>
<div class="line">   cooper_sdk/ambarella/out/yocto_out/cv22_walnut$ make ipcam_config i=ros-image</div>
<div class="line">5. Fetch the source code.</div>
<div class="line">   cooper_sdk/ambarella/out/yocto_out/cv22_walnut$ bitbake ros-image --runonly=fetch</div>
<div class="line">6. Compile.</div>
<div class="line">   cooper_sdk/ambarella/out/yocto_out/cv22_walnut$ make ros-image</div>
</div><!-- fragment --><p> After the operations above are completed, users can find the cache below <code>out/mirror-cache</code>.</p>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
