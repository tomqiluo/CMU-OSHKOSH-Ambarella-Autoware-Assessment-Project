<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Applications: Multi-VIN Binding Single Channel</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Applications"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Applications<span id="projectnumber">&#160;1.0.0 @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d5/dac/multi_vin_bind_page.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Multi-VIN Binding Single Channel </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="mvbc_history"></a>
0. Revision History</h1>
<a class="anchor" id="mvbc_history_table"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td>20230620 </td><td>Initial Version </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="mvbc_ov"></a>
1. Overview</h1>
<p >This document introduces the Ambarella multi-VIN bind to single channel (MVBC) demo and provides details of the reference design for the Ambarella CV5x system on chip (SoC).</p>
<p >This document demonstrates a simple method to use MVBC in the CV5x SoC in order to aid users in designing their products.</p>
<p >Channels are the software concept of the image digital signal processor (IDSP) pipeline. For each channel, CV5x / CV7x chips process the input frames captured from an RGB sensor or YUV device, and generate different YUV buffers for further processing. Therefore, the image audio video (IAV) driver allocates a large amount of memory to each channel to ensure the normal operation of the entire pipeline. The memory required by each channel is closely related to the resolution of the sensor. If the resolution of the sensor corresponding to the channel is high, the number of channels supported by the system will be smaller. When users must support multiple large resolution sensors, the overhead of the system becomes stretched.</p>
<p >CV5x / CV7x chips can support multiple sensors time-sharing the same channel. Users can dynamically change the video input (VIN) source functioning on a channel when IAV has entered the preview or encode state. Therefore, it can support multiple large-resolution sensors to function together with limited system overhead, without having to enter the idle state or reset both the IAV and the digital signal processor (DSP).</p>
<hr  />
<h1><a class="anchor" id="mvbc_demo"></a>
2. Demo Application</h1>
<p >The field <code>possible_vsrc_list</code> has been added into the channel configuration of the Lua file.</p>
<div class="fragment"><div class="line">chan_0 = {</div>
<div class="line">    ...</div>
<div class="line">    possible_vsrc_list = {vsrc_0, vsrc_1, vsrc_2, },</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p >The purpose of this field is to bind several sensors of the same format to the current channel. These sensors can be dynamically switched after the IAV enters the preview state or even after encoding has begun.</p>
<ol type="1">
<li>Ambarella currently provides a demo to switch VIN sources in the "test_aaa_service -i" interactive mode.</li>
</ol>
<div class="fragment"><div class="line">----------------------------------1: When preview is done, you can following menu----------------------------------</div>
<div class="line">board# test_aaa_service -i</div>
<div class="line">g -- global settings</div>
<div class="line">e -- exposure control settings</div>
<div class="line">w -- white balance settings</div>
<div class="line">a -- image adjustment settings</div>
<div class="line">n -- nn isp settings</div>
<div class="line">d -- dynamic change <a class="code hl_variableRef" href="../../../video/d4/daa/vin__init_8c.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> vsrc mapping</div>
<div class="line">q -- quit</div>
<div class="line">================================================</div>
<div class="line">Channel [0]: &gt; d</div>
<div class="line">----------------------------------2: Type “d”, then you can get----------------------------------------------------</div>
<div class="line">======= dynamic change <a class="code hl_variableRef" href="../../../video/d4/daa/vin__init_8c.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> vsrc mapping menu ======</div>
<div class="line">s -- show current vsrc id   (shows current vsrc <span class="keywordtype">id</span> <span class="keywordflow">for</span> <span class="keywordflow">default</span> channel <span class="keywordtype">id</span>(0))</div>
<div class="line">c -- change vsrc <span class="keywordtype">id</span>         (switches vsrc <span class="keywordtype">id</span> to the input value.)</div>
<div class="line">q -- Return to upper level</div>
<div class="line">================================================</div>
<div class="line">A &gt; c</div>
<div class="line">----------------------------------3: switch vsrc for current channel.------------------------------------------------</div>
<div class="line">==========================</div>
<div class="line">Input new vsrc <span class="keywordtype">id</span>: 1</div>
<div class="line"> </div>
<div class="line">New vsrc <span class="keywordtype">id</span> is 0. Start changing vsrc...</div>
<div class="line">========= Start dynamic chaning vsrc for chan[0] =========</div>
<div class="line">        1. stop AAA flow!</div>
<div class="line">        2. switch to vsrc_id[1] for chan[0]</div>
<div class="line">Successfully switch vsrc_id from [0] to [1] for chan[0]</div>
<div class="line"> </div>
<div class="line">        3. Update vsrc2chan map in AAA</div>
<div class="line">        4. Re-start AAA flow!</div>
<div class="line">Dynamic change vsrc is done!</div>
<div class="line">Successfully change vsrc!</div>
<div class="ttc" id="avin__init_8c_html_adf7dff2c57c0da9a4a2b70e3e815be31"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a></div><div class="ttdeci">int channel</div></div>
</div><!-- fragment --><ol type="1">
<li>Run the demo application command line:</li>
</ol>
<div class="fragment"><div class="line">board-1 # init.sh --na;</div>
<div class="line">board-1 # modprobe imx274_mipi vinc_id=0x40b8;</div>
<div class="line">board-2 # test_aaa_service -i</div>
<div class="line">board-1 # test_encode --resource-cfg three_vin_bind_chan0_one_vin_bind_chan1.lua  --vout-cfg vout_hdmi.lua</div>
<div class="line">board-1 # test_encode -A -Hqfhd -b0 -e</div>
<div class="line">board-1 # test_encode -B -Hqfhd -b4 -e</div>
<div class="line">board-1 # rtsp_server</div>
<div class="line">board-2 # test_aaa_service -i &gt; d &gt; c</div>
</div><!-- fragment --><p >Refer to <a href="../../script/three_vin_bind_chan0_one_vin_bind_chan1.lua" target="_blank"><b>three_vin_bind_chan0_one_vin_bind_chan1.lua</b></a>.</p>
<hr  />
<h1><a class="anchor" id="mvbc_hw_design"></a>
3. Software Design</h1>
<p >The following is a schematic diagram of the mixed-case MVBC pipeline for this application. </p><div class="image">
<img src="../../mvbc_pipeline.jpg" alt=""/>
<div class="caption">
Figure 3-1. MVBC Pipeline.</div></div>
<p >As an initial version, there are still some limitations:</p><ul>
<li>Ambarella currently only supports <b>multiple independent VINC</b> bindings to the same channel, and the case of multiple sensors mounted to one VINC is not yet supported.</li>
<li>Several sensors bound to the same channel must be the same model sensor and have exactly the same configuration parameters (such as Bayer, high dynamic range (HDR) mode, frame rate, resolution, and RGB bits).</li>
<li>Some features (such as vsync loss detection) are not yet supported for this application.</li>
<li>The demo application is only used as a reference design. Only channel0 can switch the video source (VSRC) on the fly. Users are required to write their own application for other cases.</li>
</ul>
<hr  />
<h1><a class="anchor" id="mvbc_license"></a>
4. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ("Software") are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
