<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Applications: Multi-View Video Conference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Applications"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Applications<span id="projectnumber">&#160;1.0.0 @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dc/dce/mvvc_page.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Multi-View Video Conference </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="mvvc_history"></a>
0. Revision History</h1>
<a class="anchor" id="mvvc_history_table"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td>20221220 </td><td>Initial Version </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="mvvc_ov"></a>
1. Overview</h1>
<p >This document introduces the Ambarella multi-view video conference (MVVC) demo application and provides details of the reference design for the Ambarella CV5x system on chip (SoC). As shown in Figure 1-2 below, MVVC displays stitched scenes of all participants in the same video screen at the same time.</p>
<p >This document serves to demonstrate the easy application of the MVVC effect in the CV5x SoC in order to aid customers in designing their own product.</p>
<div class="image">
<img src="../../mvvc_meeting_room.jpg" alt=""/>
<div class="caption">
Figure 1-1. MVVC Meeting Room.</div></div>
<p> <br  />
 </p><div class="image">
<img src="../../mvvc_effect_v6.png" alt=""/>
<div class="caption">
Figure 1-2. MVVC Effect.</div></div>
<p> <br  />
</p>
<hr  />
<h1><a class="anchor" id="mvvc_demo"></a>
2. Demo Application</h1>
<p >The Ambarella CV5x software development kit (SDK) has developed many basic and advanced features for customer use. In addition, popular computer vision (CV) and image process algorithms are implemented to reduce customer development costs. MVVC is a combination of features and CV algorithms in the Ambarella CV5x SDK. The primary features used are encoding from memory (EFM), image scaling, and video stitching. The demo also uses a byte tracking algorithm for human detection and tracking. The application pipeline is provided in later chapters. Follow the steps below to build the environment and run the MVVC demo.</p>
<ol type="1">
<li>Build the demo application: <div class="fragment"><div class="line">[*] Ambarella Application Configuration  ---&gt;</div>
<div class="line">    [*] Build Video Conference  ---&gt;</div>
<div class="line">        [*] Build Multi Combine ROI View from Stitch Canvas Application</div>
</div><!-- fragment --></li>
<li>Build the ByteTrack EazyAI application: <div class="fragment"><div class="line">[*] Ambarella Package Configuration  ---&gt;</div>
<div class="line">    [*] Build Ambarella EAZYAI library  ---&gt;</div>
<div class="line">        [*] Build EazyAI applications  ---&gt;</div>
<div class="line">            [*] Build ByteTrack EazyAI apps</div>
</div><!-- fragment --></li>
<li>Run the demo application command line: <div class="fragment"><div class="line">----------------------------------1: start a stream <span class="keywordflow">for</span> efm------------------------------------------</div>
<div class="line">board # init.sh --na;modprobe max9296 <span class="keywordtype">id</span>=0x0303 vinc_id=0xb8;modprobe os08a10_mipi_brg fsync=1</div>
<div class="line">board # test_aaa_service -a&amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_four_chan_four_sensor_8064x1024_main_3840x2160_third_1920x256_fourth.lua \</div>
<div class="line">        --img-scale 1 --img-scale-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 0 --img-scale-max-in 8276x2176 --img-scale-max-out 3840x2176 --img-scale-job-queue-depth 12</div>
<div class="line">board # test_encode -A -H qfhd -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 24 -e</div>
<div class="line">board # test_encode -A --bitrate 800000</div>
<div class="line">----------------------------------2: sensor calibration----------------------------------------------</div>
<div class="line">board # test_stitch --mode 2 -f ./ &amp;</div>
<div class="line">board # test_stitch --mode 3 --overlap-<span class="keywordtype">id</span> 0 --top 200,0  --bot 200,1024 --overlap-<span class="keywordtype">id</span> 1 --top 200,0  --bot 200,1024 \</div>
<div class="line">        --overlap 2 --top 200,0  --bot 200,1024 --overlap 3 --top 200,0  --bot 200,1024</div>
<div class="line">----------------------------------3: combine ROIs--------------------------------------------------</div>
<div class="line">board # test_stitch_multi_roi_combine -A -s 0 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 1 -H 480 -W 8064 --non-block 1 -l 15 --resort 1 -F 376 -m 344 -e 150 \</div>
<div class="line">        --moving-steps-<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 16 --moving-steps-<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 4 --moving-steps-w 4 -M 8 --input-<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>-thr 0.03 --objid-change-thr 310 &amp;</div>
<div class="line">----------------------------------4: start CV detection----------------------------------------------</div>
<div class="line">board # rmmod cavalry &amp;&amp; modprobe cavalry &amp;&amp; cavalry_load -f /lib/firmware/cavalry.bin -r</div>
<div class="line">board # test_bytetrack -p cavalry_bytetrack-fx16.bin -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 1 -d 1 -s 1 -e 1 -u 1 --disable_display 1</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
<div class="ttc" id="acJSON_8h_html_adb411a44855a4c49231d72a0fc9a3b3b"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div><div class="ttdeci">char const int const cJSON_bool format</div></div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a></div><div class="ttdeci">u32 y</div></div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a></div><div class="ttdeci">u32 width</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a></div><div class="ttdeci">u32 x</div></div>
</div><!-- fragment --> <hr  />
 </li>
</ol>
<h1><a class="anchor" id="mvvc_hw_design"></a>
3. Hardware Design</h1>
<p >In this application, there is one panoramic camera consisting of four cameras covering a 360° view of the meeting room. In the output stage, the CV5x board can output the video stream to the monitor via a high definition multimedia interface (HDMI®) cable or transfer H26x / MJPEG streams via Ethernet. Refer to the following figure for the hardware design: </p><div class="image">
<img src="../../mvvc_hw_design_v6.png" alt=""/>
<div class="caption">
Figure 3-1. MVVC Hardware Design.</div></div>
 <hr  />
 <h1><a class="anchor" id="mvvc_soft_design"></a>
4. Software Design</h1>
<p >The following is a schematic diagram of the MVVC pipeline for this application. </p><div class="image">
<img src="../../mvvc_sw_design_v6.png" alt=""/>
<div class="caption">
Figure 4-1. MVVC Pipeline.</div></div>
<p> The four cameras are deserialized as four video inputs (VINs); each connects to one image digital signal processing (IDSP) channel. Each VIN-IDSP channel records part of the view of the meeting room. In the canvas, it is necessary to stitch the YUV image from all four channels together to get one panoramic view again. Refer to <a class="elRef" href="../../../library/dd/da8/page_lib_stitch_doc.html">Ambarella Stitching Features</a> on how to perform image stitching.</p>
<p >There are three canvases in this application:</p><ol type="1">
<li><b>Canvas 0</b> consists of four main buffers. Its resolution should be as large as possible within system limitations.</li>
<li><b>Canvas 1</b> is formed from four third buffers. As shown in Figure 4-1, the panoramic view is on the top of the canvas while the bottom half is a blank area reserved for the image scaler's output. This canvas also functions as an EFM input, so its resolution should be the same as the EFM stream's, which is 4K in this demo.</li>
<li><b>Canvas 2</b> is comprised of four fourth buffers. This canvas is used as an input for the CV detection algorithm. Its resolution is decided on the CV algorithm's requirement.</li>
</ol>
<p >After starting the application, the CV algorithm queries each YUV image from canvas 2 and runs detection. Then, CV outputs detection results to the MVVC application containing the position of each person. The MVVC application will then extract people from canvas 0 using <a class="elRef" href="../../../video/d8/d93/fs_adv_arb_img_scaler.html">image scaler</a> and output the scaled image to canvas 1's blank area to compose the YUV containing one panoramic view, plus serveral region of interests (ROIs). After extracting all people detected, the MVVC application sends canvas 1's YUV image to EFM and video output (VOUT). Then, users can see this frame on a monitor or via VideoLAN Client (VLC).</p>
<p >If the user does not want the panoramic view on the top of the stream, canvas 1 can be removed. In this case, the user application must allocate a dynamic random-access memory (DRAM) partition for the image scaler output and EFM input. The effect without panoramic view is shown as below in Figure 4-2. </p><div class="image">
<img src="../../mvvc_effect_without_panorama_v6.png" alt=""/>
<div class="caption">
Figure 4-2. MVVC Effect Without Panoramic View.</div></div>
 <hr  />
 <h1><a class="anchor" id="mvvc_advanced_features"></a>
5. Advanced Features</h1>
<h2><a class="anchor" id="mvvc_strategy_of_me_img"></a>
5.1 Generate ME Image</h2>
<p >If the EFM stream format is H26x, the MVVC application will also generate the ME image. There are two strategies to generate ME1 and ME0 images:</p><ol type="1">
<li>Scale down from the YUV image using the image scaler</li>
<li>Compose each ROI to the ME buffer; similar to what is performed for the YUV image</li>
</ol>
<p >Strategy 1 uses more DRAM bandwith when the panoramic view exists because it must process not only the ROIs but also the panoramic view on the stream top. <br  />
 Strategy 2 is not affected by the panoramic view, but it sends more DSP commands than strategy 1. Thus, the digital signal processor (DSP) will spend more time on command and message exchanges with Arm®, which results in lower frames per second (fps) and longer latency. <br  />
 The following table provides the DRAM bandwidth utilization of these two strategies. </p><a class="anchor" id="bram_bw_of_mvvc_app"></a>
<table class="doxtable">
<caption>Table 5-1. DRAM Bandwidth Utilization of the MVVC Application.</caption>
<tr>
<th></th><th align="center">Strategy 1 </th><th align="center">Strategy 2 </th></tr>
<tr>
<th>DSP DRAM Bandwidth </th><td align="center">6578.497 MB/s <br  />
(15.353% of <a href="#" onclick="location.href='mai'+'lto:'+'LPD'+'DR'+'5@2'+'.8'+'GHz'; return false;">LPDDR<span class="obfuscator">.nosp@m.</span>5@2.<span class="obfuscator">.nosp@m.</span>8GHz</a>) </td><td align="center">6323.493 MB/s <br  />
(14.758% of <a href="#" onclick="location.href='mai'+'lto:'+'LPD'+'DR'+'5@2'+'.8'+'GHz'; return false;">LPDDR<span class="obfuscator">.nosp@m.</span>5@2.<span class="obfuscator">.nosp@m.</span>8GHz</a>) </td></tr>
</table>
<p>Ambarella recommends using strategy 1 when DRAM loading is not heavy in order to get higher fps and lower latency. </p><hr  />
 <h1><a class="anchor" id="mvvc_license"></a>
6. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ("Software") are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
