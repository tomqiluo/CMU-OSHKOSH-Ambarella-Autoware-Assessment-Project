<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: ADVANCED - Encode from RAW</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d3/dff/fs_adv_efr.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">ADVANCED - Encode from RAW </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="efr_efr"></a>
1. Encode from RAW</h1>
<p >There are two main cases for this feature, based on different processing stages inside the digital signal processor (DSP).</p><ul>
<li><b>Encode from RAW (EFR)</b></li>
<li><a class="el" href="../../d9/dc7/fs_adv_efm.html#efm_efm">Encode from MEM</a></li>
</ul>
<p >For EFR cases, the RAW data files are fed to video input (VIN) buffer. AE / AWB / AF (3A) flow and other image optimization still function while encode from memory (EFM) cases send data directly to the source buffer for encoding. <br  />
 For EFR cases, anonymous memory partitions are required to transfer the RAW data. Reserve sufficient memory in the digital signal processor (DSP) private memory partition.</p>
<p >If the input format is YUV, the supported format is YUV422 / YUV420, and UV should be interleaved; that is, NV16 / NV12 accordingly. NV16 (YUV422) is provided below: </p><pre class="fragment">           YYYYYYYYYYYYYYYYYYYYYYYYYYYY
           YYYYYYYYYYYYYYYYYYYYYYYYYYYY
           YYYYYYYYYYYYYYYYYYYYYYYYYYYY
           YYYYYYYYYYYYYYYYYYYYYYYYYYYY
           UVUVUVUVUVUVUVUVUVUVUVUVUVUV
           UVUVUVUVUVUVUVUVUVUVUVUVUVUV
           UVUVUVUVUVUVUVUVUVUVUVUVUVUV
           UVUVUVUVUVUVUVUVUVUVUVUVUVUV
</pre><p >NV12 (YUV420) is as follows: </p><pre class="fragment">           YYYYYYYYYYYYYYYYYYYYYYYYYYYY
           YYYYYYYYYYYYYYYYYYYYYYYYYYYY
           YYYYYYYYYYYYYYYYYYYYYYYYYYYY
           YYYYYYYYYYYYYYYYYYYYYYYYYYYY
           UVUVUVUVUVUVUVUVUVUVUVUVUVUV
           UVUVUVUVUVUVUVUVUVUVUVUVUVUV
</pre><dl class="section note"><dt>Note</dt><dd>To start EFR test cases, run <code>"test_efm"</code> in another console <b>immediately after</b> <code>"test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg vout.lua --enc-raw-rgb/yuv 1"</code> feeds YUV data continuously into the DSP.</dd></dl>
<hr  />
<h1><a class="anchor" id="efr_multi"></a>
2. EFR for Multi-VINs and Multiple Channels</h1>
<p >EFR for multi-VINs can support RAW encoding from each VIN controller. EFR can support various RAW formats, including RGB Bayer RAW, NV16 (YUV422), and NV12 (YUV420). In this case, users must configure parameters of the ambdd driver. The parameter "vin_virtual_flag" must be set to 1, and the parameter "vinc_id_map" must be set as the VINC RAW encode bitmap. For example, "vinc_id_map=0xc000" indicates that virtual VIN14 and VIN15 are used; it can support RAW encode from different VINCs. Of course, users want to perform RAW encode from a single real virtual VINC; users can also choose not to specify the parameter above. Users can set multiple channels for a single virtual VINC.</p>
<dl class="section note"><dt>Note</dt><dd>Currently, image audio video (IAV) supports four VINs for RAW encode and four channels for each single real virtual VINC.</dd></dl>
<hr  />
<h1><a class="anchor" id="custom_virtual_vin_mode"></a>
3. Custom Virtual VIN Mode</h1>
<p >To make EFR more flexible and to support different video source (VSRC) formats, users can configure the virtual VIN mode via Lua script. See <a class="el" href="../../d2/d61/fs_basic_vin.html#lua_vsrc_configuration">Video Input Configuration</a>.</p>
<hr  />
<h1><a class="anchor" id="efr_exp"></a>
4. EFR Examples</h1>
<h2><a class="anchor" id="example_efr1"></a>
Example 1: Encode from RGB RAW: Input from RGB (RAW) file to VIN with custom virtual VIN mode</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear_efr_rgb.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1 <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear_efr_rgb.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1)  <span class="comment">// For CV72</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv3_vin0_1080p_linear_efr_rgb.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --raw-capture 1 --enc-raw-rgb 1)  <span class="comment">// For CV3</span></div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_1920x1080_3840.raw  -s 1920x1080 -T 1 -r 30 -R 0 --vin-<span class="keywordtype">id</span> 14</div>
<div class="line">(Or board# test_efm -t 3 -i cap_raw_raw_1920x1080_3840.raw  -s 1920x1080 -T 1 -r 30 -R 0 --vin-<span class="keywordtype">id</span> 24)  <span class="comment">// For CV3</span></div>
<div class="ttc" id="acJSON_8h_html_a788db922597cf2fb6389e278f822e59f"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a></div><div class="ttdeci">const char *const const char *const raw</div></div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr2"></a>
Example 2: Encode from 12-bit packed RGB RAW: Input from RGB (RAW) file to VIN with custom virtual VIN mode</h2>
<p >To support encode from 12-bit packed RAW, users must enter the preview by setting "raw_capture = 1" and "packing_mode_enable = 1". For more details, refer to <a href="../../script/uncompressed_pack_raw_packed_4k.lua" target="_blank"><b>uncompressed_pack_raw_packed_4k.lua</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;</div>
<div class="line">board# modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg uncompressed_pack_raw_packed_4k.lua --vout-cfg vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1</div>
<div class="line">board# test_encode -A -h 3840x2160 -e</div>
<div class="line">board# test_efm -t 3 -i 3840x2160_5764_pck_12bits.raw -s 5764x2160 -e ce_960x2160_1444_pck_12bits.raw --ce-size 1444x2160 -T 1 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 2</div>
<div class="line">board# test_encode -A -s</div>
<div class="ttc" id="acJSON_8h_html_adb411a44855a4c49231d72a0fc9a3b3b"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div><div class="ttdeci">char const int const cJSON_bool format</div></div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr3"></a>
Example 3: Encode from compressed RGB RAW: Input from RGB (RAW) file to VIN with custom virtual VIN mode</h2>
<p >To support encode from compressed RAW, users must enter the preview by setting "raw_capture = 0". For more details, refer to <a href="../../script/compressed_raw_4k.lua" target="_blank"><b>compressed_raw_4k.lua</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;</div>
<div class="line">board# modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg compressed_raw_4k.lua --vout-cfg vout_hdmi.lua --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1</div>
<div class="line">board# test_encode -A -h 3840x2160 -e</div>
<div class="line">board# test_efm -t 3 -i 3840x2160_3244_cpr.raw -s 3244x2160 -e ce_960x2160_816_cpr.raw --ce-size 816x2160 -T 1 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 1</div>
<div class="line">board# test_encode -A -s</div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr4"></a>
Example 4: Encode from YUV NV16 RAW: YUV NV16 (RAW) to VIN</h2>
<p >To support encode from NV16 RAW file, users must enter the preview by setting "enc-raw-yuv = 1" and "raw-capture = 1".</p>
<div class="fragment"><div class="line">board# init.sh --na</div>
<div class="line">board# modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear_efr_yuv.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-yuv 1 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear_efr_yuv.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-yuv 1 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1)  <span class="comment">// For CV72</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv3_vin0_1080p_linear_efr_yuv.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-raw-yuv 1 --raw-capture 1)  <span class="comment">// For CV3</span></div>
<div class="line">board# test_efm -t 2 -s 1920x1080 -i 1080p_nv16.raw -T 1</div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_encode -A -s</div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr5"></a>
Example 5: Encode from YUV NV12 RAW: YUV NV12 (RAW) to VIN</h2>
<p >To support encode from NV12 RAW file, users must enter the preview by setting "enc-raw-nv12 = 1" and "raw-capture = 1".</p>
<div class="fragment"><div class="line">board# init.sh --na</div>
<div class="line">board# modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear_efr_yuv.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-nv12 1 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear_efr_yuv.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-nv12 1 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1)  <span class="comment">// For CV72</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv3_vin0_1080p_linear_efr_yuv.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-raw-nv12 1 --raw-capture 1)  <span class="comment">// For CV3</span></div>
<div class="line">board# test_efm -t 4 -s 1920x1080 -i 1080p_nv12.raw -T 1</div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_encode -A -s</div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr6"></a>
Example 6: Encode from RGB RAW with multi-source: Two sources and two channels</h2>
<p >virtual_vsrc_num in ambds used to specify the VSRC number for the RAW encode channel.</p>
<div class="fragment"><div class="line">board# init.sh --na; modprobe ambds vin_virtual_flag=1 virtual_vsrc_num=2 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_dual_chan_dual_input_raw_encode.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_dual_chan_dual_input_raw_encode.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1)  <span class="comment">// For CV72</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv3_dual_chan_dual_input_raw_encode.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --raw-capture 1 --enc-raw-rgb 1)  <span class="comment">// For CV3</span></div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_1920x1080_3840_v1.raw -s 1920x1080 -T 1 --vin-<span class="keywordtype">id</span> 14</div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_3840x2160_7680_v2.raw -s 3840x2160 -T 1 --vin-<span class="keywordtype">id</span> 15</div>
<div class="line">(Or board# test_efm -t 3 -i cap_raw_raw_1920x1080_3840_v1.raw -s 1920x1080 -T 1 --vin-<span class="keywordtype">id</span> 24)  <span class="comment">// For CV3</span></div>
<div class="line">(Or board# test_efm -t 3 -i cap_raw_raw_3840x2160_7680_v2.raw -s 3840x2160 -T 1 --vin-<span class="keywordtype">id</span> 25)  <span class="comment">// For CV3</span></div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_encode -A -s</div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr7"></a>
Example 7: Encode from RGB RAW with multi-source: Four sources and four channels</h2>
<p >The Lua script can be found in <a href="../../script/four_chan_four_vin_efr_4k.lua" target="_blank"><b>four_chan_four_vin_efr_4k.lua</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na; modprobe ambds vin_virtual_flag=1 virtual_vsrc_num=4 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg four_chan_four_vin_efr_4k.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 0 --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1</div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_3840x2160_3240_cpr_v1.raw -s 3240x2160 -e cap_raw_raw_ce_960x2160_812_cpr_v1.raw --ce-size 812x2160 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 1 -T 1 --vin-<span class="keywordtype">id</span> 14</div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_3840x2160_3240_cpr_v2.raw -s 3240x2160 -e cap_raw_raw_ce_960x2160_812_cpr_v2.raw --ce-size 812x2160 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 1 -T 1 --vin-<span class="keywordtype">id</span> 15</div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_3840x2160_3240_cpr_v3.raw -s 3240x2160 -e cap_raw_raw_ce_960x2160_812_cpr_v3.raw --ce-size 812x2160 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 1 -T 1 --vin-<span class="keywordtype">id</span> 16</div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_3840x2160_3240_cpr_v4.raw -s 3240x2160 -e cap_raw_raw_ce_960x2160_812_cpr_v4.raw --ce-size 812x2160 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 1 -T 1 --vin-<span class="keywordtype">id</span> 17</div>
<div class="line">(Or board# test_efm -t 3 -i cap_raw_raw_3840x2160_3240_cpr_v1.raw -s 3240x2160 -e cap_raw_raw_ce_960x2160_812_cpr_v1.raw --ce-size 812x2160 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 1 -T 1 --vin-<span class="keywordtype">id</span> 24)  <span class="comment">// For CV3</span></div>
<div class="line">(Or board# test_efm -t 3 -i cap_raw_raw_3840x2160_3240_cpr_v2.raw -s 3240x2160 -e cap_raw_raw_ce_960x2160_812_cpr_v2.raw --ce-size 812x2160 --raw-format 1 -T 1 --vin-<span class="keywordtype">id</span> 25)  <span class="comment">// For CV3</span></div>
<div class="line">(Or board# test_efm -t 3 -i cap_raw_raw_3840x2160_3240_cpr_v3.raw -s 3240x2160 -e cap_raw_raw_ce_960x2160_812_cpr_v3.raw --ce-size 812x2160 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 1 -T 1 --vin-<span class="keywordtype">id</span> 26)  <span class="comment">// For CV3</span></div>
<div class="line">(Or board# test_efm -t 3 -i cap_raw_raw_3840x2160_3240_cpr_v4.raw -s 3240x2160 -e cap_raw_raw_ce_960x2160_812_cpr_v4.raw --ce-size 812x2160 --raw-format 1 -T 1 --vin-<span class="keywordtype">id</span> 27)  <span class="comment">// For CV3</span></div>
<div class="line">board# test_encode -A -h3840x2160 -e</div>
<div class="line">board# test_encode -A -s</div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr8"></a>
Example 8: Encode from RGB RAW with multiple channels: One source and two channels</h2>
<div class="fragment"><div class="line">board# init.sh --na; modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_dual_chan_single_input_raw_encode.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_dual_chan_single_input_raw_encode.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1)  <span class="comment">// For CV72</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv3_dual_chan_single_input_raw_encode.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --raw-capture 1 --enc-raw-rgb 1)  <span class="comment">// For CV3</span></div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_1920x1080_3840.raw -s 1920x1080 -T 1</div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_encode -A -s</div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr9"></a>
Example 9: One RAW encode and one physical sensor</h2>
<p >The Lua script can be found in <a href="../../script/one_efr_one_physical_sensor.lua" target="_blank"><b>here</b></a>. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg one_efr_one_physical_sensor.lua --raw-capture 1 --enc-raw-rgb 1 --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_1920x1080_3840.raw -s 1920x1080 -T 1 --vin-<span class="keywordtype">id</span> 14</div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr10"></a>
Example 10: Encode from RGB RAW: Input from HDR 2X RGB (RAW) file to VIN with custom virtual VIN mode</h2>
<p >Users must configure the corresponding HDR exposure parameters according to the shutter ratio of each sensor.<br  />
 Taking imx274 for example, if 1080p30/hdr2x mode is used, the first shutter ratio (rhs1) is fixed at 0x1D2, and hdr_short1_offset = rhs1 * 2 + 1 = 933.<br  />
 The Lua script can be found in <a href="../../script/1080p_hdr2x_efr.lua" target="_blank"><b>1080p_hdr2x_efr.lua</b></a>. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg 1080p_hdr2x_efr.lua.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1</div>
<div class="line">board# test_efm -t 3 -i cap_raw_imx274_1920x3092_1620_cpr.raw -s 1620x3092 -e cap_raw_imx274_ce_480x3092_408_cpr.raw --ce-size 408x3092 -R1 -T 1 --vin-<span class="keywordtype">id</span> 14</div>
<div class="line">(Or board# test_efm -t 3 -i cap_raw_imx274_1920x3092_1620_cpr.raw -s 1620x3092 -e cap_raw_imx274_ce_480x3092_408_cpr.raw --ce-size 408x3092 -R1 -T 1 --vin-<span class="keywordtype">id</span> 24) <span class="comment">// For CV3</span></div>
</div><!-- fragment --><h2><a class="anchor" id="example_efr11"></a>
Example 11: Encode from YUV NV12 RAW: Capture YUV(NV12) RAW from canvas then feed to EFR channel</h2>
<p >In order for ARM to have control over the memory, the captured canvas must be set to manual feed or external memory mode. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_dual_chan_one_sensor_one_yuv_efr.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-raw-nv12 1 <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_dual_chan_one_sensor_one_yuv_efr.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-raw-nv12 1) <span class="comment">// For CV72</span></div>
<div class="line">board# test_manual_feed -a0 -Q0 &amp;</div>
<div class="line">board# test_efm -t 6 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -V 14</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
