<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: BASIC - Privacy Mask</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/de1/fs_basic_pm.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASIC - Privacy Mask </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section_pm"></a>
1. Privacy Mask</h1>
<p >Privacy mask (PM) is used to block sensitive areas, covering them with opaque, single-color boxes, in both the preview and the encoded streams. Privacy mask is widely used for displays, keyboard sequences (such as passwords), and anywhere else where sensitive information needs to be kept invisible. It is possible to retrieve the blocked-out areas during the preview and encoding states.</p>
<p >Cooper family chips support privacy mask:</p><ul>
<li>The privacy mask take effect on the video input (VIN) domain.</li>
<li>The precision of the single-color privacy mask varies according to the different VIN / Main combinations.</li>
<li>The color of the single-color privacy mask can be changed to various Y / U / V combinations.</li>
</ul>
<p >Privacy mask affects all views from the preview (third / fourth / fifth buffer) and the encoded streams (main / second / third / fourth / fifth / seventh buffer).</p>
<dl class="section user"><dt>Configurable Color of Single-Color Privacy Mask</dt><dd>It is possible to set it to various Y / U / V combinations.</dd></dl>
<dl class="section user"><dt>Number of Mask Area</dt><dd>The number of masks is unlimited.</dd></dl>
<dl class="section user"><dt>Size of Mask Area</dt><dd>The maximum size of masks is up to the VIN size.</dd></dl>
<p>In privacy mask design, the concept of three domains need to be clear, including VIN domain, main domain, and PM domain. "VIN domain" is the whole VIN capture window, "main domain" is Main source buffer output window, and "PM domain" is the window that finally draws PM in memory. When users need to draw PM, only coordinates and sizes on the "Main domain" are specified. But actually, it needs to be converted to the coordinates and sizes on the "PM domain". In most cases, "PM domain" and "Main domain" are the same size. In particular, if there is rotate or flip enabled, "PM domain" needs to be converted from "Main domain". For example, in the case of rotate, the width and height of "PM domain" are the height and width of "Main domain". The usual way to deal with PM, PM coordinate and size convert is "Main domain" -&gt;"VIN domain" -&gt; "PM domain".</p>
<div class="image">
<img src="../../VIN_Main_PM_domain.JPG" alt=""/>
<div class="caption">
Figure 1-1. VIN, Main, and PM Domain Conversion Diagram.</div></div>
<p ><br  />
</p>
<hr  />
<h1><a class="anchor" id="section_sc_pm_examples"></a>
2. Privacy Mask Examples</h1>
<h2><a class="anchor" id="example_pm1"></a>
Example 1: Add Two Privacy Masks</h2>
<p >Add two privacy mask areas (x 100, y 100, width 256, height 256), (x 400, y 200, width 128, height 64) to 1080p. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_privacymask -c 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 100 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 100 -w 256 -h 256</div>
<div class="line">board# test_privacymask -c 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 400 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 200 -w 128 -h 64</div>
<div class="line">board# test_encode -A -h 1080p -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -e</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a></div><div class="ttdeci">u32 y</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a></div><div class="ttdeci">u32 x</div></div>
</div><!-- fragment --> <div class="image">
<img src="../../ut_single_color_mask_set.jpg" alt=""/>
<div class="caption">
Figure 2-1. Privacy Mask Setting.</div></div>
<h2><a class="anchor" id="example_pm2"></a>
Example 2: Remove One Small Mask Area from Privacy Mask Region</h2>
<p >Remove a privacy mask area (x 164, y 164, width 128, height 128) from the privacy mask region (x 100, y 100, width 256, height 256). </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_privacymask -c 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 100 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 100 -w 256 -h 256</div>
<div class="line">board# test_privacymask -c 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 164 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 164 -w 128 -h 128 -d</div>
<div class="line">board# test_encode -A -h 1080p -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -e</div>
</div><!-- fragment --> <div class="image">
<img src="../../ut_single_color_mask_remove.jpg" alt=""/>
<div class="caption">
Figure 2-2. Privacy Mask: Remove a Privacy Mask Area.</div></div>
<h2><a class="anchor" id="example_pm3"></a>
Example 3: Insert Circular Inner Privacy Mask</h2>
<p >Insert circular inner privacy mask, circle center point is (960, 540), the radius is 544. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_privacymask -c 0 --<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gae67b61333a94d3463cc7edc50ddc4c76">radius</a> 544 -C 960x540</div>
<div class="ttc" id="agroup__IAV_html_gae67b61333a94d3463cc7edc50ddc4c76"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gae67b61333a94d3463cc7edc50ddc4c76">radius</a></div><div class="ttdeci">u16 radius</div></div>
</div><!-- fragment --> <div class="image">
<img src="../../ut_single_color_circular_inner_mask.jpg" alt=""/>
<div class="caption">
Figure 2-3. Single-Color Privacy Mask: Insert Circular Inner Privacy Mask.</div></div>
<h2><a class="anchor" id="example_pm4"></a>
Example 4: Insert Circular Outer Privacy Mask</h2>
<p >Insert circular outer privacy mask, circle center point is (960, 540), the radius is 544. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_privacymask -c 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 0 -w 1920 -h 1080</div>
<div class="line">board# test_privacymask -c 0 --<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gae67b61333a94d3463cc7edc50ddc4c76">radius</a> 544 -C 960x540 -d</div>
</div><!-- fragment --> <div class="image">
<img src="../../ut_single_color_circular_outer_mask.jpg" alt=""/>
<div class="caption">
Figure 2-4. Single-Color Privacy Mask: Insert Circular Outer Privacy Mask.</div></div>
<h2><a class="anchor" id="example_pm5"></a>
Example 5: Insert Triangle Privacy Mask</h2>
<p >Insert triangle privacy mask, triangle vertex is (300, 500), (1000, 900), (1500, 400). </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_privacymask -c 0 --<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">vertex</a> 300x500 --<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">vertex</a> 1000x900 --<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">vertex</a> 1500x400</div>
<div class="ttc" id="agroup__IAV_html_ga53f15e4c2732990e33c4bbdbb60ae318"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">vertex</a></div><div class="ttdeci">struct iav_point vertex[MAX_POLYGON_VERTICE_NUM]</div></div>
</div><!-- fragment --> <div class="image">
<img src="../../ut_single_color_Triangle_mask.jpg" alt=""/>
<div class="caption">
Figure 2-5. Single-Color Privacy Mask: Insert Triangle Privacy Mask.</div></div>
<h2><a class="anchor" id="example_pm6"></a>
Example 6: Insert Quadrilateral Privacy Mask</h2>
<p >Insert quadrilateral privacy mask, quadrilateral vertex is (200, 300), (150, 500), (800, 600), (1000, 400). </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_privacymask -c 0 --<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">vertex</a> 200x300 --<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">vertex</a> 150x500 --<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">vertex</a> 800x600 --<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">vertex</a> 1000x400</div>
</div><!-- fragment --> <div class="image">
<img src="../../ut_single_color_Quadrilateral_mask.jpg" alt=""/>
<div class="caption">
Figure 2-6. Single-Color Privacy Mask: Insert Quadrilateral Privacy Mask.</div></div>
<h2><a class="anchor" id="example_pm7"></a>
Example 7: Insert canvas domain PM to support cross-channel stitching case</h2>
<p >For this use case, users can easily specify the PM offset and size in canvas domain through <code>test_privacymask</code>. The PM can cover the areas from one or multiple channels.</p>
<p >When the PM areas cross multiple channels, <code>test_privacymask</code> will convert the coordinates of the canvas domain to the coordinates of the main buffer for each channel. Comparing with the use experience where users need to manually calculate the coordinates of PM for each channel, this method is much easier to configure.</p>
<p >For example, to add one privacy mask area (x 2600, y 500, width 1000, height 900)</p>
<p >The Lua script can be found <a href="../../script/cv5_4_vin_4k_main_horizonal_stitch_rotate_hvf.lua" target="_blank"><b>here</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe ambrg;modprobe max9296 <span class="keywordtype">id</span>=0x0303 vinc_id=0xb8;modprobe os08a10_mipi_brg fsync=1</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg ./cv5_4_vin_4k_main_horizonal_stitch_rotate_hvf.lua\</div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -H 5120x1568 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -e</div>
<div class="line">board# test_sensor_calib --mode 2 --<a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>-num 4 -f ./</div>
<div class="line">board# test_stitch --mode 2 -f /root --<a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>-rotate-cw --hflip --vflip</div>
<div class="line">board# test_stitch --mode 3 --overlap 0 --top 30,0 --bottom 30,2880 --overlap 1 --top 30,0 --bottom 30,2880\</div>
<div class="line">                   --overlap 2 --top 30,0 --bottom 30,2880</div>
<div class="line">board# test_privacymask -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 2600 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 500 -w 1000 -h 900 -Y 112 -U 72 -V 58</div>
<div class="line">board# test_privacymask -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 --disable</div>
<div class="ttc" id="avin__init_8c_html_adf7dff2c57c0da9a4a2b70e3e815be31"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a></div><div class="ttdeci">int channel</div><div class="ttdef"><b>Definition:</b> vin_init.c:56</div></div>
</div><!-- fragment --> <div class="image">
<img src="../../ut_single_color_canvas_domain_mask.jpg" alt=""/>
<div class="caption">
Figure 2-7. Single-Color Privacy Mask: Insert Canvas domain Privacy Mask.</div></div>
<h2><a class="anchor" id="example_pm8"></a>
Example 8: Clear All Privacy Masks</h2>
<div class="fragment"><div class="line">board# test_privacymask -c 0 --disable</div>
</div><!-- fragment --><h2><a class="anchor" id="example_pm9"></a>
Example 9: Fill Warp Frame Border Artifact</h2>
<p >When using LDC, the frame border may get some repeat artifacts. Users can fill and cover it with privacy mask. According to the DSP warp pipeline behavior, privacy mask will be processed after H-Warp and before V-Warp. As the H-warp edge is different in different warp case, the H-warp edge mask is needed, then privacy mask can fill the repeat artifact with the mask. The LDC example case shows as below: </p><div class="fragment"><div class="line">board# init.sh --imx274_mipi</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --lens-warp 1  --max-vwarp-blk-<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> 64</div>
<div class="line">board# test_ldc -c 0 -F 60 -R 524 -m 1 -z 1.7 --rotate 10</div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a></div><div class="ttdeci">u32 height</div></div>
</div><!-- fragment --> <div class="image">
<img src="../../ut_frame_border_artifact.png" alt=""/>
<div class="caption">
Figure 2-8. Frame Border Artifact.</div></div>
<p >Prepare the mask YUV. In mask YUV, border can be filled with black(0) and others can be filled with white(255). Then feed this mask YUV as VIN by using feature EFR <a class="el" href="../../d3/dff/fs_adv_efr.html#example_efr5">Example 5: Encode from YUV NV12 RAW: YUV NV12 (RAW) to VIN</a>. Capture the H-Warp only YUV for final mask. Run the LDC case again and using test_privacymask with final mask YUV. </p><div class="fragment"><div class="line">board# init.sh --na</div>
<div class="line">board# modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear_efr_yuv.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-nv12 1 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --lens-warp 1  --max-vwarp-blk-<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> 64 <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear_efr_yuv.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-nv12 1 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1) --lens-warp 1  --max-vwarp-blk-<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> 64 <span class="comment">// For CV72</span></div>
<div class="line">board# test_efm -t 4 -s 1920x1080 -i frame.yuv -T 1</div>
<div class="line">board# test_ldc -c 0 -F 60 -R 524 -m 1 -z 1.7 --rotate 10 --v-disable</div>
<div class="line">board# test_yuvcap -b 0 -Y -f mask.yuv</div>
<div class="ttc" id="acJSON_8h_html_a788db922597cf2fb6389e278f822e59f"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a></div><div class="ttdeci">const char *const const char *const raw</div></div>
</div><!-- fragment --><div class="image">
<img src="../../ut_original_mask_yuv.png" alt=""/>
<div class="caption">
Figure 2-9. Original Mask YUV.</div></div>
<div class="image">
<img src="../../ut_mask_yuv_with_h_warp.png" alt=""/>
<div class="caption">
Figure 2-10. Mask YUV with H-Warp.</div></div>
<div class="fragment"><div class="line">board# test_privacymask -c 0 --mask-file mask.yuv</div>
</div><!-- fragment --> <div class="image">
<img src="../../ut_frame_border_pm.png" alt=""/>
<div class="caption">
Figure 2-11. Fill Frame Border Privacy Mask with Mask YUV.</div></div>
<dl class="section note"><dt>Note</dt><dd>This feature can only be used in LDC warp case not for multi-region warp case. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
