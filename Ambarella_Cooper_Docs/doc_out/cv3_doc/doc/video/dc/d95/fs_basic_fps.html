<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: BASIC - Frame Rate</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dc/d95/fs_basic_fps.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASIC - Frame Rate </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section_fps_features"></a>
1. Frame Rate</h1>
<p >Each processing stage can have a different frame rate. The variance in the frame rate can occur in any of the following components.</p>
<div class="image">
<img src="../../frame_rate_at_stages.png" alt=""/>
<div class="caption">
Figure 1-1. Frame Rate at Different Stages.</div></div>
 <dl class="section user"><dt>VIN fps</dt><dd>Each sensor can be configured at different frame rate. The video input (VIN) frames per second (fps) are used as the input frame rate for VIN stage inside digital signal processor (DSP).</dd></dl>
<dl class="section user"><dt>RAW fps</dt><dd>At VIN stage, it can output different frame rates for RAW data from VIN fps. The RAW fps must be no larger than VIN fps, which means that VIN can choose to skip sending RAW data to dynamic random access memory (DRAM). This can save DRAM bandwidth for RAW data. Normally, RAW fps is equal to VIN fps. But it may be different for some scenarios, such as scale or region of interest (ROI) VIN cases. For scale or ROI VIN cases, it may possibly generate multiple RAW data from the same sensor input frame.</dd></dl>
<dl class="section user"><dt>Channel fps (or IDSP fps)</dt><dd>For each processing channel, the output frame rate (image digital signal processing (IDSP) fps) can vary from the input frame rate (RAW fps). This frame rate can be larger or smaller than the original RAW fps. When it is larger than RAW fps, IDSP periodically generates intermediated frames. When the rate is smaller than RAW fps, IDSP periodically skips RAW frames.</dd></dl>
<dl class="section user"><dt>Canvas fps</dt><dd>Each canvas can have a different frame rate. The input fps for the canvas is its channel IDSP fps, and the output fps is the canvas fps. The output fps can be equal to or smaller than the channel IDSP fps. IDSP periodically skips frames to generate smaller canvas fps out of the channel IDSP fps.</dd></dl>
<dl class="section user"><dt>Pyramid fps</dt><dd>If manual feeding is not used, the pyramid fps should have the same frame rate as the channel IDSP fps. If manual feeding is used, the pyramid fps is dependent on Arm's feeding speed (up to the channel IDSP fps).</dd></dl>
<dl class="section user"><dt>Stream fps</dt><dd>The stream fps is the actual encoding frame rate, and its input frame rate is canvas fps. The stream fps can be equal to or smaller than its input canvas frame rate. Users can use the frame factor (based on the canvas fps) to specify the stream fps. Video digital signal processor (VDSP) periodically skips frames to generate the smaller stream fps. Users can also use <code>stream-abs-fps-enable</code> and <code>stream-abs-fps</code> option to enable a fixed smaller stream fps.</dd></dl>
<dl class="section user"><dt>VOUT fps </dt><dd>The video output (VOUT) fps is the actual VOUT display output frame rate, and its input frame rate is canvas fps. The VOUT fps can be larger or smaller than its input canvas fps. When VOUT fps is smaller than its input canvas fps, VOUT will periodically skips frames to meet the fps for the actual display device. When VOUT fps is larger than its input canvas fps, VOUT will display repeated frames periodically to meet the fps for the actual display device.</dd></dl>
<a class="anchor" id="table_fps_comparison"></a>
<table class="doxtable">
<caption>Table 1-1. Different fps Comparison.</caption>
<tr>
<th>fps type </th><th>Stage </th><th>Input fps </th><th>fps Up-Sample </th><th>fps Down-Sample </th><th>Description </th></tr>
<tr>
<td>VIN fps </td><td>VIN input </td><td>Sensor fps </td><td>No </td><td>No </td><td>The same as sensor output fps. </td></tr>
<tr>
<td>RAW fps </td><td>VIN output </td><td>VIN fps </td><td>No </td><td>Yes </td><td>No larger than VIN fps, achieved by dropping frames periodically. </td></tr>
<tr>
<td>Channel fps </td><td>IDSP input </td><td>RAW fps </td><td>Yes, up to 3.99x </td><td>Yes </td><td>No limit for down-sample rate. </td></tr>
<tr>
<td>Canvas fps </td><td>IDSP output </td><td>Channel fps </td><td>No </td><td>Yes </td><td>No limit for down-sample rate. </td></tr>
<tr>
<td>Pyramid fps </td><td>IDSP output </td><td>Channel fps </td><td>No </td><td>No </td><td>fps down-sample possible with pyramid manual feed. </td></tr>
<tr>
<td>Stream fps </td><td>VDSP input </td><td>Canvas fps </td><td>No </td><td>Yes </td><td>No limit for down-sample rate. </td></tr>
<tr>
<td>VOUT fps </td><td>VOUT output </td><td>Canvas fps </td><td>Yes </td><td>Yes </td><td>Decided by the display configuration. </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>For frame rates across different stages, more descriptions / limitations are listed as followsï¼š<ul>
<li>Each VIN / sensor can have a different fps.</li>
<li>Each RAW (VIN output) can have a different fps.</li>
<li>Each channel can have a different IDSP fps.</li>
<li>Each canvas can have a different fps.</li>
<li>When putting source buffers from different channels / passes into the same canvas, all these source buffers should have the same fps, which should be equal to the final canvas fps.</li>
</ul>
</dd></dl>
<hr  />
<h1><a class="anchor" id="hp_fps"></a>
2. High Precision Frame Rate</h1>
<h2><a class="anchor" id="hp_fps_intro"></a>
2.1 Introduction</h2>
<p >The image audio video (IAV) module introduces the feature of high precision fps to express VIN, IDSP and canvas framerate. It is to support decimal fps like 0.5 or 7.5. By default, this feature is <b>disabled</b>. IAV can only support integral fps.</p>
<p >High precision fps is expressed by "hp_fps = real_fps * 1000", where hp_fps is high precision fps, real_fps is real fps.</p>
<p >For example, "hp_fps = 500" represents 0.5 fps, "hp_fps = 7500" represents 7.5 fps.</p>
<h2><a class="anchor" id="hp_fps_enable"></a>
2.2 Enable High Precison Frame Rate</h2>
<p >There are two methods to enable high precision frame rate.</p><ul>
<li>IOCTL: IAV_IOC_SET_SYSTEM_RESOURCE with "enable_hp_fps" member in struct <a class="elRef" href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a></li>
<li>Lua scripts as below: <div class="fragment"><div class="line">_resource_config_ = {</div>
<div class="line">    version = 1,</div>
<div class="line">    log_level = 0, -- 0: error; 1: warning; 2: info; 3: debug</div>
<div class="line">    enable_hp_fps = 1 ,</div>
<div class="line">...</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="hp_fps_apply"></a>
2.3 Using High Precison Frame Rate</h2>
<p >When this flag is enabled, IAV will accept a frame rate value from structure high precision member (with suffix "_hp") not normal frame rate member. The related structures show as below:</p><ul>
<li><a class="elRef" href="../../../library/dc/d8b/structiav__pyramid__cfg.html">iav_pyramid_cfg</a> <b>(frame_rate, frame_rate_hp)</b><br  />
Related IOCTL: <a class="elRef" href="../../../library/d8/dc4/group__iav-ioc-enc-use-sys.html#ga112d2232182ca4cbcb0f8271d23a4fa6">IAV_IOC_SET_PYRAMID_CFG</a>, <a class="elRef" href="../../../library/d8/dc4/group__iav-ioc-enc-use-sys.html#gae6895f70e85c2580ff95c0cdb0337046">IAV_IOC_GET_PYRAMID_CFG</a></li>
<li><a class="elRef" href="../../../library/da/d94/structiav__canvas__fps.html">iav_canvas_fps</a> <b>(frame_rate, frame_rate_hp)</b><br  />
Related IOCTL: <a class="elRef" href="../../../library/d6/d04/group__iav-ioc-enc-use-vproc.html#ga292744aeb723e757e22b4db1267ade62">IAV_IOC_GET_VIDEO_PROC</a>, <a class="elRef" href="../../../library/d6/d04/group__iav-ioc-enc-use-vproc.html#gaa1f0d246dded6ae7a235d897dfbffbaa">IAV_IOC_CFG_VIDEO_PROC</a></li>
<li><a class="elRef" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> <b>(frame_rate, frame_rate_hp)</b><br  />
Related IOCTL: <a class="elRef" href="../../../library/d8/dc4/group__iav-ioc-enc-use-sys.html#ga4f47a13420349fa19f760c570b38bd99">IAV_IOC_GET_SYSTEM_RESOURCE</a>, <a class="elRef" href="../../../library/d8/dc4/group__iav-ioc-enc-use-sys.html#gad18932d05335187d9020f88d3cd5d700">IAV_IOC_SET_SYSTEM_RESOURCE</a></li>
<li><a class="elRef" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> <b>(idsp_fps, idsp_fps_hp)</b><br  />
Related IOCTL: <a class="elRef" href="../../../library/d8/dc4/group__iav-ioc-enc-use-sys.html#ga4f47a13420349fa19f760c570b38bd99">IAV_IOC_GET_SYSTEM_RESOURCE</a>, <a class="elRef" href="../../../library/d8/dc4/group__iav-ioc-enc-use-sys.html#gad18932d05335187d9020f88d3cd5d700">IAV_IOC_SET_SYSTEM_RESOURCE</a></li>
<li><a class="elRef" href="../../../library/d9/d3a/structiav__stream__fps.html">iav_stream_fps</a> <b>(abs_fps, abs_fps_hp)</b><br  />
Related IOCTL: <a class="elRef" href="../../../library/da/dd7/group__iav-ioc-enc-use-stm.html#gae0f6b990deba42b82cb72e4b1ff19b78">IAV_IOC_SET_STREAM_CONFIG</a>, <a class="elRef" href="../../../library/da/dd7/group__iav-ioc-enc-use-stm.html#ga941dd81045866aef004f05f5966a885d">IAV_IOC_GET_STREAM_CONFIG</a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>IAV will always report the frame rate to both high precision and normal frame rate member, whether the "high
precision enable" flag is enabled or not. For example, when querying system resource through <a class="elRef" href="../../../library/d8/dc4/group__iav-ioc-enc-use-sys.html#ga4f47a13420349fa19f760c570b38bd99">IAV_IOC_GET_SYSTEM_RESOURCE</a>, users can always get valid values in the structure <a class="elRef" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> (idsp_fps = 30, idsp_fps_hp = 30000).</dd></dl>
<hr  />
<h1><a class="anchor" id="framerate_example"></a>
3. Frame Rate Examples</h1>
<h2><a class="anchor" id="example_fps1"></a>
Example 1: fps suggestion</h2>
<p >This tool is used to query encode frame rate through the "fps suggestion" function, and obtain the proper fps for the encoded stream for encoding.</p>
<p >The following example uses chip CV5S66.<br  />
 </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /cv5_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua -A --smax 3840x2160 -h 3840x2160 -B --smax 3840x2160 -h 3840x2160 -C --smax 3840x2160 -h 3840x2160 --frame-factor 1/30 -D --smax 3840x2160 -h 3840x2160 -E --smax 3840x2160 -h 3840x2160 -S5 --smax 3840x2160 -h 3840x2160 --max-stream-num 6</div>
<div class="line">board# test_fps_suggest -A -f 30 --&gt; <span class="stringliteral">&quot;-f 30&quot;</span> mean target fps <span class="keywordflow">for</span> <span class="keyword">this</span> stream</div>
<div class="line">Suggested stream [0], fps [22]</div>
<div class="line">Suggested stream [1], fps [22]</div>
<div class="line">Suggested stream [2], fps [1]</div>
<div class="line">Suggested stream [3], fps [22]</div>
<div class="line">Suggested stream [4], fps [22]</div>
<div class="line">Suggested stream [5], fps [21]</div>
<div class="line">board# test_fps_suggest -A -f 30 -k 1 --&gt; <span class="stringliteral">&quot;-k 1&quot;</span> mean keep fps <span class="keywordflow">for</span> <span class="keyword">this</span> stream, <span class="stringliteral">&quot;-f 30&quot;</span> mean target fps <span class="keywordflow">for</span> <span class="keyword">this</span> stream</div>
<div class="line">Fixed stream [0], fps [30]</div>
<div class="line">Suggested stream [1], fps [20]</div>
<div class="line">Suggested stream [2], fps [1]</div>
<div class="line">Suggested stream [3], fps [20]</div>
<div class="line">Suggested stream [4], fps [20]</div>
<div class="line">Suggested stream [5], fps [19]</div>
<div class="line">board# test_fps_suggest -A -e 1 -B -e 1 -C -e 1 --&gt; <span class="stringliteral">&quot;-e 1&quot;</span> mean excldue currect stream</div>
<div class="line">Suggested stream [0], fps [0]</div>
<div class="line">Suggested stream [1], fps [0]</div>
<div class="line">Suggested stream [2], fps [0]</div>
<div class="line">Suggested stream [3], fps [30]</div>
<div class="line">Suggested stream [4], fps [30]</div>
<div class="line">Suggested stream [5], fps [30]</div>
<div class="line">board# test_fps_suggest -V 8 -t 25 --&gt; <span class="stringliteral">&quot;-V 8&quot;</span> mean set vin ID, <span class="stringliteral">&quot;-t 25&quot;</span> mean set input fps <span class="keywordflow">for</span> the vin</div>
<div class="line">Suggested stream [0], fps [25]</div>
<div class="line">Suggested stream [1], fps [25]</div>
<div class="line">Suggested stream [2], fps [22]</div>
<div class="line">Suggested stream [3], fps [25]</div>
<div class="line">Suggested stream [4], fps [25]</div>
<div class="line">Suggested stream [5], fps [25]</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /cv5_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua -A --smax 3840x2160 -h 3840x2160 -B --smax 3840x2160 -h 3840x2160 -C --smax 3840x2160 -h 3840x2160 --frame-factor 1/30 -D --smax 3840x2160 -h 3840x2160 -E --smax 3840x2160 -h 3840x2160 -S5 --smax 3840x2160 -m 3840x2160 --max-stream-num 6</div>
<div class="line">board# test_fps_suggest -A -k 1</div>
<div class="line">Fixed stream [0], fps [30]</div>
<div class="line">Suggested stream [1], fps [26]</div>
<div class="line">Suggested stream [2], fps [1]</div>
<div class="line">Suggested stream [3], fps [26]</div>
<div class="line">Suggested stream [4], fps [26]</div>
<div class="line">Suggested stream [5], fps [21]</div>
</div><!-- fragment --><h2><a class="anchor" id="example_high_precision_fps"></a>
Example 2: High Precision fps</h2>
<p >This feature allows the user to set non-integer VIN fps. With "enable_hp_fps" option, the IAV can set arbitrary fps. For more details, refer to <a href="../../script/vin0_4k_linear_hps.lua" target="_blank"><b>vin0_4k_linear_hps.lua</b></a>. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg vin0_4k_linear_hps.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_canvas_zero_fps"></a>
Example 3: Canvas Zero fps</h2>
<p >See <a class="el" href="../../d6/d71/fs_basic_canvas.html#example_runtime_update_canvas_fps">Example 3: Update Canvas Framerate at Runtime</a> for this feature.</p>
<h2><a class="anchor" id="example_stream_abs_fps"></a>
Example 4: Stream Absolute fps</h2>
<p >When the VIN fps is changed, the user wants to keep the stream fps stable. With <code>stream-abs-fps-enable</code> and <code>stream-abs-fps</code> options, stream fps can keep unchanged.</p>
<div class="fragment"><div class="line">(terminal 1)</div>
<div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/local/bin/scripts/cv5_vin0_4k_linear.lua  --vout-cfg /usr/local/bin/scripts/vout_hdmi.lua</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 --stream-abs-fps-enable 1 --stream-abs-fps 15 -e  -&gt; enable abs fps <span class="keywordflow">for</span> stream A</div>
<div class="line"> </div>
<div class="line">(terminal 2)</div>
<div class="line">board# test_stream --no</div>
<div class="line">.....</div>
<div class="line">stream A:   4200 frames, 15.00 fps,          175975810      bytes,  4682 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">stream A:       4230 frames, 15.00 fps,          177176542      bytes,  4690 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">stream A:       4260 frames, 15.00 fps,          178390041      bytes,  4740 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">stream A:       4290 frames, 15.00 fps,          179574833      bytes,  4627 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">stream A:       4320 frames, 15.00 fps,          180785629      bytes,  4729 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">stream A:       4350 frames, 15.00 fps,          181990192      bytes,  4705 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">stream A:       4380 frames, 15.00 fps,          183177827      bytes,  4639 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">stream A:       4410 frames, 15.00 fps,          184383976      bytes,  4711 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">stream A:       4440 frames, 15.00 fps,          185569105      bytes,  4629 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">stream A:       4470 frames, 15.00 fps,          186767130      bytes,  4679 kbps, enc_pipe_time [ 1190:10145]</div>
<div class="line">AVG FPS = 15.00 fps</div>
<div class="line">.....</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --><p >Change the VIN fps, the stream fps is unchanged.</p>
<div class="fragment"><div class="line">(terminal 1)</div>
<div class="line">board# test_vin -S 0 -f 25</div>
<div class="line"> </div>
<div class="line">(terminal 2)</div>
<div class="line">.....</div>
<div class="line">stream A:   1200 frames, 15.00 fps,           53554563      bytes,  5573 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">stream A:       1230 frames, 15.00 fps,           54921295      bytes,  5338 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">stream A:       1260 frames, 15.00 fps,           56216080      bytes,  5057 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">stream A:       1290 frames, 15.00 fps,           57500004      bytes,  5015 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">stream A:       1320 frames, 15.00 fps,           58759789      bytes,  4921 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">stream A:       1350 frames, 15.00 fps,           60013455      bytes,  4896 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">stream A:       1380 frames, 15.00 fps,           61239816      bytes,  4790 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">stream A:       1410 frames, 15.00 fps,           62462869      bytes,  4777 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">stream A:       1440 frames, 15.00 fps,           63690188      bytes,  4793 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">stream A:       1470 frames, 15.00 fps,           64911792      bytes,  4771 kbps, enc_pipe_time [ 1197: 8352]</div>
<div class="line">AVG FPS = 15.00 fps</div>
<div class="line">.....</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The IAV requests that the input fps cannot be smaller than stream abs fps. If the encoding input fps is smaller than the target fps, the real fps of the encoding stream will be the same as the input fps.</dd></dl>
<hr  />
<h2><a class="anchor" id="example_raw_fps"></a>
Example 5: RAW fps</h2>
<p >Modify the Lua file for RAW fps, set VIN fps to 30, RAW fps and IDSP fps to 15: </p><div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">    ...</div>
<div class="line">    fps = 30,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">chan_0 = {</div>
<div class="line">    ...</div>
<div class="line">    raw_fps = 15,</div>
<div class="line">    idsp_fps = 15,</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p >The Lua script can be found at <a href="../../script/raw_fps.lua" target="_blank"><b>raw_fps.lua</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3   <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)       <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg ./raw_fps.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_raw_fps_scale_roi_vin"></a>
Example 6: Set different RAW fps for scale VIN and ROI VIN</h2>
<p >Users can set different RAW fps for scale VIN and ROI VIN. Modify the Lua file: </p><div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">    ...</div>
<div class="line">    mode = <span class="stringliteral">&quot;3840x2160&quot;</span>,</div>
<div class="line">    fps = 30,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a12db301b040a15818f8d32874c312444">scale_type</a> = 1,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a176c02d2b75755d0b35b7da5721cdf95">roi_enable</a> = 1,</div>
<div class="line">    roi_list = {</div>
<div class="line">          {</div>
<div class="line">              <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a> = {0, 0, 0 ,0},</div>
<div class="line">          },</div>
<div class="line">          {</div>
<div class="line">              <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a> = {0, 0, 1920 ,1080},</div>
<div class="line">          },</div>
<div class="line">          {</div>
<div class="line">              <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a> = {960, 540, 1920 ,1080},</div>
<div class="line">          },</div>
<div class="line">    },</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">chan_0 = {</div>
<div class="line">    ...</div>
<div class="line">    vin_roi_idx = 0, -- use scale VIN</div>
<div class="line">    raw_fps = 15,</div>
<div class="line">    idsp_fps = 5,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">chan_1 = {</div>
<div class="line">    ...</div>
<div class="line">    vin_roi_idx = 1, -- use roi VIN</div>
<div class="line">    raw_fps = 25,</div>
<div class="line">    idsp_fps = 25,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">chan_2 = {</div>
<div class="line">    ...</div>
<div class="line">    vin_roi_idx = 2,  -- use roi VIN</div>
<div class="line">    raw_fps = 30,</div>
<div class="line">    idsp_fps = 20,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="avin__init_8c_html_a12db301b040a15818f8d32874c312444"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a12db301b040a15818f8d32874c312444">scale_type</a></div><div class="ttdeci">int scale_type</div><div class="ttdef"><b>Definition:</b> vin_init.c:77</div></div>
<div class="ttc" id="avin__init_8c_html_a176c02d2b75755d0b35b7da5721cdf95"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a176c02d2b75755d0b35b7da5721cdf95">roi_enable</a></div><div class="ttdeci">int roi_enable</div><div class="ttdef"><b>Definition:</b> vin_init.c:79</div></div>
<div class="ttc" id="avin__init_8c_html_a862801bf1c46afaea9487ade7f767b66"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a></div><div class="ttdeci">struct iav_rect roi_win[IAV_MAX_VIN_ROI_NUM]</div><div class="ttdef"><b>Definition:</b> vin_init.c:83</div></div>
</div><!-- fragment --><p >The Lua script can be found at <a href="../../script/cv72_scale_crop_vin_raw_fps.lua" target="_blank"><b>cv72_scale_crop_vin_raw_fps.lua</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=0   <span class="comment">// Scale VIN only supported on CV72 with VIN0.</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg ./cv72_scale_crop_vin_raw_fps.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="exampe_update_vin_fps"></a>
Example 7: Update VIN fps on the fly</h2>
<p >VIN framerate can be updated on the fly. <code>test_vin</code> option "-f" is used to specify the new framerate, and option "S" is used to specify vsrc_id when there are multi VINs.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3   <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)       <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/local/bin/scripts/cv5_vin0_4k_linear.lua  --vout-cfg /usr/local/bin/scripts/vout_hdmi.lua</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_vin -S 0 -f 25                                   <span class="comment">// Update VIN framerate of vsrc 0 to 25</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
