<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: BASIC - Blur on Streams</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dd/d39/fs_basic_blur.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASIC - Blur on Streams </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section_blur"></a>
1. Blur on Streams</h1>
<p >In some particular situation, users may need to apply mosaic effect ROI areas on streams. For example, users may need to draw mosaic on human face to avoid the potential legal issue. Or there are some privacy regions on the stream need to be protected. It is supported to insert blur areas into streams. Once blur areas are inserted, the object will be so severely blurred that it cannot be recognized anymore.</p>
<p >There are two kinds of blur modes. One is the normal blur which provides the standard rectangle blur area according to the provided size and coordinates. The other is the arbitrary blur, which allows users to customize their blur area shapes through changing specified blur area memory.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Users should allocate continuous memory allocator (CMA) memory part (<b>IAV_PART_BLUR</b>) for blur. For arbitrary blur, the user needs to allocate one more CMA memory part (<b>IAV_PART_ARB_BLUR</b>).</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="blur_lua_cfg"></a>
1.1 Blur Lua Configuration</h2>
<ul>
<li><p class="startli">Canvas Configuration <br  />
 Blur is inserted directly into the canvas. <a class="el" href="../../d8/dab/fs_adv_lua.html#lua_canvas_cfg">blur_enable</a> should be set for the canvas that will have a blur inserted. </p><div class="fragment"><div class="line">canvas = {</div>
<div class="line">   {</div>
<div class="line">       type = <span class="stringliteral">&quot;encode&quot;</span>,</div>
<div class="line">       size = {3840, 2160},</div>
<div class="line">       <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.main&quot;</span>,},</div>
<div class="line">       extra_dram_buf = 0,</div>
<div class="line">       blur_enable = 1,</div>
<div class="line">       max_blur_area_num = 0,</div>
<div class="line">   },</div>
<div class="line">},</div>
<div class="ttc" id="avin__init_8c_html_a07a87b2e6ed927503e2f95f119c9fc23"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a></div><div class="ttdeci">int source</div><div class="ttdef"><b>Definition:</b> vin_init.c:57</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>Blur is inserted directly into the canvas. Therefore, streams encoding from the same canvas will see the same blur effect. For example, if both stream A and B encode from the canvas with the main buffer, blur areas on stream A will also be shown on stream B, and vice versa. If both stream A and B insert blur, the last blur configuration will take effect.</li>
<li>Blur is based on canvas coordinate system instead of stream coordinate system. Blurred areas' position does not vary with stream offset changing. <div class="image">
<img src="../../example_blur_coordinate_system.png" alt=""/>
<div class="caption">
Figure 1-1. Blur is Based on Canvas Coordinate System.</div></div>
</li>
</ul>
</dd></dl>
</li>
<li><p class="startli">Pyramid Configuration <br  />
 At least one pyramid layer should be enabled as pyramid is used to accomplish different blur strength. </p><div class="fragment"><div class="line">pyramid = {</div>
<div class="line">   input_buf_id = 0, -- 0: Main, 1: Second, 2: Third, 3: Fourth, 4: Fifth</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a12db301b040a15818f8d32874c312444">scale_type</a> = 1,       -- 0: 1/sqrt(2); 1: 1/2; 2: Arbitrary size</div>
<div class="line">   ...</div>
<div class="line">   layer_map = 0x70,</div>
<div class="line">   layers = {</div>
<div class="line">      {</div>
<div class="line">         crop_win = {0, 0, 0 ,0},</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         crop_win = {0, 0, 0 ,0},</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         crop_win = {0, 0, 0 ,0},</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         crop_win = {0, 0, 0 ,0},</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         crop_win = {0, 0, 0 ,0},</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         crop_win = {0, 0, 0 ,0},</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         crop_win = {0, 0, 0 ,0},</div>
<div class="line">      },</div>
<div class="line">   },</div>
<div class="line">},</div>
<div class="ttc" id="avin__init_8c_html_a12db301b040a15818f8d32874c312444"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a12db301b040a15818f8d32874c312444">scale_type</a></div><div class="ttdeci">int scale_type</div><div class="ttdef"><b>Definition:</b> vin_init.c:77</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>Pyramid manual-feed mode won't save DRAM bandwidth when blur is enabled.</li>
<li>Blur strength decides the pyramid layer used as blur source. Different blur areas in the same canvas must have the same strength. To set different blurriness for different objects in the same canvas, please use blur coefficients (See <a class="el" href="../../dd/d39/fs_basic_blur.html#example_blur_coeff_on_stream">Example 3: Apply Different Blur Coefficients on Stream</a>).</li>
<li>Each canvas support up to 16 blur regions. Total blur regions of all canvases cannot exceed 64. Too many blur regions will impact the image digital signal processing (IDSP) performance.</li>
</ul>
</dd></dl>
<p><br  />
</p>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="section_blur_example"></a>
2. Stream Blur Examples</h1>
<h2><a class="anchor" id="example_blur_on_stream"></a>
Example 1: Rectangle Blur on Stream A</h2>
<dl class="section user"><dt>Hardware and Software Environment</dt><dd></dd></dl>
<p>Please ensure that enough memory for blur is allocated. See the following notes.</p>
<dl class="section note"><dt>Note</dt><dd>Whenever users need to use the blur feature, it is required to allocate a memory partition in the CMA pool. By default, <b>IAV_PART_BLUR</b> partition size is 0. Users can allocate CMA memory part for blur via menuconfig.<br  />
 For Cooper SDK Amba Build: <div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; <span class="keyword">private</span></div>
<div class="line">            -&gt; vin</div>
<div class="line">               -*- ambvideo-header (drv_modules/<span class="keyword">private</span>/video/dsp_v6)</div>
<div class="line">                   (0x0600000) IAV Blur Buffer Size <span class="comment">//6M memory for blur area</span></div>
</div><!-- fragment --> For Cooper SDK Yocto Build: <div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-video</div>
<div class="line">                -&gt; ambvideo-header (meta-ambabsp/recipes-video/ambvideo-header)</div>
<div class="line">                   (0x0600000) IAV Blur Buffer Size <span class="comment">//6M memory for blur area</span></div>
</div><!-- fragment --> Alternatively, users are able to change the CMA partition size on the fly. <div class="fragment"><div class="line">board# test_mempart -m 30 -s 0x600000</div>
<div class="line">board# cat /proc/ambarella/cma</div>
<div class="line">mmb   phys[start-end]          size        virt[start-end]                        attr    buf_id      ref_cnt  dma_buf  <a class="code hl_function" href="../../db/d1a/test__vout__cfg_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a></div>
<div class="line">0     0x100000000-0x100404000  0x00404000  0xffffffc040000000-0xffffffc040404000  0x0003  21          0        0        <a class="code hl_variableRef" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa2e84b8119830cf9cf2a333d77624ac4e">IAV_PART_PREALLOC</a></div>
<div class="line">...   ...                      ...         ...                                    ...     ...         ...      ...      ...</div>
<div class="line">11    0x1C8D00000-0x1C9CC0000  0x00FC0000  0xffffffc108d00000-0xffffffc109cc0000  0x0008  6           0        0        <a class="code hl_variableRef" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa1fe3b6a4302777ead0b2987cfd9efced">IAV_PART_WARP</a></div>
<div class="line">14    0x1C9D00000-0x1D3D00000  0x0A000000  0xffffffc109d00000-0xffffffc113d00000  0x0008  9           0        0        <a class="code hl_variableRef" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa2819f76d7d531f88060b844ede1f5c48">IAV_PART_MASK</a></div>
<div class="line">19    0x1D3D00000-0x1D4300000  0x00600000  0xffffffc113d00000-0xffffffc114300000  0x0000  30          0        0        <a class="code hl_variableRef" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa902ffde491d07bfcca4629ea183176e0">IAV_PART_BLUR</a></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa1fe3b6a4302777ead0b2987cfd9efced"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa1fe3b6a4302777ead0b2987cfd9efced">IAV_PART_WARP</a></div><div class="ttdeci">IAV_PART_WARP</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa2819f76d7d531f88060b844ede1f5c48"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa2819f76d7d531f88060b844ede1f5c48">IAV_PART_MASK</a></div><div class="ttdeci">IAV_PART_MASK</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa2e84b8119830cf9cf2a333d77624ac4e"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa2e84b8119830cf9cf2a333d77624ac4e">IAV_PART_PREALLOC</a></div><div class="ttdeci">IAV_PART_PREALLOC</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa902ffde491d07bfcca4629ea183176e0"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa902ffde491d07bfcca4629ea183176e0">IAV_PART_BLUR</a></div><div class="ttdeci">IAV_PART_BLUR</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_ad96d407a911fbb914fa8e4cfbf2faf0f"><div class="ttname"><a href="../../db/d1a/test__vout__cfg_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a></div><div class="ttdeci">static void usage(void)</div><div class="ttdef"><b>Definition:</b> test_vout_cfg.c:42</div></div>
</div><!-- fragment --></dd></dl>
<p>Here are some example commands to enter preview and set up an AVC stream. The Lua script can be found <a href="../../script/blur.lua" target="_blank"><b>here</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg blur.lua</div>
<div class="line">board# test_encode -A -b 0 -h qfhd -e</div>
<div class="line">board# rtsp_server &amp;</div>
</div><!-- fragment --><dl class="section user"><dt>Translucent Blur</dt><dd>Mosaic can be applied to specified area(s) with specified color.</dd></dl>
<p>In order to apply color to the blur area, users must initialize a color table for stream blur. The length of the table is 16. Users can configure each entry in the color table with "-d" option.</p>
<div class="fragment"><div class="line">board# test_blur -d  0 -U 128 -V 128\</div>
<div class="line">                 -d  1 -U 118 -V 148\</div>
<div class="line">                 -d  2 -U 110 -V 180\</div>
<div class="line">                 -d  3 -U  90 -V 240\</div>
<div class="line">                 -d  4 -U  85 -V 198\</div>
<div class="line">                 -d  5 -U  71 -V 182\</div>
<div class="line">                 -d  6 -U  47 -V 150\</div>
<div class="line">                 -d  7 -U  45 -V 127\</div>
<div class="line">                 -d  8 -U  53 -V 104\</div>
<div class="line">                 -d  9 -U 139 -V  10\</div>
<div class="line">                 -d 11 -U 174 -V  11\</div>
<div class="line">                 -d 12 -U 202 -V  46\</div>
<div class="line">                 -d 13 -U 237 -V 148\</div>
<div class="line">                 -d 14 -U 220 -V 202\</div>
<div class="line">                 -d 15 -U 210 -V 227</div>
</div><!-- fragment --><p >In this test case, the color table is shown as below.</p>
<div class="image">
<img src="../../example_color_table.png" alt=""/>
<div class="caption">
Figure 2-1. Color Table.</div></div>
<p >Color of the blur area can be set with "--color-idx" option.</p>
<p >In this example, color of the blur area 0 is set to red. Color of the blur area 1 is set to blue.</p>
<div class="fragment"><div class="line">board# test_blur -A -a 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 500 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 600 -w 400 -h 500 --color-idx 3\</div>
<div class="line">             -a 1 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 2300 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 800 -w 512 -h 512 -t 2 --color-idx 13</div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a></div><div class="ttdeci">u32 y</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a></div><div class="ttdeci">u32 x</div></div>
</div><!-- fragment --><div class="image">
<img src="../../example_stream_blured.png" alt=""/>
<div class="caption">
Figure 2-2. Blur on Stream.</div></div>
<dl class="section user"><dt>Blocky Blur</dt><dd></dd></dl>
<p>Specify blocky blur through option "-b 1"</p>
<div class="fragment"><div class="line">board# test_blur -A -a 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 500 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 600 -w 400 -h 500 \</div>
<div class="line">                    -a 1 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 2300 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 800 -w 512 -h 512 -t 1 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 1</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --><div class="image">
<img src="../../example_stream_blocky_blur_v6.png" alt=""/>
<div class="caption">
Figure 2-3. Blocky Blur on Stream.</div></div>
<dl class="section user"><dt>Clear Blur Area</dt><dd></dd></dl>
<p>Also, all blurred areas can be cleared using the following command.</p>
<div class="fragment"><div class="line">board# test_blur -A -s</div>
</div><!-- fragment --><h2><a class="anchor" id="example_arbitrary_blur_on_stream"></a>
Example 2: Run Arbitrary Blur Demo</h2>
<dl class="section user"><dt>Hardware and Software Environment</dt><dd></dd></dl>
<p>Both IAV_PART_BLUR and IAV_PART_ARB_BLUR memory part are needed to be allocated. See the following notes.</p>
<dl class="section note"><dt>Note</dt><dd>Besides <b>IAV_PART_BLUR</b> memory partition, users need to allocate another memory partition <b>IAV_PART_ARB_BLUR</b> for arbitrary blur. Users can allocate CMA memory part for arbitrary blur via menuconfig<br  />
 For Cooper SDK Amba build: <div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; <span class="keyword">private</span></div>
<div class="line">             -&gt; vin</div>
<div class="line">                -*- ambvideo-header (drv_modules/<span class="keyword">private</span>/video/dsp_v6)</div>
<div class="line">                    (0x0100000) IAV Blur Buffer Size <span class="comment">//1M memory for blur area.</span></div>
<div class="line">                    (0x0500000) IAV Arbitrary Blur Buffer Size <span class="comment">//5M memory for arbitrary area.</span></div>
</div><!-- fragment --> For Cooper SDK Yocto build: <div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-video</div>
<div class="line">                -&gt; ambvideo-header (meta-ambabsp/recipes-video/ambvideo-header)</div>
<div class="line">                   (0x0100000) IAV Blur Buffer Size <span class="comment">//1M memory for blur area.</span></div>
<div class="line">                   (0x0500000) IAV Arbitrary Blur Buffer Size <span class="comment">//5M memory for arbitrary area.</span></div>
</div><!-- fragment --> Alternatively, users are able to change the CMA partition size on the fly. <div class="fragment"><div class="line">board# test_mempart -m 30 -s 0x100000</div>
<div class="line">board# test_mempart -m 31 -s 0x500000</div>
<div class="line">board# cat /proc/ambarella/cma</div>
<div class="line">mmb   phys[start-end]          size        virt[start-end]                        attr    buf_id      ref_cnt  dma_buf  <a class="code hl_function" href="../../db/d1a/test__vout__cfg_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a></div>
<div class="line">0     0x100000000-0x100404000  0x00404000  0xffffffc040000000-0xffffffc040404000  0x0003  21          0        0        <a class="code hl_variableRef" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa2e84b8119830cf9cf2a333d77624ac4e">IAV_PART_PREALLOC</a></div>
<div class="line">...</div>
<div class="line">7     0x1C5300000-0x1C7300000  0x02000000  0xffffffc105300000-0xffffffc107300000  0x0008  1           0        0        <a class="code hl_variableRef" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa09de9a53727022c18429db179a1d1ead">IAV_PART_BSB</a></div>
<div class="line">17    0x1C7300000-0x1C7400000  0x00100000  0xffffffc107300000-0xffffffc107400000  0x0000  30          0        0        <a class="code hl_variableRef" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa902ffde491d07bfcca4629ea183176e0">IAV_PART_BLUR</a></div>
<div class="line">18    0x1C7400000-0x1C7900000  0x00500000  0xffffffc107400000-0xffffffc107900000  0x0000  31          0        0        <a class="code hl_variableRef" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa3f4aff5d8a407d603950e09d9fbe2a93">IAV_PART_ARB_BLUR</a></div>
<div class="line">10    0x1C8000000-0x1C8C80000  0x00C80000  0xffffffc108000000-0xffffffc108c80000  0x0008  5           0        0        <a class="code hl_variableRef" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa621880ecce8c6a4ad2fffc44f069f51e">IAV_PART_QPMATRIX</a></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa09de9a53727022c18429db179a1d1ead"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa09de9a53727022c18429db179a1d1ead">IAV_PART_BSB</a></div><div class="ttdeci">IAV_PART_BSB</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa3f4aff5d8a407d603950e09d9fbe2a93"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa3f4aff5d8a407d603950e09d9fbe2a93">IAV_PART_ARB_BLUR</a></div><div class="ttdeci">IAV_PART_ARB_BLUR</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa621880ecce8c6a4ad2fffc44f069f51e"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa621880ecce8c6a4ad2fffc44f069f51e">IAV_PART_QPMATRIX</a></div><div class="ttdeci">IAV_PART_QPMATRIX</div></div>
</div><!-- fragment --></dd></dl>
<p>Run arbitrary blur demo. If it succeeds, the random size diamond shape blur area will be set on stream A. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg blur.lua</div>
<div class="line">board# test_encode -A -b 0 -h qfhd -e</div>
<div class="line">board# rtsp_server &amp;</div>
<div class="line">board# test_blur --arb-blur</div>
</div><!-- fragment --><div class="image">
<img src="../../example_arbitrary_blur_on_stream_v6.png" alt=""/>
<div class="caption">
Figure 2-4. Arbitrary Blur on Stream.</div></div>
<h2><a class="anchor" id="example_blur_coeff_on_stream"></a>
Example 3: Apply Different Blur Coefficients on Stream</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_mempart -m 30 -s 0x100000</div>
<div class="line">board# test_encode --resource-cfg blur.lua</div>
<div class="line">board# test_encode -A -b 0 -h qfhd -e</div>
<div class="line">board# rtsp_server &amp;</div>
<div class="line">board# test_blur -A -a 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 240 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 0 -w 400 -h 2160 -c 0 \</div>
<div class="line">       -a 1 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 1120 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 0 -w 400 -h 2160 -c 1 \</div>
<div class="line">       -a 2 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 2020 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 0 -w 400 -h 2160 -c 2 \</div>
<div class="line">       -a 3 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 2940 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 0 -w 400 -h 2160 -c 3 -t 2</div>
</div><!-- fragment --><div class="image">
<img src="../../example_stream_blur_coeff.jpg" alt=""/>
<div class="caption">
Figure 2-5. Different Blur Coefficients on Stream.</div></div>
<h2><a class="anchor" id="example_blur_frame_sync"></a>
Example 4: Frame Accurate Blur Insertion</h2>
<p >Blur insertion can synchronize to a specific frame with PTS. To support this feature, canvas enc_dummy_latency option must be enabled first.</p>
<div class="fragment"><div class="line">canvas = {</div>
<div class="line">       {</div>
<div class="line">           ...</div>
<div class="line">           enc_dummy_latency = 2,</div>
<div class="line">           ...</div>
<div class="line">       },</div>
<div class="line">       ...</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_mempart -m 30 -s 0x600000</div>
<div class="line">board# test_encode --resource-cfg blur.lua</div>
<div class="line">board# test_encode -A -b 0 -h qfhd -e</div>
<div class="line">board# rtsp_server &amp;</div>
<div class="line">board# test_frame_sync -A -b1 -a0 -x128 -y128 -w128 -h128 -t 2 \</div>
<div class="line">       -a1 -x256 -y256 -w256 -h256 -t 2 \</div>
<div class="line">       -a2 -x512 -y512 -w512 -h512 -t 2</div>
</div><!-- fragment --><p >If the blur insertion fails to match with the specific PTS frame, there will be error message reported from kernel dmesg log.</p>
<div class="fragment"><div class="line">board# test_frame_sync -A -b1 -a0 -x128 -y128 -w128 -h128 -t 2 \</div>
<div class="line">       -a1 -x256 -y256 -w256 -h256 -t 2 \</div>
<div class="line">       -a2 -x512 -y512 -w512 -h512 -t 2 -s 100  <span class="comment">// delay 100ms</span></div>
<div class="line"><span class="preprocessor">#iav_error# irq_enc_iproc_status_msg(390): Failed to update frame sync cmd for blur.</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
