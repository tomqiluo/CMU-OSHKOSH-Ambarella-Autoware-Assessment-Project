<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: BASIC - H.264 / H.265 Codec</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d5/d14/fs_basic_codec.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASIC - H.264 / H.265 Codec </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="codec_br"></a>
1. BitRate</h1>
<p >This is the target bitrate and used as a reference for the encoder. <b> Note that the bitrate set to the digital signal processor (DSP) may be different from the one set by IOCTRL.</b> The image audio video (IAV) driver will change it according to the encoding frame factor (fps_multi/fps_div) <a class="elRef" href="../../../library/d9/d3a/structiav__stream__fps.html">iav_stream_fps</a> when absolute bitrate flag is not enabled. Besides that, the real bitrate of stream may not be as same as the one set to DSP. The final bitrate depends on a lot of other factors, such as the complexity of scene and so on. The DSP has no limitation for the maximum target bitrate, but in IAV driver, there is a total system bitrate check, which is around 256 Mbps for all streams. This is for the dynamic random access memory (DRAM) bandwidth consideration. In addition, as the BSB buffer is used to save the data of all streams, so it maybe needed to be increased to support larger bitrate cases, otherwise the data may be overwritten.</p>
<h2><a class="anchor" id="example_codec_br1"></a>
Example 1: Change Bitrate On the Fly</h2>
<p >H.264 1080p 4Mbps -&gt; 6Mbps -&gt; 2Mbps </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_stream -t  #(Run PortServer/ps.exe on PC)</div>
<div class="line">board# test_encode -A -h 1080p --bitrate 4000000 -e</div>
<div class="line">board# test_encode -A --bitrate 6000000</div>
<div class="line">board# test_encode -A --bitrate 2000000</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_br2"></a>
Example 2: Set Target Bitrate Per Stream</h2>
<p >H.264 1080p 8Mbps + H.264 480p 4Mbps </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_stream -t  #(Run PortServer/ps.exe on PC)</div>
<div class="line">board# test_encode -A -h 1080p --bitrate 8000000 -e -B -h 480p -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 1 --bitrate 4000000 -e</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_br3"></a>
Example 3: Display the Target Bitrate</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --bitrate 6000000 -e</div>
<div class="line">board# test_encode --show-encode-config</div>
<div class="line"> </div>
<div class="line">[Encode stream config]:</div>
<div class="line"> Stream A</div>
<div class="line">        H.264</div>
<div class="line">               ...</div>
<div class="line">               Average_bitrate = 6000000</div>
<div class="line">               ...</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_br4"></a>
Example 4: Bitrate changed according to encoding frame factor</h2>
<p >Set encoding fps to be 1 fps by frame factor when video input (VIN) is 30 fps. The bitrate set to DSP will be <b> bitrate*(fps_multi/fps_div).</b> For example, set the bitrate to be 6Mbps, and the bitrate set to DSP will be 200K bps but not 6 Mbps in this example. </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --bitrate 6000000 --frame-factor 1/30 -e</div>
<div class="line">board# test_encode --show-encode-config</div>
<div class="line"> </div>
<div class="line">[Encode stream config]:</div>
<div class="line"> Stream A</div>
<div class="line">        H.264</div>
<div class="line">               ...</div>
<div class="line">               Average_bitrate = 200000</div>
<div class="line">               ...</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_br5"></a>
Example 5: Keep bitrate not affected by encoding frame factor</h2>
<p >However, the bitrate will not be changed even when the encoding frame factor is not 1, if the absolute bitrate flag is enabled. </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --bitrate 6000000 --frame-factor 1/30 --abs-br 1 -e</div>
<div class="line">board# test_encode --show-encode-config</div>
<div class="line"> </div>
<div class="line">[Encode stream config]:</div>
<div class="line"> Stream A</div>
<div class="line">        H.264</div>
<div class="line">               ...</div>
<div class="line">               Average_bitrate = 6000000</div>
<div class="line">               ...</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_gop"></a>
2. Group of Picture (GOP) Length</h1>
<p >This tool is used to specify the interval of I frames. Longer GOP means less I frame in one second. Additionally, as the I frame always costs more bits, so longer GOP can decrease the real bitrate. The value of GOP is supposed to be small for the motion scenes and large for the static scenes. The reason is that the static scenes do not need too much I frames to refresh the video quality.</p>
<p >There is some difference when changing the GOP length on the fly. a) Switch to smaller GOP </p><div class="image">
<img src="../../codec_decrease_gop_length.png" alt=""/>
<div class="caption">
Figure 2-1. H.264 / H.265 Switch to Smaller GOP.</div></div>
<p> The new GOP will take effect immediately no matter force or no-force IDR when changing the GOP. b) Switch to larger GOP </p><div class="image">
<img src="../../codec_increase_gop_length.png" alt=""/>
<div class="caption">
Figure 2-2. H.264 / H.265 Switch to Larger GOP.</div></div>
<p> It makes difference whether to do or not to do force-IDR when changing the GOP. If do force-IDR when change the GOP, the new GOP will take effect immediately. However, if there is no force-IDR, the length of the GOP which the current frame in will be extended to the new length.</p>
<h2><a class="anchor" id="example_codec_gop1"></a>
Example 6: Force IDR at Shorter GOP</h2>
<p >H.264 1080p, GOP Length 60 -&gt; 30 -&gt; 15(Force IDR) </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -N 60 -e</div>
<div class="line">board# test_encode -A -N 30</div>
<div class="line">board# test_encode -A -N 15 --force-idr 1</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_gop2"></a>
Example 7: Force IDR at Longer GOP</h2>
<p >H.264 1080p, GOP Length 15 -&gt; 30 -&gt; 60(force IDR) </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -N 15 -e</div>
<div class="line">board# test_encode -A -N 30</div>
<div class="line">board# test_encode -A -N 60 --force-idr 1</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_gop3"></a>
Example 8: Display Current GOP Length</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -N 60 -e</div>
<div class="line">board# test_encode --show-encode-config</div>
<div class="line"> </div>
<div class="line">[Encode stream config]:</div>
<div class="line"> Stream A</div>
<div class="line">        H.264</div>
<div class="line">               ...</div>
<div class="line">                     N = 60</div>
<div class="line">               ...</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_gop4"></a>
Example 9: Update at Next GOP</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -b 0 -N 20 -e</div>
<div class="line">board# test_encode -A -N 3 --N-update-mode 1</div>
</div><!-- fragment --><p> Difference from the above talking related to IDR, the above example shows the GOP can always be arranged to take effect at next GOP. </p><div class="image">
<img src="../../codec_update_at_next_gop.png" alt=""/>
<div class="caption">
Figure 2-3. H.264 / H.265 Update at Next GOP.</div></div>
<hr  />
<h1><a class="anchor" id="codec_idr"></a>
3. Instantaneous Decoder Refresh (IDR) Frequency</h1>
<p >IDR belongs to I frames. Also the difference between I frame and IDR frame is that when the decode receives the IDR frame, it discards all the reference frame queues and update the PPS and SPS structures, while the decoder only discard the reference queues when it received the I frame.</p>
<h2><a class="anchor" id="example_codec_idr1"></a>
Example 10: Set IDR Interval</h2>
<p >H.264 1080p, all I Frames are IDR Frames. </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --idr 1 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_idr2"></a>
Example 11: Set IDR Interval Per Stream</h2>
<p >H.264 1080p, all I frames are IDR frames + H.264 480p, one IDR for each two I frames. </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --idr 1 -e -B -h 1080p --idr 2 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_idr3"></a>
Example 12: Change IDR Interval On the Fly</h2>
<p >H.264 1080p, one IDR for each I frames -&gt; one IDR in every three I frames. </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --idr 1 -e</div>
<div class="line">board# test_encode -A --idr 3</div>
</div><!-- fragment --><div class="image">
<img src="../../codec_IDR_interval.png" alt=""/>
<div class="caption">
Figure 3-1. H.264 / H.265 IDR Interval.</div></div>
<h2><a class="anchor" id="example_codec_idr4"></a>
Example 13: Display Current IDR Frequency</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --idr 3 -e</div>
<div class="line">board# test_encode --show-encode-config</div>
<div class="line"> </div>
<div class="line">[Encode stream config]:</div>
<div class="line"> Stream A</div>
<div class="line">        H.264</div>
<div class="line">               ...</div>
<div class="line">               idr interval = 3</div>
<div class="line">               ...</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_fidr"></a>
4. Force IDR</h1>
<p >Force IDR is used to generate an IDR frame at once. When force IDR is inserted in to the stream, it will start a new GOP. </p><div class="image">
<img src="../../codec_force_idr.png" alt=""/>
<div class="caption">
Figure 4-1. H.264 / H.265 Force IDR.</div></div>
<h2><a class="anchor" id="example_codec_fidr"></a>
Example 14: Generate IDR Frames for H.264 Streams.</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -e</div>
<div class="line">board# test_encode -A --force-idr</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_qp_limit"></a>
5. QP Limitation</h1>
<p >The QP means quantization parameters. Smaller QP value means more details will be saved. QP limitation is used to specify the QP range of frame I, Q, P, B, C and D when doing stream encoding. All the QP of each encoding unit should be in the corresponding range.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">QP Limit Setting   </th><th class="markdownTableHeadCenter">Frame Type   </th><th class="markdownTableHeadCenter">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">&ndash;qp-limit-i   </td><td class="markdownTableBodyCenter">I frame   </td><td class="markdownTableBodyCenter">The key I frame    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">&ndash;qp-limit-q   </td><td class="markdownTableBodyCenter">Q frame   </td><td class="markdownTableBodyCenter">Important P frame, such as fast seek P, long term P and some special encoded P frames    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">&ndash;qp-limit-p   </td><td class="markdownTableBodyCenter">P frame   </td><td class="markdownTableBodyCenter">Normal P frame for non-SVC-T GOP, or level 0 P frame when using SVC-T GOP    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">&ndash;qp-limit-b   </td><td class="markdownTableBodyCenter">B frame   </td><td class="markdownTableBodyCenter">Normal B frame for non-SVC-T GOP, or level 1 P frame when using SVC-T GOP    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">&ndash;qp-limit-c   </td><td class="markdownTableBodyCenter">C frame   </td><td class="markdownTableBodyCenter">Level 2 P frame when using SVC-T GOP   </td></tr>
</table>
<h2><a class="anchor" id="example_codec_qp_limit"></a>
Example 15: Set QP Range for I Frame.</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --qp-limit-i 20~48 -e</div>
</div><!-- fragment --> <div class="image">
<img src="../../codec_QP_limitation.png" alt=""/>
<div class="caption">
Figure 5-1. H.264 / H.265 QP Limitation.</div></div>
<hr  />
<h1><a class="anchor" id="codec_qp_adapt"></a>
6. Adapt QP</h1>
<p >It is used to add the robustness for the QP boundaries based on the QP limitations.</p>
<h2><a class="anchor" id="example_codec_qp_adapt"></a>
Example 16: Set Adapt QP</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --qp-limit-i 20~48 --adapt-qp 2 -e</div>
</div><!-- fragment --> <div class="image">
<img src="../../codec_QP_adapt.png" alt=""/>
<div class="caption">
Figure 6-1. H.264 / H.265 QP Adapt.</div></div>
<hr  />
<h1><a class="anchor" id="codec_pskip"></a>
7. Force P-skip</h1>
<p >This is used to force the specified frame as full P-skip frame by application. Additionally, when enabling the repeating function for the P-skip, the encoder will take the skip number as the interval between two P frames, all frames during the interval will be skipped. If the skip mode is specified as inverted mode, the encoder will take the skip number as the interval between two P-skip frames. It is primarily for low bit rate control in static scenes.</p>
<h2><a class="anchor" id="example_codec_pskip1"></a>
Example 17: Add Force P-skip Frame</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1080p -e</div>
<div class="line">board# test_encode -A --pskip-repeat 0 --pskip-repeat-intvl 1</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_pskip2"></a>
Example 18: Force P-skip with Normal Mode</h2>
<p >Insert three P-skip frames repeatedly between every two full P frames. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1080p -e</div>
<div class="line">board# test_encode -A --pskip-repeat 1 --pskip-repeat-intvl 3 --pskip-repeat-mode 0</div>
</div><!-- fragment --> <div class="image">
<img src="../../codec_repeate_force_pskip_frame_normal.png" alt=""/>
<div class="caption">
Figure 7-1. H.264 / H.265 Repeat Force P-skip Normal Mode.</div></div>
<h2><a class="anchor" id="example_codec_pskip3"></a>
Example 19: Force P-skip with Inverted Mode</h2>
<p >Encode three P frames repeatedly between every two pskip frames. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1080p -e</div>
<div class="line">board# test_encode -A --pskip-repeat 1 --pskip-repeat-intvl 3 --pskip-repeat-mode 1</div>
</div><!-- fragment --> <div class="image">
<img src="../../codec_repeate_force_pskip_frame_revert.png" alt=""/>
<div class="caption">
Figure 7-2. H.264 / H.265 Repeat Force P-skip Inverted Mode.</div></div>
<hr  />
<h1><a class="anchor" id="codec_fdrop"></a>
8. Force Frame Drop</h1>
<p >This is used to force the specified YUV dropped to encode by app. Additionally, when enabling the repeating function for the frame drop, the encoder will take the drop number as the encoding interval, all the YUV during the interval will be dropped. It will change the I frame interval in the time domain.</p>
<h2><a class="anchor" id="example_codec_fdrop1"></a>
Example 20: Force Frame Drop</h2>
<div class="image">
<img src="../../codec_force_frame_drop.png" alt=""/>
<div class="caption">
Figure 8-1. H.264 / H.265 Force Frame Drop.</div></div>
 <div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)          <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1080p -e</div>
<div class="line">board# test_encode -A --frame-drop-repeat 0 --frame-drop 1</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fdrop2"></a>
Example 21: Force Frame Drop Repeatedly</h2>
<p >Drop the continuous 3 frames repeatedly, after every P frame.</p>
<div class="image">
<img src="../../codec_force_frame_drop_repeat.png" alt=""/>
<div class="caption">
Figure 8-2. H.264 / H.265 Force Frame Drop Repeatly.</div></div>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)          <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1080p -e</div>
<div class="line">board# test_encode -A --frame-drop-repeat 1 --frame-drop 3</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_skip_mode"></a>
9. Skip Frame Strategy and Mode</h1>
<p >There are three kinds of strategies for encoder to skip frames.</p><ul>
<li>The first one is based on the size of the compressed picture. When the bitstream size of one frame is out of limitation (decided by the real-time average bitrate), the encoder will skip frames.</li>
<li>The second one is based on CPB size. When the CPB size exceeds the maximum value, then the encoder will skip frames.</li>
<li>The third one is based on the target bitrate and maximum QP value. The encoder will skip frames when the bitrate is exceeded or the maximum QP value is reached.</li>
</ul>
<p >Currently, there are two modes for encoder to skip frames.</p><ul>
<li>The first one is dropping frames.</li>
<li>The second one is repeating frames.</li>
</ul>
<p >The encoder also supports limiting the number of max skipped frames continuously. This is in case the encoder skips too many frames without encoding a new frame showing the scene change. <b> Kindly note that this skip behavior is decided by the encoder but not the application.</b></p>
<h2><a class="anchor" id="example_codec_smode1"></a>
Example 22: Frames Dropped according to Picture Size</h2>
<p >Skip by dropping frames when the size of the compressed picture is out of limitation. It's usually triggered when the scene changes suddenly. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)          <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1920x1080 --skip-frame-mode 0 --skip-frame 1 --bitrate 100000 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_smode2"></a>
Example 23: Frames Skipped according to Picture Size</h2>
<p >Skip by repeating frames when the size of the compressed picture is out of limitation. It's usually triggered when the scene changes suddenly. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)          <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1920x1080 --skip-frame-mode 1 --skip-frame 1 --bitrate 100000 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_smode3"></a>
Example 24: Frames Dropped according to CPB Size</h2>
<p >Skip frames by dropping frames when the CPB size is exceeded. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)          <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1920x1080 --skip-frame-mode 0 --skip-frame 2 --cpb-buf-idc 31 --cpb-user-size 1000 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_smode4"></a>
Example 25: Frames Skipped according to CPB Size</h2>
<p >Skip frames by repeating frames when the CPB size is exceeded. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)          <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1920x1080 --skip-frame-mode 1 --skip-frame 2 --cpb-buf-idc 31 --cpb-user-size 1000 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_smode5"></a>
Example 26: Frames Dropped according to Target Bitrate</h2>
<p >Skip frames by dropping frames when bitrate exceeds the target value. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)          <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1920x1080 --skip-frame-mode 0 --skip-frame 4 --bitrate 100000 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_smode6"></a>
Example 27: Frames Skipped according to Target Bitrate</h2>
<p >Skip frames by repeating frames when bitrate exceeds the target value. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1920x1080 --skip-frame-mode 1 --skip-frame 4 --bitrate 100000 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_smode7"></a>
Example 28: Set Maximum Skipped Frames Number</h2>
<p >Based on example <a class="el" href="../../d5/d14/fs_basic_codec.html#example_codec_smode6">Example 27: Frames Skipped according to Target Bitrate</a>, set the maximum skipped (in continuous) frame number as 5. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1920x1080 --skip-frame-mode 1 --skip-frame 4 --max-skip-num 5 --bitrate 100000 -e</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="codec_ilimit"></a>
10. Maximum I Size Limit</h1>
<p >When the size of the I frame is too large, the network transfer can be negatively affected. This feature is used to limit the I frame size in the KB unit.</p>
<h2><a class="anchor" id="example_codec_ilimit"></a>
Example 29: Set the Maximum I Size</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)          <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h2560x1440 --smaxsize 2560x1440 --bitrate 4000000 --max-i-size-<a class="code hl_defineRef" href="../../../driver/d6/d56/iav__utils_8h.html#a1841fd1a462d245d8c73dce55e2f45da">KB</a> 300 -e</div>
<div class="ttc" id="aiav__utils_8h_html_a1841fd1a462d245d8c73dce55e2f45da"><div class="ttname"><a href="../../../driver/d6/d56/iav__utils_8h.html#a1841fd1a462d245d8c73dce55e2f45da">KB</a></div><div class="ttdeci">#define KB</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_mvdump"></a>
11. MV Dump for AVC</h1>
<p >The following lists important notes about MV dump for advanced video coding (AVC): <br  />
1) Because the MV dump memory is immediately before the OSD buffer, ensure that the overlay is correct when the MV dump is enabled. <br  />
2) It is preferable to run test_statistics at telnet, rather than serial port. The MV dump data is too long to affect the Linux system timing.</p>
<p >Configure menuconfig as shown: For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; <span class="keyword">private</span></div>
<div class="line">             -&gt; vin</div>
<div class="line">                -*- ambvideo-header (drv_modules/<span class="keyword">private</span>/video/dsp_v6)</div>
<div class="line">                    (0x0200000) IAV Motion Vector Buffer Size</div>
</div><!-- fragment --><p> For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-video</div>
<div class="line">                -&gt; ambvideo-header (meta-ambabsp/recipes-video/ambvideo-header)</div>
<div class="line">                   (0x0200000) IAV Motion Vector Buffer Size</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_mvdump1"></a>
Example 30: Display Frame of MV Dump</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h720p -e</div>
<div class="line">board# test_statistics -A -d 1 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 <span class="comment">// Enable and display 1 frame of MV dump</span></div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_mvdump2"></a>
Example 31: Capture Continuous MV Data</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h720p -e</div>
<div class="line">board# test_statistics -A -d 1 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -c<span class="comment">// Enable and display MV dump continuously</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_aqp"></a>
12. The aqp Type for HEVC</h1>
<p >The option <code>"aqp-type"</code> in <code>test_encode</code> is represented as shown below: <br  />
0. Use frame level QP for mode decision and size decision. <br  />
1. Use frame level QP for mode decision, MB level qp for size decision. <br  />
2. Use MB level QP for mode decision and size decision.</p>
<h2><a class="anchor" id="example_codec_aqp1"></a>
Example 32: Frame Size Decided by QP Limitation</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1080p --aqp-type 0 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_aqp2"></a>
Example 33: Frame Size Decided by QP of MB</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1080p --aqp-type 2 -e</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_au"></a>
13. Stream Structure au Type</h1>
<p >The option <code>"--au-type"</code> can be used to control stream structure, and its detailed information is shown as below: <br  />
 0. No AUD, No SEI; <br  />
 1. AUD before SPS, PPS, with SEI; <br  />
 2. AUD after SPS, PPS, with SEI; <br  />
 3. IDR: AUD before SPS &amp; PPS, with BPSEI &amp; PTSEI, P: AUD, PPS, PTSEI; <br  />
 4. No AUD, only SPS, PPS, with SEI.</p>
<a class="anchor" id="au_type_table"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="center">Streaming </th><th align="center">AU Type </th><th align="center">NALU Sequence  </th></tr>
<tr>
<td rowspan="6">H.264 </td></tr>
<tr>
<td>0</td><td>SPS PPS I P P ... </td></tr>
<tr>
<td>1</td><td>AUD SPS PPS SEI I AUD SEI P AUD SEI P ... </td></tr>
<tr>
<td>2</td><td>SPS PPS AUD SEI I AUD SEI P AUD SEI P ... </td></tr>
<tr>
<td>3</td><td>AUD SPS PPS SEI I AUD PPS SEI P AUD PPS SEI P ... </td></tr>
<tr>
<td>4</td><td>SPS PPS SEI I SEI P SEI P ...  </td></tr>
<tr>
<td rowspan="6">H.265 </td></tr>
<tr>
<td>0</td><td>VPS SPS PPS Ix3 Px3 Px3 ... </td></tr>
<tr>
<td>1</td><td>AUD VPS SPS PPS SEI Ix3 AUD SEI Px3 AUD SEI Px3 ... </td></tr>
<tr>
<td>2</td><td>VPS SPS PPS AUD SEI Ix3 AUD SEI Px3 AUD SEI Px3 ... </td></tr>
<tr>
<td>3</td><td>AUD VPS SPS PPS SEI Ix3 AUD PPS SEI Px3 AUD PPS SEI Px3 ... </td></tr>
<tr>
<td>4</td><td>VPS SPS PPS SEI Ix3 SEI Px3 SEI Px3 ...  </td></tr>
</table>
<h2><a class="anchor" id="example_codec_au1"></a>
Example 34: Specify AUD Before SPS / PPS with SEI Syntax</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1080p --au-type 1 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_au2"></a>
Example 35: Set Au-type</h2>
<p >When specified with <code>"--au-type=3"</code>, the structure of H.264 is shown as below: <br  />
1) IDR frame: AU delimiter, SPS, PPS, BPSEI, PTSEI <br  />
2) P frame: AU delimiter, PPS, PTSEI </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --au-type 3 -e</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_roi_enc"></a>
14. ROI Encoding Tools</h1>
<p >Sometimes, it is necessary to process a single sub region of an image while leaving other regions unchanged and a region of interest (ROI) processing is used for this purpose. A ROI is a selected area in a picture. These ROIs can be coded in better or worse quality than the rest of the picture with a special group of quantization parameter offset (QP offset), and coding strategy settings. Usually, ROI is trigged by motion and works with external video analysis algorithm.</p>
<p >The group of settings is implemented by filling the QP matrixes. There are up to three QP matrixes configured in the menuconfig. It can make sure different frame types use different settings. The relationship between matrix number and frame types are as below: </p><div class="image">
<img src="../../codec_roi_enc_matrix_table.png" alt=""/>
<div class="caption">
Figure 14-1. H.264 / H.265 Matrix Table.</div></div>
<p >For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">        -&gt; drv_modules</div>
<div class="line">           -&gt; <span class="keyword">private</span></div>
<div class="line">              -&gt; vin</div>
<div class="line">                 -*- ambvideo-header (drv_modules/<span class="keyword">private</span>/video/dsp_v6)</div>
<div class="line">                     (1)   IAV ROI Matrix numbers <span class="keywordflow">for</span> I/P/B/P2 frames</div>
</div><!-- fragment --><p> For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-video</div>
<div class="line">                -&gt; ambvideo-header (meta-ambabsp/recipes-video/ambvideo-header)</div>
<div class="line">                  (1)   IAV ROI Matrix numbers <span class="keywordflow">for</span> I/P/B/P2 frames</div>
</div><!-- fragment --><p >The size of each matrix is 1/16x1/16 (for AVC) or 1/32x1/32 (for HEVC) of the encoding resolution. And the each unit of the matrix in memory is filled with <a class="elRef" href="../../../library/db/d98/structiav__h264__qproi__data.html">iav_h264_qproi_data(for AVC)</a> or <a class="elRef" href="../../../library/de/d2c/structiav__h265__qproi__data.html">iav_h265_qproi_data(for HEVC)</a>. These structures contains the QP offset etc. </p><div class="image">
<img src="../../codec_QP_matrix.png" alt=""/>
<div class="caption">
Figure 14-2. H.264 / H.265 QP Matrix.</div></div>
<p >In order to decide the method of implementation of the ROI, the following information can be used as a reference:</p><ul>
<li>For the category tool (HEVC only), a category lookup table will be issued to DSP at first, and this table contains 8 categories. App can pre-set different strategies for different categories. And then, the category index can be specified for each CTB in QP matrix to make the encoder do corresponding operation according to the strategy of the category.</li>
<li>There are four kinds of strategies, such as FORCE_ZMV, FORCE_INTRA, FORCE_UC, FORCE_SKIP. These strategies will affect the encoder coding on the CTB directly. The FORCE_ZMV means force the motion vector of the CTB to be 0, and it will save the bits when coding for the motion vector. FORCE_INTRA means that force the encoder to do intra coding for the CTB. FORCE_UC is used only for Smartrc app. FORCE_SKIP means that force the encoder to skip coding for the CTB, and it will also save the bits. <div class="image">
<img src="../../codec_category_lookup_table.png" alt=""/>
<div class="caption">
Figure 14-3. H.265 Category Lookup Table.</div></div>
</li>
</ul>
<h2><a class="anchor" id="example_codec_roi_enc1"></a>
Example 36: Set Category Lookup Table</h2>
<p >Set category index 1 to be FORCE_ZMV in category lookup table. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A --md-cat 1,2,3,4,0,0,0 -H 1080p -e</div>
<div class="line"><span class="comment">//the lookup table is 0,1,2,3,4,0,0,0. 0 has been set, it needs to set the other 7 value.</span></div>
</div><!-- fragment --><ul>
<li>For the user class tool(AVC only), the strategies for each class is specified with two kinds of bias values, such as intra bias and direct bias. The larger the intra bias value is, the less possibility the MB will be done with intra coding. The larger the direct bias is, the less possibility the MB will be done with skip coding. In addition, as same as the category tool, there are three user classes can be pre-set. The user class 0 is used as default. So the class 1 and 2 can be customized. And then the class index can be specified for each MB to tell the encoder do corresponding operation according to the strategy of the user class. <div class="image">
<img src="../../codec_user_class_group.png" alt=""/>
<div class="caption">
Figure 14-4. H.264 User Class Group.</div></div>
</li>
<li>QP offset is used to apply an offset value based on the QP values of each MB or CTB. The negative offset will make the quality better if the CTB or MB will not be coded as skip.</li>
<li>All the ROI tools should be implemented by filling the QP matrixes. So, frequently updating QP matrix is necessary and it may increase the DRAM bandwidth.</li>
<li>Users can define several groups of the ROI parameters, and then apply different group settings for different ROIs.</li>
</ul>
<h2><a class="anchor" id="example_codec_roi_enc2"></a>
Example 37: Set User Class Type for MB</h2>
<div class="fragment"><div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_qproi</div>
<div class="line">&gt; a.  Config Stream A ROI</div>
<div class="line">&gt; 1 - Add Category</div>
<div class="line">e.g., <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 0, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 0, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> 100, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> 100, quality level 1  (better)</div>
<div class="line">e.g., <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 200, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 200, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> 200, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> 200, quality level 2  (worse)</div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a></div><div class="ttdeci">u32 y</div></div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a></div><div class="ttdeci">u32 width</div></div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a></div><div class="ttdeci">u32 height</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a></div><div class="ttdeci">u32 x</div></div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_roi_enc3"></a>
Example 38: Set QP Offset for H.264</h2>
<div class="fragment"><div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_qproi</div>
<div class="line">&gt; a.  Config Stream A ROI</div>
<div class="line">&gt; 4 - Add QP Adjust</div>
<div class="line">e.g., <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 0, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 0, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> 100, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> 100, qp offset -5     (better)</div>
<div class="line">e.g., <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 200, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 200, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> 200, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> 200, qp offset 5  (worse)</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_roi_enc4"></a>
Example 39: Set Category Type for CTB</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H1080p -e</div>
<div class="line">board# test_qproi</div>
<div class="line">&gt; a.  Config Stream A ROI</div>
<div class="line">&gt; 4 - Add Category</div>
<div class="line">e.g., <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 200, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 200, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> 200, <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> 200, qp offset 3</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_fsync"></a>
15. Frame Sync</h1>
<p >The frame sync feature is used to set some H.264 / H.265 parameters for the specified frame. It is for the real-time update of H.264 / H.265 parameters on frame accuracy.</p>
<p >The DSP requires more memory to cache several frames between source canvases and stream encoding. In this case, the application can perform VCA on the specified frame from the source canvas, then apply the calculated encode parameters on this frame. </p><div class="image">
<img src="../../ut_frame_sync.png" alt=""/>
<div class="caption">
Figure 15-1. Frame Sync Feature Diagram.</div></div>
<p >To do frame sync, the encode dummy latency for the dedicated canvas needs to be set first when entering preview. There is no global encode dummy latency needed on CV5x any more, which wil waste memory resources due to coarser granuarity. Check <a class="el" href="../../d5/d7d/fs_basic_stream.html#subsection_encode_dummy_latency">1.10.1 Encode Dummy Latency</a> for usage.</p>
<h2><a class="anchor" id="example_codec_fsync1"></a>
Example 40: Set Encode Dummy Latency for Main Canvas</h2>
<p >Please refer to <a href="../../script/encode_dummy_latency.lua" target="_blank"><b>encode_dummy_latency.lua</b></a> </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fsync2"></a>
Example 41: Set Encode Dummy Latency for Specific Canvases</h2>
<p >Set enc-dummy-latency in canvas config in lua script. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fsync3"></a>
Example 42: Force Insert IDR Frame</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_frame_sync -A --force-idr</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fsync4"></a>
Example 43: Set QP Adjust Value</h2>
<p >Set QP adjust value = -10 for the left top region. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_frame_sync -A --roi-matrix-idx 0 --roi-qp-adjust -10 --roi-region-qp-adjust 0</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fsync5"></a>
Example 44: Update QP Limitation for P Frame</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_frame_sync -A --qp-limit-p 20~20</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fsync6"></a>
Example 45: Update QP Limitation for I Frame</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_frame_sync -A --qp-limit-i 20~20</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fsync7"></a>
Example 46: Force Drop Frames</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_frame_sync -A --frame-drop 10</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fsync8"></a>
Example 47: Set Adaptive QP</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -h1080p -e</div>
<div class="line">board# test_frame_sync -A --adapt-qp 4</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fsync9"></a>
Example 48: Add Overlay Insertion</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua</div>
<div class="line">board# test_encode -A -b 0 -h 3840x2160 -e</div>
<div class="line">board# test_frame_sync -A -o1 -a0 -x0 -y0 -w128 -h64 -a1 -x200 -y100 -w64 -h128 -a2 -x0 -y300 -w48 -h96</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_fsync10"></a>
Example 49: Add Blur Insertion</h2>
<p >Please refer to <a href="../../script/blur.lua" target="_blank"><b>blur.lua</b></a>. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_mempart -m 30 -s 0x800000</div>
<div class="line">board# test_encode --resource-cfg blur.lua</div>
<div class="line">board# test_encode -A -b 0 -h 3840x2160 -e</div>
<div class="line">board# test_frame_sync -A -b1 -a0 -x128 -y128 -w128 -h128  -t 1 -a1 -x256 -y256 -w256 -h256 -t 1 -a2 -x512 -y512 -w512 -h512 -t1</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_long_start_code"></a>
Example 50: Setting HEVC Long Start Code</h2>
<p >The user can use "--long-start-code" option to enable or disable the long start code flag for HEVC. When enabling the flag, the frame inner tile starts with 4 bytes start code 0x00000001, meaning that start codes are all with 4 bytes 0x00000001. When disabling the flag, the frame inner tile starts with 3 bytes start code 0x000001, while the frame boundary has start code with 4 bytes 0x00000001. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H1080p --<span class="keywordtype">long</span>-start-code 1 -e</div>
<div class="line">board# test_stream -f # Save stream and analyze via Vega Media Analyzer.</div>
<div class="line">board# test_encode -A -s</div>
<div class="line">board# test_encode -A -H1080p --<span class="keywordtype">long</span>-start-code 0 -e</div>
<div class="line">board# test_stream -f # Save stream and analyze via Vega Media Analyzer.</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="H26X_scalelist"></a>
16. H26x Scalelist</h1>
<p >H26x scalelist feature is used for users to specify scaling matrix when AVC / HEVC encoding. Scaling matrix will be used inside encoder of DSP to do quantization. There are three options to choose: 0: Disable scalelist, 1: Use the default scalelist, 2: Use the scalelist specified by users. The default is 0.<br  />
</p>
<p >SDK has built-in three sets of scalelist matrices with different strengths for AVC (<a class="elRef" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gae12463d236b2e58243366d3ce3ec3521">IAV_H26X_SCALELIST_STRENGTH</a>), allowing users to directly specify the corresponding parameter of "--scalelist-strength" to use scalelist for improve encode quality. </p><dl class="section note"><dt>Note</dt><dd><ul>
<li>Because of hardware limit, the video digital signal processor (VDSP) does not support 32x32 scale list for HEVC Scalelist.</li>
<li>The AVC scalelist only support high level profile for AVC encoding.</li>
<li>By default, SDK enables the high profile for AVC encode, and set scalelist strength to low level.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="example_avc_scalelist_strength"></a>
Example 51: Config Scalelist Strength for AVC</h2>
<p >Steps are as below. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 --scalelist-strength 3 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_avc_scalelist_setting"></a>
Example 52: Custom Scalelist Matrix for AVC</h2>
<p >Steps are as below. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 --profile 2</div>
<div class="line">board# test_scalelist -A -h /usr/share/ambarella/lua_scripts/avc_scalelist.lua -s 2 -d</div>
<div class="line">board# test_encode -A -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_hevc_scalelist_setting"></a>
Example 53: Custom Scalelist Matrix for HEVC</h2>
<p >Steps are as below. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1080p -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0</div>
<div class="line">board# test_scalelist -A -H /usr/share/ambarella/lua_scripts/hevc_scalelist.lua -s 2 -d</div>
<div class="line">board# test_encode -A -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_avc_scalelist_bin_setting"></a>
Example 54: Direct Use Scalelist Bin File for AVC</h2>
<p >Steps are as below. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 --profile 2</div>
<div class="line">board# test_scalelist -A -h avc_scalelist.bin -s 2 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div>
<div class="line">board# test_encode -A -e</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_full_range"></a>
17. Video Full Range</h1>
<p >Sometimes, users need to evaluate encoder performance &amp; quality and calculate some objective standard scores, such as PSNR-MSE, MS-SSIM, VMAF and so on.<br  />
 These calculations process all that need to decode the stream data into YUV data, and then calculate the final score based on the golden data. Many users use FFmpeg for decoding, but in the process of decoding, attention should be paid to the conversion of color range.<br  />
</p>
<dl class="section note"><dt>Note</dt><dd>There are two color ranges, full-range and limited-range.<ul>
<li><b>Full-range</b> is mainly used for PC, and the value ranges of <b>Y/U/V are all [0, 255]</b>.</li>
<li><b>Limited-range</b> is mainly used for TV, the range of <b>Y is [16, 235]</b>, and the range of <b>U/V is [16, 240]</b>.</li>
</ul>
</dd></dl>
<p>Ambarella encoder runs with the full-range color range by default (it's <b>"vui_info.video_full_range_flag == 1"</b> option), and will not compress the data range during the encoding process. In the process of FFmpeg decoding, users must keep the same range of video content as the encoder option, either both are full range, or both are limited range.<br  />
</p>
<p >FFmpeg decoded the streams into "limited-range" YUV by default, so it is necessary to specify the "full-range" video range of YUV output in the decoding process. Otherwise the color space will be narrowed, the mean square error (MSE) will be increased, and the scores of PSNR and VMAF will be reduced accordingly.</p>
<h2><a class="anchor" id="example_codec_decode_by_ffmpeg"></a>
Example 55: Decode by FFmpeg</h2>
<p >Set a full-range gray scale pattern YUV as the source YUV. </p><div class="image">
<img src="../../codec_decode_by_ffmpeg_greybar_source.png" alt=""/>
<div class="caption">
Figure 17-1. Gray Bar Pattern Source YUV.</div></div>
<p >If users decode the stream by FFmpeg with defualt parameters (<b>limited-range</b>), the decoded YUV is as below: </p><div class="fragment"><div class="line">host$ ffmpeg -i case1.h265 -vcodec rawvideo -pix_fmt nv12 -an case1.yuv</div>
</div><!-- fragment --> <div class="image">
<img src="../../codec_decode_by_ffmpeg_greybar_limited_range.png" alt=""/>
<div class="caption">
Figure 17-2. Gray Bar Pattern YUV with Limited Color Range.</div></div>
<p >If users decode the stream by FFmpeg with <b>full-range</b> parameters, the decoded YUV is as below: </p><div class="fragment"><div class="line">host$ ffmpeg -i case2.h265 -vcodec rawvideo -pix_fmt nv12 -an case2.yuv -lavfi <span class="stringliteral">&quot;scale=out_range=full&quot;</span></div>
</div><!-- fragment --> <div class="image">
<img src="../../codec_decode_by_ffmpeg_greybar_full_range.png" alt=""/>
<div class="caption">
Figure 17-3. Gray Bar Pattern YUV with Full Color Range.</div></div>
<hr  />
<h1><a class="anchor" id="codec_qp_offset"></a>
18. Chroma QP Offset</h1>
<p >Users can set diffrent <code>chroma_qp_offset</code> value to improve the AVC and HEVC encoding quality of chroma field.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The new chroma_qp_offset value will only take effect for the next GOP.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="example_codec_chroma_qp_offset"></a>
Example 55: Set Chroma QP Offset</h2>
<div class="fragment"><div class="line">board# init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg encode_dummy_latency.lua --vout-cfg /usr/local/bin/scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -h 1080p -e</div>
<div class="line">board# test_encode -A --chroma-qp-offset 9  <span class="comment">//users can set other offset value[-12, 12]</span></div>
</div><!-- fragment --><p >Please refer to <a href="../../script/encode_dummy_latency.lua" target="_blank"><b>encode_dummy_latency.lua</b></a></p>
<p >To check if this value is set successfully, users can download the video stream to use the "MEGA Media Analyzer" to check the parameter.</p>
<hr  />
<h1><a class="anchor" id="codec_cu_size_control"></a>
19. Support CU Size Control for HEVC</h1>
<p >This feature is used to control the CU size for HEVC. By default CU8 block and CU16 block are enabled, Ambarella can specify <code>disable-cu*</code> option in <code>test_encode</code> to disable them. The <code>cu*-bias-level</code> parameters control the biases for these CU encoding levels. The bigger the bias, the less these cu* will be coded. There are 7 levels for option <code>cu*-bias-level</code> in <code>test_encode</code> and the range is [0,6].</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>In order to completely turn off CU8, <code>--disable-cu8 1</code> can be used.</li>
<li>In order to completely turn off CU16, <code>--disable-cu16 1</code> can be used. Be aware that CU8 will also be turned off as well.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="example_codec_cu_size_control1"></a>
Example 56: Disable CU8 and CU16 Blocks</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H1080p -b0 --disable-cu8 1 --disable-cu16 1 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_cu_size_control2"></a>
Example 57: Set Bias Level for CU8 Block</h2>
<p >Enable both CU8 block and CU16 block, and specify the biggest bias level for CU8 block. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H1080p -b0 --disable-cu8 0 --disable-cu16 0 --cu8-bias-level 6 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_cu_size_control3"></a>
Example 58: Set Bias Level for CU16 Block</h2>
<p >Enable both CU8 block and CU16 block, and specify the biggest bias level for CU8 block and CU16 block. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H1080p -b0 --disable-cu8 0 --disable-cu16 0 --cu8-bias-level 6 --cu16-bias-level 6 -e</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="codec_qframe"></a>
20. Q Frame Mechanism</h1>
<p >Because the I frame size is too large to transfer through an unstable network, the platform provides an alternative method for reducing I frame size, called, "Q frame" (better quality P frame). The Q frame number follows the formula: (2^(log_q_num_minus) -1).</p>
<h2><a class="anchor" id="example_codec_qframe1"></a>
Example 59: Set Q Frame Number for AVC</h2>
<p >Set AVC stream, 7 Q frames in one group of pictures (GOP). </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board # test_encode -A -h1080p --qp-limit-q 15~51 --q-qp-reduce 2 --log-q-num-minus-1 3 -N 120<span class="comment">// the interval for Q frames is 15</span></div>
<div class="line">board # test_encode -A -e</div>
<div class="line">board # test_encode -A -s</div>
</div><!-- fragment --><h2><a class="anchor" id="example_codec_qframe2"></a>
Example 60: Set Q Frame Number for HEVC</h2>
<p >Set high efficiency video coding (HEVC) stream, 3 Q frames in one GOP. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)            <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board # test_encode -A -H1080p --qp-limit-q 14~51 --q-qp-reduce 3 --log-q-num-minus-1 2 -N 120 <span class="comment">// the interval for Q frames is 30</span></div>
<div class="line">board # test_encode -A -e</div>
<div class="line">board # test_encode -A -s</div>
</div><!-- fragment --><hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
