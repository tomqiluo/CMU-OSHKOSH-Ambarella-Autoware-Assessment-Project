<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: BASIC - Data Dumping</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d1/d3e/fs_basic_data_dump.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASIC - Data Dumping </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="data_dump"></a>
1. Data Dumping</h1>
<p >The data is generated by the DSP, including Bayer pattern RAW data, YUV 420 and YUV 422 data from source canvases. ME1 data from source canvases and Motion Vector (MV) data from streams can be dumped for the ArmÂ® application after the DSP enters the preview or the encoding state.</p>
<h2><a class="anchor" id="example_data_dump1"></a>
Example 1: Getting 1080p Raw Data for Calibration (CFA Input Only)</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\       <span class="comment">// For CV5 or CV52</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua\  <span class="comment">// For CV72</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1)</div>
<div class="line">board# test_yuvcap -i 8 -R -f /mnt/</div>
<div class="line">save raw buffer done!</div>
<div class="line">Raw data resolution 1920 <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 1080 with pitch 3840.</div>
<div class="ttc" id="acJSON_8h_html_a788db922597cf2fb6389e278f822e59f"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a></div><div class="ttdeci">const char *const const char *const raw</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a></div><div class="ttdeci">u32 x</div></div>
</div><!-- fragment --><h2><a class="anchor" id="example_data_dump2"></a>
Example 2: Capture 1080p YUV from Canvas 0 with a Blocking Call</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\       <span class="comment">// For CV5 or CV52</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua\</div>
<div class="line">                   -X --bsize 1080p --bmaxsize 1080p</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua\  <span class="comment">// For CV72</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua\</div>
<div class="line">                   -X --bsize 1080p --bmaxsize 1080p)</div>
<div class="line">board# test_yuvcap -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -Y -f 1.yuv -F 1</div>
<div class="line">Delay 0 frame capture YUV data.</div>
<div class="line">Capture YUV cavas(buffer)0: size[1920x1080] in YV12 <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
<div class="ttc" id="acJSON_8h_html_adb411a44855a4c49231d72a0fc9a3b3b"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div><div class="ttdeci">char const int const cJSON_bool format</div></div>
</div><!-- fragment --><h2><a class="anchor" id="example_data_dump3"></a>
Example 3: Capture 480p YUV from Canvas 1 with a Non-blocking Call</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\       <span class="comment">// For CV5 or CV52</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua\</div>
<div class="line">                   -X --bsize 1080p --bmaxsize 1080p -Y --bsize 480p</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua\  <span class="comment">// For CV72</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua\</div>
<div class="line">                   -X --bsize 1080p --bmaxsize 1080p -Y --bsize 480p)</div>
<div class="line">board# test_yuvcap -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 1 -B 1 -Y -f 1.yuv -F 1</div>
<div class="line">Delay 0 frame capture YUV data.</div>
<div class="line">Capture YUV cavas(buffer)1: size[720x480] in YV12 <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div>
</div><!-- fragment --><h2><a class="anchor" id="example_data_dump4"></a>
Example 4: Capture 480p ME Data from Canvas 0 in 30 Frames with a Blocking Call</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\       <span class="comment">// For CV5 or CV52</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua\</div>
<div class="line">                   -X --bsize 1080p --bmaxsize 1080p -Y --bsize 480p</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua\  <span class="comment">// For CV72</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua\</div>
<div class="line">                   -X --bsize 1080p --bmaxsize 1080p -Y --bsize 480p)</div>
<div class="line">board# test_yuvcap -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -M -f 2.me1 -r 30</div>
<div class="line">Delay 0 frame capture me data.</div>
<div class="line">Save_me_buffer: resolution 240x136 with Luma only.</div>
</div><!-- fragment --><h2><a class="anchor" id="example_data_dump5"></a>
Example 5: Capture 480p ME Data from Canvas 1 in 30 Frames with a Blocking Call</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\       <span class="comment">// For CV5 or CV52</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua\</div>
<div class="line">                   -X --bsize 1080p --bmaxsize 1080p -Y --bsize 480p</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua\  <span class="comment">// For CV72</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua\</div>
<div class="line">                   -X --bsize 1080p --bmaxsize 1080p -Y --bsize 480p)</div>
<div class="line">board# test_yuvcap -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 1 -m -f /tmp/1.me1 -r 30</div>
<div class="line">Delay 0 frame capture me data.</div>
<div class="line">Save_me_buffer: resolution 180x120 with Luma only.</div>
</div><!-- fragment --><h2><a class="anchor" id="example_data_dump6"></a>
Example 6: Capture Raw slice Data</h2>
<p >Config "raw_slice_num" and "raw_slice_cached_items" in "chan" section of lua. </p><div class="fragment"><div class="line">...</div>
<div class="line">chan_0 = {</div>
<div class="line">...</div>
<div class="line">    raw_slice_num = 4,</div>
<div class="line">    raw_slice_cached_items = 4,</div>
<div class="line">...</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line">board# init.sh --na</div>
<div class="line">board# modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line"><span class="preprocessor">## For the slice data info only</span></div>
<div class="line">board# test_yuvcap -i 8 -S -f cap_raw_slice -r 20 --info-only</div>
<div class="line"><span class="preprocessor"># For the slice image data</span></div>
<div class="line">board# test_yuvcap -i 8 -S -f cap_raw_slice -r 20</div>
<div class="line"><span class="preprocessor"># For raw slice data and contrast enhance data</span></div>
<div class="line">board# test_yuvcap -i 8 -S -E 1 -f cap_raw_slice -r 20</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="data_dump_raw_dio"></a>
2. Data Dumping: Capture Raw Data via Direct IO</h1>
<p >For the 4K or bigger resolution raw picture, the io with buffer is too slow to write into solid-state drive (SSD) of peripheral component interconnect express (PCIe). To avoid losing the frame due to the low speed, the direct io without buffer is available. It can get the maximum performance of SSD.</p>
<p >@Note: For SSD performance, it is affected by multiple factors such as overheating, insufficient write space and insufficient internal cache, so getting slower in the write process may be caused by the above reasons.</p>
<p >Enable raw pool direct io feature via menuconfig option, clean, and rebuild the SDK.<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; kernel</div>
<div class="line">          -&gt; linux-patch-rmem-dio-choice@<span class="keyword">virtual</span> (kernel/linux-patch) (linux-patch-rmem-dio)</div>
<div class="line">             (X) linux-patch-rmem-dio</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; <span class="keyword">private</span></div>
<div class="line">            -*- ambvideo-header (drv_modules/<span class="keyword">private</span>/video/dsp_v6)</div>
<div class="line">                [*]   Enable Direct IO feature <span class="keywordflow">for</span> <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a> pool.</div>
</div><!-- fragment --> <div class="fragment"><div class="line">build$ make menuconfig_public_linux</div>
<div class="line">   Device Drivers  ---&gt;</div>
<div class="line">       -*- Device Tree and Open Firmware support  ---&gt;</div>
<div class="line">           [*]   Add dio support to rmem</div>
</div><!-- fragment --><p >For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-kernel</div>
<div class="line">                -&gt; linux-patch-rmem-dio-choice@<span class="keyword">virtual</span> (meta-ambabsp/recipes-kernel/linux-patch)</div>
<div class="line">                   (X) linux-unpatch-rmem-dio</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-video</div>
<div class="line">                -&gt; ambvideo-header (meta-ambabsp/recipes-video/ambvideo-header)</div>
<div class="line">                   [*]   Enable Direct IO feature <span class="keywordflow">for</span> <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a> pool.</div>
</div><!-- fragment --> <h2><a class="anchor" id="example_data_8K_raw_dump_via_direct_io"></a>
Example 6: Capture 8K Raw Data from CV5x via Direct IO</h2>
<p >Configure "ext_mem" and "raw_feed_frame_num" in "chan" section of lua. For 8k raw data, the DSP need more memory to cache the frame, so the user should increase "shared" region size, the Lua script can be found <a href="../../script/cv5_vin0_8k_linear_dio.lua" target="_blank"><b>here</b></a>.<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; board (boards)</div>
<div class="line">          -&gt; Memory</div>
<div class="line">             (680) DSP Shared Memory size in MB</div>
</div><!-- fragment --><p >For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-bsp</div>
<div class="line">                -&gt; board (meta-ambabsp/recipes-bsp/board)</div>
<div class="line">                   -&gt; Memory</div>
<div class="line">                      (680) DSP Shared Memory size in MB</div>
</div><!-- fragment --> <div class="fragment"><div class="line">board# init.sh --na;modprobe imx586_mipi vinc_id=0 bus_id=5 cphy=1;test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg cv5_vin0_8k_linear_dio.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# mkdir /amba -p;mount /dev/nvme0n1 /amba/ -t ext4; cd /amba/</div>
<div class="line">board# test_yuvcap -i 0 -R -f cap_raw -r 1 -D</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="data_dump_mv"></a>
3. Data Dumping:  MV Dump</h1>
<p >To use MV dump, users should specify the size of MV buffer first as below.<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; <span class="keyword">private</span></div>
<div class="line">             -*- ambvideo-header (drv_modules/<span class="keyword">private</span>/video/dsp_v6)</div>
<div class="line">                 (0x0200000) IAV Motion Vector Buffer Size</div>
</div><!-- fragment --><p >For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-bsp</div>
<div class="line">                -&gt; recipes-video</div>
<div class="line">                   -&gt; ambvideo-header (meta-ambabsp/recipes-video/ambvideo-header)</div>
<div class="line">                      (0x0200000) IAV Motion Vector Buffer Size</div>
</div><!-- fragment --> <h2><a class="anchor" id="example_mv_dump1"></a>
Example 7: Capture 720p MV Data with Blocking Way</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua</div>
<div class="line">board# test_encode -X --bsize 1080p --bmaxsize 1080p -A --mv-statis-enable 1</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua\   <span class="comment">// For CV72</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua</div>
<div class="line">    board# test_encode -X --bsize 1080p --bmaxsize 1080p -A --mv-statis-enable 1)</div>
<div class="line">board# test_encode -A -h720p -e</div>
<div class="line">board# test_statistics -A -d 1 -b 0</div>
</div><!-- fragment --><h2><a class="anchor" id="example_mv_dump2"></a>
Example 8: Capture 720p Continuous MV Data with Blocking Way</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua</div>
<div class="line">board# test_encode -X --bsize 1080p --bmaxsize 1080p -A --mv-statis-enable 1</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua\   <span class="comment">// For CV72</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua</div>
<div class="line">    board# test_encode -X --bsize 1080p --bmaxsize 1080p -A --mv-statis-enable 1)</div>
<div class="line">board# test_encode -A -h720p -e</div>
<div class="line">board# test_statistics -A -d 1 -b 0 -c</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="data_dump_qp_hist"></a>
4. QP Histogram Dump for AVC and HEVC</h1>
<p >Before dumping, specify the number of streams that need to dump QP histogram as image audio video (IAV) driver needs to allocate extra memory to store QP histogram data. Configure menuconfig as follows:<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; <span class="keyword">private</span></div>
<div class="line">             -*- ambvideo-header (drv_modules/<span class="keyword">private</span>/video/dsp_v6)</div>
<div class="line">                 (1)   IAV Pic Statistics Dump Stream Num</div>
</div><!-- fragment --><p >For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-bsp</div>
<div class="line">                -&gt; recipes-video</div>
<div class="line">                   -&gt; ambvideo-header (meta-ambabsp/recipes-video/ambvideo-header)</div>
<div class="line">                      (1)   IAV Pic Statistics Dump Stream Num</div>
</div><!-- fragment --> <h2><a class="anchor" id="example_avc_qp_hist_dump"></a>
Example 9: Display QP Histogram Dump of 1 Frame for AVC</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua \        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">            --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua \   <span class="comment">// For CV72</span></div>
<div class="line">            --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)</div>
<div class="line">board# test_encode -A -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -h 1080p --pic-statis-enable 1 -e</div>
<div class="line">board# test_statistics -A -d 2 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0</div>
</div><!-- fragment --><p> The result is as follows: </p><div class="fragment"><div class="line">data offset:    8000</div>
<div class="line"><a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>:  1920    <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>: 1080    pitch:  1920</div>
<div class="line">start_pts:      879430730</div>
<div class="line">arm_pts:        5589958</div>
<div class="line">******************<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a> data******************</div>
<div class="line">QP histogram:</div>
<div class="line">------------------------</div>
<div class="line">QP value  |  mbs_per_cat</div>
<div class="line">------------------------</div>
<div class="line">   21      |     421</div>
<div class="line">   22      |     3778</div>
<div class="line">   23      |     1706</div>
<div class="line">   24      |     2255</div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a></div><div class="ttdeci">u32 width</div></div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a></div><div class="ttdeci">u32 height</div></div>
</div><!-- fragment --> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Param   </th><th class="markdownTableHeadLeft">Information    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">width   </td><td class="markdownTableBodyLeft">The frame width    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">height   </td><td class="markdownTableBodyLeft">The frame height    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">pitch   </td><td class="markdownTableBodyLeft">The frame pitch    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">QP_value[4]   </td><td class="markdownTableBodyLeft">QP values. The AVC / HEVC encoder uses 4 QP values in one encoded frame    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">mbs_per_cat[4]   </td><td class="markdownTableBodyLeft">The macro blocks number with corresponding QP value   </td></tr>
</table>
<h2><a class="anchor" id="example_hevc_qp_hist_dump"></a>
Example 10: Display QP Histogram Dump of 1 Frame for CV5x HEVC with Dual Core Spatial Mode</h2>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua \</div>
<div class="line">            --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -H 1080p --pic-statis-enable 1 -e</div>
<div class="line">board# test_statistics -A -d 2 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0</div>
</div><!-- fragment --><p >The result is as follows: </p><div class="fragment"><div class="line">core_0 data offset:     a000</div>
<div class="line">core_1 data offset:     c000</div>
<div class="line"><a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>:  1920    <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>: 1080    pitch:  1920</div>
<div class="line">start_pts:      2766288538</div>
<div class="line">arm_pts:        19409717</div>
<div class="line"> </div>
<div class="line">********************************************</div>
<div class="line">qp_histogram:</div>
<div class="line">-----------------------------</div>
<div class="line">QP value   |  mbs_per_cat</div>
<div class="line">-----------------------------</div>
<div class="line">   21      |     148</div>
<div class="line">   22      |     9234</div>
<div class="line">   23      |     16786</div>
<div class="line">   24      |     6232</div>
</div><!-- fragment --> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Param   </th><th class="markdownTableHeadLeft">Information    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">width   </td><td class="markdownTableBodyLeft">The frame width    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">height   </td><td class="markdownTableBodyLeft">The frame height    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">pitch   </td><td class="markdownTableBodyLeft">The frame pitch    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">QP_value[4]   </td><td class="markdownTableBodyLeft">QP values. The AVC / HEVC encoder uses 4 QP values in one encoded frame    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">mbs_per_cat[4]   </td><td class="markdownTableBodyLeft">The macro blocks number with corresponding QP value   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="data_dump_idsp_motion"></a>
5. Dump and Display IDSP Motion Data with Encode Mode 5/9</h1>
<p >Currently, only encode mode 5 and mode 9 support dump motion data. Before dumping, user need to enable the flag of "motion_output_enable" in lua.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">chan_0 = {</div>
<div class="line">...</div>
<div class="line">    motion_output_enable = 1,</div>
<div class="line">...</div>
<div class="line">}</div>
</div><!-- fragment --><p >Eaxmple: Motion data dump and display on mode 5:</p>
<p >The VOUT lua script for motion display can be found in <a href="../../script/motion_data_display_vout_hdmi.lua" target="_blank"><b>vout_hdmi.lua</b></a>. </p><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear.lua \        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">            --vout-cfg /root/vout_hdmi.lua --enc-mode 5</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_4k_linear.lua \   <span class="comment">// For CV72</span></div>
<div class="line">            --vout-cfg /root/vout_hdmi.lua --enc-mode 5)</div>
<div class="line"> </div>
<div class="line"># For motion data dump</div>
<div class="line">board# test_yuvcap -c 0 --motion -f mo_test -r 20</div>
<div class="line"> </div>
<div class="line"># For motion data display on vout by osd</div>
<div class="line">board# rmmod ambarella_fb;modprobe ambarella_fb mode=ayuv8888  buffernum=3</div>
<div class="line">board# test_idsp_motion -t 1 -v 2 -c 0 -m 0 -S1 -a 255</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># For motion data display on stream by overlay</span></div>
<div class="line">board# test_encode --resource-cfg --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear.lua --enc-mode 5 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --vout-cfg /root/vout_hdmi.lua \</div>
<div class="line">            --img-scale 1 --img-scale-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 2 --img-scale-max-in 1920x1080 --img-scale-max-out 1920x1080 --img-scale-job-queue-depth 8</div>
<div class="line">board# test_encode -C -b3 -H480p -e</div>
<div class="line">board# test_idsp_motion -t0 -s2 -e1 -c0 -m 0 -d 0 -a 255</div>
</div><!-- fragment --><p >Below is an illustration of motion data mapped to YUV400 format.</p>
<div class="image">
<img src="../../motion_data.png" alt=""/>
<div class="caption">
Figure 5-1. Motion Data Image.</div></div>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The motion data size is 1/256 of the vin resolution (width and height divided by 16).</li>
<li>Every byte of motion data represents the intensity of motion mapped to the vin region at that index location.</li>
<li>The value of motion data (0 to 255) indicates the motion intensity. "0" indicates that there is no motion, and "255" indicates that the motion is the strongest. </li>
</ul>
</dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
