<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: ADVANCED - Poll Interface</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d1/d67/fs_adv_iav_poll.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">ADVANCED - Poll Interface </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="iav_poll_intro"></a>
1. Introduction to Poll</h1>
<h2><a class="anchor" id="query_iav_data_intro"></a>
1.1 Poll Interface to Query IAV Data</h2>
<p >The image audio video(IAV) driver supports poll interface to query the IAV data. It waits for one of a series of events to become ready to perform I/O. These events include the <b>IAV_DESC_FRAME</b>, <b>IAV_DESC_STATIS</b>, <b>IAV_DESC_RAW</b>, <b>IAV_DESC_CANVAS</b>, <b>IAV_DESC_PYRAMID</b>, <b>IAV_DESC_Y12</b>, <b>IAV_DESC_PRE_COUNT</b> and so on. The caller should specify the events of interested before the poll. And then using the poll API to wait for the events ready. This feature supports the multiple users and can poll multiple events at one time.</p>
<h2><a class="anchor" id="irq_sync_intro"></a>
1.2 Poll Interface to Sync Irq</h2>
<p >IAV driver supports to use standard poll mechanism to synchronize with different DSP interrupts. With this feature users can synchronize their operations to the interrupt. IAV driver supports vcap, vdsp, vapi, and venc interrupt sync now. IAV driver creates vcap, vdsp, and venc proc file for interrupt sync. Vcap proc file is created for per channel and venc proc file is created for per stream. Users can use the proc file to synchronize the certain interrupt, please check unit_test/private/iav_test/dsp_v6/test_irq_sync.c</p>
<hr  />
<h1><a class="anchor" id="section_iav_poll_example"></a>
2. Examples of Using Poll Interface</h1>
<h2><a class="anchor" id="query_iav_data_example_intro"></a>
2.1 Examples of Querying IAV Data</h2>
<h3><a class="anchor" id="example_iav_poll_data1"></a>
Example 2.1.1: Query Pyramid Data Using Poll</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_poll -p 0</div>
</div><!-- fragment --><h3><a class="anchor" id="example_iav_poll_data2"></a>
Example 2.1.2: Query Canvas Data Using Poll</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_poll -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 1</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --><h3><a class="anchor" id="example_iav_poll_data3"></a>
Example 2.1.3: Query Raw Data Using Poll</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_poll -r 8</div>
</div><!-- fragment --><h3><a class="anchor" id="example_iav_poll_data4"></a>
Example 2.1.4: Query Frame Using Poll</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -e</div>
<div class="line">board# test_poll -f</div>
</div><!-- fragment --><h3><a class="anchor" id="example_iav_poll_data5"></a>
Example 2.1.5: Query Statis Data Using Poll</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -h 1080p --mv-statis-enable 1 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -e</div>
<div class="line">board# test_poll -S 0</div>
</div><!-- fragment --><h3><a class="anchor" id="example_iav_poll_data6"></a>
Example 2.1.6: Query Y12 Using Poll</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_poll -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 0</div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a></div><div class="ttdeci">u32 y</div></div>
</div><!-- fragment --><h3><a class="anchor" id="example_iav_poll_data7"></a>
Example 2.1.7: Query Data with the Multi-User Using Poll</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_dual_chan_single_sensor.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_dual_chan_single_sensor.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
<div class="line">console1 :board#test_poll -r 8 -p 0 -p 1</div>
<div class="line">console2 :board#test_poll -r 8 -p 0 -p 1</div>
</div><!-- fragment --><h2><a class="anchor" id="irq_sync_example_intro"></a>
2.2 Examples of Using Interrupt Synchronization</h2>
<h3><a class="anchor" id="example_vdsp_irq_sync"></a>
Example 2.2.1: Vdsp irq sync</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_irq_sync -d</div>
</div><!-- fragment --><h3><a class="anchor" id="example_vcap_irq_sync"></a>
Example 2.2.2: Vcap Irq Sync</h3>
<p >An example of channel 0 is provided as shown below.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_irq_sync -c -C 0</div>
</div><!-- fragment --><h3><a class="anchor" id="example_venc_irq_sync"></a>
Example 2.2.3: Venc Irq Sync</h3>
<p >An example of stream 0 is provided as shown below.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-mode 0)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -h1080p -e</div>
<div class="line">board# test_irq_sync -e -s 0</div>
</div><!-- fragment --><h1><a class="anchor" id="section_poll_usage"></a>
3. Poll Interface Usage</h1>
<h2><a class="anchor" id="poll_iav_data_usage"></a>
3.1 Usage of Querying IAV Data</h2>
<p >Set the events to monitor: </p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_structRef" href="../../../library/d6/ddf/structiav__poll__event__config.html">iav_poll_event_config</a> poll_configs;</div>
<div class="line"><span class="keyword">struct </span><a class="code hl_structRef" href="../../../library/d3/d28/structiav__querydesc__event.html">iav_querydesc_event</a> *desc_event;</div>
<div class="line"> </div>
<div class="line">desc_event = &amp;poll_configs.desc_event[0];</div>
<div class="line">desc_event-&gt;<a class="code hl_variableRef" href="../../../library/d3/d28/structiav__querydesc__event.html#aa73b12ace6ac7df824707a89ac4f91ff">qid</a> = <a class="code hl_variableRef" href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a94a321e201e898d629d61d2f6b625543">IAV_DESC_PYRAMID</a>;</div>
<div class="line">desc_event-&gt;<a class="code hl_variableRef" href="../../../library/d3/d28/structiav__querydesc__event.html#a23c17b01e4aa1994c60d1c07375029fd">arg</a>.<a class="code hl_variableRef" href="../../../library/d3/d28/structiav__querydesc__event.html#aee4f58e874fb61fded3827dd6edf80b5">pyramid</a>.<a class="code hl_variableRef" href="../../../library/de/d03/structiav__pyramiddesc__event.html#a39de1e60caa4197c587bedef84d1eee7">chan_id</a> = 0;</div>
<div class="line">desc_event = &amp;poll_configs.desc_event[1];</div>
<div class="line">desc_event-&gt;<a class="code hl_variableRef" href="../../../library/d3/d28/structiav__querydesc__event.html#aa73b12ace6ac7df824707a89ac4f91ff">qid</a> = <a class="code hl_variableRef" href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a>;</div>
<div class="line">desc_event-&gt;<a class="code hl_variableRef" href="../../../library/d3/d28/structiav__querydesc__event.html#a23c17b01e4aa1994c60d1c07375029fd">arg</a>.<a class="code hl_variableRef" href="../../../library/d3/d28/structiav__querydesc__event.html#a57c75efef8946cb49513ebb667a88c8b">canvas</a>.<a class="code hl_variableRef" href="../../../library/d1/daf/structiav__canvasdesc__event.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a> = 0;</div>
<div class="line">poll_configs.valid_num = 2;</div>
<div class="line"><span class="keywordflow">if</span> (ioctl(<a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a>, IAV_IOC_SET_POLL_EVENT_CFG, &amp;poll_configs) &lt; 0) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;IAV_IOC_SET_POLL_EVENT_CFG error\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172a94a321e201e898d629d61d2f6b625543"><div class="ttname"><a href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a94a321e201e898d629d61d2f6b625543">IAV_DESC_PYRAMID</a></div><div class="ttdeci">IAV_DESC_PYRAMID</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e"><div class="ttname"><a href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a></div><div class="ttdeci">IAV_DESC_CANVAS</div></div>
<div class="ttc" id="astructiav__canvasdesc__event_html_ae8cabdc5c24b46705eb7ad5e0fc54660"><div class="ttname"><a href="../../../library/d1/daf/structiav__canvasdesc__event.html#ae8cabdc5c24b46705eb7ad5e0fc54660">iav_canvasdesc_event::canvas_id</a></div><div class="ttdeci">u8 canvas_id</div></div>
<div class="ttc" id="astructiav__poll__event__config_html"><div class="ttname"><a href="../../../library/d6/ddf/structiav__poll__event__config.html">iav_poll_event_config</a></div></div>
<div class="ttc" id="astructiav__pyramiddesc__event_html_a39de1e60caa4197c587bedef84d1eee7"><div class="ttname"><a href="../../../library/de/d03/structiav__pyramiddesc__event.html#a39de1e60caa4197c587bedef84d1eee7">iav_pyramiddesc_event::chan_id</a></div><div class="ttdeci">u8 chan_id</div></div>
<div class="ttc" id="astructiav__querydesc__event_html"><div class="ttname"><a href="../../../library/d3/d28/structiav__querydesc__event.html">iav_querydesc_event</a></div></div>
<div class="ttc" id="astructiav__querydesc__event_html_a23c17b01e4aa1994c60d1c07375029fd"><div class="ttname"><a href="../../../library/d3/d28/structiav__querydesc__event.html#a23c17b01e4aa1994c60d1c07375029fd">iav_querydesc_event::arg</a></div><div class="ttdeci">union iav_querydesc_event::@70 arg</div></div>
<div class="ttc" id="astructiav__querydesc__event_html_a57c75efef8946cb49513ebb667a88c8b"><div class="ttname"><a href="../../../library/d3/d28/structiav__querydesc__event.html#a57c75efef8946cb49513ebb667a88c8b">iav_querydesc_event::canvas</a></div><div class="ttdeci">struct iav_canvasdesc_event canvas</div></div>
<div class="ttc" id="astructiav__querydesc__event_html_aa73b12ace6ac7df824707a89ac4f91ff"><div class="ttname"><a href="../../../library/d3/d28/structiav__querydesc__event.html#aa73b12ace6ac7df824707a89ac4f91ff">iav_querydesc_event::qid</a></div><div class="ttdeci">enum iav_desc_id qid</div></div>
<div class="ttc" id="astructiav__querydesc__event_html_aee4f58e874fb61fded3827dd6edf80b5"><div class="ttname"><a href="../../../library/d3/d28/structiav__querydesc__event.html#aee4f58e874fb61fded3827dd6edf80b5">iav_querydesc_event::pyramid</a></div><div class="ttdeci">struct iav_pyramiddesc_event pyramid</div></div>
<div class="ttc" id="avin__init_8c_html_a5294002f7dca0cd9bcc0009a27895ef7"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a></div><div class="ttdeci">int fd_iav</div></div>
</div><!-- fragment --><p >Wait for the event ready and process it: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>pollfd fds;</div>
<div class="line"><span class="keyword">struct </span><a class="code hl_structRef" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> query_desc;</div>
<div class="line"> </div>
<div class="line">fds.fd = <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a>;</div>
<div class="line">fds.events = POLLIN | POLLERR;</div>
<div class="line"><span class="keywordflow">if</span> (poll(&amp;fds, 1, -1) &lt; 0) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;poll error\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  printf(<span class="stringliteral">&quot;poll success revents=%x\n&quot;</span>, fds.revents);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (fds.revents &amp; POLLERR) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;poll get POLLERR\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (fds.revents &amp; POLLIN) {</div>
<div class="line">  memset(&amp;query_desc, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_structRef" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a>));</div>
<div class="line">  query_desc.qid = <a class="code hl_variableRef" href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172aa5015605752ce8aa4ada041436022b50">IAV_DESC_POLL</a>;</div>
<div class="line">  <span class="keywordflow">if</span> (ioctl(<a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a>, IAV_IOC_QUERY_DESC, &amp;query_desc) &lt; 0) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;IAV_IOC_QUERY_DESC error\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">switch</span> (query_desc.qid) {</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_variableRef" href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a94a321e201e898d629d61d2f6b625543">IAV_DESC_PYRAMID</a>:</div>
<div class="line">  <span class="comment">// Process data</span></div>
<div class="line">  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_variableRef" href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a>:</div>
<div class="line">  <span class="comment">// Process data</span></div>
<div class="line">  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_variableRef" href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a613e1aa4924d1c0f8367b06cd6322116">IAV_DESC_RAW</a>:</div>
<div class="line">  <span class="comment">// Process data</span></div>
<div class="line">  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_variableRef" href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a05a4e65f2c13698887b00b1c3ecc78f9">IAV_DESC_FRAME</a>:</div>
<div class="line">  <span class="comment">// Process data</span></div>
<div class="line">  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_variableRef" href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a9db6861f7e2f95821346bb4f9da4c4c3">IAV_DESC_STATIS</a>:</div>
<div class="line">  <span class="comment">// Process data</span></div>
<div class="line">  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_variableRef" href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a3784fa76ec935f974d8c9b198b191626">IAV_DESC_PRE_COUNT</a>:</div>
<div class="line">  <span class="comment">// Process data</span></div>
<div class="line">  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="keywordflow">default</span>:</div>
<div class="line">  printf(<span class="stringliteral">&quot;unknown poll type\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172a05a4e65f2c13698887b00b1c3ecc78f9"><div class="ttname"><a href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a05a4e65f2c13698887b00b1c3ecc78f9">IAV_DESC_FRAME</a></div><div class="ttdeci">IAV_DESC_FRAME</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172a3784fa76ec935f974d8c9b198b191626"><div class="ttname"><a href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a3784fa76ec935f974d8c9b198b191626">IAV_DESC_PRE_COUNT</a></div><div class="ttdeci">IAV_DESC_PRE_COUNT</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172a613e1aa4924d1c0f8367b06cd6322116"><div class="ttname"><a href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a613e1aa4924d1c0f8367b06cd6322116">IAV_DESC_RAW</a></div><div class="ttdeci">IAV_DESC_RAW</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172a9db6861f7e2f95821346bb4f9da4c4c3"><div class="ttname"><a href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a9db6861f7e2f95821346bb4f9da4c4c3">IAV_DESC_STATIS</a></div><div class="ttdeci">IAV_DESC_STATIS</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172aa5015605752ce8aa4ada041436022b50"><div class="ttname"><a href="../../../driver/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172aa5015605752ce8aa4ada041436022b50">IAV_DESC_POLL</a></div><div class="ttdeci">IAV_DESC_POLL</div></div>
<div class="ttc" id="astructiav__querydesc_html"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a></div></div>
</div><!-- fragment --><p >Clear the setting: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (ioctl(<a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a>, IAV_IOC_CLEAR_POLL_EVENT_CFG, NULL) &lt; 0) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;IAV_IOC_CLEAR_POLL_EVENT_CFG error\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="poll_irq_sync_usage"></a>
3.2 Usage of Interrupt Synchronization</h2>
<p >The following is the sample code for IAV vdsp synchronization usage.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> fd;</div>
<div class="line"><span class="keyword">struct </span>pollfd fds = {0};</div>
<div class="line"><span class="keywordflow">if</span> ((fd = open(<span class="stringliteral">&quot;/proc/ambarella/vdsp_sync&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;Open %s error!\n&quot;</span>, name);</div>
<div class="line">  return ;</div>
<div class="line">}</div>
<div class="line">fds.fd = fd;</div>
<div class="line">fds.events = POLLIN | POLLERR;</div>
<div class="line"><span class="comment">// clear the old data</span></div>
<div class="line">poll(&amp;fds, 1, 0);</div>
<div class="line"><span class="keywordflow">while</span> (!quit_loop) {</div>
<div class="line">  rval = poll(&amp;fds, 1, WAIT_2S);</div>
<div class="line">  <span class="keywordflow">if</span>(rval &lt; 0) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;poll error!\n&quot;</span>);</div>
<div class="line">    return ;</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rval == 0) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;poll timeout!\n&quot;</span>);</div>
<div class="line">    return ;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    printf(<span class="stringliteral">&quot;poll success!\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (fds.revents &amp; POLLERR) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;vdsp irq sync get POLLERR\n&quot;</span>);</div>
<div class="line">    return ;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (fds.revents &amp; POLLIN) {</div>
<div class="line">    <span class="comment">//Doing user operations here.</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p >The following is the sample code for IAV vcap sync usage. Vcap proc file is created for per channel. The code for channel 0 is as below.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> fd;</div>
<div class="line"><span class="keyword">struct </span>pollfd fds = {0};</div>
<div class="line"><span class="keywordflow">if</span> ((fd = open(<span class="stringliteral">&quot;/proc/ambarella/vcap_0_sync&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;Open %s error!\n&quot;</span>, name);</div>
<div class="line">  return ;</div>
<div class="line">}</div>
<div class="line">fds.fd = fd;</div>
<div class="line">fds.events = POLLIN | POLLERR;</div>
<div class="line"><span class="comment">// clear the old data</span></div>
<div class="line">poll(&amp;fds, 1, 0);</div>
<div class="line"><span class="keywordflow">while</span> (!quit_loop) {</div>
<div class="line">  rval = poll(&amp;fds, 1, WAIT_2S);</div>
<div class="line">  <span class="keywordflow">if</span>(rval &lt; 0) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;poll error!\n&quot;</span>);</div>
<div class="line">    return ;</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rval == 0) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;poll timeout!\n&quot;</span>);</div>
<div class="line">    return ;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    printf(<span class="stringliteral">&quot;poll success!\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (fds.revents &amp; POLLERR) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;vdsp irq sync get POLLERR\n&quot;</span>);</div>
<div class="line">    return ;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (fds.revents &amp; POLLIN) {</div>
<div class="line">    <span class="comment">//Doing user operations here.</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p >The following is the sample code for IAV venc sync usage. Venc proc file is created for per stream. The code for stream 0 is as below.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> fd;</div>
<div class="line"><span class="keyword">struct </span>pollfd fds = {0};</div>
<div class="line"><span class="keywordflow">if</span> ((fd = open(<span class="stringliteral">&quot;/proc/ambarella/venc_0_sync&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;Open %s error!\n&quot;</span>, name);</div>
<div class="line">  return ;</div>
<div class="line">}</div>
<div class="line">fds.fd = fd;</div>
<div class="line">fds.events = POLLIN | POLLERR;</div>
<div class="line"><span class="comment">// clear the old data</span></div>
<div class="line">poll(&amp;fds, 1, 0);</div>
<div class="line"><span class="keywordflow">while</span> (!quit_loop) {</div>
<div class="line">  rval = poll(&amp;fds, 1, WAIT_2S);</div>
<div class="line">  <span class="keywordflow">if</span>(rval &lt; 0) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;poll error!\n&quot;</span>);</div>
<div class="line">    return ;</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rval == 0) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;poll timeout!\n&quot;</span>);</div>
<div class="line">    return ;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    printf(<span class="stringliteral">&quot;poll success!\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (fds.revents &amp; POLLERR) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;vdsp irq sync get POLLERR\n&quot;</span>);</div>
<div class="line">    return ;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (fds.revents &amp; POLLIN) {</div>
<div class="line">    <span class="comment">//Doing user operations here.</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
