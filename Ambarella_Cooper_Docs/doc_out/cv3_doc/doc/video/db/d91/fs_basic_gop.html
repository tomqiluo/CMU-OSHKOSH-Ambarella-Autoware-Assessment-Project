<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: BASIC - GOP</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('db/d91/fs_basic_gop.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASIC - GOP </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Before GOP (Group of Pictures) introduction, the table below is a simple description for different frame types. The encode priority is I &gt; Q &gt; P &gt; B &gt; C &gt; D. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Frame Type   </th><th class="markdownTableHeadCenter">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">I frame   </td><td class="markdownTableBodyCenter">The key I frame    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Q frame   </td><td class="markdownTableBodyCenter">Important P frame, such as fast seek P, long term P and some special encoded P frames    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">P frame   </td><td class="markdownTableBodyCenter">Normal P frame when using simple GOP <br  />
Level 0 P frame when using SVC-T GOP    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">B frame   </td><td class="markdownTableBodyCenter">Normal B frame when using simple GOP <br  />
Level 1 P frame when using SVC-T GOP    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">C frame   </td><td class="markdownTableBodyCenter">Level 2 P frame when using SVC-T GOP    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">D frame   </td><td class="markdownTableBodyCenter">Level 3 P frame when using SVC-T GOP   </td></tr>
</table>
<p >Different GOP model means different reference relationship for P frame. These GOP models as below are supported. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">GOP Model   </th><th class="markdownTableHeadCenter">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Simple GOP   </td><td class="markdownTableBodyCenter">1-ref P without fast-seek    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Fast seek GOP   </td><td class="markdownTableBodyCenter">1-ref P with fast-seek    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Two ref GOP   </td><td class="markdownTableBodyCenter">2-ref P(2 short-ref or short-ref + long-ref) without fast-seek    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Fast seek with 2 ref GOP   </td><td class="markdownTableBodyCenter">2-ref P(short-ref + long-ref) with fast-seek    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">2 level SVC-T GOP   </td><td class="markdownTableBodyCenter">Scalable video coding temporal GOP with 2 layer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">3 level SVC-T GOP   </td><td class="markdownTableBodyCenter">Scalable video coding temporal GOP with 3 layer   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>The default encode core mode is "dual core temporal", which only supports SVC-T GOP.<br  />
 Users need to set the core mode as "single core" or "dual core spatial" to run other GOPs.<br  />
 For more dual core mode usage, please refer <a class="el" href="../../d5/d7d/fs_basic_stream.html#subsection_encoder_dual_cores">1.14 Encoder Dual Cores</a>. For CV72, there is only one VDSP core, so only "single core" with core 0 is supported.</dd></dl>
<h1><a class="anchor" id="gop_simple"></a>
1. Simple GOP</h1>
<h2><a class="anchor" id="gop_simple_without_B"></a>
1.1 Simple GOP without B frame</h2>
<p >The reference relationship in a GOP for a simple reference without B frame is shown below: </p><div class="image">
<img src="../../ut_gop_single_ref.jpg" alt=""/>
<div class="caption">
The Reference Relationship in the GOP for Single Reference without B Frame</div></div>
<h3><a class="anchor" id="example_gop_simple1"></a>
Example 1: Simple GOP without B Frame</h3>
<p >Simple GOP needs to work with dual encode core configurations as below: </p><div class="fragment"><div class="line">stream_0 = {</div>
<div class="line">...........</div>
<div class="line">enc_core_cfg_enable = 1,</div>
<div class="line">enc_core_mode = 0, -- or 3</div>
<div class="line">...........</div>
<div class="line">}</div>
</div><!-- fragment --><p >The Lua script can be found <a href="../../script/stream_gop.lua" target="_blank"><b>here</b></a>. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg stream_gop.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -D -H 1920x1080 -b 3 --gop 0 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="gop_simple_with_B"></a>
1.2 Simple GOP With B Frame</h2>
<p >The reference relationship in a GOP for a simple reference with B frame is shown below: </p><div class="image">
<img src="../../ut_gop_single_ref_withb.jpg" alt=""/>
<div class="caption">
The Reference Relationship in the GOP for a Single Reference with B Frame</div></div>
<h3><a class="anchor" id="example_gop_simple2"></a>
Example 2: Simple GOP with B frame</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg stream_gop.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua -D --max-gop-M 3</div>
<div class="line">board# test_encode -D -H 1920x1080 -b 3 --gop 0 -M 3 -e</div>
</div><!-- fragment --><h1><a class="anchor" id="gop_fast_seek"></a>
2. Fast Seek GOP</h1>
<h2><a class="anchor" id="gop_simple_fast_seek"></a>
2.1 Fast Seek GOP</h2>
<p >The reference relationship in a GOP for simple references with a fast seek is shown below: </p><div class="image">
<img src="../../ut_gop_single_fastseek.jpg" alt=""/>
<div class="caption">
The Reference Relationship in the GOP for a Single Reference with Fast Seek.</div></div>
<p >Important rules for this GOP structure:</p><ul>
<li>The fast seek P frame will take the I / IDR frame as a reference.</li>
<li>The normal P frame will take the I / IDR or fast seek P frame as a reference.</li>
</ul>
<h3><a class="anchor" id="example_gop_fast_seek"></a>
Example 3: Fast seek GOP</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg stream_gop.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -S 3 -H 1920x1080 -b 3 --gop 5 --fast-seek-enable 1 --fast-seek-intvl 3 -e</div>
<div class="line">board# test_encode -S 3 --fast-seek-intvl 6</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>B frame (M &gt; 1) is not supported in fast-seek GOP.</li>
<li>The fast seek interval can be changed on the fly.</li>
</ul>
</dd></dl>
<p>There is a special case of fast seek GOP structure, if every P frame is fast seek P, it means all P frames are referenced from the I / IDR frames. This is like the "non-ref-P" GOP structure. </p><div class="image">
<img src="../../ut_gop_non_ref.jpg" alt=""/>
<div class="caption">
The Reference Relationship of "non-ref-P" GOP (fast-seek-interval = 1)</div></div>
<h3><a class="anchor" id="example_gop_simple3"></a>
Example 4: Special fast seek :"non-ref-P" (fast-seek-interval = 1)</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg stream_gop.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -S 3 -H 1920x1080 -b 3 --gop 5 --fast-seek-enable 1 --fast-seek-intvl 1 -e</div>
</div><!-- fragment --><h1><a class="anchor" id="gop_2ref"></a>
3. Two References GOP</h1>
<p >Two references for P frame (2 Ref) is an advanced feature. Traditionally, one reference is used for each P frame, and this reference frame is used as the short term reference. In order to get a better video quality, the I/IDR frame is added to the reference frame list for each P frame, and treated as the long term reference frame. The long term reference is used by the encoder to encode the static background areas, and the short-term reference is used to encode the motion areas.</p>
<h2><a class="anchor" id="gop_2ref_st_lt"></a>
3.1 Two Reference GOP with Short Term Ref and Long Term Ref</h2>
<p >The reference relationship in a GOP for two simple reference cases is as follows: </p><div class="image">
<img src="../../ut_gop_simple_2ref.jpg" alt=""/>
<div class="caption">
The Reference Relationship in the GOP for Simple 2 Reference</div></div>
<p> Important rules for this feature:</p><ul>
<li>The rate control (RC) is enabled by digital signal processor (DSP) for this feature, which means that DSP runs the bitrate control method to meet the target bitrate as much as possible.</li>
<li>The supported resolution must be no larger than 1080P, due to more internal resources used by DSP in 2-ref over single ref.</li>
<li>Stream rotation is not supported together with this feature as more internal resources are used by DSP.</li>
</ul>
<h3><a class="anchor" id="example_gop_2ref_st_lt"></a>
Example 5: Two reference GOP with short term ref and long term ref</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg stream_gop.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -S 3 -H 1920x1080 -b 3 --gop 6 --max-gop-M 3 -M 1 --two-ref-enable 1 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="gop_2ref_short_term"></a>
3.2 Two Short Term References</h2>
<p >The reference relationship in a GOP for two short term reference cases is as follows: </p><div class="image">
<img src="../../ut_gop_2ref_short_term.jpg" alt=""/>
<div class="caption">
The Reference Relationship in the GOP for 2 Short Term References</div></div>
<p> Important rule for this feature:</p><ul>
<li>There are two reference frames for each P frame, the reference frame are I/IDR/P frame.</li>
</ul>
<h3><a class="anchor" id="example_gop_2ref_short_term"></a>
Example 6: Two short term reference GOP</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg stream_gop.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -S 3 -H 1920x1080 -b 3 --gop 6 --two-ref-enable 1 --two-st-ref 1 -e</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>For the 2 reference short term GOP, <code>--max-gop-M</code> must be set as 3.</dd></dl>
<h1><a class="anchor" id="gop_2ref_fastseek"></a>
4. Two References with Fast Seek GOP</h1>
<dl class="section note"><dt>Note</dt><dd>Only "long term ref + short term ref" 2ref mode is supported with fast seek GOP.</dd></dl>
<h2><a class="anchor" id="gop_2ref_fastseek_without_B"></a>
4.1 Two references with Fast Seek without B Frame</h2>
<p >The advanced two reference cases combine the simple two reference cases together with both fast seek and B frame. The reference relationship in a GOP for the advanced two references case is shown below: </p><div class="image">
<img src="../../ut_gop_simple_adv2ref_without_B.png" alt=""/>
<div class="caption">
The Reference Relationship in the GOP for 2 Ref with Fast-Seek (No B Frames Cases)</div></div>
<p >The advanced two reference cases are as follows:</p><ul>
<li>There is only one reference frame for fast seek P frame, and the reference frame is I/IDR frame. Fast seek function can be implemented based on this single reference relationship.</li>
<li>For the remaining P frames (normal P frames), there are two reference frames. One is the previous P frame, which is used as a short-term reference frame for motion area encoding; the other is I/IDR frame, which is used as a long-term reference frame for static area encoding.</li>
<li>B frames are inserted into the reference frames (I/IDR frame, normal P frame, and fast seek P frame).</li>
</ul>
<p >Important rules for this feature:</p><ul>
<li>The supported resolution must be no larger than 1080P, due to more internal resources used by DSP in two-references than a single reference.</li>
<li>Stream rotation is not supported together with this feature, due to more internal resources used by DSP.</li>
<li>The advanced two reference features are supported in mode 0.</li>
<li>RC is not enabled for fast seek P frame, which may cause bitrate issue. The application needs to take the responsibility to do rate control from the ArmÂ® side.</li>
</ul>
<h3><a class="anchor" id="example_gop_2ref2"></a>
Example 7: Two references with fast seek GOP without B</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg stream_gop.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -S 3 -H 1920x1080 -b 3 --gop 7 --max-gop-M 3 -M 1 --two-ref-enable 1 --fast-seek-enable 1 --fast-seek-intvl 4 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="gop_2ref_fastseek_with_B"></a>
4.3 Two references with Fast Seek with B</h2>
<div class="image">
<img src="../../ut_gop_simple_adv2ref.jpg" alt=""/>
<div class="caption">
The Reference Relationship in the GOP for 2 Ref with fast-seek (2 B Frames Cases)</div></div>
<h3><a class="anchor" id="example_gop_2ref_fastseek_with_B"></a>
Example 8: Two references with fast seek GOP with B</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg stream_gop.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -S 3 -H 1920x1080 -b 3 --gop 7 --max-gop-M 3 -M 3 --two-ref-enable 1 --fast-seek-enable 1 --fast-seek-intvl 12 -e</div>
</div><!-- fragment --><h1><a class="anchor" id="gop_svct"></a>
5. SVC-T</h1>
<p >SVC-T is an advanced feature. Scalable video coding (SVC) standardizes the encoding of a high-quality video bit stream that also contains one or more subset bit streams. There are several ways to implement SVC, such as temporal scalability (frame rate), spatial scalability (picture size), and quality scalability (picture quality).</p>
<h2><a class="anchor" id="gop_svct_hp"></a>
5.1 Hierarchical P GOP</h2>
<p >Hierarchical P GOP supports up to three layers, enabling CV5x to encode multiple layers with different reference frames to form a single bit stream.</p>
<p >As a rate control tool, Hierarchical P GOP divides the video bit stream into several layers. Because frames in higher layers can reference frames in lower layers, while frames in lower layers cannot reference frames in higher layers, higher layers can be discarded without affecting lower layers. A player that supports SVC-T feature can decide which higher video layers needs to be discarded, and decode the rest of the video layers. In order to support SVC-T, the application must use a proper N and GOP structure for streams to encode.</p>
<p >The following figure is a typical example for three layers. Frames in Layer 2 are not referenced by any frame in any other layers, so this layer can be discarded directly without affecting other layers. Frames in Layer 1 are referenced by frames in Layer 2, so the decoder can discard this layer when Layer 2 is already discarded. Layer 0 is referenced by all the other layers, and it cannot be discarded.</p>
<div class="image">
<img src="../../ut_gop_hier_p2.jpg" alt=""/>
<div class="caption">
Two Layers Hierarchical P GOP Structure.</div></div>
<div class="image">
<img src="../../ut_gop_hier_p3.jpg" alt=""/>
<div class="caption">
Three Layers Hierarchical P GOP Structure.</div></div>
<p >There are some limitations for this GOP:</p><ul>
<li>B frames are not supported, which means that M must keep the value of 1.</li>
<li>For CV5x, SVC-T 2 can only work with "Dual Core Temporal" mode. For CV72, SVC-T 2 works with "Single Core 0".</li>
<li>For CV5x, SVC-T 3 HEVC can work with "Single Core (0/1)" (enc_core_mode 0/1), or "Dual Core Spatial" (enc_core_mode 3). For CV72, SVC-T 3 HEVC can work with "Single Core 0".</li>
<li>For CV5x, SVC-T 3 AVC can only work with "Single Core (0/1)" (enc_core_mode 0/1). For CV72, SVC-T 3 AVC can only work with "Single Core 0".</li>
</ul>
<h3><a class="anchor" id="example_gop_svct2"></a>
Example 9: SVC-T 2 GOP</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1920x1080 -b0 --gop 2 -e</div>
</div><!-- fragment --><h3><a class="anchor" id="example_gop_svct3"></a>
Example 10: SVC-T 3 GOP</h3>
<p >SVC-T 3 GOP needs to work with dual encode core configurations. </p><div class="fragment"><div class="line"> stream_0 = {</div>
<div class="line">...........</div>
<div class="line">max_svct_layers_minus_1 = 2,</div>
<div class="line">enc_core_cfg_enable = 1,</div>
<div class="line">enc_core_mode = 0,</div>
<div class="line">...........</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A -H 1920x1080 -b0 --gop 3 -e</div>
<div class="line">board# test_stream -t --split-svct <span class="comment">// Split into 3 files (layer 0 / layer 0+1 / layer 0+1+2)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="gop_svct_fastseek"></a>
5.2 Fast Seek in SVC-T 2/3 Layers</h2>
<p >Fast seek feature is added to 2/3 layers of SVC-T GOP structure this feature.</p>
<p >Below is the reference relation for SVC-T 2/3 layers GOP structure with the fast seek. </p><div class="image">
<img src="../../ut_gop_svct_2l_fs.jpg" alt=""/>
<div class="caption">
2 Layers SVC-T + Fast Seek (Fast Seek Interval = 4)</div></div>
<p >To separate layer / fast seek information in the encoded video, NALU syntax for both AVC and HEVC is used to achieve this. </p><div class="image">
<img src="../../ut_gop_svct_3l_fs.jpg" alt=""/>
<div class="caption">
3 Layers SVC-T + Fast Seek (Fast Seek Interval = 8)</div></div>
<ol type="1">
<li>For AVC, syntax "nal_ref_idc" in NALU header is used to separate different layers and fast seek frames: <br  />
For above figure, the fast seek interval is 8 for 3 layers SVC-T. There are 4 different values:<ul>
<li>For IDR/I frames and fast seek P frames (red and green), nal_ref_idc = 3</li>
<li>For Blue Level 0 frames, nal_ref_idc = 2</li>
<li>For Yellow Level 1 frames, nal_ref_idc = 1</li>
<li>For Purple Level 2 frames, nal_ref_idc = 0</li>
</ul>
</li>
<li>For HEVC, syntax "nuh_temporal_id_plus1" in NALU header is used to separate different layers and fast seek frames: <br  />
For above figure, the fast seek interval is 8 for 3 layers SVC-T. There are 4 different values:<ul>
<li>For IDR/I frames and fast seek P frames (red and green), nuh_temporal_id_plus1 = 1</li>
<li>For Blue Level 0 frames, nuh_temporal_id_plus1 = 2</li>
<li>For Yellow Level 1 frames, nuh_temporal_id_plus1 = 3</li>
<li>For Purple Level 2 frames, nuh_temporal_id_plus1 = 4</li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="example_gop_svct4"></a>
Example 11: 2 layers SVC-T of HEVC with fast seek interval 6</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A --fast-seek-enable 1 --max-svct-layers-minus-1 1</div>
<div class="line">board# test_encode -A -H1080p --gop 2 --fast-seek-intvl 6 -N 30 -e</div>
</div><!-- fragment --><h3><a class="anchor" id="example_gop_svct5"></a>
Example 12: 3 layers SVC-T of AVC with fast seek interval 4</h3>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_encode -A --fast-seek-enable 1 --max-svct-layers-minus-1 2</div>
<div class="line">board# test_encode -A -h1080p --gop 3 --fast-seek-intvl 4 -N 60 -e</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
