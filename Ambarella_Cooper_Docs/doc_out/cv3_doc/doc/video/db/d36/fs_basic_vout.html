<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: BASIC - Video Ouput</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('db/d36/fs_basic_vout.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASIC - Video Ouput </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section_vout_features"></a>
1. Video Output Features</h1>
<p >CV5x / CV72 has three video output (VOUT) controllers: VOUT A, VOUT B, and VOUT C. VOUT A and VOUT B support mobile industry processor interface (MIPI) CSI® and MIPI DSI. VOUT C supports high-definition multimedia interface (HDMI®) and composite video broadcast signal (CVBS). The maximum resolution of VOUT A is 4K. The maximum resolution of VOUT B and VOUT C is 8K.</p>
<div class="image">
<img src="../../pipeline_for_vout.png" alt=""/>
<div class="caption">
Pipeline for VOUT.</div></div>
<h2><a class="anchor" id="vout_mixer"></a>
1.1 Video Output Mixer</h2>
<p >For CV5x chips, there are two VOUT mixers , "VOUT mixer A" for VOUT A and "VOUT mixer B" for VOUT B/C. This means that VOUT B and C shares the same VOUT mixer. For CV72 chip, there are three VOUT mixers , "VOUT mixer A" for VOUT A and "VOUT mixer B" for VOUT B, and "VOUT mixer C" for VOUT C.</p>
<p >VOUT mixer A is affiliated with VOUT A, and VOUT mixer B is affiliated with VOUT B. For CV5x / CV7x platforms, there is no requirement to reuse the VOUT mixer for other purposes, including stream blur. The two VOUT mixers are used only by VOUT modules themselves.</p>
<h2><a class="anchor" id="vout_default_image"></a>
1.2 Video Output: Default Image</h2>
<p >VOUT default image is used to display user-specified image. It can support either YUV422(NV16) or YUV420(NV12) image format. When this feature is enabled, users are not required to specify "preview" type canvas for VOUT.</p>
<p >See <a class="el" href="../../db/d36/fs_basic_vout.html#example_vout_default_image">Example 4: VOUT Default Image</a>. <br  />
</p>
<h2><a class="anchor" id="vout_rotate"></a>
1.3 Video Output: VOUT Rotate</h2>
<p >VOUT rotate is used to run-time rotate the input image at the VOUT stage. When the input resolution is width x height, the VOUT output resolution is height x width. The final display resolution is also height x width.<br  />
 See <a class="el" href="../../db/d36/fs_basic_vout.html#example_vout_rotate">Example 5: VOUT Rotate</a> for typical cases.</p>
<p >Rotate VOUT size and rotate state support changes on the fly. If users must change the VOUT size, they should change corresponding buffer size before VOUT size.<br  />
 See example_vout_rotate_change_on_the_fly for such cases.</p>
<p >One typical use case for the VOUT rotate feature is used together with the image digital signal processor (IDSP) rotate feature.The input image is already pre-rotated at the IDSP stage. Users can use the VOUT rotate feature to rotate the pre-rotated image and to display the unrotated image. For example, when IDSP rotate is used, the VOUT input size may be 720x1280. With VOUT rotate enabled, the VOUT output size would be 1280x720. The final display size is also 1280x720.<br  />
 See example_vout_rotate_mode3 for such cases.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Only progressive VOUT mode can support rotation.</li>
<li>The VOUT rotate feature may require some extra digital signal processor (DSP) internal resources.</li>
<li>VOUT rotate must set an aligned correspond preview buffer size in the Lua file.</li>
<li>VOUT rotate 1080p requires a 1088x1920 preview buffer.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="vout_flip"></a>
1.4 Video Output: VOUT Flip</h2>
<p >VOUT flip is used to flip images horizontally or vertically. It can flip the video or on-screen display (OSD).<br  />
 See <a class="el" href="../../db/d36/fs_basic_vout.html#example_vout_flip">Example 6: VOUT Flip</a> for typical cases.</p>
<h2><a class="anchor" id="no_vout_for_preview"></a>
1.5 Video Output: No VOUT for Preview</h2>
<p >For some scenarios, users may be required to configure VOUT input when entering the preview state, without the VOUT module configured. Users may enable the VOUT module and the display unit on the fly at later stages.</p>
<p >From the DSP perspective, VOUT input data format configuration may be independent from VOUT procedure and output configuration. Users may be required to ensure that the VOUT input format matches the VOUT output format. Otherwise, the video output may be corrupted.</p>
<h2><a class="anchor" id="hdmi_vout_format"></a>
1.6 Video Output: HDMI VOUT Format</h2>
<p >The HDMI controller on CV5x / CV72 systems on chip (SoCs) can support output RGB, YUV422, and YUV444 formats.</p>
<h2><a class="anchor" id="vout_no_reset"></a>
1.7 Video Output: VOUT No Reset During Mode Switch</h2>
<p >Normally, VOUT will be switched off when the IDSP is in the idle state, and VOUT will be reset after entering into the preview state again. In this case, VOUT must be reconfigured again after the idle state.</p>
<p >For some scenarios, may be required to enable VOUT at all times, even when IDSP is in the idle state. For example, users can configure a VOUT on-screen display (OSD) on the display, while performing mode switch between the DSP idle state and preview state in the background. In this case, VOUT OSD is active all the time, while the VOUT video layer is switched between the live sensor input image (in the preview state) and the VOUT background color (in the idle state).</p>
<p >From the DSP perspective, the VOUT module is independent from the IDSP / VDSP modules. This makes it possible to have VOUT functioning with IDSP in the idle state separately. In this case, the VOUT input source will be switched to the VOUT background color. When IDSP is switched to the preview state, VOUT can switch the input source back to the live sensor input.</p>
<p >See <a class="el" href="../../db/d36/fs_basic_vout.html#example_vout_no_reset">Example 8: VOUT No Reset for Mode Switch</a> for typical cases.</p>
<h2><a class="anchor" id="vout_osd_sync"></a>
1.8 Video Output: VOUT OSD Frame Sync</h2>
<p >Users can use vout osd frame sync to allows the osd content of each frame can be precisely synchronized with the frame displayed by vout.</p>
<p >See <a class="el" href="../../db/d36/fs_basic_vout.html#example_vout_osd_sync">Example 9: VOUT OSD Sync</a> for typical cases.</p>
<hr  />
<h1><a class="anchor" id="section_vout_devices"></a>
2. Video Output Devices</h1>
<h2><a class="anchor" id="vout_multi_interface"></a>
2.1 Video Output with Multi-Interface</h2>
<p >The Cooper chip family supports multiple VOUT interfaces, including the following:</p><ul>
<li>HDMI v2.0 output including on-chip PHY with consumer electronic control (CEC) support. HDMI output resolution is up to 8KP60 (no period)</li>
<li>4-lane MIPI DSI / CSI output (no period)</li>
<li>Video digital-to-analog converter (DAC) for 480i / 576i composite PAL / NTSC output</li>
<li>Full screen frame buffer on the analog / digital video output</li>
</ul>
<h2><a class="anchor" id="vout_support_list"></a>
2.2 Video Output: Supported VOUT Interfaces</h2>
<p >The table below lists the supported VOUT Interfaces for each chip in the Cooper family. </p><a class="anchor" id="table_vout_interface"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>VOUT Interface </th><th>CV5 </th><th>CV52 </th><th>CV72 </th></tr>
<tr>
<td>HDMI </td><td>Yes </td><td>Yes </td><td>Yes </td></tr>
<tr>
<td>CVBS </td><td>Yes </td><td>Yes </td><td>Yes </td></tr>
<tr>
<td>MIPI_DSI </td><td>Yes </td><td>Yes </td><td>Yes </td></tr>
<tr>
<td>MIPI_CSI </td><td>Yes </td><td>Yes </td><td>Yes </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="section_vout_examples"></a>
3. Video Output Examples</h1>
<h2><a class="anchor" id="example_hdmi_output"></a>
Example 1: Video Output via HDMI</h2>
<p >First, initialize the evaluation kit (EVK) board to load the essential drivers and microcode, and begin 3A (AE / AWB / AF) statistics if the following command was not executed previously.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a&amp;</div>
</div><!-- fragment --><dl class="section user"><dt>Output Resolution Control</dt><dd></dd></dl>
<p>HDMI with 480p resolution:<br  />
 Modification of vout_hdmi.lua file for 480p: </p><div class="fragment"><div class="line">vout_2 = {</div>
<div class="line">     status = <span class="stringliteral">&quot;on&quot;</span>,</div>
<div class="line">     mode = <span class="stringliteral">&quot;480p&quot;</span>,</div>
<div class="line">     input_yuv422 = <span class="stringliteral">&quot;yes&quot;</span>,</div>
<div class="line">     video_output_window = {0, 0, 720, 480},</div>
<div class="line">     type = <span class="stringliteral">&quot;hdmi&quot;</span>,</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
</div><!-- fragment --><p >HDMI with 720p resolution:</p>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua)  <span class="comment">// For CV72</span></div>
</div><!-- fragment --><p >HDMI with 1080p resolution:</p>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
</div><!-- fragment --><dl class="section user"><dt>Disable VOUT:</dt><dd></dd></dl>
<div class="fragment"><div class="line">board# test_encode -J --btype off</div>
</div><!-- fragment --><h2><a class="anchor" id="example_cvbs_output"></a>
Example 2: Video Output via CVBS</h2>
<p >First, initialize the EVK board to load the essential drivers and microcode, then start 3A statistics if the following command was not executed previously.</p>
<div class="fragment"><div class="line">board# rmmod ambdve</div>
<div class="line">board# modprobe ambdve voutid=2</div>
<div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# modprobe ambarella_fb</div>
<div class="line">board# test_aaa_service -a&amp;</div>
</div><!-- fragment --><p >Video Output: 480i CVBS</p>
<div class="fragment"><div class="line">board# test_encode --resource-cfg ./res_cvbs_2.lua --vout-cfg ./vout2_cvbs.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_vout_size"></a>
Example 3: HDMI Output Size Change on the Fly</h2>
<p >HDMI output size can be changed while encoding or during preview without changing back to the idle state. Before issuing the change command, the preview buffer must be configured to the new output size.</p>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board# test_multi_chan -c 0 -J --boutsize 1280x720</div>
<div class="line">board# test_encode --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>VOUT change on the fly in decoding is not supported.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="example_vout_default_image"></a>
Example 4: VOUT Default Image</h2>
<dl class="section user"><dt>Configure the platform to build test_custom_vout</dt><dd></dd></dl>
<div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line"> -*- Ambarella Unit Test Configuration  ---&gt;</div>
<div class="line">   -*- Ambarella Private Linux Unit test configs  ---&gt;</div>
<div class="line">     -*- Build VOUT unit tests  ---&gt;</div>
<div class="line">       -*- Build Custom VOUT unit tests</div>
</div><!-- fragment --><dl class="section user"><dt>1) Display YUV420(NV12) Image File through VOUT Default Image Function</dt><dd></dd></dl>
<p>Configure VOUT Lua option "vout-from-image" to enable VOUT default image function, and configure VOUT Lua option "default_img_format" is to set image format to YUV420(NV12).</p>
<div class="fragment"><div class="line">vout_2 = {</div>
<div class="line">...........</div>
<div class="line">vout-from-image = <span class="stringliteral">&quot;enable&quot;</span>,</div>
<div class="line">default_img_format= <span class="stringliteral">&quot;yuv420&quot;</span>,</div>
<div class="line">...........</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_custom.lua</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua\   <span class="comment">// For CV72</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_custom.lua)</div>
<div class="line">board# test_mempart -m 2 -s 0x4000000</div>
<div class="line">board# test_custom_vout -i 420.yuv -s 1920x1080</div>
</div><!-- fragment --><dl class="section user"><dt>2) Display YUV420(NV12) Canvas in Live through VOUT Default Image Function</dt><dd></dd></dl>
<p>Configure VOUT Lua option "vout-from-image" to enable VOUT default image function, and configure VOUT Lua option "default_img_format" is to set image format to YUV420(NV12). test_custom_vout option "-b" is used to specify canvas id.</p>
<div class="fragment"><div class="line">vout_2 = {</div>
<div class="line">...........</div>
<div class="line">vout-from-image = <span class="stringliteral">&quot;enable&quot;</span>,</div>
<div class="line">default_img_format= <span class="stringliteral">&quot;yuv420&quot;</span>,</div>
<div class="line">...........</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_custom.lua</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua\   <span class="comment">// For CV72</span></div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_custom.lua)</div>
<div class="line">board# test_custom_vout -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 2</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --><h2><a class="anchor" id="example_vout_rotate"></a>
Example 5: VOUT Rotate</h2>
<p >First, initialize the EVK board to load the essential drivers and microcode, then start 3A process if the following command was not executed previously.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
</div><!-- fragment --><p >Next, in this lua script case, modify the preview buffer size.<br  />
 Set the buffer width corresponding to the VOUT height and align to 32.<br  />
 Set the buffer height corresponding to the VOUT width and align to 16.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">     third = {</div>
<div class="line">             max_output = {0, 0}, -- output <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a></div>
<div class="line">             input      = {0, 0, 0, 0}, -- full <a class="code hl_function" href="../../db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div>
<div class="line">             output     = {0, 0, 720, 1280},</div>
<div class="line">     },</div>
<div class="line">...</div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a></div><div class="ttdeci">u32 width</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> test_vout_cfg.c:85</div></div>
</div><!-- fragment --><div class="fragment"><div class="line">vout_2 = {</div>
<div class="line">     ...</div>
<div class="line">     <a class="code hl_variable" href="../../d4/de8/vout__init_8c.html#a2a6bf30514e846e0156bc3e92e471100">video_rotate</a> = <span class="stringliteral">&quot;yes&quot;</span>,</div>
<div class="line">     ...</div>
<div class="line">}</div>
<div class="ttc" id="avout__init_8c_html_a2a6bf30514e846e0156bc3e92e471100"><div class="ttname"><a href="../../d4/de8/vout__init_8c.html#a2a6bf30514e846e0156bc3e92e471100">video_rotate</a></div><div class="ttdeci">static u32 video_rotate[VOUT_NUM]</div><div class="ttdef"><b>Definition:</b> vout_init.c:96</div></div>
</div><!-- fragment --><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\</div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_vout_flip"></a>
Example 6: VOUT Flip</h2>
<p >First, initialize the EVK board to load the essential drivers and microcode, then start 3A process if the following command was not executed previously.</p>
<div class="fragment"><div class="line">board# init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board# test_aaa_service -a &amp;</div>
</div><!-- fragment --><p >Modification of vout_hdmi.lua file for VOUT flip: </p><div class="fragment"><div class="line">vout_2 = {</div>
<div class="line">     ...</div>
<div class="line">     video_flip_mode = <span class="stringliteral">&quot;v&quot;</span>,                 --selection: 0:no, 1:hv, 2:h, 3:v</div>
<div class="line">     ...</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\</div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><p >Modification of vout_hdmi.lua file for VOUT OSD flip: </p><div class="fragment"><div class="line">vout_2 = {</div>
<div class="line">     ...</div>
<div class="line">     osd_flip_mode = <span class="stringliteral">&quot;v&quot;</span>,                 --selection: 0:no, 1:hv, 2:h, 3:v</div>
<div class="line">     ...</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\</div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_hdmi_vout_format"></a>
Example 7: HDMI VOUT Format</h2>
<p >Modification of vout_hdmi.lua file for HDMI outputs: </p><div class="fragment"><div class="line">vout_2 = {</div>
<div class="line">     ...</div>
<div class="line">     hdmi_output_format = <span class="stringliteral">&quot;rgb&quot;</span>,                     --selection: 0:rgb, 1:yuv422, 2:yuv444</div>
<div class="line">                                                     --only <span class="keywordflow">for</span> hdmi output mode</div>
<div class="line">     ...</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line">board# init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\</div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_vout_no_reset"></a>
Example 8: VOUT No Reset for Mode Switch</h2>
<p >This feature is designed to keep VOUT active at all times during mode switch. The option "--no-vout-reset" is used to enable the option for no-VOUT reset when putting DSP into the idle state or preview state.</p>
<p >Modification of vout_hdmi.lua file for maximum OSD bit depth: </p><div class="fragment"><div class="line">vout_2 = {</div>
<div class="line">   ...</div>
<div class="line">   max_osd_bit_depth = 16,</div>
<div class="line">   ...</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3;</div>
<div class="line">board# test_aaa_service -&amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua\</div>
<div class="line">                   --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vout-possible-map 0x4</div>
<div class="line">board# test_osd -w 720 -h 480 -c colorbar -t 1000 /dev/fb2             <span class="comment">// Run on telnet</span></div>
<div class="line">board# test_encode --idle --nopreview --no-vout-reset</div>
<div class="line">board# test_encode -Y --bsize 720p --bmaxsize 720p --no-vout-reset    <span class="comment">// OSD still displays during mode switch</span></div>
<div class="line">board# test_encode --idle --nopreview --no-vout-reset         <span class="comment">// OSD still displays when iav status switch to idle.</span></div>
</div><!-- fragment --><h2><a class="anchor" id="example_vout_osd_sync"></a>
Example 9: VOUT OSD Sync</h2>
<p >Modification of vout_hdmi.lua file for maximum OSD bit depth: </p><div class="fragment"><div class="line">vout_2 = {</div>
<div class="line">   ...</div>
<div class="line">   max_osd_bit_depth = 16,</div>
<div class="line">   ...</div>
<div class="line">}</div>
</div><!-- fragment --><p> Update "enc_dummy_latency = 2" for the preview type canvas </p><div class="fragment"><div class="line">canvas = {</div>
<div class="line">   .....</div>
<div class="line">  {</div>
<div class="line">        type = <span class="stringliteral">&quot;prev&quot;</span>,</div>
<div class="line">        .....</div>
<div class="line">        enc_dummy_latency = 2,</div>
<div class="line">        .....</div>
<div class="line">  },</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3  <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)      <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_custom_vout -b 2 -o -S</div>
</div><!-- fragment --><h2><a class="anchor" id="example_video_output_via_dsi"></a>
Example 10: Video Output via DSI</h2>
<p >Modification of <code>vout_hdmi.lua</code> file to turn on the DSI output via <code>vout_0</code>: </p><div class="fragment"><div class="line">vout_0 = {</div>
<div class="line">    status = <span class="stringliteral">&quot;on&quot;</span>,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">vout_1 = {</div>
<div class="line">    status = <span class="stringliteral">&quot;disable&quot;</span>,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">vout_2 = {</div>
<div class="line">    status = <span class="stringliteral">&quot;disable&quot;</span>,</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p >Updating option <code>vout_id</code> of the preview canvas in the <code>cv72_vin0_1080p_linear.lua</code>. </p><div class="fragment"><div class="line">canvas = {</div>
<div class="line">  .....</div>
<div class="line">  {</div>
<div class="line">        type = <span class="stringliteral">&quot;prev&quot;</span>,</div>
<div class="line">        .....</div>
<div class="line">        <a class="code hl_variable" href="../../d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a> = 0,</div>
<div class="line">        .....</div>
<div class="line">  },</div>
<div class="line">}</div>
<div class="ttc" id="avout__init_8c_html_a049a525f0e8bc8bee106f89f18f896ce"><div class="ttname"><a href="../../d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a></div><div class="ttdeci">int vout_id</div><div class="ttdef"><b>Definition:</b> vout_init.c:36</div></div>
</div><!-- fragment --><p >After the above preparation, the following steps can launch this feature. </p><div class="fragment"><div class="line">board# rmmod ambdve</div>
<div class="line">board# modprobe ambdve voutid=2</div>
<div class="line">board# modprobe lcd_r69429 voutid=0</div>
<div class="line">board# modprobe ambarella_fb</div>
<div class="line">board# init.sh --na; modprobe imx678_mipi vinc_id=8</div>
<div class="line">(Or board# init.sh --na;modprobe imx678_mipi vinc_id=8 bus_id=3)         <span class="comment">// For CV5</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg cv72_vin0_1080p_linear.lua --vout-cfg vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_video_output_via_csi"></a>
Example 11: Video Output via CSI</h2>
<p >Modification of <code>vout_hdmi.lua</code> file to turn on the CSI output via <code>vout_0</code>: </p><div class="fragment"><div class="line">vout_0 = {</div>
<div class="line">    status = <span class="stringliteral">&quot;on&quot;</span>,</div>
<div class="line">    mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line">    video_output_window = {0, 0, 1920, 1080},   --{offsetx, offsety, output_width, output_heigh}</div>
<div class="line">    type = <span class="stringliteral">&quot;mipi_csi&quot;</span>,                  --selection: digital, mipi_dsi, fpd_link</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">vout_1 = {</div>
<div class="line">    status = <span class="stringliteral">&quot;disable&quot;</span>,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">vout_2 = {</div>
<div class="line">    status = <span class="stringliteral">&quot;disable&quot;</span>,</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p >Updating option <code>vout_id</code> of the preview canvas in the <code>cv72_vin0_1080p_linear.lua</code>. </p><div class="fragment"><div class="line">canvas = {</div>
<div class="line">  .....</div>
<div class="line">  {</div>
<div class="line">        type = <span class="stringliteral">&quot;prev&quot;</span>,</div>
<div class="line">        .....</div>
<div class="line">        <a class="code hl_variable" href="../../d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a> = 0,</div>
<div class="line">        .....</div>
<div class="line">  },</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# rmmod ambdve</div>
<div class="line">board# modprobe ambdve voutid=1</div>
<div class="line">board# init.sh --na; modprobe imx678_mipi vinc_id=8</div>
<div class="line">(Or board# init.sh --na;modprobe imx678_mipi vinc_id=8 bus_id=3)         <span class="comment">// For CV5</span></div>
<div class="line">board# modprobe lcd_r9611 mipi_type=4 dsi_output_mode=11 voutid=0</div>
<div class="line">board# modprobe ambarella_fb</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg cv72_vin0_1080p_linear.lua --vout-cfg vout_hdmi.lua --vout-possible-map 7</div>
</div><!-- fragment --><h2><a class="anchor" id="example_dual_vout"></a>
Example 12: Dual Vout</h2>
<p >Dual Vout is a combination of two individual Vout devices in general.</p>
<p >Select <code>vout_0</code> and <code>vout_2</code> to take an example for this feature. </p><div class="fragment"><div class="line">vout_0 = {</div>
<div class="line">    status = <span class="stringliteral">&quot;on&quot;</span>,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">vout_1 = {</div>
<div class="line">    status = <span class="stringliteral">&quot;disable&quot;</span>,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">vout_2 = {</div>
<div class="line">    status = <span class="stringliteral">&quot;on&quot;</span>,</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p >There are two preview type canvas as the resource of <code>vout_id</code> 0 and 2 </p><div class="fragment"><div class="line">canvas = {</div>
<div class="line">    .....</div>
<div class="line">    {</div>
<div class="line">        type = <span class="stringliteral">&quot;prev&quot;</span>,</div>
<div class="line">        size = {1920, 1080},</div>
<div class="line">        <a class="code hl_variable" href="../../d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a> = 0,</div>
<div class="line">        .....</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        type = <span class="stringliteral">&quot;prev&quot;</span>,</div>
<div class="line">        size = {1920, 1080},</div>
<div class="line">        <a class="code hl_variable" href="../../d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a> = 2,</div>
<div class="line">        .....</div>
<div class="line">    },</div>
<div class="line">}</div>
</div><!-- fragment --><p >CV72 HDMI is assigned by <code>voutid=2</code> and can be as the one of dual VOUT, the other can use <code>lcd_r69429</code> which is assigned by <code>voutid=0</code> </p><div class="fragment"><div class="line">board# rmmod ambdve</div>
<div class="line">board# modprobe ambdve voutid=2</div>
<div class="line">board# rmmod ambarella_fb</div>
<div class="line">board# modprobe ambarella_fb resolution=1920x1080 mode=clut8bpp</div>
<div class="line">board# init.sh --na; modprobe imx678_mipi vinc_id=8</div>
<div class="line">(Or board# init.sh --na;modprobe imx678_mipi vinc_id=8 bus_id=3)     <span class="comment">// For CV5</span></div>
<div class="line">board# modprobe lcd_r69429 voutid=0</div>
<div class="line">board# modprobe ambarella_fb</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">test_encode --resource-cfg cv72_vin0_1080p_linear.lua --vout-cfg vout_hdmi.lua --vout-osd-rescale-disable 1 --vout-possible-map 7</div>
</div><!-- fragment --><h2><a class="anchor" id="example_vout_switch_multi_chan"></a>
Example 13: VOUT Switch Multi-Channel on the Fly</h2>
<p >The VOUT source is able to bind to different channel, so user can switch input source of VOUT on the fly.</p>
<p >For an example, below changes in <code>cv72_vin0_1080p_linear.lua</code> can support for this feature.</p>
<p >User can activate two vin as the video source for two channels.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">    vsrc_id = 0,</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="line">vsrc_1 = {</div>
<div class="line">    vsrc_id = 1,</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p ><code>vsrc_0</code> and <code>vsrc_1</code> in this example bind to channel 1 and channel 2, respectively. The fourth buffer within both channels will be set into preview canvas. </p><div class="fragment"><div class="line">chan_0 = {</div>
<div class="line">   <span class="keywordtype">id</span> = 0,</div>
<div class="line">   vsrc = vsrc_0,</div>
<div class="line">   ......</div>
<div class="line">   fourth = {</div>
<div class="line">       max_output = {1920, 1080},</div>
<div class="line">       input         = {0, 0, 0, 0},</div>
<div class="line">       output   = {0, 0, 1920, 1080},</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line">chan_1 = {</div>
<div class="line">   <span class="keywordtype">id</span> = 1,</div>
<div class="line">   vsrc = vsrc_1,</div>
<div class="line">   ......</div>
<div class="line">   fourth = {</div>
<div class="line">       max_output = {1920, 1080},</div>
<div class="line">       input         = {0, 0, 0, 0},</div>
<div class="line">       output   = {0, 0, 1920, 1080},</div>
<div class="line">   }</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">canvas = {</div>
<div class="line">    .....</div>
<div class="line">    {</div>
<div class="line">        type = <span class="stringliteral">&quot;prev&quot;</span>,</div>
<div class="line">        <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.fourth&quot;</span>, <span class="stringliteral">&quot;chan_1.fourth&quot;</span>},</div>
<div class="line">        <a class="code hl_variable" href="../../d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a> = 2,</div>
<div class="line">        .....</div>
<div class="line">    },</div>
<div class="line">}</div>
<div class="ttc" id="avin__init_8c_html_a07a87b2e6ed927503e2f95f119c9fc23"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a></div><div class="ttdeci">int source</div><div class="ttdef"><b>Definition:</b> vin_init.c:57</div></div>
</div><!-- fragment --><p >The following commands are for VOUT switch. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe max9296 <span class="keywordtype">id</span>=0x0303 vinc_id=0xb8;modprobe os08a10_mipi_brg fsync=1</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg cv72_vin0_1080p_linear.lua --vout-cfg vout_hdmi.lua</div>
<div class="line">board# test_multi_chan -c 1 -K --boutsize 1920x1080 -c 0 -K --boutsize 0x0</div>
<div class="line">board# sleep 2</div>
<div class="line">board# test_multi_chan -c 0 -K --boutsize 1920x1080 -c 1 -K --boutsize 0x0</div>
</div><!-- fragment --><h2><a class="anchor" id="example_vout_underflow_prevention"></a>
Example 14: VOUT Underflow Prevention</h2>
<p >Setting <code>--vout-underflow-prevention</code> value to improve VOUT priority that can avoid some display exceptions, such as artifacts and flicking in VOUT.</p>
<p >This option has impact on the other modules DMA priority, especially when the device is almost overloaded.</p>
<div class="fragment"><div class="line">board# init.sh --na; modprobe imx678_mipi vinc_id=8</div>
<div class="line">(Or board# init.sh --na;modprobe imx678_mipi vinc_id=8 bus_id=3)         <span class="comment">// For CV5</span></div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vout-underflow-prevention 1  <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vout-underflow-prevention 1)  <span class="comment">// For CV72</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
