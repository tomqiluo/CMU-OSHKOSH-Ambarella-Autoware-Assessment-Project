<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: BASIC - Video Input</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d2/d61/fs_basic_vin.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASIC - Video Input </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section_vsrc_features"></a>
1. Video Input Features</h1>
<p >This section describes video input (VIN) features, such as frame rate, bit rate, and resolution.</p>
<p >CV5x / CV72 receives the video input and send it to the VIN controller. Once the video source is ready, CV5x / CV72 then distributes the video source to the <a class="el" href="../../d0/ded/fs_basic_source_buffer.html">source buffer</a> for "preview" and / or "encode" purposes.</p>
<div class="image">
<img src="../../video_input_pipeline.png" alt=""/>
<div class="caption">
Figure 1-1. Video Process Pipeline.</div></div>
<h2><a class="anchor" id="vsrc_resolution"></a>
1.1 Resolution</h2>
<p >Typically, the sensor supports multiple resolutions. Users can choose different resolutions according to their requirements.</p>
<p >By default, the maximum supported VIN resolution for CV5x is <b>7680x4320</b>, and the maximum supported VIN resolution for CV72 is <b>3840x2160</b>.</p>
<h2><a class="anchor" id="vsrc_frame_rate"></a>
1.2 Frame Rate</h2>
<p >Users can control the frame rate of a sensor for different resolutions.</p>
<h2><a class="anchor" id="vsrc_mirror_filp"></a>
1.3 Mirror / Flip</h2>
<p >The VIN controller supports performing mirror / flip operations on the input video source.</p>
<h2><a class="anchor" id="vsrc_hdr"></a>
1.4 High Dynamic Range Mode</h2>
<p >Users can apply high dynamic range (HDR) on the input video source, including HDR 2x and HDR 3x.</p>
<h2><a class="anchor" id="vsrc_yuv"></a>
1.5 YUV Input</h2>
<p >The VIN controller processes YUV data. The following image demonstrates two typical usages for YUV input. In the first case, a high-definition multimedia interface (HDMI®) signal is converted into YUV format via LT6911. In the second case, a native YUV sensor is supported by the VIN controller. For the first case, an advanced feature is supported: users can connect multiple YUV resolution inputs on the fly. Each time when connecting a new YUV resolution input, users should perform a recovery first and then revise the main buffer input resolution.</p>
<div class="image">
<img src="../../video_input_yuv.png" alt=""/>
<div class="caption">
Figure 1-2. YUV Input.</div></div>
<h2><a class="anchor" id="vsrc_multi_vin"></a>
1.6 Multi-VIN</h2>
<p >The Cooper family of chips supports multiple independent sensors, as they are equipped with more than one VIN controller. They support independent 3A (auto white balance (AWB) / auto exposure (AE) / auto focus (AF)) control processes for each VIN. This enables the camera to function as if there are multiple independent cameras operating within a single system on chip (SoC).</p>
<p >The figure below shows two real VINs and a virtual VIN.</p>
<div class="image">
<img src="../../multi_vin_controller.png" alt=""/>
<div class="caption">
Figure 1-3. Multi-VIN.</div></div>
<p >The table below lists the number of VIN controllers for each chip in the Cooper family. </p><a class="anchor" id="table_vsrc_lua"></a>
<table class="doxtable">
<caption>Table 1-1. Number of VIN Controllers in the Cooper family.</caption>
<tr>
<th>Chip </th><th><div style="width:240px"><b>VIN Controller</b></div> </th><th><div style="width:240px"><b>Virtual VIN</b></div> </th></tr>
<tr>
<td>CV5 </td><td align="center">14 </td><td align="center">12 </td></tr>
<tr>
<td>CV52 </td><td align="center">14 </td><td align="center">12 </td></tr>
<tr>
<td>CV72 </td><td align="center">10 </td><td align="center">12 </td></tr>
</table>
<p ><br  />
</p>
<h2><a class="anchor" id="vin_vout_precise_sync"></a>
1.7 VIN-VOUT Precise Synchronization</h2>
<p >In some use cases (such as video conference), there should be no repeated / skipped VIN frames on in the video output (VOUT), which means that each VIN frame should be displayed on VOUT. However, VIN and VOUT do not share the same clock source, so there is a small difference in the frames per second (fps) between the two. This difference leads to repeated / skipped frames on VOUT after a period of time.</p>
<p >For example, if users set VIN / image digital signal processor (IDSP) / VOUT to 30.000 fps, the real VIN fps is 29.999 on the VOUT clock due to the different clock sources. Users will observe a repeated frame on VOUT about every 33.3 seconds (1/(30.000-29.999)=1000 frames).</p>
<p >The VIN-VOUT precise syncronization feature adjusts the VIN fps dynamically according to the observed VOUT fps information. This closed-loop feedback system aids maintaining the same frame rate for both VIN and VOUT.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>This feature depends on the VOUT message from the digital signal processor (DSP), which is reported from the DSP by default. Additionally, users must enable "vin-precise-sync" when entering the preview state.</li>
<li>This feature only supports VIN / IDSP / VOUT in the same fps.</li>
<li>This feature only supports the cases below, and only adjusts the VIN fps, which is the source of the VOUT. <a class="anchor" id="table_vin_precise_sync_supported_casess"></a>
<table class="doxtable">
<caption>Table 1-2. VIN Precise Sync Support Cases.</caption>
<tr>
<th>Cases </th><th>Description </th></tr>
<tr>
<td>Single VIN and single VOUT </td><td>Adjust VIN fps dynamically according to the VOUT fps </td></tr>
<tr>
<td>Single VIN and multiple VOUT </td><td>Users should set "sync-first-vout-frame-mode = 3" first when entering the preview state. This means that DSP will keep VOUT0 synchronized with VOUT1. The driver tunes the VIN fps dynamically according to VOUT0's fps to prevent any repeated / skipped frames on both VOUT0 and VOUT1. See example_first_vout_frame_sync_mode </td></tr>
<tr>
<td>Multiple VIN and single VOUT </td><td>If VOUT is from one VIN, adjust the single VIN fps dynamically according to the VOUT fps. If VOUT is from multiple VINs, users should first maintain the multi-VIN synchronization </td></tr>
<tr>
<td>Multiple VIN and multiple VOUT, and each VOUT is from different VINs </td><td>Adjust the VIN fps dynamically according to the VOUT fps </td></tr>
</table>
</li>
</ul>
</dd></dl>
<p>See <a class="el" href="../../d2/d61/fs_basic_vin.html#example_vin_vout_precise_sync">VIN-VOUT Precise Sync</a>.</p>
<h2><a class="anchor" id="cam_seamless_switch"></a>
1.8 Camera Seamless Switch (CSS)</h2>
<p >To meet user requirements (especially for multi-VIN cases), if one VIN is disabled or broken, the DSP can still enter the preview with that specific VIN. The disabled / broken VIN can switch to enable (or recover) on the fly if the user connects an active sensor to the video source (VSRC). If there are other active channels running in parallel, this channel runtime switch does not affect other channels.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>When the DSP enters the preview with a broken VIN, the buffer from the broken VIN is filled with a black privacy mask (PM). The user must specify the option "vsrc_status = 1" for the broken VIN when the DSP enters the preview, and specify the memory for a single-color PM.</li>
<li>If the user starts encoding from the broken VIN, the encoding fps is not guaranteed.</li>
<li>If the VIN is suddenly broken during the preview or encode state, the VIN-related buffers will also be filled with a black PM.</li>
</ul>
</dd></dl>
<p>See <a class="el" href="../../d2/d61/fs_basic_vin.html#example_broken_vin">Enter Preview with a Broken VIN Example</a>.</p>
<h2><a class="anchor" id="vin_repeat_frame"></a>
1.9 VIN repeat frame</h2>
<p >DSP can repeat previous good frame when there is VIN short line or short frame error. Short line error is usually caused by VIN interface h/w signal issue.</p>
<p >For example, there is noise or static interference on VIN interface. This error will make DSP hang. The image audio video (IAV) introduces the feature of checking short line to detect this issue, and replaces the "broken frame" with a duplicated previous good frame.</p>
<p >See <a class="el" href="../../d2/d61/fs_basic_vin.html#example_vin_repeat_frm">VIN repeat frame</a>.</p>
<h2><a class="anchor" id="scale_VIN"></a>
1.10 Scale VIN</h2>
<p >Scale VIN is only supported on CV72 with VIN0. Scale VIN is doing downscale from original RAW input to generate a smaller RAW, which can save the IDSP performance and DRAM bandwidth. Users can enable scale VIN by setting the option "scale_type". Scale VIN is not supported with YUV input.</p>
<p >For example, when there is a 8MP sensor input, users can specify the option "scale_type = 1" to get a 2MP raw. Specify "scale_type = 1" can do 2X downscale for both VIN width and height. For introductions on all supported scale type, refer to <a class="el" href="../../d2/d61/fs_basic_vin.html#lua_vsrc_configuration">Video Input Configuration</a>.</p>
<p >See <a class="el" href="../../d2/d61/fs_basic_vin.html#example_scale_VIN">Scale VIN</a>.</p>
<h2><a class="anchor" id="Roi_VIN"></a>
1.11 ROI VIN</h2>
<p >ROI VIN is supported on CV5x / CV72. User can get several cropped vin from original RAW input. ROI VIN can also save IDSP performance and DRAM bandwidth. The maximum supported ROI VIN number depends on virtual VIN number extended from one real VIN. Users can specify the option "roi_enable = 1" to enable ROI VIN, and specify "roi_list" for each ROI VIN windows. The option "vin_roi_idx" in channel configuration specify the index of ROI VIN in "roi_list". ROI VIN is not supported with YUV input.</p>
<p >For example, when there is a 8MP sensor input, users can specify the option "roi_enable = 1" and "roi_list = {{480, 480, 1920, 1080},}" to get a cropped 2MP raw, which the offset is {480, 480}.</p>
<p >See <a class="el" href="../../d2/d61/fs_basic_vin.html#example_Roi_VIN">Roi VIN</a>.</p>
<h2><a class="anchor" id="dual_vin_slice"></a>
1.12 Dual VIN Slicing</h2>
<p >To get lower pipeline latency, we supports dual vertical slicing for sensor raw on mode 0. The sensor raw image will be cut into top and bottom slices. Once the top slice is captured by VINC, it will be fed into IDSP right away for the next processing. Benefit from this, the pipeline latency can reduce by around half frame time (slightly smaller due to vertical padding) comparing with single idsp slice.</p>
<p >The figure below briefly illustrates the workflow of dual vertical slicing. As shown in the figure, when the raw data in vinc reaches the position of the dotted line (The height of each slice is calculated by dividing the raw height by the idsp vertical slice number), vinc will grab the top slice data and send it to the next processing session of IDSP. Then, the rest of a frame's data is sent to the next IDSP session by the vinc after it has been fully received.</p>
<div class="image">
<img src="../../dual_vin_slice.png" alt=""/>
<div class="caption">
Figure 1-4. dual vin silcing.</div></div>
<p >The following parameters need to be configured to enable low delay vout. The idsp vertical slice num(ver_slice_num) and raw slice num must be set to the same value, we only support 2 vertical slices now. We also need to set "low_delay_enable = 1" on the prev canvas to enable low delay vout. </p><div class="fragment"><div class="line">chan_0 = {</div>
<div class="line"> ....</div>
<div class="line"> ver_slice_num = 2,</div>
<div class="line"> raw_padding_height = 0,</div>
<div class="line"> raw_slice_num = 2,</div>
<div class="line"> ....</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">canvas = {</div>
<div class="line">....</div>
<div class="line">   {</div>
<div class="line">      type = <span class="stringliteral">&quot;prev&quot;</span>,</div>
<div class="line">      ...</div>
<div class="line">      low_delay_enable = 1,</div>
<div class="line">   },</div>
<div class="line">....</div>
<div class="line">}</div>
</div><!-- fragment --><p >The following is a comparison of vin-vout latency with low-delay disabled and enabled.</p>
<div class="fragment"><div class="line">Resolutoin: vin-4k, vout-1080p; FPS: vin = vout = 60; IDSP core mdoe: single core.</div>
<div class="line"> </div>
<div class="line">======= Audit video info within 300s ========</div>
<div class="line"> </div>
<div class="line">2<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> idsp vertical slice:</div>
<div class="line">=== [VOUT-VIN Latency Info] : From <span class="stringliteral">&quot;raw capture done&quot;</span> to <span class="stringliteral">&quot;vout display start&quot;</span></div>
<div class="line">Vout     Canvas     Sync Cnt     Avg (us)     Max (us)     Min (us)   Delta (us)</div>
<div class="line">2        2          18657        15529        23607        6941       16666</div>
<div class="line"> </div>
<div class="line">1<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> idsp vertical slice:</div>
<div class="line">=== [VOUT-VIN Latency Info] : From <span class="stringliteral">&quot;raw capture done&quot;</span> to <span class="stringliteral">&quot;vout display start&quot;</span></div>
<div class="line">Vout     Canvas     Sync Cnt     Avg (us)     Max (us)     Min (us)   Delta (us)</div>
<div class="line">2        2          18779        25389        33426        16759      16667</div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a></div><div class="ttdeci">u32 x</div></div>
</div><!-- fragment --><p >From the audit results, we can see that the average vin-vout latency is reduced by about 10ms.</p>
<hr  />
<h1><a class="anchor" id="lua_vsrc_configuration"></a>
2. Video Input Configuration</h1>
<p >Users can configure the video source via Lua script. Each input source is configured as an independent "VSRC" instance in the Lua script. Each VSRC can have a different resolution, frame rate, HDR mode, and more. Below are the VSRC parameters.<br  />
</p>
<a class="anchor" id="table_vsrc_lua"></a>
<table class="doxtable">
<caption><b>Table 2-1. Parameters for VIN Configuration.</b></caption>
<tr>
<th>Item </th><th><div style="width:120px"><b>Parameter</b></div> </th><th>Description </th></tr>
<tr>
<td><a class="anchor" id="anchor_vsrc_id"></a>vsrc_id </td><td>id &gt;= 0 </td><td>Specifies the sensor input ID. Ambarella suggests keeping the same value as the sensor index, which is automatically generated during the sensor driver probe process that corresponds to a real sensor </td></tr>
<tr>
<td><a class="anchor" id="anchor_vsrc_status"></a>vsrc_status </td><td>0 (default): active <br  />
 1: broken or not-connected </td><td>Specifies if the sensor is active or broken / not connected </td></tr>
<tr>
<td><a class="anchor" id="anchor_vsrc_mode"></a>mode </td><td>Resolution mode </td><td>Specifies the sensor resolution mode </td></tr>
<tr>
<td>hdr_mode </td><td>"linear", "2x", "3x" </td><td>Specifies the HDR mode for the input sensor </td></tr>
<tr>
<td>fps </td><td>fps &gt;= 1 </td><td>Specifies the frame rate of the video source </td></tr>
<tr>
<td>max_fps </td><td>1 &lt;= max_fps &lt;= 480 </td><td>Specifies the maximum frame rate of the video source </td></tr>
<tr>
<td>vsrc_ctx_switch </td><td>0: disable <br  />
 1: enable </td><td>Specifies the sensor register context's auto-switch flag; it only functions for some sensors (such as AR0230 and AR0237) which support multiple register groups of the shutter and automatic gain control (AGC) </td></tr>
<tr>
<td><a class="anchor" id="anchor_vsrc_bit"></a>bit </td><td>0: auto <br  />
 8~16: pixel depth </td><td>Specifies the sensor RGB bits </td></tr>
<tr>
<td>Mirror </td><td>0: none <br  />
 1: flip <br  />
 2: mirror <br  />
 3: mirror and flip </td><td>Specifies the sensor mirror pattern </td></tr>
<tr>
<td>bayer </td><td>0: RG <br  />
 1: BG <br  />
 2: GR <br  />
 3: GB <br  />
 255: AUTO </td><td>Specifies the sensor Bayer pattern </td></tr>
<tr>
<td>virt_mode_cfg_enable </td><td>0: disable <br  />
 1: enable </td><td>Specifies the virtual sensor mode customization flag </td></tr>
<tr>
<td>virt_mode_cfg </td><td>virt_mode_cfg_{vsrc_id} </td><td>Specifies the virtual sensor mode Lua structure; it only takes effect when virt_mode_cfg_enable is set to 1 </td></tr>
<tr>
<td>scale_type </td><td>0: no scale <br  />
 1: 1/2 for both width and height <br  />
 2: 1/4 for width and 1/2 for height <br  />
 3: 1/2 only for width <br  />
 4: 1/4 only for width </td><td>Specifies the vin scale type </td></tr>
<tr>
<td>roi_enable </td><td>0: disable <br  />
 1: enable </td><td>Flag to enable roi VIN </td></tr>
<tr>
<td>roi_list </td><td>{{offset_x, offset_y, width, height}} <br  />
 </td><td>Specifies the crop window of each roi VIN </td></tr>
</table>
<p >For encode from RAW (EFR) cases, the RAW data files are fed to VIN buffer via dummy sensor. Dummy sensor is implemented through the "ambds" driver, it is designed to simulate real sensor, users can configure the virtual VIN mode via lua script.</p><ol type="1">
<li>Each virtual VIN mode corresponds to a specific VSRC instance in the Lua script.</li>
<li>Each virtual VIN mode can have a different resolution, frame rate, high dynamic range (HDR) mode, video type, and so on. Below are the parameters for virtual VIN mode.<br  />
</li>
</ol>
<a class="anchor" id="table_virt_mode_cfg_lua"></a>
<table class="doxtable">
<caption>Table 2-2. Parameters for Virtual VIN Mode.</caption>
<tr>
<th>Item </th><th><div style="width:120px"><b>Parameter</b></div> </th><th>Description </th></tr>
<tr>
<td><a class="anchor" id="anchor_vsrc_id"></a>width </td><td>width &gt;= 0 </td><td>VSRC output window width </td></tr>
<tr>
<td><a class="anchor" id="anchor_vsrc_status"></a>height </td><td>height &gt;= 0 </td><td>VSRC output window height </td></tr>
<tr>
<td>hdr_mode </td><td>"linear", "2x", "3x" </td><td>Specifies HDR mode for the virtual sensor </td></tr>
<tr>
<td>default_fps </td><td>fps &gt;= 1 </td><td>Specifies the default frame rate of the virtual sensor </td></tr>
<tr>
<td>max_fps </td><td>1 &lt;= max_fps &lt;= 480 </td><td>Specifies the maximum frame rate of the virtual sensor </td></tr>
<tr>
<td><a class="anchor" id="anchor_vsrc_bit"></a>bits </td><td>8~16: pixel depth </td><td>Specifies the virtual sensor RGB bits </td></tr>
<tr>
<td>hdr_offset_long </td><td>hdr_offset_long &gt;= 0 </td><td>Line offset of the longest exposure frame </td></tr>
<tr>
<td>hdr_offset_short1 </td><td>hdr_offset_short1 &gt;= 0 </td><td>Line offset of the medium exposure frame </td></tr>
<tr>
<td>hdr_offset_short2 </td><td>hdr_offset_short2 &gt;= 0 </td><td>Line offset of the above medium exposure frame </td></tr>
<tr>
<td>hdr_offset_short3 </td><td>hdr_offset_short3 &gt;= 0 </td><td>Line offset of the shortest exposure frame </td></tr>
<tr>
<td>sensor_id </td><td>sensor_id &gt;= 0 </td><td>Specifies the sensor_id of the virtual sensor </td></tr>
<tr>
<td>agc_db_step </td><td>agc_db_step &gt;= 0 </td><td>Specifies the agc_db_step of the virtual sensor </td></tr>
<tr>
<td>dual_gain_mode </td><td>0: off <br  />
 1: HCG LCG <br  />
 2: DCG (HCG+LCG combined) </td><td>Flag to indicate if the current VIN supports dual-gain mode </td></tr>
<tr>
<td>video_type </td><td>"yuv_601" <br  />
 "yuv_656" <br  />
 "rgb_601" <br  />
 "rgb_656" <br  />
 "rgb_raw" <br  />
 "yuv_bt1120" <br  />
 "rgb_bt1120" </td><td>Specifies the video type of the virtual sensor </td></tr>
</table>
<p ><b>Example for Video Source Lua Configuration</b><br  />
</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">   vsrc_id = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 0,</div>
<div class="line">   mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">   fps = 30,</div>
<div class="line">   max_fps = 60,</div>
<div class="line">   vsrc_ctx_switch = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 0,</div>
<div class="line">   mirror = 0,</div>
<div class="line">   bayer = 0,</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">vsrc_1 = {</div>
<div class="line">   vsrc_id = 1,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 0,</div>
<div class="line">   mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">   fps = 30,</div>
<div class="line">   max_fps = 60,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 0,</div>
<div class="line">   vsrc_ctx_switch = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 0,</div>
<div class="line">   mirror = 0,</div>
<div class="line">   bayer = 0,</div>
<div class="line">}</div>
<div class="ttc" id="avin__init_8c_html_a847f1d2f5eba7f8c6af44233c27f71a4"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a></div><div class="ttdeci">int vsrc_status</div><div class="ttdef"><b>Definition:</b> vin_init.c:69</div></div>
<div class="ttc" id="avin__init_8c_html_a9586a0cc85ebac1f283fc9f2d94c82e2"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a></div><div class="ttdeci">int hdr_mode</div><div class="ttdef"><b>Definition:</b> vin_init.c:61</div></div>
<div class="ttc" id="avin__init_8c_html_ad1e28a1a66a25529b0b61b9ca4e66d44"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a></div><div class="ttdeci">int bits</div><div class="ttdef"><b>Definition:</b> vin_init.c:63</div></div>
</div><!-- fragment --><p ><b>Example Virtual Sensor Mode Configuration for Dummy Sensor Lua Configuration</b><br  />
</p>
<div class="fragment"><div class="line">virt_mode_cfg_0 = {</div>
<div class="line">  <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = 1920,</div>
<div class="line">  <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = 1080,</div>
<div class="line">  <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 12,</div>
<div class="line">  max_fps = 30,</div>
<div class="line">  default_fps = 30,</div>
<div class="line">  <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>,</div>
<div class="line">  video_type = <span class="stringliteral">&quot;rgb_raw&quot;</span>, -- options: <span class="stringliteral">&quot;yuv_601&quot;</span>, <span class="stringliteral">&quot;yuv_656&quot;</span>, <span class="stringliteral">&quot;rgb_601&quot;</span>, <span class="stringliteral">&quot;rgb_656&quot;</span>, <span class="stringliteral">&quot;rgb_raw&quot;</span>, <span class="stringliteral">&quot;yuv_bt1120&quot;</span>, <span class="stringliteral">&quot;rgb_bt1120&quot;</span></div>
<div class="line">  sensor_id = 0x3014,</div>
<div class="line">  agc_db_step = 0x00180000,</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">vsrc_0 = {</div>
<div class="line"> vsrc_id = 0,</div>
<div class="line"> <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 0,</div>
<div class="line"> mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line"> <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line"> fps = 30,</div>
<div class="line"> vsrc_ctx_switch = 0,</div>
<div class="line"> <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 0,</div>
<div class="line"> <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a74dbe65312dc9cdc765d66ddf85aa5cd">virt_mode_cfg_enable</a> = 1,</div>
<div class="line"> virt_mode_cfg = virt_mode_cfg_0,</div>
<div class="line">}</div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a></div><div class="ttdeci">u32 width</div></div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a></div><div class="ttdeci">u32 height</div></div>
<div class="ttc" id="avin__init_8c_html_a74dbe65312dc9cdc765d66ddf85aa5cd"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a74dbe65312dc9cdc765d66ddf85aa5cd">virt_mode_cfg_enable</a></div><div class="ttdeci">int virt_mode_cfg_enable</div><div class="ttdef"><b>Definition:</b> vin_init.c:75</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>The virt_mode_cfg setting takes effect only when virt_mode_cfg_enable in the VSRC configuration is set to 1 and VSRC is a virtual sensor.</li>
<li>When loading the ambds driver, the custom_format_enable parameter must be set to 1.</li>
</ul>
</dd></dl>
<p>For more use cases for virtual VIN mode and the EFR feature, refer to <a class="el" href="../../d3/dff/fs_adv_efr.html#custom_virtual_vin_mode">Custom virtual VIN mode</a>.<br  />
</p>
<hr  />
<h1><a class="anchor" id="section_vsrc_example"></a>
3. Video Input Examples</h1>
<dl class="section note"><dt>Note</dt><dd>Ambarella highly recommends changing all parameters by modifying the Lua scripts.</dd></dl>
<h2><a class="anchor" id="example_vsrc_resolution"></a>
Example 1: Resolution Control</h2>
<p >First, initialize the evaluation kit (EVK) board to load the essential drivers and microcode, and start the 3A statistics if the following command was not executed previously.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
</div><!-- fragment --><dl class="section user"><dt>Resolution 1920x1080</dt><dd></dd></dl>
<p>The 'test_encode' readout message shows all supported VIN modes and the current active mode.</p>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
</div><!-- fragment --><dl class="section user"><dt>Resolution 2592x1944</dt><dd></dd></dl>
<div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_5m_2592x1944_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_5m_2592x1944_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
</div><!-- fragment --><h2><a class="anchor" id="example_vsrc_frame_rate"></a>
Example 2: Frame Rate Control</h2>
<p >First, initialize the EVK board to load the essential drivers and microcode, and start the 3A statistics if the following command was not executed previously.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
</div><!-- fragment --><dl class="section user"><dt>Frame Rate 25</dt><dd></dd></dl>
<p>Modify the Lua file for 25 fps.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">   vsrc_id = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 0,</div>
<div class="line">   mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">   fps = 25,</div>
<div class="line">   max_fps = 0,</div>
<div class="line">   vsrc_ctx_switch = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 0,</div>
<div class="line">   mirror = 0,</div>
<div class="line">   bayer = 0,</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
</div><!-- fragment --><dl class="section user"><dt>Frame Rate 30</dt><dd></dd></dl>
<p>Modify the Lua file for 30 fps.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">   vsrc_id = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 0,</div>
<div class="line">   mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">   fps = 30,</div>
<div class="line">   max_fps = 0,</div>
<div class="line">   vsrc_ctx_switch = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 0,</div>
<div class="line">   mirror = 0,</div>
<div class="line">   bayer = 0,</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
</div><!-- fragment --><dl class="section user"><dt>Frame Rate 60</dt><dd></dd></dl>
<p>Modify the lua file for 60 fps.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">   vsrc_id = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 0,</div>
<div class="line">   mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">   fps = 60,</div>
<div class="line">   max_fps = 0,</div>
<div class="line">   vsrc_ctx_switch = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 0,</div>
<div class="line">   mirror = 0,</div>
<div class="line">   bayer = 0,</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
</div><!-- fragment --><h2><a class="anchor" id="example_vsrc_mirror_filp"></a>
Example 3: Mirror / Filp</h2>
<p >Initialize the EVK board to load the essential drivers and microcode, and start the 3A statistics if the following command was not executed previously.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
</div><!-- fragment --><p >Set mirror and filp mode.</p>
<p >Modify the Lua file for mirror and flip mode.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">   vsrc_id = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 0,</div>
<div class="line">   mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">   fps = 60,</div>
<div class="line">   max_fps = 0,</div>
<div class="line">   vsrc_ctx_switch = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 0,</div>
<div class="line">   mirror = 1,</div>
<div class="line">   bayer = 0,</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)   <span class="comment">// For CV72</span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Not all sensors support VIN mirror / flip.</dd></dl>
<h2><a class="anchor" id="example_vsrc_yuv"></a>
Example 4: YUV Input using LT6911</h2>
<dl class="section user"><dt>Hardware and Software Environment</dt><dd></dd></dl>
<p>This example has been tested with CV5 Timn board and can be easily ported to any other supported device and development board. In order for the test case to function, users must perform the following:</p><ul>
<li>Board 1 generates HDMI output. Insert the IMX274 MIPI® sensor into the VIN slot on the board. Log into Board 1 via Telnet and set up the board to preview. state. The HDMI signal then will be converted to YUV data by LT6911.</li>
<li>Insert LT6911 into the VIN slot on Board 2. Connect Board 2 to a monitor with HDMI interface. Log into the Board 2 via serial console.</li>
</ul>
<div class="image">
<img src="../../sample_vin_lt6911.png" alt=""/>
<div class="caption">
Figure 3-1. LT6911 Hardware Connection.</div></div>
<dl class="section user"><dt>Command Step by Step</dt><dd></dd></dl>
<p>For YUV input, the correct 3A bin files are still required by <code>test_aaa_service</code>. Use the commands below to verify if those bin files are included.<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; packages</div>
<div class="line">          -&gt; idsp</div>
<div class="line">             [*] sensor-datas@<span class="keyword">virtual</span> (packages/idsp/data/img_cv5x)</div>
<div class="line">                 [*]   ipc-sensor-datas@<span class="keyword">virtual</span> (packages/idsp/data/img_cv5x/IPC)</div>
</div><!-- fragment --><p> For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambalib</div>
<div class="line">             -&gt; sensor-datas@<span class="keyword">virtual</span> (meta-ambalib/recipes-sensor)</div>
<div class="line">                [*]   ipc-sensor-datas@<span class="keyword">virtual</span> (meta-ambalib/recipes-sensor/IPC)</div>
</div><!-- fragment --><p> Then, <code>/usr/share/ambarella/idsp/ipc/cc_bins/yuv_input_3D.bin</code>, <code>/usr/share/ambarella/idsp/ipc/adj_params/yuv_input_liso_adj_param_ipc.bin</code>, and <code>/usr/share/ambarella/idsp/ipc/adj_params/yuv_input_aeb_param_ipc.bin</code> are generated.<br  />
</p>
<p >Set up a 1080P HDMI output on any board. This example uses the CV22 Walnut EVK to generate HDMI output.</p>
<div class="fragment"><div class="line">board_cv22# init.sh --imx274_mipi</div>
<div class="line">board_cv22# test_aaa_service -a &amp;</div>
<div class="line">board_cv22# test_encode -i 0 --hdmi 1080p</div>
</div><!-- fragment --><p >For Board 2:<br  />
 An Example for Video Source Lua Configuration </p><div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">    vsrc_id = 0,</div>
<div class="line">    mode = <span class="stringliteral">&quot;0&quot;</span>,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">    fps = 30,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>= 0,</div>
<div class="line">}</div>
<div class="line">...</div>
<div class="line">chan_0 = {</div>
<div class="line">    ...</div>
<div class="line">    <a class="code hl_function" href="../../db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> = {</div>
<div class="line">    max_output = {0, 0}, -- output <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a></div>
<div class="line">    input      = {0, 0, 0, 0}, -- full VIN</div>
<div class="line">    output     = {0, 0, 1920, 1080},</div>
<div class="line"> },</div>
<div class="line"> ...</div>
<div class="line">}</div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> test_vout_cfg.c:85</div></div>
</div><!-- fragment --><div class="fragment"><div class="line">board_cv5# init.sh --na</div>
<div class="line">board_cv5# modprobe lt6911 vinc_id=8 bus_id=3</div>
<div class="line">board_cv5# test_aaa_service -a &amp;</div>
<div class="line">board_cv5# test_encode --resource-cfg example_1080p.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1</div>
<div class="line">IAVIOC_S_IDLE done</div>
<div class="line">mode = 13, fps = 60000, interlaced = 0</div>
<div class="line"> </div>
<div class="line">Find Vin Source lt6911 Channel[lt6911]<span class="stringliteral">&#39;s type is HDMI</span></div>
<div class="line"><span class="stringliteral">The signal is:</span></div>
<div class="line"><span class="stringliteral">        1920x1080P(Linear)      60      YUV BT656       8bits   16:9    AUTO    rev[0]</span></div>
<div class="line"><span class="stringliteral">Active src 0&#39;</span>s mode is:</div>
<div class="line">        1920x1080P(Linear)      60      YUV BT656       8<a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>   16:9    AUTO    rev[0]</div>
<div class="line"><a class="code hl_function" href="../../d4/daa/vin__init_8c.html#a919b1d8600db83ad0b0cecba9ba694e6">init_vin</a> done</div>
<div class="ttc" id="acJSON_8h_html_a788db922597cf2fb6389e278f822e59f"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a></div><div class="ttdeci">const char *const const char *const raw</div></div>
<div class="ttc" id="avin__init_8c_html_a919b1d8600db83ad0b0cecba9ba694e6"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a919b1d8600db83ad0b0cecba9ba694e6">init_vin</a></div><div class="ttdeci">int init_vin(int vsrc_id, enum amba_video_mode video_mode, int hdr_mode, u32 max_fps_hp, const char *calib_cfg)</div><div class="ttdef"><b>Definition:</b> vin_init.c:716</div></div>
</div><!-- fragment --><dl class="section user"><dt>Enable 4K YUV Input</dt><dd></dd></dl>
<p>The Cooper software development kit (SDK) supports 4K input. In order to use 4K YUV input, set up the CV22 Walnut Board 1 with 4K HDMI output.</p>
<div class="fragment"><div class="line">board_cv22# init.sh --imx274_mipi</div>
<div class="line">board_cv22# test_aaa_service -a &amp;</div>
<div class="line">board_cv22# test_encode -i0 --hdmi 2160p30 -X --bsize 3840x2160 --bmaxsize 3840x2160 --vout-profile 1</div>
</div><!-- fragment --><p >Then, set up Board 2 the same as before.<br  />
 An Example for Video Source Lua Configuration: </p><div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">    vsrc_id = 0,</div>
<div class="line">    mode = <span class="stringliteral">&quot;0&quot;</span>,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">    fps = 30,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>= 0,</div>
<div class="line">}</div>
<div class="line">...</div>
<div class="line">chan_0 = {</div>
<div class="line">    ...</div>
<div class="line">    <a class="code hl_function" href="../../db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> = {</div>
<div class="line">    max_output = {0, 0}, -- output <a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a></div>
<div class="line">    input      = {0, 0, 0, 0}, -- full VIN</div>
<div class="line">    output     = {0, 0, 3840, 2160},</div>
<div class="line"> },</div>
<div class="line"> ...</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board_cv5# init.sh --na</div>
<div class="line">board_cv5# modprobe lt6911 vinc_id=8 bus_id=3</div>
<div class="line">board_cv5# test_aaa_service -a &amp;</div>
<div class="line">board_cv5# test_encode --resource-cfg example_4k.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1</div>
<div class="line">IAVIOC_S_IDLE done</div>
<div class="line">mode = 13, fps = 60000, interlaced = 0</div>
<div class="line"> </div>
<div class="line">Find Vin Source lt6911 Channel[lt6911]<span class="stringliteral">&#39;s type is HDMI</span></div>
<div class="line"><span class="stringliteral">The signal is:</span></div>
<div class="line"><span class="stringliteral">The signal is:</span></div>
<div class="line"><span class="stringliteral">        3840x2160P(Linear)      30      YUV BT656       8bits   16:9    AUTO    rev[0]</span></div>
<div class="line"><span class="stringliteral">Active src 0&#39;</span>s mode is:</div>
<div class="line">        3840x2160P(Linear)      30      YUV BT656       8<a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>   16:9    AUTO    rev[0]</div>
<div class="line"><a class="code hl_function" href="../../d4/daa/vin__init_8c.html#a919b1d8600db83ad0b0cecba9ba694e6">init_vin</a> done</div>
</div><!-- fragment --><h2><a class="anchor" id="example_vin_vout_precise_sync"></a>
Example 5: VIN-VOUT Precise Sync</h2>
<p >To enable the VIN-VOUT precise syncronization feature, users must specify "--vin-precise-sync-enable 1". The steps below use CV5 as an example:</p>
<p >Modify the Lua file for 1080p60 mode.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">   vsrc_id = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 0,</div>
<div class="line">   mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">   fps = 60,</div>
<div class="line">   max_fps = 0,</div>
<div class="line">   vsrc_ctx_switch = 0,</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 0,</div>
<div class="line">   mirror = 0,</div>
<div class="line">   bayer = 0,</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vin-precise-sync-enable 1</div>
</div><!-- fragment --><p >Users can use "debug-audit-vv-delay" to show VOUT-VIN delay, which is used to verify if this feature takes effect. When VOUT-VIN delay is in the range (N, N+1) x one VOUT frame time (N is different for different encode mode), it means that this feature takes effect. See VOUT-VIN Delay Audit Function.</p>
<h2><a class="anchor" id="example_vin_VGA480_FPS"></a>
Example 6: VIN 480 fps</h2>
<p >Users must run this case with a sensor that supports 480 VIN fps, such as IMX422, and enable the corresponding sensor support configuration in menuconfig. The example below is verified with the CV5 platform.<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; platform</div>
<div class="line">             -&gt; vin</div>
<div class="line">                -&gt; sensors</div>
<div class="line">                   [*] kernel-module-imx422 (drv_modules/platform/vin/sensors/sony_imx422)</div>
</div><!-- fragment --><p >For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-sensor</div>
<div class="line">                [*] kernel-module-imx422 (meta-ambabsp/recipes-sensor/kernel-module-imx422)</div>
</div><!-- fragment --><p> Specify the VIN fps and resolution, as well as the corresponding canvas and stream. Refer to <a href="../../script/vin0_VGA_linear_480fps.lua" target="_blank"><b>vin0_VGA_linear_480fps.lua</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;</div>
<div class="line">board# insmod /lib/modules/$(uname -r)/extra/imx422.ko bus_id=3 vinc_id=8 addr=0x1a</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg vin0_VGA_linear_480fps.lua --enc-mode 0</div>
<div class="line">board# test_encode -A -h 640x480 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -e</div>
<div class="line">board# test_stream -A --no</div>
<div class="line">board# cat /proc/interrupts | grep vin8 &amp;&amp; sleep 1 &amp;&amp; cat /proc/interrupts | grep vin8</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --><h2><a class="anchor" id="example_vin_8k"></a>
Example 7: Single 8K VIN Case</h2>
<p >This example has been tested with the CV5 platform and can be easily ported to any other supported device and development board.<br  />
 Users must run this case with a sensor that supports 8K VIN, such as IMX586 / IMX492 / IMX455, and enable corresponding sensor support configuration in menuconfig.<br  />
</p>
<dl class="section user"><dt>8K VIN with IMX586</dt><dd></dd></dl>
<dl class="section user"><dt>Hardware and Software Environment</dt><dd></dd></dl>
<p>Use the commands below to enable the IMX586 sensor.<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; platform</div>
<div class="line">             -&gt; vin</div>
<div class="line">                -&gt; sensors</div>
<div class="line">                   [*] kernel-module-imx586-mipi (drv_modules/platform/vin/sensors/sony_imx586_mipi)</div>
</div><!-- fragment --><p> For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-sensor</div>
<div class="line">                [*] kernel-module-imx586-mipi (drv_modules/platform/vin/sensors/sony_imx586_mipi)</div>
</div><!-- fragment --><p >Modify the dual in-line package (DIP) settings and jumpers on the CV5 Timn board, as shown in the figure below.</p>
<div class="image">
<img src="../../example_vin_8k_switches_config.png" alt=""/>
<div class="caption">
Figure 3-2. Switches SW1-SW5 Configuration.</div></div>
<p >Insert the IMX586 sensor into the VIN DCPHY slot on the CV5 Timn board shown in the figure below.</p>
<div class="image">
<img src="../../example_vin_8k_insert_imx586.png" alt=""/>
<div class="caption">
Figure 3-3. Insert IMX586 Sensor in VIN DCHPY0 / DCHPY1.</div></div>
<p >Enter the preview with the following commands:</p>
<div class="fragment"><div class="line">board# init.sh --na;</div>
<div class="line">board# modprobe imx586_mipi vinc_id=0 bus_id=5 cphy=1</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_8k_linear.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The second command should be '# modprobe imx586_mipi vinc_id=0 bus_id=5.' if the sensor is designed for MIPI D-PHY.</dd></dl>
<dl class="section user"><dt>8K VIN with IMX492</dt><dd></dd></dl>
<dl class="section user"><dt>Hardware and Software Environment</dt><dd></dd></dl>
<p>Use the commands below to enable the IMX492 sensor.<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">      -&gt; drv_modules</div>
<div class="line">         -&gt; platform</div>
<div class="line">            -&gt; vin</div>
<div class="line">               -&gt; sensors</div>
<div class="line">                  [*] kernel-module-imx492 (drv_modules/platform/vin/sensors/sony_imx492)</div>
</div><!-- fragment --><p> For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-sensor</div>
<div class="line">                [*] kernel-module-imx492 (meta-ambabsp/recipes-sensor/kernel-module-imx492)</div>
</div><!-- fragment --><p> Modify the DIP settings and jumpers on CV5 Timn board, as shown in the figure below.</p>
<div class="image">
<img src="../../example_vin_8k_switches_config.png" alt=""/>
<div class="caption">
Figure 3-4. Switches SW1-SW5 Configuration.</div></div>
<p >Insert the IMX492 sensor into the VIN SLVS-EC slot on the CV5 Timn board, as shown in the figure below.</p>
<div class="image">
<img src="../../example_vin_8k_insert_imx492.png" alt=""/>
<div class="caption">
Figure 3-5. Insert IMX492 Sensor in VIN SLVS-EC.</div></div>
<p >Enter the preview with the following commands:</p>
<div class="fragment"><div class="line">board# init.sh --na;</div>
<div class="line">board# modprobe imx492 bus_addr=0x30000</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_8k_linear.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><dl class="section user"><dt>8K VIN with IMX455</dt><dd></dd></dl>
<dl class="section user"><dt>Hardware and Software Environment</dt><dd></dd></dl>
<p>Use the commands below to enable the IMX455 sensor.<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; platform</div>
<div class="line">             -&gt; vin</div>
<div class="line">                -&gt; sensors</div>
<div class="line">                   [*] kernel-module-imx455 (drv_modules/platform/vin/sensors/sony_imx455)</div>
</div><!-- fragment --><p> For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-sensor</div>
<div class="line">                [*] kernel-module-imx455 (drv_modules/platform/vin/sensors/sony_imx455)</div>
</div><!-- fragment --><p >Modify the DIP settings and jumpers on the CV5 Timn board, as shown in the figure below.</p>
<div class="image">
<img src="../../example_vin_8k_switches_config.png" alt=""/>
<div class="caption">
Figure 3-6. Switches SW1-SW5 Configuration.</div></div>
<p >Insert the IMX492 sensor into the VIN SLVS-EC slot on the CV5 Timn board, as shown in the figure below.</p>
<div class="image">
<img src="../../example_vin_8k_insert_imx455.png" alt=""/>
<div class="caption">
Figure 3-7. Insert IMX455 Sensor in VIN SLVS-EC.</div></div>
<p >Enter the preview with the following commands:</p>
<div class="fragment"><div class="line">board# init.sh --na;</div>
<div class="line">board# modprobe imx455 bus_addr=0x30000 fpga=0</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_8k_linear.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_virtual_vin"></a>
Example 8: Encode from RGB RAW: Input from RGB (RAW) File to VIN with Custom Virtual VIN Mode</h2>
<p >The Lua script can be found at <a href="../../script/cv5_vin0_1080p_linear_efr.lua" target="_blank"><b>cv5_vin0_1080p_linear_efr.lua</b></a>. </p><div class="fragment"><div class="line">board# init.sh --na;</div>
<div class="line">board# modprobe ambds vin_virtual_flag=1 custom_format_enable=1</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg cv5_vin0_1080p_linear_efr.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --enc-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-rgb 1</div>
<div class="line">board# test_efm -t 3 -i cap_raw_raw_1920x1080_3840.raw  -s 1920x1080 -T 1 -r 30 -R 0 --vin-<span class="keywordtype">id</span> 14</div>
</div><!-- fragment --><h2><a class="anchor" id="example_broken_vin"></a>
Example 9: Enter Preview with Broken VIN</h2>
<p >Use cv72_gage + 9296 serdes + 4 x os08a10 as an example.</p><ul>
<li>For Cooper SDK Amba build: <div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       drv_modules  ---&gt;</div>
<div class="line">           platform  ---&gt;</div>
<div class="line">               vin --&gt;</div>
<div class="line">                 sensors  ---&gt;</div>
<div class="line">                   [*] kernel-module-os08a10-mipi-brg (drv_modules/platform/vin/sensors/omnivision_os08a10_mipi_brg)</div>
<div class="line">                 bridges  ---&gt;</div>
<div class="line">                    [*] kernel-module-ambrg (drv_modules/platform/vin/bridges/ambrg)</div>
<div class="line">                          [*]   kernel-module-max9296 (drv_modules/platform/vin/bridges/maxim_9296)</div>
</div><!-- fragment --></li>
<li>For Cooper SDK Yocto build: <div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       meta-ambabsp  ---&gt;</div>
<div class="line">           recipes-sensor  ---&gt;</div>
<div class="line">              [*] kernel-module-os08a10-mipi-brg (drv_modules/platform/vin/sensors/omnivision_os08a10_mipi_brg)</div>
<div class="line">           recipes-bridge  ---&gt;</div>
<div class="line">              [*] kernel-module-ambrg (meta-ambabsp/recipes-bridge/kernel-module-ambrg)</div>
<div class="line">              [*]   kernel-module-max9296 (drv_modules/platform/vin/bridges/maxim_9296)</div>
</div><!-- fragment --></li>
</ul>
<p >Users must add the image audio video (IAV) driver probe parameter <code>keep_broken_vsrc=1</code> before compiling the SDK code. </p><div class="fragment"><div class="line">build$ vi rootfs/<span class="keywordflow">default</span>/etc/modprobe.d</div>
<div class="line"> ...</div>
<div class="line"> # Driver options</div>
<div class="line"> ...</div>
<div class="line"> options iav keep_broken_vsrc=1</div>
<div class="line"> ...</div>
</div><!-- fragment --><p >If users do not add the <code>keep_broken_vsrc=1</code> parameter before compiling, they can add it after the board is booted up, and then reboot it. </p><div class="fragment"><div class="line">board# vi /etc/modprobe.d/ambarella.conf</div>
<div class="line"> ...</div>
<div class="line"> # Driver options</div>
<div class="line"> ...</div>
<div class="line"> options iav keep_broken_vsrc=1</div>
<div class="line"> ...</div>
<div class="line">board# reboot</div>
</div><!-- fragment --><p >Specify <code>vsrc_status = 1</code> for vsrc_0 without connecting a sensor to vsrc_0, and <code>vsrc_status = 0</code> for vsrc_1, connecting a sensor on vsrc_1. Refer to <a href="../../script/enter_preview_with_broken_vin.lua" target="_blank"><b>enter_preview_with_broken_vin.lua</b></a>. Place the script in the same folder where users issue the <code>test_encode</code> command.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">   ...</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 1,</div>
<div class="line">   ...</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">vsrc_1 = {</div>
<div class="line">   ...</div>
<div class="line">   <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a847f1d2f5eba7f8c6af44233c27f71a4">vsrc_status</a> = 0,</div>
<div class="line">   ...</div>
<div class="line">}</div>
</div><!-- fragment --><p >Issue the command to enter into preview mode; it will enter the preview with the buffer from vsrc_0 filled with a black privacy mask. The buffer from vsrc_1 is filled with the actual sensor image.</p>
<div class="fragment"><div class="line">board# init.sh --na;</div>
<div class="line">board# modprobe max9296 <span class="keywordtype">id</span>=0x0303 vinc_id=0xb8;</div>
<div class="line">board# modprobe os08a10_mipi_brg fsync=1;</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg enter_preview_with_broken_vin.lua  --vout-cfg /usr/local/bin/scripts/vout_hdmi.lua --vsync-detect-disable 0 --vsync-loss-dummy-frame-enable 1</div>
</div><!-- fragment --><p >After entering the preview, users can start encoding from the broken canvas corresponding to the broken VIN. </p><div class="fragment"><div class="line">board# test_encode -A -b0 -H 3840x2160 -e;</div>
<div class="line">board# test_encode -B -b5 -H 1920x1080 -e;</div>
<div class="line">board# rtsp_server</div>
</div><!-- fragment --><p >When the sensor hardware is ready, users can switch the broken or unconnected VINs back to recover on the fly. This is the camera seamless switch. Connect an active sensor to vsrc_0 first, then issue the following command. The sensor on vsrc_0 can be recovered successfully, which means the buffer from vsrc_0 will be filled with an actual sensor image rather than a black privacy mask. At the same time, the states of the channel and canvas corresponding to the VIN will be enabled to switch. The output of the encoding and the preview will be restored to the actual sensor image. </p><div class="fragment"><div class="line">board# test_vin_cap -r 8 -S 0</div>
</div><!-- fragment --><h2><a class="anchor" id="example_vin_repeat_frm"></a>
Example 10: VIN repeat frame</h2>
<p >User needs to enable the flag of <code>--vin-frame-broken-dummy-repeat</code> when entering preview. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/local/bin/scripts/cv5_vin0_4k_linear.lua --vout-cfg /usr/local/bin/scripts/vout_hdmi.lua --vin-frame-broken-dummy-repeat 1 --vsync-detect-disable 0</div>
</div><!-- fragment --><p >The following command can be used to simulate the generation of short line problems on Sony imx274 sensor. If below command is sent, vin will continuously generate short lines until it restores ： </p><div class="fragment"><div class="line">cv5x:</div>
<div class="line">board# amba_debug -w 0x20ed1e8000 -d 0x9000 &amp;&amp; amba_debug -w 0x20ed1e0038 -d 0x2fff</div>
<div class="line">cv72:</div>
<div class="line">board# amba_debug -w 0xffed1e8000 -d 0x9000 &amp;&amp; amba_debug -w 0xffed1e0038 -d 0x2fff</div>
</div><!-- fragment --><p >Currently, user can see that the video output always shows same frame with the same fps. And dmesg will print the following log: </p><div class="fragment"><div class="line">[ 464.258099] vin_update_vsync_proc(2980): VIN8: frame broken happened</div>
</div><!-- fragment --><p >After sending the below command, vin will restore to normal state ： </p><div class="fragment"><div class="line">cv5x:</div>
<div class="line">board# amba_debug -w 0x20ed1e0038 -d 0xf0b</div>
<div class="line">cv72:</div>
<div class="line">board# amba_debug -w 0xffed1e0038 -d 0xf0b</div>
</div><!-- fragment --><h2><a class="anchor" id="example_scale_VIN"></a>
Example 11: Scale VIN</h2>
<p >User must run this case on CV72 board with VIN0. users can specify "scale_type" in vsrc configuration to enable scale VIN feature.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">    vsrc_id = 0,</div>
<div class="line">    mode = <span class="stringliteral">&quot;3840x2160&quot;</span>,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>= 0,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a12db301b040a15818f8d32874c312444">scale_type</a> = 1, -- options: <span class="stringliteral">&quot;0&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span> or <span class="stringliteral">&quot;4&quot;</span></div>
<div class="line">}</div>
<div class="ttc" id="avin__init_8c_html_a12db301b040a15818f8d32874c312444"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a12db301b040a15818f8d32874c312444">scale_type</a></div><div class="ttdeci">int scale_type</div><div class="ttdef"><b>Definition:</b> vin_init.c:77</div></div>
</div><!-- fragment --><p >The Lua script can be found at <a href="../../script/cv72_vin0_scale_vin.lua" target="_blank"><b>cv72_vin0_scale_vin.lua</b></a>. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=0   <span class="comment">//Scale VIN only supported on CV72 with VIN0.</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg cv72_vin0_scale_vin.lua --vout-cfg /usr/local/bin/scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_Roi_VIN"></a>
Example 12: Roi VIN</h2>
<p >To enable roi VIN feature, users must specify "roi_enable = 1" and set "roi_list" in vsrc configuration.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">    vsrc_id = 0,</div>
<div class="line">    mode = <span class="stringliteral">&quot;3840x2160&quot;</span>,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>,</div>
<div class="line">    fps = 30,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>= 0,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a176c02d2b75755d0b35b7da5721cdf95">roi_enable</a> = 1,</div>
<div class="line">    roi_list = {        -- get three roi VINs</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a> = {0, 0, 1920 ,1080},</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a> = {960, 540, 1920 ,1080},</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a> = {1920, 1080, 1920 ,1080},</div>
<div class="line">        },</div>
<div class="line">    },</div>
<div class="ttc" id="avin__init_8c_html_a176c02d2b75755d0b35b7da5721cdf95"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a176c02d2b75755d0b35b7da5721cdf95">roi_enable</a></div><div class="ttdeci">int roi_enable</div><div class="ttdef"><b>Definition:</b> vin_init.c:79</div></div>
<div class="ttc" id="avin__init_8c_html_a862801bf1c46afaea9487ade7f767b66"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a></div><div class="ttdeci">struct iav_rect roi_win[IAV_MAX_VIN_ROI_NUM]</div><div class="ttdef"><b>Definition:</b> vin_init.c:83</div></div>
</div><!-- fragment --><p >The Lua script can be found at <a href="../../script/cv72_3_roi_vin.lua" target="_blank"><b>cv72_3_roi_vin.lua</b></a>. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg cv72_3_roi_vin.lua --vout-cfg /usr/local/bin/scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_scale_vin_with_roi_vin"></a>
Example 13: Scale VIN with roi VIN</h2>
<p >If scale VIN and roi VIN are both enabled (user must run this case on CV72 board with VIN0), VIN0 is used as scale VIN, VIN1/2/3 can be used as roi VINs.</p>
<div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">    vsrc_id = 0,</div>
<div class="line">    mode = <span class="stringliteral">&quot;3840x2160&quot;</span>,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>,</div>
<div class="line">    fps = 30,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#ad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>= 0,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a12db301b040a15818f8d32874c312444">scale_type</a> = 1,</div>
<div class="line">    <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a176c02d2b75755d0b35b7da5721cdf95">roi_enable</a> = 1,</div>
<div class="line">    roi_list = {</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a> = {0, 0, 0 ,0}, -- the first <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a> is not used when scale VIN is enbaled</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a862801bf1c46afaea9487ade7f767b66">roi_win</a> = {960, 540, 1920 ,1080},</div>
<div class="line">        },</div>
<div class="line">    },</div>
<div class="line">}</div>
</div><!-- fragment --><p >The Lua script can be found at <a href="../../script/cv72_scale_vin_with_roi_vin.lua" target="_blank"><b>cv72_scale_vin_with_roi_vin.lua</b></a>. </p><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=0   <span class="comment">//Scale VIN only supported on CV72 with VIN0.</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg cv72_scale_vin_with_roi_vin.lua --vout-cfg /usr/local/bin/scripts/vout_hdmi.lua</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
