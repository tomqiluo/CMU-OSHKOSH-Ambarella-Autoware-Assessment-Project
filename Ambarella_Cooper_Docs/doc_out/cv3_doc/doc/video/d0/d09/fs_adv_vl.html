<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: ADVANCED - Vsync Loss</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d0/d09/fs_adv_vl.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">ADVANCED - Vsync Loss </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Occasionally, the sensors encounter an issue and briefly stop generating signals that we called vsync-loss. There are two main situations. One is when vsync-Loss occurs but the sensor is available afterwards, Ambarella needs mechanism to recover from vsync-Loss. The other is that for multi-VIN cases, if only part of sensors but not all of them are disconnected, the remaining sensors can work independently, so are the encoding streams and preview buffers. Later on, applications can recover the disconnected sensors and enable encoding from these "recovered" sensors / channels without interrupting the previous working ones.</p>
<h1><a class="anchor" id="gvl_gvl"></a>
1. Guard Vsync Loss</h1>
<p >When vsync-Loss happens, DSP can detect this signal loss, report the error message to the ArmÂ®, and enable the application to reset the sensor input and recover its previous status. CV5x includes "vsync loss" detection mechanism and a daemon application to detect the signal loss and recover the DSP status.</p>
<p >Because CV5x has more than one VIN controller, the DSP can report the vsync signal loss message for each VIN controller independently so that the application can reset and recover it separately.</p>
<p >The following step shows how to check the vsync loss detection from <code>menuconfig</code>, which is enabled by default.<br  />
 For Cooper SDK Amba build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       -&gt; drv_modules</div>
<div class="line">          -&gt; platform</div>
<div class="line">             -*- ambvideo-header (drv_modules/<span class="keyword">private</span>/video/dsp_v6)</div>
<div class="line">                 [*]   Guard Vsync loss detection in IAV driver</div>
</div><!-- fragment --><p> For Cooper SDK Yocto build: </p><div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">       Main menu</div>
<div class="line">          -&gt; meta-ambabsp</div>
<div class="line">             -&gt; recipes-bsp</div>
<div class="line">                 -&gt; recipes-video</div>
<div class="line">                    -&gt; ambvideo-header (meta-ambabsp/recipes-video/ambvideo-header)</div>
<div class="line">                       [*]   Guard Vsync loss detection in IAV driver</div>
</div><!-- fragment --><h2><a class="anchor" id="example_vincap1"></a>
Example 1: Guard Vsync Loss for Single VIN (imx274_mipi)</h2>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3     <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8)         <span class="comment">// For CV72</span></div>
<div class="line">board # test_aaa_service -a&amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vsync-detect-disable 0         <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vsync-detect-disable 0)   <span class="comment">// For CV72</span></div>
<div class="line">board # test_encode -A -H3840x2160 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -e</div>
<div class="line">board # test_vin_cap -a &amp;</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --><h2><a class="anchor" id="example_vincap2"></a>
Example 2: Guard Vsync Loss for Multi-VIN (imx586_mipi + imx274_mipi) on CV5x</h2>
<div class="fragment"><div class="line">board # init.sh --na;modprobe imx586_mipi vinc_id=0 bus_id=5 cphy=0;modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board # test_aaa_service -a&amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vsync-detect-disable 0</div>
<div class="line">board # test_encode -A -H3840x2160 -<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -e</div>
<div class="line">board # test_vin_cap -a &amp;</div>
</div><!-- fragment --><p >When the DSP detects the vsync signal loss, it reports the error code to the Arm so that the <b>"test_vin_cap -a &amp;"</b> application receives the error code, forces the "broken" sensor to power down, and resumes the DSP state step-by-step.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>There will be frame dropping when vsync loss occurs, but it will be restored after vsync loss is recovered. </li>
</ul>
</dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
