<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: IQ - Lite - NN</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/daa/iq_lite_nn.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">IQ - Lite - NN </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="iq_lite_nn_history"></a>
0. Revision History</h1>
<table class="doxtable">
<tr>
<th>Version </th><th>Updated Date </th><th>Modification </th></tr>
<tr>
<td>0.0.1 </td><td>20240124 </td><td>Initial Version </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="iq_lite_nn_overview"></a>
1. Lite NN Overview</h1>
<p >Lite NN includes vivid high dynamic range (HDR) neural network (NN) and true motion NN.</p><ul>
<li>True motion uses NN to do motion detection, to get more reliable and accurate motion estimation to help motion compensated temporal filtering (MCTF) to do a better job.</li>
<li>Vivid HDR uses NN to do tone mapping, rather than the traditional contrast enhancement (CE) block.</li>
</ul>
<hr  />
<h1><a class="anchor" id="iq_lite_nn_usage"></a>
2. Lite NN Usage</h1>
<p >This section introduces the usage of Lite NN by steps. Image flow library doesnâ€™t support to load Lite NN automatically.</p>
<p >Users are required to enable Lite NN mode mannually. Lite NN should be configured in <b>product_config.lua</b> which is parsed by <code>test_aaa_service</code>.</p>
<p >To set up the Lite NN, follow the steps below:</p>
<ol type="1">
<li>Configure menuconfig Select <code>img-lite-nn-datas</code><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">    packages  ---&gt;</div>
<div class="line">     idsp ---&gt;</div>
<div class="line">         [*] img-lite-nn-datas (packages/idsp/lite_nn_data/img_cv72)</div>
</div><!-- fragment --> <pre class="fragment">- For Cooper Yocto build
</pre> <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">    meta-ambalib  ---&gt;</div>
<div class="line">     recipes-video ---&gt;</div>
<div class="line">         [*] img-lite-nn (meta-ambalib/recipes-video/img-lite-nn)</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Preparation on board side before running Lite NN<ul>
<li>Copy lite NN bin files to the board path, such as <b>/sdcard/mmcblk2p1/</b></li>
<li>Update <b>product_config.lua</b> to select Lite NN type and its bin file path on evk <code>/usr/share/ambarella/idsp/product_config.lua</code>. <div class="fragment"><div class="line">chan_0 = {</div>
<div class="line">    ... ...</div>
<div class="line">    tm_nn_mode = 0, -- 0: disable tm nn; 1: enable tm nn</div>
<div class="line">    tm_nn_path = <span class="stringliteral">&quot;sdcard/mmcblk2p1/vivid_hdr_nn.bin&quot;</span>,</div>
<div class="line">    md_nn_mode = 1, -- 0: disable md nn; 1: enable md nn</div>
<div class="line">    md_nn_path = <span class="stringliteral">&quot;/sdcard/mmcblk2p1/true_motion_nn.bin &quot;</span>,</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Run Lite NN with sensor input Take true motion NN with IMX678 on CV72_gage board as an example. <div class="fragment"><div class="line">board # init.sh --na</div>
<div class="line">board # modprobe imx678_mipi vinc_id=0x8</div>
<div class="line">board # test_aaa_service -a -p /usr/share/ambarella/idsp/product_config.lua &amp;</div>
<div class="line">board # cavalry_load -f /lib/firmware/cavalry.bin -r</div>
<div class="line">board # test_encode --resource-cfg cv72_isp.lua --enc-mode 5 --<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>-capture 1 --img-scale 1 --img-scale-<a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> 2 --img-scale-max-in 1920x1080 --img-scale-max-out 1920x1080 --img-scale-job-queue-depth 8</div>
<div class="line">board # test_encode -A -h 3840x2160 -b0 -e -B -h 1920x1080 -b1 -e</div>
<div class="line">board # rtsp_server &amp;</div>
<div class="line">board # test_idsp_motion  -t0 -s1 -e1 -c0 -m 0 -d 0  -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> 0 -<a class="code hl_variableRef" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> 0 -w 720 -h 360 &amp;</div>
<div class="ttc" id="acJSON_8h_html_a788db922597cf2fb6389e278f822e59f"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a></div><div class="ttdeci">const char *const const char *const raw</div></div>
<div class="ttc" id="acJSON_8h_html_adb411a44855a4c49231d72a0fc9a3b3b"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div><div class="ttdeci">char const int const cJSON_bool format</div></div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a></div><div class="ttdeci">u32 y</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a></div><div class="ttdeci">u32 x</div></div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="iq_lite_nn_true_motion"></a>
3. True Motion</h1>
<p >This section introduces the basic idea of true motion.</p><ul>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nn_true_motion_intro">3.1. Introduction</a></li>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nn_true_motion_params">3.2 ADJ Parameters</a></li>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nn_true_motion_invalid_params">3.3 Invalid Parameters List</a></li>
</ul>
<h2><a class="anchor" id="iq_lite_nn_true_motion_intro"></a>
3.1. Introduction</h2>
<p >True motion uses NN to do motion detection, to get more reliable and accurate motion estimation to help MCTF to do a better job. A sensitivity is open to describe the detection strength of different moving objects under different lighting conditions.</p>
<h2><a class="anchor" id="iq_lite_nn_true_motion_params"></a>
3.2 ADJ Parameters</h2>
<p >Motion detection neural network is applied in current NN model to allow the movement to be more accurately detected.</p>
<p >In auto adjust (ADJ), the releated filter is 'nn_md' in 'fc_nn_pkg', it includes the control of motion detection neural network. The 'nn_md' is applied in current NN model to allow movement to be more accurately detected.</p>
<a class="anchor" id="table_lite_nn_true_motion_params"></a>
<table class="doxtable">
<caption>Table 3-1. ADJ Parameters of True Motion.</caption>
<tr>
<th>Parameters </th><th>Type </th><th>Description </th></tr>
<tr>
<td>ik_nn_md_t sensitivity </td><td>unit 32 </td><td>Range:[0,128] </td></tr>
</table>
<p >As the sensitivity increases, it becomes easier to identify motion of small objects, and the detection area of motion becomes larger. Due to the different relationship between the noise and motion of each sensor under each gain, the MD_sensitivity can be set different value under each gain.</p>
<h2><a class="anchor" id="iq_lite_nn_true_motion_invalid_params"></a>
3.3 Invalid Parameters List</h2>
<p >These two blocks will no longer take effect and instead the motion detection results will be taken from motion detection (MD) NN: </p><dl class="section user"><dt>Motion_detect: fc_motion_detect</dt><dd></dd></dl>
<a class="anchor" id="table_lite_nn_motion_detect_params"></a>
<table class="doxtable">
<caption>Table 3-2. ADJ Parameters of Motion detect.</caption>
<tr>
<th>Parameters </th><th>Type </th><th>Description </th></tr>
<tr>
<td>enable </td><td>uint32 </td><td>1 for enable; 0 for disable </td></tr>
<tr>
<td>lev_add_1_method </td><td>uint32 </td><td>value: 0, 2, 7, 8, 12 </td></tr>
<tr>
<td>lev_add_1_table[64] </td><td>uint32 array </td><td>range: [0, 255] </td></tr>
<tr>
<td>lev_add_2_method </td><td>uint32 </td><td>value: 0, 2, 7, 8, 12 </td></tr>
<tr>
<td>lev_add_2_table[64] </td><td>uint32 array </td><td>range: [0, 255] </td></tr>
<tr>
<td>lev_mul_1_method </td><td>uint32 </td><td>value: 0, 2, 7, 8, 12 </td></tr>
<tr>
<td>lev_mul_1_table[64] </td><td>uint32 array </td><td>range: [0, 255] </td></tr>
<tr>
<td>lev_mul_2_method </td><td>uint32 </td><td>value: 0, 2, 7, 8, 12 </td></tr>
<tr>
<td>lev_mul_2_table[64] </td><td>uint32 array </td><td>range: [0, 255] </td></tr>
<tr>
<td>local_lighting </td><td>uint32 </td><td>range: [0,1] </td></tr>
<tr>
<td>motion_response </td><td>uint32 </td><td>range: [1, 511] </td></tr>
<tr>
<td>noise_base </td><td>uint32 </td><td>range: [0, 4095] </td></tr>
<tr>
<td>slow_mo_sensitivity </td><td>uint32 </td><td>range: [0, 19] </td></tr>
</table>
<dl class="section user"><dt>Motion_detect_and_mctf: fc_motion_detect_and_mctf</dt><dd></dd></dl>
<a class="anchor" id="table_lite_nn_mctf_params"></a>
<table class="doxtable">
<caption>Table 3-3. ADJ Parameters of MCTF.</caption>
<tr>
<th>Parameters </th><th>Type </th><th>Description </th></tr>
<tr>
<td>local_lighting_radius </td><td>unit32 </td><td>Range:[0,68] </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The 'fc_motion_detect_pos_dep' works with md_nn_mode.</li>
<li>'y/cb/cr_temporal_alpha*' and 'y/cb/cr_temporal_t*'<ul>
<li>The valid T value greater than 1 is considered to the motion part.</li>
<li>The rest are consistent with MCTF usage of traditional image digital signal processing (IDSP) tuning guide.</li>
</ul>
</li>
</ul>
</dd></dl>
<hr  />
<h1><a class="anchor" id="iq_lite_nnctrl_vivid_hdr"></a>
4. Vivid HDR</h1>
<p >This section introduces the basic idea of vivid HDR.</p><ul>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_vivid_hdr_intro">4.1 Introduction</a></li>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_vivid_hdr_params">4.2 ADJ Parameters</a></li>
</ul>
<h2><a class="anchor" id="iq_lite_nnctrl_vivid_hdr_intro"></a>
4.1 Introduction</h2>
<p >Vivid HDR uses NN to do tone mapping, rather than the traditional CE block.</p>
<h2><a class="anchor" id="iq_lite_nnctrl_vivid_hdr_params"></a>
4.2 ADJ Parameters</h2>
<a class="anchor" id="table_lite_nn_vivid_hdr"></a>
<table class="doxtable">
<caption>Table 4-1. ADJ Parameters of Vivid HDR.</caption>
<tr>
<th>Parameters </th><th>Type </th><th>Description </th></tr>
<tr>
<td>f_ce_nn_alpha_beta_gamma alpha </td><td>unit32 </td><td>Range:[0,255] </td></tr>
<tr>
<td>f_ce_nn_alpha_beta_gamma beta </td><td>unit32 </td><td>Range:[0,255] </td></tr>
<tr>
<td>f_ce_nn_alpha_beta_gamma gamma </td><td>unit32 </td><td>Range:[0,255] </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="iq_lite_nnctrl_api"></a>
5. Image NNCtrl Library API</h1>
<ul>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_api_intro">5.1 Introduction</a></li>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_api_detail">5.2 API Details</a><ul>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_api_detail_common">5.2.1 Common APIs for AISP and Lite NN</a></li>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_api_detail_aisp">5.2.2 Unique APIs for AISP</a></li>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_api_detail_lite_nn">5.2.3 Unique API for Lite NN</a></li>
</ul>
</li>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_api_detail_compute_method">5.3 Computation Method of NR Strength and CE Strength</a></li>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_api_detail_example">5.4 Example Usage</a><ul>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_api_detail_example_mdnn">5.4.1 Example on True Motion</a></li>
<li>Section <a class="el" href="../../d9/daa/iq_lite_nn.html#iq_lite_nnctrl_api_detail_example_tmnn">5.4.2 Example on Vivid HDR</a></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="iq_lite_nnctrl_api_intro"></a>
5.1 Introduction</h2>
<p >The image neural network control (NNCtrl) library is an image middleware which is responsible for loading image signal processor (ISP) NN networks (AISP and Lite NN) and runtime selecting specified network based on 3A related results.</p>
<dl class="section user"><dt>Key features supported by the image NNCtrl APIs include the follwoing:</dt><dd><ul>
<li>Load ISP NN networks into dynamic random access memory (DRAM)</li>
<li>Set / get noise reduction strength (NR strength)</li>
<li>Set / get contrast enhancement strength (CE strength)</li>
<li>Set / get motion detection strength (MD strength)</li>
<li>Set / get vivid HDR control strength</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="iq_lite_nnctrl_api_detail"></a>
5.2 API Details</h2>
<h3><a class="anchor" id="iq_lite_nnctrl_api_detail_common"></a>
5.2.1 Common APIs for AISP and Lite NN</h3>
<ul>
<li>AMBA_API <code>int img_nnctrl_init(int fd_iav)</code><ul>
<li>This API initializes the library with image audio video (IAV) driver. It must be called before all other functions.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_deinit()</code><ul>
<li>This API de-initializes the library. It must be called after all other functions.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_precheck()</code> This API resumes / clear data based on digital signal processor (DSP) status. Returns 0 = success, -1 = error.</li>
<li>AMBA_API <code>int img_nnctrl_set_config(img_nn_config_info_t *config_info)</code><ul>
<li>This API sets the configuration information from user app.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>void img_nnctrl_set_loglevel(int level)</code><ul>
<li>This API sets log level. 0: error, 1: info; 2: debug: 3: print</li>
</ul>
</li>
<li>AMBA_API <code>void img_nnctrl_get_loglevel(void)</code><ul>
<li>This API gets current log level. It prints log level in console.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_version(img_nnctrl_version_t *ver)</code><ul>
<li>This API gets the version information of image NNCtrl library.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="iq_lite_nnctrl_api_detail_aisp"></a>
5.2.2 Unique APIs for AISP</h3>
<ul>
<li>AMBA_API <code>int img_nnctrl_get_aisp_default(uint32_t *nr_str, uint32_t *ce_str)</code><ul>
<li>This API gets the default NR strength and CE strength.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_set_nr_ce(uint32_t nr_str, uint32_t ce_str)</code><ul>
<li>This API sets the NR strength and CE strength. Both parameters should be valid.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_nr(uint32_t *nr_str)</code><ul>
<li>This API gets current NR strength.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_set_nr(uint32_t nr_str)</code><ul>
<li>This API sets NR strength. The CE strength uses the current value.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_ce(uint32_t *ce_str)</code><ul>
<li>This API gets current CE strength.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_set_ce(uint32_t ce_str)</code><ul>
<li>This API sets CE strength. The NR strength uses the current value.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_md(uint32_t *md_str)</code><ul>
<li>This API gets current MD strength.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_set_md(uint32_t md_str)</code><ul>
<li>This API sets MD strength. The NR strength uses the current value.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_do_execute()</code><ul>
<li>This API executes AISP configuration.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="iq_lite_nnctrl_api_detail_lite_nn"></a>
5.2.3 Unique API for Lite NN</h3>
<ul>
<li>AMBA_API <code>int img_nnctrl_set_nn_tm(nn_tm_t *tm, uint32_t chan_id)</code><ul>
<li>This API sets vivid HDR control parameters for specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_nn_tm(nn_tm_t *tm, uint32_t chan_id)</code><ul>
<li>This API gets vivid HDR control parameters of specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_set_nn_ce(uint32_t ce_str, uint32_t chan_id)</code><ul>
<li>This API sets CE strength for specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_nn_ce(uint32_t *ce_str, uint32_t chan_id)</code><ul>
<li>This API gets CE strength of specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_set_nn_md(uint32_t md_str, uint32_t chan_id)</code><ul>
<li>This API sets MD strength for specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_nn_md(uint32_t *md_str, uint32_t chan_id)</code><ul>
<li>This API gets MD strength of specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_set_nn_nr(uint32_t nr_str, uint32_t chan_id)</code><ul>
<li>This API sets NR strength for specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_nn_nr(uint32_t *nr_str, uint32_t chan_id)</code><ul>
<li>This API gets NR strength of specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_do_nn_execute(uint32_t chan_id)</code><ul>
<li>This API executes the NN configuration for specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_nn_md_status(uint32_t chan_id, u8 *status)</code><ul>
<li>This API queries the true motion NN status of specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_nn_tm_status(uint32_t chan_id, u8 *status)</code><ul>
<li>This API queries the vivid HDR NN status of specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
<li>AMBA_API <code>int img_nnctrl_get_default_md_nn(uint32_t *nr_str, uint32_t *ce_str, uint32_t chan_id)</code><ul>
<li>This API gets the default NR strength and CE strength of specified channel index.</li>
<li>Returns 0 = success, -1 = error.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="iq_lite_nnctrl_api_detail_compute_method"></a>
5.3 Computation Method of NR Strength and CE Strength</h2>
<ul>
<li>NR strength: Basically, it varies with the gain result. Users can set NR strength they want to run. It is defined in <code>nn_container_pkg</code> part in ADJ file.</li>
<li>CE strength: It is calculated based on shutter ratio result. The calculation is as follow: CE_strength = Shutter_ratio * 8</li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>When CE_strength is greater than 255, it should be clipped to 255.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="iq_lite_nnctrl_api_detail_example"></a>
5.4 Example Usage</h2>
<h3><a class="anchor" id="iq_lite_nnctrl_api_detail_example_mdnn"></a>
5.4.1 Example on True Motion</h3>
<dl class="section user"><dt>Prepare IDSP stage</dt><dd><div class="fragment"><div class="line"><span class="preprocessor"># Initialize image nnctrl library</span></div>
<div class="line">img_nnctrl_init(<a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Pre-check image nnctrl library</span></div>
<div class="line">img_nnctrl_precheck();</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Set img nn config info</span></div>
<div class="line">img_nnctrl_set_config(config_info);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Set first NR and CE strength to IDSP before entering preview</span></div>
<div class="line"><span class="preprocessor"># This step is related to whether DSP can work or not. Please make sure NR and CE are</span></div>
<div class="line"><span class="preprocessor"># supported in the AISP network</span></div>
<div class="line">img_nnctrl_set_nr_ce(nr_str, ce_str);</div>
<div class="ttc" id="avin__init_8c_html_a5294002f7dca0cd9bcc0009a27895ef7"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a></div><div class="ttdeci">int fd_iav</div></div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Runtime update after entering preview</dt><dd><div class="fragment"><div class="line"><span class="preprocessor"># Update NR and CE strength based on Chapter 3</span></div>
<div class="line">img_nnctrl_set_nr_ce(nr_str_update, ce_str_update);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># If users want to update only NR strength</span></div>
<div class="line"><span class="preprocessor"># Update NR based on Chapter 3</span></div>
<div class="line">img_nnctrl_set_nr(nr_str_update);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># If users want to update only CE strength</span></div>
<div class="line"><span class="preprocessor"># Update CE strength based on Chapter 3</span></div>
<div class="line">img_nnctrl_set_ce(ce_str_update);</div>
</div><!-- fragment --></dd></dl>
<h3><a class="anchor" id="iq_lite_nnctrl_api_detail_example_tmnn"></a>
5.4.2 Example on Vivid HDR</h3>
<p >This section content is still under construction.</p>
<dl class="section user"><dt>Exit preview stage</dt><dd><div class="fragment"><div class="line"><span class="preprocessor"># De-initialize image nnctlr library</span></div>
<div class="line">img_nnctrl_deinit();</div>
</div><!-- fragment --></dd></dl>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
