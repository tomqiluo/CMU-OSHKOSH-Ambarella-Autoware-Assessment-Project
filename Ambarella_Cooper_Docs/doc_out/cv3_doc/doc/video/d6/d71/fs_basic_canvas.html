<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Video: BASIC - Canvas</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Video"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Video<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/d71/fs_basic_canvas.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASIC - Canvas </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="canvas_manual_feed"></a>
1. Canvas Features</h1>
<p >The source buffers for different "channel" can be placed in the same canvas, and then sent to video output (VOUT) for preview, or video digital signal processor (VDSP) for encode.<br  />
 The following figure describes the mapping relationship between VIN, channels, source buffers, and then to canvases.</p>
<div class="image">
<img src="../../canvas_mapping.png" alt=""/>
<div class="caption">
Figure 1-1. Canvas Mapping.</div></div>
<h2><a class="anchor" id="canvas_layout"></a>
1.1 Flexible Canvas Layout</h2>
<p >The source buffers from different "channel" can be placed in either independent canvases, such as Canvas 2 and Canvas 3, or combined together to the same canvases, such as Canvas 0 and Canvas 1. Blend view enables placement of different source buffers side-by-side, horizontally and vertically. Picture in picture (PIP) view enables placing one or more small source buffers above a large source buffer.<br  />
 The canvases from sub source buffers can have their own frame rates. This requires digital signal processor (DSP) to output the same frame rate for each source buffer, which is put in the same canvas.<br  />
</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Users must propose a layout design before entering <a class="elRef" href="../../../driver/df/d3f/page_drv_iav_doc.html#iav_state_model">Preview</a>. Change the canvas layout on the fly is not permitted.</li>
<li>Main buffer must be placed in a canvas for encoding purpose.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="canvas_feed_mode"></a>
1.2 Canvas Feed Mode</h2>
<p >Each canvas buffer is generated and reported to ArmÂ® by DSP, and is allocated and maintained using three different methods. In addition, it can be configured through <a class="el" href="../../d6/d71/fs_basic_canvas.html#anchor_canvas_manual_feed">manual_feed</a> item or "ext_mem" item in the Lua script. In the canvas auto-generation mode, canvas buffers cannot be accessed by the vector processor (VP). In the canvas manual feed mode and canvas external-memory mode, canvas buffers can be accessed by VP.</p>
<ul>
<li>
<b>Canvas auto-generation mode</b> </li>
<li>
<b>Canvas manual-feed mode</b> </li>
<li>
<b>Canvas external-memory mode</b> </li>
</ul>
<p>In the canvas auto-generation mode, DSP allocates and maintains the canvas buffers. Each time DSP completes drawing all the canvas buffers, then it is automatically reported to Arm. In auto-generation mode, DSP will guarantee the frame rate.<br  />
</p>
<p >However, users may not need to query the canvas data at the image digital signal processing (IDSP) fps to reduce the system load. In the canvas manual feed mode, the frame queue is fully driven and controlled by user application. Each time a user application requests a canvas buffers, it will trigger the image audio video (IAV) driver to feed an empty buffer address to the DSP. DSP fills canvas data into the buffers, and then reports back to Arm. This feature will significantly save the dynamic random-access memory (DRAM) bandwidth if users need to query canvas at a very low frame rate.<br  />
</p>
<p >In the canvas external-memory mode, Arm allocates the canvas buffers and DSP maintains these canvas buffers. These canvas buffers can be accessed by the VP. Each time DSP completes drawing all the canvas buffers, then it is automatically reported to Arm. Because of CV5x's special architecture, VP cannot access the canvas memory in the canvas auto-generation mode. If the user wants the DSP to maintain the canvas buffers and also VP can access these buffers, then the canvas external-memory mode is a good choice. <br  />
</p>
<dl class="section note"><dt>Note</dt><dd>In the canvas manual feed mode, IAV has the following limitations.<ul>
<li>Only support "encode" canvas for manual feed.</li>
<li>When canvas is in the manual-feed mode, it cannot be used for VOUT or encoding.</li>
<li>Do not support canvas manual feed in <em>multi-region dewarp mode</em></li>
</ul>
</dd></dl>
<hr  />
<h1><a class="anchor" id="canvas_configuration"></a>
2. Canvas Configuration</h1>
<p >Users can configure the canvas via Lua script. Here are the canvas parameters.<br  />
</p>
<a class="anchor" id="table_canvas_lua"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Item </th><th><div style="width:180px"><b>Parameter</b></div> </th><th>Description </th></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_type"></a>type </td><td>"prev"<br  />
 "encode"<br  />
 </td><td>Specifies the canvas type. It can be either "encode" or "prev". There is no "off" type for canvas. If application needs to turn off the canvas, it has to reconfigure the system and remove the canvas definition. If canvas type is preview, it outputs YUV422 or YUV420 format with UV interleaved data. If canvas type is encoded, it outputs YUV420 format with UV interleaved data. </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_size"></a>size </td><td>{width, height} </td><td>Specifies the canvas resolution. </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_source"></a>source </td><td>1: chan_x.main <br  />
 2: chan_x.second <br  />
 3: chan_x.third <br  />
 4: chan_x.fourth <br  />
 5: chan_x.fifth <br  />
 6: chan_x.sixth <br  />
 </td><td>Specifies the source buffer of channels to canvas. DSP follows the source buffer declare order to put channel source buffer data in this field. The latter source buffer is put in with a higher Z order and may cover the source buffer with a lower Z order. The channels whose source buffer are put to the same canvas must have the same "idsp_fps".<br  />
 </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_vout_id"></a>vout_id </td><td>0/1: VOUT1 (CSI, DSI)<br  />
 2: VOUT2 (HDMI, CVBS) </td><td>Specifies VOUT. If setting to 2, VOUT2 (like HDMI, CVBS) will be used to show preview canvas. If setting to 0/1, VOUT0/1 (like CSI, DSI) will be used to show preview canvas. </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_vout_YUV422"></a>vout_YUV422 </td><td>0: VOUT format is 420<br  />
 1: VOUT format is 422 </td><td>Specifies the YUV format of "prev" type canvas. If setting to 1, its YUV format is YUV422. Then VOUT captures the display data from it directly to show out. If setting to 0, its YUV format is YUV420 which is the same as other "encode" type canvases. Then VOUT will convert it to YUV422 before showing out.<br  />
 </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_vout_back_pressure_margin"></a>vout_back_pressure_margin </td><td>[0,3]<br  />
 0 means use the default value 2 </td><td>Specifies the back pressure margin for the VOUT. </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_manual_feed"></a>manual_feed </td><td>0: automic feed mode<br  />
 1: manual feed mode </td><td>Enables canvas manual feed. Set to 1 to enable manual feed. Set to 0 to automatically feed by DSP. </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_feed_frame_num"></a>feed_frame_num </td><td>[4, 12] </td><td>Specifies the manual feed or external buffers. In the canvas manual feed or the external buffer mode, IAV allocates the YUV buffers in kernel driver memory. This value should be in the range of [4, 12]. If the value is lower than 4, it will be set to 4 by IAV driver. If the value is higher than 12, it will be set to 12 by IAV driver. </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_extra_dram_buf"></a>extra_dram_buf </td><td>i &gt;= 0 </td><td>Specifies the extra DRAM frames for the canvas. </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_cached_items"></a>cached_items </td><td>extra_dram_buf &gt;= 1: [1, extra_dram_buf]<br  />
 Default: 1 </td><td>Specifies cached items for canvas buffer information when it is queried by user application. By default, cached_items = 1, IAV driver only keeps the latest canvas buffer. When the latter comes, the former will be discarded. When cached_items &gt; 1, IAV driver will maintain a FIFO whose depth = cached_items. So user application can catch up if previous canvas buffer querying is postponed. </td></tr>
<tr>
<td><a class="anchor" id="anchor_canvas_clear_background"></a>clear_background </td><td>0: disable<br  />
 1: enable </td><td>Clears the canvas memory to blackground color after entering preview. </td></tr>
<tr>
<td><a class="anchor" id="anchor_enable_frame_tag"></a>enable_frame_tag </td><td>0: disable<br  />
 1: enable </td><td>Enables canvas frame tag pattern feature. </td></tr>
<tr>
<td><a class="anchor" id="anchor_frame_tag_value"></a>frame_tag_value </td><td>[0, 0xFFFFFFFF] </td><td>Sets canvas frame tag value. This value is valid when enable_frame_tag flag is enabled. </td></tr>
<tr>
<td><a class="anchor" id="anchor_frame_tag_mask"></a>frame_tag_mask </td><td>[0, 0xFFFFFFFF] </td><td>Sets canvas frame tag mask. This value is valid when enable_frame_tag flag is enabled. </td></tr>
<tr>
<td><a class="anchor" id="anchor_zero_fps"></a>zero_fps </td><td>0: disable<br  />
 1: enable </td><td>Enables 0 fps canvas frame rate. When setting to 0, "frame_rate = 0" represents idsp_fps. When setting to 1, "frame_rate = 0" is real 0 fps. </td></tr>
<tr>
<td><a class="anchor" id="anchor_enc_dummy_latency"></a>enc_dummy_latency </td><td>i &gt;= 0 </td><td>Specifies the latency number of encode dummy buffer. </td></tr>
<tr>
<td><a class="anchor" id="anchor_frame_rate"></a>frame_rate </td><td>i &gt;= 0 </td><td>Specifies the canvas frame rate, it must be less than idsp_fps. </td></tr>
<tr>
<td><a class="anchor" id="anchor_set_min_unlocked_buf_num"></a>set_min_unlocked_buf_num </td><td>0: disable<br  />
 1: enable </td><td>Enables set min_unlocked_buf_num config. </td></tr>
<tr>
<td><a class="anchor" id="anchor_min_unlocked_buf_num"></a>min_unlocked_buf_num </td><td></td><td>Specifies canvas minimum unlocked buffer number. When users want to set min_unlocked_buf_num accordingly, users need to enable manual_feed and set_min_unlocked_buf_num first. Meanwhile, item_num &gt; min_unlocked_buf_num. </td></tr>
<tr>
<td><a class="anchor" id="anchor_blend_stitch_type"></a>blend_stitch_type </td><td>0: no blend<br  />
 1: blend horizontally 2: blend veritically </td><td>Specifies canvas blend stitch type. It can be no blending, horizontally blending, or vertical blending. </td></tr>
<tr>
<td><a class="anchor" id="anchor_blend_stitch_circular_margin"></a>blend_stitch_circular_margin </td><td>i &gt;= 0 </td><td>Specifies the overlap margin of the last channel and first channel. Only valid when "blend_stitch_type" isn't 0. </td></tr>
<tr>
<td><a class="anchor" id="anchor_blend_warp_enable"></a>blend_warp_enable </td><td>0: disable<br  />
 1: enable </td><td>Enables H warp for blending overlap region. Only valid when "blend_stitch_type" isn't 0. </td></tr>
<tr>
<td><a class="anchor" id="anchor_disable_yuv_dram"></a>disable_yuv_dram </td><td>0(Default): Allocate buffer<br  />
 1: Not allocate buffer </td><td>Allows DSP to allocate canvas YUV buffer or not. It can be used to save DSP DRAM. </td></tr>
<tr>
<td><a class="anchor" id="anchor_fps_locked_enable"></a>fps_locked_enable </td><td>0 (Default): disable<br  />
 1: enable </td><td>If this flag is enabled, canvas fps will be locked. When IDSP fps is changed on the fly, it will not be changed proportionally when it is &lt;= IDSP fps. </td></tr>
<tr>
<td><a class="anchor" id="anchor_ext_mem"></a>ext_mem </td><td>0 (Default): disable<br  />
 1: enable </td><td>Enables the canvas external memory mode. Set to 1 to enable the canvas external memory. </td></tr>
<tr>
<td><a class="anchor" id="anchor_extra_padding"></a>enc_extra_padding_enable </td><td>0 (Default): disable<br  />
 1: enable </td><td>Enables extra padding for streams encoding with offset. Set to 1 to enable extra padding. </td></tr>
</table>
<p ><b>An Example for Canvas Lua Configuration</b><br  />
</p>
<div class="fragment"><div class="line">canvas = {</div>
<div class="line">    {</div>
<div class="line">      type = <span class="stringliteral">&quot;encode&quot;</span>,            -- canvas 0 is <span class="keywordflow">for</span> <span class="stringliteral">&quot;encode&quot;</span> purpose.</div>
<div class="line">      size = {0, 0},              -- min size to contain <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> buffers.</div>
<div class="line">      <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.main&quot;</span>,},  -- input from <a class="code hl_function" href="../../db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>.</div>
<div class="line">      manual_feed = 1,            -- enable manual feed.</div>
<div class="line">      feed_frame_num = 8,         -- <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a> <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#ac76cea59d438ba893d2f82aabb367d14">item</a> mantained by iav driver.</div>
<div class="line">      extra_dram_buf = 2,         -- to support multi-stream encoded from the same canvas.</div>
<div class="line">      cached_items = 2,           -- to specify 2 cached items <span class="keywordflow">for</span> canvas <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a> info.</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      type = <span class="stringliteral">&quot;prev&quot;</span>,              -- canvas 1 is <span class="keywordflow">for</span> <span class="stringliteral">&quot;prev&quot;</span> purpose.</div>
<div class="line">      size = {0, 0},              -- min size to contain <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> buffers.</div>
<div class="line">      <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.third&quot;</span>,}, -- input from third <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>.</div>
<div class="line">      <a class="code hl_variable" href="../../d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a> = 1,                -- use <span class="stringliteral">&quot;HDMI&quot;</span> or <span class="stringliteral">&quot;CVBS&quot;</span> output.</div>
<div class="line">      <a class="code hl_variable" href="../../d4/de8/vout__init_8c.html#ab4a73b5629d37ce98639684eb84d8410">vout_YUV422</a> = 0,            -- to specify the YUV <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> of <span class="stringliteral">&quot;prev&quot;</span> type canvas is YUV420.</div>
<div class="line">      vout_back_pressure_margin = 3, -- to specify 3 as the current vout[1] input FIFO depth.</div>
<div class="line">      extra_dram_buf = 0,         -- to support multi-stream encoded from the same canvas.</div>
<div class="line">      cached_items = 1,           -- to specify 1 cached items <span class="keywordflow">for</span> canvas <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a> info.</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      type = <span class="stringliteral">&quot;encode&quot;</span>,              -- canvas 2 is <span class="keywordflow">for</span> <span class="stringliteral">&quot;encode&quot;</span> purpose.</div>
<div class="line">      size = {0, 0},                -- min size to contain <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> buffers.</div>
<div class="line">      <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.fourth&quot;</span>,},  -- input from the fourth <a class="code hl_variableRef" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>.</div>
<div class="line">      extra_dram_buf = 2,           -- to support multi-stream encoded from the same canvas.</div>
<div class="line">      frame_rate = 0,               -- set canvas frame rate to 0 fps</div>
<div class="line">      zero_fps = 1,                 -- When zero_fps is 0, <span class="stringliteral">&quot;frame_rate = 0&quot;</span> represents idsp_fps. When zero_fps is 1, <span class="stringliteral">&quot;frame_rate = 0&quot;</span> is real 0 fps.</div>
<div class="line">    },</div>
<div class="line">}</div>
<div class="ttc" id="acJSON_8h_html_ac76cea59d438ba893d2f82aabb367d14"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#ac76cea59d438ba893d2f82aabb367d14">item</a></div><div class="ttdeci">cJSON * item</div></div>
<div class="ttc" id="acJSON_8h_html_adb411a44855a4c49231d72a0fc9a3b3b"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div><div class="ttdeci">char const int const cJSON_bool format</div></div>
<div class="ttc" id="acJSON_8h_html_aff2566f4c366b48d73479bef43ee4d2e"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a></div><div class="ttdeci">char * buffer</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> test_vout_cfg.c:85</div></div>
<div class="ttc" id="avin__init_8c_html_a07a87b2e6ed927503e2f95f119c9fc23"><div class="ttname"><a href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a></div><div class="ttdeci">int source</div><div class="ttdef"><b>Definition:</b> vin_init.c:57</div></div>
<div class="ttc" id="avout__init_8c_html_a049a525f0e8bc8bee106f89f18f896ce"><div class="ttname"><a href="../../d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a></div><div class="ttdeci">int vout_id</div><div class="ttdef"><b>Definition:</b> vout_init.c:36</div></div>
<div class="ttc" id="avout__init_8c_html_ab4a73b5629d37ce98639684eb84d8410"><div class="ttname"><a href="../../d4/de8/vout__init_8c.html#ab4a73b5629d37ce98639684eb84d8410">vout_YUV422</a></div><div class="ttdeci">int vout_YUV422[VOUT_NUM]</div><div class="ttdef"><b>Definition:</b> vout_init.c:42</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>The maximum canvas number is up to 20.</li>
<li>The canvas type must be either preview or encode. There is no off type.</li>
<li>The source buffer outputs combined in the same canvas, must be in the same buffer type, preview, encode or off.</li>
<li>DSP must output the same frame rate for each source buffer, which are put in the same canvas.</li>
</ul>
</dd></dl>
<p><br  />
</p>
<hr  />
<h1><a class="anchor" id="section_canvas_example"></a>
3. Canvas Examples</h1>
<h2><a class="anchor" id="example_manual_feed_main_buffer"></a>
Example 1: Manual Feed Main Canvas</h2>
<p >Here is an example for feeding canvas which is input from the main buffer. As well as the Lua script can be found <a href="../../script/canvas_manual_feed_main.lua" target="_blank"><b>here</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg canvas_manual_feed_main.lua</div>
<div class="line">board# test_manual_feed -a 0 -Q 1</div>
</div><!-- fragment --><h2><a class="anchor" id="example_manual_feed_second_buffer"></a>
Example 2: Manual Feed Second Canvas</h2>
<p >Also, users can feed the second canvas which is input from the second buffer manually. As well as the Lua script can be found <a href="../../script/canvas_manual_feed_second.lua" target="_blank"><b>here</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg canvas_manual_feed_second.lua</div>
<div class="line">board# test_manual_feed -a 1 -Q 1</div>
</div><!-- fragment --><h2><a class="anchor" id="example_runtime_update_canvas_fps"></a>
Example 3: Update Canvas Framerate at Runtime</h2>
<ol type="1">
<li>Update canvas framerate on the fly</li>
</ol>
<p >Use "test_multi_chan", canvas framerate can be updated on the fly.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode -i 0 --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_multi_chan -C 2 -F 15</div>
</div><!-- fragment --><ol type="1">
<li>Set default framerate of canvas to IDSP</li>
</ol>
<p >In this example, "0" means canvas framerate is set by default to IDSP framerate rather than real 0 fps.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode -i 0 --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_multi_chan -C 2 -F 0</div>
</div><!-- fragment --><ol type="1">
<li>Set canvas framerate to real 0 fps.</li>
</ol>
<p >Canvas framerate are required to be set to 0 fps at runtime when it is not used temporarily. This can save the DRAM bandwidth. Use "test_multi_chan" option "z", the canvas framerate can be set to real 0 fps.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode -i 0 --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_multi_chan -C 2 -F 0 -z</div>
</div><!-- fragment --><p >Or the user can set real 0 fps via lua. </p><div class="fragment"><div class="line">canvas = {</div>
<div class="line">     .....</div>
<div class="line">     {</div>
<div class="line">           type = <span class="stringliteral">&quot;encode&quot;</span>,</div>
<div class="line">           size = {0, 0},</div>
<div class="line">           <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.third&quot;</span>,},</div>
<div class="line">           zero_fps = 1,</div>
<div class="line">          .....</div>
<div class="line">     },</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
</div><!-- fragment --><h2><a class="anchor" id="example_canvas_external_mem"></a>
Example 4: Canvas External Memory</h2>
<p >Here is an example for used external memory for canvas0. As well as the Lua script can be found <a href="../../script/canvas_ext_mem.lua" target="_blank"><b>here</b></a>.</p>
<div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg canvas_ext_mem.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="example_canvas_extra_padding"></a>
Example 5: Canvas Extra Padding Enable</h2>
<p >Sometimes canvas is used for encoding streams with offsets, if the stream aligned size + offset size is larger than the canvas size, enable the option enc_extra_padding_enable to add an extra padding.</p>
<p >For example, try the changes below based on the <code>lua xxx_vin0_1080p_linear_rotate.lua</code> in the board. </p><div class="fragment"><div class="line">fourth = {</div>
<div class="line">        max_output = {0, 0},</div>
<div class="line">        input      = {0, 0, 0, 0},</div>
<div class="line">        output     = {0, 0, 368, 640},</div>
<div class="line">},</div>
<div class="line">.....</div>
<div class="line">canvas = {</div>
<div class="line">     .....</div>
<div class="line">     {</div>
<div class="line">           type = <span class="stringliteral">&quot;encode&quot;</span>,</div>
<div class="line">           size = {0, 0},</div>
<div class="line">           <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.fourth&quot;</span>,},</div>
<div class="line">           extra_dram_buf = 0,</div>
<div class="line">           enc_extra_padding_enable = 1,</div>
<div class="line">     },</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3)   <span class="comment">// For CV72</span></div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear_rotate.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board# test_encode -A -b 3 -h 360x640 --offset 4x0 -e</div>
</div><!-- fragment --><p >In this case, the canvas size is 368x640 and encoding stream size is 360x640 with offset 4x0, then the stream aligned size would be 368x640 (16-pixels alinged) with offset 4x0, so the total size is 372x640, which is larger than canvas size 368x640.</p>
<h2><a class="anchor" id="example_canvas_yuv_disable"></a>
Example 6: Canvas YUV Disable</h2>
<p >Disabling YUV data output into DRAM for each canvas can reduce the DRAM bandwidth (BW) for some special applications that generally do not require the YUV data.</p>
<p >The <code>disable_yuv_dram</code> is used for Canvas's YUV disable or enable. This example here is for Canvas to disable YUV from Main Buffer.</p>
<div class="fragment"><div class="line">canvas = {</div>
<div class="line">     {</div>
<div class="line">           .....</div>
<div class="line">           <a class="code hl_variable" href="../../d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.main&quot;</span>,},</div>
<div class="line">           disable_yuv_dram = 1,</div>
<div class="line">           .....</div>
<div class="line">     },</div>
<div class="line">     .....</div>
<div class="line">}</div>
</div><!-- fragment --><p >The case above means that the YUV output is disabled for this canvas and no YUV data will be generated.</p>
<dl class="section note"><dt>Note</dt><dd>Disabling YUV is related to encoding, video output, and YUV capture, and all of features which rely on the YUV data generated by this canvas will fail. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
