<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ambarella Linux SDK: Getting Started Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Ambarella Linux SDK"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Ambarella Linux SDK<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d6c/page_getting_start_guide.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Getting Started Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="getting_guide_history"></a>
0. Revision History</h1>
<a class="anchor" id="getting_guide_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>SDK Version </th><th>Updated Date </th><th>Modification </th></tr>
<tr>
<td>CV5x_SDK_0.1 </td><td>20211021 </td><td>Initial Version </td></tr>
<tr>
<td rowspan="5">CV5x_SDK_0.5 </td><td rowspan="5">20220114 </td><td>Updated Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_down">7.1 Enter USB Download Mode</a> </td></tr>
<tr>
<td>Updated Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_fastboot_ubu">7.2 Fastboot Tool (for Ubuntu)</a> </td></tr>
<tr>
<td>Updated Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_fastboot_win">7.3 Fastboot Tool (for Windows)</a> </td></tr>
<tr>
<td>Added Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_ambausb_ubu">7.4 AmbaUSB (for Ubuntu)</a> </td></tr>
<tr>
<td>Added Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_ambausb_win">7.5 AmbaUSB (for Windows)</a> Updated Chapter </td></tr>
<tr>
<td rowspan="5">CV5x_SDK_1.0 </td><td rowspan="5">20220415 </td><td>Updated Chapter <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_hardware_cv5">2. Setting up the CV5 EVK Hardware</a> </td></tr>
<tr>
<td>Added Chapter 3. Setting up the CV52N EVK Hardware </td></tr>
<tr>
<td>Added Chapter <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_hardware_cv52">4. Setting up the CV52 EVK Hardware</a> </td></tr>
<tr>
<td>Updated Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_build">6.1 Building the Binary for the Board</a> </td></tr>
<tr>
<td>Updated Chapter <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_document">8. SDK Documents on the Website</a> </td></tr>
<tr>
<td rowspan="5">CV5x_SDK_1.5 </td><td rowspan="5">20220720 </td><td>Removed Section CV5 EVK Rev 1.x /2.0 System I/O and Hardware Control </td></tr>
<tr>
<td>Updated Chapter <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_hardware_cv5">2. Setting up the CV5 EVK Hardware</a> </td></tr>
<tr>
<td>Updated Chapter <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_hardware_cv52">4. Setting up the CV52 EVK Hardware</a> </td></tr>
<tr>
<td>Updated Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_fastboot_win">7.3 Fastboot Tool (for Windows)</a> </td></tr>
<tr>
<td>Updated Chapter <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_document">8. SDK Documents on the Website</a> </td></tr>
<tr>
<td rowspan="4">CV5x_SDK_2.0 </td><td rowspan="2">20220829 </td><td>Migrate this Getting Started Guide document from Word form into Doxygen form </td></tr>
<tr>
<td>Updated Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_cnn">6.7 Run CNN</a> </td></tr>
<tr>
<td>20220916 </td><td>Added Chapter <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_cpu">9. CPU Performance Benchmarks</a> </td></tr>
<tr>
<td>20221025 </td><td>Upgrade Cortex Toolchain to 12.1 </td></tr>
<tr>
<td rowspan="3">Cooper_SDK_0.5 </td><td rowspan="3">20230420 </td><td>Added Chapter <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_sd_card">10. SD Card</a> </td></tr>
<tr>
<td>Added Chapter <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_hardware_cv72">5. Setting Up the CV72 EVK Hardware</a> </td></tr>
<tr>
<td>Initial Version of Cooper SDK </td></tr>
<tr>
<td>Cooper_SDK_1.0 </td><td>20230726 </td><td>Added new building method to support both Amba-Build-v2 and Yocto-Build.<br  />
 Since SDK 1.0, it supports CV2x, CV5x and CV72 chips </td></tr>
<tr>
<td rowspan="2">Cooper_SDK_1.6 </td><td>20231228 </td><td>Updated Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_document_cnngen_cv5">8.2 Generated CNNGen Document Website</a> </td></tr>
<tr>
<td>20240105 </td><td>Updated Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#dsub_guide_demo_evaluation">6.1.2 Evaluation Package</a> </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="getting_guide_overview"></a>
1. Overview</h1>
<p >This document guides users through the environment setup process for evaluating the Ambarella Cooper Linux Evaluation Kit (EVK) and the system on chip (SoC).</p>
<p >Users with little or no previous experience using Ambarella devices are encouraged to proceed sequentially through this guide and become familiar with the complete range of hardware and software features.</p>
<p >For users with prior experience setting up Ambarella devices, this document provides a quick introduction to EVK board setup before starting hands-on work with the Cooper chip family.</p>
<h2><a class="anchor" id="sub_guide_over_pc"></a>
1.1 PC Requirements</h2>
<p >A PC connected to the internet is used to download the software development kit (SDK) and / or upgrade the firmware. For more details on upgrading the firmware, refer to <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_upgrade_firmware">Upgrading the Firmware</a>.</p>
<p >The PC must be equipped with the following:</p>
<a class="anchor" id="getting_guide_pc_require_usage"></a>
<table class="doxtable">
<caption>Table 1-1. PC Requirements.</caption>
<tr>
<th>Category </th><th>Requirement </th></tr>
<tr>
<td>CPU </td><td>Intel® i7 or higher grade </td></tr>
<tr>
<td>Memory </td><td>8 GB system memory or more </td></tr>
<tr>
<td>Hard disk </td><td>120 GB or more </td></tr>
<tr>
<td>Video card </td><td>3D hardware accelerator card required - 100% DirectX 9.0c compatible NVIDIA® GeForce GT520 or above to assure full frame rate of HD </td></tr>
<tr>
<td>Monitor </td><td>24-inch LCD or larger with a digital visual interface (DVI) input. A Dell UltraSharp 2709W (VA panel) is preferred </td></tr>
<tr>
<td>LCD TV </td><td>29-inch LCD TV or larger with YPbPr input (1080p resolution) </td></tr>
<tr>
<td>Ethernet card </td><td>1000 Mbps (adaptive) </td></tr>
<tr>
<td>I/O interfaces </td><td>RS232 </td></tr>
<tr>
<td>Operating system </td><td>Windows 7 / 8 64 bit or Ubuntu 20.04 LTS 64 bit </td></tr>
<tr>
<td>Virtual machine </td><td>Oracle® VirtualBox 5.0.32 or later </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="getting_guide_hardware_cv5"></a>
2. Setting Up the CV5 EVK Hardware</h1>
<p >For more information about setting up the CV5 EVK hardware, refer to <a class="elRef" target="_blank" href="../../../hardware/da/d9e/page_cv5_timn.html">Board - CV5 Titanium</a>.</p>
<hr  />
<h1><a class="anchor" id="getting_guide_hardware_cv52"></a>
3. Setting Up the CV52 EVK Hardware</h1>
<p >For more information about setting up the CV52 EVK hardware, refer to <a class="elRef" target="_blank" href="../../../hardware/da/dca/page_cv52_cocr.html">Board - CV52 Co / Cr</a>.</p>
<hr  />
<h1><a class="anchor" id="getting_guide_hardware_cv72"></a>
4. Setting Up the CV72 EVK Hardware</h1>
<p >For more information about setting up the CV72 EVK hardware, refer to <a class="elRef" target="_blank" href="../../../hardware/dd/d4e/page_cv72_gage.html">Board - CV72 Ga / Ge</a>.</p>
<hr  />
<h1><a class="anchor" id="getting_guide_setting_pc"></a>
5. Setting Up the PC</h1>
<p >Before proceeding to the steps in this chapter, review the software and PC requirements listed in <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_over_pc">1.1 PC Requirements</a> and set up the EVK hardware following the steps in:</p><ul>
<li><a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_hardware_cv5">Chapter 2: Setting up the CV5 EVK Hardware</a></li>
<li><a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_hardware_cv52">Chapter 3: Setting up the CV52 EVK Hardware</a></li>
<li><a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_hardware_cv72">Chapter 4: Setting up the CV72 EVK Hardware</a></li>
</ul>
<p >This chapter describes how to perform the following:</p>
<ul>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_setting_pc_install">5.1 Installing the EVK Software</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_setting_pc_network">5.2 Setting Up the Network</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_setting_pc_console">5.3 Connecting to a Console Window</a></li>
</ul>
<h2><a class="anchor" id="sub_guide_setting_pc_install"></a>
5.1 Installing the EVK Software</h2>
<p >The following tools / folders will be installed on the host PC:</p><ul>
<li><b>AmbaUSB</b> (for Windows, Linux, and Mac) for upgrading firmware via USB. Contact Ambarella for tool release</li>
<li><b>UART / Serial Console Tool</b>: Users can download and install any universal asynchronous receiver / transmitter (UART) / serial terminal tool for console access such as PuTTY, mini-com, MobaXterm, and more</li>
<li><b>Google USB driver</b> for the fastboot device</li>
<li><b>CH340 driver</b> for USB to serial drivers, including Windows, Linux, and Mac versions</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>When a CV5x / CV7x board connects to an Ubuntu PC, USB-to-serial chip may use the default Linux driver and this driver cannot receive any input. To let serial accept input, CH343 driver needs to download, compile, and load manually :<ol type="1">
<li>Download the driver from <a href="https://github.com/WCHSoftGroup/ch343ser_linux">https://github.com/WCHSoftGroup/ch343ser_linux</a></li>
<li>Run <code>make</code> command to compile source code and generate <code>ch343.ko</code></li>
<li>Remove the default driver (usually contains with "cdc" or "acm") by executing command <code>sudo rmmod $module_name</code></li>
<li>Using command <code>sudo insmod ch343.ko</code> to load the new driver<br  />
 If there are no issues in commands above, users will find a new UART device: <code>/dev/ttyCH343USB0</code></li>
</ol>
</dd></dl>
<h2><a class="anchor" id="sub_guide_setting_pc_network"></a>
5.2 Setting Up the Network</h2>
<p >This section details the procedure for using a static IP. Use the following steps to enable access for the host PC to the EVK board via Ethernet.</p>
<ol type="1">
<li>Change the IP address of the PC network adaptor connected to the EVK board to 10.0.0.1. Note that the default IP address of the EVK board is 10.0.0.2. The following figure provides an example of the IP configuration on a Windows PC. <div class="image">
<img src="../../getting_guide_ip_of_windows.png" alt=""/>
<div class="caption">
Figure 5-1. IP Address of Windows Host PC.</div></div>
</li>
</ol>
<p >The destination is the IP address of the EVK board, 10.0.0.2. </p><div class="fragment"><div class="line">C:\Users\XXX\&gt; ping 10.0.0.2</div>
<div class="line"> </div>
<div class="line">Pinging 10.0.0.2 with 32 bytes of data:</div>
<div class="line">Reply from 10.0.0.2: bytes=32 time=1ms TTL=64</div>
<div class="line">Reply from 10.0.0.2: bytes=32 time&lt;1ms TTL=64</div>
<div class="line">Reply from 10.0.0.2: bytes=32 time&lt;1ms TTL=64</div>
<div class="line">Reply from 10.0.0.2: bytes=32 time&lt;1ms TTL=64</div>
<div class="line"> </div>
<div class="line">Ping statistics <span class="keywordflow">for</span> 10.0.0.2:</div>
<div class="line">    Packets: Sent = 4, Received = 4, Lost = 0 &lt;0% loss&gt;,</div>
<div class="line">Approximate round trip times in milli-seconds:</div>
<div class="line">    Minimum = 0ms, Maximum = 1ms, Average = 0ms</div>
</div><!-- fragment --><h2><a class="anchor" id="sub_guide_setting_pc_console"></a>
5.3 Connecting to a Console Window</h2>
<p >The console window enables users to view the system boot sequence messages and run the demonstration applications from the Linux shell.</p>
<h3><a class="anchor" id="dsub_guide_pc_console_serial"></a>
5.3.1 Serial</h3>
<ol type="1">
<li>Connect a serial cable between the serial port on the EVK and the serial port (for example, COM1) on the host PC.</li>
<li>Open a terminal emulator (such as <b>Minicom</b> on Linux or <b>PuTTY / HyperTerminal</b> on Windows) on the host PC. Ambarella recommends using <b>PuTTY</b> on Windows. <b>PuTTY</b> can be found in the EVK tools.</li>
<li>Configure the terminal emulator to connect to the serial port using the following data:<ul>
<li><b>Speed</b>: 115200 (baud)</li>
<li><b>Data Bits</b>: 8</li>
<li><b>Parity</b>: None</li>
<li><b>Stop Bits</b>: 1</li>
<li><b>Flow Control</b>: None</li>
</ul>
</li>
</ol>
<p >The following provides the steps for connecting to a console window using <b>PuTTY</b> as an example:</p>
<ol type="1">
<li>From the <b>PuTTY</b> Configuration dialogue, choose <b>Category &gt; Connection &gt; Serial</b>. For <b>Serial Line to Connect To</b>, enter the correct port (for example, COM1). Use the settings below for <b>speed</b>, <b>data bits</b>, <b>parity</b>, <b>stop bits</b>, and <b>flow control</b>. <div class="image">
<img src="../../getting_guide_serial_conf_1.png" alt=""/>
<div class="caption">
Figure 5-2. PuTTY Serial Configuration (1).</div></div>
</li>
<li>Using the <b>PuTTY</b> Configuration dialogue, choose <b>Category &gt; Session</b> for the Connection type. Then, enter in the following parameters:<ul>
<li><b>Connection type</b>: Serial</li>
<li><b>Serial line</b>: COM 1</li>
<li><b>Speed</b>: 11520 <div class="image">
<img src="../../getting_guide_serial_conf_2.png" alt=""/>
<div class="caption">
Figure 5-3. PuTTY Serial Configuration (2).</div></div>
</li>
</ul>
</li>
<li><b>Save</b> the current session (for example, Amba Serial) so it can be reused.</li>
<li>Click <b>Open</b> and the following console will appear: <div class="image">
<img src="../../getting_guide_serial_connect.png" alt=""/>
<div class="caption">
Figure 5-4. Connecting to a Serial Console.</div></div>
</li>
<li>Power on the EVK board and wait for the console to read the boot sequence messages. After Linux boots up, log in as root. <div class="image">
<img src="../../getting_guide_serial_boot.png" alt=""/>
<div class="caption">
Figure 5-5. Boot Sequence Messages on the Serial Console.</div></div>
</li>
</ol>
<h3><a class="anchor" id="dsub_guide_pc_console_telent"></a>
5.3.2 Telnet</h3>
<ol type="1">
<li>Connect the EVK and the host PC using an Ethernet cable.</li>
<li>Open a terminal emulator (such as <b>Minicom</b> on Linux or <b>PuTTY / HyperTerminal</b> on Windows) on the host PC. Ambarella recommends using <b>PuTTY</b> on Windows, which can be found in the EVK tools.</li>
<li>Configure the terminal emulator to the Telnet connection type using:<ul>
<li><b>Host Name (or IP address)</b>: 10.0.0.2 (default)</li>
<li><b>Port</b>: 23</li>
</ul>
</li>
</ol>
<p >The following provides steps for connecting to a console window, using <b>PuTTY</b> as an example:</p>
<ol type="1">
<li>From the <b>PuTTY</b> Configuration window, choose <b>Session</b>. In the right panel, select <b>Telnet</b> as the <b>connection type</b>. For <b>Host Name (or IP address)</b>, enter 10.0.0.2. For <b>Port</b>, enter 23. <b>Save</b> the session and click <b>Open</b>.</li>
<li>Log in as root. <div class="image">
<img src="../../getting_guide_telent_conf.png" alt=""/>
<div class="caption">
Figure 5-6. PuTTY Telnet Configuration.</div></div>
</li>
</ol>
<hr  />
<h1><a class="anchor" id="getting_guide_run_demo"></a>
6. Running Demo Applications</h1>
<p >This chapter describes how to perform the following:</p>
<ul>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_build">6.1 Building the Binary for the Board</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_init">6.2 Initializing the Board</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_lua">6.3 Lua Introduction</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_preview">6.4 Previewing HDMI / CVBS</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_record">6.5 Recording a Stream</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_view">6.6 Viewing Streams through VLC</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_cnn">6.7 Run CNN</a></li>
</ul>
<p >Users new to the Linux SDK demo applications are encouraged to carefully follow the instructions in this chapter. Advanced options with unit tests are explained in the Doxygen document within the SDK package. The applications referenced in this EVK getting started guide demonstrate the use of IAV input / output control (IOCTL). The benefits of the unit test include the following:</p><ul>
<li>Minimizes the number of steps required to configure an individual feature, such as the configuration of the stream and starting the encoding process.</li>
<li>Stream a video that does not require application-level streaming protocol (such as real-time streaming protocol (RTSP)), as it is possible to save the video on the host PC.</li>
<li>Advanced options, such as on-screen display (OSD), privacy mask, and region of interest (ROI).</li>
<li>Hands-on experience with the unit test applications and source codes.</li>
</ul>
<h2><a class="anchor" id="sub_guide_demo_build"></a>
6.1 Building the Binary for the Board</h2>
<h3><a class="anchor" id="dsub_guide_demo_full"></a>
6.1.1 Full SDK Package</h3>
<ol type="1">
<li>Decompress the SDK package file on the appropriate Linux building server. <div class="fragment"><div class="line">build $ cp cooper_linux_sdk_********.tar.xz workspace/.</div>
<div class="line">build $ cd workspace/</div>
<div class="line">build $ tar xvfJp cooper_linux_sdk_********.tar.xz</div>
<div class="line">build $ ls -al</div>
</div><!-- fragment --></li>
<li>Verify that <b>Arm® Linux</b> Toolchain is installed before compiling the SDK: <dl class="section user"><dt>For Cooper Amba build</dt><dd><div class="fragment"><div class="line">build $ cd cooper_linux_sdk/ambarella/</div>
<div class="line">build $ <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> build/env/amba-build.env</div>
<div class="ttc" id="avin__init_8c_html_a07a87b2e6ed927503e2f95f119c9fc23"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a></div><div class="ttdeci">int source</div></div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>For Cooper Yocto build</dt><dd><div class="fragment"><div class="line">build $ cd cooper_linux_sdk/ambarella/</div>
<div class="line">build $ <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> build/env/yocto-build.env</div>
</div><!-- fragment --></dd></dl>
</li>
<li>Enter the board directory. 'BOARD_NAME' can be be cv5_timn, cv52_crco, or cv72_gage. <div class="fragment"><div class="line">build $ cd boards/$BOARD_NAME</div>
</div><!-- fragment --></li>
<li>There are several default configuration files in the directory <code>ambarella/boards/$BOARD_NAME/config</code> <dl class="section user"><dt>For Cooper Amba build</dt><dd><div class="fragment"><div class="line">build $ ls -al config/amba/</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>For Cooper Yocto build</dt><dd><div class="fragment"><div class="line">build $ ls -al config/yocto/</div>
</div><!-- fragment --></dd></dl>
</li>
<li><p class="startli">Compile the binary for the specified CV5x / CV7x chips. Different chips will vary in their clock frequencies and performance. To evaluate CV5_Timn, use ipcam_config. </p><div class="fragment"><div class="line">build $ make ipcam_config</div>
</div><!-- fragment --><p class="startli">To evaluate CV52_Cr, use ipcam_lp5_config, and to evaluate CV52_Co, use ipcam_lp4_config. </p><div class="fragment"><div class="line">build $ make ipcam_lp5_config</div>
</div><!-- fragment --><p class="startli">To evaluate CV72_Ga, use ipcam_lp5_config, and to evaluate CV72_Ge, use ipcam_lp4_config. </p><div class="fragment"><div class="line">build $ make ipcam_config</div>
</div><!-- fragment --></li>
<li>Begin compiling the binary for the specified CV5x / CV7x chips. <div class="fragment"><div class="line">build $ make -j 8</div>
</div><!-- fragment --></li>
<li>For more details, refer to the page <a class="el" href="../../d9/d98/ov_code_build.html">SDK Code Building</a>.</li>
</ol>
<h3><a class="anchor" id="dsub_guide_demo_evaluation"></a>
6.1.2 Evaluation Package</h3>
<p >The purpose of evaluation SDK package is to help initial customers to evaluate the standard SDK features with prebuild firmware (FW) on EVK.</p>
<p >As long as customers kick off the formal project with Cooper SDK, they will receive the formal SDK package release.</p>
<p >This evaluation package provides the necessary header files and prebuild libraries for the user's application. Because the package cannot generate a full binary that can run on the EVK board, users must flash the binary in the package to the board, upload the application to the board, and then run it.</p>
<p >What users <b>can</b> do with evaluation package:</p><ul>
<li>Run the existing unit test utility and applications with instructions on EVK board for the standard SDK features.</li>
<li>Convert the open source model or their own neural network (NN) model with CV toolchain and run one EVK board.</li>
<li>Build their own application or unit test from the evaluation package.</li>
</ul>
<p >What users <b>cannot</b> do with evaluation package :</p><ul>
<li>Verify advanced features such as secure boot, eMMC boot, or others.</li>
<li>Upgrade the software modules with new versions of bug fixes.</li>
<li>Build the entire FW with the updated driver, Linux kernel, and bootloader.</li>
</ul>
<p >Here are the steps for users to build applications:</p>
<ol type="1">
<li>Decompress the SDK package file on the Linux-based building server. Ensure that the folder name is not "CV5x" or "CV7x". Using the same build name as CV5x / CV7x creates a conflict with the build script. <div class="fragment"><div class="line">build $ cp cooper_linux_evaluation_sdk_********.tar.xz workspace/</div>
<div class="line">build $ cd workspace/</div>
<div class="line">build $ tar xf cooper_linux_evaluation_sdk_********.tar.xz</div>
<div class="line">build $ ls -al</div>
</div><!-- fragment --></li>
<li>Verify that the <b>Arm® Linux</b> toolchain is installed before compiling the SDK: <dl class="section user"><dt>For Cooper Amba build</dt><dd><div class="fragment"><div class="line">build $ cd cooper_linux_sdk/ambarella/</div>
<div class="line">build $ <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> build/env/amba-build.env</div>
</div><!-- fragment --></dd></dl>
</li>
<li>Change the configuration options and rebuild the application, following the same steps as in CV5_Timn. <dl class="section user"><dt>For Cooper Amba build</dt><dd><div class="fragment"><div class="line">build $ cd boards/cv5_timn</div>
<div class="line">build $ make ipcam_config</div>
<div class="line">build $ make menuconfig</div>
<div class="line">    drv_modules  ---&gt;</div>
<div class="line">         <span class="keyword">private</span>  ---&gt;</div>
<div class="line">          -*- ambvideo-header (drv_modules/<span class="keyword">private</span>/video/dsp_v6)  ---&gt;</div>
<div class="line">              (4)   Max VIN Channel Number</div>
<div class="line">build $ make &lt;app_name&gt;</div>
</div><!-- fragment --></dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>User is required to configure the max video input (VIN) channel number as it is configured in the prebuild binary for a four-sensor VIN.</li>
<li>For more details, refer to the page <a class="el" href="../../d9/d98/ov_code_build.html">SDK Code Building</a>.</li>
</ul>
</dd></dl>
</li>
</ol>
<h2><a class="anchor" id="sub_guide_demo_init"></a>
6.2 Initializing the Board</h2>
<ol type="1">
<li>Open a console window connected to the evaluation board and log in as root; no password is required. Refer to Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_setting_pc_console">5.3 Connecting to a Console Window</a> for how to connect to a console window.</li>
<li><p class="startli">Initialize the board. Load the <code>script init.sh</code> into the essential drivers and microcode.<br  />
</p>
<p class="startli">The command for imx274_mipi is as follows: </p><div class="fragment"><div class="line">board # init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3  <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board # init.sh --na; modprobe imx274_mipi vinc_id=8)      <span class="comment">// For CV72</span></div>
</div><!-- fragment --></li>
<li>The following messages will print if the initialization is successful. Confirm that the sensor name is in the message. <div class="fragment"><div class="line">/bin:/sbin:/usr/bin:/usr/sbin:/usr/bin/X11:/usr/local/bin:/usr/local/sbin</div>
<div class="line">Init without VIN drivers...</div>
<div class="line">Default init without lens driver</div>
<div class="line">Use <span class="keywordflow">default</span> settings</div>
<div class="line">map_size = 0xa00000, nr_item = 9</div>
<div class="line">addr_offset = 0x00000000, filename = orccode.bin</div>
<div class="line">addr_offset = 0x00200000, filename = orcvin.bin</div>
<div class="line">addr_offset = 0x00300000, filename = orcidsp0.bin</div>
<div class="line">addr_offset = 0x00500000, filename = orcidsp1.bin</div>
<div class="line">addr_offset = 0x00700000, filename = orcme0.bin</div>
<div class="line">addr_offset = 0x00740000, filename = orcme1.bin</div>
<div class="line">addr_offset = 0x00780000, filename = orcmdxf0.bin</div>
<div class="line">addr_offset = 0x007c0000, filename = orcmdxf1.bin</div>
<div class="line">addr_offset = 0x00800000, filename = default_binary.bin</div>
<div class="line">mmap returns 0x7fbd9f3000</div>
<div class="line">loading /lib/firmware/orccode.bin...addr = 0x7fbd9f3000, size = 0x101a38</div>
<div class="line">loading /lib/firmware/orcvin.bin...addr = 0x7fbdbf3000, size = 0x9b684</div>
<div class="line">loading /lib/firmware/orcidsp0.bin...addr = 0x7fbdcf3000, size = 0x13f094</div>
<div class="line">loading /lib/firmware/orcidsp1.bin...addr = 0x7fbdef3000, size = 0x13f094</div>
<div class="line">loading /lib/firmware/orcme0.bin...addr = 0x7fbe0f3000, size = 0x9618</div>
<div class="line">loading /lib/firmware/orcme1.bin...addr = 0x7fbe133000, size = 0x9618</div>
<div class="line">loading /lib/firmware/orcmdxf0.bin...addr = 0x7fbe173000, size = 0x1690c</div>
<div class="line">loading /lib/firmware/orcmdxf1.bin...addr = 0x7fbe1b3000, size = 0x16878</div>
<div class="line">loading /lib/firmware/default_binary.bin...addr = 0x7fbe1f3000, size = 0x79e60</div>
<div class="line">===============================================</div>
<div class="line">ucode (CV5) version = 2021/8/6 (hash : 0x8504240a)</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="sub_guide_demo_lua"></a>
6.3 Lua Introduction</h2>
<p >This section provides examples of how CV5x or CV7x uses a Lua script to configure the system. Locate <code>cv5_vin0_1080p_linear.lua</code> for the 720p example in <code>ambarella/unit_test/private/iav_test/dsp_v6/scripts/cv5</code>.</p>
<ol type="1">
<li>Configure the VIN. The following example uses VIN0 as a linear 1080p30. <div class="fragment"><div class="line">vsrc_0 = {</div>
<div class="line">    vsrc_id = 0,</div>
<div class="line">    mode = <span class="stringliteral">&quot;1080p&quot;</span>,</div>
<div class="line">    <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> = <span class="stringliteral">&quot;linear&quot;</span>, -- options: <span class="stringliteral">&quot;linear&quot;</span>, <span class="stringliteral">&quot;2x&quot;</span> or <span class="stringliteral">&quot;3x&quot;</span></div>
<div class="line">    fps = 30,</div>
<div class="line">}</div>
<div class="ttc" id="avin__init_8c_html_a9586a0cc85ebac1f283fc9f2d94c82e2"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a></div><div class="ttdeci">int hdr_mode</div></div>
</div><!-- fragment --></li>
<li>Configure the channel buffer. The example below uses VIN0 for the input source of channel0, which includes three buffers. The main buffer is 1080p, the second buffer is 480p, and the third buffer is 720p. The pyramid buffer is used for the vector processor (VP) input. <div class="fragment"><div class="line">chan_0 = {</div>
<div class="line">    <span class="keywordtype">id</span> = 0,</div>
<div class="line">    vsrc = vsrc_0,</div>
<div class="line">    ... ...</div>
<div class="line">    <a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> = {</div>
<div class="line">        max_output = {1920, 0},</div>
<div class="line">        input      = {0, 0, 1920, 1080},</div>
<div class="line">        output     = {0, 0, 1920, 1080},</div>
<div class="line">    },</div>
<div class="line">    second = {</div>
<div class="line">        max_output = {720, 0},</div>
<div class="line">        input      = {0, 0, 1920, 1080},</div>
<div class="line">        output     = {0, 0, 720, 480},</div>
<div class="line">    },</div>
<div class="line">    third = {</div>
<div class="line">        max_output = {1280, 0},</div>
<div class="line">        input      = {0, 0, 1920, 1080},</div>
<div class="line">        output     = {0, 0, 1280, 720},</div>
<div class="line">    },</div>
<div class="line">    ... ...</div>
<div class="line">}</div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
</div><!-- fragment --></li>
<li>Configure the stream. The following example uses three streams: two streams as 1080p and one stream as 480p. This is a basic stream setting that does not specify the canvas buffer or encode solution. <div class="fragment"><div class="line">stream_0 = {</div>
<div class="line">    <span class="keywordtype">id</span> = 0,</div>
<div class="line">    max_size = {1920, 1080},</div>
<div class="line">    max_M = 1,</div>
<div class="line">    max_N = 30,</div>
<div class="line">    fast_seek_enable = 0,</div>
<div class="line">    two_ref_enable = 0,</div>
<div class="line">    max_svct_layers_minus_1 = 0,</div>
<div class="line">    max_num_minus_1_ltrs = 0,</div>
<div class="line">    codec_enable = 0, -- 0: H264/H265/MJPEG; 1: H265/MJPEG; 2: H264/MJPEG; 3: MJPEG</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">stream_1 = {</div>
<div class="line">    <span class="keywordtype">id</span> = 1,</div>
<div class="line">    max_size = {1920, 1080},</div>
<div class="line">    max_M = 1,</div>
<div class="line">    max_N = 30,</div>
<div class="line">    fast_seek_enable = 0,</div>
<div class="line">    two_ref_enable = 0,</div>
<div class="line">    max_svct_layers_minus_1 = 0,</div>
<div class="line">    max_num_minus_1_ltrs = 0,</div>
<div class="line">    codec_enable = 0, -- 0: H264/H265/MJPEG; 1: H265/MJPEG; 2: H264/MJPEG; 3: MJPEG</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">stream_2 = {</div>
<div class="line">    <span class="keywordtype">id</span> = 2,</div>
<div class="line">    max_size = {720, 480},</div>
<div class="line">    max_M = 1,</div>
<div class="line">    max_N = 30,</div>
<div class="line">    fast_seek_enable = 0,</div>
<div class="line">    two_ref_enable = 0,</div>
<div class="line">    max_svct_layers_minus_1 = 0,</div>
<div class="line">    max_num_minus_1_ltrs = 0,</div>
<div class="line">    codec_enable = 0, -- 0: H264/H265/MJPEG; 1: H265/MJPEG; 2: H264/MJPEG; 3: MJPEG</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Configure the canvas buffer. The following example shows three configured buffers: two buffers that are used for encoding, and one buffer used for preview. This setting binds the canvas buffer to two different places, the channel buffer and the stream or preview buffer. <div class="fragment"><div class="line">_resource_config_ = {</div>
<div class="line">    version = 1,</div>
<div class="line">    channels = {</div>
<div class="line">        chan_0,</div>
<div class="line">        chan_1,</div>
<div class="line">    },</div>
<div class="line">    canvas = {</div>
<div class="line">        {</div>
<div class="line">            type = <span class="stringliteral">&quot;encode&quot;</span>,</div>
<div class="line">            size = {1920, 1080},</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.main&quot;</span>,},</div>
<div class="line">            extra_dram_buf = 0,</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            type = <span class="stringliteral">&quot;encode&quot;</span>,</div>
<div class="line">            size = {720, 480},</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.second&quot;</span>,},</div>
<div class="line">            extra_dram_buf = 0,</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            type = <span class="stringliteral">&quot;prev&quot;</span>,</div>
<div class="line">            size = {1280, 720},</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.third&quot;</span>, },</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../video/d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a> = 2,</div>
<div class="line">            extra_dram_buf = 0,</div>
<div class="line">        },</div>
<div class="line">    },</div>
<div class="line">    streams = {</div>
<div class="line">        stream_0,</div>
<div class="line">        stream_1,</div>
<div class="line">        stream_2,</div>
<div class="line">    },</div>
<div class="line">}</div>
<div class="ttc" id="avout__init_8c_html_a049a525f0e8bc8bee106f89f18f896ce"><div class="ttname"><a href="../../../video/d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a></div><div class="ttdeci">int vout_id</div></div>
</div><!-- fragment --></li>
</ol>
<p >The setting shown above is for the 720p preview. To use the 1080p preview, modify the script as shown in the example below: </p><div class="fragment"><div class="line">chan_0 = {</div>
<div class="line">    <span class="keywordtype">id</span> = 0,</div>
<div class="line">    vsrc = vsrc_0,</div>
<div class="line">    ... ...</div>
<div class="line">    third = {</div>
<div class="line">        max_output = {1080, 0},</div>
<div class="line">        input      = {0, 0, 1920, 1080},</div>
<div class="line">        output     = {0, 0, 1920, 1080},</div>
<div class="line">    },</div>
<div class="line">    ... ...</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">_resource_config_ = {</div>
<div class="line">    version = 1,</div>
<div class="line">    channels = {</div>
<div class="line">        chan_0,</div>
<div class="line">        chan_1,</div>
<div class="line">    },</div>
<div class="line">    canvas = {</div>
<div class="line">        ... ...</div>
<div class="line">        {</div>
<div class="line">            type = <span class="stringliteral">&quot;prev&quot;</span>,</div>
<div class="line">            size = {1920, 1080},</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.third&quot;</span>, },</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../video/d4/de8/vout__init_8c.html#a049a525f0e8bc8bee106f89f18f896ce">vout_id</a> = 2,</div>
<div class="line">            extra_dram_buf = 0,</div>
<div class="line">        },</div>
<div class="line">    },</div>
<div class="line">    ... ...</div>
<div class="line">}</div>
</div><!-- fragment --><p >The script can be adapted to fit additional resolutions in the same manner. For more information about this script, refer to Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_record">6.5 Recording a Stream</a>.</p>
<h2><a class="anchor" id="sub_guide_demo_preview"></a>
6.4 Previewing HDMI / CVBS</h2>
<p >In order to obtain a video preview, the board must be initialized as described in Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_build">6.1 Building the Binary for the Board</a></p>
<p >Additionally, users must prepare the Lua script. Refer to Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_lua">6.3 Lua Introduction</a>.</p>
<p >For the preview, ensure that the high-definition multimedia interface (HDMI®) cable is connected to the board.</p>
<p >The serial console sends the message "Video output (VOUT) notice: HDMI Device Connected!". The demo below is only applicable for running image digital signal processing (IDSP).</p>
<p >HDMI preview 720p: </p><div class="fragment"><div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua</div>
</div><!-- fragment --><p >HDMI preview 1080p: </p><div class="fragment"><div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><p >HDMI preview 4K: </p><div class="fragment"><div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear.lua  --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_4k.lua</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>If the user possesses a different version of the Lua script from those shown above, the script must be modified to accommodate a different solution.</dd></dl>
<h2><a class="anchor" id="sub_guide_demo_record"></a>
6.5 Recording a Stream</h2>
<p >The following steps demonstrate how to record a stream in H.264 / H.265 file formats:</p>
<ol type="1">
<li>Initialize the board. <div class="fragment"><div class="line">board # init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3  <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board # init.sh --na; modprobe imx274_mipi vinc_id=8)      <span class="comment">// For CV72</span></div>
</div><!-- fragment --><ul>
<li>See Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_build">6.1 Building the Binary for the Board</a> for detailed steps on how to initialize other sensors.</li>
</ul>
</li>
<li>Enter preview to start the image process. <div class="fragment"><div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua</div>
</div><!-- fragment --></li>
<li>See section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_lua">6.3 Lua Introduction</a> for more details on how to get previews of other resolutions.</li>
<li>Start the streaming application and specify the record directory on the Cooper platform. <div class="fragment"><div class="line">board # test_stream -A -f /tmp/</div>
</div><!-- fragment --></li>
<li>Start the encoding stream(s) in H.264 format. <div class="fragment"><div class="line">board # test_encode -A -h 1080p -e</div>
</div><!-- fragment --></li>
</ol>
<dl class="section note"><dt>Note</dt><dd>The default value for the canvas buffer is 0; therefore, it is important to pick a specific canvas buffer. Additionally, if two streams use the same buffer, add <code>extra_dram_buf</code>.</dd></dl>
<ol type="1">
<li><p class="startli">Switch to the test_stream console. The message shown below indicates that the stream(s) is starting to encode and record the stream.</p>
<p class="startli">Successfully begin the encoding for stream 0x1. </p><div class="fragment"><div class="line">board #</div>
<div class="line"><span class="keyword">new</span> session file <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a> [/tmp/_A_1216133253_f9656517.h264], fd [6]</div>
<div class="line">stream A:       30 frames, 31.23 fps,             972794        bytes,  7912 kbps, enc_pipe_time [ 3969: 4542]</div>
<div class="line">stream A:       60 frames, 30.00 fps,            2058917        bytes,  8485 kbps, enc_pipe_time [ 3969: 4617]</div>
<div class="line">stream A:       90 frames, 30.00 fps,            3108975        bytes,  8204 kbps, enc_pipe_time [ 3969: 4617]</div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div></div>
</div><!-- fragment --></li>
<li><p class="startli">Stop encoding. </p><div class="fragment"><div class="line">board # test_encode -A -s</div>
</div><!-- fragment --><p class="startli">Or </p><div class="fragment"><div class="line">board # test_encode -A -s -B -s</div>
</div><!-- fragment --></li>
<li>Once the stream has been terminated, users can check the record file and send the file to the PC through file transfer protocol (FTP). The video file can be played via VideoLAN Client (VLC). Ensure that the VLC configuration is as per <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_demo_view">6.6 Viewing Streams through VLC</a>.</li>
<li>To restart encoding for a new stream, repeat steps 4 through 7.</li>
</ol>
<h2><a class="anchor" id="sub_guide_demo_view"></a>
6.6 Viewing Streams through VLC</h2>
<p >When the RTSP server is running, view livestreams using the VLC media player as an RTSP client.</p>
<p >The following steps describe viewing streams through VLC:</p>
<ol type="1">
<li>Initialize, run the RTSP server, and start encoding. <div class="fragment"><div class="line">board # init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3  <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board # init.sh --na; modprobe imx274_mipi vinc_id=8)      <span class="comment">// For CV72</span></div>
<div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua        <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board # rtsp_server &amp;</div>
<div class="line">board # test_encode -A -h1080p -e</div>
</div><!-- fragment --></li>
<li>Launch VLC. Confirm that the VLC is configured as described in Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_setting_pc_network">5.2 Setting Up the Network</a>.</li>
<li>Select Media &gt; Open Network Stream. <div class="image">
<img src="../../getting_guide_network_vlc.png" alt=""/>
<div class="caption">
Figure 6-1. Open Network Stream in VLC.</div></div>
</li>
<li>Input the RTSP URL that coordinates with the desired stream:<ul>
<li>rtsp://10.0.0.2/stream1 identifies the first stream.</li>
<li>rtsp://10.0.0.2/stream2 identifies the second stream.</li>
<li>rtsp://10.0.0.2/stream3 identifies the third stream.</li>
<li>rtsp://10.0.0.2/stream4 identifies the fourth stream.</li>
</ul>
</li>
<li>Select "Show more options". Enter a smaller value for caching (such as 200 ms). Click "Play". <div class="image">
<img src="../../getting_guide_rtsl_vlc.png" alt=""/>
<div class="caption">
Figure 6-2. RTSP URL of the First Stream in VLC.</div></div>
</li>
<li>The livestream plays in VLC. <div class="image">
<img src="../../getting_guide_view_vlc.png" alt=""/>
<div class="caption">
Figure 6-3. View the First Stream in VLC.</div></div>
</li>
</ol>
<h2><a class="anchor" id="sub_guide_demo_cnn"></a>
6.7 Run CNN</h2>
<p >The computer vision (CV) demonstrations below are based on public network files with public data sets, except <b>OpenNet</b> and <b>BiSeNet</b>, which are trained with Ambarella data.</p>
<ul>
<li>For public network use, follow the original license statement for the model files. For the detailed URL of these model files, refer to the CNNGen samples package.</li>
</ul>
<p >Contact the Ambarella support team for assistance with Ambarella models.</p>
<h3><a class="anchor" id="dsub_guide_demo_cnn_full"></a>
6.7.1 Full SDK Package</h3>
<p >Compile the binary with "cv5x_ipcam_config" for CV5x, and "cv7x_ipcam_config" for CV7x. The default configuration file is located in <code>$SDK_ROOT/ambarella/$BOARD_NAME/config</code>.</p>
<p >The demonstration network models are not included in the SDK package. The following text provides two methods to get the network deployment binaries:</p>
<ul>
<li>Use the CNNGen samples package to generate the network deployment binaries. For more details, refer to <code>fs_cnngen_samples_pacakge.html</code> in the Doxygen document, which can be found in the CNNGen samples package. Users can also use <b>CNNGUI</b> to easily set up these demos, which is described in this section.</li>
<li>Contact the Ambarella support team to share the pre-converted network binary.</li>
</ul>
<p ><b>Resnet50</b> with sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 1080p</div>
<div class="line">board # osd_server_imagenet -p 27182 -n imagenet_1000.txt &amp;</div>
<div class="line">board # test_nnctrl_live -p 27182 -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> resnet50_cavalry_fix8_full.bin --in data --out prob -s 0 -i 0 -t 1</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. Select the option below to enable it.</p><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> app  ---&gt;</div>
<div class="line">   ai_cam  ---&gt;</div>
<div class="line">     [*] cvflow-test (app/ai_cam/cvflow)  ---&gt;</div>
<div class="line">       [*]   Build imagenet unit tests</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">   meta-ambaapp ---&gt;</div>
<div class="line">      recipes-test ---&gt;</div>
<div class="line">         [*] cvflow-test (meta-ambaapp/recipes-test/cvflow-test)  ---&gt;</div>
<div class="line">               [*]   Build imagenet unit tests</div>
</div><!-- fragment --></li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make resnet50</code> to generate <code>resnet50_cavalry_fix8_full.bin</code> in the CNNGen samples package.</li>
<li>The <code>imagenet_1000.txt</code> is located in the folder path <code>ambarella/app/ai_cam/cvflow/imagenet</code>.</li>
</ul>
</dd></dl>
<p><b>YOLO-v3</b> with sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 720p</div>
<div class="line">board # osd_server_yolov3 -p 27182 -f /usr/share/ambarella/eazyai/lua/yolov3_sp50_full.lua &amp;</div>
<div class="line">board # test_nnctrl_live -p 27182 -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> yolo_v3_cavalry_fix8_sp50.bin -s 0 -i 1 --in data --out conv59 --out conv67 --out conv75 -t 0 -r 0.00390625</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. Select the option below to enable it.</p><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> app  ---&gt;</div>
<div class="line">   ai_cam  ---&gt;</div>
<div class="line">     [*] cvflow-test (app/ai_cam/cvflow)  ---&gt;</div>
<div class="line">       [*]   Build yolov3 unit tests</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">   meta-ambaapp ---&gt;</div>
<div class="line">      recipes-test ---&gt;</div>
<div class="line">         [*] cvflow-test (meta-ambaapp/recipes-test/cvflow-test)  ---&gt;</div>
<div class="line">                [*]   Build yolov3 unit tests</div>
</div><!-- fragment --></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Use <code>make yolo_v3_sp50_amb_quant</code> to generate <code>yolo_v3_sp50_amb_quant_cavalry.bin</code> in the CNNGen samples package.</dd></dl>
<p><b>YOLO-v3</b> with YUV input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --vin lt6911 --hdmi 720p</div>
<div class="line">board # osd_server_yolov3 -p 27182 -f /usr/share/ambarella/eazyai/lua/yolov3_sp50_full.lua &amp;</div>
<div class="line">board # test_nnctrl_live -p 27182 -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> yolo_v3_cavalry_fix8_sp50.bin -s 0 -i 1 --in data --out conv59 --out conv67 --out conv75 -t 0 -r 0.00390625</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>If LT6911 is unstable, delete the LT6911 default microcontroller unit (MCU) code using the command <code>test_vin -w 0xffff</code>.</li>
<li>If the YUV input is selected, set the mode to "0" for the <code>vsrc_id</code> option in the Lua script.</li>
</ul>
</dd></dl>
<p><b>FD (MTCNN)</b> with the sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 1080p</div>
<div class="line">board # test_mtcnn -m 0 -i /sdcard/mtcnn/in -o /sdcard/mtcnn/out -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -a 0</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. To enable it, select the option below.</p><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> packages  ---&gt;</div>
<div class="line">  eazyai ---&gt;</div>
<div class="line">    apps ---&gt;</div>
<div class="line">       eazyai-apps-test-face (packages/eazyai/apps/face) ---&gt;</div>
<div class="line">        [*]   Build MTCNN EazyAI apps</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  meta-ambaapp ---&gt;</div>
<div class="line">      recipes-test ---&gt;</div>
<div class="line">          [*] eazyai-test@<span class="keyword">virtual</span> (meta-ambaapp/recipes-test/eazyai-test) ---&gt;</div>
<div class="line">              [*] eazyai-apps-test@<span class="keyword">virtual</span> (meta-ambaapp/recipes-test/eazyai-test/eazyai-apps-test) ---&gt;</div>
<div class="line">                  [*] eazyai-apps-test-face (meta-ambaapp/recipes-test/eazyai-test/eazyai-apps-test) ---&gt;</div>
<div class="line">                       [*]   Build MTCNN EazyAI apps</div>
</div><!-- fragment --></li>
</ul>
<p >Place the files on the SD card with the following structure: </p><div class="fragment"><div class="line">/sdcard/mtcnn</div>
<div class="line">├───in</div>
<div class="line">│       faces01.jpg</div>
<div class="line">│       faces02.jpg</div>
<div class="line">│       pnet_216x384_cavalry.bin</div>
<div class="line">│       pnet_154x273_cavalry.bin</div>
<div class="line">│       pnet_109x194_cavalry.bin</div>
<div class="line">│       pnet_77x137_cavalry.bin</div>
<div class="line">│       pnet_55x98_cavalry.bin</div>
<div class="line">│       pnet_39x69_cavalry.bin</div>
<div class="line">│       pnet_28x49_cavalry.bin</div>
<div class="line">│       pnet_20x35_cavalry.bin</div>
<div class="line">│       pnet_14x25_cavalry.bin</div>
<div class="line">│       rnet_cavalry.bin</div>
<div class="line">│       onet_cavalry.bin</div>
<div class="line">│</div>
<div class="line">└───out</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make pnet</code> to generate ten PNet binaries with the input resolution modification for <code>prototxt</code> and <code>make menuconfig</code> in the CNNGen samples package.</li>
<li>Then, use <code>make onet</code> and <code>make rnet</code> for onet and rnet. For more details, refer to <em>fs_cnngen_caffe_demos.html::sec_caffe_mtcnn</em> in the Doxygen document in the CNNGen samples package.</li>
<li>Use the CNNGen samples package to generate ten PNet models with different input resolutions, one RNet model, and one ONet model. The PNet models' name must be <code>pnet*.bin</code>, the RNet model name must be <code>rnet*.bin</code>, and the ONet model name must be <code>onet*.bin</code> to be read by the <code>test_mtcnn</code> demonstration.</li>
<li>Place all Cavalry bin models on the SD card, such as under <code>/sdcard/mtcnn/in</code>.</li>
</ul>
</dd></dl>
<p><b>Face detection and face recognition (FDFR) (RetinaFace and MobileFaceNet)</b> with sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 1080p</div>
<div class="line">board # test_fdfr_v2 -m 0 -i /sdcard/fdfr/in -o /sdcard/fdfr/out -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -a 0 -f 0.8,0.7</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. To enable the demonstration, select the option below.</p><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> packages  ---&gt;</div>
<div class="line">  eazyai ---&gt;</div>
<div class="line">    apps ---&gt;</div>
<div class="line">       eazyai-apps-test-face (packages/eazyai/apps/face) ---&gt;</div>
<div class="line">        [*]  Build FDFR V2 EazyAI apps</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  meta-ambaapp ---&gt;</div>
<div class="line">      recipes-test ---&gt;</div>
<div class="line">          [*] eazyai-test@<span class="keyword">virtual</span> (meta-ambaapp/recipes-test/eazyai-test) ---&gt;</div>
<div class="line">              [*] eazyai-apps-test@<span class="keyword">virtual</span> (meta-ambaapp/recipes-test/eazyai-test/eazyai-apps-test) ---&gt;</div>
<div class="line">                  [*] eazyai-apps-test-face (meta-ambaapp/recipes-test/eazyai-test/eazyai-apps-test) ---&gt;</div>
<div class="line">                        [*]  Build FDFR V2 EazyAI apps</div>
</div><!-- fragment --></li>
</ul>
<p >Place the files on the SD card with the following structure: </p><div class="fragment"><div class="line">/sdcard/fdfr</div>
<div class="line">├───in</div>
<div class="line">│       faces01.jpg</div>
<div class="line">│       faces02.jpg</div>
<div class="line">│       onnx_retinaface_cavalry.bin</div>
<div class="line">│       mobilefacenets_cavalry.bin</div>
<div class="line">│</div>
<div class="line">└───out</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make onnx_retinaface</code> to generate the Cavalry binary in the CNNGen samples package and rename it to <code>onnx_retinaface_cavalry.bin</code>. Then, place it in <code>/sdcard/fdfr/in</code>.</li>
<li>Use <code>make mobilefacenets</code> to generate the Cavalry binary in the CNNGen samples package and rename it to <code>mobilefacenets_cavalry.bin</code>. Then, place it in <code>/sdcard/fdfr/in</code>.</li>
</ul>
</dd></dl>
<p><b>BiSeNet</b> with sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 720p --fb_res 320x180</div>
<div class="line">board # test_eazyai -m 0 -d 1 --model_path bisenet_cavalry.bin -n bisenet --lua_file /usr/share/ambarella/eazyai/lua/bisenet.lua -c 2 --roi 0,0,512,1280</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. Select the option below to enable it.</p><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> packages  ---&gt;</div>
<div class="line">  eazyai ---&gt;</div>
<div class="line">    -*- libeazyai-arm-postprocess (packages/eazyai/unit_test)  ---&gt;</div>
<div class="line">       [*]   Build Ambarella custom postprocess library with bisenet</div>
<div class="line">    [*] eazyai-unit-test (packages/eazyai/unit_test)</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">   meta-ambaapp ---&gt;</div>
<div class="line">       recipes-test ---&gt;</div>
<div class="line">          [*] eazyai-test@<span class="keyword">virtual</span> (meta-ambaapp/recipes-test/eazyai-test) ---&gt;</div>
<div class="line">               [*]   eazyai-unit-test (meta-ambaapp/recipes-test/eazyai-test/eazyai-unit-test)</div>
<div class="line">   meta-ambalib ---&gt;</div>
<div class="line">       recipes-eazyai ---&gt;</div>
<div class="line">          -*- libeazyai-arm-postprocess (meta-ambalib/recipes-eazyai/libeazyai)  ---&gt;</div>
<div class="line">                [*]   Build Ambarella custom postprocess library with bisenet</div>
</div><!-- fragment --></li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make bisenet</code> to generate <code>bisenet_cavalry.bin</code> in the CNNGen samples package.</li>
<li>Set the input buffer resolution to 1280x720 and the frame buffer to 320x180. The real network input is 1280x512, and the network output is 320x128. The bottom has no detection as it is the headstock. On the top of the screen, it will detect "freespace", "lanemark", and "curb", which are used for auto-driving.</li>
<li>Ambarella recommends using HDMI VIN as a test case.</li>
</ul>
</dd></dl>
<p><b>OpenNet</b> with sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 720p</div>
<div class="line">board # test_eazyai -m 0 -d 0 --model_path opennet.bin -n opennet --lua_file /usr/share/ambarella/eazyai/lua/opennet.lua --extra_input arm_priorbox.bin</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. Select the option below to enable it. </p><dl class="section user"><dt>For Cooper amba build</dt><dd><div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> packages  ---&gt;</div>
<div class="line">  eazyai ---&gt;</div>
<div class="line">    -*- libeazyai-arm-postprocess (packages/eazyai/unit_test)  ---&gt;</div>
<div class="line">       [*]   Build Ambarella custom postprocess library with opennet</div>
<div class="line">    [*] eazyai-unit-test (packages/eazyai/unit_test)</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>For Cooper Yocto build</dt><dd><div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  meta-ambalib ---&gt;</div>
<div class="line">     recipes-eazyai ---&gt;</div>
<div class="line">        -*- libeazyai-arm-postprocess (meta-ambalib/recipes-eazyai/libeazyai) ---&gt;</div>
<div class="line">              [*]   Build Ambarella custom postprocess library with opennet</div>
<div class="line">   meta-ambaapp ---&gt;</div>
<div class="line">       recipes-test ---&gt;</div>
<div class="line">          [*] eazyai-test@<span class="keyword">virtual</span> (meta-ambaapp/recipes-test/eazyai-test) ---&gt;</div>
<div class="line">               [*]   eazyai-unit-test (meta-ambaapp/recipes-test/eazyai-test/eazyai-unit-test)</div>
</div><!-- fragment --></dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make opennet</code> to generate <code>opennet_cavalry.bin</code> in the CNNGen samples package.</li>
<li>The <code>arm_priorbox.bin</code> is located in the path <code>cnngen_samples\caffe\demo_networks\opennet\models</code>, and demonstrated in the following example.</li>
<li>The code is similar to BiSeNet. Do not modify any of the commands.</li>
</ul>
</dd></dl>
<h3><a class="anchor" id="dsub_guide_demo_cnn_eva"></a>
6.7.2 Evaluation Package</h3>
<p >Follow the steps below to run the demonstration using the evaluation package.</p>
<ol type="1">
<li>Flash the binary released together with the evaluation package.<ul>
<li><code>cv5_ipcam_config_evaluation_sdk_*.bin</code>: For the CV5 EVK board that is compiled into a maximum of four channels</li>
<li><code>cv52_ipcam_lp4/lp5_config_evaluation_sdk_*.bin</code>: For the CV52 EVK board that is compiled into a maximum of four channels</li>
<li><code>cv72_ipcam_lp4/lp5_config_evaluation_sdk_*.bin</code>: For the CV72 EVK board that is compiled into a maximum of four channels</li>
</ul>
</li>
<li>Run the applications using the EVK board.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>The demonstration network models are not included in the SDK package. The following text provides two methods for the user to get the network deployment binary.<ul>
<li>Use the CNNGen samples package to generate. For more details, refer to <em>fs_cnngen_samples_pacakge.html</em> in the Doxygen document in the CNNGen samples package. Users also can use <b>CNNGUI</b> to easily set up these demos, which are mentioned in this section.</li>
<li>Contact the Ambarella support team to share the pre-converted network binary.</li>
</ul>
</dd></dl>
<p><b>Resnet50</b> with sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 1080p</div>
<div class="line">board # osd_server_imagenet -p 27182 -n imagenet_1000.txt &amp;</div>
<div class="line">board # test_nnctrl_live -p 27182 -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> resnet50_cavalry_fix8_full.bin --in data --out prob -s 0 -i 0 -t 1</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. Select the option below to enable it.</p><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> app  ---&gt;</div>
<div class="line">   ai_cam  ---&gt;</div>
<div class="line">     [*] cvflow-test (app/ai_cam/cvflow)  ---&gt;</div>
<div class="line">       [*]   Build imagenet unit tests</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make resnet50</code> to generate <code>resnet50_cavalry_fix8_full.bin</code> in the CNNGen samples package.</li>
<li>The <code>imagenet_1000.txt</code> is located in the folder path <code>ambarella/app/ai_cam/cvflow/imagenet</code>.</li>
</ul>
</dd></dl>
<b>YOLO-v3</b> with sensor input: <div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 720p</div>
<div class="line">board # osd_server_yolov3 -p 27182 -f /usr/share/ambarella/eazyai/lua/yolov3_sp50_full.lua &amp;</div>
<div class="line">board # test_nnctrl_live -p 27182 -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> yolo_v3_cavalry_fix8_sp50.bin -s 0 -i 1 --in data --out conv59 --out conv67 --out conv75 -t 0 -r 0.00390625</div>
</div><!-- fragment --></li>
</ul>
<p >This demonstration is not selected in the default configuration. Select the option below to enable it.</p><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> app  ---&gt;</div>
<div class="line">   ai_cam  ---&gt;</div>
<div class="line">     [*] cvflow-test (app/ai_cam/cvflow)  ---&gt;</div>
<div class="line">       [*]   Build yolov3 unit tests</div>
</div><!-- fragment --></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Use <code>make yolo_v3_sp50_amb_quant</code> to generate <code>yolo_v3_sp50_amb_quant_cavalry.bin</code> in the CNNGen samples package.</dd></dl>
<p><b>YOLO-v3</b> with YUV input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --vin lt6911 --hdmi 720p</div>
<div class="line">board # osd_server_yolov3 -p 27182 -f /usr/share/ambarella/eazyai/lua/yolov3_sp50_full.lua &amp;</div>
<div class="line">board # test_nnctrl_live -p 27182 -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> yolo_v3_cavalry_fix8_sp50.bin -s 0 -i 1 --in data --out conv59 --out conv67 --out conv75  -t 0 -r 0.00390625</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>If LT6911 is unstable, delete the LT6911 default MCU code using the command <code>test_vin -w 0xffff</code>.</li>
<li>If YUV input is selected, set the mode to "0" for the <code>vsrc_id</code> option in the Lua script.</li>
</ul>
</dd></dl>
<p><b>FD (MTCNN)</b> with the sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 1080p</div>
<div class="line">board # test_mtcnn -m 0 -i /sdcard/mtcnn/in -o /sdcard/mtcnn/out -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -a 0</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. To enable it, select the option below.</p><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> packages  ---&gt;</div>
<div class="line">  eazyai ---&gt;</div>
<div class="line">    apps ---&gt;</div>
<div class="line">       eazyai-apps-test-face (packages/eazyai/apps/face) ---&gt;</div>
<div class="line">        [*]   Build MTCNN EazyAI apps</div>
</div><!-- fragment --></li>
</ul>
<p >Place the files on the SD card with the following structure: </p><div class="fragment"><div class="line">/sdcard/mtcnn</div>
<div class="line">├───in</div>
<div class="line">│       faces01.jpg</div>
<div class="line">│       faces02.jpg</div>
<div class="line">│       pnet_216x384_cavalry.bin</div>
<div class="line">│       pnet_154x273_cavalry.bin</div>
<div class="line">│       pnet_109x194_cavalry.bin</div>
<div class="line">│       pnet_77x137_cavalry.bin</div>
<div class="line">│       pnet_55x98_cavalry.bin</div>
<div class="line">│       pnet_39x69_cavalry.bin</div>
<div class="line">│       pnet_28x49_cavalry.bin</div>
<div class="line">│       pnet_20x35_cavalry.bin</div>
<div class="line">│       pnet_14x25_cavalry.bin</div>
<div class="line">│       rnet_cavalry.bin</div>
<div class="line">│       onet_cavalry.bin</div>
<div class="line">│</div>
<div class="line">└───out</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make pnet</code> to generate ten PNet binaries with the input resolution modification for <code>prototxt</code> and <code>make menuconfig</code> in the CNNGen samples package.</li>
<li>Then, use <code>make onet</code> and <code>make rnet</code> for onet and rnet. For more details, refer to <em>fs_cnngen_caffe_demos.html::sec_caffe_mtcnn</em> in the Doxygen document in the CNNGen samples package.</li>
<li>Use the CNNGen samples package to generate ten PNet models with different input resolutions, one RNet model, and one ONet model. The PNet models' name must be <code>pnet*.bin</code>, the RNet model name must be <code>rnet*.bin</code>, and the ONet model name must be <code>onet*.bin</code> to be read by the <code>test_mtcnn</code> demonstration.</li>
<li>Place all Cavalry bin models on the SD card, such as under <code>/sdcard/mtcnn/in</code>.</li>
</ul>
</dd></dl>
<p><b>FDFR (RetinaFace and MobileFaceNet)</b> with sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 1080p</div>
<div class="line">board # test_fdfr_v2 -m 0 -i /sdcard/fdfr/in -o /sdcard/fdfr/out -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 -a 0 -f 0.8,0.7</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. To enable the demonstration, select the option below.</p><ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> packages  ---&gt;</div>
<div class="line">  eazyai ---&gt;</div>
<div class="line">    apps ---&gt;</div>
<div class="line">       eazyai-apps-test-face (packages/eazyai/apps/face) ---&gt;</div>
<div class="line">        [*]   Build FDFR V2 EazyAI apps</div>
</div><!-- fragment --> Place the files on the SD card with the following structure: <div class="fragment"><div class="line">/sdcard/fdfr</div>
<div class="line">├───in</div>
<div class="line">│       faces01.jpg</div>
<div class="line">│       faces02.jpg</div>
<div class="line">│       onnx_retinaface_cavalry.bin</div>
<div class="line">│       mobilefacenets_cavalry.bin</div>
<div class="line">│</div>
<div class="line">└───out</div>
</div><!-- fragment --></li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make onnx_retinaface</code> to generate the Cavalry binary in the CNNGen samples package and rename it to <code>onnx_retinaface_cavalry.bin</code>. Then, place it in <code>/sdcard/fdfr/in</code>.</li>
<li>Use <code>make mobilefacenets</code> to generate the Cavalry binary in the CNNGen samples package and rename it to <code>mobilefacenets_cavalry.bin</code>. Then, place it in <code>/sdcard/fdfr/in</code>.</li>
</ul>
</dd></dl>
<p><b>BiSeNet</b> with the sensor input: </p><div class="fragment"><div class="line">board  # eazyai_video.sh --hdmi 720p --fb_res 320x180</div>
<div class="line">board  # test_eazyai -m 0 -d 1 --model_path bisenet_cavalry.bin -n bisenet --lua_file /usr/share/ambarella/eazyai/lua/bisenet.lua -c 2 --roi 0,0,512,1280</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. Select the option below to enable it. </p><dl class="section user"><dt>For Cooper amba build</dt><dd><div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> packages  ---&gt;</div>
<div class="line">  eazyai ---&gt;</div>
<div class="line">    -*- libeazyai-arm-postprocess (packages/eazyai/unit_test)  ---&gt;</div>
<div class="line">       [*]   Build Ambarella custom postprocess library with opennet</div>
<div class="line">    [*] eazyai-unit-test (packages/eazyai/unit_test)</div>
</div><!-- fragment --></dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make bisenet</code> to generate <code>bisenet_cavalry.bin</code> in the CNNGen samples package.</li>
<li>Set the input buffer resolution to 1280x720 and the frame buffer to 320x180. The real network input is 1280x512, and the network output is 320x128. The bottom has no detection, as it is the headstock. On the top of the screen, it will detect "freespace", "lanemark", and "curb", which are used for auto-driving.</li>
<li>Ambarella recommends using HDMI VIN as a test case.</li>
</ul>
</dd></dl>
<p><b>OpenNet</b> with sensor input: </p><div class="fragment"><div class="line">board # eazyai_video.sh --hdmi 720p</div>
<div class="line">board # test_eazyai -m 0 -d 0 --model_path opennet.bin -n opennet --lua_file /usr/share/ambarella/eazyai/lua/opennet.lua --extra_input arm_priorbox.bin</div>
</div><!-- fragment --><p >This demonstration is not selected in the default configuration. Select the option below to enable it. </p><dl class="section user"><dt>For Cooper Amba build</dt><dd><div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> packages  ---&gt;</div>
<div class="line">  eazyai ---&gt;</div>
<div class="line">    -*- libeazyai-arm-postprocess (packages/eazyai/unit_test)  ---&gt;</div>
<div class="line">       [*]   Build Ambarella custom postprocess library with opennet</div>
<div class="line">    [*] eazyai-unit-test (packages/eazyai/unit_test)</div>
</div><!-- fragment --></dd></dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Use <code>make opennet</code> to generate <code>opennet_cavalry.bin</code> in the CNNGen samples package.</li>
<li>The <code>arm_priorbox.bin</code> is located in the path <code>cnngen_samples\caffe\demo_networks\opennet\models</code>, and demonstrated in the following example.</li>
<li>The code is similar to BiSeNet. Do not modify any of the commands.</li>
</ul>
</dd></dl>
<hr  />
<h1><a class="anchor" id="getting_guide_upgrade_firmware"></a>
7. Upgrading the Firmware</h1>
<p >This chapter includes the following sections:</p>
<ul>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_down">7.1 Enter USB Download Mode</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_fastboot_ubu">7.2 Fastboot Tool (for Ubuntu)</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_fastboot_win">7.3 Fastboot Tool (for Windows)</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_ambausb_ubu">7.4 AmbaUSB (for Ubuntu)</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_ambausb_win">7.5 AmbaUSB (for Windows)</a></li>
</ul>
<h2><a class="anchor" id="sub_guide_firmware_down"></a>
7.1 Enter USB Download Mode</h2>
<p >There are two ways to switch the platform to USB download mode:</p><ul>
<li>Enter USB download mode from <b>AMBoot</b> shell.</li>
<li>Enter USB download mode from USB boot, which is used when the bootloader (BLD) malfunctions.</li>
</ul>
<p >Steps 1 through 3 below describe how to enter USB download mode from the <b>AMBoot</b> shell. If the console shows no response from the platform, proceed to step 4.</p>
<ol type="1">
<li>Connect the platform and the PC using a USB cable.</li>
<li>Verify that the dual in-line package (DIP) switches are in NAND boot mode. <div class="image">
<img src="../../getting_guide_dip_cv5.png" alt=""/>
<div class="caption">
Figure 7-1. DIP Switches in NAND Boot Mode.</div></div>
</li>
<li>Connect to the serial console.</li>
<li><p class="startli">In the serial console, press and hold the <b>Enter</b> key on the keyboard, and then press the hardware <b>RESET</b> button. The development platform will switch to the <b>AMBoot</b> shell, as shown in the below. </p><div class="fragment"><div class="line">             ___  ___  _________                _</div>
<div class="line">            / _ \ |  \/  || ___ \              | |</div>
<div class="line">           / /_\ \| .  . || |_/ /  ___    ___  | |_</div>
<div class="line">           |  _  || |\/| || ___ \ / _ \  / _ \ | __|</div>
<div class="line">           | | | || |  | || |_/ /| (_) || (_) || |_</div>
<div class="line">           \_| |_/\_|  |_/\____/  \___/  \___/  \__|</div>
<div class="line">----------------------------------------------------------</div>
<div class="line">Amboot(R) Ambarella(R) Copyright (C) 2004-2024</div>
<div class="line">Version: 3.9 - 2021年07月16日 14:18:03 - 9e0b644a</div>
<div class="line">Boot From: SPINAND 2048.128 RC 8K-Boot</div>
<div class="line">SYS_CONFIG: 0x8013401e, POC: 111</div>
<div class="line">Cortex freq: 1608000000</div>
<div class="line">iDSP freq: 46400000</div>
<div class="line">Dram freq: 2016000000</div>
<div class="line">Core freq: 960000000</div>
<div class="line">AHB freq: 480000000</div>
<div class="line">APB freq: 240000000</div>
<div class="line">amboot&gt;</div>
</div><!-- fragment --><p class="startli">If the readout above appears on the console, the platform has successfully entered USB download mode. If the development platform does not respond, or fails to enter the AMBoot shell, proceed to step 6.</p>
</li>
<li><p class="startli">Commands to be typed in the AMBoot shell are indicated by the AMBoot prompt. Type "fastboot" or "fa" to enter USB download mode for fastboot tools. </p><div class="fragment"><div class="line">amboot&gt; fa</div>
<div class="line"> </div>
<div class="line">     _____   ___    _____________________                _</div>
<div class="line">    |  ___| / _ \  /  __ \|__   __|| ___ \              | |</div>
<div class="line">    | |___ / /_\ \ \ (  )/   | |   | |_/ /  ___    ___  | |_</div>
<div class="line">    |  ___||  _  |   \ \     | |   | ___ \ / _ \  / _ \ | __|</div>
<div class="line">    | |    | | | |/(__) /    | |   | |_/ /| (_) || (_) || |_</div>
<div class="line">    |_|    \_| |_/\____/     |_|   \____/  \___/  \___/  \__|</div>
<div class="line">---------------------------------------------------------------</div>
<div class="line">Fastboot(R) Ambarella(R) Copyright (C) 2004-2099</div>
<div class="line">Enumerated HIGH speed ...</div>
</div><!-- fragment --><p class="startli">Or, type "usbdl" or "u" to enter USB download mode for AmbaUSB. </p><div class="fragment"><div class="line">amboot&gt; u</div>
<div class="line">Start transferring <span class="keyword">using</span> USB...</div>
<div class="line">init_usb_dev done</div>
<div class="line">init_usb_hardware done</div>
<div class="line">entering usb_task</div>
<div class="line">Start to send data 24 bytes...</div>
<div class="line">Send completed!</div>
<div class="line">entering usb_task</div>
<div class="line">Start to send data 4096 bytes...</div>
<div class="line">Send completed!</div>
<div class="line">entering usb_task</div>
</div><!-- fragment --></li>
<li>If the platform fails to enter USB download mode from the AMBoot shell, set the DIP switches as shown in the figures below. Then, power on the platform. The platform enters USB download mode using the USB Boot. <div class="image">
<img src="../../getting_guide_dip_usb_cv5.png" alt=""/>
<div class="caption">
Figure 7-2. DIP Switches in USB Boot Mode.</div></div>
</li>
<li>After the development platform enters USB download mode, the PC will recognize the USB device. The PC display will pop up a message to indicate that the platform is connected as a USB device.</li>
</ol>
<p >If the PC cannot recognize the platform, upgrade the Ambarella USB driver.</p>
<p >On a Windows 7 PC, select <b>Device Manager &gt; Universal Serial Bus controllers &gt; Unknown device</b>. Update the driver from this device. The Ambarella USB driver can be found in <code>$(Where AmbaUSB is installed)\Driver\</code>.</p>
<h2><a class="anchor" id="sub_guide_firmware_fastboot_ubu"></a>
7.2 Fastboot Tool (for Ubuntu)</h2>
<p >AmbaUSB is the tool used to upgrade the platform on Ubuntu PC using a USB. Locate the installation programs in <code>Tools/AmbaUSB</code>.</p>
<p >Operating system (OS) requirement: Ubuntu 16.04 LTS / 18.04 LTS</p>
<p >If this is the first time connecting the CV5 or CV72 EVK to Ubuntu, proceed with the following commands to set up a basic burning environment: </p><div class="fragment"><div class="line">export amba_udev_file=/var/tmp/51-ambarella.rules</div>
<div class="line">echo <span class="stringliteral">&#39;SUBSYSTEM==&quot;usb&quot;, ATTR{idVendor}==&quot;18d1|4255&quot;, MODE=&quot;0666&quot;,GROUP=&quot;plugdev&quot;&#39;</span>&gt; $amba_udev_file</div>
<div class="line">chmod a+rx $amba_udev_file</div>
<div class="line">sudo mv $amba_udev_file /etc/udev/rules.d/</div>
<div class="line">sudo /etc/init.d/udev restart</div>
</div><!-- fragment --><p >Refer to the following steps to download new firmware if the EVK enters into download mode by setting DIP switches. If the EVK enters into download mode by typing "fastboot" or "fa" in AMBoot, proceed to step 4.</p>
<p >Open a new console and switch to the fastboot tool folder (in the folder <code>platform-tools_rxx.x.x-linux</code>).</p>
<ol type="1">
<li>Connect the board to the PC using a USB cable and ensure that the board enters into USB download mode.</li>
<li>Ensure that the USB can successfully identify the USB device with "4255:0018". <div class="fragment"><div class="line">build $ lsusb</div>
<div class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</div>
<div class="line">Bus 001 Device 003: ID 046d:c52b Logitech, Inc. Unifying Receiver</div>
<div class="line">Bus 001 Device 045: ID 4255:0018 GoPro</div>
<div class="line">Bus 001 Device 014: ID 1a86:7523 QinHeng Electronics HL-340 USB-Serial adapter</div>
<div class="line">Bus 001 Device 013: ID 0424:2422 Standard Microsystems Corp.</div>
<div class="line">Bus 001 Device 002: ID 413c:2107 Dell Computer Corp.</div>
<div class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</div>
</div><!-- fragment --></li>
<li>Execute pack_image_usb to bring up fastboot. <div class="fragment"><div class="line">pack_image_usb -f  &lt;prebuild binary&gt;</div>
<div class="line"> </div>
<div class="line">example:</div>
<div class="line">pack_image_usb -f  ambust_lpddr5_signed.bin</div>
</div><!-- fragment --></li>
<li>Once the EVK enters fastboot, "18d1:4ee0" is the critical word to find the correct device recognized by Ubuntu. <div class="fragment"><div class="line">build $ lsusb</div>
<div class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</div>
<div class="line">Bus 001 Device 003: ID 046d:c52b Logitech, Inc. Unifying Receiver</div>
<div class="line">Bus 001 Device 047: ID 18d1:4ee0 Google Inc.</div>
<div class="line">Bus 001 Device 014: ID 1a86:7523 QinHeng Electronics HL-340 USB-Serial adapter</div>
<div class="line">Bus 001 Device 013: ID 0424:2422 Standard Microsystems Corp.</div>
<div class="line">Bus 001 Device 002: ID 413c:2107 Dell Computer Corp.</div>
<div class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</div>
</div><!-- fragment --></li>
<li>Execute fastboot to download the binary firmware. <div class="fragment"><div class="line">fastboot boot &lt;path to binary firmare&gt; --base 0x4000000</div>
<div class="line"> </div>
<div class="line">Example:</div>
<div class="line">fastboot boot bst_bld_atf_kernel_lnx_release.bin --base 0x4000000</div>
</div><!-- fragment --></li>
<li>The serial console of the development platform indicates the upgrading progress. <div class="fragment"><div class="line">------ Report ------</div>
<div class="line">bst:    success</div>
<div class="line">bld:    success</div>
<div class="line">pri:    success</div>
<div class="line">lnx:    success.</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="sub_guide_firmware_fastboot_win"></a>
7.3 Fastboot Tool (for Windows)</h2>
<p >The fastboot tool (<code>platform-tools_rxx.x.x-windows</code>) is used to upgrade the platform on a PC via USB.</p>
<p >OS requirement: 32-bit or 64-bit Windows 7 or above</p>
<p >Refer to the following steps to download the new firmware if the EVK enters download mode by setting DIP switches. If the EVK enters into download mode by typing "fastboot" or "fa" in AMBoot, proceed to step 4.</p>
<p >Open a new console and switch to the fastboot tool folder (found in the folder <code>platform-tools_rxx.x.x-windows</code>).</p>
<ol type="1">
<li>Connect the board to the PC using a USB cable and ensure that the board enters into USB download mode.</li>
<li>Ensure that the driver has been updated by checking the driver version. <div class="image">
<img src="../../getting_guide_cv5_usb_driver.png" alt=""/>
<div class="caption">
Figure 7-3. AmbaUSB Driver.</div></div>
</li>
<li>Execute <code>pack_image_usb.exe</code> to initiate fastboot. <div class="fragment"><div class="line">pack_image_usb.exe -f  &lt;prebuild binary&gt;</div>
<div class="line"> </div>
<div class="line">example:</div>
<div class="line">pack_image_usb.exe -f  ambust_lpddr5_signed.bin</div>
</div><!-- fragment --></li>
<li>Once the EVK enters fastboot, the word "Android" is required to ensure that the correct device is recognized by the PC. <div class="image">
<img src="../../getting_guide_cv5_fastboot_and.png" alt=""/>
<div class="caption">
Figure 7-4. Fastboot Android Device.</div></div>
</li>
<li>Execute <code>fastboot.exe</code> to download the binary firmware. <div class="fragment"><div class="line">fastboot.exe boot &lt;path to binary firmware&gt; --base 0x4000000</div>
<div class="line"> </div>
<div class="line">Example:</div>
<div class="line">fastboot.exe boot bst_bld_atf_kernel_lnx_release.bin --base 0x4000000</div>
</div><!-- fragment --></li>
<li>The serial console of the development platform indicates the upgrading progress. <div class="fragment"><div class="line">------ Report ------</div>
<div class="line">bst:    success</div>
<div class="line">bld:    success</div>
<div class="line">pri:    success</div>
<div class="line">lnx:    success.</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="sub_guide_firmware_ambausb_ubu"></a>
7.4 AmbaUSB (for Ubuntu)</h2>
<p >AmbaUSB is the tool used to upgrade the platform on Ubuntu PC using the USB. Locate the installation programs in <code>Tools/AmbaUSB</code>.</p>
<p >OS Requirement: Ubuntu 16.04 LTS / 18.04 LTS</p>
<p >Select the appropriate installation program, then double-click to install it.</p>
<ol type="1">
<li>Connect the board to the PC using a USB cable.</li>
<li>Before burning the firmware to the platform, ensure that the platform has entered USB download mode as described in Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_down">7.1 Enter USB Download Mode</a>. <div class="image">
<img src="../../getting_guide_assign_virture.png" alt=""/>
<div class="caption">
Figure 7-5. Assign the Ambarella USB Device to the Virtual Machine.</div></div>
</li>
<li>Before using AmbaUSB in the Linux virtual machine, assign the Ambarella USB device to the virtual machine.</li>
<li><p class="startli">Launch AmbaUSB. Select the proper chip model for the boards's filter and flash configuration, according to the table below. AmbaUSB will recognize the connected board automatically if all options are consistent with the board connected to the host in the figure below.</p>
<a class="anchor" id="getting_guide_board_config"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Core Board </th><th>Titanium </th><th>Manganese </th><th>Cr </th><th>Co </th></tr>
<tr>
<td>Chip </td><td>CV5 </td><td>CV5 </td><td>CV52 </td><td>CV52 </td></tr>
<tr>
<td>Board configuration </td><td>CV5.LPDDR5.NAND </td><td>CV5.LPDDR4.NAND </td><td>CV52_DDRC1.LPDDR5.NAND </td><td>CV52_DDRC1.LPDDR4.NAND </td></tr>
</table>
</li>
<li>Click the <b>Find</b> button beside the firmware to browse the images that will be flashed to the board. <div class="image">
<img src="../../getting_guide_download_firmware_CV5.png" alt=""/>
<div class="caption">
Figure 7-6. Downloading the Firmware.</div></div>
</li>
<li>Click the button with the blue arrow icon on the right to start downloading the firmware.</li>
<li>The serial console of the development platform will indicate the upgrading process. When the image is downloaded, the message "Program Terminated" appears on the serial console. Refer to the code below.: <div class="fragment"><div class="line">------ Report ------</div>
<div class="line">bst:    success</div>
<div class="line">bld:    success</div>
<div class="line">hal:    success</div>
<div class="line">pri:    success</div>
<div class="line">lnx:    success</div>
<div class="line">- Program Terminated -</div>
</div><!-- fragment --></li>
<li>The firmware will reboot automatically and load after it is downloaded with the DIP settings in NAND boot mode. If it fails to flash the firmware into the board from the AMBoot shell, enter USB boot mode as described in the previous section and try again.</li>
<li>If the DIP switches have been set to USB boot mode (see the previous section), set the DIP switches to NAND boot mode in Figure <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_firmware_down">7.1 Enter USB Download Mode</a>. and reboot.</li>
</ol>
<h2><a class="anchor" id="sub_guide_firmware_ambausb_win"></a>
7.5 AmbaUSB (for Windows)</h2>
<p >AmbaUSB is used to upgrade the platform on a PC via USB. The installation programs, located in <code>Tools/AmbaUSB</code>, include 32-bit and 64-bit PC versions of AmbaUSB.</p>
<p >OS Requirement: 32-bit or 64-bit Windows 7</p>
<p >Choose the correct OS and double-click the installation program to install.</p>
<ol type="1">
<li>Connect the board and PC using a USB cable. Verify that the board can enter USB download mode.</li>
<li>Ensure that the driver has been updated. Check the driver version, as shown in the following figure. Select the proper chip model for the boards's filter and the proper flash configuration according to the table <a class="el" href="../../d7/d6c/page_getting_start_guide.html#getting_guide_board_config">Board Configuration</a>. AmbaUSB will recognize the board automatically if the options are consistent with the board connected to the host, as shown in the figure below. <div class="image">
<img src="../../getting_guide_ambausb_driver.png" alt=""/>
<div class="caption">
Figure 7-7. AmbaUSB Driver.</div></div>
</li>
<li><p class="startli">Locate the firmware and click on the blue download icon to start the download. See the following figure. </p><div class="image">
<img src="../../getting_guide_auto_detection_CV5.png" alt=""/>
<div class="caption">
Figure 7-8. Auto-detection of the CV5 Timn Board.</div></div>
 <div class="image">
<img src="../../getting_guide_auto_detection_CV52.png" alt=""/>
<div class="caption">
Figure 7-9. Auto-detection of the CV52 CR / CO Board.</div></div>
 <div class="image">
<img src="../../getting_guide_auto_detection_CV72.png" alt=""/>
<div class="caption">
Figure 7-10. Auto-detection of the CV72 GA / GE Board.</div></div>
<p class="startli"><b>Notes for CV52 boards:</b> <br  />
</p><ul>
<li>Select <b>CV5</b> for the board in the middle right.<br  />
</li>
<li>Select <b>LINUX.CV52_DDRC1.LPDDR4.NAND.540MHz</b> for the CV52 CO board, and select <b>LINUX.CV52_DDRC1.LPDDR5.NAND.540MHz</b> for the CV52 CR board.</li>
</ul>
</li>
<li>The serial console of the development platform will indicate the upgrading process. When the download is complete, the message "Program Terminated" will be displayed on the serial console: <div class="fragment"><div class="line">------ Report ------</div>
<div class="line">bst:    success</div>
<div class="line">bld:    success</div>
<div class="line">hal:    success</div>
<div class="line">pri:    success</div>
<div class="line">lnx:    success.</div>
<div class="line">- Program Terminated -</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="getting_guide_document"></a>
8. SDK Documents on Webpages</h1>
<p >Ambarella uses Doxygen, a tool for writing software documentation, to generate SDK documents from the source code, ensuring their alignment with rapid code development. The SDK documents appear on webpages. Currently, Ambarella uses Doxygen to create webpages for the following:</p>
<a class="anchor" id="getting_guide_amba_dox_pag"></a>
<table class="doxtable">
<caption>Table 8-1. Ambarella Doxygen Webpages.</caption>
<tr>
<th>Catalog </th><th>Content </th></tr>
<tr>
<td rowspan="7">Ambarella Linux SDK </td><td>System Overview </td></tr>
<tr>
<td>Document Reading Guide </td></tr>
<tr>
<td>Market Segments </td></tr>
<tr>
<td>Getting Start Guide </td></tr>
<tr>
<td>SDK Deliverables </td></tr>
<tr>
<td>SDK Code Building </td></tr>
<tr>
<td>Glossary and Abbreviations </td></tr>
<tr>
<td rowspan="4">Hardware </td><td>Hardware (HW) Modules </td></tr>
<tr>
<td>Board - CV5 Titanium </td></tr>
<tr>
<td>Board - CV52 Co / Cr </td></tr>
<tr>
<td>Board - CV72 Ga / Ge </td></tr>
<tr>
<td rowspan="3">Build System </td><td>Building System Introduction and Guidance </td></tr>
<tr>
<td>Yocto Recipe </td></tr>
<tr>
<td>Yocto FAQ </td></tr>
<tr>
<td rowspan="5">Driver </td><td>Cavalry Driver Application Programming Interface (API) </td></tr>
<tr>
<td>Continuous Memory Allocator (CMA) Driver API </td></tr>
<tr>
<td>IAV Driver API </td></tr>
<tr>
<td>Sensor Parameters and Tuning Table </td></tr>
<tr>
<td>Sensor and SERDES Driver Installation </td></tr>
<tr>
<td rowspan="18">Library </td><td>Advanced Software Framework (ASF) Library API </td></tr>
<tr>
<td>Cavalry_Mem Library API </td></tr>
<tr>
<td>Amba GStreamer Plugins </td></tr>
<tr>
<td>Cavalry Opt Layers Library API </td></tr>
<tr>
<td>CGPP Library API </td></tr>
<tr>
<td>Data Process Library API </td></tr>
<tr>
<td>EazyAI Library API </td></tr>
<tr>
<td>Electronic Image Stabilization (EIS) Library API </td></tr>
<tr>
<td>FAST_IO Library API </td></tr>
<tr>
<td>Image Library API </td></tr>
<tr>
<td>Image Flow Library API </td></tr>
<tr>
<td>Neural Network Control (NNCtrl) Library API </td></tr>
<tr>
<td>NNStreamer Library API </td></tr>
<tr>
<td>Sensor Calibration Library API </td></tr>
<tr>
<td>SmartFB Library API </td></tr>
<tr>
<td>Smart Rate Control (SmartRC) V3 Library API </td></tr>
<tr>
<td>Stitch Library API </td></tr>
<tr>
<td>VPROC Library API </td></tr>
<tr>
<td rowspan="29">Video </td><td>BASIC - Video Input </td></tr>
<tr>
<td>BASIC - Video Output </td></tr>
<tr>
<td>BASIC - RAW </td></tr>
<tr>
<td>BASIC - Channel </td></tr>
<tr>
<td>BASIC - Source Buffer </td></tr>
<tr>
<td>BASIC - Pyramid </td></tr>
<tr>
<td>BASIC - Canvas </td></tr>
<tr>
<td>BASIC - Stream </td></tr>
<tr>
<td>BASIC - H.264 / H.265 Codec </td></tr>
<tr>
<td>BASIC - Group of Pictures (GOP) </td></tr>
<tr>
<td>BASIC - On the Fly Settings </td></tr>
<tr>
<td>BASIC - Privacy Mask </td></tr>
<tr>
<td>BASIC - Blur on Streams </td></tr>
<tr>
<td>BASIC - Overlay on Streams </td></tr>
<tr>
<td>BASIC - Data Dumping </td></tr>
<tr>
<td>BASIC - Frame Rate </td></tr>
<tr>
<td>BASIC - High Dynamic Range (HDR) </td></tr>
<tr>
<td>ADVANCED - Encode Mode </td></tr>
<tr>
<td>ADVANCED - Configure with Lua Script </td></tr>
<tr>
<td>ADVANCED - Lens Distortion Correction (LDC) </td></tr>
<tr>
<td>ADVANCED - Vsync Loss </td></tr>
<tr>
<td>ADVANCED - Arbitrary Image Scaler </td></tr>
<tr>
<td>ADVANCED - Encode from Memory </td></tr>
<tr>
<td>ADVANCED - Encode from RAW </td></tr>
<tr>
<td>ADVANCED - Pipeline Latency </td></tr>
<tr>
<td>ADVANCED - Poll Interface </td></tr>
<tr>
<td>ADVANCED - Bypass IDSP for YUV input </td></tr>
<tr>
<td>OTHER - Debug Option </td></tr>
<tr>
<td>OTHER - Miscellaneous </td></tr>
<tr>
<td>OTHER - Dynamic Random-Access Memory (DRAM) Bandwidth Statistics </td></tr>
<tr>
<td>Security </td><td>Overview </td></tr>
<tr>
<td rowspan="11">System </td><td>Migration Guide from CV2x </td></tr>
<tr>
<td>Boot and Upgrade </td></tr>
<tr>
<td>DRAM Optimization </td></tr>
<tr>
<td>Hardware Presentation Time Stamp (PTS) </td></tr>
<tr>
<td>Power Management </td></tr>
<tr>
<td>Sensor Calibration User Guide </td></tr>
<tr>
<td>Multi-VIN Design </td></tr>
<tr>
<td>AMBoot Documents </td></tr>
<tr>
<td>AMBA System Document </td></tr>
<tr>
<td>PDF Documents </td></tr>
<tr>
<td>Kernel Documents </td></tr>
<tr>
<td rowspan="15">Peripherals </td><td>Audio </td></tr>
<tr>
<td>File System </td></tr>
<tr>
<td>NAND </td></tr>
<tr>
<td>eMMC </td></tr>
<tr>
<td>Debugfs </td></tr>
<tr>
<td>USB </td></tr>
<tr>
<td>SD Card </td></tr>
<tr>
<td>WiFi </td></tr>
<tr>
<td>Bluetooth </td></tr>
<tr>
<td>SPI </td></tr>
<tr>
<td>I2C </td></tr>
<tr>
<td>Peripheral Component Interconnect Express (PCIe) Express </td></tr>
<tr>
<td>Ethernet </td></tr>
<tr>
<td>Misellaneous </td></tr>
<tr>
<td>Joint Test Action Group (JTAG) </td></tr>
<tr>
<td rowspan="2">Applications </td><td>Ambarella Applications Document </td></tr>
<tr>
<td>Access Control Camera </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Future SDK versions will include additional webpages. Users can visit <a href="http://doxygen.nl/">http://doxygen.nl/</a> for more information about the Doxygen software.</dd></dl>
<p>This chapter includes the following sections:</p>
<ul>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_document_sdk_cv5">8.1 Generating the SDK Document Website</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_document_cnngen_cv5">8.2 Generated CNNGen Document Website</a></li>
</ul>
<h2><a class="anchor" id="sub_guide_document_sdk_cv5"></a>
8.1 Generating the SDK Document Website</h2>
<p >To view the document webpages:</p>
<ol type="1">
<li>Go to <a href="http://www.doxygen.nl/download.html">http://www.doxygen.nl/download.html</a>, download a suitable binary, and install the Doxygen software. Ensure that the software is functioning correctly.</li>
<li>In the build PC, go to the CNNGen samples package build folder. <div class="fragment"><div class="line">build $ cd ambarella/</div>
<div class="line">build $ export TOOLCHAIN_PATH=1</div>
<div class="line">build $ cd boards/cv5_timn</div>
<div class="line">build $ make ipcam_config</div>
<div class="line">build $ make sdk_doc</div>
</div><!-- fragment --></li>
<li>Webpages are located in <code>ambarella/out/doc_out/cv5x_doc/doc/overview/</code>. Use the browser to open the <code>index.html</code> and display the webpage as shown below: <div class="image">
<img src="../../getting_guide_document_web_cv5.png" alt=""/>
<div class="caption">
Figure 8-1. Generated Document Webpages.</div></div>
</li>
</ol>
<h2><a class="anchor" id="sub_guide_document_cnngen_cv5"></a>
8.2 Generated CNNGen Document Website</h2>
<p >Follow the steps below to find the document website:</p><ol type="1">
<li>Download the <code>cvflow_cnngen_samples_&lt;version&gt;_&lt;date&gt;.tar.xz</code> from PRO system.</li>
<li>Find <code>cvflow_cnngen_documents_&lt;version&gt;_&lt;date&gt;.tar.bz2</code> in above package. <div class="fragment"><div class="line">build $ tar xvfp cvflow_cnngen_documents_&lt;version&gt;_&lt;date&gt;.tar.bz2</div>
</div><!-- fragment --></li>
<li>And open <code>feature_sets/index.html</code> with browser. Then, the document is displayed, as in the example below. <div class="image">
<img src="../../getting_guide_cnngen_document_web.png" alt=""/>
<div class="caption">
Figure 8-2. Generated CNNGen Document Websites.</div></div>
</li>
</ol>
<hr  />
<h1><a class="anchor" id="getting_guide_cpu"></a>
9. CPU Performance Benchmarks</h1>
<h2><a class="anchor" id="sub_guide_cpu_dmips"></a>
9.1 Dhrystone to Check CPU DMIPS</h2>
<p >Dhrystone is a synthetic computing benchmark program developed in 1984 by Reinhold P. Weicker, intended to be representative of system (integer) programming. Dhrystone grew to become representative of general processor (CPU) performance.</p>
<p >The Dhrystone benchmark contains no floating point operations; thus the name is a pun on the then-popular Whetstone benchmark for floating point operations. The output from the benchmark is the number of Dhrystones per second (the number of iterations of the main code loop per second). Both Whetstone and Dhrystone are synthetic benchmarks, meaning that they are simple programs that are carefully designed to statistically mimic the processor usage of some common sets of programs.</p>
<p >Dhrystone may represent a result more meaningfully than millions of instructions per second (MIPS). A common representation of the Dhrystone benchmark is the DMIPS (Dhrystone MIPS) obtained when the Dhrystone score is divided by 1757 (the number of Dhrystones per second obtained on the VAX 11/780, nominally a 1-MIPS machine).</p>
<p >Dhrystone's open source code has been introduced into the Ambarella SDKs. It is located in the <code>ambarella/unit_test/linux/benchmark/dhrystone</code> folder. Users can enable the Dhrystone compile when building the firmware.</p>
<div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">   unit_test ---&gt;</div>
<div class="line">       linux ---&gt;</div>
<div class="line">            benchmark ---&gt;</div>
<div class="line">               [*] test-dhrystone (unit_test/linux/benchmark/dhrystone)</div>
</div><!-- fragment --><p >Use the following command to perform the test. </p><div class="fragment"><div class="line">board # find / -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a> dhrystone</div>
<div class="line">/usr/local/bin/dhrystone</div>
<div class="line">board # dhrystone</div>
<div class="line">Dhrystone BenchMark, Version 2.1(Language:C)</div>
<div class="line">===================/proc/cpuinfo==============</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">Total DMIPS:26569.30</div>
</div><!-- fragment --><h2><a class="anchor" id="sub_guide_cpu_coremark"></a>
9.2 Coremark-pro to Check CPU Performance</h2>
<p >CoreMark®-PRO is a comprehensive, advanced processor benchmark that functions with and enhances the market-proven industry-standard EEMBC CoreMark® benchmark. While CoreMark stresses the CPU pipeline, CoreMark-PRO tests the entire processor, adding comprehensive support for multicore technology, a combination of integer and floating-point workloads, and data sets for utilizing larger memory subsystems. Together, EEMBC CoreMark and CoreMark-PRO provide a standard benchmark covering the spectrum from low-end microcontrollers to high-performance computing processors.</p>
<p >The EEMBC CoreMark-PRO benchmark contains five prevalent integer workloads and four popular floating-point workloads.</p>
<p >The integer workloads include:</p><ul>
<li>JPEG compression</li>
<li>ZIP compression</li>
<li>XML parsing</li>
<li>SHA-256 Secure Hash Algorithm</li>
<li>A more memory-intensive version of the original CoreMark</li>
</ul>
<p >The floating-point workloads include:</p><ul>
<li>Radix-2 Fast Fourier Transform (FFT)</li>
<li>Gaussian elimination with partial pivoting derived from LINPACK</li>
<li>A simple neural-net</li>
<li>A greatly improved version of the Livermore loops benchmark using the following 24 FORTRAN kernels</li>
</ul>
<p >CoreMark-PRO's open source code has been introduced into the Ambarella SDKs. It is located in the <code>ambarella/unit_test/linux/benchmark/coremark-pro</code> folder. Users can enable the CoreMark-PRO compile when building the firmware.</p>
<ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">   unit_test ---&gt;</div>
<div class="line">       linux ---&gt;</div>
<div class="line">            benchmark ---&gt;</div>
<div class="line">               [*] coremark-pro (unit_test/linux/benchmark/coremark-pro)</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">   meta-ambaapp ---&gt;</div>
<div class="line">       recipes-linuxtest ---&gt;</div>
<div class="line">           [*] coremark-pro (meta-ambaapp/recipes-linuxtest/coremark-pro)</div>
</div><!-- fragment --></li>
</ul>
<p >Use the following command to execute the test, where 6 represents the number of runs, and the default is 1. </p><div class="fragment"><div class="line">board # /usr/local/bin/coremark.sh 6</div>
<div class="line"> </div>
<div class="line">WORKLOAD RESULTS TABLE</div>
<div class="line"> </div>
<div class="line">                                                 MultiCore SingleCore</div>
<div class="line">Workload Name                                     (iter/s)   (iter/s)    Scaling</div>
<div class="line">-----------------------------------------------------</div>
<div class="line">cjpeg-rose7-preset                                181.8180    91.7431     1.9818</div>
<div class="line">core                                                1.6308     0.8167     1.9969</div>
<div class="line">linear_alg-mid-100x100-sp                         188.6790    94.3396     2.0000</div>
<div class="line">loops-all-mid-10k-sp                                3.7327     3.5273     1.0582</div>
<div class="line">nnet_test                                          11.1359     5.5586     2.0033</div>
<div class="line">parser-125k                                        26.7380    14.0647     1.9011</div>
<div class="line">radix2-big-64k                                    357.1430   294.1180     1.2143</div>
<div class="line">sha-test                                          303.0300   151.5150     2.0000</div>
<div class="line">zip-test                                          119.0480    66.2252     1.7976</div>
<div class="line"> </div>
<div class="line">WORKLOAD RESULTS TABLE</div>
<div class="line"> </div>
<div class="line">Mark Name                                        MultiCore SingleCore    Scaling</div>
<div class="line">-----------------------------------------------------</div>
<div class="line">CoreMark-PRO                                     5210.1118  3010.5315     1.7306</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="getting_guide_sd_card"></a>
10. SD Card</h1>
<p >The CV5x EVK board has two secure digital (SD) interfaces. The larger slot is used for the SD card, and the smaller slot is used for the secure digital input output (SDIO) WiFi card. The two SD slots are independent; they possess their own SD controllers. The SDIO controller does not support the UHS-I mode. SD slot 0 can support booting with embedded multi-media controller / card (eMMC), while SD slot 1 cannot.</p>
<p >The maximum frequency of the SD controller is 150 MHz.</p>
<p >This chapter includes the following sections:</p>
<ul>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_sd_card_slot">10.1 SD Slot</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_sd_card_type">10.2 SD Card Type</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_sd_card_pre">10.3 Hardware and Software Preparation</a></li>
<li>Section <a class="el" href="../../d7/d6c/page_getting_start_guide.html#sub_guide_sd_card_format">10.4 Format and Mount</a></li>
</ul>
<h2><a class="anchor" id="sub_guide_sd_card_slot"></a>
10.1 SD Slot</h2>
<p >The following figure shows the bottom of the CV5 Timn board. The SD card is visible in the top slot. </p><div class="image">
<img src="../../getting_guide_sd_slots_cv5.png" alt=""/>
<div class="caption">
Figure 10-1. SD Slots.</div></div>
<p >The default value of fixed_cd is -1. -1: Auto detect, 0: No detection, 1: Force detect once.</p>
<ol type="1">
<li>Turn off the slot if it is not in use. Too many unused SD interrupts can lead to a heavy system load, impacting network performance. <div class="fragment"><div class="line">board # mount -t debugfs debugfs /debug</div>
<div class="line">board # echo 0 &gt; /debug/mmc0/ambhost/fixed_cd</div>
</div><!-- fragment --></li>
<li>To trigger the CD to scan the SD bus manually, modify the value of fixed_cd. <div class="fragment"><div class="line">board # echo 1 &gt; /debug/mmc0/ambhost/fixed_cd</div>
</div><!-- fragment --></li>
</ol>
<p >For the CV5 Timn board, the "mmc0" must be modified to "mmc1"(to TF card) or "mmc2"(to SD card).</p>
<h2><a class="anchor" id="sub_guide_sd_card_type"></a>
10.2 SD Card Type</h2>
<p >SD is a non-volatile memory card format developed by the SD Card Association for use in portable devices. See <a href="https://www.sdcard.org/home/">https://www.sdcard.org/home/</a> for further details. Users can also refer to <a href="http://en.wikipedia.org/wiki/SD_card">http://en.wikipedia.org/wiki/SD_card</a> for SD card standards. </p><div class="image">
<img src="../../getting_guide_sd_various.png" alt=""/>
<div class="caption">
Figure 10-2. SD / SDHC / SDXC / MMC Cards from Various Vendors.</div></div>
 <div class="image">
<img src="../../getting_guide_pins_sd.png" alt=""/>
<div class="caption">
Figure 10-3. Pins on an SD Card.</div></div>
<p >If the application requires continuous data storage, Ambarella recommends using high speed / high quality SD cards. High speed / high quality SD cards write data in less time and require less CPU for I/O.</p>
<p >The following sections provide information about SD card format, speed, and design notes. Ambarella does not recommend normal-speed SD cards, low-speed SD cards, low-speed multi-media cards (MMC), or small-capacity SD cards for typical internet protocol camera (IPCAM) system designs, or car DV designs. As an alternative, Ambarella recommends using the secure digital high capacity (SDHC) class 4 or above for continuous data writing applications.</p>
<p >If applications require long-time, continuous data writing, Ambarella recommends using SDHC class 4 or above for typical IPCAM or car DV products.</p>
<p >Although various SD cards may be usable with CV5x / CV7x, only the SD cards in the following list are verified on the CV5x / CV7x EVK board.</p>
<a class="anchor" id="gsg_verified_sd"></a>
<table class="doxtable">
<caption>Table 10-1. Verified SD Card.</caption>
<tr>
<th>Brand </th><th>Class </th><th>Capacity </th><th>Type </th></tr>
<tr>
<td rowspan="5">Kingston </td><td>Normal </td><td>2 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Class 4 </td><td>4 GB </td><td>MicroSD card </td></tr>
<tr>
<td></td><td>2 GB </td><td>SD card </td></tr>
<tr>
<td></td><td>4 GB </td><td>SD card </td></tr>
<tr>
<td>Class 4 </td><td>4 GB </td><td>SDHC card </td></tr>
<tr>
<td rowspan="2">Kingmax </td><td>Normal </td><td>2 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Class 6 </td><td>4 GB </td><td>Micro-SDHC card </td></tr>
<tr>
<td rowspan="5">SanDisk </td><td>Class 2 </td><td>4 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Class 4 </td><td>4 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Normal </td><td>512 MB </td><td>SD card </td></tr>
<tr>
<td>Class 2 </td><td>4 GB </td><td>SDHC card </td></tr>
<tr>
<td>Class 4 </td><td>4 GB </td><td>SDHC card </td></tr>
<tr>
<td rowspan="2">Toshiba </td><td>Class 4 </td><td>4 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Class 10 </td><td>16 GB </td><td>SDHC card </td></tr>
<tr>
<td rowspan="2">Apacer </td><td></td><td>2 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Class 4 </td><td>4 GB </td><td>MicroSD card </td></tr>
<tr>
<td rowspan="2">PNY </td><td></td><td>2 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Class 4 </td><td>4 GB </td><td>MicroSD card </td></tr>
<tr>
<td>PQI </td><td></td><td>2 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Esuninfo </td><td></td><td>2 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Verbatim </td><td></td><td>2 GB </td><td>MicroSD card </td></tr>
<tr>
<td>SONY </td><td>Class 4 </td><td>32 GB </td><td>MicroSD card </td></tr>
<tr>
<td>Lenovo </td><td></td><td>1 GB </td><td>SD card </td></tr>
<tr>
<td>Adata </td><td></td><td>256 MB </td><td>SD card </td></tr>
<tr>
<td rowspan="2">Transcend </td><td>Class 10 </td><td>8 GB </td><td>SDHC card </td></tr>
<tr>
<td>Class 10 </td><td>32 GB </td><td>SDHC card </td></tr>
</table>
<h2><a class="anchor" id="sub_guide_sd_card_pre"></a>
10.3 Hardware and Software Preparation</h2>
<h3><a class="anchor" id="dsub_guide_sd_card_pre_cv2"></a>
10.3.1 CV5 Timn EVK</h3>
<p >For CV5 Timn EVK, the pin function of the SD card and the TransFlash (TF) card are multiplexed with I2C / VSYNC / SPI bus. With the default settings, the I2C / VSYNC / SPI bus are enabled. Follow the steps below to enable the SD card or TF card function:</p>
<ul>
<li>SD card</li>
</ul>
<ol type="1">
<li>Enable SDIO0 before building the firmware.</li>
</ol>
<ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> [*] bootmenu@<span class="keyword">virtual</span> (boot)  ---&gt;</div>
<div class="line">   [*]   boot (boot)  ---&gt;</div>
<div class="line">     Bootloader  ---&gt;</div>
<div class="line">        Ambarella Firmware Configuration  ---&gt;</div>
<div class="line">           SDIO0 and I2C1/VSYNC Selection (SDIO0)  ---&gt;</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">  meta-ambabsp ---&gt;</div>
<div class="line">     recipes-bsp ---&gt;</div>
<div class="line">         boot (meta-ambabsp/recipes-bsp/boot) ---&gt;</div>
<div class="line">           Bootloader ---&gt;</div>
<div class="line">              Ambarella Firmware Configuration  ---&gt;</div>
<div class="line">                 SDIO0 and I2C1/VSYNC Selection (SDIO0)  ---&gt;</div>
</div><!-- fragment --></li>
</ul>
<ol type="1">
<li>Modify the hardware power-on configuration (POC) and jumpers:<br  />
 Set SW2_1, SW2_2, SW2_3 off (SW2 is close to the senor slots);<br  />
 Switch the jumper from J18 to J16.</li>
</ol>
<ul>
<li>TF card</li>
</ul>
<ol type="1">
<li>Enable SDIO1 before building the firmware.</li>
</ol>
<ul>
<li>For Cooper Amba build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line"> [*] bootmenu@<span class="keyword">virtual</span> (boot)  ---&gt;</div>
<div class="line">   [*]   boot (boot)  ---&gt;</div>
<div class="line">     Bootloader  ---&gt;</div>
<div class="line">        Ambarella Firmware Configuration  ---&gt;</div>
<div class="line">           SDIO1 and SPI3/I2C5 Selection (SDIO1)  ---&gt;</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">  meta-ambabsp ---&gt;</div>
<div class="line">     recipes-bsp ---&gt;</div>
<div class="line">         boot (meta-ambabsp/recipes-bsp/boot) ---&gt;</div>
<div class="line">           Bootloader ---&gt;</div>
<div class="line">              Ambarella Firmware Configuration  ---&gt;</div>
<div class="line">                 SDIO1 and SPI3/I2C5 Selection (SDIO1)  ---&gt;</div>
</div><!-- fragment --></li>
</ul>
<ol type="1">
<li>Modify hardware POC and Jumpers:<br  />
 Set SW2_1, SW2_2, SW2_4 off;<br  />
 Switch the jumper from J24 to J22.</li>
</ol>
<h2><a class="anchor" id="sub_guide_sd_card_format"></a>
10.4 Format and Mount</h2>
<h3><a class="anchor" id="dsub_guide_sd_card_format_enable"></a>
10.4.1 Enable FAT32 / exFAT for Windows OS or EXT4 for Linux OS</h3>
<p >Although the Cooper SDK has an integrated common file system, users must open the corresponding configuration when building the firmware.</p>
<ul>
<li>exFAT <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">    prebuild  ---&gt;</div>
<div class="line">          oss  ---&gt;</div>
<div class="line">      Filesystem Tools &gt;</div>
<div class="line">        [*] prebuild-fuse-exfat (prebuild/oss/armv8-a/fuse-exfat)</div>
</div><!-- fragment --></li>
<li>EXT4 <div class="fragment"><div class="line">build $ make menuconfig_public_linux</div>
<div class="line">File systems &gt;</div>
<div class="line">   &lt;*&gt;The Extended 4 (ext4) filesystem &gt;</div>
<div class="line">   [*] Use ext4 <span class="keywordflow">for</span> ext2 file systems &gt;</div>
<div class="line">   [*] Ext4 POSIX Access Control Lists &gt;</div>
<div class="line">   [*] Ext4 Security Labels &gt;</div>
</div><!-- fragment --></li>
</ul>
<h3><a class="anchor" id="dsub_guide_sd_card_format_mount"></a>
10.4.2 Mount an SD Card</h3>
<p >The CV5x / CV7x board recognizes the SD card after the card is inserted into the SD card slot, and it is automatically mounted to <code>/sdcard/***</code>. Enter "mount" on the CV5x / CV7x board to see the mounting information.</p>
<div class="fragment"><div class="line">board # mount</div>
<div class="line">/dev/mmcblk1p1 on /sdcard/mmcblk1p1 type vfat</div>
<div class="line">(rw,noatime,nodiratime,gid=100,fmask=0022,dmask=0000,allow_utime=0022,</div>
<div class="line">codepage=437,iocharset=iso8859-1,shortname=mixed,utf8,flush,errors=remount-ro)</div>
</div><!-- fragment --><h3><a class="anchor" id="dsub_guide_sd_card_format_unmount"></a>
10.4.3 Unmount an SD Card</h3>
<p >Before removing the SD card, close all files, and then unmount the SD card (see the following). </p><div class="fragment"><div class="line">board # cd /</div>
<div class="line">board # umount /dev/mmcblk1p1</div>
</div><!-- fragment --><p >If the message "Device or resource busy" appears, ensure that all files on the SD card are closed and <code>/mnt/sdcard</code> is not being accessed (type "cd /" to go to the root directory).</p>
<h3><a class="anchor" id="dsub_guide_sd_card_format_format"></a>
10.4.4 Format an SD Card</h3>
<ol type="1">
<li><p class="startli">Format an SD card.<br  />
 Although the SD card may come pre-formatted, Ambarella recommends formatting the card manually to avoid potential errors and to maximize the performance.</p>
<p class="startli">The SD card can be formatted to FAT32, NTFS, ext3, and other file systems. For SD cards equal to or less than 32 GB, Ambarella recommends FAT32. For SD cards greater than 32 GB, NTFS is preferred, as Windows limits FAT32 partitions to 32 GB.</p>
<p class="startli">Windows 7 also supports exFAT, but exFAT is not formally supported by the Linux kernel. Ext3 is supported by Linux to support big SDHC (or SDXC) cards, but Windows does not recognize ext3.</p>
<p class="startli">There are three main options to format the SD cards to the required format. To successfully format an SD card, the write protection lock on the side of the card must be in the "unlock" position. SD mini and micro SD cards must be used with an adapter or specialized USB card reader when a computer is formatting them.</p>
</li>
<li><p class="startli">Use a format utility.<br  />
 Most computer systems include generic formatting utilities for nearly every format of writable media. For example, in Windows OS, users can access the format option by right-clicking an "SD card" driver in the "My Computer" folder. Use the default settings to format the SD card.</p>
<p class="startli">The SD Association SD Formatter is the recommended option for the Windows OS platform. The SD Formatter is recommended because the generic format utilities are not designed to format the SD cards to their official SD memory format requirements that enable them to run on devices at their optimum performance. The SD formatter offered by the SD Association is free and can be found at SDcard.org: <a href="https://www.sdcard.org/downloads/formatter_3/">https://www.sdcard.org/downloads/formatter_3/</a>.</p>
</li>
<li><p class="startli">The tool mkdosfs is included in the Cooper Linux SDK.<br  />
 The tool mkdosfs can format an SD card to the FAT32 format. It is used to create a disk operating system (DOS) file system under Linux. </p><div class="fragment"><div class="line">board # umount /dev/mmcblk1p1 (Unmount the SD card first)</div>
<div class="line">board # mkdosfs -v -n LOCAL /dev/mmcblk1p1</div>
<div class="line">board # mount /dev/mmcblk1p1 /tmp/mmcblk1p1</div>
</div><!-- fragment --><p class="startli">If users intend to use an SD card as common data storage, they must format the card in their products (under Linux) using mkdosfs to ensure the optimal performance. An SD card formatted by a different tool on Windows can potentially result in lower performance.</p>
</li>
<li><p class="startli">Check file system integrity.<br  />
 The tool fsck is used to check and repair the MS-DOS file system. </p><div class="fragment"><div class="line">board # fsck /dev/mmcblk1p1</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>If the SD card is removed before unmounting, users must check the integrity of the file system again before using the card. Removing the SD card before unmounting can cause inconsistent data storage and reduce the integrity of the file system. To avoid this potential issue, good product design should include unmounting the SD card before removing. Alternatively, it should call the power-off command to enable the system to close all open files and flush the data to synchronize, and then unmount.</dd></dl>
</li>
<li><p class="startli">Partition an SD card.<br  />
 Occasionally, users must partition the SD card. For example, if a user must format a 64-GB secure digital extended capacity (SDXC) card to the FAT32 file system, note the following: because Windows limits FAT32 to 32 GB, multiple partitions are required. However, only the first partition can be seen on Windows, while Linux can display all partitions.</p>
<p class="startli">Gparted is a software utility which scans a storage device. It examines the data in order to detect partitions which may exist, but are absent from the disk's partition tables. For more details, go to <a href="http://gparted.sourceforge.net/">http://gparted.sourceforge.net/</a>.</p>
<dl class="section note"><dt>Note</dt><dd>If users must access all partitions in Windows, Ambarella does not recommend using the Linux tool to partition. As an alternative, users can attempt to port exFAT to Linux or use NTFS on the SD card to support large partitions that can be recognized on Windows.</dd></dl>
<hr  />
</li>
</ol>
<h1><a class="anchor" id="getting_guide_license"></a>
11. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ( "Software" ) are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
