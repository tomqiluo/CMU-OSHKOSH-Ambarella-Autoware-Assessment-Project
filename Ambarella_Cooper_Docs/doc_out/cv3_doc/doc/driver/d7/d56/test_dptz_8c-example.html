<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driver: test_dptz.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Driver"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Driver<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d56/test_dptz_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test_dptz.c</div></div>
</div><!--header-->
<div class="contents">
<p >This is an example of how to configure dptz of a stream.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * test_dptz.c</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *    2010/2/20 - [Louis Sun] created file</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2016 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents ( &quot;Software&quot; ) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/ddc/basetypes_8h.html">basetypes.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iav_ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../video/d0/d68/test__dptz_8h.html">test_dptz.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef AM_IOCTL</span></div>
<div class="line"><span class="preprocessor">#define AM_IOCTL(_filp, _cmd, _arg) \</span></div>
<div class="line"><span class="preprocessor">        do {                        \</span></div>
<div class="line"><span class="preprocessor">            if (ioctl(_filp, _cmd, _arg) &lt; 0) { \</span></div>
<div class="line"><span class="preprocessor">                perror(#_cmd);      \</span></div>
<div class="line"><span class="preprocessor">                return -1;          \</span></div>
<div class="line"><span class="preprocessor">            }                       \</span></div>
<div class="line"><span class="preprocessor">        } while (0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_SOURCE_BUFFER_NUM   (7)</span></div>
<div class="line"><span class="preprocessor">#define MIN_PAN_TILT_STEP           (8)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_DZ_TYPE_I_ZOOM      (8)</span></div>
<div class="line"><span class="preprocessor">#define ZOOM_FACTOR_Y               (4 &lt;&lt; 16)</span></div>
<div class="line"><span class="preprocessor">#define OFFSET_Y_MARGIN         (4)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// the device file handle</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a0" name="a0"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> current_source = -1; <span class="comment">// -1 is a invalid source buffer, for initialize data only</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> channel_id = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> pass_id = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// digital zoom type II format</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>dptz_format_s {</div>
<div class="line">    <span class="keywordtype">int</span> dz_numer;</div>
<div class="line">    <span class="keywordtype">int</span> dz_denom;</div>
<div class="line">    <span class="keywordtype">int</span> dz_times_flag;</div>
<div class="line">    <span class="keywordtype">int</span> width;</div>
<div class="line">    <span class="keywordtype">int</span> height;</div>
<div class="line">    <span class="keywordtype">int</span> resolution_flag;</div>
<div class="line">    <span class="keywordtype">int</span> offset_x;</div>
<div class="line">    <span class="keywordtype">int</span> offset_y;</div>
<div class="line">    <span class="keywordtype">int</span> offset_flag;</div>
<div class="line">} dptz_format_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> dptz_format_t dptz_format[<a id="a1" name="a1"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d7/dfa/buffer__cfg_8c.html#a690bd99c08bdec34878124b873b91751">MAX_SOURCE_BUFFER_NUM</a>];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> dptz_format_change_id = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//auto run zoom demo</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> autorun_zoom_I_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> autorun_zoom_II_flag = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// digital pan format</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>pan_tilt_format_s {</div>
<div class="line">    <span class="keywordtype">int</span> offset_start_x;</div>
<div class="line">    <span class="keywordtype">int</span> offset_start_y;</div>
<div class="line">    <span class="keywordtype">int</span> offset_end_x;</div>
<div class="line">    <span class="keywordtype">int</span> offset_end_y;</div>
<div class="line">} pan_tilt_format_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> pan_tilt_format_t pt_format[<a class="code hl_defineRef" target="_blank" href="../../../video/d7/dfa/buffer__cfg_8c.html#a690bd99c08bdec34878124b873b91751">MAX_SOURCE_BUFFER_NUM</a>];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> pan_format_change_id = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//auto run pan tilt demo</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> pan_tilt_step = MIN_PAN_TILT_STEP;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> autorun_pan_I_flag = 0;</div>
<div class="line"><span class="comment">//static int autorun_pan_II_flag = 0;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a id="a2" name="a2"></a>usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    printf(<span class="stringliteral">&quot;test_dptz usage:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(<a id="a3" name="a3"></a>long_options) / <span class="keyword">sizeof</span>(long_options[0]) - 1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (isalpha(long_options[i].val))</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c &quot;</span>, long_options[i].val);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;--%s&quot;</span>, long_options[i].<a id="a4" name="a4"></a>name);</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a5" name="a5"></a>hint[i].arg[0] != 0)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [%s]&quot;</span>, hint[i].arg);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, hint[i].str);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nExamples:\n  Type I:\n    test_dptz -X -d 2 -o 100x100\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;    test_dptz -X -d 1 -m 0~600 -n 0~400 -p\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n  Type II:\n    test_dptz -Y -s 720x480 -o 100x200\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n  Type II:\n    test_dptz -Y -d 1 -o 100x200\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n  Type II:\n    test_dptz -Y -d 1/2\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nNote:\n  Multiple channel / pass configuration cannot type in single command line.&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// first and second values must be in format of &quot;AxB&quot;</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_two_values(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> *first, <span class="keywordtype">int</span> *second, <span class="keywordtype">char</span> delimiter)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> tmp_string[16];</div>
<div class="line">    <span class="keywordtype">char</span> * separator;</div>
<div class="line"> </div>
<div class="line">    separator = strchr(name, delimiter);</div>
<div class="line">    <span class="keywordflow">if</span> (!separator) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;two values should be like A%cB .\n&quot;</span>, delimiter);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    strncpy(tmp_string, name, separator - name);</div>
<div class="line">    tmp_string[separator - <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">    *first = atoi(tmp_string);</div>
<div class="line">    strncpy(tmp_string, separator + 1,  name + strlen(name) - separator);</div>
<div class="line">    *second = atoi(tmp_string);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  printf(&quot;input string [%s], first value %d, second value %d.\n&quot;, name, *first, *second);</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// first and second values must be in format of &quot;AxB&quot;</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_two_zoomfactor(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> *first, <span class="keywordtype">int</span> *second, <span class="keywordtype">char</span> delimiter)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> tmp_string[16];</div>
<div class="line">    <span class="keywordtype">char</span> * separator;</div>
<div class="line"> </div>
<div class="line">    separator = strchr(name, delimiter);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (separator) {</div>
<div class="line">        strncpy(tmp_string, name, separator - name);</div>
<div class="line">        tmp_string[separator - <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">        *first = atoi(tmp_string);</div>
<div class="line">        strncpy(tmp_string, separator + 1,  name + strlen(name) - separator);</div>
<div class="line">        *second = atoi(tmp_string);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        *first = atoi(name);</div>
<div class="line">        *second = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_channel_num(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a6" name="_a6"></a><a class="code hl_structRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a> resource;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;resource, 0, <span class="keyword">sizeof</span>(resource));</div>
<div class="line">    resource.encode_mode = <a id="a7" name="a7"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a>;</div>
<div class="line">    <a id="a8" name="a8"></a><a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a9" name="a9"></a>IAV_IOC_GET_SYSTEM_RESOURCE, &amp;resource);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> resource.chan_num;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_BUFFERID(x)      do {        \</span></div>
<div class="line"><span class="preprocessor">            if ((x) &lt; 0 || ((x) &gt;= MAX_SOURCE_BUFFER_NUM)) {    \</span></div>
<div class="line"><span class="preprocessor">                printf(&quot;Wrong buffer id %d.\n&quot;</span>, (x));       \</div>
<div class="line">                return -1;  \</div>
<div class="line">            }       \</div>
<div class="line">        } while (0)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_SUB_BUFFERID(x)      do {        \</span></div>
<div class="line"><span class="preprocessor">            if ((x) &lt; 1 || ((x) &gt;= MAX_SOURCE_BUFFER_NUM)) {    \</span></div>
<div class="line"><span class="preprocessor">                printf(&quot;Wrong sub buffer id %d.\n&quot;</span>, (x));       \</div>
<div class="line">                return -1;  \</div>
<div class="line">            }       \</div>
<div class="line">        } while (0)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> channel_num = 0;</div>
<div class="line"><span class="preprocessor">#define VERIFY_CHANNELID(x)   do {      \</span></div>
<div class="line"><span class="preprocessor">            if (((x) &lt; 0) || ((x) &gt;= channel_num)) {    \</span></div>
<div class="line"><span class="preprocessor">                printf (&quot;channel id wrong %d \n&quot;</span>, (x));         \</div>
<div class="line">                return -1;  \</div>
<div class="line">            }       \</div>
<div class="line">        } while (0)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_PASSID(x)   do {     \</span></div>
<div class="line"><span class="preprocessor">            if (((x) &lt; 0) || ((x) &gt;= IAV_MAX_PASS_NUM)) {   \</span></div>
<div class="line"><span class="preprocessor">                printf (&quot;pass id wrong %d \n&quot;</span>, (x));            \</div>
<div class="line">                return -1;  \</div>
<div class="line">            }       \</div>
<div class="line">        } while (0)</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> init_param(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ch;</div>
<div class="line">    <span class="keywordtype">int</span> option_index = 0;</div>
<div class="line">    <span class="keywordtype">int</span> first, second;</div>
<div class="line">    opterr = 0;</div>
<div class="line">    <span class="keywordflow">while</span> ((ch = getopt_long(argc, argv, <a id="a10" name="a10"></a>short_options, long_options, &amp;option_index)) != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line">        <span class="comment">// parameters for DPTZ type I</span></div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:</div>
<div class="line">            current_source = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line">            <a id="a11" name="a11"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d7/dfa/buffer__cfg_8c.html#af2f1ff77b9727caa10da1944a50c3b5b">VERIFY_BUFFERID</a>(current_source);</div>
<div class="line">            <span class="keywordflow">if</span> (get_two_zoomfactor(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;/&#39;</span>) &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            <span class="keywordflow">if</span> (!second) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;the divider value can not be %d\n&quot;</span>, second);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (dptz_format[current_source].resolution_flag) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Cannot run \&quot;-d\&quot; and \&quot;-s\&quot; together for buf [%d]!\n&quot;</span>,</div>
<div class="line">                    current_source);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            dptz_format[current_source].dz_numer = first;</div>
<div class="line">            dptz_format[current_source].dz_denom = second;</div>
<div class="line">            dptz_format[current_source].dz_times_flag = 1;</div>
<div class="line">            dptz_format_change_id |= (1 &lt;&lt; current_source);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div>
<div class="line">            <span class="keywordflow">if</span> (get_two_values(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;~&#39;</span>) &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            pt_format[0].offset_start_x = first;</div>
<div class="line">            pt_format[0].offset_end_x = second;</div>
<div class="line">            pan_format_change_id |= (1 &lt;&lt; 0);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line">            <span class="keywordflow">if</span> (get_two_values(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;~&#39;</span>) &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            pt_format[0].offset_start_y = first;</div>
<div class="line">            pt_format[0].offset_end_y = second;</div>
<div class="line">            pan_format_change_id |= (1 &lt;&lt; 0);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div>
<div class="line">            autorun_pan_I_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line">            pan_tilt_step = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line">            autorun_zoom_I_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// parameters for DPTZ type II</span></div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>:</div>
<div class="line">            current_source = atoi(optarg);</div>
<div class="line">            VERIFY_SUB_BUFFERID(current_source);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;Y&#39;</span>:</div>
<div class="line">            current_source = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;J&#39;</span>:</div>
<div class="line">            current_source = 2;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;K&#39;</span>:</div>
<div class="line">            current_source = 3;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>:</div>
<div class="line">            current_source = 4;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:</div>
<div class="line">            current_source = 5;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div>
<div class="line">            current_source = 6;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d7/dfa/buffer__cfg_8c.html#af2f1ff77b9727caa10da1944a50c3b5b">VERIFY_BUFFERID</a>(current_source);</div>
<div class="line">            <span class="keywordflow">if</span> (dptz_format[current_source].dz_times_flag) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Cannot run \&quot;-d\&quot; and \&quot;-s\&quot; together for buf [%d]!\n&quot;</span>,</div>
<div class="line">                    current_source);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (get_two_values(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            dptz_format[current_source].width = first;</div>
<div class="line">            dptz_format[current_source].height = second;</div>
<div class="line">            dptz_format[current_source].resolution_flag = 1;</div>
<div class="line">            dptz_format_change_id |= (1 &lt;&lt; current_source);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d7/dfa/buffer__cfg_8c.html#af2f1ff77b9727caa10da1944a50c3b5b">VERIFY_BUFFERID</a>(current_source);</div>
<div class="line">            <span class="keywordflow">if</span> (get_two_values(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            dptz_format[current_source].offset_x = first;</div>
<div class="line">            dptz_format[current_source].offset_y = second;</div>
<div class="line">            dptz_format[current_source].offset_flag = 1;</div>
<div class="line">            dptz_format_change_id |= (1 &lt;&lt; current_source);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:</div>
<div class="line">            VERIFY_SUB_BUFFERID(current_source);</div>
<div class="line">            autorun_zoom_II_flag = current_source;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div>
<div class="line">            channel_id = atoi(optarg);</div>
<div class="line">            channel_num = get_channel_num();</div>
<div class="line">            VERIFY_CHANNELID(channel_id);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;P&#39;</span>:</div>
<div class="line">            pass_id = atoi(optarg);</div>
<div class="line">            VERIFY_PASSID(pass_id);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            printf(<span class="stringliteral">&quot;unknown command %s \n&quot;</span>, optarg);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a id="a12" name="a12"></a>channel_to_vsrc(<span class="keywordtype">int</span> fd_iav, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> channel_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a13" name="_a13"></a><a class="code hl_structRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> chan_cfg;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a id="a14" name="a14"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a>;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;chan_cfg, 0, <span class="keyword">sizeof</span>(chan_cfg));</div>
<div class="line">    chan_cfg.chan_id = channel_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a15" name="a15"></a>IAV_IOC_GET_CHAN_CONFIG, &amp;chan_cfg);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a> = chan_cfg.vsrc_id;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> digital_ptz_for_main_buffer(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a16" name="_a16"></a><a class="code hl_structRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a> vproc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> chan_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a17" name="_a17"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a> *dptz;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a18" name="_a18"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html">iav_apply_flag</a> apply_flag[<a id="a19" name="a19"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba46e4f3917edf4f2122f0987ab3769611">IAV_VIDEO_PROC_NUM</a>] = {0};</div>
<div class="line">    <span class="keywordtype">int</span> cap_w, cap_h, numer, denom;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;vproc, 0, <span class="keyword">sizeof</span>(vproc));</div>
<div class="line">    vproc.<a id="a20" name="a20"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#af9eae96af4a33e97e8805e61bf4ef9b6">cid</a> = <a id="a21" name="a21"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">    dptz = &amp;vproc.<a id="a22" name="a22"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a id="a23" name="a23"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>;</div>
<div class="line">    dptz-&gt;<a id="a24" name="a24"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = channel_id;</div>
<div class="line">    dptz-&gt;<a id="a25" name="a25"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = <a id="a26" name="a26"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (pass_id) {</div>
<div class="line">        pass_id = 0;</div>
<div class="line">        printf(<span class="stringliteral">&quot;There is no main buffer for the second passes. Change to the first.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    dptz-&gt;<a id="a27" name="a27"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = 0;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a28" name="a28"></a>IAV_IOC_GET_VIDEO_PROC, &amp;vproc);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;chan_cfg, 0, <span class="keyword">sizeof</span>(chan_cfg));</div>
<div class="line">    chan_cfg.<a id="a29" name="a29"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a85599fa0eac7165aaca13aa21f0e6b38">chan_id</a> = 0;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_CHAN_CONFIG, &amp;chan_cfg);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dptz_format[0].dz_times_flag) {</div>
<div class="line">        numer = dptz_format[0].dz_numer;</div>
<div class="line">        denom = dptz_format[0].dz_denom;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (numer == 0) {</div>
<div class="line">            cap_w = chan_cfg.<a id="a30" name="a30"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a7c027495a88c7b1c65a836ed23d80588">raw_width</a>;</div>
<div class="line">            cap_h = chan_cfg.<a id="a31" name="a31"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a2b2ffdba3c57a07941aca4272b6a5012">raw_height</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (chan_cfg.<a id="a32" name="a32"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a869a030ae5c3e249d6f9b4d5d8bba5a7">rotate_cw</a>) {</div>
<div class="line">                <span class="comment">// set zoom limit before rotate.</span></div>
<div class="line">                cap_w = dptz-&gt;<a id="a33" name="a33"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a id="a34" name="a34"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a id="a35" name="a35"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> * denom / numer;</div>
<div class="line">                cap_h = dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a id="a36" name="a36"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> * denom / numer;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                cap_w = dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> * denom / numer;</div>
<div class="line">                cap_h = dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> * denom / numer;</div>
<div class="line">            }</div>
<div class="line">            cap_w = <a id="a37" name="a37"></a><a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(cap_w, <a id="a38" name="a38"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3e17c129dab35cc82888d7c875026175">IAV_MAINBUF_INPUT_WIDTH_ALIGN</a>);</div>
<div class="line">            cap_h = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(cap_h, <a id="a39" name="a39"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a2316f519fb738acc54e5ea62dbbe0f45">IAV_MAINBUF_INPUT_HEIGHT_ALIGN</a>);</div>
<div class="line">        }</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a id="a40" name="a40"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = cap_w;</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = cap_h;</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a id="a41" name="a41"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = <a id="a42" name="a42"></a><a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>((dptz_format[0].offset_flag ?</div>
<div class="line">            dptz_format[0].offset_x : (chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a7c027495a88c7b1c65a836ed23d80588">raw_width</a> - cap_w) / 2), <a id="a43" name="a43"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a>);</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a id="a44" name="a44"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>((dptz_format[0].offset_flag ?</div>
<div class="line">            dptz_format[0].offset_y : (chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a2b2ffdba3c57a07941aca4272b6a5012">raw_height</a> - cap_h) / 2), <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a>);</div>
<div class="line"> </div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dptz_format[0].resolution_flag) {</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(dptz_format[0].width, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3e17c129dab35cc82888d7c875026175">IAV_MAINBUF_INPUT_WIDTH_ALIGN</a>);</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(dptz_format[0].height, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a2316f519fb738acc54e5ea62dbbe0f45">IAV_MAINBUF_INPUT_HEIGHT_ALIGN</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dptz_format[0].offset_flag) {</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(dptz_format[0].offset_x, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a>);</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(dptz_format[0].offset_y, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;DPTZ Type I: Zoom Window: %dx%d, Offset: %dx%d, Rotate: %d.\n&quot;</span>,</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>, dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>,</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>, dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>, chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a869a030ae5c3e249d6f9b4d5d8bba5a7">rotate_cw</a>);</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a45" name="a45"></a>IAV_IOC_CFG_VIDEO_PROC, &amp;vproc);</div>
<div class="line"> </div>
<div class="line">    apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a id="a46" name="a46"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a39c9d823b4c2cd92030678332c1d6eab">param</a> = (1 &lt;&lt; channel_id);</div>
<div class="line">    apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a id="a47" name="a47"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a470ee650e3e8257158a2424a7f94790f">apply</a> = 1;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a48" name="a48"></a>IAV_IOC_APPLY_VIDEO_PROC, apply_flag);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> digital_ptz_for_preview_buffer(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a> vproc_mn, vproc_pv;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a> *dptz_mn, *dptz_pv;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a49" name="_a49"></a><a class="code hl_structRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html">iav_buf_cfg</a> *cfg_mn, *cfg_pv;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html">iav_apply_flag</a> apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba46e4f3917edf4f2122f0987ab3769611">IAV_VIDEO_PROC_NUM</a>] = {0};</div>
<div class="line">    <span class="keywordtype">int</span> i, numer, denom;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;vproc_mn, 0, <span class="keyword">sizeof</span>(vproc_mn));</div>
<div class="line">    vproc_mn.cid = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">    dptz_mn = &amp;vproc_mn.arg.dptz;</div>
<div class="line">    dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = channel_id;</div>
<div class="line">    dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a>;</div>
<div class="line">    dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = pass_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_VIDEO_PROC, &amp;vproc_mn);</div>
<div class="line"> </div>
<div class="line">    cfg_mn = &amp;dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code hl_defineRef" target="_blank" href="../../../video/d7/dfa/buffer__cfg_8c.html#a690bd99c08bdec34878124b873b91751">MAX_SOURCE_BUFFER_NUM</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (dptz_format_change_id &amp; (1 &lt;&lt; i)) {</div>
<div class="line">            memset(&amp;vproc_pv, 0, <span class="keyword">sizeof</span>(vproc_pv));</div>
<div class="line">            vproc_pv.cid = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">            dptz_pv = &amp;vproc_pv.arg.dptz;</div>
<div class="line">            dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = channel_id;</div>
<div class="line">            dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = i;</div>
<div class="line">            dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = pass_id;</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_VIDEO_PROC, &amp;vproc_pv);</div>
<div class="line"> </div>
<div class="line">            cfg_pv = &amp;dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (dptz_format[i].dz_times_flag) {</div>
<div class="line">                numer = dptz_format[i].dz_numer;</div>
<div class="line">                denom = dptz_format[i].dz_denom;</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = numer ?</div>
<div class="line">                    <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> * denom / numer, 2) :</div>
<div class="line">                    cfg_mn-&gt;output.width;</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = numer ?</div>
<div class="line">                    <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> * denom / numer, 4) :</div>
<div class="line">                    cfg_mn-&gt;output.height;</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dptz_format[i].resolution_flag) {</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = dptz_format[i].width;</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = dptz_format[i].height;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (dptz_format[i].offset_flag) {</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = dptz_format[i].offset_x;</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = dptz_format[i].offset_y;</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> &gt;= cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a></div>
<div class="line">                &amp;&amp; cfg_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> &gt;= cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>) {</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>((cfg_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> -</div>
<div class="line">                    cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>) / 2, 2);</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>((cfg_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> -</div>
<div class="line">                    cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>) / 2, 4);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            printf(<span class="stringliteral">&quot;DPTZ Type II: Zoom Window: %dx%d, Offset: %dx%d.&quot;</span>,</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>, cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>,</div>
<div class="line">                cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>, cfg_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_CFG_VIDEO_PROC, &amp;vproc_pv);</div>
<div class="line"> </div>
<div class="line">            apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a39c9d823b4c2cd92030678332c1d6eab">param</a> = (1 &lt;&lt; channel_id);</div>
<div class="line">            apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a470ee650e3e8257158a2424a7f94790f">apply</a> = 1;</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_APPLY_VIDEO_PROC, apply_flag);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_pan_tilt_param(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a> vproc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> chan_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a> *dptz;</div>
<div class="line">    <span class="keywordtype">int</span> max_offset_x, max_offset_y, cap_w, cap_h, adjust = 0, zoom_y;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;vproc, 0, <span class="keyword">sizeof</span>(vproc));</div>
<div class="line">    vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#af9eae96af4a33e97e8805e61bf4ef9b6">cid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">    dptz = &amp;vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>;</div>
<div class="line">    dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a>;</div>
<div class="line">    dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a>;</div>
<div class="line">    dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_VIDEO_PROC, &amp;vproc);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;chan_cfg, 0, <span class="keyword">sizeof</span>(chan_cfg));</div>
<div class="line">    chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a85599fa0eac7165aaca13aa21f0e6b38">chan_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_CHAN_CONFIG, &amp;chan_cfg);</div>
<div class="line"> </div>
<div class="line">    cap_w = dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">    cap_h = dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    max_offset_x = chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a7c027495a88c7b1c65a836ed23d80588">raw_width</a> - cap_w;</div>
<div class="line">    max_offset_y = chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a2b2ffdba3c57a07941aca4272b6a5012">raw_height</a> - cap_h;</div>
<div class="line">    zoom_y = (dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> &lt;&lt; 16) / dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    if (zoom_y &gt;= ZOOM_FACTOR_Y) {</div>
<div class="line">        max_offset_y -= OFFSET_Y_MARGIN;</div>
<div class="line">        <span class="keywordflow">if</span> (pt_format[0].offset_start_y &lt; OFFSET_Y_MARGIN) {</div>
<div class="line">            pt_format[0].offset_start_y = OFFSET_Y_MARGIN;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (pt_format[0].offset_start_x &lt; 0) {</div>
<div class="line">        adjust = 1;</div>
<div class="line">        pt_format[0].offset_start_x = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (pt_format[0].offset_end_x &lt; 0) {</div>
<div class="line">        adjust = 1;</div>
<div class="line">        pt_format[0].offset_end_x = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (pt_format[0].offset_end_x &gt; max_offset_x) {</div>
<div class="line">        adjust = 1;</div>
<div class="line">        pt_format[0].offset_end_x = max_offset_x;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (pt_format[0].offset_start_x &gt; pt_format[0].offset_end_x) {</div>
<div class="line">        adjust = 1;</div>
<div class="line">        pt_format[0].offset_start_x = pt_format[0].offset_end_x;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (pt_format[0].offset_start_y &lt; 0) {</div>
<div class="line">        adjust = 1;</div>
<div class="line">        pt_format[0].offset_start_y = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (pt_format[0].offset_end_y &lt; 0) {</div>
<div class="line">        adjust = 1;</div>
<div class="line">        pt_format[0].offset_end_y = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (pt_format[0].offset_end_y &gt; max_offset_y) {</div>
<div class="line">        adjust = 1;</div>
<div class="line">        pt_format[0].offset_end_y = max_offset_y;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (pt_format[0].offset_start_y &gt; pt_format[0].offset_end_y) {</div>
<div class="line">        adjust = 1;</div>
<div class="line">        pt_format[0].offset_start_y = pt_format[0].offset_end_y;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (pan_tilt_step &lt; MIN_PAN_TILT_STEP) {</div>
<div class="line">        pan_tilt_step = MIN_PAN_TILT_STEP;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (adjust) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Adjust auto pan tilt param: center offset x range (%d, %d),&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot; center offset y range (%d, %d).\n&quot;</span>,</div>
<div class="line">            pt_format[0].offset_start_x, pt_format[0].offset_end_x,</div>
<div class="line">            pt_format[0].offset_start_y, pt_format[0].offset_end_y);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> auto_pan_tilt_for_main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a> vproc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a> *dptz;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html">iav_apply_flag</a> apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba46e4f3917edf4f2122f0987ab3769611">IAV_VIDEO_PROC_NUM</a>] = {0};</div>
<div class="line">    <span class="keywordtype">int</span> x, y, dx, dy;</div>
<div class="line">    <span class="keywordtype">int</span> dir, time;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;vproc, 0, <span class="keyword">sizeof</span>(vproc));</div>
<div class="line">    vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#af9eae96af4a33e97e8805e61bf4ef9b6">cid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">    dptz = &amp;vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>;</div>
<div class="line">    dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = channel_id;</div>
<div class="line">    dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a>;</div>
<div class="line">    dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = pass_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_VIDEO_PROC, &amp;vproc);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (check_pan_tilt_param() &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to do auto pan / tilt for DPTZ type I!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    dx = (pt_format[0].offset_end_x - pt_format[0].offset_start_x) / pan_tilt_step;</div>
<div class="line">    dy = (pt_format[0].offset_end_y - pt_format[0].offset_start_y) / pan_tilt_step * 2;</div>
<div class="line">    x = pt_format[0].offset_start_x;</div>
<div class="line">    y = pt_format[0].offset_start_y;</div>
<div class="line">    dir = 1;</div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(x, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a>);</div>
<div class="line">        dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(y, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a>);</div>
<div class="line"><span class="comment">//      printf(&quot;+++++++++++++++++++ center offset : %dx%d ==&gt; %d x %d.\n&quot;, x, y,</span></div>
<div class="line"><span class="comment">//          digital_zoom.center_offset_x, digital_zoom.center_offset_y);</span></div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_CFG_VIDEO_PROC, &amp;vproc);</div>
<div class="line">        apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a39c9d823b4c2cd92030678332c1d6eab">param</a> = (1 &lt;&lt; channel_id);</div>
<div class="line">        apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a470ee650e3e8257158a2424a7f94790f">apply</a> = 1;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_APPLY_VIDEO_PROC, apply_flag);</div>
<div class="line"> </div>
<div class="line">        time = 200 * 1000;</div>
<div class="line">        x += dir * dx;</div>
<div class="line">        <span class="keywordflow">if</span> (x &gt; pt_format[0].offset_end_x) {</div>
<div class="line">            x = pt_format[0].offset_end_x;</div>
<div class="line">            dir = -1;</div>
<div class="line">            y += dy;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (x &lt; pt_format[0].offset_start_x) {</div>
<div class="line">            x = pt_format[0].offset_start_x;</div>
<div class="line">            dir = 1;</div>
<div class="line">            y += dy;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (y &gt; pt_format[0].offset_end_y) {</div>
<div class="line">            x = pt_format[0].offset_start_x;</div>
<div class="line">            y = pt_format[0].offset_start_y;</div>
<div class="line">            dir = 1;</div>
<div class="line">        }</div>
<div class="line">        usleep(time);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> auto_zoom_for_main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a> vproc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> chan_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a> *dptz;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html">iav_apply_flag</a> apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba46e4f3917edf4f2122f0987ab3769611">IAV_VIDEO_PROC_NUM</a>] = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a50" name="_a50"></a><a class="code hl_structRef" target="_blank" href="../../../library/d5/d5f/structiav__enc__buf__cap.html">iav_enc_buf_cap</a> cap_buf;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a> resource_setup;</div>
<div class="line">    <span class="comment">//multi step zoom from 1X to 10X and then back to 1X,  in multi steps</span></div>
<div class="line">    <span class="keywordtype">int</span> zoom_factor;</div>
<div class="line">    <span class="keywordtype">int</span> i, min_w, min_h, max_w, max_h, round_w, round_x;</div>
<div class="line">    <span class="keywordtype">int</span> align_size, align_offset;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> vin_w, vin_h;</div>
<div class="line">    <span class="keywordtype">int</span> cap_w, cap_h;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;vproc, 0, <span class="keyword">sizeof</span>(vproc));</div>
<div class="line">    vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#af9eae96af4a33e97e8805e61bf4ef9b6">cid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">    dptz = &amp;vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>;</div>
<div class="line">    dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = channel_id;</div>
<div class="line">    dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a>;</div>
<div class="line">    dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = pass_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_VIDEO_PROC, &amp;vproc);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;chan_cfg, 0, <span class="keyword">sizeof</span>(chan_cfg));</div>
<div class="line">    chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a85599fa0eac7165aaca13aa21f0e6b38">chan_id</a> = channel_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_CHAN_CONFIG, &amp;chan_cfg);</div>
<div class="line">    vin_w = chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a7c027495a88c7b1c65a836ed23d80588">raw_width</a>;</div>
<div class="line">    vin_h = chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a2b2ffdba3c57a07941aca4272b6a5012">raw_height</a>;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;cap_buf, 0, <span class="keyword">sizeof</span>(cap_buf));</div>
<div class="line">    cap_buf.pass_id = 0;</div>
<div class="line">    cap_buf.buf_id = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a51" name="a51"></a>IAV_IOC_QUERY_ENC_BUF_CAP, &amp;cap_buf);</div>
<div class="line"> </div>
<div class="line">    resource_setup.encode_mode = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_SYSTEM_RESOURCE, &amp;resource_setup);</div>
<div class="line">    align_size = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3e17c129dab35cc82888d7c875026175">IAV_MAINBUF_INPUT_WIDTH_ALIGN</a>;</div>
<div class="line">    align_offset = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a>;</div>
<div class="line"> </div>
<div class="line">    min_w = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> /</div>
<div class="line">        cap_buf.max_zoom_out_factor, align_size);</div>
<div class="line">    max_w = <a id="a52" name="a52"></a><a class="code hl_define" href="../../dummy.html">MIN</a>(<a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> *</div>
<div class="line">        cap_buf.max_zoom_in_factor, align_size), vin_w);</div>
<div class="line"> </div>
<div class="line">    min_h = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> /</div>
<div class="line">        cap_buf.max_zoom_out_factor, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a2316f519fb738acc54e5ea62dbbe0f45">IAV_MAINBUF_INPUT_HEIGHT_ALIGN</a>);</div>
<div class="line">    max_h = <a class="code hl_define" href="../../dummy.html">MIN</a>(<a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> *</div>
<div class="line">        cap_buf.max_zoom_in_factor, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a2316f519fb738acc54e5ea62dbbe0f45">IAV_MAINBUF_INPUT_HEIGHT_ALIGN</a>),  vin_h);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt;= (cap_buf.max_zoom_in_factor - 1) * 40; i++) {</div>
<div class="line">        zoom_factor = 65536 + 65536 * i / 40;</div>
<div class="line">        cap_w = (dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> &lt;&lt; 16) / zoom_factor;</div>
<div class="line">        cap_h = (dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> &lt;&lt; 16) / zoom_factor;</div>
<div class="line">        <span class="keywordflow">if</span> (cap_w &gt; min_w &amp;&amp; cap_h &gt; min_h &amp;&amp; cap_w &lt; max_w &amp;&amp; cap_h &lt; max_h) {</div>
<div class="line">            round_w = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(cap_w, align_size);</div>
<div class="line">            round_x = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>((vin_w - round_w) / 2, align_offset);</div>
<div class="line">            <span class="keywordflow">if</span> (round_w == dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> ||</div>
<div class="line">                round_x == dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>) {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = round_w;</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = round_x;</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(cap_h, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a2316f519fb738acc54e5ea62dbbe0f45">IAV_MAINBUF_INPUT_HEIGHT_ALIGN</a>);</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> =</div>
<div class="line">                <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>((vin_h - dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>) / 2, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a>);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_CFG_VIDEO_PROC, &amp;vproc);</div>
<div class="line">            apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a39c9d823b4c2cd92030678332c1d6eab">param</a> = (1 &lt;&lt; channel_id);</div>
<div class="line">            apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a470ee650e3e8257158a2424a7f94790f">apply</a> = 1;</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_APPLY_VIDEO_PROC, apply_flag);</div>
<div class="line">            usleep(1000 * 33);  <span class="comment">//zoom at about 1 fps</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = (cap_buf.max_zoom_out_factor - 1) * 40; i &gt;= 0; i--) {</div>
<div class="line">        zoom_factor = 65536 + 65536 * i / 40;</div>
<div class="line">        cap_w = (dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> &lt;&lt; 16) / zoom_factor;</div>
<div class="line">        cap_h = (dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> &lt;&lt; 16) / zoom_factor;</div>
<div class="line">        <span class="keywordflow">if</span> (cap_w &lt; max_w &amp;&amp; cap_h &lt; max_h &amp;&amp; cap_w &gt; min_w &amp;&amp; cap_h &gt; min_h) {</div>
<div class="line">            round_w = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(cap_w, align_size);</div>
<div class="line">            round_x = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>((vin_w - round_w) / 2, align_offset);</div>
<div class="line">            <span class="keywordflow">if</span> (round_w == dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> ||</div>
<div class="line">                round_x == dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>) {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = round_w;</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = round_x;</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(cap_h, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a2316f519fb738acc54e5ea62dbbe0f45">IAV_MAINBUF_INPUT_HEIGHT_ALIGN</a>);</div>
<div class="line">            dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> =</div>
<div class="line">                <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>((vin_h - dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>) / 2, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a>);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_CFG_VIDEO_PROC, &amp;vproc);</div>
<div class="line">            apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a39c9d823b4c2cd92030678332c1d6eab">param</a> = (1 &lt;&lt; channel_id);</div>
<div class="line">            apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a470ee650e3e8257158a2424a7f94790f">apply</a> = 1;</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_APPLY_VIDEO_PROC, apply_flag);</div>
<div class="line">            usleep(1000 * 33);  <span class="comment">//zoom at about 1 fps</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> digital_zoom_autorun_for_prev(<span class="keywordtype">int</span> buffer_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a> vproc_mn, vproc_pv;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a> *dptz_mn, *dptz_pv;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html">iav_apply_flag</a> apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba46e4f3917edf4f2122f0987ab3769611">IAV_VIDEO_PROC_NUM</a>] = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> w, h;</div>
<div class="line">    <span class="keywordtype">int</span> x, y, dir, max_x, max_y, dx, dy;</div>
<div class="line">    <span class="keywordtype">int</span> zm_flag, countX, countY, zm_factor, time;<span class="comment">// zm_out_flag</span></div>
<div class="line"> </div>
<div class="line">    memset(&amp;vproc_mn, 0, <span class="keyword">sizeof</span>(vproc_mn));</div>
<div class="line">    vproc_mn.cid = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">    dptz_mn = &amp;vproc_mn.arg.dptz;</div>
<div class="line">    dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = channel_id;</div>
<div class="line">    dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a>;</div>
<div class="line">    dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = pass_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_VIDEO_PROC, &amp;vproc_mn);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;vproc_pv, 0, <span class="keyword">sizeof</span>(vproc_pv));</div>
<div class="line">    vproc_pv.cid = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">    dptz_pv = &amp;vproc_pv.arg.dptz;</div>
<div class="line">    dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = channel_id;</div>
<div class="line">    dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = buffer_id;</div>
<div class="line">    dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = pass_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_VIDEO_PROC, &amp;vproc_pv);</div>
<div class="line"> </div>
<div class="line">    w = dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">    h = dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    max_x = dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> - w;</div>
<div class="line">    max_y = dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> - h;</div>
<div class="line">    x = y = zm_flag = 0;</div>
<div class="line">    countX = 20;</div>
<div class="line">    countY = 10;</div>
<div class="line">    zm_factor = 50;</div>
<div class="line">    dir = 1;</div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = w &amp; (~0x3);</div>
<div class="line">        dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = h &amp; (~0x1);</div>
<div class="line">        dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = x &amp; (~0x3);</div>
<div class="line">        dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = y &amp; (~0x1);</div>
<div class="line"><span class="comment">//      printf(&quot;(DPTZ Type II) zoom out window size :  %dx%d, offset : %dx%d\n&quot;,</span></div>
<div class="line"><span class="comment">//          digital_zoom.input_width, digital_zoom.input_height,</span></div>
<div class="line"><span class="comment">//          digital_zoom.input_offset_x, digital_zoom.input_offset_y);</span></div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_CFG_VIDEO_PROC, &amp;vproc_pv);</div>
<div class="line">        apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a39c9d823b4c2cd92030678332c1d6eab">param</a> = (1 &lt;&lt; channel_id);</div>
<div class="line">        apply_flag[<a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d1d/structiav__apply__flag.html#a470ee650e3e8257158a2424a7f94790f">apply</a> = 1;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_APPLY_VIDEO_PROC, apply_flag);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!zm_flag) {</div>
<div class="line">            time = 200 * 1000;</div>
<div class="line">            x += dir * max_x / countX;</div>
<div class="line">            <span class="keywordflow">if</span> (x &gt; max_x) {</div>
<div class="line">                x = max_x;</div>
<div class="line">                dir = -1;</div>
<div class="line">                y += max_y / countY;</div>
<div class="line">                sleep(2);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (x &lt;= 0) {</div>
<div class="line">                x = 0;</div>
<div class="line">                dir = 1;</div>
<div class="line">                y += max_y / countY;</div>
<div class="line">                sleep(2);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (y &gt; max_y) {</div>
<div class="line">                x = max_x / 2;</div>
<div class="line">                y = max_y / 2;</div>
<div class="line">                zm_flag = 1;</div>
<div class="line">                <span class="comment">//zm_out_flag = 1;</span></div>
<div class="line">                sleep(2);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            dy = max_y / zm_factor;</div>
<div class="line">            dx = w * dy / h;</div>
<div class="line">            x -= dx;</div>
<div class="line">            y -= dy;</div>
<div class="line">            w += 2 * dx;</div>
<div class="line">            h += 2 * dy;</div>
<div class="line">            <span class="keywordflow">if</span> (w &gt; dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> ||</div>
<div class="line">                h &gt; dptz_mn-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>) {</div>
<div class="line">                w = dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">                h = dptz_pv-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">                x = y = zm_flag = 0;</div>
<div class="line">                dir = 1;</div>
<div class="line">                sleep(4);</div>
<div class="line">            }</div>
<div class="line">            time = 200 * 1000;</div>
<div class="line">        }</div>
<div class="line">        usleep(time);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a53" name="a53"></a><a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> do_dptz_for_main_buffer = 0;</div>
<div class="line">    <span class="keywordtype">int</span> do_dptz_for_preview_buffer = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// open the device</span></div>
<div class="line">    <span class="keywordflow">if</span> ((fd_iav = open(<span class="stringliteral">&quot;/dev/iav&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;/dev/iav&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        usage();</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (init_param(argc, argv) &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dptz_format_change_id &amp; (1 &lt;&lt; 0))</div>
<div class="line">        do_dptz_for_main_buffer = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dptz_format_change_id &amp; ~(1 &lt;&lt; 0))</div>
<div class="line">        do_dptz_for_preview_buffer = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_dptz_for_main_buffer) {</div>
<div class="line">        <span class="keywordflow">if</span> (digital_ptz_for_main_buffer() &lt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_dptz_for_preview_buffer) {</div>
<div class="line">        <span class="keywordflow">if</span> (digital_ptz_for_preview_buffer() &lt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (autorun_pan_I_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (auto_pan_tilt_for_main() &lt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (autorun_zoom_I_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (auto_zoom_for_main() &lt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (autorun_zoom_II_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (digital_zoom_autorun_for_prev(autorun_zoom_II_flag) &lt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    close(fd_iav);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div></div>
<div class="ttc" id="abasetypes_8h_html"><div class="ttname"><a href="../../de/ddc/basetypes_8h.html">basetypes.h</a></div><div class="ttdoc">This file defines basic types used in all IAV driver and header files.</div></div>
<div class="ttc" id="abuffer__cfg_8c_html_a690bd99c08bdec34878124b873b91751"><div class="ttname"><a href="../../../video/d7/dfa/buffer__cfg_8c.html#a690bd99c08bdec34878124b873b91751">MAX_SOURCE_BUFFER_NUM</a></div><div class="ttdeci">#define MAX_SOURCE_BUFFER_NUM</div></div>
<div class="ttc" id="abuffer__cfg_8c_html_af2f1ff77b9727caa10da1944a50c3b5b"><div class="ttname"><a href="../../../video/d7/dfa/buffer__cfg_8c.html#af2f1ff77b9727caa10da1944a50c3b5b">VERIFY_BUFFERID</a></div><div class="ttdeci">#define VERIFY_BUFFERID(x)</div></div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div></div>
<div class="ttc" id="adummy_html"><div class="ttname"><a href="../../dummy.html">ROUND_UP</a></div><div class="ttdeci">#define ROUND_UP(x, n)</div></div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">iav_rect::y</a></div><div class="ttdeci">u32 y</div><div class="ttdoc">Offset Y.</div><div class="ttdef"><b>Definition:</b> basetypes.h:113</div></div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">iav_rect::width</a></div><div class="ttdeci">u32 width</div><div class="ttdoc">Width.</div><div class="ttdef"><b>Definition:</b> basetypes.h:114</div></div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">iav_rect::height</a></div><div class="ttdeci">u32 height</div><div class="ttdoc">Height.</div><div class="ttdef"><b>Definition:</b> basetypes.h:115</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">iav_rect::x</a></div><div class="ttdeci">u32 x</div><div class="ttdoc">Offset X.</div><div class="ttdef"><b>Definition:</b> basetypes.h:112</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a></div><div class="ttdeci">DSP_CURRENT_MODE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaa1e977b4c4203d0b91b2d3533275e193a2316f519fb738acc54e5ea62dbbe0f45"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a2316f519fb738acc54e5ea62dbbe0f45">IAV_MAINBUF_INPUT_HEIGHT_ALIGN</a></div><div class="ttdeci">IAV_MAINBUF_INPUT_HEIGHT_ALIGN</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3937341c12dc0623ceefe3c34b3f4b2b">IAV_MAINBUF_INPUT_OFFSET_ALIGN</a></div><div class="ttdeci">IAV_MAINBUF_INPUT_OFFSET_ALIGN</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaa1e977b4c4203d0b91b2d3533275e193a3e17c129dab35cc82888d7c875026175"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a3e17c129dab35cc82888d7c875026175">IAV_MAINBUF_INPUT_WIDTH_ALIGN</a></div><div class="ttdeci">IAV_MAINBUF_INPUT_WIDTH_ALIGN</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a></div><div class="ttdeci">IAV_SRCBUF_MN</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a1d909756ef49647a3774e92f15bb700ba46e4f3917edf4f2122f0987ab3769611"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba46e4f3917edf4f2122f0987ab3769611">IAV_VIDEO_PROC_NUM</a></div><div class="ttdeci">IAV_VIDEO_PROC_NUM</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a></div><div class="ttdeci">IAV_VIDEO_PROC_DPTZ</div></div>
<div class="ttc" id="astructiav__apply__flag_html"><div class="ttname"><a href="../../../library/d8/d1d/structiav__apply__flag.html">iav_apply_flag</a></div></div>
<div class="ttc" id="astructiav__apply__flag_html_a39c9d823b4c2cd92030678332c1d6eab"><div class="ttname"><a href="../../../library/d8/d1d/structiav__apply__flag.html#a39c9d823b4c2cd92030678332c1d6eab">iav_apply_flag::param</a></div><div class="ttdeci">u32 param</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3523</div></div>
<div class="ttc" id="astructiav__apply__flag_html_a470ee650e3e8257158a2424a7f94790f"><div class="ttname"><a href="../../../library/d8/d1d/structiav__apply__flag.html#a470ee650e3e8257158a2424a7f94790f">iav_apply_flag::apply</a></div><div class="ttdeci">int apply</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3522</div></div>
<div class="ttc" id="astructiav__buf__cfg_html"><div class="ttname"><a href="../../../library/d6/da9/structiav__buf__cfg.html">iav_buf_cfg</a></div></div>
<div class="ttc" id="astructiav__buf__cfg_html_a96d70b1736d2a18327af31d6b00c958b"><div class="ttname"><a href="../../../library/d6/da9/structiav__buf__cfg.html#a96d70b1736d2a18327af31d6b00c958b">iav_buf_cfg::output</a></div><div class="ttdeci">struct iav_rect output</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1610</div></div>
<div class="ttc" id="astructiav__buf__cfg_html_ac2eab39ce1829256fbb1f813d5048b11"><div class="ttname"><a href="../../../library/d6/da9/structiav__buf__cfg.html#ac2eab39ce1829256fbb1f813d5048b11">iav_buf_cfg::input</a></div><div class="ttdeci">struct iav_rect input</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1609</div></div>
<div class="ttc" id="astructiav__chan__cfg_html"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a></div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a124a81574b0fbd3d1e60e2917e5ecefe"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">iav_chan_cfg::vsrc_id</a></div><div class="ttdeci">u32 vsrc_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1315</div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a2b2ffdba3c57a07941aca4272b6a5012"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a2b2ffdba3c57a07941aca4272b6a5012">iav_chan_cfg::raw_height</a></div><div class="ttdeci">u32 raw_height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1441</div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a7c027495a88c7b1c65a836ed23d80588"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a7c027495a88c7b1c65a836ed23d80588">iav_chan_cfg::raw_width</a></div><div class="ttdeci">u32 raw_width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1439</div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a85599fa0eac7165aaca13aa21f0e6b38"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a85599fa0eac7165aaca13aa21f0e6b38">iav_chan_cfg::chan_id</a></div><div class="ttdeci">u32 chan_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1314</div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a869a030ae5c3e249d6f9b4d5d8bba5a7"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a869a030ae5c3e249d6f9b4d5d8bba5a7">iav_chan_cfg::rotate_cw</a></div><div class="ttdeci">u32 rotate_cw</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1336</div></div>
<div class="ttc" id="astructiav__dptz_html"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a></div></div>
<div class="ttc" id="astructiav__dptz_html_a2830ebfe6ef0797f46e9fcc1945f4c01"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">iav_dptz::buf_id</a></div><div class="ttdeci">u8 buf_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1618</div></div>
<div class="ttc" id="astructiav__dptz_html_a4eb5390353fb0508442db61e89ed786b"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">iav_dptz::pass_id</a></div><div class="ttdeci">u8 pass_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1617</div></div>
<div class="ttc" id="astructiav__dptz_html_a7f0c82e1f055e95da8a702634c3e56b0"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">iav_dptz::channel_id</a></div><div class="ttdeci">u8 channel_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1616</div></div>
<div class="ttc" id="astructiav__dptz_html_ac7b3dbccd521a64f6489ec7450568484"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">iav_dptz::buf_cfg</a></div><div class="ttdeci">struct iav_buf_cfg buf_cfg</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1620</div></div>
<div class="ttc" id="astructiav__enc__buf__cap_html"><div class="ttname"><a href="../../../library/d5/d5f/structiav__enc__buf__cap.html">iav_enc_buf_cap</a></div></div>
<div class="ttc" id="astructiav__system__resource_html"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a></div></div>
<div class="ttc" id="astructiav__video__proc_html"><div class="ttname"><a href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a></div></div>
<div class="ttc" id="astructiav__video__proc_html_a5088ad450ba62b8537bf514a00e08fdf"><div class="ttname"><a href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">iav_video_proc::arg</a></div><div class="ttdeci">union iav_video_proc::@83 arg</div></div>
<div class="ttc" id="astructiav__video__proc_html_ac4e5f5c915549f0671997f3153e9f5c9"><div class="ttname"><a href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">iav_video_proc::dptz</a></div><div class="ttdeci">struct iav_dptz dptz</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3508</div></div>
<div class="ttc" id="astructiav__video__proc_html_af9eae96af4a33e97e8805e61bf4ef9b6"><div class="ttname"><a href="../../../library/d2/d92/structiav__video__proc.html#af9eae96af4a33e97e8805e61bf4ef9b6">iav_video_proc::cid</a></div><div class="ttdeci">enum iav_video_proc_id cid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3506</div></div>
<div class="ttc" id="atest__dptz_8h_html"><div class="ttname"><a href="../../../video/d0/d68/test__dptz_8h.html">test_dptz.h</a></div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
<div class="ttc" id="avin__init_8c_html_a5294002f7dca0cd9bcc0009a27895ef7"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a></div><div class="ttdeci">int fd_iav</div></div>
<div class="ttc" id="avout__init__cfg_8c_html_a88a5b93883c34229851d6a7a93254850"><div class="ttname"><a href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a></div><div class="ttdeci">#define AM_IOCTL(_filp, _cmd, _arg)</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
