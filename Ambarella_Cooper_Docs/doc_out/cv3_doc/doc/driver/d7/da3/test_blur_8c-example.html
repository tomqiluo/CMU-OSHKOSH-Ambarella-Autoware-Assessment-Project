<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driver: test_blur.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Driver"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Driver<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/da3/test_blur_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test_blur.c</div></div>
</div><!--header-->
<div class="contents">
<p >This is an example of how to insert blur areas to streams for privacy protection.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * test_blur.c</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *    2019/11/25  - [Zhaoyang Chen] created</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2016 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents ( &quot;Software&quot; ) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/ddc/basetypes_8h.html">basetypes.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iav_ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;termio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;limits.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;lib_blur.h&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_ENCODE_STREAM_NUM   (IAV_STREAM_MAX_NUM_ALL)</span></div>
<div class="line"><span class="preprocessor">#define MAX_BLUR_AREA_NUM       (MAX_NUM_BLUR_AREA)</span></div>
<div class="line"><span class="preprocessor">#define MAX_BLUR_COEFF          (MAX_BLUR_COEFF_SMOOTH)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_STREAMID(x)  do {        \</span></div>
<div class="line"><span class="preprocessor">            if (((x) &lt; 0) || ((x) &gt;= MAX_ENCODE_STREAM_NUM)) {  \</span></div>
<div class="line"><span class="preprocessor">                printf(&quot;stream id wrong %d \n&quot;</span>, (x));           \</div>
<div class="line">                return -1;  \</div>
<div class="line">            }   \</div>
<div class="line">        } while(0)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define ROTATE_BIT      (0)</span></div>
<div class="line"><span class="preprocessor">#define HFLIP_BIT       (1)</span></div>
<div class="line"><span class="preprocessor">#define VFLIP_BIT       (2)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> rotate_type_s {</div>
<div class="line">    CLOCKWISE_0 = 0,</div>
<div class="line">    CLOCKWISE_90 = <a id="a0" name="a0"></a><a class="code hl_define" href="../../dummy.html">BIT</a>(ROTATE_BIT),</div>
<div class="line">    CLOCKWISE_180 = <a class="code hl_define" href="../../dummy.html">BIT</a>(<a id="a1" name="a1"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2ea53919c0c9fd8839c409d57093a76ec12">HFLIP_BIT</a>) | <a class="code hl_define" href="../../dummy.html">BIT</a>(<a id="a2" name="a2"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2eaf0d5339194eb23fed5fbfa711240b092">VFLIP_BIT</a>),</div>
<div class="line">    CLOCKWISE_270 = <a class="code hl_define" href="../../dummy.html">BIT</a>(<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2ea53919c0c9fd8839c409d57093a76ec12">HFLIP_BIT</a>) | <a class="code hl_define" href="../../dummy.html">BIT</a>(<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2eaf0d5339194eb23fed5fbfa711240b092">VFLIP_BIT</a>) | <a class="code hl_define" href="../../dummy.html">BIT</a>(ROTATE_BIT),</div>
<div class="line">    AUTO_ROTATE,</div>
<div class="line">} rotate_type_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> blur_status_s {</div>
<div class="line">    INIT = 0,</div>
<div class="line">    BLUR_ENABLE,</div>
<div class="line">    BLUR_DISABLE,</div>
<div class="line">} blur_status_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>blur_info_s {</div>
<div class="line">    <span class="keywordtype">int</span> enable;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> width;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> height;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> x;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> y;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> strength;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> i_mode;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_blocky;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> coeff;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> color_idx;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> color_enable : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> reserved0 : 7;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> reserved1[2];</div>
<div class="line">} blur_info_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>stream_info_s {</div>
<div class="line">    <span class="keywordtype">int</span> blur_enable;</div>
<div class="line">    rotate_type_t blur_rotate;</div>
<div class="line">    <span class="keywordtype">int</span> blur_win_width;</div>
<div class="line">    <span class="keywordtype">int</span> blur_win_height;</div>
<div class="line">    <span class="keywordtype">int</span> max_blur_area_num;</div>
<div class="line">    blur_info_t blurs[MAX_BLUR_AREA_NUM];</div>
<div class="line">} stream_info_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> stream_info_t stream_info[MAX_ENCODE_STREAM_NUM];</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>blur_color_cfg blur_color_info = {0};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a3" name="a3"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#a44d2ff4c88ea8d70d918eb19d715e78a">autorun_flag</a> = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> show_config_stream_id = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> show_config_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> verbose_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a4" name="a4"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> arbitrary_blur_flag = 0;</div>
<div class="line"><span class="keywordtype">int</span> stream_max_num = MAX_ENCODE_STREAM_NUM;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> blur_max_width = INT_MAX;</div>
<div class="line"><span class="keywordtype">int</span> blur_update_intervals = 30;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> fixed_area_num = 0;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html">src/blur_cfg.c</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> set_blur(<span class="keywordtype">int</span> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>blur_apply_cfg apply = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (stream_info[stream_id].blur_enable) {</div>
<div class="line">    <span class="keywordflow">case</span> BLUR_DISABLE:</div>
<div class="line">        <a id="a5" name="a5"></a>blur_insert[stream_id].enable = 0;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> BLUR_ENABLE:</div>
<div class="line">        blur_insert[stream_id].enable = 1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (blur_set_stream_cfg(&amp;blur_insert[stream_id]) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    apply.stream_map |= (1 &lt;&lt; stream_id);</div>
<div class="line">    <span class="keywordflow">if</span> (blur_apply(&amp;apply) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> getch(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>termios tm, tm_old;</div>
<div class="line">    <span class="keywordtype">int</span> fd = 0;</div>
<div class="line">    <span class="keywordtype">char</span> ch;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (tcgetattr(fd, &amp;tm) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    tm_old = tm;</div>
<div class="line">    cfmakeraw(&amp;tm);</div>
<div class="line">    <span class="keywordflow">if</span> (tcsetattr(fd, TCSANOW, &amp;tm) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ch = getchar();</div>
<div class="line">    <span class="keywordflow">if</span> (tcsetattr(fd, TCSANOW, &amp;tm_old) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ch;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> run_blur_interactive_change(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> stream_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> area_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>blur_stream_cfg blur_insert_info = {0};</div>
<div class="line">    <span class="keyword">struct </span>blur_apply_cfg apply = {0};</div>
<div class="line">    <span class="keywordtype">int</span> step = 0, has_change = 0, is_hori = 0, is_size;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> *x, *y, *width, *height, *update_param = NULL;</div>
<div class="line">    <span class="keywordtype">char</span> ch;</div>
<div class="line"> </div>
<div class="line">    blur_insert_info.stream_id = stream_id;</div>
<div class="line">    apply.stream_map |= (1 &lt;&lt; stream_id);</div>
<div class="line">    <span class="keywordflow">if</span> (blur_get_stream_cfg(&amp;blur_insert_info) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (!blur_insert_info.area[area_id].enable || !blur_insert_info.enable) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;stream %c blur_area[%d] isn&#39;t enabled, pls enable it first.\n&quot;</span>,</div>
<div class="line">            <span class="charliteral">&#39;A&#39;</span> + stream_id, area_id);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    x = &amp;blur_insert_info.area[area_id].start_x;</div>
<div class="line">    y = &amp;blur_insert_info.area[area_id].start_y;</div>
<div class="line">    width = &amp;blur_insert_info.area[area_id].act_width;</div>
<div class="line">    height = &amp;blur_insert_info.area[area_id].act_height;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;=========================================================\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Enter stream %c blur_area[%d] offset &amp; size interactive change:\n\n&quot;</span>,</div>
<div class="line">        <span class="charliteral">&#39;A&#39;</span> + stream_id, area_id);</div>
<div class="line">    printf(<span class="stringliteral">&quot;========= to change offset\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;    \&#39;s\&#39;: left, \&#39;f\&#39;: right\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;    \&#39;e\&#39;: up, \&#39;d\&#39;: down\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;========= to change size\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;    \&#39;j\&#39;: decrease width, \&#39;l\&#39;: increase width\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;    \&#39;i\&#39;: decrease height, \&#39;k\&#39;: increase height\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;=========\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;    \&#39;q\&#39;: quit\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;=========================================================\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span>(1) {</div>
<div class="line">        ch = getch();</div>
<div class="line">        has_change = 0;</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:</div>
<div class="line">            is_hori = 1;</div>
<div class="line">            has_change = 1;</div>
<div class="line">            is_size = 0;</div>
<div class="line">            step = -<a id="a6" name="a6"></a><a class="code hl_define" href="../../dummy.html">BLUR_OFFSET_ALIGN</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;F&#39;</span>:</div>
<div class="line">            is_hori = 1;</div>
<div class="line">            has_change = 1;</div>
<div class="line">            is_size = 0;</div>
<div class="line">            step = <a class="code hl_define" href="../../dummy.html">BLUR_OFFSET_ALIGN</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:</div>
<div class="line">            is_hori = 0;</div>
<div class="line">            has_change = 1;</div>
<div class="line">            is_size = 0;</div>
<div class="line">            step = <a class="code hl_define" href="../../dummy.html">BLUR_OFFSET_ALIGN</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:</div>
<div class="line">            is_hori = 0;</div>
<div class="line">            has_change = 1;</div>
<div class="line">            is_size = 0;</div>
<div class="line">            step = -<a class="code hl_define" href="../../dummy.html">BLUR_OFFSET_ALIGN</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;j&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;J&#39;</span>:</div>
<div class="line">            is_hori = 1;</div>
<div class="line">            has_change = 1;</div>
<div class="line">            is_size = 1;</div>
<div class="line">            step = -<a id="a7" name="a7"></a><a class="code hl_define" href="../../dummy.html">BLUR_WIDTH_ALIGN</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>:</div>
<div class="line">            is_hori = 1;</div>
<div class="line">            has_change = 1;</div>
<div class="line">            is_size = 1;</div>
<div class="line">            step = <a class="code hl_define" href="../../dummy.html">BLUR_WIDTH_ALIGN</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>:</div>
<div class="line">            is_hori = 0;</div>
<div class="line">            has_change = 1;</div>
<div class="line">            is_size = 1;</div>
<div class="line">            step = -<a id="a8" name="a8"></a><a class="code hl_define" href="../../dummy.html">BLUR_HEIGHT_ALIGN</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;k&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;K&#39;</span>:</div>
<div class="line">            is_hori = 0;</div>
<div class="line">            has_change = 1;</div>
<div class="line">            is_size = 1;</div>
<div class="line">            step = <a class="code hl_define" href="../../dummy.html">BLUR_OFFSET_ALIGN</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;Q&#39;</span>:</div>
<div class="line">            printf(<span class="stringliteral">&quot;quit\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!has_change) {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (is_hori &amp;&amp; is_size) {</div>
<div class="line">            update_param = width;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_hori &amp;&amp; !is_size) {</div>
<div class="line">            update_param = x;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!is_hori &amp;&amp; is_size) {</div>
<div class="line">            update_param = height;</div>
<div class="line">        } <span class="keywordflow">else</span> {<span class="comment">// !is_hori &amp;&amp; !is_size</span></div>
<div class="line">            update_param = y;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((step &gt;= 0 ) || ((step &lt; 0) &amp;&amp; (*update_param))) {</div>
<div class="line">            *update_param += step;</div>
<div class="line">            step = (step &gt; 0) ? step : -1 * step;</div>
<div class="line">            <span class="keywordflow">if</span> (*update_param % step) {</div>
<div class="line">                *update_param = (*update_param / step ) * step;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (blur_set_stream_cfg(&amp;blur_insert_info) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (blur_apply(&amp;apply) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> rand_int_range(<span class="keywordtype">int</span> start, <span class="keywordtype">int</span> end)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> rand() % (end + 1 - start) + start;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> autorun_blur(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, j, frame_count = 0, blur_num = 0;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a9" name="_a9"></a><a class="code hl_structRef" target="_blank" href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a> query_info;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a10" name="_a10"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html">iav_stream_info</a> *encode_info;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a11" name="_a11"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a> stream_cfg;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a12" name="_a12"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html">iav_stream_format</a> *stream_format;</div>
<div class="line">    <span class="keyword">struct </span>blur_area_cfg *area;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a13" name="_a13"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> query_desc = {0};</div>
<div class="line">    <span class="keyword">struct </span>blur_mem_cfg mem_cfg;</div>
<div class="line">    <span class="keyword">struct </span>blur_area_mem_cfg *area_mem_cfg;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a14" name="_a14"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> canvas_cfg = {0};</div>
<div class="line">    <span class="keywordtype">int</span> <a id="a15" name="a15"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a> = -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">struct </span>timeval tm1, tm2;</div>
<div class="line">    <span class="keyword">struct </span>timeval *p_tm[2];</div>
<div class="line">    <span class="keywordtype">int</span> cur_tm = 0, retv = 0;</div>
<div class="line"> </div>
<div class="line">    p_tm[0] = &amp;tm1;</div>
<div class="line">    p_tm[1] = &amp;tm2;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (verbose_flag)</div>
<div class="line">        gettimeofday(&amp;tm2, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">        memset(&amp;query_info, 0, <span class="keyword">sizeof</span>(query_info));</div>
<div class="line">        query_info.qid = <a id="a16" name="a16"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a>;</div>
<div class="line">        encode_info = &amp;query_info.arg.stream;</div>
<div class="line">        encode_info-&gt;<a id="a17" name="a17"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#a76f8ba65ce8f902c0657233adee58698">id</a> = i;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a18" name="a18"></a>IAV_IOC_QUERY_INFO, &amp;query_info) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_INFO&quot;</span>);</div>
<div class="line">            retv = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">        }</div>
<div class="line">        memset(&amp;stream_cfg, 0, <span class="keyword">sizeof</span>(stream_cfg));</div>
<div class="line">        stream_cfg.id = i;</div>
<div class="line">        stream_cfg.cid = <a id="a19" name="a19"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48">IAV_STMCFG_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a20" name="a20"></a>IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_GET_STREAM_CONFIG&quot;</span>);</div>
<div class="line">            retv = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">        }</div>
<div class="line">        stream_format = &amp;stream_cfg.arg.format;</div>
<div class="line">        <span class="keywordflow">if</span> (encode_info-&gt;<a id="a21" name="a21"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#ac78453cf0c29f2b9c40cfb142185d7d9">state</a> == <a id="a22" name="a22"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d">IAV_STREAM_STATE_ENCODING</a> ||</div>
<div class="line">            encode_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#ac78453cf0c29f2b9c40cfb142185d7d9">state</a> == <a id="a23" name="a23"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a6e9d926f59102b9563a722581c65ee55">IAV_STREAM_STATE_STARTING</a>) {</div>
<div class="line">            memset(&amp;canvas_cfg, 0, <span class="keyword">sizeof</span>(canvas_cfg));</div>
<div class="line">            canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a> = stream_format-&gt;<a id="a24" name="a24"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a484522517e5e2458148cdd9a91f819ab">enc_src_id</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a25" name="a25"></a>IAV_IOC_GET_CANVAS_CONFIG, &amp;canvas_cfg) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_GET_CANVAS_CONFIG\n&quot;</span>);</div>
<div class="line">                retv = -1;</div>
<div class="line">                <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!canvas_cfg.<a id="a26" name="a26"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#aafd4d0f4f81aa65a6fc3c9ccb2c34bcf">blur_enable</a>) {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            stream_info[i].max_blur_area_num = canvas_cfg.<a id="a27" name="a27"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#af078812648ec47b41b3382744c194dcc">max_blur_area_num</a>;</div>
<div class="line">            stream_info[i].blur_enable = BLUR_ENABLE;</div>
<div class="line">            stream_info[i].blur_win_width = <a id="a28" name="a28"></a><a class="code hl_define" href="../../dummy.html">MIN</a>(stream_format-&gt;<a id="a29" name="a29"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">enc_win</a>.<a id="a30" name="a30"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>, blur_max_width);</div>
<div class="line">            stream_info[i].blur_win_height = stream_format-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">enc_win</a>.<a id="a31" name="a31"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (canvas_id &lt; 0) {</div>
<div class="line">                canvas_id = stream_format-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a484522517e5e2458148cdd9a91f819ab">enc_src_id</a>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset(&amp;mem_cfg, 0, <span class="keyword">sizeof</span>(mem_cfg));</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (stream_info[i].blur_enable) {</div>
<div class="line">            mem_cfg.max_area_num[i] = stream_info[i].max_blur_area_num;</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; mem_cfg.max_area_num[i]; j++) {</div>
<div class="line">                area_mem_cfg = &amp;mem_cfg.area[i][j];</div>
<div class="line">                area_mem_cfg-&gt;max_width = stream_info[i].blur_win_width;</div>
<div class="line">                area_mem_cfg-&gt;max_height = stream_info[i].blur_win_height;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (blur_set_mem_cfg(&amp;mem_cfg) &lt; 0) {</div>
<div class="line">        retv = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">            blur_insert[i].stream_id = i;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (stream_info[i].blur_enable == BLUR_ENABLE) {</div>
<div class="line">                <span class="keywordflow">if</span> (blur_get_stream_cfg(&amp;blur_insert[i]) &lt; 0) {</div>
<div class="line">                    retv = -1;</div>
<div class="line">                    <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                blur_insert[i].enable = 1;</div>
<div class="line">                <span class="keywordflow">if</span> (fixed_area_num) {</div>
<div class="line">                    blur_num = fixed_area_num;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    blur_num = <a class="code hl_define" href="../../dummy.html">MIN</a>(stream_info[i].max_blur_area_num, <a id="a32" name="a32"></a>blur_max_num);</div>
<div class="line">                    blur_num = rand_int_range(1, blur_num);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                memset(&amp;stream_cfg, 0, <span class="keyword">sizeof</span>(stream_cfg));</div>
<div class="line">                stream_cfg.id = i;</div>
<div class="line">                stream_cfg.cid = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48">IAV_STMCFG_FORMAT</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg) &lt; 0) {</div>
<div class="line">                    perror(<span class="stringliteral">&quot;IAV_IOC_GET_STREAM_CONFIG&quot;</span>);</div>
<div class="line">                    retv = -1;</div>
<div class="line">                    <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">                }</div>
<div class="line">                stream_format = &amp;stream_cfg.arg.format;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; MAX_BLUR_AREA_NUM; ++j) {</div>
<div class="line">                    area = &amp;blur_insert[i].area[j];</div>
<div class="line">                    <span class="keywordflow">if</span> (j &lt; blur_num) {</div>
<div class="line">                        area-&gt;enable = 1;</div>
<div class="line">                        area-&gt;strength = 2;</div>
<div class="line">                        area-&gt;is_blocky = 1;</div>
<div class="line">                        area-&gt;color_enable = 0;</div>
<div class="line">                        area-&gt;color_idx = 0;</div>
<div class="line">                        area-&gt;coeff = 0;</div>
<div class="line">                        area-&gt;start_x = <a id="a33" name="a33"></a><a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(0, stream_info[i].blur_win_width - 2 * BLUR_WIDTH_ALIGN), BLUR_OFFSET_ALIGN);</div>
<div class="line">                        area-&gt;start_y = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(0, stream_info[i].blur_win_height - 2 * BLUR_HEIGHT_ALIGN), BLUR_OFFSET_ALIGN);</div>
<div class="line">                        area-&gt;act_width = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(<a id="a34" name="a34"></a>MIN_BLUR_WIDTH, stream_info[i].blur_win_width - area-&gt;start_x),</div>
<div class="line">                            BLUR_WIDTH_ALIGN);</div>
<div class="line">                        area-&gt;act_height = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(BLUR_HEIGHT_ALIGN, stream_info[i].blur_win_height - area-&gt;start_y),</div>
<div class="line">                            BLUR_HEIGHT_ALIGN);</div>
<div class="line"> </div>
<div class="line">                        <span class="comment">// transform blur offset to canvas domain</span></div>
<div class="line">                        area-&gt;start_x += stream_format-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">enc_win</a>.<a id="a35" name="a35"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">                        area-&gt;start_y += stream_format-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">enc_win</a>.<a id="a36" name="a36"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        area-&gt;enable = 0;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                blur_insert[i].act_area_num = blur_num;</div>
<div class="line">                set_blur(i);</div>
<div class="line"> </div>
<div class="line">                printf(<span class="stringliteral">&quot;\n  Stream %c blur configuration :\n&quot;</span>, <span class="charliteral">&#39;A&#39;</span> + i);</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; blur_num; ++j) {</div>
<div class="line">                    area = &amp;blur_insert[i].area[j];</div>
<div class="line">                    printf(<span class="stringliteral">&quot;    Area [%d] : size [%dx%d], offset [%dx%d]\n&quot;</span>,</div>
<div class="line">                        j, area-&gt;act_width, area-&gt;act_height, area-&gt;start_x, area-&gt;start_y);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> ((frame_count &lt; blur_update_intervals) &amp;&amp; (canvas_id &gt;= 0)) {</div>
<div class="line">            query_desc.<a id="a37" name="a37"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#aa73b12ace6ac7df824707a89ac4f91ff">qid</a> = <a id="a38" name="a38"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a>;</div>
<div class="line">            query_desc.<a id="a39" name="a39"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a id="a40" name="a40"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a id="a41" name="a41"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a> = canvas_id;</div>
<div class="line">            <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a42" name="a42"></a>IAV_IOC_QUERY_DESC, &amp;query_desc) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_DESC, dsp hangs&quot;</span>);</div>
<div class="line">                retv = -1;</div>
<div class="line">                <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">            }</div>
<div class="line">            frame_count++;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (frame_count &gt;= blur_update_intervals) {</div>
<div class="line">            frame_count = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (verbose_flag) {</div>
<div class="line">            cur_tm = !cur_tm;</div>
<div class="line">            gettimeofday(p_tm[cur_tm], NULL);</div>
<div class="line">            printf(<span class="stringliteral">&quot;interval %ldus\n&quot;</span>,(1000000 * (p_tm[cur_tm]-&gt;tv_sec -</div>
<div class="line">                p_tm[!cur_tm]-&gt;tv_sec) + (p_tm[cur_tm]-&gt;tv_usec -</div>
<div class="line">                p_tm[!cur_tm]-&gt;tv_usec)));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">exit_auto_run:</div>
<div class="line">    <span class="keywordflow">return</span> retv;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NO_ARG    0</span></div>
<div class="line"><span class="preprocessor">#define HAS_ARG  1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define ARBITRARY_BLUR_TEST 0x80</span></div>
<div class="line"><span class="preprocessor">#define BLUR_COLOR_INDEX    0x81</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>option <a id="a43" name="a43"></a>long_options[] = {</div>
<div class="line">    {<span class="stringliteral">&quot;streamA&quot;</span>, <a id="a44" name="a44"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;A&#39;</span>},   <span class="comment">// -A xxxxx  means all following configs will be applied to stream A</span></div>
<div class="line">    {<span class="stringliteral">&quot;streamB&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;B&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;streamC&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;C&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;streamD&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;D&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;streamE&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;E&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;stream&quot;</span>, <a id="a45" name="a45"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;S&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;area&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;a&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;max-area-num&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;N&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;fixed-area-num&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;f&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;max-stream-num&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;M&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;max-blur-width&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;W&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;xstart&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;x&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;ystart&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;y&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;width&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;w&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;height&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;h&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;imode&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;m&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;strength&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;t&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;is_blocky&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;b&#39;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;autorotate&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;n&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;disable&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;s&#39;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;autorun&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;r&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;show-config&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;l&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;arb-blur&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, ARBITRARY_BLUR_TEST},</div>
<div class="line">    {<span class="stringliteral">&quot;verbose&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;v&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;coeff&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;c&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;color-idx&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <a id="a46" name="a46"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d8/dd9/group__tfsync__parm.html#ga4d23202fab21a02ae940c16d41963591">BLUR_COLOR_INDEX</a>},</div>
<div class="line">    {<span class="stringliteral">&quot;cfg-color-idx&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;d&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;U&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;V&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;V&#39;</span>},</div>
<div class="line"> </div>
<div class="line">    {0, 0, 0, 0}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a47" name="a47"></a>short_options = <span class="stringliteral">&quot;ABb:CDEa:x:y:w:h:nmM:N:sS:t:r:lvW:f:c:d:U:V:&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a id="_a48" name="_a48"></a><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a49" name="a49"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a50" name="a50"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> <a id="a51" name="a51"></a>hint[] = {</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream A&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream B&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream C&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream D&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream E&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~19&quot;</span>, <span class="stringliteral">&quot;\tspecify stream ID&quot;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;0~7&quot;</span>, <span class="stringliteral">&quot;\t\tset blur area index&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;1~8&quot;</span>, <span class="stringliteral">&quot;\tset blur area max num, default is 8.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tset fixed number of blur areas in autorun mode.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;1~20&quot;</span>, <span class="stringliteral">&quot;set blur stream max num, default is 20.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tset max blur area width in autorun mode.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset x&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset y&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset width&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset height&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tenable interactive mode&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~2&quot;</span>, <span class="stringliteral">&quot;\tspecify the blur strength of blur area&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0/1&quot;</span>, <span class="stringliteral">&quot;\tenable/disable blocky blur effect&quot;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tWhen rotate clockwise degree is 90/180/270, blur area will be rotated according to stream rotation.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tturn off blur on stream&quot;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;n&quot;</span>, <span class="stringliteral">&quot;\tupdate blur info every n frame automatically&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tshow blur area configure&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\trun blur lib demo.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tprint debug message&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset blur coeff&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~15&quot;</span>, <span class="stringliteral">&quot;\tspecify the color idx of blur area&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~15&quot;</span>, <span class="stringliteral">&quot;\tspecify color index when configurating the colors&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~255&quot;</span>, <span class="stringliteral">&quot;\t\tChroma U value for the current color index&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~255&quot;</span>, <span class="stringliteral">&quot;\t\tChroma V value for the current color index&quot;</span>},</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a id="a52" name="a52"></a>usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;test_blur usage:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(long_options) / <span class="keyword">sizeof</span>(long_options[0]) - 1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (isalpha(long_options[i].val))</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c &quot;</span>, long_options[i].val);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;--%s&quot;</span>, long_options[i].<a id="a53" name="a53"></a>name);</div>
<div class="line">        <span class="keywordflow">if</span> (hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>[0] != 0)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [%s]&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nExample:\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;  Configure blur color table before stream encoding:\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;    test_blur -d 0 -U 103 -V 240 -d 1 -U 42 -V 26 -d 2 -U 240 -V 118\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;  Three rectangle blur regions on one stream:\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;    test_blur -A -a0 -x128 -y128 -w128 -h128 -b 1 -c 1 --color-idx 0 -a1 -x256 -y256 -w256 &quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;-h256 --color-idx 1 -a2 -x512 -y512 -w512 -h512 -b 0 -c 3 -t 0 --color-idx 2\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;  Interactively change blur area offset and size:\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;    test_blur -A -a0 -x28 -y22 -w114 -h122 -t 2 -m\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;  Keep blur region upright on 270 degree clockwise stream:\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;    test_encode -A -H720p --smaxsize 720x1280 --rotate 1 --hflip 1 --vflip 1 -e\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;    test_blur -A -a0 -x128 -y256 -w128 -h256 --autorotate\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;  Updata blur every frame:\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;    test_blur -r 1\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;  Show current blur area settings of streams:\n&quot;</span>\</div>
<div class="line">        <span class="stringliteral">&quot;    test_blur -A -l\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> init_param(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ch;</div>
<div class="line">    <span class="keywordtype">int</span> i, j;</div>
<div class="line">    <span class="keywordtype">int</span> error_flag[MAX_ENCODE_STREAM_NUM] = {0};</div>
<div class="line">    <span class="keywordtype">int</span> option_index = 0;</div>
<div class="line">    <span class="keywordtype">int</span> <a id="a54" name="a54"></a>current_stream = -1;    <span class="comment">// -1 is a invalid stream, for initialize data only</span></div>
<div class="line">    <span class="keywordtype">int</span> current_blur_area = -1; <span class="comment">// -1 is a invalid area, for initialize data only</span></div>
<div class="line">    <span class="keywordtype">int</span> current_color_idx = -1; <span class="comment">// -1 is a invalid color index, for initialize data only</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> temp;</div>
<div class="line"> </div>
<div class="line">    opterr = 0;</div>
<div class="line">    <span class="keywordflow">while</span> ((ch = getopt_long(argc, argv, short_options, long_options, &amp;option_index)) != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:</div>
<div class="line">            current_stream = ch - <span class="charliteral">&#39;A&#39;</span>;</div>
<div class="line">            <a id="a55" name="a55"></a><a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            stream_info[current_stream].blur_enable = BLUR_ENABLE;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:</div>
<div class="line">            current_stream = atoi(optarg);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            stream_info[current_stream].blur_enable = BLUR_ENABLE;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div>
<div class="line">            current_blur_area = atoi(optarg);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            <a id="a56" name="a56"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a>(current_blur_area);</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].enable = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line">            current_color_idx = atoi(optarg);</div>
<div class="line">            <a id="a57" name="a57"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#adeb635c2f039f23730d7eda1a821b2e3">VERIFY_COLOR_IDX</a>(current_color_idx);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#adeb635c2f039f23730d7eda1a821b2e3">VERIFY_COLOR_IDX</a>(current_color_idx);</div>
<div class="line">            blur_color_info.U[current_color_idx] = atoi(optarg);</div>
<div class="line">            blur_color_info.color_idx_map |= (1 &lt;&lt; current_color_idx);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#adeb635c2f039f23730d7eda1a821b2e3">VERIFY_COLOR_IDX</a>(current_color_idx);</div>
<div class="line">            blur_color_info.V[current_color_idx] = atoi(optarg);</div>
<div class="line">            blur_color_info.color_idx_map |= (1 &lt;&lt; current_color_idx);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#aa4b91f70818d683d894a673756fe20d3">blur_max_num</a> = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (blur_max_num &lt; 1 || blur_max_num &gt; MAX_BLUR_AREA_NUM) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;The blur max num shoud be [1~%d]\n&quot;</span>, MAX_BLUR_AREA_NUM);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            printf(<span class="stringliteral">&quot;The blur max num is %d\n&quot;</span>, blur_max_num);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line">            temp = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (temp &lt;= 0 || temp &gt; MAX_BLUR_AREA_NUM) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;The fixed blur area num should be [1~%d]\n&quot;</span>, MAX_BLUR_AREA_NUM);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            fixed_area_num = temp;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:</div>
<div class="line">            stream_max_num = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (stream_max_num &lt; 1 || stream_max_num &gt; MAX_ENCODE_STREAM_NUM) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;The stream max num shoud be [1~%d]\n&quot;</span>, MAX_ENCODE_STREAM_NUM);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            printf(<span class="stringliteral">&quot;The stream max num is %d\n&quot;</span>, stream_max_num);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;W&#39;</span>:</div>
<div class="line">            blur_max_width = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (blur_max_width &lt; MIN_BLUR_WIDTH) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;The blur max width should be greater than %d\n&quot;</span>, MIN_BLUR_WIDTH - 1);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            printf(<span class="stringliteral">&quot;The blur max width is %d\n&quot;</span>, blur_max_width);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a>(current_blur_area);</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].x = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a>(current_blur_area);</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].y = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a>(current_blur_area);</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].width = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a>(current_blur_area);</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].height = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a>(current_blur_area);</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].i_mode = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line">            temp = atoi(optarg);</div>
<div class="line">            <a id="a58" name="a58"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a97b135e062a5d34188d2bdf0e7a273dc">VERIFY_STRENGTH</a>(temp);</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; ++i) {</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; MAX_BLUR_AREA_NUM; ++j) {</div>
<div class="line">                    stream_info[i].blurs[j].strength = temp;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a>(current_blur_area);</div>
<div class="line">            temp = atoi(optarg);</div>
<div class="line">            <a id="a59" name="a59"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a059521eb88bc63e9f62739e6588bd0e1">VERIFY_IS_BLOCKY</a>(temp);</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].is_blocky = temp;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a>(current_blur_area);</div>
<div class="line">            temp = atoi(optarg);</div>
<div class="line">            <a id="a60" name="a60"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a43b4989668ab730d7a2a5b5fb7d8d8d6">VERIFY_COEFF</a>(temp);</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].coeff = temp;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            stream_info[current_stream].blur_rotate = AUTO_ROTATE;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            stream_info[current_stream].blur_enable = BLUR_DISABLE;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#a44d2ff4c88ea8d70d918eb19d715e78a">autorun_flag</a> = 1;</div>
<div class="line">            blur_update_intervals = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (blur_update_intervals &lt; 1) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;The intervals shoud &gt; 0\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            printf(<span class="stringliteral">&quot;The interval is %d\n&quot;</span>, blur_update_intervals);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            show_config_stream_id |= (1 &lt;&lt; current_stream);</div>
<div class="line">            show_config_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div>
<div class="line">            verbose_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> ARBITRARY_BLUR_TEST:</div>
<div class="line">            arbitrary_blur_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_defineRef" target="_blank" href="../../../video/d8/dd9/group__tfsync__parm.html#ga4d23202fab21a02ae940c16d41963591">BLUR_COLOR_INDEX</a>:</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(current_stream);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a>(current_blur_area);</div>
<div class="line">            temp = atoi(optarg);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#adeb635c2f039f23730d7eda1a821b2e3">VERIFY_COLOR_IDX</a>(temp);</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].color_enable = 1;</div>
<div class="line">            stream_info[current_stream].blurs[current_blur_area].color_idx = temp;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            printf(<span class="stringliteral">&quot;unknown option found: %c\n&quot;</span>, ch);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fixed_area_num &amp;&amp; fixed_area_num &lt; blur_max_num) {</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#aa4b91f70818d683d894a673756fe20d3">blur_max_num</a> = fixed_area_num;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> ((stream_info[i].blur_enable == BLUR_ENABLE) &amp;&amp;</div>
<div class="line">            !(show_config_stream_id &amp; (1 &lt;&lt; i)) ) {</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code hl_variableRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#aa4b91f70818d683d894a673756fe20d3">blur_max_num</a>; j++) {</div>
<div class="line">                    <span class="keywordflow">if</span> (stream_info[i].blurs[j].enable) {</div>
<div class="line">                        error_flag[i] = 1;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (!error_flag[i]) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Error usage! Need to specify blur area for &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;stream %c\n&quot;</span>, <span class="charliteral">&#39;A&#39;</span> + i);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> show_blur_config(<span class="keywordtype">int</span> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>blur_stream_cfg stream_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span>blur_area_cfg *area;</div>
<div class="line">    <span class="keywordtype">int</span> i, j;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; ++i) {</div>
<div class="line">        <span class="keywordflow">if</span> (stream_id &amp; (1 &lt;&lt; i)) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;\n  Stream %c blur configuration :\n&quot;</span>, <span class="charliteral">&#39;A&#39;</span> + i);</div>
<div class="line">            stream_cfg.stream_id = i;</div>
<div class="line">            <span class="keywordflow">if</span> (blur_get_stream_cfg(&amp;stream_cfg) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code hl_variableRef" target="_blank" href="../../../video/d2/d3c/blur__cfg_8c.html#aa4b91f70818d683d894a673756fe20d3">blur_max_num</a>; ++j) {</div>
<div class="line">                area = &amp;stream_cfg.area[j];</div>
<div class="line">                printf(<span class="stringliteral">&quot;    Area [%d] : size [%dx%d], offset [%dx%d].\n&quot;</span>,</div>
<div class="line">                    j, area-&gt;act_width, area-&gt;act_height, area-&gt;start_x, area-&gt;start_y);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sigstop()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>blur_apply_cfg apply = {0};</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (stream_info[i].blur_enable == BLUR_ENABLE) {</div>
<div class="line">            blur_insert[i].enable = 0;</div>
<div class="line">            blur_insert[i].stream_id = i;</div>
<div class="line">            apply.stream_map |= (1 &lt;&lt; i);</div>
<div class="line">            <span class="keywordflow">if</span> (blur_set_stream_cfg(&amp;blur_insert[i]) &lt; 0) {</div>
<div class="line">                exit(-1);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    blur_apply(&amp;apply);</div>
<div class="line"> </div>
<div class="line">    exit(0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> set_blur_color(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    blur_set_color(&amp;blur_color_info);</div>
<div class="line">    blur_get_color(&amp;blur_color_info);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;Blur Color Table:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a id="a61" name="a61"></a><a class="code hl_define" href="../../dummy.html">MAX_NUM_BLUR_COLOR</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> ((1 &lt;&lt; i) &amp; blur_color_info.color_idx_map) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;  Color Idx[%2d]: U = %3d, V = %3d.\n&quot;</span>, i, blur_color_info.U[i],</div>
<div class="line">                blur_color_info.V[i]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> fill_arb_blur_mem(<span class="keyword">struct</span> blur_area_buf* buf_info, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> blur_width, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> blur_height)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *row = NULL, *column = NULL, value = 0;</div>
<div class="line">    <span class="keywordtype">int</span> <a id="a62" name="a62"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a> = 0, start_x = 0, left = 0, right = 0, left_remain = 0, right_remain = 0;</div>
<div class="line"> </div>
<div class="line">    memset(buf_info-&gt;addr, 0xFF, buf_info-&gt;size);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; blur_height; i++) {</div>
<div class="line">        row = buf_info-&gt;addr + buf_info-&gt;pitch * i;</div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; (blur_height / 2)) {</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a> = (i * 2 * blur_width) / blur_height;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a> = (2 * blur_width * (blur_height - i)) / blur_height;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        start_x = (blur_width - <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a>) / 2;</div>
<div class="line">        left = start_x / 8;</div>
<div class="line">        left_remain = start_x % 8;</div>
<div class="line">        right = (start_x + <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a>) / 8;</div>
<div class="line">        right_remain = (start_x + <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a>) % 8;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((left == right) &amp;&amp; (<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a> &lt; 8)) {</div>
<div class="line">            column = row + left;</div>
<div class="line">            value = 0xFF;</div>
<div class="line">            value &lt;&lt;= (left_remain + <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a>);</div>
<div class="line">            value |= (0xFF &gt;&gt; (8 - left_remain));</div>
<div class="line">            *column = value;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (left_remain) {</div>
<div class="line">                column = row + left;</div>
<div class="line">                *column = (0xFF &gt;&gt; (8 - left_remain));</div>
<div class="line"> </div>
<div class="line">                column = row + left + 1;</div>
<div class="line">                memset(column, 0x00, right - left - 1);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                column = row + left;</div>
<div class="line">                memset(column, 0x00, right - left);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (right_remain) {</div>
<div class="line">                column = row + right;</div>
<div class="line">                *column = (0xFF &lt;&lt; right_remain);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> arbitrary_blur_demo()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>blur_mem_cfg mem_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span>blur_area_mem_cfg *area_mem_cfg = NULL;</div>
<div class="line">    <span class="keyword">struct </span>blur_stream_cfg stream_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a> stream = {0};</div>
<div class="line">    <span class="keyword">struct </span>blur_area_buf buf_info = {0};</div>
<div class="line">    <span class="keyword">struct </span>blur_apply_cfg apply = {0};</div>
<div class="line">    <span class="keywordtype">int</span> frame_count = 0;</div>
<div class="line">    <span class="keywordtype">int</span> act_width = 0, act_height = 0, max_width = 0, max_height = 0, win_width = 0,</div>
<div class="line">        win_height = 0;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define ARB_BLUR_DEMO_MAX_AREA_WIDTH    (512)</span></div>
<div class="line"><span class="preprocessor">#define ARB_BLUR_DEMO_MAX_AREA_HEIGHT   (512)</span></div>
<div class="line"><span class="preprocessor">#define ARB_BLUR_DEMO_MIN_AREA_WIDTH    (128)</span></div>
<div class="line"><span class="preprocessor">#define ARB_BLUR_DEMO_MIN_AREA_HEIGHT   (128)</span></div>
<div class="line"><span class="preprocessor">#define ARB_BLUR_DEMO_UPDATE_FREQUENCY  (3)</span></div>
<div class="line"><span class="preprocessor">#define ARB_BLUR_DEMO_AREA_BUF_NUM      (5)</span></div>
<div class="line"> </div>
<div class="line">    memset(&amp;mem_cfg, 0, <span class="keyword">sizeof</span>(mem_cfg));</div>
<div class="line">    mem_cfg.max_area_num[0] = 1;</div>
<div class="line">    area_mem_cfg = &amp;mem_cfg.area[0][0];</div>
<div class="line">    area_mem_cfg-&gt;use_arb_blur = 1;</div>
<div class="line">    area_mem_cfg-&gt;buf_num = ARB_BLUR_DEMO_AREA_BUF_NUM;</div>
<div class="line">    area_mem_cfg-&gt;max_width = max_width = ARB_BLUR_DEMO_MAX_AREA_WIDTH;</div>
<div class="line">    area_mem_cfg-&gt;max_height = max_height = ARB_BLUR_DEMO_MAX_AREA_HEIGHT;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (blur_set_mem_cfg(&amp;mem_cfg) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Config blur memory failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset(&amp;stream, 0, <span class="keyword">sizeof</span>(stream));</div>
<div class="line">    stream.<a id="a63" name="a63"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a76f8ba65ce8f902c0657233adee58698">id</a> = 0;</div>
<div class="line">    stream.<a id="a64" name="a64"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48">IAV_STMCFG_FORMAT</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_GET_STREAM_CONFIG&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    win_width = stream.<a id="a65" name="a65"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a66" name="a66"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a5bb1fba0f3a88ad9073998a5bc34dcce">format</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">enc_win</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">    win_height = stream.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a5bb1fba0f3a88ad9073998a5bc34dcce">format</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">enc_win</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (win_width &lt;= max_width || win_height &lt;= max_height) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Stream resolution %dx%d is not enough for arbitrary blur demo,&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;The resolution should bigger than %dx%d\n&quot;</span>, win_width, win_height,</div>
<div class="line">            max_width, max_height);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    srand(time(NULL));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        stream_cfg.stream_id = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (blur_get_stream_cfg(&amp;stream_cfg) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Get stream %d failed\n&quot;</span>, stream_cfg.stream_id);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        stream_cfg.enable = 1;</div>
<div class="line">        stream_cfg.act_area_num = 1;</div>
<div class="line">        stream_cfg.area[0].enable = 1;</div>
<div class="line">        stream_cfg.area[0].strength = 2;</div>
<div class="line">        stream_cfg.area[0].is_blocky = 1;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.area[0].start_x = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(0, win_width - max_width), BLUR_OFFSET_ALIGN);</div>
<div class="line">        stream_cfg.area[0].start_y = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(0, win_height - max_height), BLUR_OFFSET_ALIGN);</div>
<div class="line">        stream_cfg.area[0].act_width = act_width =</div>
<div class="line">            <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(ARB_BLUR_DEMO_MIN_AREA_WIDTH, max_width), BLUR_WIDTH_ALIGN);</div>
<div class="line">        stream_cfg.area[0].act_height = act_height =</div>
<div class="line">            <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(ARB_BLUR_DEMO_MIN_AREA_HEIGHT, max_height), BLUR_HEIGHT_ALIGN);</div>
<div class="line"> </div>
<div class="line">        memset(&amp;buf_info, 0, <span class="keyword">sizeof</span>(buf_info));</div>
<div class="line">        buf_info.stream_id = 0;</div>
<div class="line">        buf_info.area_id = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (blur_get_area_buf(&amp;buf_info) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Get stream %d area %d failed\n&quot;</span>, buf_info.stream_id,</div>
<div class="line">                buf_info.area_id);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        fill_arb_blur_mem(&amp;buf_info, act_width, act_height);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (blur_put_area_buf(&amp;buf_info) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Put stream %d area %d failed\n&quot;</span>, buf_info.stream_id,</div>
<div class="line">                buf_info.area_id);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (blur_set_stream_cfg(&amp;stream_cfg) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Set stream %d failed\n&quot;</span>, stream_cfg.stream_id);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        apply.stream_map = 1;</div>
<div class="line">        <span class="keywordflow">if</span> (blur_apply(&amp;apply) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Apply blur failed\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot;Update area at (%d,%d) size %dx%d.\n&quot;</span>, stream_cfg.area[0].start_x,</div>
<div class="line">            stream_cfg.area[0].start_y, stream_cfg.area[0].act_width,</div>
<div class="line">            stream_cfg.area[0].act_height);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (frame_count &lt; ARB_BLUR_DEMO_UPDATE_FREQUENCY) {</div>
<div class="line">            ioctl(fd_iav, <a id="a67" name="a67"></a>IAV_IOC_WAIT_NEXT_IDSP_FRAME, 1);</div>
<div class="line">            frame_count++;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        frame_count = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a68" name="a68"></a><a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, j, i_mode_area_cnt = 0, rval = 0;</div>
<div class="line"> </div>
<div class="line">    signal(SIGINT, sigstop);</div>
<div class="line">    signal(SIGQUIT, sigstop);</div>
<div class="line">    signal(SIGTERM, sigstop);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((fd_iav = open(<span class="stringliteral">&quot;/dev/iav&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;/dev/iav&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (blur_lib_init(fd_iav) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Init Blur Lib failed\n&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        usage();</div>
<div class="line">        <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (init_param(argc, argv) &lt; 0) {</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (blur_color_info.color_idx_map) {</div>
<div class="line">        <span class="keywordflow">if</span> (set_blur_color() &lt; 0) {</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (arbitrary_blur_flag) {</div>
<div class="line">        arbitrary_blur_demo();</div>
<div class="line">        <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (show_config_flag || autorun_flag || <a id="a69" name="a69"></a>is_blur_changed()) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a70" name="a70"></a>check_encode_status_for_blur() &lt; 0) {</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (show_config_flag) {</div>
<div class="line">        show_blur_config(show_config_stream_id);</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (autorun_flag) {</div>
<div class="line">        autorun_blur();</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_blur_changed()){</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a71" name="a71"></a>prepare_blur_config() &lt; 0) {</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (stream_info[i].blur_enable != INIT) {</div>
<div class="line">                <span class="keywordflow">if</span> (set_blur(i) &lt; 0) {</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (stream_info[i].blur_enable == BLUR_ENABLE) {</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; MAX_BLUR_AREA_NUM; j++) {</div>
<div class="line">                    <span class="keywordflow">if</span> (stream_info[i].blurs[j].i_mode) {</div>
<div class="line">                        <span class="keywordflow">if</span> (!i_mode_area_cnt) {</div>
<div class="line">                            run_blur_interactive_change(i, j);</div>
<div class="line">                            i_mode_area_cnt++;</div>
<div class="line">                        } <span class="keywordflow">else</span> {</div>
<div class="line">                            printf(<span class="stringliteral">&quot;stream %c blur_area[%d]: skip interactive change\n&quot;</span>,</div>
<div class="line">                                <span class="charliteral">&#39;A&#39;</span> + i, j);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// do nothing</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">MAIN_EXIT:</div>
<div class="line">    blur_lib_deinit();</div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="aamba__defines_8h_html"><div class="ttname"><a href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a></div></div>
<div class="ttc" id="aasf__structure_8h_html_a92c50087ca0e64fa93fc59402c55f8ca"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></div><div class="ttdeci">uint8_t u8</div></div>
<div class="ttc" id="aasf__structure_8h_html_ace9d960e74685e2cd84b36132dbbf8aa"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a></div><div class="ttdeci">uint16_t u16</div></div>
<div class="ttc" id="abasetypes_8h_html"><div class="ttname"><a href="../../de/ddc/basetypes_8h.html">basetypes.h</a></div><div class="ttdoc">This file defines basic types used in all IAV driver and header files.</div></div>
<div class="ttc" id="ablur__cfg_8c_html"><div class="ttname"><a href="../../../video/d2/d3c/blur__cfg_8c.html">blur_cfg.c</a></div></div>
<div class="ttc" id="ablur__cfg_8c_html_a059521eb88bc63e9f62739e6588bd0e1"><div class="ttname"><a href="../../../video/d2/d3c/blur__cfg_8c.html#a059521eb88bc63e9f62739e6588bd0e1">VERIFY_IS_BLOCKY</a></div><div class="ttdeci">#define VERIFY_IS_BLOCKY(x)</div></div>
<div class="ttc" id="ablur__cfg_8c_html_a0da00ba61e6311e459f24b178d5f8208"><div class="ttname"><a href="../../../video/d2/d3c/blur__cfg_8c.html#a0da00ba61e6311e459f24b178d5f8208">VERIFY_BLUR_AREAID</a></div><div class="ttdeci">#define VERIFY_BLUR_AREAID(x)</div></div>
<div class="ttc" id="ablur__cfg_8c_html_a43b4989668ab730d7a2a5b5fb7d8d8d6"><div class="ttname"><a href="../../../video/d2/d3c/blur__cfg_8c.html#a43b4989668ab730d7a2a5b5fb7d8d8d6">VERIFY_COEFF</a></div><div class="ttdeci">#define VERIFY_COEFF(x)</div></div>
<div class="ttc" id="ablur__cfg_8c_html_a97b135e062a5d34188d2bdf0e7a273dc"><div class="ttname"><a href="../../../video/d2/d3c/blur__cfg_8c.html#a97b135e062a5d34188d2bdf0e7a273dc">VERIFY_STRENGTH</a></div><div class="ttdeci">#define VERIFY_STRENGTH(x)</div></div>
<div class="ttc" id="ablur__cfg_8c_html_aa4b91f70818d683d894a673756fe20d3"><div class="ttname"><a href="../../../video/d2/d3c/blur__cfg_8c.html#aa4b91f70818d683d894a673756fe20d3">blur_max_num</a></div><div class="ttdeci">int blur_max_num</div></div>
<div class="ttc" id="ablur__cfg_8c_html_adeb635c2f039f23730d7eda1a821b2e3"><div class="ttname"><a href="../../../video/d2/d3c/blur__cfg_8c.html#adeb635c2f039f23730d7eda1a821b2e3">VERIFY_COLOR_IDX</a></div><div class="ttdeci">#define VERIFY_COLOR_IDX(x)</div></div>
<div class="ttc" id="acJSON_8h_html_a03c83e0884e2e3a1783db79f2d67101f"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a></div><div class="ttdeci">char const int length</div></div>
<div class="ttc" id="adummy_html"><div class="ttname"><a href="../../dummy.html">BIT</a></div><div class="ttdeci">#define BIT(n)</div></div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">iav_rect::y</a></div><div class="ttdeci">u32 y</div><div class="ttdoc">Offset Y.</div><div class="ttdef"><b>Definition:</b> basetypes.h:113</div></div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">iav_rect::width</a></div><div class="ttdeci">u32 width</div><div class="ttdoc">Width.</div><div class="ttdef"><b>Definition:</b> basetypes.h:114</div></div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">iav_rect::height</a></div><div class="ttdeci">u32 height</div><div class="ttdoc">Height.</div><div class="ttdef"><b>Definition:</b> basetypes.h:115</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">iav_rect::x</a></div><div class="ttdeci">u32 x</div><div class="ttdoc">Offset X.</div><div class="ttdef"><b>Definition:</b> basetypes.h:112</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a></div><div class="ttdeci">IAV_INFO_STREAM</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a></div><div class="ttdeci">IAV_DESC_CANVAS</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48">IAV_STMCFG_FORMAT</a></div><div class="ttdeci">IAV_STMCFG_FORMAT</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d">IAV_STREAM_STATE_ENCODING</a></div><div class="ttdeci">IAV_STREAM_STATE_ENCODING</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga5a8457a3780c3eb2c9452cae958284e4a6e9d926f59102b9563a722581c65ee55"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a6e9d926f59102b9563a722581c65ee55">IAV_STREAM_STATE_STARTING</a></div><div class="ttdeci">IAV_STREAM_STATE_STARTING</div></div>
<div class="ttc" id="agroup__nnctrl-helper_html_ggaeecd646cca3b6bbcc2f1e15a76ae5c2ea53919c0c9fd8839c409d57093a76ec12"><div class="ttname"><a href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2ea53919c0c9fd8839c409d57093a76ec12">HFLIP_BIT</a></div><div class="ttdeci">HFLIP_BIT</div></div>
<div class="ttc" id="agroup__nnctrl-helper_html_ggaeecd646cca3b6bbcc2f1e15a76ae5c2eaf0d5339194eb23fed5fbfa711240b092"><div class="ttname"><a href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2eaf0d5339194eb23fed5fbfa711240b092">VFLIP_BIT</a></div><div class="ttdeci">VFLIP_BIT</div></div>
<div class="ttc" id="agroup__tfsync__parm_html_ga4d23202fab21a02ae940c16d41963591"><div class="ttname"><a href="../../../video/d8/dd9/group__tfsync__parm.html#ga4d23202fab21a02ae940c16d41963591">BLUR_COLOR_INDEX</a></div><div class="ttdeci">#define BLUR_COLOR_INDEX</div></div>
<div class="ttc" id="aoverlay__cfg_8c_html_a44d2ff4c88ea8d70d918eb19d715e78a"><div class="ttname"><a href="../../../video/d9/dd6/overlay__cfg_8c.html#a44d2ff4c88ea8d70d918eb19d715e78a">autorun_flag</a></div><div class="ttdeci">int autorun_flag</div></div>
<div class="ttc" id="astream__cfg_8c_html_aaf0da9064aaa6054cae10d4cab6884cd"><div class="ttname"><a href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a></div><div class="ttdeci">#define VERIFY_STREAMID(x)</div></div>
<div class="ttc" id="astructhint__s_html"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html">hint_s</a></div></div>
<div class="ttc" id="astructhint__s_html_a2799cca21c05a4f99f4c8b3b178d0133"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">hint_s::str</a></div><div class="ttdeci">const char * str</div></div>
<div class="ttc" id="astructhint__s_html_aa56a50443afd9d2f7cf738fb7ffba168"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">hint_s::arg</a></div><div class="ttdeci">const char * arg</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a></div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_aafd4d0f4f81aa65a6fc3c9ccb2c34bcf"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#aafd4d0f4f81aa65a6fc3c9ccb2c34bcf">iav_canvas_cfg::blur_enable</a></div><div class="ttdeci">u16 blur_enable</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1494</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_ae8cabdc5c24b46705eb7ad5e0fc54660"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">iav_canvas_cfg::canvas_id</a></div><div class="ttdeci">u8 canvas_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1470</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_af078812648ec47b41b3382744c194dcc"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#af078812648ec47b41b3382744c194dcc">iav_canvas_cfg::max_blur_area_num</a></div><div class="ttdeci">u16 max_blur_area_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1496</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_a2f1e22f38f7be358c963bc2a979fbf4d"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">iav_canvasdesc::canvas_id</a></div><div class="ttdeci">u32 canvas_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2263</div></div>
<div class="ttc" id="astructiav__querydesc_html"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a></div></div>
<div class="ttc" id="astructiav__querydesc_html_a8f1abab245b551bdff8a16e77bf819e9"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">iav_querydesc::canvas</a></div><div class="ttdeci">struct iav_canvasdesc canvas</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2419</div></div>
<div class="ttc" id="astructiav__querydesc_html_a99c68192c9905f231a62a98ee6534cbb"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">iav_querydesc::arg</a></div><div class="ttdeci">union iav_querydesc::@71 arg</div></div>
<div class="ttc" id="astructiav__querydesc_html_aa73b12ace6ac7df824707a89ac4f91ff"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#aa73b12ace6ac7df824707a89ac4f91ff">iav_querydesc::qid</a></div><div class="ttdeci">enum iav_desc_id qid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2413</div></div>
<div class="ttc" id="astructiav__queryinfo_html"><div class="ttname"><a href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a></div></div>
<div class="ttc" id="astructiav__stream__cfg_html"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a></div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a24b75dd5c1c952bb423d2e086b7803d1"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">iav_stream_cfg::arg</a></div><div class="ttdeci">union iav_stream_cfg::@81 arg</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a5bb1fba0f3a88ad9073998a5bc34dcce"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a5bb1fba0f3a88ad9073998a5bc34dcce">iav_stream_cfg::format</a></div><div class="ttdeci">struct iav_stream_format format</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3119</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a76f8ba65ce8f902c0657233adee58698"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a76f8ba65ce8f902c0657233adee58698">iav_stream_cfg::id</a></div><div class="ttdeci">u32 id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3116</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_afdc3860fa7139e471735ca9e51485c4c"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">iav_stream_cfg::cid</a></div><div class="ttdeci">enum iav_streamcfg_id cid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3117</div></div>
<div class="ttc" id="astructiav__stream__format_html"><div class="ttname"><a href="../../../library/dd/d8d/structiav__stream__format.html">iav_stream_format</a></div></div>
<div class="ttc" id="astructiav__stream__format_html_a484522517e5e2458148cdd9a91f819ab"><div class="ttname"><a href="../../../library/dd/d8d/structiav__stream__format.html#a484522517e5e2458148cdd9a91f819ab">iav_stream_format::enc_src_id</a></div><div class="ttdeci">u32 enc_src_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2557</div></div>
<div class="ttc" id="astructiav__stream__format_html_a65ef0c6089bb9f2e7ac25171c2a27dae"><div class="ttname"><a href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">iav_stream_format::enc_win</a></div><div class="ttdeci">struct iav_rect enc_win</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2555</div></div>
<div class="ttc" id="astructiav__stream__info_html"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html">iav_stream_info</a></div></div>
<div class="ttc" id="astructiav__stream__info_html_a76f8ba65ce8f902c0657233adee58698"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html#a76f8ba65ce8f902c0657233adee58698">iav_stream_info::id</a></div><div class="ttdeci">u32 id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1075</div></div>
<div class="ttc" id="astructiav__stream__info_html_ac78453cf0c29f2b9c40cfb142185d7d9"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html#ac78453cf0c29f2b9c40cfb142185d7d9">iav_stream_info::state</a></div><div class="ttdeci">enum iav_stream_state state</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1076</div></div>
<div class="ttc" id="atest__fb_8h_html_a2d0022791143e08a64621257f48d9739"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a></div><div class="ttdeci">#define NO_ARG</div></div>
<div class="ttc" id="atest__fb_8h_html_affec572f11fcba59ce0cd49cbcd0110f"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a></div><div class="ttdeci">#define HAS_ARG</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
<div class="ttc" id="avin__init_8c_html_a5294002f7dca0cd9bcc0009a27895ef7"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a></div><div class="ttdeci">int fd_iav</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
