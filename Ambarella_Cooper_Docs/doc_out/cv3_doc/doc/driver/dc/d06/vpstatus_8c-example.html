<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driver: vpstatus.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Driver"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Driver<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dc/d06/vpstatus_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">vpstatus.c</div></div>
</div><!--header-->
<div class="contents">
<p >This is a source code file of vpstatus.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;malloc.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;os_wrap.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define REG_ENTRY_TABLES</span></div>
<div class="line"><span class="preprocessor">#include &quot;reg_tables.h&quot;</span></div>
<div class="line"><span class="preprocessor">#define GVP_NUM 2</span></div>
<div class="line"><span class="preprocessor">#define NVP_NUM 6</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_summary(<span class="keyword">const</span> reg_agent_t *ra, uint32_t vp,    uint32_t <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">void</span> print_reg(<span class="keyword">const</span> reg_agent_t *ra, <span class="keyword">const</span> <span class="keywordtype">char</span> *reg_name, uint32_t <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">void</span> dump_vp_regs (<span class="keyword">const</span> reg_agent_t *ra, <span class="keyword">const</span> <span class="keywordtype">char</span> *file_name, uint8_t is_gvp, uint8_t vpinst);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    STAT_VOID,</div>
<div class="line">    STAT_SUMMARY,</div>
<div class="line">    STAT_QUERY,</div>
<div class="line">    STAT_DUMP</div>
<div class="line">} STAT_ACTION;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    uint8_t     is_gvp;</div>
<div class="line">    uint8_t     vpinst;</div>
<div class="line">    STAT_ACTION action;</div>
<div class="line">    uint8_t     is_vp;</div>
<div class="line">    <span class="keywordtype">char</span>        reg_name[32];</div>
<div class="line">    <span class="keywordtype">char</span>        debug_file[256];</div>
<div class="line">} cli_args_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a id="a0" name="a0"></a>usage(<span class="keyword">const</span> <span class="keywordtype">char</span> *exe)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nusage: %s [args]\n&quot;</span>, exe);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\t-g arg[0|1]: is_gvp [nvp|gvp]\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\t-v arg[0-2]: vp instance [gvp0-1|nvp0-2]\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\t-s arg[0|1]: summary of  [vorc|vp]\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\t-n arg: name of the register to read\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\t-d arg: file name of the debug registers\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define OPTIONS &quot;g:v:s:n:d:h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parse_cli(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv, cli_args_t *cli_arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> c;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(argc &lt; 2) {</div>
<div class="line">        usage(argv[0]);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    cli_arg-&gt;is_gvp    = 0;</div>
<div class="line">    cli_arg-&gt;vpinst    = 0;</div>
<div class="line">    cli_arg-&gt;action   = STAT_VOID;</div>
<div class="line">    uint8_t g_cfged = 0;</div>
<div class="line">    uint8_t v_cfged = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> ((c = getopt(argc, argv, OPTIONS)) != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (c) {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:</div>
<div class="line">            cli_arg-&gt;is_gvp = !!strtoul(optarg, NULL, 0);</div>
<div class="line">            g_cfged = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div>
<div class="line">            cli_arg-&gt;vpinst = strtoul(optarg, NULL, 0);</div>
<div class="line">            v_cfged = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">            cli_arg-&gt;action = STAT_SUMMARY;</div>
<div class="line">            cli_arg-&gt;is_vp   = strtoul(optarg, NULL, 0);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line">            cli_arg-&gt;action = STAT_QUERY;</div>
<div class="line">            snprintf(cli_arg-&gt;reg_name, <span class="keyword">sizeof</span>(cli_arg-&gt;reg_name), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line">            cli_arg-&gt;action = STAT_DUMP;</div>
<div class="line">            snprintf(cli_arg-&gt;debug_file, <span class="keyword">sizeof</span>(cli_arg-&gt;debug_file), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">            usage(argv[0]);</div>
<div class="line">            <span class="keywordflow">return</span> 2;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c arg not support.\n&quot;</span>, c);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>( !g_cfged || !v_cfged) {</div>
<div class="line">      printf(<span class="stringliteral">&quot;-g or -v is missing.\n&quot;</span>);</div>
<div class="line">      usage(argv[0]);</div>
<div class="line">      <span class="keywordflow">return</span> 2;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>((cli_arg-&gt;is_gvp  &amp;&amp; cli_arg-&gt;vpinst &gt; 1) ||</div>
<div class="line">       (!cli_arg-&gt;is_gvp &amp;&amp; cli_arg-&gt;vpinst &gt; 2)) {</div>
<div class="line">      printf(<span class="stringliteral">&quot;-v arg is illegal.\n&quot;</span>);</div>
<div class="line">      usage(argv[0]);</div>
<div class="line">      <span class="keywordflow">return</span> 2;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a1" name="a1"></a><a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">   cli_args_t cli;</div>
<div class="line">   reg_agent_t ra;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> ( parse_cli(argc, argv, &amp;cli) || cli.action == STAT_VOID)</div>
<div class="line">       <span class="keywordflow">return</span> 1;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    open_reg_agent(&amp;ra );</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">switch</span>(cli.action) {</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> STAT_SUMMARY:</div>
<div class="line">            print_summary(&amp;ra, cli.is_vp, cli.vpinst);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> STAT_QUERY:</div>
<div class="line">            print_reg (&amp;ra, cli.reg_name, cli.vpinst);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> STAT_DUMP:</div>
<div class="line">            dump_vp_regs(&amp;ra, cli.debug_file, cli.is_gvp, cli.vpinst);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">       <span class="keywordflow">default</span>:</div>
<div class="line">           printf(<span class="stringliteral">&quot;%s : cli.action not support\n&quot;</span>, __func__);</div>
<div class="line">           <span class="keywordflow">break</span>;</div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">    close_reg_agent(&amp;ra );</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> uint32_t read_bits(<span class="keyword">const</span> reg_agent_t *p, uint32_t addr, uint32_t bpos, uint32_t bsize)</div>
<div class="line">{</div>
<div class="line">    uint32_t m;</div>
<div class="line">    uint32_t v;</div>
<div class="line">    uint32_t bsize_new = bsize;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>((bpos + bsize_new) &gt; 32U) {</div>
<div class="line">        uint32_t t;</div>
<div class="line">        uint32_t r = 32U-bpos;</div>
<div class="line"> </div>
<div class="line">        t = readl (p, addr);</div>
<div class="line">        v = t &gt;&gt; bpos;</div>
<div class="line"> </div>
<div class="line">        bsize_new -= r;</div>
<div class="line">        m = ((uint32_t)1U&lt;&lt; bsize_new) - 1U;</div>
<div class="line"> </div>
<div class="line">        t = readl (p, addr+1U);</div>
<div class="line">        v |= (t &amp; m) &lt;&lt; r;</div>
<div class="line"> </div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        m = ((uint32_t)1U &lt;&lt; bsize_new) - 1U;</div>
<div class="line">        v = readl (p, addr);</div>
<div class="line">        v = (v&gt;&gt;bpos) &amp; m;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> v;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> next_bit_pos (uint32_t *wa, uint32_t *bpos, int32_t offset)</div>
<div class="line">{</div>
<div class="line">    int32_t <a id="a2" name="a2"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a>, b_wa;</div>
<div class="line">    <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> = (int32_t)*bpos + offset;</div>
<div class="line">    b_wa = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> / 32;</div>
<div class="line">    <span class="keywordflow">if</span> (b &lt; 0) {</div>
<div class="line">        *wa = *wa + (uint32_t)b_wa - 1U;</div>
<div class="line">        *bpos = (uint32_t)b &amp; 0x1fU;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        *wa = *wa + (uint32_t)b_wa;</div>
<div class="line">        *bpos = (uint32_t)b &amp; 0x1fU;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> output_one_reg(<span class="keyword">const</span> reg_agent_t *ra, reg_entry_t <span class="keyword">const</span> *r, uint32_t <span class="keywordtype">id</span>)</div>
<div class="line">{</div>
<div class="line">    uint32_t base;</div>
<div class="line">    uint32_t value;</div>
<div class="line">    int32_t i, j;</div>
<div class="line">    int32_t w, h, s;</div>
<div class="line">    uint32_t p, a;</div>
<div class="line">    int32_t pitch;</div>
<div class="line">    uint32_t row_addr;</div>
<div class="line">    uint32_t row_bpos;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == 0U) {</div>
<div class="line">        base = 0U;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        base = 0x100000U;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span>(r-&gt;type) {</div>
<div class="line">        <span class="keywordflow">case</span> REG_SCALAR:</div>
<div class="line">            value = readl(ra, r-&gt;addr + base);</div>
<div class="line">            printf(<span class="stringliteral">&quot;%-32s = 0x%x\n&quot;</span>, r-&gt;name, value);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> REG_ARRAY_1D:</div>
<div class="line">            w = r-&gt;width;</div>
<div class="line">            s = r-&gt;size_in_bits;</div>
<div class="line">            p = r-&gt;offset_in_bits;</div>
<div class="line">            a = r-&gt;addr;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(w &lt; 0) {</div>
<div class="line">                w = -w;</div>
<div class="line">                s = -s;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span>(i = 0; i &lt; w; i++) {</div>
<div class="line">                 value = read_bits(ra, a, p, (uint32_t)r-&gt;size_in_bits);</div>
<div class="line">                 printf(<span class="stringliteral">&quot;\t%s[%d] = 0x%x\n&quot;</span>, r-&gt;name, i, value);</div>
<div class="line"> </div>
<div class="line">                 next_bit_pos(&amp;a, &amp;p, s);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> REG_ARRAY_2D:</div>
<div class="line">            w = r-&gt;width;</div>
<div class="line">            h = r-&gt;height;</div>
<div class="line">            s = r-&gt;size_in_bits;</div>
<div class="line">            pitch = r-&gt;pitch;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(w &lt; 0) {</div>
<div class="line">                w = -w;</div>
<div class="line">                s = -s;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(h &lt; 0) {</div>
<div class="line">                h = -h;</div>
<div class="line">                pitch = -pitch;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            row_addr = r-&gt;addr;</div>
<div class="line">            row_bpos = r-&gt;offset_in_bits;</div>
<div class="line">            <span class="keywordflow">for</span>(j = 0; j &lt; h; j++) {</div>
<div class="line">                <span class="keywordflow">for</span>(i = 0; i &lt; w; i++) {</div>
<div class="line">                    a = row_addr;</div>
<div class="line">                    p = row_bpos;</div>
<div class="line"> </div>
<div class="line">                    value = read_bits(ra, a, p, (uint32_t)r-&gt;size_in_bits);</div>
<div class="line">                    printf(<span class="stringliteral">&quot;\t\t%s[%d][%d] = 0x%x\n&quot;</span>, r-&gt;name, j, i, value);</div>
<div class="line">                    next_bit_pos(&amp;a, &amp;p, s);</div>
<div class="line">                }</div>
<div class="line">                next_bit_pos(&amp;row_addr,  &amp;row_bpos, pitch);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_summary(<span class="keyword">const</span> reg_agent_t *ra, uint32_t vp, uint32_t <span class="keywordtype">id</span>)</div>
<div class="line">{</div>
<div class="line">    reg_entry_t <span class="keyword">const</span> *r;</div>
<div class="line">    uint32_t     tbl_size,i, new_id = id;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a3" name="a3"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(vp != 0U) {</div>
<div class="line">        r = &amp;vp_regs[0];</div>
<div class="line">        tbl_size =  (uint32_t)(<span class="keyword">sizeof</span>(vp_regs)/<span class="keyword">sizeof</span>(vp_regs[0]));</div>
<div class="line">        <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == 0U) {</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a> = <span class="stringliteral">&quot;VP0&quot;</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a> = <span class="stringliteral">&quot;VP1&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        r = &amp;orc_regs[0];</div>
<div class="line">        tbl_size = (uint32_t)(<span class="keyword">sizeof</span>(orc_regs)/<span class="keyword">sizeof</span>(orc_regs[0]));</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a> = <span class="stringliteral">&quot;VORC&quot;</span>;</div>
<div class="line">        new_id = 0U;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\n\n -------------------------     Summy of %-5s  Status&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;     -------------------------\n\n&quot;</span>,</div>
<div class="line">           name);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0U; i &lt; tbl_size; i++) {</div>
<div class="line">        output_one_reg(ra, r, new_id);</div>
<div class="line">        r = &amp;r[1];</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_reg(<span class="keyword">const</span> reg_agent_t *ra, <span class="keyword">const</span> <span class="keywordtype">char</span> *reg_name, uint32_t <span class="keywordtype">id</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> reg_entry_t *tbl[2];</div>
<div class="line">    uint32_t     tbl_size[2];</div>
<div class="line">    uint32_t     found = 0U,i,j;</div>
<div class="line"> </div>
<div class="line">    tbl[0] = &amp;vp_regs[0];</div>
<div class="line">    tbl[1] = &amp;orc_regs[0];</div>
<div class="line"> </div>
<div class="line">    tbl_size[0] = (uint32_t)(<span class="keyword">sizeof</span>(vp_regs)/<span class="keyword">sizeof</span>(vp_regs[0]));</div>
<div class="line">    tbl_size[1] = (uint32_t)(<span class="keyword">sizeof</span>(orc_regs)/<span class="keyword">sizeof</span>(orc_regs[0]));</div>
<div class="line">    <span class="keywordflow">for</span> (j = 0U; j &lt; 2U ; j++) {</div>
<div class="line">        <span class="keywordflow">if</span>(found == 0U) {</div>
<div class="line">            reg_entry_t <span class="keyword">const</span>  *r = tbl[j];</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0U; i &lt; tbl_size[j]; i++) {</div>
<div class="line">                <span class="keywordflow">if</span>( strcmp(reg_name, &amp;r-&gt;name[0]) == 0) {</div>
<div class="line">                    output_one_reg(ra, r, <span class="keywordtype">id</span>);</div>
<div class="line">                    found = 1U;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                r = &amp;r[1];</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(found == 0U) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;cannot find register %s\n&quot;</span>, reg_name);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define  DBGREG_SIZE      0x931014U</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> dump_vp_regs(<span class="keyword">const</span> reg_agent_t *ra, <span class="keyword">const</span> <span class="keywordtype">char</span>* file_name, uint8_t is_gvp, uint8_t vpinst)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">        uint32_t   vp;</div>
<div class="line">        uint32_t   vmem;</div>
<div class="line">        uint32_t   vorc;</div>
<div class="line">    }</div>
<div class="line">    baseaddr_t;</div>
<div class="line"> </div>
<div class="line">    FILE_WRAP *dbg_file;</div>
<div class="line">    uint32_t cycles = 0, pre_cycles = 0;</div>
<div class="line">    <span class="keyword">static</span> uint8_t reg_dbase[DBGREG_SIZE];</div>
<div class="line">    uint8_t *dbase = reg_dbase;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> baseaddr_t baseaddrs[] = {</div>
<div class="line">        {0xed510000U, 0xed530000U, 0xed520000U}, <span class="comment">//gvp0</span></div>
<div class="line">        {0xed550000U, 0xed570000U, 0xed560000U}, <span class="comment">//gvp1</span></div>
<div class="line">        {0xed430000U, 0xed5a0000U, 0xed440000U}, <span class="comment">//nvp0</span></div>
<div class="line">        {0xed460000U, 0xed5b0000U, 0xed470000U}, <span class="comment">//nvp1</span></div>
<div class="line">        {0xed490000U, 0xed5c0000U, 0xed4a0000U}, <span class="comment">//nvp2</span></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    uint8_t b_idx = vpinst + ((is_gvp != 0U) ? 0U : 2U);</div>
<div class="line">    uint32_t vp_baseaddr = baseaddrs[b_idx].vp;</div>
<div class="line">    uint32_t vmem_baseaddr = baseaddrs[b_idx].vmem;</div>
<div class="line">    uint32_t vorc_baseaddr = baseaddrs[b_idx].vorc;</div>
<div class="line">    uint32_t vmem_size = (is_gvp != 0U) ? 0x200000U : 0x800000U;</div>
<div class="line">    uint32_t vmem_dbg_size = (is_gvp != 0U) ? 0x1d000U : 0x31000U;</div>
<div class="line">    uint32_t num_vmb = (is_gvp != 0U) ? 384U : 1024U;</div>
<div class="line">    uint32_t vp_debug_space_size = 0x100000U;</div>
<div class="line">    uint32_t vorc_dbg_size = 16U;</div>
<div class="line">    uint32_t vp_baseaddr_size = 4U;</div>
<div class="line">    uint32_t block_size = (uint32_t)1U &lt;&lt; 16U;</div>
<div class="line">    uint32_t vp_page_reg = vp_baseaddr + 0x14U;</div>
<div class="line">    uint32_t vp_dp_access = vp_baseaddr + 0x7000U;</div>
<div class="line">    uint32_t dp_size = 0x1000;</div>
<div class="line">    uint32_t num_dp = (is_gvp != 0U) ? 8U : 11U;</div>
<div class="line">    uint32_t hmem_read_access = vp_baseaddr + 0x8000U;</div>
<div class="line">    uint32_t hmem_page_size = (uint32_t)1U &lt;&lt; 15U;</div>
<div class="line">    uint32_t data_size;</div>
<div class="line"> </div>
<div class="line">    memset(reg_dbase, 0, <span class="keyword">sizeof</span>(reg_dbase));</div>
<div class="line">    writel(ra, vp_baseaddr + 0x40U, 0x200000U);</div>
<div class="line">    pre_cycles = readl(ra, vp_baseaddr + 0x148);</div>
<div class="line">    <span class="keywordflow">while</span>(1)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">//latch</span></div>
<div class="line">      writel(ra, vp_baseaddr + 0x40U, 0x200000U);</div>
<div class="line">      cycles = readl(ra, vp_baseaddr + 0x148);</div>
<div class="line">      <span class="keywordflow">if</span> (pre_cycles == cycles) {</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        pre_cycles = cycles;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;cycles = 0x%x\n&quot;</span>, cycles);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//1, dump vmem</span></div>
<div class="line">    {</div>
<div class="line">      uint32_t vmem_page_reg = vmem_baseaddr + 0xcU;</div>
<div class="line">      uint32_t pmem_read_access = vmem_baseaddr + 0x8000U;</div>
<div class="line">      uint32_t vmem_page_size = (uint32_t)1U &lt;&lt; 15U;</div>
<div class="line">      <span class="keywordflow">for</span>( uint32_t addr = 0; addr &lt; vmem_size; addr += vmem_page_size) {</div>
<div class="line">          uint32_t pmem_page = addr / vmem_page_size;</div>
<div class="line">          writel(ra, vmem_page_reg, pmem_page &lt;&lt; 16); <span class="comment">//[24:16] pmem_page (32KB page)</span></div>
<div class="line">          read_buf(ra, pmem_read_access, vmem_page_size, dbase);</div>
<div class="line">          dbase = &amp;dbase[vmem_page_size];</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//1.1 vmem debug space</span></div>
<div class="line">    {</div>
<div class="line">      uint32_t common_reg_size = 0x1000;</div>
<div class="line">      uint32_t vmem_page_reg = vmem_baseaddr + 0xcU;</div>
<div class="line">      uint32_t client_size = 256;</div>
<div class="line">      uint32_t word_size = 4;</div>
<div class="line">      uint32_t client_access = vmem_baseaddr + 0x3044U;</div>
<div class="line">      uint32_t vcfg_size = 0x4000;</div>
<div class="line">      uint32_t vcfg_access = vmem_baseaddr + 0x4000U;</div>
<div class="line"> </div>
<div class="line">      read_buf(ra, vmem_baseaddr, common_reg_size, dbase);</div>
<div class="line">      dbase = &amp;dbase[common_reg_size];</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span>( uint32_t cid = 0; cid &lt; 256U; cid++) {</div>
<div class="line">          writel(ra, vmem_page_reg, cid); <span class="comment">//[9:0] dbg_client</span></div>
<div class="line">          <span class="keywordflow">for</span>(uint32_t bytes = 0; bytes &lt; client_size; bytes += word_size) {</div>
<div class="line">              read_buf(ra, client_access + bytes, word_size, dbase);</div>
<div class="line">              dbase = &amp;dbase[word_size];</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span>( uint32_t vcfg_page = 0; vcfg_page &lt; num_vmb/128; vcfg_page++) {</div>
<div class="line">          writel(ra, vmem_page_reg, vcfg_page &lt;&lt; 12); <span class="comment">//[14;12] vcfg_page</span></div>
<div class="line">          read_buf(ra, vcfg_access, vcfg_size, dbase);</div>
<div class="line">          dbase = &amp;dbase[vcfg_size];</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//2 dump debug space</span></div>
<div class="line">    <span class="comment">//2.1 dump first 64KB</span></div>
<div class="line">    read_buf(ra, vp_baseaddr, block_size, dbase);</div>
<div class="line">    dbase = &amp;dbase[block_size];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//2.2 dump dps</span></div>
<div class="line">    <span class="keywordflow">for</span>(uint32_t dp_num = 0; dp_num &lt; num_dp; dp_num++) {</div>
<div class="line">        writel(ra, vp_page_reg, dp_num); <span class="comment">//[3:0] dp_num (DP select)</span></div>
<div class="line">        read_buf(ra, vp_dp_access, dp_size, dbase);</div>
<div class="line">        dbase = &amp;dbase[dp_size];</div>
<div class="line">    }</div>
<div class="line">    dbase = &amp;reg_dbase[vmem_size + vmem_dbg_size +0x20000U];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//2.3 dump Main</span></div>
<div class="line">    <span class="keywordflow">for</span>(uint32_t addr = 0x20000U; addr &lt; 0x100000U; addr += hmem_page_size) {</div>
<div class="line">        uint32_t mem_msb = addr &gt;&gt; 15;</div>
<div class="line">        writel(ra, vp_page_reg, mem_msb &lt;&lt; 15); <span class="comment">//[19:15] mem_msb</span></div>
<div class="line">        read_buf(ra, hmem_read_access, hmem_page_size, dbase);</div>
<div class="line">        dbase = &amp;dbase[hmem_page_size];</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//3, vorc 0x30-0x3c</span></div>
<div class="line">    read_buf(ra, vorc_baseaddr + 0x30, vorc_dbg_size, dbase);</div>
<div class="line">    dbase = &amp;dbase[vorc_dbg_size];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//4 append vp_baseaddr</span></div>
<div class="line">    *(uint32_t *)dbase = vp_baseaddr;</div>
<div class="line"> </div>
<div class="line">    dbg_file = fopen_wrap(file_name, <span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(dbg_file == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;cannot open file %s for writing!\n&quot;</span>, file_name);</div>
<div class="line">        exit(-1);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        dbase = reg_dbase;</div>
<div class="line">        data_size = vmem_size + \</div>
<div class="line">                        vmem_dbg_size + \</div>
<div class="line">                        vp_debug_space_size + \</div>
<div class="line">                        vorc_dbg_size + \</div>
<div class="line">                        vp_baseaddr_size;</div>
<div class="line">        (void) fwrite_wrap(dbase, (uint32_t)<span class="keyword">sizeof</span>(uint8_t), data_size, dbg_file);</div>
<div class="line">        (void) fclose_wrap(dbg_file);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
