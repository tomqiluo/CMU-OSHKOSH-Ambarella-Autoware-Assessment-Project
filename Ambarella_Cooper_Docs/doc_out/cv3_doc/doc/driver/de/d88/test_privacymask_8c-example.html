<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driver: test_privacymask.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Driver"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Driver<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/d88/test_privacymask_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test_privacymask.c</div></div>
</div><!--header-->
<div class="contents">
<p >This is an example of how to apply privacy mask to the entire source buffer.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * test_privacymask.c</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *  2010/05/28 - [Louis Sun] created for A5s</span></div>
<div class="line"><span class="comment"> *  2011/07/04 - [Jian Tang] modified for A5s</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2016 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents ( &quot;Software&quot; ) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/ddc/basetypes_8h.html">basetypes.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iav_ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../library/d0/d16/lib__pm_8h.html">lib_pm.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_CHANNELID(x)   do {      \</span></div>
<div class="line"><span class="preprocessor">    if (((x) &lt; 0) || ((x) &gt;= G_pm_ctx.sys_info.channel_num)) {  \</span></div>
<div class="line"><span class="preprocessor">        printf (&quot;channel id wrong %d \n&quot;</span>, (x));         \</div>
<div class="line">        return -1;  \</div>
<div class="line">    }   \</div>
<div class="line">    } while (0)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_CANVASID(x)  \</span></div>
<div class="line"><span class="preprocessor">    do {                \</span></div>
<div class="line"><span class="preprocessor">        if ((x) &lt; 0 || ((x) &gt;= IAV_MAX_CANVAS_BUF_NUM)) {   \</span></div>
<div class="line"><span class="preprocessor">            printf (&quot;canvas id wrong %d\n&quot;</span>, (x));   \</div>
<div class="line">            return -1;  \</div>
<div class="line">        }   \</div>
<div class="line">    } while (0)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CROSS_PRODUCT(a, b) (a.x * b.y - a.y * b.x)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NO_ARG      0</span></div>
<div class="line"><span class="preprocessor">#define HAS_ARG     1</span></div>
<div class="line"><span class="preprocessor">#define OPTIONS_BASE        0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_STRING_LENGTH   (64)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> PM_SHAPE {</div>
<div class="line">    PM_SHAPE_NONE = 0,  <span class="comment">/* none */</span></div>
<div class="line">    PM_SHAPE_RECT = 1,  <span class="comment">/* rectangle mask */</span></div>
<div class="line">    PM_SHAPE_CIRCLE = 2,    <span class="comment">/* circle mask */</span></div>
<div class="line">    PM_SHAPE_POLYGON = 3,   <span class="comment">/* polygon mask */</span></div>
<div class="line">    PM_SHAPE_POINT = 4, <span class="comment">/* point mask */</span></div>
<div class="line">    PM_SHAPE_BORDER_MASK = 5, <span class="comment">/* frame border mask */</span></div>
<div class="line">    PM_SHAPE_NUM,</div>
<div class="line">} PM_SHAPE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>usr_pm_opt {</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> mask_shape;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> y;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> u;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> v;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> use_warp_table : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> is_to_remove : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> color_changed : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> disable : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> reserved : 28;</div>
<div class="line">    <span class="keyword">union </span>{</div>
<div class="line">        <span class="keyword">struct </span><a id="_a0" name="_a0"></a><a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> rect;</div>
<div class="line">        <span class="keyword">struct </span><a id="_a1" name="_a1"></a><a class="code hl_struct" href="../../de/da5/structiav__circle.html">iav_circle</a> circle;</div>
<div class="line">        <span class="keyword">struct </span><a id="_a2" name="_a2"></a><a class="code hl_struct" href="../../dc/d71/structiav__polygon.html">iav_polygon</a> polygon;</div>
<div class="line">        <span class="keyword">struct </span><a id="_a3" name="_a3"></a><a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> point;</div>
<div class="line">        <span class="keywordtype">char</span> mask_file[MAX_STRING_LENGTH];</div>
<div class="line">    };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>usr_options {</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> chan_map;</div>
<div class="line">    <span class="keyword">struct </span>usr_pm_opt pm_opt[<a id="a4" name="a4"></a><a class="code hl_define" href="../../dummy.html">IAV_MAX_CHANNEL_NUM</a>];</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> auto_run : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> reserved1 : 7;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> auto_run_interval;   <span class="comment">/* frame unit */</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> reserved2[2];</div>
<div class="line">    <span class="keywordtype">int</span> canvas_id;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>pm_context {</div>
<div class="line">    <span class="keywordtype">int</span> <a id="a5" name="a5"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a>;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> reserved;</div>
<div class="line">    <span class="keyword">struct </span>usr_options *usr_opt;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a6" name="_a6"></a><a class="code hl_structRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html">pm_sys_info</a> sys_info;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a7" name="_a7"></a><a class="code hl_structRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html">pm_cfg_info</a> pm_cfg;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> chan_order_num;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> reserved1[3];</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> chan_order[<a class="code hl_define" href="../../dummy.html">IAV_MAX_CHANNEL_NUM</a>];</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>usr_options G_usr_opt = {</div>
<div class="line">    .chan_map = 0,</div>
<div class="line">    .auto_run = 0,</div>
<div class="line">    .auto_run_interval = 3,</div>
<div class="line">    .canvas_id = -1,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>pm_context G_pm_ctx = {</div>
<div class="line">    .fd_iav = -1,</div>
<div class="line">    .usr_opt = &amp;G_usr_opt,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aae">numeric_short_options</a> {</div>
<div class="line">    DISABLE_PRIVACY_MASK = OPTIONS_BASE,</div>
<div class="line">    SPECIFY_CIRCLE_MASK_RADIUS,</div>
<div class="line">    SPECIFY_POLYGON_MASK_VERTEX,</div>
<div class="line">    USE_WARP_TABLE,</div>
<div class="line">    SPECIFY_MASK_FILE,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>option <a id="a8" name="a8"></a>long_options[] = {</div>
<div class="line">    {<span class="stringliteral">&quot;channel&quot;</span>, <a id="a9" name="a9"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;c&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;xstart&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;x&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;ystart&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;y&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;width&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;w&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;height&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;h&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;radius&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_CIRCLE_MASK_RADIUS},</div>
<div class="line">    {<span class="stringliteral">&quot;center&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;C&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;vertex&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_POLYGON_MASK_VERTEX},</div>
<div class="line">    {<span class="stringliteral">&quot;point&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;p&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;remove&quot;</span>, <a id="a10" name="a10"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;d&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;Y&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;Y&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;U&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;V&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;V&#39;</span>},</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//turn it off</span></div>
<div class="line">    {<span class="stringliteral">&quot;disable&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, DISABLE_PRIVACY_MASK},</div>
<div class="line">    {<span class="stringliteral">&quot;auto&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;r&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;use-warp-table&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, USE_WARP_TABLE},</div>
<div class="line">    {<span class="stringliteral">&quot;canvas&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;b&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;mask-file&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_MASK_FILE},</div>
<div class="line"> </div>
<div class="line">    {0, 0, 0, 0}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a11" name="a11"></a>short_options = <span class="stringliteral">&quot;c:x:y:w:h:C:p:dr:Y:U:V:b:&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a id="_a12" name="_a12"></a><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a13" name="a13"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a14" name="a14"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> <a id="a15" name="a15"></a>hint[] = {</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tchannel id&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tset offset x&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tset offset y&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tset rect mask width&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tset rect mask height&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tset circle mask radius&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;axb&quot;</span>, <span class="stringliteral">&quot;set circle mask center coordinate. Not suggested for LDC + PM.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;axb&quot;</span>, <span class="stringliteral">&quot;set polygon mask vertex coordinate&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;axb&quot;</span>, <span class="stringliteral">&quot;set point mask coordinate&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tremove mask&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~255&quot;</span>, <span class="stringliteral">&quot;\tcolor of Y channel&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~255&quot;</span>, <span class="stringliteral">&quot;\tcolor of U channel&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~255&quot;</span>, <span class="stringliteral">&quot;\tcolor of V channel&quot;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tclear all masks&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;1~30&quot;</span>, <span class="stringliteral">&quot;auto run privacy mask every N frames, default is 3 frames&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0|1&quot;</span>, <span class="stringliteral">&quot;use warp table, 0: not use warp table; 1: use warp table.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tSpecify canvas id&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tSpecify mask YUV file&quot;</span>},</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a id="a16" name="a16"></a>usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;test_privacymask usage:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(long_options) / <span class="keyword">sizeof</span>(long_options[0]) - 1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (isalpha(long_options[i].val))</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c &quot;</span>, long_options[i].val);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;--%s&quot;</span>, long_options[i].<a id="a17" name="a17"></a>name);</div>
<div class="line">        <span class="keywordflow">if</span> (hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>[0] != 0)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [%s]&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nExamples:&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n  Add include a rectangle privacy mask:\n    test_privacymask -c 0 -x100 -y100 -w256 -h256\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n  Add exclude a rectangle privacy mask:\n    test_privacymask -c 0 -x100 -y100 -w256 -h256 -d\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n  Add a complement privacy mask for circle:\n    test_privacymask -c 0 --radius 544 -C 960x540\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n  Clear all privacy masks:\n    test_privacymask -c 0 --disable\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n  Auto run privacy masks every 4 frames:\n    test_privacymask -c 0 -r 4\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_yuv_range(<span class="keywordtype">int</span> value)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (value &gt; 255 || value &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Y/U/V value should be within [0-255].\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_two_int(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> *first, <span class="keywordtype">int</span> *second, <span class="keywordtype">char</span> delimiter)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keywordtype">char</span> tmp_string[16];</div>
<div class="line">    <span class="keywordtype">char</span> * separator;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        separator = strchr(name, delimiter);</div>
<div class="line">        <span class="keywordflow">if</span> (!separator) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;two int should be like A%cB.\n&quot;</span>, delimiter);</div>
<div class="line">            ret = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        strncpy(tmp_string, name, separator - name);</div>
<div class="line">        tmp_string[separator - <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">        *first = atoi(tmp_string);</div>
<div class="line">        strncpy(tmp_string, separator + 1, name + strlen(name) - separator);</div>
<div class="line">        *second = atoi(tmp_string);</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> vector_construct(struct <a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> a, struct <a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> <a id="a18" name="a18"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> v;</div>
<div class="line"> </div>
<div class="line">    v.<a id="a19" name="a19"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga6150e0515f7202e2fb518f7206ed97dc">x</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a>.x - a.x;</div>
<div class="line">    v.y = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a>.y - a.y;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> v;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_segment_intersected(<span class="keyword">struct</span> <a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> a, <span class="keyword">struct</span> <a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> b,</div>
<div class="line">    <span class="keyword">struct</span> <a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> c, <span class="keyword">struct</span> <a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> d)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> k[4];</div>
<div class="line">    <span class="keywordtype">int</span> i, f1 = 0, f2 = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_intersected = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* two points construct a vector */</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> ac = vector_construct(a, c);</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> cb = vector_construct(c, b);</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> bd = vector_construct(b, d);</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> da = vector_construct(d, a);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* cross product of vectors */</span></div>
<div class="line">    k[0] = CROSS_PRODUCT(ac, cb);</div>
<div class="line">    k[1] = CROSS_PRODUCT(cb, bd);</div>
<div class="line">    k[2] = CROSS_PRODUCT(bd, da);</div>
<div class="line">    k[3] = CROSS_PRODUCT(da, ac);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* calculate the number of positive and negative numbers */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (k[i] &gt; 0) {</div>
<div class="line">            f1++;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (k[i] &lt; 0) {</div>
<div class="line">            f2++;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (f1 &gt; 0 &amp;&amp; f2 &gt; 0) {</div>
<div class="line">        is_intersected = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        is_intersected = 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> is_intersected;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a id="a20" name="a20"></a>channel_to_vsrc(<span class="keywordtype">int</span> fd_iav, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> channel_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a21" name="_a21"></a><a class="code hl_structRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> chan_cfg;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a id="a22" name="a22"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a>;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;chan_cfg, 0, <span class="keyword">sizeof</span>(chan_cfg));</div>
<div class="line">    chan_cfg.chan_id = channel_id;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a23" name="a23"></a>IAV_IOC_GET_CHAN_CONFIG, &amp;chan_cfg) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_GET_CHAN_CONFIG\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a> = chan_cfg.vsrc_id;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_usr_options(<span class="keyword">struct</span> pm_context *pm_ctx)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>usr_options *usr_opt = pm_ctx-&gt;usr_opt;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html">pm_sys_info</a> *sys_info = &amp;pm_ctx-&gt;sys_info;</div>
<div class="line">    <span class="keyword">struct </span>usr_pm_opt *pm_opt = usr_opt-&gt;pm_opt;</div>
<div class="line">    <span class="keywordtype">int</span> channel_num = sys_info-&gt;<a id="a24" name="a24"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">channel_num</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> *main_domain_size = sys_info-&gt;<a id="a25" name="a25"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#aba5507abae816e88e3593941099d6d66">main_domain_size</a>;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a26" name="_a26"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> *canvas = sys_info-&gt;<a id="a27" name="a27"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#adf4e0c6a4dae7b113c1d3b5d15444ecb">canvas</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../dc/d71/structiav__polygon.html">iav_polygon</a> *polygon = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../db/d22/structiav__point.html">iav_point</a> segment_point_arr[<a id="a28" name="a28"></a><a class="code hl_define" href="../../df/d52/group__iav-structure.html#gacd773c6bc679fd96952a7641e9ba4d2a">MAX_POLYGON_VERTICE_NUM</a>][2] = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width = 0, height = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, j = 0, <a id="a29" name="a29"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0, rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((usr_opt-&gt;canvas_id == -1) &amp;&amp; !usr_opt-&gt;chan_map) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Please specify channel id or main buffer canvas id\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; channel_num; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (pm_opt[i].disable || usr_opt-&gt;auto_run) {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">do</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (pm_opt[i].mask_shape == PM_SHAPE_RECT) {</div>
<div class="line">                <span class="keywordflow">if</span> (usr_opt-&gt;canvas_id != -1) {</div>
<div class="line">                    width = canvas[usr_opt-&gt;canvas_id].<a id="a30" name="a30"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#aa1281fe9a1e356ee476ec71c9f7914ac">max</a>.<a id="a31" name="a31"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">                    height = canvas[usr_opt-&gt;canvas_id].<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#aa1281fe9a1e356ee476ec71c9f7914ac">max</a>.<a id="a32" name="a32"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line"> </div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    width = main_domain_size[i].<a id="a33" name="a33"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">                    height = main_domain_size[i].<a id="a34" name="a34"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (pm_opt[i].rect.x &gt;= width || pm_opt[i].rect.y &gt;= height) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Incorrect PM offset!\n&quot;</span>);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (pm_opt[i].rect.width &lt;= 0 || pm_opt[i].rect.height &lt;= 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Incorrect PM size!\n&quot;</span>);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (pm_opt[i].rect.x + pm_opt[i].rect.width &gt; width ||</div>
<div class="line">                    pm_opt[i].rect.y + pm_opt[i].rect.height &gt; height) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;PM Offset + Size must within Main buffer!\n&quot;</span>);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (usr_opt-&gt;canvas_id != -1) {</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (pm_opt[i].mask_shape == PM_SHAPE_POLYGON) {</div>
<div class="line">                polygon = &amp;pm_opt[i].polygon;</div>
<div class="line">                <span class="keywordflow">if</span> (polygon-&gt;<a id="a35" name="a35"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga2837b308be5c286475565de8efe875cf">vertice_num</a> &lt;= 2) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Polygon&#39;s vertice number should not less 2!\n&quot;</span>);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; polygon-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga2837b308be5c286475565de8efe875cf">vertice_num</a>; i++) {</div>
<div class="line">                    <span class="keywordflow">for</span> (j = 0; j &lt; 2; j++) {</div>
<div class="line">                        segment_point_arr[i][j] = polygon-&gt;<a id="a36" name="a36"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">vertex</a>[<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>];</div>
<div class="line">                        <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++;</div>
<div class="line">                        <span class="keywordflow">if</span> ((index == polygon-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga2837b308be5c286475565de8efe875cf">vertice_num</a>) &amp;&amp; (j == 1)) {</div>
<div class="line">                            <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>--;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; polygon-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga2837b308be5c286475565de8efe875cf">vertice_num</a> - 2; i++) {</div>
<div class="line">                    <span class="keywordflow">for</span> (j = i + 2; ((((j - i) &gt;= 2) &amp;&amp; (j - i &lt; polygon-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga2837b308be5c286475565de8efe875cf">vertice_num</a> - 1)) &amp;&amp;</div>
<div class="line">                        (j &lt; polygon-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga2837b308be5c286475565de8efe875cf">vertice_num</a>)); j++) {</div>
<div class="line">                        <span class="keywordflow">if</span> (is_segment_intersected(segment_point_arr[i][0], segment_point_arr[i][1],</div>
<div class="line">                            segment_point_arr[j][0], segment_point_arr[j][1])) {</div>
<div class="line">                            printf(<span class="stringliteral">&quot;Vertices can not form a polygon!\n&quot;</span>);</div>
<div class="line">                            rval = -1;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">while</span> (0);</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_main_canvas(<span class="keyword">struct</span> <a class="code hl_structRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html">pm_sys_info</a> *sys_info, <span class="keywordtype">int</span> canvas_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a37" name="_a37"></a><a class="code hl_structRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a> vproc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a38" name="_a38"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a> *multi_chan_dptz = &amp;vproc.<a id="a39" name="a39"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a id="a40" name="a40"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a41" name="_a41"></a><a class="code hl_structRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html">iav_buf_cfg</a> *buf_cfg = &amp;multi_chan_dptz-&gt;<a id="a42" name="a42"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = G_pm_ctx.fd_iav;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, k = 0, rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; sys_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">channel_num</a>; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (k = <a id="a43" name="a43"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193afca3200d598aaa4faa22157c8b079ddb">IAV_SRCBUF_FIRST</a>; k &lt; <a id="a44" name="a44"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a20b53edd6dd3a81b604237316233e6f2">IAV_SRCBUF_LAST_PMN</a>; k++) {</div>
<div class="line">            memset(&amp;vproc, 0, <span class="keyword">sizeof</span>(vproc));</div>
<div class="line">            vproc.<a id="a45" name="a45"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#af9eae96af4a33e97e8805e61bf4ef9b6">cid</a> = <a id="a46" name="a46"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">            vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>.<a id="a47" name="a47"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = i;</div>
<div class="line">            vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>.<a id="a48" name="a48"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = 0;</div>
<div class="line">            vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>.<a id="a49" name="a49"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = k;</div>
<div class="line">            <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a50" name="a50"></a>IAV_IOC_GET_VIDEO_PROC, &amp;vproc) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_GET_VIDEO_PROC\n&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> ((k != <a id="a51" name="a51"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a>) &amp;&amp; (buf_cfg-&gt;<a id="a52" name="a52"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a> == <a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a>)) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Specify canvas should originate from main buffer.\n&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_param(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv, <span class="keyword">struct</span> pm_context *pm_ctx)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>usr_options *usr_opt = pm_ctx-&gt;usr_opt;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html">pm_sys_info</a> *sys_info = &amp;pm_ctx-&gt;sys_info;</div>
<div class="line">    <span class="keyword">struct </span>usr_pm_opt *pm_opt = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> ch, value, first, second;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> vertice_num = 0;</div>
<div class="line">    <span class="keywordtype">int</span> option_index = 0, current_channel = 0;</div>
<div class="line"> </div>
<div class="line">    opterr = 0;</div>
<div class="line">    <span class="keywordflow">while</span> ((ch = getopt_long(argc, argv, short_options, long_options, &amp;option_index)) != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div>
<div class="line">            current_channel = atoi(optarg);</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            usr_opt-&gt;chan_map |= (1 &lt;&lt; current_channel);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;mask_shape = PM_SHAPE_RECT;</div>
<div class="line">            pm_opt-&gt;rect.x = atoi(optarg);</div>
<div class="line">            pm_opt-&gt;disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;mask_shape = PM_SHAPE_RECT;</div>
<div class="line">            pm_opt-&gt;rect.y = atoi(optarg);</div>
<div class="line">            pm_opt-&gt;disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;mask_shape = PM_SHAPE_RECT;</div>
<div class="line">            pm_opt-&gt;rect.width = atoi(optarg);</div>
<div class="line">            pm_opt-&gt;disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;mask_shape = PM_SHAPE_RECT;</div>
<div class="line">            pm_opt-&gt;rect.height = atoi(optarg);</div>
<div class="line">            pm_opt-&gt;disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            <span class="keywordflow">if</span> (get_two_int(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (first &lt;= 0 || second &lt;= 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Center coordinates should be positive.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;mask_shape = PM_SHAPE_CIRCLE;</div>
<div class="line">            pm_opt-&gt;circle.center_x = first;</div>
<div class="line">            pm_opt-&gt;circle.center_y = second;</div>
<div class="line">            pm_opt-&gt;disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            <span class="keywordflow">if</span> (get_two_int(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (first &lt;= 0 || second &lt;= 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Point coordinates should be positive.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;mask_shape = PM_SHAPE_POINT;</div>
<div class="line">            pm_opt-&gt;point.x = first;</div>
<div class="line">            pm_opt-&gt;point.y = second;</div>
<div class="line">            pm_opt-&gt;disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SPECIFY_CIRCLE_MASK_RADIUS:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;mask_shape = PM_SHAPE_CIRCLE;</div>
<div class="line">            pm_opt-&gt;circle.radius = atoi(optarg);</div>
<div class="line">            pm_opt-&gt;disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SPECIFY_POLYGON_MASK_VERTEX:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            <span class="keywordflow">if</span> (get_two_int(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            vertice_num = pm_opt-&gt;polygon.vertice_num;</div>
<div class="line">            pm_opt-&gt;mask_shape = PM_SHAPE_POLYGON;</div>
<div class="line">            <span class="keywordflow">if</span> (pm_opt-&gt;polygon.vertice_num &gt;= <a class="code hl_define" href="../../df/d52/group__iav-structure.html#gacd773c6bc679fd96952a7641e9ba4d2a">MAX_POLYGON_VERTICE_NUM</a>) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Polygon vertex number should not exceed %d.\n&quot;</span>, <a class="code hl_define" href="../../df/d52/group__iav-structure.html#gacd773c6bc679fd96952a7641e9ba4d2a">MAX_POLYGON_VERTICE_NUM</a>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pm_opt-&gt;polygon.vertex[vertice_num].x = first;</div>
<div class="line">            pm_opt-&gt;polygon.vertex[vertice_num].y = second;</div>
<div class="line">            pm_opt-&gt;polygon.vertice_num++;</div>
<div class="line">            pm_opt-&gt;disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;is_to_remove = 1;</div>
<div class="line">            pm_opt-&gt;disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;Y&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (check_yuv_range(value) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;y = value;</div>
<div class="line">            pm_opt-&gt;color_changed = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (check_yuv_range(value) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;u = value;</div>
<div class="line">            pm_opt-&gt;color_changed = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (check_yuv_range(value) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;v = value;</div>
<div class="line">            pm_opt-&gt;color_changed = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> DISABLE_PRIVACY_MASK:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            pm_opt = &amp;usr_opt-&gt;pm_opt[current_channel];</div>
<div class="line">            pm_opt-&gt;disable = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            usr_opt-&gt;auto_run = 1;</div>
<div class="line">            usr_opt-&gt;auto_run_interval = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (usr_opt-&gt;auto_run_interval &lt; 1 || usr_opt-&gt;auto_run_interval &gt; 30) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid auto run interval value [%d], please choose from 1~30.\n&quot;</span>,</div>
<div class="line">                    usr_opt-&gt;auto_run_interval);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            usr_opt-&gt;pm_opt[current_channel].disable = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> USE_WARP_TABLE:</div>
<div class="line">            usr_opt-&gt;pm_opt[current_channel].use_warp_table = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line">            usr_opt-&gt;canvas_id = atoi(optarg);</div>
<div class="line">            VERIFY_CANVASID(usr_opt-&gt;canvas_id);</div>
<div class="line">            <span class="keywordflow">if</span> (check_main_canvas(sys_info, usr_opt-&gt;canvas_id) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SPECIFY_MASK_FILE:</div>
<div class="line">            VERIFY_CHANNELID(current_channel);</div>
<div class="line">            usr_opt-&gt;pm_opt[current_channel].mask_shape = PM_SHAPE_BORDER_MASK;</div>
<div class="line">            snprintf(usr_opt-&gt;pm_opt[current_channel].mask_file, MAX_STRING_LENGTH, <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            printf(<span class="stringliteral">&quot;unknown option found: %c\n&quot;</span>, ch);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sigstop()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>usr_options *usr_opt = G_pm_ctx.usr_opt;</div>
<div class="line">    <span class="keywordtype">int</span> channel_num = G_pm_ctx.sys_info.channel_num;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; channel_num; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a53" name="a53"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gacc9ff6312f9bda4152dd4bb065f98217">pm_clear</a>(i) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Sigstop: clear pm cfg failed!\n&quot;</span>);</div>
<div class="line">            exit(2);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a54" name="a54"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga81c5b410770fee38546ef45895d0b95e">pm_apply_cfg</a>(usr_opt-&gt;chan_map) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Sigstop: apply pm cfg failed!\n&quot;</span>);</div>
<div class="line">        exit(2);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a id="a55" name="a55"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga4bb03b81e6e8283346e764c690b1e431">pm_lib_deinit</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (G_pm_ctx.fd_iav &gt; 0) {</div>
<div class="line">        close(G_pm_ctx.fd_iav);</div>
<div class="line">        G_pm_ctx.fd_iav = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    exit(1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> multi_chan_auto_run(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> random_pm;</div>
<div class="line">    <span class="keyword">struct </span>usr_options *usr_opt = G_pm_ctx.usr_opt;</div>
<div class="line">    <span class="keyword">struct </span>usr_pm_opt *pm_opt = usr_opt-&gt;pm_opt;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> *main_domain_size = G_pm_ctx.sys_info.main_domain_size;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html">pm_cfg_info</a> *pm_cfg = &amp;G_pm_ctx.pm_cfg;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a56" name="_a56"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d5f/structvindev__fps.html">vindev_fps</a> vsrc_fps = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a id="a57" name="a57"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d5f/structvindev__fps.html#aa1ecb62f419c3b454f5a2d4fd18d4818">vsrc_id</a>, vin_fps = 0;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = G_pm_ctx.fd_iav;</div>
<div class="line">    <span class="keywordtype">int</span> channel_num = G_pm_ctx.sys_info.channel_num;</div>
<div class="line">    <span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> sleep_time;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, random_width = 0, random_height = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; channel_num; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (usr_opt-&gt;chan_map &amp; (1U &lt;&lt; i)) {</div>
<div class="line">                <a class="code hl_variableRef" target="_blank" href="../../../library/d8/d5f/structvindev__fps.html#aa1ecb62f419c3b454f5a2d4fd18d4818">vsrc_id</a> = channel_to_vsrc(fd_iav, i);</div>
<div class="line">                vsrc_fps.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d5f/structvindev__fps.html#aa1ecb62f419c3b454f5a2d4fd18d4818">vsrc_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d8/d5f/structvindev__fps.html#aa1ecb62f419c3b454f5a2d4fd18d4818">vsrc_id</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a58" name="a58"></a>IAV_IOC_VIN_GET_FPS, &amp;vsrc_fps) &lt; 0) {</div>
<div class="line">                    perror(<span class="stringliteral">&quot;IAV_IOC_VIN_GET_FPS&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                vin_fps = vsrc_fps.<a id="a59" name="a59"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d5f/structvindev__fps.html#a0256d25b86a9f6d108e63e630fd20cf2">fps</a>;</div>
<div class="line">                sleep_time = usr_opt-&gt;auto_run_interval * 1000000 / (<a id="a60" name="a60"></a><a class="code hl_define" href="../../dummy.html">DIV_ROUND</a>(512000000, vin_fps));</div>
<div class="line"> </div>
<div class="line">                random_width = main_domain_size[i].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">                random_height = main_domain_size[i].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line"> </div>
<div class="line">                rval = <a id="a61" name="a61"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga3d615ae6358735f81cfed390de7da550">pm_get_cfg</a>(i, pm_cfg);</div>
<div class="line">                <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Get pm cfg failed\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (pm_opt[i].color_changed) {</div>
<div class="line">                    pm_cfg-&gt;<a id="a62" name="a62"></a><a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>.<a id="a63" name="a63"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/d46/structiav__privacy__mask.html#ad87f9078b74ef74a58041131d06283c2">y</a> = pm_opt[i].y;</div>
<div class="line">                    pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>.<a id="a64" name="a64"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/d46/structiav__privacy__mask.html#aee1a40d4001bf35b326657aa5656f251">u</a> = pm_opt[i].u;</div>
<div class="line">                    pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>.<a id="a65" name="a65"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/d46/structiav__privacy__mask.html#a27faf3e6632158a4337bd0537c69d9ea">v</a> = pm_opt[i].v;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (usr_opt-&gt;auto_run) {</div>
<div class="line">                    pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/d46/structiav__privacy__mask.html#ad87f9078b74ef74a58041131d06283c2">y</a> = rand() % 256;</div>
<div class="line">                    pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/d46/structiav__privacy__mask.html#aee1a40d4001bf35b326657aa5656f251">u</a> = rand() % 256;</div>
<div class="line">                    pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/d46/structiav__privacy__mask.html#a27faf3e6632158a4337bd0537c69d9ea">v</a> = rand() % 256;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                random_pm.x = rand() % random_width;</div>
<div class="line">                random_pm.y = rand() % random_height;</div>
<div class="line">                random_pm.width = rand() % random_width;</div>
<div class="line">                random_pm.height = rand() % random_height;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (random_pm.x + random_pm.width &gt; random_width){</div>
<div class="line">                    random_pm.x -= random_pm.x + random_pm.width -</div>
<div class="line">                        random_width;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (random_pm.y + random_pm.height &gt; random_height){</div>
<div class="line">                    random_pm.y -= random_pm.y + random_pm.height -</div>
<div class="line">                        random_height;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (pm_cfg-&gt;<a id="a66" name="a66"></a><a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a550f7877292ec26bc162a3b66dfc6ea3">pm_mem_size</a>) {</div>
<div class="line">                    memset(pm_cfg-&gt;<a id="a67" name="a67"></a><a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#acc97e8ecea5a6500f3c5d4b018f0a7ea">pm_virt_addr</a>, 0, pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a550f7877292ec26bc162a3b66dfc6ea3">pm_mem_size</a>);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <a id="a68" name="a68"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gafdf15c2c2724903df88b5982ed5324f7">pm_fill_rect</a>(i, &amp;random_pm, 0);</div>
<div class="line"> </div>
<div class="line">                rval = <a id="a69" name="a69"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gaf1453cbfba821ec0127060f02e705d56">pm_insert</a>(i, &amp;pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>);</div>
<div class="line">                <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Put pm cfg failed\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        rval = <a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga81c5b410770fee38546ef45895d0b95e">pm_apply_cfg</a>(usr_opt-&gt;chan_map);</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;After put cfg, apply pm cfg failed\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        usleep(sleep_time);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> get_canvas_chan_order(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *chan_num, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *chan_order)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html">pm_sys_info</a> *sys_info = &amp;G_pm_ctx.sys_info;</div>
<div class="line">    <span class="keyword">struct </span>usr_options *usr_opt = G_pm_ctx.usr_opt;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> *main_domain_size = sys_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#aba5507abae816e88e3593941099d6d66">main_domain_size</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a> vproc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a> *multi_chan_dptz = &amp;vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html">iav_buf_cfg</a> *buf_cfg = &amp;multi_chan_dptz-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">buf_cfg</a>;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = G_pm_ctx.fd_iav;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> idx0 = 0, idx1 = 0, i = 0, chan_tmp_id = 0, j = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; sys_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">channel_num</a>; i++) {</div>
<div class="line">        memset(&amp;vproc, 0, <span class="keyword">sizeof</span>(vproc));</div>
<div class="line">        vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#af9eae96af4a33e97e8805e61bf4ef9b6">cid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a>;</div>
<div class="line">        vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">channel_id</a> = i;</div>
<div class="line">        vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = 0;</div>
<div class="line">        vproc.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">dptz</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_GET_VIDEO_PROC, &amp;vproc) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_GET_VIDEO_PROC\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (buf_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/da9/structiav__buf__cfg.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a> == usr_opt-&gt;canvas_id) {</div>
<div class="line">            chan_order[i] = i;</div>
<div class="line">            (*chan_num)++;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; *chan_num - 1; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; *chan_num -1 - i; j++) {</div>
<div class="line">            idx0 = chan_order[j];</div>
<div class="line">            idx1 = chan_order[j + 1];</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (main_domain_size[idx0].x &gt; main_domain_size[idx1].x) {</div>
<div class="line">                chan_tmp_id = chan_order[j];</div>
<div class="line">                chan_order[j] = chan_order[j + 1];</div>
<div class="line">                chan_order[j + 1] = chan_tmp_id;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (main_domain_size[idx0].y &gt; main_domain_size[idx1].y) {</div>
<div class="line">                chan_tmp_id = chan_order[j];</div>
<div class="line">                chan_order[j] = chan_order[j + 1];</div>
<div class="line">                chan_order[j + 1] = chan_tmp_id;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> convert_canvas_coordinate_to_main_coordinate(<span class="keyword">struct</span> <a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> *pm_rect)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html">pm_sys_info</a> *sys_info = &amp;G_pm_ctx.sys_info;</div>
<div class="line">    <span class="keyword">struct </span>usr_options *usr_opt = G_pm_ctx.usr_opt;</div>
<div class="line">    <span class="keyword">struct </span>usr_pm_opt *pm_opt = usr_opt-&gt;pm_opt;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> *main_domain_size = sys_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#aba5507abae816e88e3593941099d6d66">main_domain_size</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> canvas_pm_rect = *pm_rect;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> *rect = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *chan_order = G_pm_ctx.chan_order;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> channel_order_num = G_pm_ctx.chan_order_num;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> chan_id = 0, i = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; channel_order_num; i++) {</div>
<div class="line">        chan_id = chan_order[i];</div>
<div class="line">        rect = &amp;pm_opt[chan_id].rect;</div>
<div class="line">        <span class="keywordflow">if</span> (canvas_pm_rect.<a id="a70" name="a70"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> &lt;= main_domain_size[chan_id].x) {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> &gt;= main_domain_size[chan_id].x + main_domain_size[chan_id].width) {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> + main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (canvas_pm_rect.<a id="a71" name="a71"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> &lt;= main_domain_size[chan_id].y) {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> &gt;= main_domain_size[chan_id].y + main_domain_size[chan_id].height) {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> + main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> + canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> &lt;= main_domain_size[chan_id].x) {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> - rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> + canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> &gt;= main_domain_size[chan_id].x + main_domain_size[chan_id].width) {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> + main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> - rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> + canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> - rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> + canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> &lt;= main_domain_size[chan_id].y) {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> - rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> + canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> &gt;= main_domain_size[chan_id].y + main_domain_size[chan_id].height) {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> + main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> - rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> + canvas_pm_rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> - rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>;</div>
<div class="line">        }</div>
<div class="line">        rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> - main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">        rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = rect-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> - main_domain_size[chan_id].<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> prepare_mask_buffer(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> chan_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> **mask_buf)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../de/d3a/structiav__rect.html">iav_rect</a> *main_win = &amp;G_pm_ctx.sys_info.main_domain_size[chan_id];</div>
<div class="line">    FILE *fp = NULL;</div>
<div class="line">    <span class="keywordtype">long</span> size = 0, target_size = main_win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> * main_win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    <span class="keywordtype">char</span> *path = G_pm_ctx.usr_opt-&gt;pm_opt[chan_id].mask_file;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    fp = fopen(path, <span class="stringliteral">&quot;rb+&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (fp == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Open mask frame %s failed\n&quot;</span>, path);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> READ_FRAME_MASK_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    fseek(fp, 0, SEEK_END);</div>
<div class="line">    size = ftell(fp);</div>
<div class="line">    <span class="keywordflow">if</span> (size &lt; target_size) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid file size %ld. Should be bigger than %ld\n&quot;</span>, size, target_size);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> READ_FRAME_MASK_EXIT;</div>
<div class="line">    }</div>
<div class="line">    fseek(fp, 0, SEEK_SET);</div>
<div class="line"> </div>
<div class="line">    *mask_buf = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>*)malloc(target_size);</div>
<div class="line">    <span class="keywordflow">if</span> (*mask_buf == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Malloc mask buffer failed\n&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> READ_FRAME_MASK_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    size = fread(*mask_buf, 1, target_size, fp);</div>
<div class="line">    <span class="keywordflow">if</span> (size != target_size) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Read mask frame file failed\n&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> READ_FRAME_MASK_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">READ_FRAME_MASK_EXIT:</div>
<div class="line">    <span class="keywordflow">if</span> (fp) {</div>
<div class="line">        fclose(fp);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> release_mask_buffer(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *mask_buf)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (mask_buf) {</div>
<div class="line">        free(mask_buf);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> multi_chan_pm_loop(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html">pm_sys_info</a> *sys_info = &amp;G_pm_ctx.sys_info;</div>
<div class="line">    <span class="keyword">struct </span>usr_options *usr_opt = G_pm_ctx.usr_opt;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html">pm_cfg_info</a> *pm_cfg = &amp;G_pm_ctx.pm_cfg;</div>
<div class="line">    <span class="keyword">struct </span>usr_pm_opt *pm_opt = usr_opt-&gt;pm_opt;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *chan_order = G_pm_ctx.chan_order;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> channel_order_num = G_pm_ctx.chan_order_num;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *mask_buf = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> channel_num = sys_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">channel_num</a>;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> chan_id = 0, mask_shape = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> chan_map = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (usr_opt-&gt;canvas_id != -1) {</div>
<div class="line">            convert_canvas_coordinate_to_main_coordinate(&amp;pm_opt[0].rect);</div>
<div class="line">            channel_num = channel_order_num;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            chan_map = usr_opt-&gt;chan_map;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; channel_num; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> ((usr_opt-&gt;canvas_id == -1) &amp;&amp; !(usr_opt-&gt;chan_map &amp; (1U &lt;&lt; i))) {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (usr_opt-&gt;canvas_id != -1) {</div>
<div class="line">                chan_id = chan_order[i];</div>
<div class="line">                <span class="keywordflow">if</span> (!pm_opt[0].disable &amp;&amp; (pm_opt[chan_id].rect.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> &lt;= 0 ||</div>
<div class="line">                    pm_opt[chan_id].rect.height &lt;= 0)) {</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                }</div>
<div class="line">                chan_map |= (1 &lt;&lt; chan_id);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (pm_opt[0].disable) {</div>
<div class="line">                    pm_opt[chan_id].disable = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (pm_opt[0].color_changed) {</div>
<div class="line">                    pm_opt[chan_id].color_changed = 1;</div>
<div class="line">                    pm_opt[chan_id].y = pm_opt[0].y;</div>
<div class="line">                    pm_opt[chan_id].u = pm_opt[0].u;</div>
<div class="line">                    pm_opt[chan_id].v = pm_opt[0].v;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (pm_opt[0].is_to_remove) {</div>
<div class="line">                    pm_opt[chan_id].is_to_remove = 1;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                chan_id = i;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (pm_opt[chan_id].disable) {</div>
<div class="line">                rval = <a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gacc9ff6312f9bda4152dd4bb065f98217">pm_clear</a>(chan_id);</div>
<div class="line">                <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;clear pm all cfg failed\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            rval = <a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga3d615ae6358735f81cfed390de7da550">pm_get_cfg</a>(chan_id, pm_cfg);</div>
<div class="line">            <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;chan[%d]: get pm cfg failed\n&quot;</span>, chan_id);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (pm_opt[chan_id].color_changed) {</div>
<div class="line">                pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/d46/structiav__privacy__mask.html#ad87f9078b74ef74a58041131d06283c2">y</a> = pm_opt[chan_id].y;</div>
<div class="line">                pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/d46/structiav__privacy__mask.html#aee1a40d4001bf35b326657aa5656f251">u</a> = pm_opt[chan_id].u;</div>
<div class="line">                pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d6/d46/structiav__privacy__mask.html#a27faf3e6632158a4337bd0537c69d9ea">v</a> = pm_opt[chan_id].v;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (usr_opt-&gt;canvas_id != -1) {</div>
<div class="line">                mask_shape = PM_SHAPE_RECT;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                mask_shape = pm_opt[chan_id].mask_shape;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">switch</span> (mask_shape) {</div>
<div class="line">            <span class="keywordflow">case</span> PM_SHAPE_RECT:</div>
<div class="line">                <a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gafdf15c2c2724903df88b5982ed5324f7">pm_fill_rect</a>(chan_id, &amp;pm_opt[chan_id].rect, pm_opt[chan_id].is_to_remove);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> PM_SHAPE_CIRCLE:</div>
<div class="line">                <a id="a72" name="a72"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga99523a316a9dba9d75b3f0e1d047ec5c">pm_fill_circle</a>(chan_id, &amp;pm_opt[chan_id].circle, pm_opt[chan_id].is_to_remove);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> PM_SHAPE_POLYGON:</div>
<div class="line">                <a id="a73" name="a73"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga7a7b565844f7e71b71766338df9978ef">pm_fill_polygon</a>(chan_id, &amp;pm_opt[chan_id].polygon, pm_opt[chan_id].is_to_remove);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> PM_SHAPE_POINT:</div>
<div class="line">                <a id="a74" name="a74"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gaad304605c049a0d3e591377b6eee738b">pm_fill_point</a>(chan_id, &amp;pm_opt[chan_id].point, pm_opt[chan_id].is_to_remove);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> PM_SHAPE_BORDER_MASK:</div>
<div class="line">                <span class="keywordflow">if</span> (prepare_mask_buffer(chan_id, &amp;mask_buf) &lt; 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Prepare channel[%d] mask buffer failed\n&quot;</span>, chan_id);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    release_mask_buffer(mask_buf);</div>
<div class="line">                    <span class="keywordflow">goto</span> MULTI_CHAN_PM_LOOP_EXIT;</div>
<div class="line">                }</div>
<div class="line">                <a id="a75" name="a75"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gaa435c5e716d18c934fe8136eea19c535">pm_fill_frame_border_by_mask</a>(chan_id, mask_buf);</div>
<div class="line">                release_mask_buffer(mask_buf);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;chan[%d]: invalid mask_shape: %d\n&quot;</span>, chan_id, mask_shape);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">goto</span> MULTI_CHAN_PM_LOOP_EXIT;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            rval = <a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gaf1453cbfba821ec0127060f02e705d56">pm_insert</a>(chan_id, &amp;pm_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">curr_pm_cfg</a>);</div>
<div class="line">            <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Put pm cfg failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        rval = <a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga81c5b410770fee38546ef45895d0b95e">pm_apply_cfg</a>(chan_map);</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Apply pm cfg failed\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }<span class="keywordflow">while</span>(0);</div>
<div class="line"> </div>
<div class="line">MULTI_CHAN_PM_LOOP_EXIT:</div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a76" name="a76"></a><a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a77" name="_a77"></a><a class="code hl_structRef" target="_blank" href="../../../library/d7/db7/structpm__usr__cfg.html">pm_usr_cfg</a> usr_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span>usr_options *usr_opt = G_pm_ctx.usr_opt;</div>
<div class="line">    <span class="keyword">struct </span>usr_pm_opt *pm_opt = usr_opt-&gt;pm_opt;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html">pm_sys_info</a> *sys_info = &amp;G_pm_ctx.sys_info;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *chan_order = G_pm_ctx.chan_order;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">channel_num</a> = 0;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = 0, i = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//register signal handler for Ctrl+C,  Ctrl+&#39;\&#39;  ,  and &quot;kill&quot; sys cmd</span></div>
<div class="line">    signal(SIGINT,  sigstop);</div>
<div class="line">    signal(SIGQUIT, sigstop);</div>
<div class="line">    signal(SIGTERM, sigstop);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">            usage();</div>
<div class="line">            rval = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((G_pm_ctx.fd_iav = open(<span class="stringliteral">&quot;/dev/iav&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;/dev/iav&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = G_pm_ctx.fd_iav;</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a78" name="a78"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga75c53543b745e9883b4fe533179c5c0c">pm_get_sys_info</a>(fd_iav, sys_info) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Get iav system info failed\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (init_param(argc, argv, &amp;G_pm_ctx) &lt; 0)  {</div>
<div class="line">            printf(<span class="stringliteral">&quot;init param failed\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (check_usr_options(&amp;G_pm_ctx) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;check user options failed\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (usr_opt-&gt;canvas_id != -1) {</div>
<div class="line">            get_canvas_chan_order(&amp;G_pm_ctx.chan_order_num, chan_order);</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">channel_num</a> = G_pm_ctx.chan_order_num;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">channel_num</a> = sys_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">channel_num</a>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_variableRef" target="_blank" href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">channel_num</a>; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (pm_opt[i].use_warp_table) {</div>
<div class="line">                usr_cfg.<a id="a79" name="a79"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d7/db7/structpm__usr__cfg.html#a7da52c8866c4a14c7e7ab53988baf311">use_warp_table_chan_map</a> |= (1 &lt;&lt; i);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (usr_opt-&gt;canvas_id != -1) {</div>
<div class="line">                usr_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d7/db7/structpm__usr__cfg.html#a7da52c8866c4a14c7e7ab53988baf311">use_warp_table_chan_map</a> |= (1 &lt;&lt; chan_order[i]);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">// do nothing</span></div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a80" name="a80"></a><a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gac5e218a9b9c8e048756ec1294f7edb7b">pm_lib_init</a>(&amp;usr_cfg, sys_info) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;prepare pm lib failed\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (usr_opt-&gt;auto_run) {</div>
<div class="line">            <span class="keywordflow">if</span> (!usr_opt-&gt;chan_map) {</div>
<div class="line">                usr_opt-&gt;chan_map = 1 &lt;&lt; 0;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (multi_chan_auto_run() &lt; 0) {</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (multi_chan_pm_loop() &lt; 0) {</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_functionRef" target="_blank" href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga4bb03b81e6e8283346e764c690b1e431">pm_lib_deinit</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (G_pm_ctx.fd_iav &gt; 0) {</div>
<div class="line">        close(G_pm_ctx.fd_iav);</div>
<div class="line">        G_pm_ctx.fd_iav = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="aasf__structure_8h_html_a92c50087ca0e64fa93fc59402c55f8ca"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></div><div class="ttdeci">uint8_t u8</div></div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div></div>
<div class="ttc" id="abasetypes_8h_html"><div class="ttname"><a href="../../de/ddc/basetypes_8h.html">basetypes.h</a></div><div class="ttdoc">This file defines basic types used in all IAV driver and header files.</div></div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div></div>
<div class="ttc" id="acJSON_8h_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div></div>
<div class="ttc" id="adummy_html"><div class="ttname"><a href="../../dummy.html">IAV_MAX_CHANNEL_NUM</a></div><div class="ttdeci">#define IAV_MAX_CHANNEL_NUM</div></div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">iav_rect::y</a></div><div class="ttdeci">u32 y</div><div class="ttdoc">Offset Y.</div><div class="ttdef"><b>Definition:</b> basetypes.h:113</div></div>
<div class="ttc" id="agroup__IAV_html_ga2837b308be5c286475565de8efe875cf"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga2837b308be5c286475565de8efe875cf">iav_polygon::vertice_num</a></div><div class="ttdeci">u8 vertice_num</div><div class="ttdoc">Number of vertices.</div><div class="ttdef"><b>Definition:</b> basetypes.h:144</div></div>
<div class="ttc" id="agroup__IAV_html_ga53f15e4c2732990e33c4bbdbb60ae318"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga53f15e4c2732990e33c4bbdbb60ae318">iav_polygon::vertex</a></div><div class="ttdeci">struct iav_point vertex[MAX_POLYGON_VERTICE_NUM]</div><div class="ttdoc">Vertex coordinates.</div><div class="ttdef"><b>Definition:</b> basetypes.h:146</div></div>
<div class="ttc" id="agroup__IAV_html_ga6150e0515f7202e2fb518f7206ed97dc"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga6150e0515f7202e2fb518f7206ed97dc">iav_point::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> basetypes.h:134</div></div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">iav_window::width</a></div><div class="ttdeci">u32 width</div><div class="ttdoc">Window width.</div><div class="ttdef"><b>Definition:</b> basetypes.h:96</div></div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">iav_window::height</a></div><div class="ttdeci">u32 height</div><div class="ttdoc">Window height.</div><div class="ttdef"><b>Definition:</b> basetypes.h:97</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">iav_rect::x</a></div><div class="ttdeci">u32 x</div><div class="ttdoc">Offset X.</div><div class="ttdef"><b>Definition:</b> basetypes.h:112</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_ga3d615ae6358735f81cfed390de7da550"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga3d615ae6358735f81cfed390de7da550">pm_get_cfg</a></div><div class="ttdeci">AMBA_API int pm_get_cfg(u8 chan_id, struct pm_cfg_info *pm_cfg)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_ga4bb03b81e6e8283346e764c690b1e431"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga4bb03b81e6e8283346e764c690b1e431">pm_lib_deinit</a></div><div class="ttdeci">AMBA_API int pm_lib_deinit(void)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_ga75c53543b745e9883b4fe533179c5c0c"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga75c53543b745e9883b4fe533179c5c0c">pm_get_sys_info</a></div><div class="ttdeci">AMBA_API int pm_get_sys_info(int fd_iav, struct pm_sys_info *sys_info)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_ga7a7b565844f7e71b71766338df9978ef"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga7a7b565844f7e71b71766338df9978ef">pm_fill_polygon</a></div><div class="ttdeci">AMBA_API int pm_fill_polygon(u8 chan_id, struct iav_polygon *polygon, u8 pm_remove)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_ga81c5b410770fee38546ef45895d0b95e"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga81c5b410770fee38546ef45895d0b95e">pm_apply_cfg</a></div><div class="ttdeci">AMBA_API int pm_apply_cfg(u32 chan_map)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_ga99523a316a9dba9d75b3f0e1d047ec5c"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#ga99523a316a9dba9d75b3f0e1d047ec5c">pm_fill_circle</a></div><div class="ttdeci">AMBA_API int pm_fill_circle(u8 chan_id, struct iav_circle *circle, u8 pm_remove)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_gaa435c5e716d18c934fe8136eea19c535"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gaa435c5e716d18c934fe8136eea19c535">pm_fill_frame_border_by_mask</a></div><div class="ttdeci">AMBA_API int pm_fill_frame_border_by_mask(u8 chan_id, u8 *luma_data)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_gaad304605c049a0d3e591377b6eee738b"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gaad304605c049a0d3e591377b6eee738b">pm_fill_point</a></div><div class="ttdeci">AMBA_API int pm_fill_point(u8 chan_id, struct iav_point *pm_point, u8 pm_remove)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_gac5e218a9b9c8e048756ec1294f7edb7b"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gac5e218a9b9c8e048756ec1294f7edb7b">pm_lib_init</a></div><div class="ttdeci">AMBA_API int pm_lib_init(struct pm_usr_cfg *usr_cfg, struct pm_sys_info *sys_info)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_gacc9ff6312f9bda4152dd4bb065f98217"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gacc9ff6312f9bda4152dd4bb065f98217">pm_clear</a></div><div class="ttdeci">AMBA_API int pm_clear(u8 chan_id)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_gaf1453cbfba821ec0127060f02e705d56"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gaf1453cbfba821ec0127060f02e705d56">pm_insert</a></div><div class="ttdeci">AMBA_API int pm_insert(u8 chan_id, struct iav_privacy_mask *privacy_mask)</div></div>
<div class="ttc" id="agroup__PM__FUNCTION__GROUP_html_gafdf15c2c2724903df88b5982ed5324f7"><div class="ttname"><a href="../../../library/d8/d26/group__PM__FUNCTION__GROUP.html#gafdf15c2c2724903df88b5982ed5324f7">pm_fill_rect</a></div><div class="ttdeci">AMBA_API int pm_fill_rect(u8 chan_id, struct iav_rect *pm_rect, u8 pm_remove)</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaa1e977b4c4203d0b91b2d3533275e193a20b53edd6dd3a81b604237316233e6f2"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a20b53edd6dd3a81b604237316233e6f2">IAV_SRCBUF_LAST_PMN</a></div><div class="ttdeci">IAV_SRCBUF_LAST_PMN</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193aec86b02878b0ff21658d7f098098e08d">IAV_SRCBUF_MN</a></div><div class="ttdeci">IAV_SRCBUF_MN</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaa1e977b4c4203d0b91b2d3533275e193afca3200d598aaa4faa22157c8b079ddb"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193afca3200d598aaa4faa22157c8b079ddb">IAV_SRCBUF_FIRST</a></div><div class="ttdeci">IAV_SRCBUF_FIRST</div></div>
<div class="ttc" id="agroup__iav-structure_html_gacd773c6bc679fd96952a7641e9ba4d2a"><div class="ttname"><a href="../../df/d52/group__iav-structure.html#gacd773c6bc679fd96952a7641e9ba4d2a">MAX_POLYGON_VERTICE_NUM</a></div><div class="ttdeci">#define MAX_POLYGON_VERTICE_NUM</div><div class="ttdef"><b>Definition:</b> basetypes.h:142</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a1d909756ef49647a3774e92f15bb700ba88a06432843f05f62e45051f847363c3">IAV_VIDEO_PROC_DPTZ</a></div><div class="ttdeci">IAV_VIDEO_PROC_DPTZ</div></div>
<div class="ttc" id="alib__pm_8h_html"><div class="ttname"><a href="../../../library/d0/d16/lib__pm_8h.html">lib_pm.h</a></div></div>
<div class="ttc" id="astructhint__s_html"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html">hint_s</a></div></div>
<div class="ttc" id="astructhint__s_html_a2799cca21c05a4f99f4c8b3b178d0133"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">hint_s::str</a></div><div class="ttdeci">const char * str</div></div>
<div class="ttc" id="astructhint__s_html_aa56a50443afd9d2f7cf738fb7ffba168"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">hint_s::arg</a></div><div class="ttdeci">const char * arg</div></div>
<div class="ttc" id="astructiav__buf__cfg_html"><div class="ttname"><a href="../../../library/d6/da9/structiav__buf__cfg.html">iav_buf_cfg</a></div></div>
<div class="ttc" id="astructiav__buf__cfg_html_a2f1e22f38f7be358c963bc2a979fbf4d"><div class="ttname"><a href="../../../library/d6/da9/structiav__buf__cfg.html#a2f1e22f38f7be358c963bc2a979fbf4d">iav_buf_cfg::canvas_id</a></div><div class="ttdeci">u32 canvas_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1611</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a></div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_aa1281fe9a1e356ee476ec71c9f7914ac"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#aa1281fe9a1e356ee476ec71c9f7914ac">iav_canvas_cfg::max</a></div><div class="ttdeci">struct iav_window max</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1517</div></div>
<div class="ttc" id="astructiav__chan__cfg_html"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a></div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a124a81574b0fbd3d1e60e2917e5ecefe"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">iav_chan_cfg::vsrc_id</a></div><div class="ttdeci">u32 vsrc_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1315</div></div>
<div class="ttc" id="astructiav__circle_html"><div class="ttname"><a href="../../de/da5/structiav__circle.html">iav_circle</a></div><div class="ttdoc">IAV circle.</div><div class="ttdef"><b>Definition:</b> basetypes.h:122</div></div>
<div class="ttc" id="astructiav__dptz_html"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html">iav_dptz</a></div></div>
<div class="ttc" id="astructiav__dptz_html_a2830ebfe6ef0797f46e9fcc1945f4c01"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html#a2830ebfe6ef0797f46e9fcc1945f4c01">iav_dptz::buf_id</a></div><div class="ttdeci">u8 buf_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1618</div></div>
<div class="ttc" id="astructiav__dptz_html_a4eb5390353fb0508442db61e89ed786b"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html#a4eb5390353fb0508442db61e89ed786b">iav_dptz::pass_id</a></div><div class="ttdeci">u8 pass_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1617</div></div>
<div class="ttc" id="astructiav__dptz_html_a7f0c82e1f055e95da8a702634c3e56b0"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html#a7f0c82e1f055e95da8a702634c3e56b0">iav_dptz::channel_id</a></div><div class="ttdeci">u8 channel_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1616</div></div>
<div class="ttc" id="astructiav__dptz_html_ac7b3dbccd521a64f6489ec7450568484"><div class="ttname"><a href="../../../library/dd/d0b/structiav__dptz.html#ac7b3dbccd521a64f6489ec7450568484">iav_dptz::buf_cfg</a></div><div class="ttdeci">struct iav_buf_cfg buf_cfg</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1620</div></div>
<div class="ttc" id="astructiav__point_html"><div class="ttname"><a href="../../db/d22/structiav__point.html">iav_point</a></div><div class="ttdoc">IAV point.</div><div class="ttdef"><b>Definition:</b> basetypes.h:133</div></div>
<div class="ttc" id="astructiav__polygon_html"><div class="ttname"><a href="../../dc/d71/structiav__polygon.html">iav_polygon</a></div><div class="ttdoc">IAV polygon.</div><div class="ttdef"><b>Definition:</b> basetypes.h:143</div></div>
<div class="ttc" id="astructiav__privacy__mask_html_a27faf3e6632158a4337bd0537c69d9ea"><div class="ttname"><a href="../../../library/d6/d46/structiav__privacy__mask.html#a27faf3e6632158a4337bd0537c69d9ea">iav_privacy_mask::v</a></div><div class="ttdeci">u8 v</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3475</div></div>
<div class="ttc" id="astructiav__privacy__mask_html_ad87f9078b74ef74a58041131d06283c2"><div class="ttname"><a href="../../../library/d6/d46/structiav__privacy__mask.html#ad87f9078b74ef74a58041131d06283c2">iav_privacy_mask::y</a></div><div class="ttdeci">u8 y</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3473</div></div>
<div class="ttc" id="astructiav__privacy__mask_html_aee1a40d4001bf35b326657aa5656f251"><div class="ttname"><a href="../../../library/d6/d46/structiav__privacy__mask.html#aee1a40d4001bf35b326657aa5656f251">iav_privacy_mask::u</a></div><div class="ttdeci">u8 u</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3474</div></div>
<div class="ttc" id="astructiav__rect_html"><div class="ttname"><a href="../../de/d3a/structiav__rect.html">iav_rect</a></div><div class="ttdoc">IAV rectangle.</div><div class="ttdef"><b>Definition:</b> basetypes.h:111</div></div>
<div class="ttc" id="astructiav__video__proc_html"><div class="ttname"><a href="../../../library/d2/d92/structiav__video__proc.html">iav_video_proc</a></div></div>
<div class="ttc" id="astructiav__video__proc_html_a5088ad450ba62b8537bf514a00e08fdf"><div class="ttname"><a href="../../../library/d2/d92/structiav__video__proc.html#a5088ad450ba62b8537bf514a00e08fdf">iav_video_proc::arg</a></div><div class="ttdeci">union iav_video_proc::@83 arg</div></div>
<div class="ttc" id="astructiav__video__proc_html_ac4e5f5c915549f0671997f3153e9f5c9"><div class="ttname"><a href="../../../library/d2/d92/structiav__video__proc.html#ac4e5f5c915549f0671997f3153e9f5c9">iav_video_proc::dptz</a></div><div class="ttdeci">struct iav_dptz dptz</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3508</div></div>
<div class="ttc" id="astructiav__video__proc_html_af9eae96af4a33e97e8805e61bf4ef9b6"><div class="ttname"><a href="../../../library/d2/d92/structiav__video__proc.html#af9eae96af4a33e97e8805e61bf4ef9b6">iav_video_proc::cid</a></div><div class="ttdeci">enum iav_video_proc_id cid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3506</div></div>
<div class="ttc" id="astructpm__cfg__info_html"><div class="ttname"><a href="../../../library/db/de7/structpm__cfg__info.html">pm_cfg_info</a></div></div>
<div class="ttc" id="astructpm__cfg__info_html_a27eb54605e3857ad0cb34ee04ea9f321"><div class="ttname"><a href="../../../library/db/de7/structpm__cfg__info.html#a27eb54605e3857ad0cb34ee04ea9f321">pm_cfg_info::curr_pm_cfg</a></div><div class="ttdeci">struct iav_privacy_mask curr_pm_cfg</div></div>
<div class="ttc" id="astructpm__cfg__info_html_a550f7877292ec26bc162a3b66dfc6ea3"><div class="ttname"><a href="../../../library/db/de7/structpm__cfg__info.html#a550f7877292ec26bc162a3b66dfc6ea3">pm_cfg_info::pm_mem_size</a></div><div class="ttdeci">u32 pm_mem_size</div></div>
<div class="ttc" id="astructpm__cfg__info_html_acc97e8ecea5a6500f3c5d4b018f0a7ea"><div class="ttname"><a href="../../../library/db/de7/structpm__cfg__info.html#acc97e8ecea5a6500f3c5d4b018f0a7ea">pm_cfg_info::pm_virt_addr</a></div><div class="ttdeci">u8 * pm_virt_addr</div></div>
<div class="ttc" id="astructpm__sys__info_html"><div class="ttname"><a href="../../../library/d3/d1c/structpm__sys__info.html">pm_sys_info</a></div></div>
<div class="ttc" id="astructpm__sys__info_html_aba5507abae816e88e3593941099d6d66"><div class="ttname"><a href="../../../library/d3/d1c/structpm__sys__info.html#aba5507abae816e88e3593941099d6d66">pm_sys_info::main_domain_size</a></div><div class="ttdeci">struct iav_rect main_domain_size[IAV_MAX_CHANNEL_NUM]</div></div>
<div class="ttc" id="astructpm__sys__info_html_adf4e0c6a4dae7b113c1d3b5d15444ecb"><div class="ttname"><a href="../../../library/d3/d1c/structpm__sys__info.html#adf4e0c6a4dae7b113c1d3b5d15444ecb">pm_sys_info::canvas</a></div><div class="ttdeci">struct iav_canvas_cfg canvas[IAV_MAX_CANVAS_BUF_NUM]</div></div>
<div class="ttc" id="astructpm__sys__info_html_ae95c9b462723c8462c447ffb0bf276da"><div class="ttname"><a href="../../../library/d3/d1c/structpm__sys__info.html#ae95c9b462723c8462c447ffb0bf276da">pm_sys_info::channel_num</a></div><div class="ttdeci">u8 channel_num</div></div>
<div class="ttc" id="astructpm__usr__cfg_html"><div class="ttname"><a href="../../../library/d7/db7/structpm__usr__cfg.html">pm_usr_cfg</a></div></div>
<div class="ttc" id="astructpm__usr__cfg_html_a7da52c8866c4a14c7e7ab53988baf311"><div class="ttname"><a href="../../../library/d7/db7/structpm__usr__cfg.html#a7da52c8866c4a14c7e7ab53988baf311">pm_usr_cfg::use_warp_table_chan_map</a></div><div class="ttdeci">u8 use_warp_table_chan_map</div></div>
<div class="ttc" id="astructvindev__fps_html"><div class="ttname"><a href="../../../library/d8/d5f/structvindev__fps.html">vindev_fps</a></div></div>
<div class="ttc" id="astructvindev__fps_html_a0256d25b86a9f6d108e63e630fd20cf2"><div class="ttname"><a href="../../../library/d8/d5f/structvindev__fps.html#a0256d25b86a9f6d108e63e630fd20cf2">vindev_fps::fps</a></div><div class="ttdeci">unsigned int fps</div><div class="ttdef"><b>Definition:</b> iav_vin_common.h:525</div></div>
<div class="ttc" id="astructvindev__fps_html_aa1ecb62f419c3b454f5a2d4fd18d4818"><div class="ttname"><a href="../../../library/d8/d5f/structvindev__fps.html#aa1ecb62f419c3b454f5a2d4fd18d4818">vindev_fps::vsrc_id</a></div><div class="ttdeci">unsigned int vsrc_id</div><div class="ttdef"><b>Definition:</b> iav_vin_common.h:524</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aae"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aae">numeric_short_options</a></div><div class="ttdeci">numeric_short_options</div></div>
<div class="ttc" id="atest__fb_8h_html_a2d0022791143e08a64621257f48d9739"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a></div><div class="ttdeci">#define NO_ARG</div></div>
<div class="ttc" id="atest__fb_8h_html_affec572f11fcba59ce0cd49cbcd0110f"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a></div><div class="ttdeci">#define HAS_ARG</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
<div class="ttc" id="avin__init_8c_html_a5294002f7dca0cd9bcc0009a27895ef7"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a></div><div class="ttdeci">int fd_iav</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
