<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driver: test_stream.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Driver"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Driver<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/dbb/test_stream_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test_stream.c</div></div>
</div><!--header-->
<div class="contents">
<p >This is an example of how to configure a stream.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * test_stream.c</span></div>
<div class="line"><span class="comment"> * the program can read bitstream from BSB buffer and dump to different files</span></div>
<div class="line"><span class="comment"> * in different recording session, if there is no stream being recorded, then this</span></div>
<div class="line"><span class="comment"> * program will be in idle loop waiting and do not exit until explicitly closed.</span></div>
<div class="line"><span class="comment"> * this program may stop encoding if the encoding was started to be &quot;limited frames&quot;,</span></div>
<div class="line"><span class="comment"> * or stop all encoding when this program was forced to quit</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *  2009/12/31 - [Louis Sun] modify to use EX functions</span></div>
<div class="line"><span class="comment"> *  2012/01/11 - [Jian Tang] add different transfer method for streams</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2016 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents ( &quot;Software&quot; ) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/select.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/ddc/basetypes_8h.html">basetypes.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iav_ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;datatx_lib.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;pthread.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html">test_stream.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef AM_IOCTL</span></div>
<div class="line"><span class="preprocessor">#define AM_IOCTL(_filp, _cmd, _arg) \</span></div>
<div class="line"><span class="preprocessor">        do {                        \</span></div>
<div class="line"><span class="preprocessor">            if (ioctl(_filp, _cmd, _arg) &lt; 0) { \</span></div>
<div class="line"><span class="preprocessor">                perror(#_cmd);      \</span></div>
<div class="line"><span class="preprocessor">                return -1;          \</span></div>
<div class="line"><span class="preprocessor">            }                       \</span></div>
<div class="line"><span class="preprocessor">        } while (0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_STREAMID(x)   do {               \</span></div>
<div class="line"><span class="preprocessor">        if (((x) &lt; 0) || ((x) &gt;= MAX_ENCODE_STREAM_NUM)) {      \</span></div>
<div class="line"><span class="preprocessor">            printf (&quot;stream id wrong %d \n&quot;</span>, (x));                  \</div>
<div class="line">            return -1;      \</div>
<div class="line">            }       \</div>
<div class="line">        } while (0)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_ENCODE_STREAM_NUM   (IAV_STREAM_MAX_NUM_ALL)</span></div>
<div class="line"><span class="preprocessor">#define BASE_PORT           (2000)</span></div>
<div class="line"><span class="preprocessor">#define SVCT_PORT_OFFSET    (16)</span></div>
<div class="line"><span class="preprocessor">#define FAST_SEEK_PORT_OFFSET   (20)</span></div>
<div class="line"><span class="preprocessor">#define STATISTIC_PORT_OFFSET   (1)</span></div>
<div class="line"><span class="preprocessor">#define STREAM_DIFF_PORT_OFFSET (12)</span></div>
<div class="line"><span class="preprocessor">#define MAX_SVCT_LAYERS (4)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//print and write file intervals</span></div>
<div class="line"><span class="preprocessor">#define DEFAUT_FPS_STATISTICS_INTERVAL      (300) </span><span class="comment">//Bold fps print.(AVG FPS = ...)</span></div>
<div class="line"><span class="preprocessor">#define DEFAUT_PRINT_INTERVAL       (30) </span><span class="comment">//(stream A:...)</span></div>
<div class="line"><span class="preprocessor">#define DEFAUT_WRITE_STATISTICS_INTERVAL    (900) </span><span class="comment">//how often we refresh the statistics file</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define COLOR_PRINT0(msg)       printf(&quot;\033[34m&quot;</span>msg&quot;\033[39m&quot;)</div>
<div class="line"><span class="preprocessor">#define COLOR_PRINT(msg, arg...)        printf(&quot;\033[34m&quot;</span>msg&quot;\033[39m&quot;, arg)</div>
<div class="line"><span class="preprocessor">#define BOLD_PRINT0(msg, arg...)        printf(&quot;\033[1m&quot;</span>msg&quot;\033[22m&quot;)</div>
<div class="line"><span class="preprocessor">#define BOLD_PRINT(msg, arg...)     printf(&quot;\033[1m&quot;</span>msg&quot;\033[22m&quot;, arg)</div>
<div class="line"> </div>
<div class="line"><span class="comment">//total frames we need to capture</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> md5_idr_number = -1;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> audio_clock = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//debug options</span></div>
<div class="line"><span class="preprocessor">#undef DEBUG_PRINT_FRAME_INFO</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define GET_STREAMID(x) ((((x) &lt; 0) || ((x) &gt;= MAX_ENCODE_STREAM_NUM)) ? -1: (x))</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>transfer_method {</div>
<div class="line">    trans_method_t method;</div>
<div class="line">    <span class="keywordtype">int</span> port;</div>
<div class="line">    <span class="keywordtype">char</span> filename[256];</div>
<div class="line">} transfer_method;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> dram_test_method_s {</div>
<div class="line">    COMPARE_BYTE = 0,</div>
<div class="line">    COMPARE_HASH,</div>
<div class="line">    COMPARE_SHA256SUM,</div>
<div class="line">    TOTAL_METHOD_NUM,</div>
<div class="line">    DRAM_TEST_METHOD_FIRST = COMPARE_BYTE,</div>
<div class="line">    DRAM_TEST_METHOD_LAST = TOTAL_METHOD_NUM,</div>
<div class="line">} dram_test_method_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>__bitstream_info_t {</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> stream_id;               </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> capture_slice;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gaedee632d62ec29c16717d808e9bd406e">iav_stream_type</a> stream_type; </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pic_type        : 3;     </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> stream_end      : 1;     </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> reserved0       : 4;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> jpeg_quality    : 8;     </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> bitrate_kbps    : 16;    </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> reserved1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> session_id;          </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size;                </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> slice_id : 4;        </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> slice_num : 4;       </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> tile_id : 4;         </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> tile_num : 4;        </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> is_ltr_frame : 1;        </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> force_frame_skip : 1;    </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> reserved2 : 14;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> arm_pts;             </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> dsp_pts;             </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> enc_done_ts;         </div>
<div class="line">    <span class="keyword">struct </span><a id="_a0" name="_a0"></a><a class="code hl_struct" href="../../dc/d76/structiav__window.html">iav_window</a> reso;      </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> data_addr_offset;  </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> mv_data_offset;    </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> cap_seq_no;     </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> sliceheader_offset;     </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> encoded_frame_num;      </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> frame_num;           </div>
<div class="line">} bitstream_info_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// the device file handle</span></div>
<div class="line"><span class="keywordtype">int</span> <a id="a1" name="a1"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// the bitstream buffer</span></div>
<div class="line"><a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *bsb_mem;</div>
<div class="line"><a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> bsb_size;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> nofile_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> frame_info_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> show_audio_clock_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> show_pts_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_pts_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_dram_test_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_statistics_flag = 1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> file_size_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> file_size_mega_byte = 100;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> remove_time_string_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> split_svct_layer_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> split_fast_seek_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> dram_test_method = COMPARE_BYTE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> fps_statistics_interval = DEFAUT_FPS_STATISTICS_INTERVAL;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> print_interval = DEFAUT_PRINT_INTERVAL;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_statistics_interval = DEFAUT_WRITE_STATISTICS_INTERVAL;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//create files for writing</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_none, init_nfs, init_tcp, init_usb, init_stdout;</div>
<div class="line"><span class="keyword">static</span> transfer_method stream_transfer[MAX_ENCODE_STREAM_NUM];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> default_transfer_method = TRANS_METHOD_NFS;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> transfer_port = BASE_PORT;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// bitstream filename base</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> filename[512];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> stream_diff_file_name[256];</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *default_filename;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *default_filename_nfs = <span class="stringliteral">&quot;/mnt/test&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *default_filename_tcp = <span class="stringliteral">&quot;media/test&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *default_host_ip_addr = <span class="stringliteral">&quot;10.0.0.1&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> stream_diff_file_save = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 0 : frame, 1: slice</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> capture_slice = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//verbose</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> verbose_mode = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//statistics</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> statistics_mode = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// check stream cfg for dram test</span></div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> stream_mask = 0;      <span class="comment">// indicate stream status</span></div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> dram_test_stream_map = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>  stream_checked = 0;   <span class="comment">// stream cfg for dram test checked ok</span></div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>  enable_hp_fps = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a id="a2" name="a2"></a>usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keywordtype">int</span> options_num = <span class="keyword">sizeof</span>(<a id="a3" name="a3"></a>long_options) / <span class="keyword">sizeof</span>(long_options[0]) - 1;</div>
<div class="line">    printf(<span class="stringliteral">&quot;test_stream usage:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; options_num; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (isalpha(long_options[i].val))</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c &quot;</span>, long_options[i].val);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;--%s&quot;</span>, long_options[i].<a id="a4" name="a4"></a>name);</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a5" name="a5"></a>hint[i].arg[0] != 0)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [%s]&quot;</span>, hint[i].arg);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, hint[i].str);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nStatistics module usage: \n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\tIt has to run test_stream before enabling encoding stream \n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\tin order to get accurate statistics values. And when test \n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\tdone, please end streaming first. \n&quot;</span></div>
<div class="line"> </div>
<div class="line">        <span class="stringliteral">&quot;\nExample: \n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\tSave stream file with file name beginning with &#39;video&#39; under \n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\t/mnt folder and refresh statistics file every 900 frames.\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\t\ttest_stream -f /mnt/video -s 900\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\tSave no file and print statistics information every 900 frames.\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\t\ttest_stream -s 900 --nofile\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>stream_encoding_state_s{</div>
<div class="line">    <span class="keywordtype">int</span> session_id; <span class="comment">//stream encoding session</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_frames; <span class="comment">// count how many frames encoded, help to divide for session before session id is implemented</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_bytes;  <span class="comment">//count how many bytes encoded</span></div>
<div class="line">    <span class="keywordtype">int</span> pic_type;     <span class="comment">//picture type,  non changed during encoding, help to validate encoding state.</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> monotonic_pts;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> enc_done_ts;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> enc_done_ts_diff_sum;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> i_num;  <span class="comment">//record i frame&#39;s number</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_frames_i;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_frames_p;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_frames_b;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_bytes_i;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_bytes_p;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_bytes_b;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> hw_pts;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>timeval capture_start_time;  <span class="comment">//for statistics only,  this &quot;start&quot; is captured start, may be later than actual start</span></div>
<div class="line">    <span class="keyword">struct </span>timeval encoding_start_time; <span class="comment">//the time when encoding starts</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_frames2;  <span class="comment">//for fps measured every fps_statistics_interval frames</span></div>
<div class="line">    <span class="keyword">struct </span>timeval time2;   <span class="comment">//for fps measured every fps_statistics_interval frames</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_bytes_gop;    <span class="comment">//for bitrate measured within the scope of one gop</span></div>
<div class="line">    <span class="keyword">struct </span>timeval time_gop;    <span class="comment">//for bitrate measured within the scope of one gop</span></div>
<div class="line"> </div>
<div class="line">} stream_encoding_state_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>stream_files_s{</div>
<div class="line">    <span class="keywordtype">int</span> session_id; <span class="comment">//stream encoding session</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_bytes;  <span class="comment">//count how many bytes encoded</span></div>
<div class="line">    <span class="keywordtype">int</span> fd;     <span class="comment">//stream write file handle</span></div>
<div class="line">    <span class="keywordtype">int</span> fd_info;    <span class="comment">//info write file handle</span></div>
<div class="line">    <span class="keywordtype">int</span> fd_svct[MAX_SVCT_LAYERS];   <span class="comment">//file descriptor for svct streams</span></div>
<div class="line">    <span class="keywordtype">int</span> fd_fast_seek;   <span class="comment">//file descriptor for fast seek streams</span></div>
<div class="line">    <span class="keywordtype">int</span> gop_structure;  <span class="comment">//store gop structure</span></div>
<div class="line">    <span class="keywordtype">int</span> fast_seek_intvl;    <span class="comment">//store fast seek intvl</span></div>
<div class="line">} stream_files_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>stream_encoding_statistics_s{</div>
<div class="line">    <span class="keywordtype">int</span> statistics_fd;  <span class="comment">//file descriptor for statistics file</span></div>
<div class="line">    <span class="keywordtype">char</span> write_file_name[1024];</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> gop;        <span class="comment">//previous gop value</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> max_hw_pts_diff;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> min_hw_pts_diff;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> avg_hw_pts_diff;    <span class="comment">//avg dsp pts diff from the beginning to the end</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> hw_pts_diff_sum;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> hw_pts_diff_sum_2;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> max_arm_pts;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> min_arm_pts;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> avg_arm_pts;    <span class="comment">//avg arm pts diff from the beginning to the end</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> max_enc_done_pts;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> min_enc_done_pts;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> avg_enc_done_pts;   <span class="comment">//avg enc done pts diff from the beginning to the end</span></div>
<div class="line">    <span class="keywordtype">char</span> *gop_record;   <span class="comment">//record different gop value</span></div>
<div class="line">    <span class="keywordtype">double</span> max_fps;</div>
<div class="line">    <span class="keywordtype">double</span> min_fps;</div>
<div class="line">    <span class="keywordtype">double</span> rt_fps;      <span class="comment">//real-time fps, calculated every print_interval frames</span></div>
<div class="line">    <span class="keywordtype">double</span> avg_fps;     <span class="comment">//avg fps measured from the beginning to the end</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> rt_bitrate;     <span class="comment">//real-time bitrate, measured every print_interval frames</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> max_bitrate;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> min_bitrate;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> avg_bitrate;    <span class="comment">//avg bitrate from the beginning to the end</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> max_bitrate_gop;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> min_bitrate_gop;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> max_frame_size;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> min_frame_size;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> avg_frame_size; <span class="comment">//avg frame size from the beginning to the end</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> max_i_frame;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> min_i_frame;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> avg_i_frame;    <span class="comment">//avg i frame size from the beginning to the end</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> max_p_frame;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> min_p_frame;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> avg_p_frame;    <span class="comment">//avg p frame size from the beginning to the end</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> max_b_frame;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> min_b_frame;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> avg_b_frame;    <span class="comment">//avg b frame size from the beginning to the end</span></div>
<div class="line">} stream_encoding_statistics_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>pipe_mesg_s {</div>
<div class="line">    bitstream_info_t framedesc;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> new_session : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> new_frame : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> last_desc : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> stop : 1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> tile_num : 5;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> reserved : 23;</div>
<div class="line">} pipe_mesg_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>frame_info_s {</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pic_type : 3;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> tile_num : 5;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> reserved : 24;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> frame_cnt;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> data_addr_offset[<a id="a6" name="a6"></a><a class="code hl_define" href="../../dummy.html">IAV_HEVC_TILE_NUM</a>];</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size[<a class="code hl_define" href="../../dummy.html">IAV_HEVC_TILE_NUM</a>];</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> cap_seq_no;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> dsp_pts;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> arm_pts;</div>
<div class="line">} frame_info_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> pipe_type_s {</div>
<div class="line">    STATISTICS_PIPE = 0,</div>
<div class="line">    DRAM_TEST_PIPE,</div>
<div class="line">    PIPE_TYPE_NUM,</div>
<div class="line">} pipe_type_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>rect_window {</div>
<div class="line">    <span class="keywordtype">int</span> x;                           <span class="comment">// x offset</span></div>
<div class="line">    <span class="keywordtype">int</span> y;                           <span class="comment">// y offset</span></div>
<div class="line">    <span class="keywordtype">int</span> width;</div>
<div class="line">    <span class="keywordtype">int</span> height;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// current only interested in the following members. add more if needed.</span></div>
<div class="line"><span class="keyword">struct </span>enc_extra_cfg_t {</div>
<div class="line">    <span class="keyword">struct </span><a id="_a7" name="_a7"></a><a class="code hl_structRef" target="_blank" href="../../../library/df/d72/structiav__bitrate.html">iav_bitrate</a> h26x_rc;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a8" name="_a8"></a><a class="code hl_structRef" target="_blank" href="../../../library/d7/d16/structiav__h26x__drop__frame.html">iav_h26x_drop_frame</a> h26x_drop_frame;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a9" name="_a9"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/d7c/structiav__h26x__pskip.html">iav_h26x_pskip</a> h26x_pskip;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> mjpeg_quality;</div>
<div class="line">    <span class="keywordtype">int</span> tmp_abs_br_flag;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> stream_dummy_latency;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> sar_width;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> sar_height;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> slice_num;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> slices_per_info;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> reserved;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>stream_info {</div>
<div class="line">    <span class="keyword">struct </span>rect_window win;           <span class="comment">// the window</span></div>
<div class="line">    <span class="keyword">struct </span><a id="_a10" name="_a10"></a><a class="code hl_structRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html">iav_h26x_cfg</a> h26x_cfg;</div>
<div class="line">    <span class="keyword">struct </span>enc_extra_cfg_t extra;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a11" name="_a11"></a><a class="code hl_structRef" target="_blank" href="../../../library/d7/d43/structiav__mjpeg__cfg.html">iav_mjpeg_cfg</a> mjpeg_cfg;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gaedee632d62ec29c16717d808e9bd406e">iav_stream_type</a> type;        <span class="comment">// encode type</span></div>
<div class="line">    <span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ga5a8457a3780c3eb2c9452cae958284e4">iav_stream_state</a> state;      <span class="comment">// encode state</span></div>
<div class="line">    <span class="keywordtype">int</span>  canvas;                      <span class="comment">// source canvas</span></div>
<div class="line">    <span class="keywordtype">int</span>  abs_fps;                     <span class="comment">// abs fps</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> hflip;</div>
<div class="line">    <span class="keywordtype">int</span> vflip;</div>
<div class="line">    <span class="keywordtype">int</span> rotate_cw;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> frame_info_t frame_info[MAX_ENCODE_STREAM_NUM];</div>
<div class="line"><span class="keyword">static</span> stream_encoding_state_t encoding_states[MAX_ENCODE_STREAM_NUM];</div>
<div class="line"><span class="keyword">static</span> stream_encoding_state_t old_encoding_states[MAX_ENCODE_STREAM_NUM];      <span class="comment">//old states for statistics only</span></div>
<div class="line"><span class="keyword">static</span> stream_encoding_statistics_t encoding_statistics[MAX_ENCODE_STREAM_NUM]; <span class="comment">//store statistics data</span></div>
<div class="line"><span class="keyword">static</span> stream_files_t stream_files[MAX_ENCODE_STREAM_NUM];</div>
<div class="line"> </div>
<div class="line"><span class="comment">//pipe and thread for statistics module</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> statistics_pipefd[2] = {-1, -1};</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> dram_test_pipefd[2] = {-1, -1};</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> statistics_run = 1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> dram_test_run = 1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_video_file_run = 1;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_param(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, ch;</div>
<div class="line">    <span class="keywordtype">int</span> option_index = 0;</div>
<div class="line">    <span class="keywordtype">int</span> <a id="a12" name="a12"></a>current_stream = -1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> min_value;</div>
<div class="line">    transfer_method *trans;</div>
<div class="line">    <span class="keywordtype">char</span> str[][16] = { <span class="stringliteral">&quot;NONE&quot;</span>, <span class="stringliteral">&quot;NFS&quot;</span>, <span class="stringliteral">&quot;TCP&quot;</span>, <span class="stringliteral">&quot;USB&quot;</span>, <span class="stringliteral">&quot;STDOUT&quot;</span>};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; i++) {</div>
<div class="line">        stream_transfer[i].method = TRANS_METHOD_UNDEFINED;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    opterr = 0;</div>
<div class="line">    <span class="keywordflow">while</span> ((ch = getopt_long(argc, argv, <a id="a13" name="a13"></a>short_options, long_options, &amp;option_index)) != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div>
<div class="line">            current_stream = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>:</div>
<div class="line">            current_stream = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:</div>
<div class="line">            current_stream = 2;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:</div>
<div class="line">            current_stream = 3;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:</div>
<div class="line">            current_stream = 4;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:</div>
<div class="line">            min_value = atoi(optarg);</div>
<div class="line">            <a id="a14" name="a14"></a><a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(min_value);</div>
<div class="line">            current_stream = min_value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line">            current_stream = GET_STREAMID(current_stream);</div>
<div class="line">            <span class="keywordflow">if</span> (current_stream &lt; 0) {</div>
<div class="line">                strcpy(filename, optarg);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                strcpy(stream_transfer[current_stream].filename, optarg);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">            statistics_mode = 1;</div>
<div class="line">            write_statistics_interval = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line">            current_stream = GET_STREAMID(current_stream);</div>
<div class="line">            <span class="keywordflow">if</span> (current_stream &gt;= 0) {</div>
<div class="line">                stream_transfer[current_stream].method = TRANS_METHOD_TCP;</div>
<div class="line">            }</div>
<div class="line">            default_transfer_method = TRANS_METHOD_TCP;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:</div>
<div class="line">            current_stream = GET_STREAMID(current_stream);</div>
<div class="line">            <span class="keywordflow">if</span> (current_stream &gt;= 0) {</div>
<div class="line">                stream_transfer[current_stream].method = TRANS_METHOD_STDOUT;</div>
<div class="line">            }</div>
<div class="line">            default_transfer_method = TRANS_METHOD_STDOUT;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div>
<div class="line">            <span class="keywordflow">if</span> (!do_statistics_flag) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Please enable statistics firstly!\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            fps_statistics_interval = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line">            <span class="keywordflow">if</span> (!do_statistics_flag) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Please enable statistics firstly!\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            print_interval = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a15" name="a15"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeac845bd8136b5ab1741b9abccbf58aeac">STATISTICS_ENABLE</a>:</div>
<div class="line">            do_statistics_flag = (!!atoi(optarg));</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a16" name="a16"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea637afe18583cff238d12c0522a692f50">NOFILE_TRANSER</a>:</div>
<div class="line">            current_stream = GET_STREAMID(current_stream);</div>
<div class="line">            <span class="keywordflow">if</span> (current_stream &gt;= 0) {</div>
<div class="line">                stream_transfer[current_stream].method = TRANS_METHOD_NONE;</div>
<div class="line">            }</div>
<div class="line">            default_transfer_method = TRANS_METHOD_NONE;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a17" name="a17"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea8f825a034126d18b0a8ca85117df48fc">TOTAL_FRAMES</a>:</div>
<div class="line">            md5_idr_number = atoi(optarg);</div>
<div class="line">            printf(<span class="stringliteral">&quot;md5_idr_number %d \n&quot;</span>, md5_idr_number);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a18" name="a18"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeaf07a8bfb780c09b2f1786c427cb32010">TOTAL_SIZE</a>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a19" name="a19"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea77e935819b3b2cc9bc87ccba8e7b1722">FILE_SIZE</a>:</div>
<div class="line">            file_size_flag = 1;</div>
<div class="line">            file_size_mega_byte = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a20" name="a20"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea21f6d86a4b26c0e1ccb78b1b7b1f5ddd">SAVE_FRAME_INFO</a>:</div>
<div class="line">            frame_info_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a21" name="a21"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea1ad6852ac8ab9104e11989e20b8616aa">SHOW_AUDIO_CLOCK</a>:</div>
<div class="line">            show_audio_clock_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a22" name="a22"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea95763fbb86cde074e0aab8c840c28af8">SHOW_PTS_INFO</a>:</div>
<div class="line">            show_pts_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a23" name="a23"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea591222906b6218be78bc1a8814c836d7">CHECK_PTS_INFO</a>:</div>
<div class="line">            check_pts_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a24" name="a24"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeab14ccfb4cce502857a618ad07098ea27">REMOVE_TIME_STRING</a>:</div>
<div class="line">            remove_time_string_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a25" name="a25"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea001a55fbe6c86d020642d842e01b233c">SPLIT_SVCT_LAYER</a>:</div>
<div class="line">            split_svct_layer_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a26" name="a26"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea988983b6caa6a345d87d0357ad9e5593">SPLIT_FAST_SEEK</a>:</div>
<div class="line">            split_fast_seek_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a27" name="a27"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeaab63096b334741d46f4182ae110c927b">DRAM_TEST_ENABLE</a>:</div>
<div class="line">            do_dram_test_flag = (!!atoi(optarg));</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a28" name="a28"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea3482d1749c57f4d0ece54dd8737e8184">DRAM_TEST_METHOD</a>:</div>
<div class="line">            <span class="keywordflow">if</span> (!do_dram_test_flag) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Please enable dram test first!\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            dram_test_method = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> ((dram_test_method &lt; DRAM_TEST_METHOD_FIRST) ||</div>
<div class="line">                (dram_test_method &gt;= DRAM_TEST_METHOD_LAST)) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Invalid dram test method!\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a29" name="a29"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeab936b39a1bdd0e57f1447ac19fa36c66">DRAM_TEST_STREAM_MAP</a>:</div>
<div class="line">            dram_test_stream_map = strtol(optarg, NULL, 16);;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a30" name="a30"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeabb865e0df690484fcd0ac460c9abbaac">STREAM_DIFF_FILE</a>:</div>
<div class="line">            strcpy(stream_diff_file_name, optarg);</div>
<div class="line">            stream_diff_file_save = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a31" name="a31"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea3dc3b99435b29917ea9897a299e27150">HOST_IP_ADDR</a>:</div>
<div class="line">            <span class="keywordflow">if</span> (INADDR_NONE == inet_addr(optarg)) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;ip address error!\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            setenv(<span class="stringliteral">&quot;HOST_IP_ADDR&quot;</span>, optarg, 1);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div>
<div class="line">            capture_slice = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div>
<div class="line">            verbose_mode = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;unknown command %s \n&quot;</span>, optarg);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; i++) {</div>
<div class="line">        trans = &amp;stream_transfer[i];</div>
<div class="line">        trans-&gt;port = transfer_port + i;</div>
<div class="line">        <span class="keywordflow">if</span> (strlen(trans-&gt;filename) &gt; 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (trans-&gt;method == TRANS_METHOD_UNDEFINED)</div>
<div class="line">                trans-&gt;method = TRANS_METHOD_NFS;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (trans-&gt;method == TRANS_METHOD_UNDEFINED) {</div>
<div class="line">                trans-&gt;method = default_transfer_method;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">switch</span> (trans-&gt;method) {</div>
<div class="line">            <span class="keywordflow">case</span> TRANS_METHOD_NFS:</div>
<div class="line">            <span class="keywordflow">case</span> TRANS_METHOD_STDOUT:</div>
<div class="line">                <span class="keywordflow">if</span> (strlen(filename) == 0)</div>
<div class="line">                    default_filename = default_filename_nfs;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                    default_filename = filename;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> TRANS_METHOD_TCP:</div>
<div class="line">                <span class="keywordflow">if</span> (strlen(filename) == 0)</div>
<div class="line">                    default_filename = default_filename_tcp;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                    default_filename = filename;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                default_filename = NULL;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (default_filename != NULL)</div>
<div class="line">                strcpy(trans-&gt;filename, default_filename);</div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot;Stream %c %s: %s\n&quot;</span>, <span class="charliteral">&#39;A&#39;</span> + i, str[trans-&gt;method], trans-&gt;filename);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_dram_test_flag &amp;&amp; (!dram_test_stream_map)) {</div>
<div class="line">        dram_test_stream_map = ~0;</div>
<div class="line">        printf(<span class="stringliteral">&quot;Do DRAM test for all active streams, when no stream map is specified.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_encoding_states(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; i++) {</div>
<div class="line">        encoding_states[i].total_bytes = 0;</div>
<div class="line">        encoding_states[i].total_frames = 0;</div>
<div class="line">        encoding_states[i].pic_type = 0;</div>
<div class="line">        encoding_states[i].i_num = 0;</div>
<div class="line">        encoding_states[i].enc_done_ts_diff_sum = 0;</div>
<div class="line">        encoding_states[i].hw_pts = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_stream_files(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i,j;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(i = 0; i &lt; MAX_ENCODE_STREAM_NUM; i++) {</div>
<div class="line">        stream_files[i].fd = -1;</div>
<div class="line">        stream_files[i].fd_info = -1;</div>
<div class="line">        stream_files[i].session_id = -1;</div>
<div class="line">        stream_files[i].gop_structure = 0;</div>
<div class="line">        stream_files[i].fast_seek_intvl = 0;</div>
<div class="line">        stream_files[i].fd_fast_seek = -1;</div>
<div class="line">        stream_files[i].total_bytes = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; MAX_SVCT_LAYERS; ++j) {</div>
<div class="line">            stream_files[i].fd_svct[j] = -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_encoding_statistics(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; ++i) {</div>
<div class="line">        memset(&amp;encoding_statistics[i], 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> stream_encoding_statistics_s));</div>
<div class="line">        encoding_statistics[i].statistics_fd = -1;</div>
<div class="line">        encoding_statistics[i].gop_record = (<span class="keywordtype">char</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*<a id="a32" name="a32"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#a8342bfd015dff2d669da85b8ae96e6ac">PRINT_CHARACTER_AMOUNT</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (NULL == encoding_statistics[i].gop_record) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Can&#39;t malloc memory for gop_record!\n&quot;</span>);</div>
<div class="line">            err = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        memset(encoding_statistics[i].gop_record, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*PRINT_CHARACTER_AMOUNT);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i&lt; MAX_ENCODE_STREAM_NUM; ++i) {</div>
<div class="line">            <span class="keywordflow">if</span> (encoding_statistics[i].gop_record) {</div>
<div class="line">                free(encoding_statistics[i].gop_record);</div>
<div class="line">                encoding_statistics[i].gop_record = NULL;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> close_stream_files(<span class="keywordtype">int</span> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (stream_files[stream_id].fd &gt; 0) {</div>
<div class="line">        amba_transfer_close(stream_files[stream_id].fd,</div>
<div class="line">            stream_transfer[stream_id].method);</div>
<div class="line">        stream_files[stream_id].fd = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (stream_files[stream_id].fd_info &gt; 0) {</div>
<div class="line">        amba_transfer_close(stream_files[stream_id].fd,</div>
<div class="line">            stream_transfer[stream_id].method);</div>
<div class="line">        stream_files[stream_id].fd_info = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (split_svct_layer_flag) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; MAX_SVCT_LAYERS; ++i) {</div>
<div class="line">            <span class="keywordflow">if</span> (stream_files[stream_id].fd_svct[i] &gt; 0) {</div>
<div class="line">                amba_transfer_close(stream_files[stream_id].fd_svct[i],</div>
<div class="line">                    stream_transfer[stream_id].method);</div>
<div class="line">                stream_files[stream_id].fd_svct[i] = -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (stream_files[stream_id].gop_structure &gt; 0) {</div>
<div class="line">            stream_files[stream_id].gop_structure = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (split_fast_seek_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (stream_files[stream_id].fd_fast_seek &gt; 0) {</div>
<div class="line">            amba_transfer_close(stream_files[stream_id].fd_fast_seek,</div>
<div class="line">                stream_transfer[stream_id].method);</div>
<div class="line">            stream_files[stream_id].fd_fast_seek = -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (stream_files[stream_id].fast_seek_intvl &gt; 0) {</div>
<div class="line">            stream_files[stream_id].fast_seek_intvl = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> deinit_stream_files(<span class="keywordtype">int</span> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (stream_id == -1) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; ++i) {</div>
<div class="line">            close_stream_files(i);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        close_stream_files(stream_id);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_data(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a33" name="_a33"></a><a class="code hl_structRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a> system_resource = {0};</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"> </div>
<div class="line">    init_encoding_states();</div>
<div class="line">    init_stream_files();</div>
<div class="line">    <span class="keywordflow">if</span> (init_encoding_statistics() &lt; 0) {</div>
<div class="line">        ret = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    system_resource.<a id="a34" name="a34"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#ab16f548b2c418aee70c310a931fdfab1">encode_mode</a> = <a id="a35" name="a35"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a>;</div>
<div class="line">    <a id="a36" name="a36"></a><a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a37" name="a37"></a>IAV_IOC_GET_SYSTEM_RESOURCE, &amp;system_resource);</div>
<div class="line">    <a id="a38" name="a38"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#a87675bec1fc71ad0dd5cfbc714172dad">enable_hp_fps</a> = system_resource.<a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#a87675bec1fc71ad0dd5cfbc714172dad">enable_hp_fps</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_h26x_gop_start(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> ret = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((framedesc-&gt;pic_type == <a id="a39" name="a39"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a7d85c038f6df51d23fc7f9397400b54f">IAV_PIC_TYPE_IDR_FRAME</a>) &amp;&amp;</div>
<div class="line">            (framedesc-&gt;tile_id == 0) &amp;&amp; (framedesc-&gt;slice_id == 0)) {</div>
<div class="line">        ret = 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//return 0 if it&#39;s not new session,  return 1 if it is new session</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> is_new_session(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    <span class="keywordtype">int</span> new_session = 0 ;</div>
<div class="line">    <span class="keywordflow">if</span>  (framedesc -&gt;session_id != stream_files[stream_id].session_id) {</div>
<div class="line">        <span class="comment">//a new session</span></div>
<div class="line">        new_session = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (file_size_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> ((stream_files[stream_id].total_bytes / 1024) &gt; (file_size_mega_byte * 1024) &amp;&amp;</div>
<div class="line">            (framedesc-&gt;pic_type == <a id="a40" name="a40"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a5023438b86660d10ddf54eb8498ee45f">IAV_PIC_TYPE_MJPEG_FRAME</a> || is_h26x_gop_start(framedesc))) {</div>
<div class="line">            new_session = 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> new_session;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_new_frame(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> new_frame = 0;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a41" name="_a41"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a> streamcfg;</div>
<div class="line">    <span class="keywordtype">int</span> slice_per_info = <a id="a42" name="a42"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga84627a72058502328269676b81780f89aeb22a4b43946af85900ae58b30a3c3d6">IAV_ONE_BITS_INFO_PER_TILE</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;stream_type == <a id="a43" name="a43"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>) {</div>
<div class="line">        streamcfg.id = framedesc-&gt;stream_id;</div>
<div class="line">        streamcfg.cid = <a id="a44" name="a44"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a1c861139c2cef5211143f5f2f509c027">IAV_H265_CFG_SLICE</a>;</div>
<div class="line">        ioctl(fd_iav, <a id="a45" name="a45"></a>IAV_IOC_GET_STREAM_CONFIG, &amp;streamcfg);</div>
<div class="line">        slice_per_info = streamcfg.arg.h265_slice.slices_per_info;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        new_frame = 1;</div>
<div class="line">        <span class="keywordflow">return</span> new_frame;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (slice_per_info) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga84627a72058502328269676b81780f89aeb22a4b43946af85900ae58b30a3c3d6">IAV_ONE_BITS_INFO_PER_TILE</a>:</div>
<div class="line">        <span class="keywordflow">if</span> ((framedesc-&gt;tile_id == 0) &amp;&amp; (framedesc-&gt;slice_id == 0)) {</div>
<div class="line">            new_frame = 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a id="a46" name="a46"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga84627a72058502328269676b81780f89ae7e98a4c667f61d6e8a90d4bc9b8a849">IAV_ONE_BITS_INFO_PER_FRAME</a>:</div>
<div class="line">        <span class="keywordflow">if</span> ((framedesc-&gt;tile_id == framedesc-&gt;tile_num - 1) &amp;&amp;</div>
<div class="line">            (framedesc-&gt;slice_id == framedesc-&gt;slice_num - 1)) {</div>
<div class="line">            new_frame = 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">if</span> ((framedesc-&gt;slice_id == slice_per_info - 1)) {</div>
<div class="line">            new_frame = 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> new_frame;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_last_framedesc(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_lastdesc = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> ((framedesc-&gt;tile_id == framedesc-&gt;tile_num - 1) &amp;&amp;</div>
<div class="line">            (framedesc-&gt;slice_id == framedesc-&gt;slice_num - 1)) {</div>
<div class="line">            is_lastdesc = 1;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        is_lastdesc = 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> is_lastdesc;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> get_desc_type_str(bitstream_info_t *framedesc, <span class="keywordtype">char</span> *desc_str)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> slice_per_info;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a> streamcfg;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>) {</div>
<div class="line">        streamcfg.<a id="a47" name="a47"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a76f8ba65ce8f902c0657233adee58698">id</a> = framedesc-&gt;stream_id;</div>
<div class="line">        streamcfg.cid = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a1c861139c2cef5211143f5f2f509c027">IAV_H265_CFG_SLICE</a>;</div>
<div class="line">        ioctl(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;streamcfg);</div>
<div class="line">        slice_per_info = streamcfg.arg.h265_slice.slices_per_info;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span> (slice_per_info) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga84627a72058502328269676b81780f89aeb22a4b43946af85900ae58b30a3c3d6">IAV_ONE_BITS_INFO_PER_TILE</a>:</div>
<div class="line">            strcpy(desc_str, <span class="stringliteral">&quot; Tile&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga84627a72058502328269676b81780f89ae7e98a4c667f61d6e8a90d4bc9b8a849">IAV_ONE_BITS_INFO_PER_FRAME</a>:</div>
<div class="line">            strcpy(desc_str, <span class="stringliteral">&quot;Frame&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            strcpy(desc_str, <span class="stringliteral">&quot;Slice&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        strcpy(desc_str, <span class="stringliteral">&quot;Frame&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_time_string( <span class="keywordtype">char</span> * time_str,  <span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">    time_t  t;</div>
<div class="line">    <span class="keyword">struct </span>tm * tmp;</div>
<div class="line"> </div>
<div class="line">    t= time(NULL);</div>
<div class="line">    tmp = gmtime(&amp;t);</div>
<div class="line">    <span class="keywordflow">if</span> (strftime(time_str, len, <span class="stringliteral">&quot;%m%d%H%M%S&quot;</span>, tmp) == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;date string format error \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> get_audio_clock(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define CLOCK_BUF_LEN   (4096)</span></div>
<div class="line">    <span class="keywordtype">char</span> *clock_buf = NULL, *clock_ptr = NULL, *end_ptr = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> audio_clock = 12288000; <span class="comment">// default to 12.288MHz</span></div>
<div class="line">    <span class="keywordtype">int</span> fd_proc = -1;</div>
<div class="line"> </div>
<div class="line">    fd_proc = open(<span class="stringliteral">&quot;/proc/ambarella/clock&quot;</span>, O_RDONLY);</div>
<div class="line">    <span class="keywordflow">if</span> (fd_proc &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to open /proc/ambarella/clock!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> GET_AUDIO_CLOCK_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    lseek(fd_proc, 0L, SEEK_SET);</div>
<div class="line">    clock_buf = malloc(CLOCK_BUF_LEN);</div>
<div class="line">    <span class="keywordflow">if</span> (read(fd_proc, clock_buf, CLOCK_BUF_LEN) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;read error.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> GET_AUDIO_CLOCK_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    clock_ptr = strstr(clock_buf, <span class="stringliteral">&quot;gclk_audio:&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (clock_ptr == NULL) {</div>
<div class="line">        <span class="keywordflow">goto</span> GET_AUDIO_CLOCK_EXIT;</div>
<div class="line">    }</div>
<div class="line">    clock_ptr += strlen(<span class="stringliteral">&quot;gclk_audio:&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    audio_clock = strtol(clock_ptr, &amp;end_ptr, 10);</div>
<div class="line"> </div>
<div class="line">GET_AUDIO_CLOCK_EXIT:</div>
<div class="line">    <span class="keywordflow">if</span> (fd_proc &gt;= 0) {</div>
<div class="line">        close(fd_proc);</div>
<div class="line">        fd_proc = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (clock_buf) {</div>
<div class="line">        free(clock_buf);</div>
<div class="line">        clock_buf = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> audio_clock;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERSION 0x00000005</span></div>
<div class="line"><span class="preprocessor">#define PTS_IN_ONE_SECOND       (90000)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_frame_info_header(<span class="keywordtype">int</span> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> dummy_config[36];</div>
<div class="line">    <span class="keywordtype">int</span> version = VERSION;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size = <span class="keyword">sizeof</span>(dummy_config);</div>
<div class="line">    <span class="keywordtype">int</span> fd_info = stream_files[stream_id].fd_info;</div>
<div class="line">    <span class="keywordtype">int</span> method = stream_transfer[stream_id].method;</div>
<div class="line"> </div>
<div class="line">    sprintf(dummy_config, <span class="stringliteral">&quot;Here should contain H264 config\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (amba_transfer_write(fd_info, &amp;version, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), method) &lt; 0 ||</div>
<div class="line">        amba_transfer_write(fd_info, &amp;size, <span class="keyword">sizeof</span>(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>), method) &lt; 0 ||</div>
<div class="line">        amba_transfer_write(fd_info, &amp;dummy_config, <span class="keyword">sizeof</span>(dummy_config), method) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;write_data(4)&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_frame_info(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">struct </span>video_frame_s {</div>
<div class="line">        <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>     size;</div>
<div class="line">        <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>     pts;</div>
<div class="line">        <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>     pic_type;</div>
<div class="line">        <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>     reserved;</div>
<div class="line">    } video_frame_t;</div>
<div class="line">    video_frame_t frame_info;</div>
<div class="line">    frame_info.pic_type = framedesc-&gt;pic_type;</div>
<div class="line">    frame_info.pts = (<a id="a48" name="a48"></a><a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)framedesc-&gt;dsp_pts;</div>
<div class="line">    frame_info.size = framedesc-&gt;size;</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    <span class="keywordtype">int</span> fd_info = stream_files[stream_id].fd_info;</div>
<div class="line">    <span class="keywordtype">int</span> method = stream_transfer[stream_id].method;</div>
<div class="line"> </div>
<div class="line">    if (amba_transfer_write(fd_info, &amp;frame_info, <span class="keyword">sizeof</span>(frame_info), method) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;write(5)&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> open_statistics_file(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    <span class="keywordtype">int</span> method = stream_transfer[stream_id].method;</div>
<div class="line">    <span class="keywordtype">int</span> port = stream_transfer[stream_id].port;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (encoding_statistics[stream_id].statistics_fd &gt; 0) {</div>
<div class="line">        amba_transfer_close(encoding_statistics[stream_id].statistics_fd, method);</div>
<div class="line">        encoding_statistics[stream_id].statistics_fd = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> ((encoding_statistics[stream_id].statistics_fd =</div>
<div class="line">        amba_transfer_open(encoding_statistics[stream_id].write_file_name,</div>
<div class="line">            method, port + STATISTIC_PORT_OFFSET)) &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;create file for statistics failed %s \n&quot;</span>,</div>
<div class="line">            encoding_statistics[stream_id].write_file_name);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_statistics(bitstream_info_t *framedesc, <span class="keywordtype">char</span> *print_buffer)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    <span class="keywordtype">char</span> desc_type_str[8];</div>
<div class="line">    <span class="keywordtype">char</span> stream_type_str[8];</div>
<div class="line">    <span class="keywordtype">int</span> statistics_fd = encoding_statistics[stream_id].statistics_fd;</div>
<div class="line">    stream_encoding_statistics_t *statistics = &amp;encoding_statistics[stream_id];</div>
<div class="line">    <span class="keywordtype">int</span> method = stream_transfer[stream_id].method;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_msecond = (framedesc-&gt;arm_pts == 0) ?</div>
<div class="line">        (encoding_states[stream_id].monotonic_pts - old_encoding_states[stream_id].monotonic_pts)/90</div>
<div class="line">        : (framedesc-&gt;arm_pts - old_encoding_states[stream_id].monotonic_pts)/90;</div>
<div class="line">    <span class="keywordtype">int</span> print_msecond = (int)total_msecond % 1000;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">int</span> total_second = (long)total_msecond / 1000;</div>
<div class="line">    <span class="keywordtype">int</span> print_hour = (int)total_second /3600;</div>
<div class="line">    <span class="keywordtype">int</span> print_minute = (int)(total_second % 3600) / 60;</div>
<div class="line">    <span class="keywordtype">int</span> print_second = (int)(total_second % 3600) % 60;</div>
<div class="line"> </div>
<div class="line">    get_desc_type_str(framedesc, desc_type_str);</div>
<div class="line">    <span class="keywordflow">switch</span> (framedesc-&gt;stream_type) {</div>
<div class="line">    <span class="keywordflow">case</span> <a id="a49" name="a49"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277">IAV_STREAM_TYPE_H264</a>:</div>
<div class="line">        strcpy(stream_type_str, <span class="stringliteral">&quot;H.264&quot;</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>:</div>
<div class="line">        strcpy(stream_type_str, <span class="stringliteral">&quot;H.265&quot;</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a id="a50" name="a50"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ead2feabb75221806525afe5d4bc053431">IAV_STREAM_TYPE_MJPEG</a>:</div>
<div class="line">        strcpy(stream_type_str, <span class="stringliteral">&quot;MJPEG&quot;</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        strcpy(stream_type_str, <span class="stringliteral">&quot;Unknown&quot;</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    sprintf(print_buffer,</div>
<div class="line">        <span class="stringliteral">&quot;This statistics file is refreshed every %d frames.\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;***************************************\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;                             Stream ID:     stream %c\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;                        Encoding Codec:        %s\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;                    Total Frames Count:     %8llu\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;                            Resolution:    %4ux%4u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;               Total Encoding Duration:  %d:%02d:%02d.%03d\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       Average I/P/B Frame Size (Byte):     %8u, %8u, %8u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;             Average Frame Size (Byte):     %8u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;         I %s Size (Byte)(MAX, MIN):     %8u, %8u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;         P %s Size (Byte)(MAX, MIN):     %8u, %8u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;         B %s Size (Byte)(MAX, MIN):     %8u, %8u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;           %s Size (Byte)(MAX, MIN):     %8u, %8u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;          ARM PTS Diff (MAX, AVG, MIN):     %8llu, %8llu, %8llu\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;          ENC PTS Diff (MAX, AVG, MIN):     %8llu, %8llu, %8llu\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       Audio tick Diff (MAX, AVG, MIN):     %8u, %8u, %8u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;                   FPS (MAX, AVG, MIN):       %6.2f,   %6.2f,   %6.2f\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;         Bitrate (Kbps)(MAX, AVG, MIN):     %8u, %8u, %8u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;     Bitrate GOP (Kbps)     (MAX, MIN):     %8u, %8u\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;      GOP Record      (Old --&gt; Recent): &quot;</span>, write_statistics_interval,</div>
<div class="line">        <span class="charliteral">&#39;A&#39;</span> + framedesc-&gt;stream_id, stream_type_str,</div>
<div class="line">        encoding_states[stream_id].total_frames,</div>
<div class="line">        framedesc-&gt;reso.width, framedesc-&gt;reso.height,</div>
<div class="line">        print_hour, print_minute, print_second, print_msecond,</div>
<div class="line">        statistics-&gt;avg_i_frame, statistics-&gt;avg_p_frame, statistics-&gt;avg_b_frame,</div>
<div class="line">        statistics-&gt;avg_frame_size,</div>
<div class="line">        desc_type_str, statistics-&gt;max_i_frame, statistics-&gt;min_i_frame,</div>
<div class="line">        desc_type_str, statistics-&gt;max_p_frame, statistics-&gt;min_p_frame,</div>
<div class="line">        desc_type_str, statistics-&gt;max_b_frame, statistics-&gt;min_b_frame,</div>
<div class="line">        desc_type_str, statistics-&gt;max_frame_size, statistics-&gt;min_frame_size,</div>
<div class="line">        statistics-&gt;max_arm_pts, statistics-&gt;avg_arm_pts, statistics-&gt;min_arm_pts,</div>
<div class="line">        statistics-&gt;max_enc_done_pts, statistics-&gt;avg_enc_done_pts, statistics-&gt;min_enc_done_pts,</div>
<div class="line">        statistics-&gt;max_hw_pts_diff, statistics-&gt;avg_hw_pts_diff, statistics-&gt;min_hw_pts_diff,</div>
<div class="line">        statistics-&gt;max_fps, statistics-&gt;avg_fps, statistics-&gt;min_fps,</div>
<div class="line">        statistics-&gt;max_bitrate, statistics-&gt;avg_bitrate, statistics-&gt;min_bitrate,</div>
<div class="line">        statistics-&gt;max_bitrate_gop, statistics-&gt;min_bitrate_gop);</div>
<div class="line">    sprintf(print_buffer+strlen(print_buffer), <span class="stringliteral">&quot;%s\n&quot;</span>, statistics-&gt;gop_record);</div>
<div class="line">    <span class="keywordflow">if</span> (method == TRANS_METHOD_NONE) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, print_buffer);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (amba_transfer_write(statistics_fd, print_buffer, strlen(print_buffer), method) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;write_data(4)&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> (-1);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_h26x_info(<span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gaedee632d62ec29c16717d808e9bd406e">iav_stream_type</a> stream_type, <span class="keywordtype">int</span> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html">iav_h26x_cfg</a> h26x;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;h26x, 0, <span class="keyword">sizeof</span>(h26x));</div>
<div class="line">    h26x.id = stream_id;</div>
<div class="line">    <span class="keywordflow">if</span> (stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277">IAV_STREAM_TYPE_H264</a>) {</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a51" name="a51"></a>IAV_IOC_GET_H264_CONFIG, &amp;h26x);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a52" name="a52"></a>IAV_IOC_GET_H265_CONFIG, &amp;h26x);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (h26x.gop_structure &lt; <a id="a53" name="a53"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dae60af67c61f60828c084a2744ed39f09">IAV_GOP_SVCT_2</a> ||</div>
<div class="line">        h26x.gop_structure &gt; <a id="a54" name="a54"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1da749352c49cd3ba3c92e88d03df29e00a">IAV_GOP_FAST_SEEK_2_REF</a>) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Invalid gop structure %d for AVC or HEVC!\n&quot;</span>, h26x.gop_structure);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    stream_files[stream_id].gop_structure = h26x.gop_structure;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (split_fast_seek_flag &amp;&amp; !h26x.fast_seek_intvl) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Invalid fast seek intvl value %d.\n&quot;</span>, h26x.fast_seek_intvl);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    stream_files[stream_id].fast_seek_intvl = h26x.fast_seek_intvl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//check session and update file handle for write when needed</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_session_file_handle(bitstream_info_t *framedesc, <span class="keywordtype">int</span> new_session)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> write_file_name[480];</div>
<div class="line">    <span class="keywordtype">char</span> time_str[128];</div>
<div class="line">    <span class="keywordtype">char</span> file_type[8];</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    <span class="keywordtype">char</span> stream_name;</div>
<div class="line">    <span class="keywordtype">int</span> method = stream_transfer[stream_id].method;</div>
<div class="line">    <span class="keywordtype">int</span> port = stream_transfer[stream_id].port;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gaedee632d62ec29c16717d808e9bd406e">iav_stream_type</a> stream_type = framedesc-&gt;stream_type;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (new_session) {</div>
<div class="line">        sprintf(file_type, <span class="stringliteral">&quot;%s&quot;</span>, (stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ead2feabb75221806525afe5d4bc053431">IAV_STREAM_TYPE_MJPEG</a>) ? <span class="stringliteral">&quot;mjpeg&quot;</span> :</div>
<div class="line">            ((stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277">IAV_STREAM_TYPE_H264</a>) ? <span class="stringliteral">&quot;h264&quot;</span> :</div>
<div class="line">            (((stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>) ? <span class="stringliteral">&quot;h265&quot;</span> : <span class="stringliteral">&quot;unknown&quot;</span>))));</div>
<div class="line">        <span class="comment">//close old session if needed</span></div>
<div class="line">        <span class="keywordflow">if</span> (stream_files[stream_id].fd &gt; 0) {</div>
<div class="line">            amba_transfer_close(stream_files[stream_id].fd, method);</div>
<div class="line">            stream_files[stream_id].fd = -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">//character based stream name</span></div>
<div class="line">        <span class="keywordflow">if</span> (split_svct_layer_flag) {</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; MAX_SVCT_LAYERS; ++i) {</div>
<div class="line">                <span class="keywordflow">if</span> (stream_files[stream_id].fd_svct[i] &gt; 0) {</div>
<div class="line">                    amba_transfer_close(stream_files[stream_id].fd_svct[i], method);</div>
<div class="line">                    stream_files[stream_id].fd_svct[i] = -1;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            stream_files[stream_id].gop_structure = 0;</div>
<div class="line">            stream_files[stream_id].fast_seek_intvl = 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (split_fast_seek_flag) {</div>
<div class="line">            <span class="keywordflow">if</span> (stream_files[stream_id].fd_fast_seek &gt; 0) {</div>
<div class="line">                amba_transfer_close(stream_files[stream_id].fd_fast_seek, method);</div>
<div class="line">                stream_files[stream_id].fd_fast_seek = -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        stream_name = <span class="charliteral">&#39;A&#39;</span> + stream_id;</div>
<div class="line"> </div>
<div class="line">        get_time_string(time_str, <span class="keyword">sizeof</span>(time_str));</div>
<div class="line">        <span class="keywordflow">if</span> (remove_time_string_flag) {</div>
<div class="line">            memset(time_str, 0, <span class="keyword">sizeof</span>(time_str));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>(md5_idr_number &gt; 0) {</div>
<div class="line">            sprintf(write_file_name, <span class="stringliteral">&quot;%s&quot;</span>, stream_transfer[stream_id].filename);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            sprintf(write_file_name, <span class="stringliteral">&quot;%s_%c_%s_%x.%s&quot;</span>,</div>
<div class="line">                stream_transfer[stream_id].filename, stream_name,</div>
<div class="line">                time_str, framedesc-&gt;session_id,</div>
<div class="line">                (stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ead2feabb75221806525afe5d4bc053431">IAV_STREAM_TYPE_MJPEG</a>) ? <span class="stringliteral">&quot;mjpeg&quot;</span> :</div>
<div class="line">                ((stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277">IAV_STREAM_TYPE_H264</a>) ? <span class="stringliteral">&quot;h264&quot;</span> :</div>
<div class="line">                (((stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>) ? <span class="stringliteral">&quot;h265&quot;</span> : <span class="stringliteral">&quot;unknown&quot;</span>))));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ((stream_files[stream_id].fd =</div>
<div class="line">            amba_transfer_open(write_file_name, method, port)) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;create file for write failed %s \n&quot;</span>, write_file_name);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (!nofile_flag) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;\nnew session file name [%s], fd [%d] \n&quot;</span>, write_file_name,</div>
<div class="line">                    stream_files[stream_id].fd);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (split_svct_layer_flag || split_fast_seek_flag) {</div>
<div class="line">            check_h26x_info(stream_type, stream_id);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (split_svct_layer_flag) {</div>
<div class="line">            <span class="keywordflow">if</span> (stream_files[stream_id].<a id="a55" name="a55"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html#a7d5e8cb94d471b621201386d893b5cd8">gop_structure</a> &gt; 1</div>
<div class="line">                &amp;&amp; stream_files[stream_id].<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html#a7d5e8cb94d471b621201386d893b5cd8">gop_structure</a> &lt;= 4) {</div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; stream_files[stream_id].gop_structure; ++i) {</div>
<div class="line">                    sprintf(filename, <span class="stringliteral">&quot;%s.svct_%d.%s&quot;</span>, write_file_name, i,</div>
<div class="line">                        file_type);</div>
<div class="line">                    stream_files[stream_id].fd_svct[i] = amba_transfer_open(</div>
<div class="line">                        filename, method, (port + i + SVCT_PORT_OFFSET));</div>
<div class="line">                    <span class="keywordflow">if</span> (stream_files[stream_id].fd_svct[i] &lt; 0) {</div>
<div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;create file for write SVCT layers failed %s.\n&quot;</span>,</div>
<div class="line">                            filename);</div>
<div class="line">                        <span class="keywordflow">return</span> -1;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (split_fast_seek_flag) {</div>
<div class="line">            <span class="keywordflow">if</span> (stream_files[stream_id].<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html#a7d5e8cb94d471b621201386d893b5cd8">gop_structure</a> &gt; 1</div>
<div class="line">                &amp;&amp; stream_files[stream_id].<a id="a56" name="a56"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html#a97d5655c88679af34a6e53b41d801984">fast_seek_intvl</a> &gt; 0) {</div>
<div class="line">                sprintf(filename, <span class="stringliteral">&quot;%s.fast_seek.%s&quot;</span>, write_file_name, file_type);</div>
<div class="line">                stream_files[stream_id].fd_fast_seek = amba_transfer_open(</div>
<div class="line">                    filename, method, (port + FAST_SEEK_PORT_OFFSET));</div>
<div class="line">                <span class="keywordflow">if</span> (stream_files[stream_id].fd_fast_seek &lt; 0) {</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;create file for write fast seek failed %s.\n&quot;</span>,</div>
<div class="line">                        filename);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (frame_info_flag) {</div>
<div class="line">            sprintf(&amp;write_file_name[strlen(write_file_name)], <span class="stringliteral">&quot;.info&quot;</span>);</div>
<div class="line">            <span class="keywordflow">if</span> ((stream_files[stream_id].fd_info =</div>
<div class="line">                amba_transfer_open(write_file_name, method, port)) &lt; 0) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;create file for frame info  failed %s \n&quot;</span>, write_file_name);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (write_frame_info_header(stream_id) &lt; 0) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;write h264 header info failed %s \n&quot;</span>, write_file_name);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> update_session_data(bitstream_info_t *framedesc, <span class="keywordtype">int</span> new_session,</div>
<div class="line">            <span class="keywordtype">int</span> new_frame, <span class="keywordtype">int</span> last_desc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    <span class="keywordtype">char</span> *gop_record_buffer = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* update pic type, session id on new session */</span></div>
<div class="line">    <span class="keywordflow">if</span> (new_session) {</div>
<div class="line">        encoding_states[stream_id].session_id = framedesc-&gt;session_id;</div>
<div class="line">        encoding_states[stream_id].total_bytes = 0;</div>
<div class="line">        encoding_states[stream_id].total_frames = 0;</div>
<div class="line">        encoding_states[stream_id].total_frames_i = 0;</div>
<div class="line">        encoding_states[stream_id].total_bytes_i = 0;</div>
<div class="line">        encoding_states[stream_id].total_frames_p = 0;</div>
<div class="line">        encoding_states[stream_id].total_bytes_p = 0;</div>
<div class="line">        encoding_states[stream_id].total_frames_b = 0;</div>
<div class="line">        encoding_states[stream_id].total_bytes_b = 0;</div>
<div class="line">        encoding_states[stream_id].i_num = 0;</div>
<div class="line">        encoding_states[stream_id].enc_done_ts_diff_sum = 0;</div>
<div class="line"> </div>
<div class="line">        encoding_states[stream_id].hw_pts = 0;</div>
<div class="line">        encoding_states[stream_id].monotonic_pts = 0;</div>
<div class="line">        encoding_states[stream_id].encoding_start_time = encoding_states[stream_id].capture_start_time;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* for statistics data only */</span></div>
<div class="line">        old_encoding_states[stream_id].total_frames = 0;</div>
<div class="line">        old_encoding_states[stream_id].capture_start_time = encoding_states[stream_id].capture_start_time;</div>
<div class="line">        old_encoding_states[stream_id].total_bytes = 0;</div>
<div class="line">        old_encoding_states[stream_id].total_frames2 = 0;</div>
<div class="line">        old_encoding_states[stream_id].time2 = encoding_states[stream_id].capture_start_time;</div>
<div class="line">        old_encoding_states[stream_id].monotonic_pts = framedesc-&gt;arm_pts;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* for biterate within the scope of gop */</span></div>
<div class="line">        memset(&amp;encoding_states[stream_id].time_gop, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));</div>
<div class="line">        encoding_states[stream_id].total_bytes_gop = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* backup allocated memory pointer and reset statistic values */</span></div>
<div class="line">        gop_record_buffer = encoding_statistics[stream_id].gop_record;</div>
<div class="line">        memset(&amp;encoding_statistics[stream_id], 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> stream_encoding_statistics_s));</div>
<div class="line">        encoding_statistics[stream_id].min_hw_pts_diff = ~0;</div>
<div class="line">        encoding_statistics[stream_id].gop_record = gop_record_buffer;</div>
<div class="line">        gop_record_buffer = NULL;</div>
<div class="line">        memset(encoding_statistics[stream_id].gop_record, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*PRINT_CHARACTER_AMOUNT);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* update statistics on all frame */</span></div>
<div class="line">    encoding_states[stream_id].pic_type = framedesc-&gt;pic_type;</div>
<div class="line">    encoding_states[stream_id].total_bytes += framedesc-&gt;size;</div>
<div class="line">    <span class="keywordflow">if</span> (last_desc) {</div>
<div class="line">        encoding_states[stream_id].enc_done_ts_diff_sum += framedesc-&gt;enc_done_ts - framedesc-&gt;arm_pts;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (new_frame) {</div>
<div class="line">        encoding_states[stream_id].total_frames++;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* update i p b frame count */</span></div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;pic_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a7d85c038f6df51d23fc7f9397400b54f">IAV_PIC_TYPE_IDR_FRAME</a> || framedesc-&gt;pic_type == <a id="a57" name="a57"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1af4f413b58ae4c91d50856a73fd7c4de2">IAV_PIC_TYPE_I_FRAME</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (new_frame)</div>
<div class="line">            encoding_states[stream_id].total_frames_i ++;</div>
<div class="line">        encoding_states[stream_id].total_bytes_i += framedesc-&gt;size;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;pic_type == <a id="a58" name="a58"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a2e89e1419404c1abcbe5af45c6bd28a5">IAV_PIC_TYPE_P_FRAME</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (new_frame)</div>
<div class="line">            encoding_states[stream_id].total_frames_p ++;</div>
<div class="line">        encoding_states[stream_id].total_bytes_p += framedesc-&gt;size;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;pic_type == <a id="a59" name="a59"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a74797e81bd4c546577ca0f3588e5c865">IAV_PIC_TYPE_B_FRAME</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (new_frame)</div>
<div class="line">            encoding_states[stream_id].total_frames_b ++;</div>
<div class="line">        encoding_states[stream_id].total_bytes_b += framedesc-&gt;size;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> update_files_data(bitstream_info_t *framedesc, <span class="keywordtype">int</span> new_session)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (new_session) {</div>
<div class="line">        stream_files[stream_id].session_id = framedesc-&gt;session_id;</div>
<div class="line">        stream_files[stream_id].total_bytes = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    stream_files[stream_id].total_bytes += framedesc-&gt;size;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> statistics_gop(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    stream_encoding_state_t *state = &amp;encoding_states[stream_id];</div>
<div class="line">    stream_encoding_statistics_t *statistics = &amp;encoding_statistics[stream_id];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;pic_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a7d85c038f6df51d23fc7f9397400b54f">IAV_PIC_TYPE_IDR_FRAME</a> ||</div>
<div class="line">        framedesc-&gt;pic_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1af4f413b58ae4c91d50856a73fd7c4de2">IAV_PIC_TYPE_I_FRAME</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (state-&gt;i_num != 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (statistics-&gt;gop != (state-&gt;total_frames - state-&gt;i_num)) {</div>
<div class="line">                statistics-&gt;gop = state-&gt;total_frames - state-&gt;i_num;</div>
<div class="line">                <span class="keywordflow">if</span> (strlen(statistics-&gt;gop_record) &gt; (<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(PRINT_CHARACTER_AMOUNT - 5))) {</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Gop_record doesn&#39;t have enough space for new gop record!\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">                sprintf(&amp;statistics-&gt;gop_record[strlen(statistics-&gt;gop_record)],</div>
<div class="line">                    <span class="stringliteral">&quot;%4u &quot;</span>, statistics-&gt;gop);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        state-&gt;i_num = state-&gt;total_frames;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> statistics_ipb_frame_size(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    stream_encoding_statistics_t *statistics = &amp;encoding_statistics[stream_id];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;pic_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a7d85c038f6df51d23fc7f9397400b54f">IAV_PIC_TYPE_IDR_FRAME</a> ||</div>
<div class="line">        framedesc-&gt;pic_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1af4f413b58ae4c91d50856a73fd7c4de2">IAV_PIC_TYPE_I_FRAME</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (statistics-&gt;max_i_frame == 0 || statistics-&gt;min_i_frame == 0) {</div>
<div class="line">            statistics-&gt;max_i_frame = framedesc-&gt;size;</div>
<div class="line">            statistics-&gt;min_i_frame = framedesc-&gt;size;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (framedesc-&gt;size &gt; statistics-&gt;max_i_frame) {</div>
<div class="line">            statistics-&gt;max_i_frame = framedesc-&gt;size;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (framedesc-&gt;size &lt; statistics-&gt;min_i_frame) {</div>
<div class="line">            statistics-&gt;min_i_frame = framedesc-&gt;size;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;pic_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a2e89e1419404c1abcbe5af45c6bd28a5">IAV_PIC_TYPE_P_FRAME</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (statistics-&gt;max_p_frame == 0 || statistics-&gt;min_p_frame == 0) {</div>
<div class="line">            statistics-&gt;max_p_frame = framedesc-&gt;size;</div>
<div class="line">            statistics-&gt;min_p_frame = framedesc-&gt;size;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (framedesc-&gt;size &gt; statistics-&gt;max_p_frame) {</div>
<div class="line">            statistics-&gt;max_p_frame = framedesc-&gt;size;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (framedesc-&gt;size &lt; statistics-&gt;min_p_frame) {</div>
<div class="line">            statistics-&gt;min_p_frame = framedesc-&gt;size;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;pic_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a74797e81bd4c546577ca0f3588e5c865">IAV_PIC_TYPE_B_FRAME</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (statistics-&gt;max_b_frame == 0 || statistics-&gt;min_b_frame == 0) {</div>
<div class="line">            statistics-&gt;max_b_frame = framedesc-&gt;size;</div>
<div class="line">            statistics-&gt;min_b_frame = framedesc-&gt;size;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (framedesc-&gt;size &gt; statistics-&gt;max_b_frame) {</div>
<div class="line">            statistics-&gt;max_b_frame = framedesc-&gt;size;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (framedesc-&gt;size &lt; statistics-&gt;min_b_frame) {</div>
<div class="line">            statistics-&gt;min_b_frame = framedesc-&gt;size;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> statistics_pts(bitstream_info_t *framedesc, <span class="keywordtype">int</span> new_frame, <span class="keywordtype">int</span> last_desc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    stream_encoding_state_t *state = &amp;encoding_states[stream_id];</div>
<div class="line">    stream_encoding_statistics_t *statistics = &amp;encoding_statistics[stream_id];</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> enc_done_pts_diff;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> hw_pts, hw_pts_last, hw_pts_diff;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (new_frame) {</div>
<div class="line">        <span class="keywordflow">if</span> (state-&gt;monotonic_pts != 0) {</div>
<div class="line">            <span class="keywordflow">if</span> ((framedesc-&gt;arm_pts - state-&gt;monotonic_pts) &gt; statistics-&gt;max_arm_pts)</div>
<div class="line">                statistics-&gt;max_arm_pts = framedesc-&gt;arm_pts - state-&gt;monotonic_pts;</div>
<div class="line">            <span class="keywordflow">if</span> ((framedesc-&gt;arm_pts - state-&gt;monotonic_pts) &lt; statistics-&gt;min_arm_pts)</div>
<div class="line">                statistics-&gt;min_arm_pts = framedesc-&gt;arm_pts - state-&gt;monotonic_pts;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            statistics-&gt;max_arm_pts = 0;</div>
<div class="line">            statistics-&gt;min_arm_pts = framedesc-&gt;arm_pts - state-&gt;monotonic_pts;</div>
<div class="line">        }</div>
<div class="line">        hw_pts = framedesc-&gt;dsp_pts &gt;&gt; 32;</div>
<div class="line">        hw_pts_last = state-&gt;hw_pts;</div>
<div class="line">        <span class="keywordflow">if</span> (hw_pts_last &gt; hw_pts) {</div>
<div class="line">            hw_pts += (<a id="a60" name="a60"></a><a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#gad758b7a5c3f18ed79d2fcd23d9f16357">u64</a>)1 &lt;&lt; 32;</div>
<div class="line">        }</div>
<div class="line">        state-&gt;hw_pts = hw_pts;</div>
<div class="line">        <span class="keywordflow">if</span> (hw_pts_last != 0) {</div>
<div class="line">            hw_pts_diff = hw_pts - hw_pts_last;</div>
<div class="line">            <span class="keywordflow">if</span> (hw_pts_diff &gt; statistics-&gt;max_hw_pts_diff) {</div>
<div class="line">                statistics-&gt;max_hw_pts_diff = hw_pts_diff;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (hw_pts_diff &lt; statistics-&gt;min_hw_pts_diff) {</div>
<div class="line">                statistics-&gt;min_hw_pts_diff = hw_pts_diff;</div>
<div class="line">            }</div>
<div class="line">            statistics-&gt;hw_pts_diff_sum += hw_pts_diff;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    state-&gt;monotonic_pts = framedesc-&gt;arm_pts;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (last_desc) {</div>
<div class="line">        enc_done_pts_diff = framedesc-&gt;enc_done_ts - framedesc-&gt;arm_pts;</div>
<div class="line">        <span class="keywordflow">if</span> (statistics-&gt;max_enc_done_pts == 0 || statistics-&gt;min_enc_done_pts == 0) {</div>
<div class="line">            statistics-&gt;max_enc_done_pts = enc_done_pts_diff;</div>
<div class="line">            statistics-&gt;min_enc_done_pts = enc_done_pts_diff;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (enc_done_pts_diff &gt; statistics-&gt;max_enc_done_pts) {</div>
<div class="line">            statistics-&gt;max_enc_done_pts = enc_done_pts_diff;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (enc_done_pts_diff &lt; statistics-&gt;min_enc_done_pts) {</div>
<div class="line">            statistics-&gt;min_enc_done_pts = enc_done_pts_diff;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> statistics_fps_bitrate(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    <span class="keywordtype">int</span> curr_frames, pre_frames, pre_frames2;</div>
<div class="line">    <span class="keyword">struct </span>timeval curr_time, pre_time, pre_time2;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> time_interval_us, time_interval_us2;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> time_inter_i_frame;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> pre_bytes, curr_bytes;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> bitrate = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> avg_audio_clock;</div>
<div class="line">    <span class="keywordtype">double</span> fps_average;</div>
<div class="line">    stream_encoding_state_t *state = &amp;encoding_states[stream_id];</div>
<div class="line">    stream_encoding_statistics_t *statistics = &amp;encoding_statistics[stream_id];</div>
<div class="line">    <span class="keywordtype">char</span> print_str[128] = {0};</div>
<div class="line"> </div>
<div class="line">    pre_frames2 = old_encoding_states[stream_id].total_frames2;</div>
<div class="line">    pre_time2 = old_encoding_states[stream_id].time2;</div>
<div class="line">    pre_time = old_encoding_states[stream_id].capture_start_time;</div>
<div class="line">    curr_time = encoding_states[stream_id].capture_start_time;</div>
<div class="line">    curr_frames = encoding_states[stream_id].total_frames;</div>
<div class="line">    pre_frames = old_encoding_states[stream_id].total_frames;</div>
<div class="line">    pre_bytes = old_encoding_states[stream_id].total_bytes;</div>
<div class="line">    curr_bytes = encoding_states[stream_id].total_bytes;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((curr_frames) &amp;&amp; (curr_frames % print_interval == 0)) {</div>
<div class="line">        time_interval_us = (curr_time.tv_sec - pre_time.tv_sec) * 1000000ull +</div>
<div class="line">                        curr_time.tv_usec - pre_time.tv_usec;</div>
<div class="line">        statistics-&gt;rt_fps = (curr_frames - pre_frames)* 1000000.0/(double)time_interval_us;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (statistics-&gt;max_fps == 0 || statistics-&gt;min_fps  == 0) {</div>
<div class="line">            statistics-&gt;max_fps = statistics-&gt;rt_fps;</div>
<div class="line">            statistics-&gt;min_fps = statistics-&gt;rt_fps;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (statistics-&gt;rt_fps &gt; statistics-&gt;max_fps) {</div>
<div class="line">            statistics-&gt;max_fps = statistics-&gt;rt_fps;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (statistics-&gt;rt_fps &lt; statistics-&gt;min_fps) {</div>
<div class="line">            statistics-&gt;min_fps = statistics-&gt;rt_fps;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        statistics-&gt;rt_bitrate= (int)((curr_bytes - pre_bytes) * 8000000LL /time_interval_us /1024);</div>
<div class="line">        <span class="keywordflow">if</span> (statistics-&gt;max_bitrate == 0 || statistics-&gt;min_bitrate == 0) {</div>
<div class="line">            statistics-&gt;max_bitrate = statistics-&gt;rt_bitrate;</div>
<div class="line">            statistics-&gt;min_bitrate = statistics-&gt;rt_bitrate;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (statistics-&gt;rt_bitrate &gt; statistics-&gt;max_bitrate) {</div>
<div class="line">            statistics-&gt;max_bitrate = statistics-&gt;rt_bitrate;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (statistics-&gt;rt_bitrate &lt; statistics-&gt;min_bitrate) {</div>
<div class="line">            statistics-&gt;min_bitrate = statistics-&gt;rt_bitrate;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        old_encoding_states[stream_id].total_frames = state-&gt;total_frames;</div>
<div class="line">        old_encoding_states[stream_id].total_bytes = state-&gt;total_bytes;</div>
<div class="line">        old_encoding_states[stream_id].capture_start_time = state-&gt;capture_start_time;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (framedesc-&gt;pic_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a7d85c038f6df51d23fc7f9397400b54f">IAV_PIC_TYPE_IDR_FRAME</a> || framedesc-&gt;pic_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1af4f413b58ae4c91d50856a73fd7c4de2">IAV_PIC_TYPE_I_FRAME</a>) {</div>
<div class="line">        time_inter_i_frame = (state-&gt;capture_start_time.tv_sec - state-&gt;time_gop.tv_sec) * 1000000ull +</div>
<div class="line">                        state-&gt;capture_start_time.tv_usec - state-&gt;time_gop.tv_usec;</div>
<div class="line">        bitrate = state-&gt;capture_start_time.tv_sec ?</div>
<div class="line">            (<span class="keywordtype">int</span>)((state-&gt;total_bytes - state-&gt;total_bytes_gop) * 8000000LL / time_inter_i_frame/1024) : 0;</div>
<div class="line">        state-&gt;time_gop = state-&gt;capture_start_time;</div>
<div class="line">        state-&gt;total_bytes_gop = state-&gt;total_bytes;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (state-&gt;total_frames_i &gt; 1) {</div>
<div class="line">            <span class="keywordflow">if</span> (statistics-&gt;max_bitrate_gop == 0 || statistics-&gt;min_bitrate_gop  == 0) {</div>
<div class="line">                statistics-&gt;max_bitrate_gop = bitrate;</div>
<div class="line">                statistics-&gt;min_bitrate_gop = bitrate;</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bitrate &gt; statistics-&gt;max_bitrate_gop) {</div>
<div class="line">                statistics-&gt;max_bitrate_gop = bitrate;</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bitrate &lt; statistics-&gt;min_bitrate_gop) {</div>
<div class="line">                statistics-&gt;min_bitrate_gop = bitrate;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((curr_frames) &amp;&amp; (curr_frames % fps_statistics_interval == 0)) {</div>
<div class="line">        time_interval_us2 = (curr_time.tv_sec - pre_time2.tv_sec) * 1000000ull +</div>
<div class="line">            curr_time.tv_usec - pre_time2.tv_usec;</div>
<div class="line">        fps_average = (curr_frames - pre_frames2)* 1000000.0/(double)time_interval_us2;</div>
<div class="line">        <span class="keywordflow">if</span> (show_audio_clock_flag) {</div>
<div class="line">            avg_audio_clock = (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)(((encoding_statistics[stream_id].hw_pts_diff_sum -</div>
<div class="line">                encoding_statistics[stream_id].hw_pts_diff_sum_2) * 1000000.0) /</div>
<div class="line">                (<span class="keywordtype">double</span>)time_interval_us2);</div>
<div class="line">            sprintf(print_str, <span class="stringliteral">&quot;AVG FPS = %4.2f fps    Audio Clock = %u Hz   Audio Clock&#39;s drift: %d\n&quot;</span>,</div>
<div class="line">                fps_average, avg_audio_clock, avg_audio_clock - audio_clock);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            sprintf(print_str, <span class="stringliteral">&quot;AVG FPS = %4.2f fps\n&quot;</span>, fps_average);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a id="a61" name="a61"></a><a class="code hl_defineRef" target="_blank" href="../../../video/de/dd5/test__custom__sei_8h.html#a577d677ba3cecde91a6aa7b3f563ed13">BOLD_PRINT</a>(<span class="stringliteral">&quot;%s&quot;</span>, print_str);</div>
<div class="line">        old_encoding_states[stream_id].total_frames2 = state-&gt;total_frames;</div>
<div class="line">        old_encoding_states[stream_id].time2 = state-&gt;capture_start_time;</div>
<div class="line">        encoding_statistics[stream_id].hw_pts_diff_sum_2 =</div>
<div class="line">            encoding_statistics[stream_id].hw_pts_diff_sum;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> statistics_frame_size(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    stream_encoding_statistics_t *statistics = &amp;encoding_statistics[stream_id];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (statistics-&gt;max_frame_size == 0 || statistics-&gt;min_frame_size  == 0) {</div>
<div class="line">        statistics-&gt;max_frame_size = framedesc-&gt;size;</div>
<div class="line">        statistics-&gt;min_frame_size = framedesc-&gt;size;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (framedesc-&gt;size &gt; statistics-&gt;max_frame_size) {</div>
<div class="line">        statistics-&gt;max_frame_size = framedesc-&gt;size;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (framedesc-&gt;size &lt; statistics-&gt;min_frame_size) {</div>
<div class="line">        statistics-&gt;min_frame_size = framedesc-&gt;size;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> statistics_average(bitstream_info_t *framedesc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id = framedesc-&gt;stream_id;</div>
<div class="line">    <span class="keyword">struct </span>timeval curr_time, start_time;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> time_interval_us;</div>
<div class="line">    stream_encoding_state_t *state = &amp;encoding_states[stream_id];</div>
<div class="line">    stream_encoding_statistics_t *statistics = &amp;encoding_statistics[stream_id];</div>
<div class="line"> </div>
<div class="line">    curr_time = state-&gt;capture_start_time;</div>
<div class="line">    start_time = state-&gt;encoding_start_time;</div>
<div class="line"> </div>
<div class="line">    time_interval_us = (curr_time.tv_sec - start_time.tv_sec) * 1000000ull + curr_time.tv_usec - start_time.tv_usec;</div>
<div class="line">    <span class="comment">//avrage i p b frame size</span></div>
<div class="line">    if (state-&gt;total_bytes_i &amp;&amp; state-&gt;total_frames_i)</div>
<div class="line">        statistics-&gt;avg_i_frame =</div>
<div class="line">            (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)(state-&gt;total_bytes_i/state-&gt;total_frames_i);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        statistics-&gt;avg_i_frame = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (state-&gt;total_bytes_p &amp;&amp; state-&gt;total_frames_p)</div>
<div class="line">        statistics-&gt;avg_p_frame =</div>
<div class="line">            (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)(state-&gt;total_bytes_p/state-&gt;total_frames_p);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        statistics-&gt;avg_p_frame = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (state-&gt;total_bytes_b &amp;&amp; state-&gt;total_frames_b)</div>
<div class="line">        statistics-&gt;avg_b_frame =</div>
<div class="line">            (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)(state-&gt;total_bytes_b/state-&gt;total_frames_b);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        statistics-&gt;avg_b_frame = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//average pts diff</span></div>
<div class="line">    statistics-&gt;avg_arm_pts =</div>
<div class="line">        (state-&gt;monotonic_pts - old_encoding_states[stream_id].monotonic_pts)/</div>
<div class="line">        (state-&gt;total_frames - 1);</div>
<div class="line"> </div>
<div class="line">    statistics-&gt;avg_enc_done_pts =</div>
<div class="line">        state-&gt;enc_done_ts_diff_sum/state-&gt;total_frames;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//average fps</span></div>
<div class="line">    statistics-&gt;avg_fps = ((state-&gt;total_frames - 1) * 1000000.0)/(double)time_interval_us;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//average bitrate</span></div>
<div class="line">    statistics-&gt;avg_bitrate = (int)(state-&gt;total_bytes * 8000000LL /time_interval_us /1024);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//average frame size</span></div>
<div class="line">    statistics-&gt;avg_frame_size = (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)(state-&gt;total_bytes/state-&gt;total_frames);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//average audio clock</span></div>
<div class="line">    statistics-&gt;avg_hw_pts_diff = (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)(statistics-&gt;hw_pts_diff_sum / (state-&gt;total_frames - 1));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a id="a62" name="a62"></a>channel_to_vsrc(<span class="keywordtype">int</span> fd_iav, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> channel_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a63" name="_a63"></a><a class="code hl_structRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> chan_cfg;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a id="a64" name="a64"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a>;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;chan_cfg, 0, <span class="keyword">sizeof</span>(chan_cfg));</div>
<div class="line">    chan_cfg.chan_id = channel_id;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a65" name="a65"></a>IAV_IOC_GET_CHAN_CONFIG, &amp;chan_cfg) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_GET_CHAN_CONFIG\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a> = chan_cfg.vsrc_id;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_pipe(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf, pipe_type_t pipe_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> write_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> <a id="a66" name="a66"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;</div>
<div class="line">    <span class="keywordtype">int</span> write_ret = 0;</div>
<div class="line">    <span class="keywordtype">int</span> *pipe = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (pipe_type) {</div>
<div class="line">    <span class="keywordflow">case</span> STATISTICS_PIPE:</div>
<div class="line">        pipe = &amp;statistics_pipefd[1];</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> DRAM_TEST_PIPE:</div>
<div class="line">        pipe = &amp;dram_test_pipefd[1];</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Doesn&#39;t support this pipe!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        write_ret = write(*pipe, buf + write_size,</div>
<div class="line">            <span class="keyword">sizeof</span>(pipe_mesg_t) - write_size);</div>
<div class="line">        <span class="keywordflow">if</span> (write_ret &gt; 0) {</div>
<div class="line">            write_size += write_ret;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (write_ret &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;write pipe&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> ((write_size &lt; <span class="keyword">sizeof</span>(pipe_mesg_t)) &amp;&amp; (++count &lt; 5));</div>
<div class="line">    <span class="keywordflow">if</span> (write_size != <span class="keyword">sizeof</span>(pipe_mesg_t)) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;expected message size: %zu, writen message size: %d\n&quot;</span>,</div>
<div class="line">              <span class="keyword">sizeof</span>(pipe_mesg_t), write_size);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> read_pipe(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf, fd_set *set, pipe_type_t pipe_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> read_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;</div>
<div class="line">    <span class="keywordtype">int</span> read_ret = 0;</div>
<div class="line">    <span class="keywordtype">int</span> *pipe = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (pipe_type) {</div>
<div class="line">    <span class="keywordflow">case</span> STATISTICS_PIPE:</div>
<div class="line">        pipe = &amp;statistics_pipefd[0];</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> DRAM_TEST_PIPE:</div>
<div class="line">        pipe = &amp;dram_test_pipefd[0];</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Doesn&#39;t support this pipe!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (select(*pipe + 1, set, NULL, NULL, NULL) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;Dram_test select&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (FD_ISSET(*pipe, set)) {</div>
<div class="line">            <span class="keywordflow">do</span> {</div>
<div class="line">                read_ret = read(*pipe, buf + read_size,</div>
<div class="line">                    <span class="keyword">sizeof</span>(pipe_mesg_t) - read_size);</div>
<div class="line">                <span class="keywordflow">if</span> (read_ret &gt; 0) {</div>
<div class="line">                    read_size += read_ret;</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (read_ret &lt; 0) {</div>
<div class="line">                    perror(<span class="stringliteral">&quot;read pipe&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">while</span> ((read_size &lt; <span class="keyword">sizeof</span>(pipe_mesg_t)) &amp;&amp; (++count &lt; 5));</div>
<div class="line">            <span class="keywordflow">if</span> (read_size != <span class="keyword">sizeof</span>(pipe_mesg_t)) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Failed to read message from main loop:\n&quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;expected message size: %zu, received message size: %d\n&quot;</span>,</div>
<div class="line">                      <span class="keyword">sizeof</span>(pipe_mesg_t), read_size);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>* do_statistics(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> time_interval_us;</div>
<div class="line">    <span class="keywordtype">int</span> stream_id;</div>
<div class="line">    <span class="keyword">struct </span>timeval pre_time, curr_time;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> curr_frames;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> curr_bytes;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> curr_vin_fps;</div>
<div class="line">    <span class="keywordtype">char</span> stream_name[128];</div>
<div class="line">    pipe_mesg_t pipe_mesg;</div>
<div class="line">    bitstream_info_t *framedesc;</div>
<div class="line">    <span class="keywordtype">int</span> new_session, new_frame, last_desc;</div>
<div class="line">    <span class="keywordtype">char</span> *print_buffer;</div>
<div class="line">    <span class="keywordtype">char</span> stream_num;</div>
<div class="line">    <span class="keywordtype">char</span> time_str[128];</div>
<div class="line">    fd_set all_set;</div>
<div class="line">    fd_set set;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>*)&amp;pipe_mesg;</div>
<div class="line"> </div>
<div class="line">    FD_ZERO(&amp;all_set);</div>
<div class="line">    FD_SET(statistics_pipefd[0], &amp;all_set);</div>
<div class="line"> </div>
<div class="line">    print_buffer = (<span class="keywordtype">char</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*<a class="code hl_defineRef" target="_blank" href="../../../video/d9/d9a/test__stream_8h.html#a8342bfd015dff2d669da85b8ae96e6ac">PRINT_CHARACTER_AMOUNT</a>*2);</div>
<div class="line">    <span class="keywordflow">if</span> (NULL == print_buffer) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Malloc print buffer failed!\n&quot;</span>);</div>
<div class="line">        statistics_run = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (print_buffer) {</div>
<div class="line">        memset(print_buffer, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*PRINT_CHARACTER_AMOUNT*2);</div>
<div class="line">    }</div>
<div class="line">    audio_clock = get_audio_clock();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (statistics_run) {</div>
<div class="line">        set = all_set;</div>
<div class="line">        <span class="keywordflow">if</span> (read_pipe(buf, &amp;set, STATISTICS_PIPE) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (pipe_mesg.stop) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Received stop message, stop statistics!\n&quot;</span>);</div>
<div class="line">            statistics_run = 0;</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        framedesc = &amp;pipe_mesg.framedesc;</div>
<div class="line">        new_session = pipe_mesg.new_session;</div>
<div class="line">        new_frame = pipe_mesg.new_frame;</div>
<div class="line">        last_desc = pipe_mesg.last_desc;</div>
<div class="line">        stream_id = framedesc-&gt;stream_id;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (verbose_mode) {</div>
<div class="line">            <span class="keywordflow">if</span> (framedesc-&gt;capture_slice) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;[Slice]: %d/%d, &quot;</span>, framedesc-&gt;slice_id, framedesc-&gt;slice_num);</div>
<div class="line">            }</div>
<div class="line">            printf(<span class="stringliteral">&quot;type=%d, is_skipped %d, size=%d, addr=0x%lu, strm_id=%d, sesn_id=%u, &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;frame_num=%llu, encoded_frame_num=%u,  monotonic_pts=%llu, mono_diff=%llu,&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot; enc_done_pts = %llu, enc_pipe_time = %llu, reso=%dx%d, &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;slice_header_offset = %u\n&quot;</span>, framedesc-&gt;pic_type, framedesc-&gt;force_frame_skip,</div>
<div class="line">                framedesc-&gt;size, framedesc-&gt;data_addr_offset, stream_id, framedesc-&gt;session_id,</div>
<div class="line">                framedesc-&gt;frame_num, framedesc-&gt;encoded_frame_num, framedesc-&gt;arm_pts,</div>
<div class="line">                framedesc-&gt;arm_pts - encoding_states[stream_id].monotonic_pts,</div>
<div class="line">                framedesc-&gt;enc_done_ts, framedesc-&gt;enc_done_ts - framedesc-&gt;arm_pts,</div>
<div class="line">                framedesc-&gt;reso.width, framedesc-&gt;reso.height,</div>
<div class="line">                framedesc-&gt;sliceheader_offset);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (framedesc-&gt;stream_end) {</div>
<div class="line">            statistics_average(framedesc);</div>
<div class="line">            <span class="keywordflow">if</span> (statistics_mode) {</div>
<div class="line">                <span class="keywordflow">if</span> (encoding_statistics[stream_id].statistics_fd &lt; 0) {</div>
<div class="line">                    <span class="keywordflow">if</span> (open_statistics_file(framedesc) &lt; 0) {</div>
<div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;Open statistics file %s failed.\n&quot;</span>,</div>
<div class="line">                            encoding_statistics[stream_id].write_file_name);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (write_statistics(framedesc, print_buffer) &lt; 0) {</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;write statistics file %s failed.\n&quot;</span>,</div>
<div class="line">                        encoding_statistics[stream_id].write_file_name);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                amba_transfer_close(encoding_statistics[stream_id].statistics_fd,</div>
<div class="line">                                    stream_transfer[stream_id].method);</div>
<div class="line">                encoding_statistics[stream_id].statistics_fd = -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (new_frame) {</div>
<div class="line">            gettimeofday(&amp;encoding_states[stream_id].capture_start_time, NULL);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (update_session_data(framedesc, new_session, new_frame, last_desc) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;update sessiondata failed \n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        pre_time = old_encoding_states[stream_id].capture_start_time;</div>
<div class="line">        curr_time = encoding_states[stream_id].capture_start_time;</div>
<div class="line">        curr_frames = encoding_states[stream_id].total_frames;</div>
<div class="line">        curr_bytes = encoding_states[stream_id].total_bytes;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (show_pts_flag) {</div>
<div class="line">            <span class="keyword">struct </span><a id="_a67" name="_a67"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d5f/structvindev__fps.html">vindev_fps</a> vsrc_fps = {0};</div>
<div class="line">            <span class="comment">// FIXME: only channel 0 is considered here.</span></div>
<div class="line">            vsrc_fps.<a id="a68" name="a68"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d5f/structvindev__fps.html#aa1ecb62f419c3b454f5a2d4fd18d4818">vsrc_id</a> = channel_to_vsrc(fd_iav, 0);</div>
<div class="line">            <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a69" name="a69"></a>IAV_IOC_VIN_GET_FPS, &amp;vsrc_fps) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_VIN_GET_FPS\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            curr_vin_fps = vsrc_fps.<a id="a70" name="a70"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d5f/structvindev__fps.html#a0256d25b86a9f6d108e63e630fd20cf2">fps</a>;</div>
<div class="line">            time_interval_us = (curr_time.tv_sec - pre_time.tv_sec) * 1000000ull +</div>
<div class="line">                curr_time.tv_usec - pre_time.tv_usec;</div>
<div class="line">            sprintf(stream_name, <span class="stringliteral">&quot;stream %c&quot;</span>, <span class="charliteral">&#39;A&#39;</span> + stream_id);</div>
<div class="line">            printf(<span class="stringliteral">&quot;%s: [%d]\tVIN: [%d], PTS: %llu, frames NO: %llu, size: %d\n&quot;</span>,</div>
<div class="line">                stream_name, time_interval_us, curr_vin_fps,</div>
<div class="line">                framedesc-&gt;dsp_pts, curr_frames, framedesc-&gt;size);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (new_frame) {</div>
<div class="line">            <span class="keywordflow">if</span> (statistics_gop(framedesc) &lt; 0) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Do statistics_gop failed!\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        statistics_ipb_frame_size(framedesc);</div>
<div class="line"> </div>
<div class="line">        statistics_pts(framedesc, new_frame, last_desc);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (new_frame) {</div>
<div class="line">            statistics_fps_bitrate(framedesc);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        statistics_frame_size(framedesc);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (last_desc &amp;&amp; (curr_frames) &amp;&amp; (curr_frames % write_statistics_interval == 0)) {</div>
<div class="line">            statistics_average(framedesc);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//print statistics</span></div>
<div class="line">        <span class="keywordflow">if</span> (statistics_mode) {</div>
<div class="line">            <span class="keywordflow">if</span> (new_session) {</div>
<div class="line">                stream_num = <span class="charliteral">&#39;A&#39;</span> + stream_id;</div>
<div class="line">                get_time_string(time_str, <span class="keyword">sizeof</span>(time_str));</div>
<div class="line">                sprintf(encoding_statistics[stream_id].write_file_name,</div>
<div class="line">                    <span class="stringliteral">&quot;%s_%c_%s_%x.stat&quot;</span>, stream_transfer[stream_id].filename,</div>
<div class="line">                    stream_num, time_str, framedesc-&gt;session_id);</div>
<div class="line">                <span class="comment">//open statistcs file</span></div>
<div class="line">                <span class="keywordflow">if</span> (open_statistics_file(framedesc) &lt; 0) {</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Open statistics file %s failed.\n&quot;</span>,</div>
<div class="line">                        encoding_statistics[stream_id].write_file_name);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">//write file</span></div>
<div class="line">            <span class="keywordflow">if</span> ((last_desc) &amp;&amp; (curr_frames) &amp;&amp; (curr_frames % write_statistics_interval == 0)) {</div>
<div class="line">                <span class="keywordflow">if</span> (encoding_statistics[stream_id].statistics_fd &lt; 0) {</div>
<div class="line">                    <span class="keywordflow">if</span> (open_statistics_file(framedesc) &lt; 0) {</div>
<div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;Open statistics file %s failed.\n&quot;</span>,</div>
<div class="line">                            encoding_statistics[stream_id].write_file_name);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (write_statistics(framedesc, print_buffer) &lt; 0) {</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;write statistics file %s failed.\n&quot;</span>,</div>
<div class="line">                        encoding_statistics[stream_id].write_file_name);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                amba_transfer_close(encoding_statistics[stream_id].statistics_fd,</div>
<div class="line">                                    stream_transfer[stream_id].method);</div>
<div class="line">                encoding_statistics[stream_id].statistics_fd = -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((last_desc) &amp;&amp; (curr_frames) &amp;&amp; (curr_frames % print_interval == 0)) {</div>
<div class="line">            sprintf(stream_name, <span class="stringliteral">&quot;stream %c&quot;</span>,  <span class="charliteral">&#39;A&#39;</span>+ stream_id);</div>
<div class="line">            printf(<span class="stringliteral">&quot;%s:\t%llu %s, %4.2f fps, %18llu\tbytes, %5d kbps, enc_pipe_time [%5llu:%5llu]\n&quot;</span>,</div>
<div class="line">                stream_name, curr_frames, nofile_flag ? <span class="stringliteral">&quot;discard&quot;</span> : <span class="stringliteral">&quot;frames&quot;</span>,</div>
<div class="line">                encoding_statistics[stream_id].rt_fps, curr_bytes,</div>
<div class="line">                encoding_statistics[stream_id].rt_bitrate,</div>
<div class="line">                encoding_statistics[stream_id].min_enc_done_pts,</div>
<div class="line">                encoding_statistics[stream_id].max_enc_done_pts);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (statistics_run) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Do statistics exited abnormally!\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (statistics_pipefd[0] &gt;= 0) {</div>
<div class="line">        close(statistics_pipefd[0]);</div>
<div class="line">        statistics_pipefd[0] = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (print_buffer) {</div>
<div class="line">        free(print_buffer);</div>
<div class="line">        print_buffer = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span>(i = 0; i &lt; MAX_ENCODE_STREAM_NUM; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (encoding_statistics[i].gop_record) {</div>
<div class="line">            free(encoding_statistics[i].gop_record);</div>
<div class="line">            encoding_statistics[i].gop_record = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (encoding_statistics[i].statistics_fd) {</div>
<div class="line">            amba_transfer_close(encoding_statistics[i].statistics_fd,</div>
<div class="line">                                stream_transfer[i].method);</div>
<div class="line">            encoding_statistics[i].statistics_fd = -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ((<span class="keywordtype">void</span> *)0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_svct_file(<span class="keywordtype">int</span> method, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *in, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> fd)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (amba_transfer_write(fd, in, len, method) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;Failed to write stream into SVCT file.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_fast_seek_file(<span class="keywordtype">int</span> method, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *in, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> fd)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (amba_transfer_write(fd, in, len, method) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;Failed to write stream into fast seek file.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> identify_nal_ref_idc(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *in, <span class="keywordtype">int</span> in_len)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> header_magic_number = 0x000001;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> header_mn = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> nalu, nal_ref_idc = -1;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        header_mn = (in[i] &lt;&lt; 16 | in[i+1] &lt;&lt; 8 | in[i+2]);</div>
<div class="line">        <span class="keywordflow">if</span> (header_mn == header_magic_number) {</div>
<div class="line">            i += 3;</div>
<div class="line">            nalu = in[i] &amp; 0x1F;</div>
<div class="line">            <span class="keywordflow">if</span> ((nalu == <a id="a71" name="a71"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga7bafc03a2ffa35c1b91ad8cdb44efc2ea1887e47b13a6d1166f8a0d665bafcb61">NT_IDR</a>) || nalu == <a id="a72" name="a72"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga7bafc03a2ffa35c1b91ad8cdb44efc2ead644b697b278645ada0f8d9aa5bf9274">NT_NON_IDR</a>) {</div>
<div class="line">                nal_ref_idc = ((in[i] &gt;&gt; 5) &amp; 0x3);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        ++i;</div>
<div class="line">    } <span class="keywordflow">while</span> (i &lt; in_len);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> nal_ref_idc;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> identify_nuh_temporal_id_plus1(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *in, <span class="keywordtype">int</span> in_len)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> header_magic_number = 0x000001;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> header_mn = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> nalu, nuh_temporal_id_plus1 = -1;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        header_mn = (in[i] &lt;&lt; 16 | in[i+1] &lt;&lt; 8 | in[i+2]);</div>
<div class="line">        <span class="keywordflow">if</span> (header_mn == header_magic_number) {</div>
<div class="line">            i += 3;</div>
<div class="line">            nalu = (in[i] &amp; 0x7F) &gt;&gt; 1;</div>
<div class="line">            <span class="keywordflow">if</span> ((nalu == <a id="a73" name="a73"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaf270e2154242c10302df5fca9c62b356a8412c81ff02a79b6437834541a134a15">IDR_W_RADL</a>) || (nalu == <a id="a74" name="a74"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaf270e2154242c10302df5fca9c62b356a6c2bcf48369ea9b0cb82a53ac5bff888">TRAIL_R</a>) || nalu == <a id="a75" name="a75"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaf270e2154242c10302df5fca9c62b356a19e1baeeb99a0aaceedaa5c517293085">TSA_N</a>) {</div>
<div class="line">                nuh_temporal_id_plus1 = (in[i+1] &amp; 0x7);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        ++i;</div>
<div class="line">    } <span class="keywordflow">while</span> (i &lt; in_len);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> nuh_temporal_id_plus1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_svct_layer(<span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gaedee632d62ec29c16717d808e9bd406e">iav_stream_type</a> stream_type, <span class="keywordtype">int</span> stream_id, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *in,</div>
<div class="line">    <span class="keywordtype">int</span> in_len, <span class="keywordtype">int</span> *ret_layer) {</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> with_fast_seek = ((stream_files[stream_id].fast_seek_intvl &gt; 0) ? 1 : 0);</div>
<div class="line">    <span class="keywordtype">int</span> gop = stream_files[stream_id].gop_structure;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line">    <span class="keywordtype">int</span> layer, <a id="a76" name="a76"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, is_h264;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!ret_layer) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Invalid return layer pointer!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    is_h264 = ((stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277">IAV_STREAM_TYPE_H264</a>) ? 1 : 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (is_h264) {</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = identify_nal_ref_idc(in, in_len);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = identify_nuh_temporal_id_plus1(in, in_len);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (gop) {</div>
<div class="line">    <span class="keywordflow">case</span> <a id="a77" name="a77"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dad97263704dbbce0ea199aab14ee5e917">IAV_GOP_SVCT_4</a>:</div>
<div class="line">        <span class="keywordflow">if</span> (is_h264) {</div>
<div class="line">            <span class="keywordflow">if</span> (index &lt; 0 || index &gt; 3) {</div>
<div class="line">                rval = -1;</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (with_fast_seek) {</div>
<div class="line">                rval = -1;</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Cannot support fast seek for SVCT\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            layer = abs(3 - index);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (index &lt; 1 || index &gt; 4) {</div>
<div class="line">                rval = -1;</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (with_fast_seek) {</div>
<div class="line">                rval = -1;</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Cannot support fast seek for SVCT\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            layer = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> - 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a id="a78" name="a78"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dabcda486fd1bd17486ac5a8a69b2deb02">IAV_GOP_SVCT_3</a>:</div>
<div class="line">        <span class="keywordflow">if</span> (is_h264) {</div>
<div class="line">            <span class="keywordflow">if</span> (!with_fast_seek) {</div>
<div class="line">                <span class="keywordflow">switch</span> (index) {</div>
<div class="line">                <span class="keywordflow">case</span> 3:</div>
<div class="line">                    layer = 0;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 2:</div>
<div class="line">                    layer = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 0:</div>
<div class="line">                    layer = 2;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">switch</span> (index) {</div>
<div class="line">                <span class="keywordflow">case</span> 2:</div>
<div class="line">                <span class="keywordflow">case</span> 3:</div>
<div class="line">                    layer = 0;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 1:</div>
<div class="line">                    layer = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 0:</div>
<div class="line">                    layer = 2;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (!with_fast_seek) {</div>
<div class="line">                <span class="keywordflow">if</span> (index &lt; 1 || index &gt; 3) {</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                layer = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> - 1;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (index &lt; 0 || index &gt; 4) {</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (index == 1) {</div>
<div class="line">                    layer = 0;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    layer = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> - 2;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dae60af67c61f60828c084a2744ed39f09">IAV_GOP_SVCT_2</a>:</div>
<div class="line">        <span class="keywordflow">if</span> (is_h264) {</div>
<div class="line">            <span class="keywordflow">if</span> (!with_fast_seek) {</div>
<div class="line">                <span class="keywordflow">switch</span> (index) {</div>
<div class="line">                <span class="keywordflow">case</span> 3:</div>
<div class="line">                    layer = 0;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 0:</div>
<div class="line">                    layer = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">switch</span> (index) {</div>
<div class="line">                <span class="keywordflow">case</span> 2:</div>
<div class="line">                <span class="keywordflow">case</span> 3:</div>
<div class="line">                    layer = 0;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 0:</div>
<div class="line">                    layer = 1;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (!with_fast_seek) {</div>
<div class="line">                <span class="keywordflow">if</span> ((index &lt; 1) &amp;&amp; (index &gt; 2)) {</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                layer = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> - 1;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">switch</span> (index) {</div>
<div class="line">                <span class="keywordflow">case</span> 1:</div>
<div class="line">                <span class="keywordflow">case</span> 2:</div>
<div class="line">                    layer = 0;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 3:</div>
<div class="line">                    layer = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Invalid index %d\n&quot;</span>, index);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        rval = -1;</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Invalid SVCT gop structure %d, cannot be larger than 4.\n&quot;</span>, gop);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    *ret_layer = layer;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_svct_files(<span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gaedee632d62ec29c16717d808e9bd406e">iav_stream_type</a> stream_type, <span class="keywordtype">int</span> transfer_method,</div>
<div class="line">    <span class="keywordtype">int</span> stream_id, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *in, <span class="keywordtype">int</span> in_len)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> gop = stream_files[stream_id].gop_structure;</div>
<div class="line">    <span class="keywordtype">int</span> layer = -1, rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (get_svct_layer(stream_type, stream_id, in, in_len, &amp;layer) &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;get svct layer failed!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">switch</span> (gop) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dad97263704dbbce0ea199aab14ee5e917">IAV_GOP_SVCT_4</a>:</div>
<div class="line">        <span class="keywordflow">switch</span>(layer) {</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">            write_svct_file(transfer_method, in, in_len,</div>
<div class="line">                    stream_files[stream_id].fd_svct[3]);</div>
<div class="line">            <span class="comment">/* Fall through to write this frame into other layers */</span></div>
<div class="line">        <span class="keywordflow">case</span> 1:</div>
<div class="line">            write_svct_file(transfer_method, in, in_len,</div>
<div class="line">                    stream_files[stream_id].fd_svct[2]);</div>
<div class="line">            <span class="comment">/* Fall through to write this frame into other layers */</span></div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">            write_svct_file(transfer_method, in, in_len,</div>
<div class="line">                    stream_files[stream_id].fd_svct[1]);</div>
<div class="line">            <span class="comment">/* Fall through to write this frame into other layers */</span></div>
<div class="line">        <span class="keywordflow">case</span> 3:</div>
<div class="line">            write_svct_file(transfer_method, in, in_len,</div>
<div class="line">                    stream_files[stream_id].fd_svct[0]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            rval = -1;</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Incorrect SVCT layer [%d] from bitstream!\n&quot;</span>, layer);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dabcda486fd1bd17486ac5a8a69b2deb02">IAV_GOP_SVCT_3</a>:</div>
<div class="line">        <span class="keywordflow">switch</span> (layer) {</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">            write_svct_file(transfer_method, in, in_len,</div>
<div class="line">                    stream_files[stream_id].fd_svct[2]);</div>
<div class="line">            <span class="comment">/* Fall through to write this frame into other layers */</span></div>
<div class="line">        <span class="keywordflow">case</span> 1:</div>
<div class="line">            write_svct_file(transfer_method, in, in_len,</div>
<div class="line">                    stream_files[stream_id].fd_svct[1]);</div>
<div class="line">            <span class="comment">/* Fall through to write this frame into other layers */</span></div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">            write_svct_file(transfer_method, in, in_len,</div>
<div class="line">                    stream_files[stream_id].fd_svct[0]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            rval = -1;</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Incorrect SVCT layer [%d] from bitstream!\n&quot;</span>, layer);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dae60af67c61f60828c084a2744ed39f09">IAV_GOP_SVCT_2</a>:</div>
<div class="line">        <span class="keywordflow">switch</span> (layer) {</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">            write_svct_file(transfer_method, in, in_len,</div>
<div class="line">                    stream_files[stream_id].fd_svct[1]);</div>
<div class="line">            <span class="comment">/* Fall through to write this frame into other layers */</span></div>
<div class="line">        <span class="keywordflow">case</span> 1:</div>
<div class="line">            write_svct_file(transfer_method, in, in_len,</div>
<div class="line">                    stream_files[stream_id].fd_svct[0]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            rval = -1;</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Incorrect SVCT layer [%d] from bitstream!\n&quot;</span>, layer);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((rval &gt;= 0) &amp;&amp; verbose_mode) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Save SVCT layer [%d] into file.\n&quot;</span>, layer);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_fast_seek_files(<span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gaedee632d62ec29c16717d808e9bd406e">iav_stream_type</a> stream_type, <span class="keywordtype">int</span> transfer_method,</div>
<div class="line">    <span class="keywordtype">int</span> stream_id, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *in, <span class="keywordtype">int</span> in_len)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> fd = stream_files[stream_id].fd_fast_seek;</div>
<div class="line">    <span class="keywordtype">int</span> gop = stream_files[stream_id].gop_structure;</div>
<div class="line">    <span class="keywordtype">int</span> nal_ref_idc, nuh_temporal_id_plus1;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277">IAV_STREAM_TYPE_H264</a>) {</div>
<div class="line">        nal_ref_idc = identify_nal_ref_idc(in, in_len);</div>
<div class="line">        <span class="keywordflow">switch</span> (gop) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dae60af67c61f60828c084a2744ed39f09">IAV_GOP_SVCT_2</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dabcda486fd1bd17486ac5a8a69b2deb02">IAV_GOP_SVCT_3</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dad97263704dbbce0ea199aab14ee5e917">IAV_GOP_SVCT_4</a>:</div>
<div class="line">            <span class="keywordflow">if</span> (nal_ref_idc == 3) {</div>
<div class="line">                write_fast_seek_file(transfer_method, in, in_len, fd);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a79" name="a79"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dac305b34a7279e93d3e9d2721dbf39281">IAV_GOP_FAST_SEEK</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1da749352c49cd3ba3c92e88d03df29e00a">IAV_GOP_FAST_SEEK_2_REF</a>:</div>
<div class="line">            <span class="keywordflow">if</span> (nal_ref_idc == 2 || nal_ref_idc == 3) {</div>
<div class="line">                write_fast_seek_file(transfer_method, in, in_len, fd);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            rval = -1;</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Invalid fast seek gop structure.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stream_type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>) {</div>
<div class="line">        nuh_temporal_id_plus1 = identify_nuh_temporal_id_plus1(in, in_len);</div>
<div class="line">        <span class="keywordflow">if</span> (nuh_temporal_id_plus1 == 1) {</div>
<div class="line">            write_fast_seek_file(transfer_method, in, in_len, fd);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        rval = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((rval &gt;= 0) &amp;&amp; verbose_mode) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Save fast seek frames into files.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_video_file(<span class="keywordtype">int</span> stream_id, <span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gaedee632d62ec29c16717d808e9bd406e">iav_stream_type</a> stream_type, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> data_addr_offset, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pic_size, <span class="keywordtype">int</span> new_frame)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> fd = stream_files[stream_id].fd;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(md5_idr_number &gt; 0) {</div>
<div class="line">        <span class="comment">//printf(&quot;write frame %d\n&quot;,framedesc-&gt;frame_num);</span></div>
<div class="line">        <span class="keywordflow">if</span> (amba_transfer_write(fd, bsb_mem + data_addr_offset, pic_size,</div>
<div class="line">            stream_transfer[stream_id].method) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;Failed to write specify streams into file!\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (new_frame)</div>
<div class="line">            md5_idr_number = md5_idr_number - 1;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (amba_transfer_write(fd, bsb_mem + data_addr_offset, pic_size,</div>
<div class="line">        stream_transfer[stream_id].method) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;Failed to write streams into file!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (split_svct_layer_flag &amp;&amp; (stream_files[stream_id].gop_structure &gt; 1)</div>
<div class="line">        &amp;&amp; (stream_files[stream_id].gop_structure &lt;= 4)) {</div>
<div class="line">        <span class="keywordflow">if</span> (write_svct_files(stream_type, stream_transfer[stream_id].method, stream_id,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)bsb_mem + data_addr_offset, pic_size) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;Failed to split and write SVCT layers into files!\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (split_fast_seek_flag &amp;&amp; (stream_files[stream_id].gop_structure &gt; 1)) {</div>
<div class="line">        <span class="keywordflow">if</span> (write_fast_seek_files(stream_type, stream_transfer[stream_id].method, stream_id,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)bsb_mem + data_addr_offset, pic_size) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;Failed to split and write fast seek frames into files!\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> save_stream_diff_file(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> stream_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> tile_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> port = 0, fd = 0;</div>
<div class="line">    <span class="keywordtype">char</span> filename[512] = {};</div>
<div class="line">    trans_method_t method = TRANS_METHOD_NFS;</div>
<div class="line">    frame_info_t *frame = &amp;frame_info[stream_id];</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *frame_start = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)(bsb_mem + frame-&gt;data_addr_offset[tile_id]);</div>
<div class="line"> </div>
<div class="line">    port = stream_transfer[stream_id].port + STREAM_DIFF_PORT_OFFSET;</div>
<div class="line">    sprintf(filename, <span class="stringliteral">&quot;%sstream_%u_frame_%d_tile_%u&quot;</span>, stream_diff_file_name, stream_id,</div>
<div class="line">        frame_info[stream_id].cap_seq_no, tile_id);</div>
<div class="line">    fd = amba_transfer_open(filename, method, port);</div>
<div class="line">    <span class="keywordflow">if</span> (fd &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;create stream diff file failed %s \n&quot;</span>, filename);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (amba_transfer_write(fd, frame_start, frame-&gt;size[tile_id], method) &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;write failed %s \n&quot;</span>, filename);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    amba_transfer_close(fd, method);</div>
<div class="line">    fd = -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> compare_frame_bits_info(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pre_stream_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> cur_stream_id)</div>
<div class="line">{</div>
<div class="line">    frame_info_t *pre_frame = &amp;frame_info[pre_stream_id];</div>
<div class="line">    frame_info_t *cur_frame = &amp;frame_info[cur_stream_id];</div>
<div class="line">    <span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> count_diff_pts = 0, count_diff_bits = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((pre_frame-&gt;arm_pts != cur_frame-&gt;arm_pts) ||</div>
<div class="line">        (pre_frame-&gt;dsp_pts != cur_frame-&gt;dsp_pts)) {</div>
<div class="line">        count_diff_pts++;</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Stream %c and stream %c&#39;s frame PTS [%llu, %llu; %llu, %llu] is different, statistic count: %llu\n&quot;</span>,</div>
<div class="line">            <span class="charliteral">&#39;A&#39;</span> + pre_stream_id, <span class="charliteral">&#39;A&#39;</span> + cur_stream_id, pre_frame-&gt;arm_pts, cur_frame-&gt;arm_pts,</div>
<div class="line">            pre_frame-&gt;dsp_pts, cur_frame-&gt;dsp_pts, count_diff_pts);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (pre_frame-&gt;pic_type != cur_frame-&gt;pic_type) {</div>
<div class="line">        count_diff_bits++;</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Stream %c and stream %c&#39;s type [%u, %u] is different, statistic count: %llu\n&quot;</span>,</div>
<div class="line">            <span class="charliteral">&#39;A&#39;</span> + pre_stream_id, <span class="charliteral">&#39;A&#39;</span> + cur_stream_id, pre_frame-&gt;pic_type, cur_frame-&gt;pic_type,</div>
<div class="line">            count_diff_bits);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (pre_frame-&gt;tile_num != cur_frame-&gt;tile_num) {</div>
<div class="line">        count_diff_bits++;</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Stream %c and stream %c&#39;s tile num [%u, %u] is different, statistic count: %llu\n&quot;</span>,</div>
<div class="line">            <span class="charliteral">&#39;A&#39;</span> + pre_stream_id, <span class="charliteral">&#39;A&#39;</span> + cur_stream_id, pre_frame-&gt;tile_num, cur_frame-&gt;tile_num,</div>
<div class="line">            count_diff_bits);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; pre_frame-&gt;tile_num; ++i) {</div>
<div class="line">        <span class="keywordflow">if</span> (!pre_frame-&gt;size[i] || !cur_frame-&gt;size[i]) {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (pre_frame-&gt;size[i] != cur_frame-&gt;size[i]) {</div>
<div class="line">            count_diff_bits++;</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Stream %c and stream %c&#39;s tile %d size[%u, %u] is different, statistic count: %llu\n&quot;</span>,</div>
<div class="line">                <span class="charliteral">&#39;A&#39;</span> + pre_stream_id, <span class="charliteral">&#39;A&#39;</span> + cur_stream_id, i, pre_frame-&gt;size[i], cur_frame-&gt;size[i], count_diff_bits);</div>
<div class="line">            <span class="keywordflow">if</span> (stream_diff_file_save) {</div>
<div class="line">                <span class="keywordflow">if</span> (save_stream_diff_file(pre_stream_id, i) &lt; 0) {</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (save_stream_diff_file(cur_stream_id, i) &lt; 0) {</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_byte_compare(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pre_stream_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> cur_stream_id)</div>
<div class="line">{</div>
<div class="line">    frame_info_t *pre_frame = &amp;frame_info[pre_stream_id];</div>
<div class="line">    frame_info_t *cur_frame = &amp;frame_info[cur_stream_id];</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *pre_frame_start = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *cur_frame_start = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>, tile_id, print_num;</div>
<div class="line">    <span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> count_diff_byte = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0, mismatch = 0;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_PRINT_LINE_NUM 10</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (tile_id = 0; tile_id &lt; pre_frame-&gt;tile_num; tile_id++) {</div>
<div class="line">        <span class="keywordflow">if</span> (!pre_frame-&gt;size[tile_id] || !cur_frame-&gt;size[tile_id]) {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">         pre_frame_start = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)(bsb_mem + pre_frame-&gt;data_addr_offset[tile_id]);</div>
<div class="line">         cur_frame_start = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)(bsb_mem + cur_frame-&gt;data_addr_offset[tile_id]);</div>
<div class="line">         print_num = 0;</div>
<div class="line">         mismatch = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (count = 0; <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> &lt; cur_frame-&gt;size[tile_id]; <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>++,</div>
<div class="line">            pre_frame_start++, cur_frame_start++) {</div>
<div class="line">            <span class="keywordflow">if</span> (*pre_frame_start != *cur_frame_start) {</div>
<div class="line">                count_diff_byte++;</div>
<div class="line">                <span class="keywordflow">if</span> (print_num &lt; MAX_PRINT_LINE_NUM) {</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;Frame[%d]: Stream %c byte data 0x%x is different from stream %c &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;byte data 0x%x at addr_offset: [0x%x] in tile %d, statistic count: %llu.\n&quot;</span>,</div>
<div class="line">                        cur_frame-&gt;frame_cnt, <span class="charliteral">&#39;A&#39;</span> + pre_stream_id, *pre_frame_start,</div>
<div class="line">                        <span class="charliteral">&#39;A&#39;</span> + cur_stream_id, *cur_frame_start, count, tile_id, count_diff_byte);</div>
<div class="line">                    print_num += 1;</div>
<div class="line">                }</div>
<div class="line">                mismatch = 1;</div>
<div class="line">                rval = -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (stream_diff_file_save &amp;&amp; mismatch) {</div>
<div class="line">            <span class="keywordflow">if</span> (save_stream_diff_file(pre_stream_id, tile_id) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (save_stream_diff_file(cur_stream_id, tile_id) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_hash_compare(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pre_stream_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> cur_stream_id)</div>
<div class="line">{</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Doesn&#39;t support hash compare now!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_sha256sum_compare(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pre_stream_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> cur_stream_id)</div>
<div class="line">{</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Doesn&#39;t support sha256sum compare now!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> compare_frame(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pre_stream_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> cur_stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>timespec start_time, current_time;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (verbose_mode) {</div>
<div class="line">        clock_gettime(CLOCK_REALTIME, &amp;start_time);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (compare_frame_bits_info(pre_stream_id, cur_stream_id) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (dram_test_method) {</div>
<div class="line">    <span class="keywordflow">case</span> COMPARE_BYTE:</div>
<div class="line">        <span class="keywordflow">if</span> (do_byte_compare(pre_stream_id, cur_stream_id) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> COMPARE_HASH:</div>
<div class="line">        <span class="keywordflow">if</span> (do_hash_compare(pre_stream_id, cur_stream_id) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> COMPARE_SHA256SUM:</div>
<div class="line">        <span class="keywordflow">if</span> (do_sha256sum_compare(pre_stream_id, cur_stream_id) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Doesn&#39;t support this dram test method!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (verbose_mode) {</div>
<div class="line">        clock_gettime(CLOCK_REALTIME, &amp;current_time);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Fram Compare Time (us): [%05ld]\n&quot;</span>,</div>
<div class="line">            (current_time.tv_sec - start_time.tv_sec) * 1000000</div>
<div class="line">            + (current_time.tv_nsec - start_time.tv_nsec) / 1000);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> query_enc_cfg(<span class="keywordtype">int</span> stream_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> type, <span class="keyword">struct</span> <a class="code hl_structRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html">iav_h26x_cfg</a> *h_cfg, <span class="keyword">struct</span> enc_extra_cfg_t *cfg_ex,</div>
<div class="line">    <span class="keyword">struct</span> <a class="code hl_structRef" target="_blank" href="../../../library/d7/d43/structiav__mjpeg__cfg.html">iav_mjpeg_cfg</a> *m_cfg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html">iav_h26x_cfg</a> h26x_cfg = {};</div>
<div class="line">    <span class="keyword">struct </span>enc_extra_cfg_t enc_cfg_ex = {};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a> stream_cfg = {};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d7/d43/structiav__mjpeg__cfg.html">iav_mjpeg_cfg</a> mjpeg_cfg = {};</div>
<div class="line"> </div>
<div class="line">    memset(&amp;h26x_cfg, 0, <span class="keyword">sizeof</span>(h26x_cfg));</div>
<div class="line">    memset(&amp;enc_cfg_ex, 0, <span class="keyword">sizeof</span>(enc_cfg_ex));</div>
<div class="line"> </div>
<div class="line">    h26x_cfg.<a id="a80" name="a80"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html#a76f8ba65ce8f902c0657233adee58698">id</a> = stream_id;</div>
<div class="line">    memset(&amp;stream_cfg, 0, <span class="keyword">sizeof</span>(stream_cfg));</div>
<div class="line">    stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a76f8ba65ce8f902c0657233adee58698">id</a> = stream_id;</div>
<div class="line">    <span class="keywordflow">if</span> (type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277">IAV_STREAM_TYPE_H264</a>) {</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_H264_CONFIG, &amp;h26x_cfg);</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a id="a81" name="a81"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a82" name="a82"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a294a490bc0db886648066a429843f11d">IAV_H264_CFG_RC_STRATEGY</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.tmp_abs_br_flag = stream_cfg.<a id="a83" name="a83"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a84" name="a84"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a22cc3e0e89273615164c352899598efb">h264_rc_strategy</a>.<a id="a85" name="a85"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__rc__strategy.html#adadfc12688236f60b804d18f7cfa609a">abs_br_flag</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a86" name="a86"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a802152f5e08b1e008e5079b765033e02">IAV_H264_CFG_BITRATE</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.h26x_rc = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a87" name="a87"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a17e386bedda299fc1b79dd4ad1921bac">h264_rc</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a88" name="a88"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108afae12a633e5626bf4deb1e402c98ae4f">IAV_H264_CFG_SLICE</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.slice_num = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a89" name="a89"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a35ecc3fcbd933e5786be445572507dc1">h264_slice</a>.<a id="a90" name="a90"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d81/structiav__h26x__slice.html#a307e65ffd58b067088b9f00cbd9ca09c">slice_num</a>;</div>
<div class="line">        enc_cfg_ex.slices_per_info = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a35ecc3fcbd933e5786be445572507dc1">h264_slice</a>.<a id="a91" name="a91"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d81/structiav__h26x__slice.html#a54a0b889d81a72e959fe1091fe1b2363">slices_per_info</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a92" name="a92"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a8a1cb91b534e9b04eb833c6c65f707be">IAV_H264_CFG_FORCE_PSKIP</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.h26x_pskip = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a93" name="a93"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a9687e1c733814030f16e3a1eb049c810">h264_pskip</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a94" name="a94"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a2c2e5c9b15a2a2ec7d77fde507b19170">IAV_H264_CFG_FRAME_DROP</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.h26x_drop_frame = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a95" name="a95"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a0308383d69855c752c8cc2b43db8728c">h264_drop_frame</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a96" name="a96"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a7fe661c2cfead266c1bde3dcab4ae243">IAV_H264_CFG_SAR</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.sar_width = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a97" name="a97"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a8e95576e3516b67ed291094f9754c63a">h264_sar</a>.<a id="a98" name="a98"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d50/structiav__h26x__sar.html#a54a5949a9c526a25f7f552ee1965914e">sar_width</a>;</div>
<div class="line">        enc_cfg_ex.sar_height = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a8e95576e3516b67ed291094f9754c63a">h264_sar</a>.<a id="a99" name="a99"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d50/structiav__h26x__sar.html#ac955bae308c67d9b59b89dc5a5c58806">sar_height</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>) {</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_H265_CONFIG, &amp;h26x_cfg);</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a100" name="a100"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a82801dcd55b3c1d8dc211b5bd98001de">IAV_H265_CFG_RC_STRATEGY</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.tmp_abs_br_flag = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a101" name="a101"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#af42f3bbb4c5c58d67865ed3e8b98c132">h265_rc_strategy</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__rc__strategy.html#adadfc12688236f60b804d18f7cfa609a">abs_br_flag</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a102" name="a102"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108adbfa334a65db4fdfd1992100f715cca1">IAV_H265_CFG_BITRATE</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.h26x_rc = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a103" name="a103"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#ae4192058027a558af30f8bdc85974807">h265_rc</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a1c861139c2cef5211143f5f2f509c027">IAV_H265_CFG_SLICE</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.slice_num = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a104" name="a104"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#ae26e577bd0e72099de1a2fbaa6f01ae0">h265_slice</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d81/structiav__h26x__slice.html#a307e65ffd58b067088b9f00cbd9ca09c">slice_num</a>;</div>
<div class="line">        enc_cfg_ex.slices_per_info = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#ae26e577bd0e72099de1a2fbaa6f01ae0">h265_slice</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d81/structiav__h26x__slice.html#a54a0b889d81a72e959fe1091fe1b2363">slices_per_info</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a105" name="a105"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a16e25b1a43f33b685bd92c23a5498313">IAV_H265_CFG_FORCE_PSKIP</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.h26x_pskip = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a106" name="a106"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#ae4802c4ca9395c40c04ee7df617c4d9f">h265_pskip</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a107" name="a107"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a2b9fe74b62bd1be476523cc882f41751">IAV_H265_CFG_FRAME_DROP</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.h26x_drop_frame = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a108" name="a108"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#af8a75e41c9129251d7a82658cf68b05c">h265_drop_frame</a>;</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a109" name="a109"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108aaf0f9821638d4718ee7a88fc84446ec9">IAV_H265_CFG_SAR</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.sar_width = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a110" name="a110"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a7eb50103ead09f3fb04707fc18aaeada">h265_sar</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d50/structiav__h26x__sar.html#a54a5949a9c526a25f7f552ee1965914e">sar_width</a>;</div>
<div class="line">        enc_cfg_ex.sar_height = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a7eb50103ead09f3fb04707fc18aaeada">h265_sar</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d50/structiav__h26x__sar.html#ac955bae308c67d9b59b89dc5a5c58806">sar_height</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a111" name="a111"></a>IAV_IOC_GET_MJPEG_CONFIG, &amp;mjpeg_cfg);</div>
<div class="line"> </div>
<div class="line">        stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a112" name="a112"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a657404d7e52519f904523208473f6d77">IAV_MJPEG_CFG_QUALITY</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">        enc_cfg_ex.tmp_abs_br_flag = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a113" name="a113"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a3639355167e1a58cc67cec02f9b62883">mjpeg_quality</a>;</div>
<div class="line">    }</div>
<div class="line">    stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">cid</a> = <a id="a114" name="a114"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a7b301a723e47fd9588a2b996a56ddc30">IAV_STMCFG_DUMMY_LATENCY</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg);</div>
<div class="line">    enc_cfg_ex.stream_dummy_latency = stream_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">arg</a>.<a id="a115" name="a115"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html#a686049e2b2002a8e6ed9273aab87af06">stream_dummy_latency</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// make id invalid, so as to not be caught by memcmp()</span></div>
<div class="line">    h26x_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d64/structiav__h26x__cfg.html#a76f8ba65ce8f902c0657233adee58698">id</a> = ~0x0;</div>
<div class="line">    enc_cfg_ex.h26x_rc.id = ~0x0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (h_cfg) {</div>
<div class="line">        memcpy(h_cfg, &amp;h26x_cfg, <span class="keyword">sizeof</span>(h26x_cfg));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (cfg_ex) {</div>
<div class="line">        memcpy(cfg_ex, &amp;enc_cfg_ex, <span class="keyword">sizeof</span>(enc_cfg_ex));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (m_cfg) {</div>
<div class="line">        memcpy(m_cfg, &amp;mjpeg_cfg, <span class="keyword">sizeof</span>(mjpeg_cfg));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Brief:     query stream info with the specified id, and return encoding state</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * stream_id: stream you want query</span></div>
<div class="line"><span class="comment"> * info:      stream info will be copied to *info if not null</span></div>
<div class="line"><span class="comment"> * return:    encoding_state refer to *iav_stream_state*</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> query_stream_info(<span class="keywordtype">int</span> stream_id, <span class="keyword">struct</span> stream_info *info)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a116" name="_a116"></a><a class="code hl_structRef" target="_blank" href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a> query_info;</div>
<div class="line">    <span class="keywordtype">int</span> state = <a id="a117" name="a117"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a3aec28928ac385094ced7c84be9635b2">IAV_STREAM_STATE_UNKNOWN</a>;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a118" name="_a118"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html">iav_stream_format</a> *<a id="a119" name="a119"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a> cfg_fmt, cfg_fps;</div>
<div class="line">    <span class="keyword">struct </span>stream_info out;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;out, 0, <span class="keyword">sizeof</span>(out));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// query stream state</span></div>
<div class="line">    memset(&amp;query_info, 0, <span class="keyword">sizeof</span>(query_info));</div>
<div class="line">    query_info.qid = <a id="a120" name="a120"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a>;</div>
<div class="line">    query_info.arg.stream.id = stream_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a121" name="a121"></a>IAV_IOC_QUERY_INFO, &amp;query_info);</div>
<div class="line">    state = query_info.arg.stream.state;</div>
<div class="line">    <span class="keywordflow">switch</span> (state) {</div>
<div class="line">    <span class="keywordflow">case</span> <a id="a122" name="a122"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a0ce04427b3d31f342fd4987c24061396">IAV_STREAM_STATE_IDLE</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a id="a123" name="a123"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a6e9d926f59102b9563a722581c65ee55">IAV_STREAM_STATE_STARTING</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a id="a124" name="a124"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d">IAV_STREAM_STATE_ENCODING</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a id="a125" name="a125"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a41fdd0209762b605c1db4b133d3f1b31">IAV_STREAM_STATE_STOPPING</a>:</div>
<div class="line">        out.state = state;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        out.state = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a3aec28928ac385094ced7c84be9635b2">IAV_STREAM_STATE_UNKNOWN</a>;</div>
<div class="line">        <span class="keywordflow">return</span> state;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// query stream format</span></div>
<div class="line">    memset(&amp;cfg_fmt, 0, <span class="keyword">sizeof</span>(cfg_fmt));</div>
<div class="line">    cfg_fmt.id = stream_id;</div>
<div class="line">    cfg_fmt.cid = <a id="a126" name="a126"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48">IAV_STMCFG_FORMAT</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;cfg_fmt);</div>
<div class="line">    <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> = &amp;cfg_fmt.arg.format;</div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>-&gt;type) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277">IAV_STREAM_TYPE_H264</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ead2feabb75221806525afe5d4bc053431">IAV_STREAM_TYPE_MJPEG</a>:</div>
<div class="line">        out.type = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>-&gt;type;</div>
<div class="line">        out.canvas = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>-&gt;enc_src_id;</div>
<div class="line">        out.win.x = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>-&gt;enc_win.x;</div>
<div class="line">        out.win.y = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>-&gt;enc_win.y;</div>
<div class="line">        out.win.width = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>-&gt;enc_win.width;</div>
<div class="line">        out.win.height = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>-&gt;enc_win.height;</div>
<div class="line">        out.hflip = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>-&gt;hflip;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        out.type = <a id="a127" name="a127"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea04c04080b42594c20a682e29c58aeea2">IAV_STREAM_TYPE_INVALID</a>;</div>
<div class="line">        <span class="keywordflow">return</span> state;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// query fps</span></div>
<div class="line">    memset(&amp;cfg_fps, 0, <span class="keyword">sizeof</span>(cfg_fps));</div>
<div class="line">    cfg_fps.id = stream_id;</div>
<div class="line">    cfg_fps.cid = <a id="a128" name="a128"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108ad538c0019ebda9e6b5046fd09b716252">IAV_STMCFG_FPS</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_STREAM_CONFIG, &amp;cfg_fps);</div>
<div class="line">    out.abs_fps = enable_hp_fps ? cfg_fps.arg.fps.abs_fps_hp : cfg_fps.arg.fps.abs_fps;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (info != NULL) {</div>
<div class="line">        query_enc_cfg(stream_id, out.type, &amp;out.h26x_cfg, &amp;out.extra, &amp;out.mjpeg_cfg);</div>
<div class="line">        memcpy(info, &amp;out, <span class="keyword">sizeof</span>(out));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> state;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> dram_test_pre_check(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> mask)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> stream_num = 0;</div>
<div class="line">    <span class="keyword">struct </span>stream_info info[MAX_ENCODE_STREAM_NUM];</div>
<div class="line">    <span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> stream_id[MAX_ENCODE_STREAM_NUM];</div>
<div class="line">    <span class="keywordtype">int</span> active=0, i, rval;</div>
<div class="line">    <span class="keywordtype">int</span> state = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a3aec28928ac385094ced7c84be9635b2">IAV_STREAM_STATE_UNKNOWN</a>;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;mask is 0x%x\n&quot;</span>, mask);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;info, 0, <span class="keyword">sizeof</span>(info));</div>
<div class="line">    memset(&amp;stream_id, 0, <span class="keyword">sizeof</span>(stream_id)); <span class="comment">// ugly way to disable compile warning</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; i++) {</div>
<div class="line">        active = mask &amp; (0x01 &lt;&lt; i);</div>
<div class="line">        printf(<span class="stringliteral">&quot;stream %c, state: %d\n&quot;</span>, <span class="charliteral">&#39;A&#39;</span>+i, active);</div>
<div class="line">        <span class="keywordflow">if</span> (active) {</div>
<div class="line">            state = query_stream_info(i, &amp;info[i]);</div>
<div class="line">            <span class="keywordflow">if</span> (state == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d">IAV_STREAM_STATE_ENCODING</a>) {</div>
<div class="line">                stream_id[stream_num] = i;</div>
<div class="line">            }</div>
<div class="line">            ++stream_num;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (stream_num &lt; 2) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Stream diff num must &gt;= 2 when do the dram test!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; stream_num - 1; i++) {</div>
<div class="line">        rval = memcmp(info + stream_id[i], info + stream_id[i + 1], <span class="keyword">sizeof</span>(<span class="keyword">struct</span> stream_info));</div>
<div class="line">        <span class="keywordflow">if</span> (rval) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Error: parameter of these two stream (%d, %d) compare failed!\n&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;Please get more info from the \&quot;test_encode --show-all-info\&quot;\n&quot;</span>,</div>
<div class="line">                stream_id[i], stream_id[i + 1]);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;DRAM test pre check, OK...\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>* dram_test(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> stream_id, tile_id, new_frame, last_desc;</div>
<div class="line">    bitstream_info_t *framedesc;</div>
<div class="line">    <span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> total_err_num = 0, compared_num = 0;</div>
<div class="line">    pipe_mesg_t pipe_mesg;</div>
<div class="line">    fd_set all_set, set;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>*)&amp;pipe_mesg;</div>
<div class="line">    <span class="keywordtype">int</span> new_session; <span class="comment">//0:  old session  1: new session</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> stream_map = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> stream_num = 0, stream_map_id[MAX_ENCODE_STREAM_NUM] = {};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> i = 0;</div>
<div class="line"> </div>
<div class="line">    FD_ZERO(&amp;all_set);</div>
<div class="line">    FD_SET(dram_test_pipefd[0], &amp;all_set);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;frame_info, 0, <span class="keyword">sizeof</span>(frame_info_t) * MAX_ENCODE_STREAM_NUM);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (dram_test_run) {</div>
<div class="line">        set = all_set;</div>
<div class="line">        <span class="keywordflow">if</span> (read_pipe(buf, &amp;set, DRAM_TEST_PIPE) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (pipe_mesg.stop) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Received stop message, stop dram test!\n&quot;</span>);</div>
<div class="line">            dram_test_run = 0;</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        framedesc = &amp;pipe_mesg.framedesc;</div>
<div class="line">        new_frame = pipe_mesg.new_frame;</div>
<div class="line">        last_desc = pipe_mesg.last_desc;</div>
<div class="line">        new_session = pipe_mesg.new_session;</div>
<div class="line">        stream_id = framedesc-&gt;stream_id;</div>
<div class="line">        tile_id = framedesc-&gt;tile_id;</div>
<div class="line">        <span class="keywordflow">if</span> (!(dram_test_stream_map &amp; (1 &lt;&lt; stream_id))) {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((stream_map &amp; (1 &lt;&lt; stream_id)) == 0) {</div>
<div class="line">            stream_map_id[stream_num] = stream_id;</div>
<div class="line">            ++stream_num;</div>
<div class="line">            stream_map |= 1 &lt;&lt; stream_id;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (new_session || new_frame) {</div>
<div class="line">            memset(&amp;frame_info[stream_id], 0, <span class="keyword">sizeof</span>(frame_info_t));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (new_frame) {</div>
<div class="line">            frame_info[stream_id].arm_pts = framedesc-&gt;arm_pts;</div>
<div class="line">            frame_info[stream_id].dsp_pts = framedesc-&gt;dsp_pts;</div>
<div class="line">            frame_info[stream_id].cap_seq_no = framedesc-&gt;cap_seq_no;</div>
<div class="line">            frame_info[stream_id].pic_type = framedesc-&gt;pic_type;</div>
<div class="line">            frame_info[stream_id].tile_num = framedesc-&gt;tile_num;</div>
<div class="line">            frame_info[stream_id].data_addr_offset[tile_id] = framedesc-&gt;data_addr_offset;</div>
<div class="line">            frame_info[stream_id].size[tile_id] = framedesc-&gt;size;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (framedesc-&gt;cap_seq_no != frame_info[stream_id].cap_seq_no) {</div>
<div class="line">                frame_info[stream_id].data_addr_offset[tile_id] = 0;</div>
<div class="line">                frame_info[stream_id].size[tile_id] = 0;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                frame_info[stream_id].data_addr_offset[tile_id] = framedesc-&gt;data_addr_offset;</div>
<div class="line">                frame_info[stream_id].size[tile_id] = framedesc-&gt;size;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (last_desc) {</div>
<div class="line">            frame_info[stream_id].frame_cnt++;</div>
<div class="line">            <span class="keywordflow">if</span> (stream_checked) {</div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; stream_num - 1; i++) {</div>
<div class="line">                    <span class="keywordflow">if</span> ((frame_info[stream_map_id[i]].arm_pts != frame_info[stream_map_id[i + 1]].arm_pts) ||</div>
<div class="line">                        (frame_info[stream_map_id[i]].dsp_pts != frame_info[stream_map_id[i + 1]].dsp_pts)) {</div>
<div class="line">                        <span class="comment">/*printf(&quot;Skip comparing: stream %c and stream %c, Frame PTS [%llu, %llu], &quot;</span></div>
<div class="line"><span class="comment">                            &quot;DSP PTS [%llu, %llu], Tile ID [%d, %d], Slice ID [%d, %d]. these must be matched!\n&quot;,</span></div>
<div class="line"><span class="comment">                            &#39;A&#39; + stream_map_id[i], &#39;A&#39; + stream_map_id[i + 1], frame_info[stream_map_id[i]].arm_pts,</span></div>
<div class="line"><span class="comment">                            frame_info[stream_map_id[i + 1]].arm_pts, frame_info[stream_map_id[i]].dsp_pts,</span></div>
<div class="line"><span class="comment">                            frame_info[stream_map_id[i + 1]].dsp_pts);*/</span></div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (i != (stream_num - 1)) {</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                }</div>
<div class="line">                ++compared_num;</div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; stream_num - 1; i++) {</div>
<div class="line">                    <span class="keywordflow">if</span> (compare_frame(stream_map_id[i], stream_map_id[i + 1]) &lt; 0) {</div>
<div class="line">                        total_err_num++;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Dram test not run! Stream cfg check failed! Please setup up your stream once again...\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    fprintf(total_err_num ? stderr : stdout, <span class="stringliteral">&quot;&gt;&gt;Stream map 0x%x total dismatched frame: num %d; Total compared frame: num %d\n&quot;</span>,</div>
<div class="line">        stream_map, total_err_num, compared_num);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dram_test_pipefd[0] &gt;= 0) {</div>
<div class="line">        close(dram_test_pipefd[0]);</div>
<div class="line">        dram_test_pipefd[0] = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ((<span class="keywordtype">void</span> *)0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_stream(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> *total_frames, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> *total_bytes)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a> query_info;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a129" name="_a129"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html">iav_stream_info</a> *stream_info;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a130" name="_a130"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> query_desc;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a131" name="_a131"></a><a class="code hl_structRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html">iav_framedesc</a> *frame_desc;</div>
<div class="line">    bitstream_info_t bs_info = {0};</div>
<div class="line">    pipe_mesg_t pipe_mesg;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> init_flag = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> end_of_stream[MAX_ENCODE_STREAM_NUM];</div>
<div class="line">    <span class="keywordtype">int</span> new_session; <span class="comment">//0:  old session  1: new session</span></div>
<div class="line">    <span class="keywordtype">int</span> new_frame;</div>
<div class="line">    <span class="keywordtype">int</span> last_desc;</div>
<div class="line">    <span class="keywordtype">int</span> stream_id;</div>
<div class="line">    <span class="keywordtype">int</span> i, stream_end_num;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>*)&amp;pipe_mesg;</div>
<div class="line">    <span class="comment">// current active stream mask, 32 bit in case stream num exceed 16</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> active_stream_mask = 0, active_stream_num = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> stream_state_changed = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (init_flag == 0) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; ++i) {</div>
<div class="line">            end_of_stream[i] = 1;</div>
<div class="line">        }</div>
<div class="line">        init_flag = 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0, stream_end_num = 0; i &lt; MAX_ENCODE_STREAM_NUM; ++i) {</div>
<div class="line">        query_info.qid = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a>;</div>
<div class="line">        stream_info = &amp;query_info.arg.stream;</div>
<div class="line">        stream_info-&gt;<a id="a132" name="a132"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#a76f8ba65ce8f902c0657233adee58698">id</a> = i;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_QUERY_INFO, &amp;query_info);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (stream_info-&gt;<a id="a133" name="a133"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#ac78453cf0c29f2b9c40cfb142185d7d9">state</a> == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d">IAV_STREAM_STATE_ENCODING</a>) {</div>
<div class="line">            ++active_stream_num;</div>
<div class="line">            active_stream_mask |= 0x01 &lt;&lt; i;</div>
<div class="line">            end_of_stream[i] = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        stream_end_num += end_of_stream[i];</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// check if the encode state changed</span></div>
<div class="line">    <span class="keywordflow">if</span> (stream_mask != active_stream_mask) {</div>
<div class="line">        stream_state_changed = 1;</div>
<div class="line">        stream_mask = active_stream_mask; <span class="comment">// update the old status.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// There is no encoding stream, skip to next turn</span></div>
<div class="line">    <span class="comment">//  if (stream_end_num == MAX_ENCODE_STREAM_NUM)</span></div>
<div class="line">    <span class="comment">//      return -1;</span></div>
<div class="line"> </div>
<div class="line">    memset(&amp;query_desc, 0, <span class="keyword">sizeof</span>(query_desc));</div>
<div class="line">    frame_desc = &amp;query_desc.arg.frame;</div>
<div class="line">    query_desc.qid = <a id="a134" name="a134"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a05a4e65f2c13698887b00b1c3ecc78f9">IAV_DESC_FRAME</a>;</div>
<div class="line">    frame_desc-&gt;<a id="a135" name="a135"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a76f8ba65ce8f902c0657233adee58698">id</a> = -1;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a136" name="a136"></a>IAV_IOC_QUERY_DESC, &amp;query_desc) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (errno != EAGAIN) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_DESC&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//check if it&#39;s new record session, since file name and recording control are based on session,</span></div>
<div class="line">    <span class="comment">//session id and change are important data</span></div>
<div class="line">    stream_id = frame_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a76f8ba65ce8f902c0657233adee58698">id</a>;</div>
<div class="line">    bs_info.capture_slice = 0;</div>
<div class="line">    bs_info.stream_id = frame_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a76f8ba65ce8f902c0657233adee58698">id</a>;</div>
<div class="line">    bs_info.session_id = frame_desc-&gt;<a id="a137" name="a137"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#ae5401bda5cc0670b055c52f088f2f3be">session_id</a>;</div>
<div class="line">    bs_info.stream_type = frame_desc-&gt;<a id="a138" name="a138"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a7d4dd0e7496c6f3e469cbdd595d5c316">stream_type</a>;</div>
<div class="line">    bs_info.pic_type = frame_desc-&gt;<a id="a139" name="a139"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#ad7fac670f30ba59aece395f5b2728af7">pic_type</a>;</div>
<div class="line">    bs_info.tile_num = frame_desc-&gt;<a id="a140" name="a140"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a4e04f3eb60d24e83a45c6bbbc1ced648">tile_num</a>;</div>
<div class="line">    bs_info.slice_id = frame_desc-&gt;<a id="a141" name="a141"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#adbeafb6e77f9524829e5a8d3478f40fd">slice_id</a>;</div>
<div class="line">    bs_info.slice_num = frame_desc-&gt;<a id="a142" name="a142"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a307e65ffd58b067088b9f00cbd9ca09c">slice_num</a>;</div>
<div class="line">    bs_info.tile_num = frame_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a4e04f3eb60d24e83a45c6bbbc1ced648">tile_num</a>;</div>
<div class="line">    bs_info.tile_id = frame_desc-&gt;<a id="a143" name="a143"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a583019aeb8f4f128724193f32ab7c9ec">tile_id</a>;</div>
<div class="line">    bs_info.data_addr_offset = frame_desc-&gt;<a id="a144" name="a144"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a16f01e9ac75392f8e05471ead76a95ae">data_addr_offset</a>;</div>
<div class="line">    bs_info.size = frame_desc-&gt;<a id="a145" name="a145"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#acfd6273064c5acdcfc39a23a69dd4343">size</a>;</div>
<div class="line">    bs_info.arm_pts = frame_desc-&gt;<a id="a146" name="a146"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#acdcae461112d36f391aa2ab38fa574f2">arm_pts</a>;</div>
<div class="line">    bs_info.dsp_pts = frame_desc-&gt;<a id="a147" name="a147"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a82da34339e47d843675a923db70727d9">dsp_pts</a>;</div>
<div class="line">    bs_info.frame_num = frame_desc-&gt;<a id="a148" name="a148"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a8f3e1c561bace8d5100de02177ce0c3a">frame_num</a>;</div>
<div class="line">    bs_info.encoded_frame_num = frame_desc-&gt;<a id="a149" name="a149"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a51f963a9e798d29347ed1ea9c882ebfb">encoded_frame_num</a>;</div>
<div class="line">    bs_info.reso = frame_desc-&gt;<a id="a150" name="a150"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#ae3bf418630bbc93c57fa8a63032f9ca5">reso</a>;</div>
<div class="line">    bs_info.enc_done_ts = frame_desc-&gt;<a id="a151" name="a151"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a6fcb833e69f93194b065f17833611869">enc_done_ts</a>;</div>
<div class="line">    bs_info.stream_end = frame_desc-&gt;<a id="a152" name="a152"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a1e7fcc7abfd391fd12e9c44105b3121d">stream_end</a>;</div>
<div class="line">    new_session = is_new_session(&amp;bs_info);</div>
<div class="line">    new_frame = is_new_frame(&amp;bs_info);</div>
<div class="line">    last_desc = is_last_framedesc(&amp;bs_info);</div>
<div class="line"> </div>
<div class="line">    memcpy(&amp;pipe_mesg.framedesc, &amp;bs_info, <span class="keyword">sizeof</span>(bitstream_info_t));</div>
<div class="line">    pipe_mesg.new_session = new_session;</div>
<div class="line">    pipe_mesg.new_frame = new_frame;</div>
<div class="line">    pipe_mesg.last_desc = last_desc;</div>
<div class="line">    pipe_mesg.tile_num = (bs_info.tile_num ? bs_info.tile_num : 1);</div>
<div class="line">    pipe_mesg.stop = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (stream_state_changed &amp;&amp; active_stream_num &gt; 1 &amp;&amp; do_dram_test_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (dram_test_pre_check(active_stream_mask &amp; dram_test_stream_map) &lt; 0) {</div>
<div class="line">            stream_checked = 0;                    <span class="comment">// stop do dram test</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;Stoping do dram test...\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            stream_checked = 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_statistics_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (write_pipe(buf, STATISTICS_PIPE) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Failed to write message to do statistics thread:\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_dram_test_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (write_pipe(buf, DRAM_TEST_PIPE) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Failed to write message to dram test thread:\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//check if it&#39;s a stream end null frame indicator</span></div>
<div class="line">    <span class="keywordflow">if</span> (bs_info.stream_end) {</div>
<div class="line">        end_of_stream[stream_id] = 1;</div>
<div class="line">        deinit_stream_files(stream_id);</div>
<div class="line">        <span class="keywordflow">goto</span> write_stream_exit;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (update_files_data(&amp;bs_info, new_session) &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;update files data failed \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -2;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//check and update session file handle</span></div>
<div class="line">    <span class="keywordflow">if</span> (check_session_file_handle(&amp;bs_info, new_session) &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;check session file handle failed \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -3;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (frame_info_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (write_frame_info(&amp;bs_info) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;write video frame info failed for stream %d, session id = %d.\n&quot;</span>,</div>
<div class="line">                stream_id, bs_info.session_id);</div>
<div class="line">            <span class="keywordflow">return</span> -5;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//write file if file is still opened</span></div>
<div class="line">    <span class="keywordflow">if</span> (write_video_file(stream_id, frame_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a7d4dd0e7496c6f3e469cbdd595d5c316">stream_type</a>, frame_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#a16f01e9ac75392f8e05471ead76a95ae">data_addr_offset</a>, frame_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html#acfd6273064c5acdcfc39a23a69dd4343">size</a>, new_frame) &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;write video file failed for stream %d, session id = %d \n&quot;</span>,</div>
<div class="line">            stream_id, bs_info.session_id);</div>
<div class="line">        <span class="keywordflow">return</span> -4;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//update global statistics</span></div>
<div class="line">    <span class="keywordflow">if</span> (total_frames &amp;&amp; new_frame)</div>
<div class="line">        *total_frames = (*total_frames) + 1;</div>
<div class="line">    <span class="keywordflow">if</span> (total_bytes)</div>
<div class="line">        *total_bytes = (*total_bytes) + bs_info.size;</div>
<div class="line"> </div>
<div class="line">write_stream_exit:</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_stream_slice(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> *total_frames, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> *total_bytes)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a> query_info;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html">iav_stream_info</a> *stream_info;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> query_desc;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a153" name="_a153"></a><a class="code hl_structRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html">iav_slicedesc</a> *slice_desc;</div>
<div class="line">    bitstream_info_t bs_info = {0}; </div>
<div class="line">    pipe_mesg_t pipe_mesg;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> init_flag = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> end_of_stream[MAX_ENCODE_STREAM_NUM];</div>
<div class="line">    <span class="keywordtype">int</span> new_session; <span class="comment">//0:  old session  1: new session</span></div>
<div class="line">    <span class="keywordtype">int</span> new_frame, last_desc;</div>
<div class="line">    <span class="keywordtype">int</span> stream_id;</div>
<div class="line">    <span class="keywordtype">int</span> i, stream_end_num;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>*)&amp;pipe_mesg;</div>
<div class="line">    <span class="comment">// current active stream mask, 32 bit in case stream num exceed 16</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> active_stream_mask = 0, active_stream_num = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (init_flag == 0) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; ++i) {</div>
<div class="line">            end_of_stream[i] = 1;</div>
<div class="line">        }</div>
<div class="line">        init_flag = 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0, stream_end_num = 0; i &lt; MAX_ENCODE_STREAM_NUM; ++i) {</div>
<div class="line">        query_info.qid = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a>;</div>
<div class="line">        stream_info = &amp;query_info.arg.stream;</div>
<div class="line">        stream_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#a76f8ba65ce8f902c0657233adee58698">id</a> = i;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_QUERY_INFO, &amp;query_info);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (stream_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#ac78453cf0c29f2b9c40cfb142185d7d9">state</a> == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d">IAV_STREAM_STATE_ENCODING</a>) {</div>
<div class="line">            ++active_stream_num;</div>
<div class="line">            active_stream_mask |= 0x01 &lt;&lt; i;</div>
<div class="line">            end_of_stream[i] = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        stream_end_num += end_of_stream[i];</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// check if the encode state changed</span></div>
<div class="line">    <span class="keywordflow">if</span> (stream_mask != active_stream_mask) {</div>
<div class="line">        stream_mask = active_stream_mask; <span class="comment">// update the old status. </span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset(&amp;query_desc, 0, <span class="keyword">sizeof</span>(query_desc));</div>
<div class="line">    slice_desc = &amp;query_desc.arg.slice;</div>
<div class="line">    query_desc.qid = <a id="a154" name="a154"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ab3398b978d51349610903adcb8d5cd43">IAV_DESC_SLICE</a>;</div>
<div class="line">    slice_desc-&gt;<a id="a155" name="a155"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a76f8ba65ce8f902c0657233adee58698">id</a> = -1;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_QUERY_DESC, &amp;query_desc) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (errno != EAGAIN) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_DESC&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//check if it&#39;s new record session, since file name and recording control are based on session,</span></div>
<div class="line">    <span class="comment">//session id and change are important data</span></div>
<div class="line">    stream_id = slice_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a76f8ba65ce8f902c0657233adee58698">id</a>;</div>
<div class="line">    bs_info.capture_slice = 1;</div>
<div class="line">    bs_info.stream_id = slice_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a76f8ba65ce8f902c0657233adee58698">id</a>;</div>
<div class="line">    bs_info.session_id = slice_desc-&gt;<a id="a156" name="a156"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#ae5401bda5cc0670b055c52f088f2f3be">session_id</a>;</div>
<div class="line">    bs_info.stream_type = slice_desc-&gt;<a id="a157" name="a157"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a7d4dd0e7496c6f3e469cbdd595d5c316">stream_type</a>;</div>
<div class="line">    bs_info.pic_type = slice_desc-&gt;<a id="a158" name="a158"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#ad7fac670f30ba59aece395f5b2728af7">pic_type</a>;</div>
<div class="line">    bs_info.slice_id = slice_desc-&gt;<a id="a159" name="a159"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#adbeafb6e77f9524829e5a8d3478f40fd">slice_id</a>;</div>
<div class="line">    bs_info.slice_num = slice_desc-&gt;<a id="a160" name="a160"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a307e65ffd58b067088b9f00cbd9ca09c">slice_num</a>;</div>
<div class="line">    bs_info.tile_num = slice_desc-&gt;<a id="a161" name="a161"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a4e04f3eb60d24e83a45c6bbbc1ced648">tile_num</a>;</div>
<div class="line">    bs_info.tile_id = slice_desc-&gt;<a id="a162" name="a162"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a583019aeb8f4f128724193f32ab7c9ec">tile_id</a>;</div>
<div class="line">    bs_info.data_addr_offset = slice_desc-&gt;<a id="a163" name="a163"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a507231e36ac5c9ce5b57c2b5a6f1bc9c">data_addr_offset</a>[0];</div>
<div class="line">    bs_info.arm_pts = slice_desc-&gt;<a id="a164" name="a164"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#acdcae461112d36f391aa2ab38fa574f2">arm_pts</a>;</div>
<div class="line">    bs_info.frame_num = slice_desc-&gt;<a id="a165" name="a165"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a8f3e1c561bace8d5100de02177ce0c3a">frame_num</a>;</div>
<div class="line">    bs_info.encoded_frame_num = slice_desc-&gt;<a id="a166" name="a166"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a2fcd84bb36c4623eb05c14c6c443c97f">encoded_frame_num</a>;</div>
<div class="line">    bs_info.reso = slice_desc-&gt;<a id="a167" name="a167"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#ae3bf418630bbc93c57fa8a63032f9ca5">reso</a>;</div>
<div class="line">    bs_info.enc_done_ts = slice_desc-&gt;<a id="a168" name="a168"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a6fcb833e69f93194b065f17833611869">enc_done_ts</a>;</div>
<div class="line">    bs_info.stream_end = slice_desc-&gt;<a id="a169" name="a169"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a1e7fcc7abfd391fd12e9c44105b3121d">stream_end</a>;</div>
<div class="line">    bs_info.bitrate_kbps = slice_desc-&gt;<a id="a170" name="a170"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#aceea0dbfe9e773672305060e6be34add">bitrate_kbps</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; slice_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a4e04f3eb60d24e83a45c6bbbc1ced648">tile_num</a>; i++) {</div>
<div class="line">        bs_info.size += slice_desc-&gt;<a id="a171" name="a171"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a6f853631f16dc3e7643488091f5a083f">size</a>[i];</div>
<div class="line">    }</div>
<div class="line">    new_session = is_new_session(&amp;bs_info);</div>
<div class="line">    new_frame = (bs_info.slice_id == 0);</div>
<div class="line">    last_desc = (bs_info.slice_id == (bs_info.slice_num -1));</div>
<div class="line">        </div>
<div class="line">    memcpy(&amp;pipe_mesg.framedesc, &amp;bs_info, <span class="keyword">sizeof</span>(bitstream_info_t));</div>
<div class="line">    pipe_mesg.new_session = new_session;</div>
<div class="line">    pipe_mesg.new_frame = new_frame;</div>
<div class="line">    pipe_mesg.last_desc = last_desc;</div>
<div class="line">    pipe_mesg.tile_num = (bs_info.tile_num ? bs_info.tile_num : 1);</div>
<div class="line">    pipe_mesg.stop = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_statistics_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (write_pipe(buf, STATISTICS_PIPE) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Failed to write message to do statistics thread:\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//check if it&#39;s a stream end null frame indicator</span></div>
<div class="line">    <span class="keywordflow">if</span> (bs_info.stream_end) {</div>
<div class="line">        end_of_stream[stream_id] = 1;</div>
<div class="line">        deinit_stream_files(stream_id);</div>
<div class="line">        <span class="keywordflow">goto</span> write_stream_exit;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (update_files_data(&amp;bs_info, new_session) &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;update files data failed \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -2;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//check and update session file handle</span></div>
<div class="line">    <span class="keywordflow">if</span> (check_session_file_handle(&amp;bs_info, new_session) &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;check session file handle failed \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -3;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (frame_info_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (write_frame_info(&amp;bs_info) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;write video frame info failed for stream %d, session id = %d.\n&quot;</span>,</div>
<div class="line">                stream_id, bs_info.session_id);</div>
<div class="line">            <span class="keywordflow">return</span> -5;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//write echo tile into file if file is still opened</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; slice_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a4e04f3eb60d24e83a45c6bbbc1ced648">tile_num</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (write_video_file(stream_id, slice_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a7d4dd0e7496c6f3e469cbdd595d5c316">stream_type</a>, slice_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a507231e36ac5c9ce5b57c2b5a6f1bc9c">data_addr_offset</a>[i], slice_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html#a6f853631f16dc3e7643488091f5a083f">size</a>[i], !i) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;write video file failed for stream %d, session id = %d \n&quot;</span>,</div>
<div class="line">                stream_id, bs_info.session_id);</div>
<div class="line">            <span class="keywordflow">return</span> -4;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//update global statistics</span></div>
<div class="line">    <span class="keywordflow">if</span> (total_frames &amp;&amp; new_frame)</div>
<div class="line">        *total_frames = (*total_frames) + 1;</div>
<div class="line">    <span class="keywordflow">if</span> (total_bytes)</div>
<div class="line">        *total_bytes = (*total_bytes) + bs_info.size;</div>
<div class="line"> </div>
<div class="line">write_stream_exit:</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> show_waiting(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">    #define DOT_MAX_COUNT 10</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> dot_count = DOT_MAX_COUNT;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dot_count &lt; DOT_MAX_COUNT) {</div>
<div class="line">        fprintf(stdout, <span class="stringliteral">&quot;.&quot;</span>);   <span class="comment">//print a dot to indicate it&#39;s alive</span></div>
<div class="line">        dot_count++;</div>
<div class="line">    } <span class="keywordflow">else</span>{</div>
<div class="line">        fprintf(stdout, <span class="stringliteral">&quot;\r&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> ( i = 0; i &lt; 80 ; i++)</div>
<div class="line">            fprintf(stdout, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        fprintf(stdout, <span class="stringliteral">&quot;\r&quot;</span>);</div>
<div class="line">        dot_count = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    fflush(stdout);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> capture_encoded_video()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval;</div>
<div class="line">    <span class="comment">//open file handles to write to</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_frames;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_bytes;</div>
<div class="line">    total_frames = 0;</div>
<div class="line">    total_bytes =  0;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef ENABLE_RT_SCHED</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span>sched_param param;</div>
<div class="line">        param.sched_priority = 99;</div>
<div class="line">        <span class="keywordflow">if</span> (sched_setscheduler(0, SCHED_FIFO, &amp;param) &lt; 0)</div>
<div class="line">            perror(<span class="stringliteral">&quot;sched_setscheduler&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">while</span> (write_video_file_run) {</div>
<div class="line">        <span class="keywordflow">if</span> (!capture_slice) {</div>
<div class="line">            rval = write_stream(&amp;total_frames, &amp;total_bytes);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            rval = write_stream_slice(&amp;total_frames, &amp;total_bytes);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (rval == -1) {</div>
<div class="line">                usleep(100 * 1000);</div>
<div class="line">                show_waiting();</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;write_stream err code %d \n&quot;</span>, rval);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>(md5_idr_number == 0) {</div>
<div class="line">            md5_idr_number = -1;</div>
<div class="line">            statistics_run = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;stop encoded stream capture\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;total_frames = %lld\n&quot;</span>, total_frames);</div>
<div class="line">    printf(<span class="stringliteral">&quot;total_bytes = %lld\n&quot;</span>, total_bytes);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_transfer(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, do_init, rtn = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_ENCODE_STREAM_NUM; i++) {</div>
<div class="line">        do_init = 0;</div>
<div class="line">        <span class="keywordflow">switch</span> (stream_transfer[i].method) {</div>
<div class="line">        <span class="keywordflow">case</span> TRANS_METHOD_NONE:</div>
<div class="line">            <span class="keywordflow">if</span> (init_none == 0)</div>
<div class="line">                do_init = init_none = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> TRANS_METHOD_NFS:</div>
<div class="line">            <span class="keywordflow">if</span> (init_nfs == 0)</div>
<div class="line">                do_init = init_nfs = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> TRANS_METHOD_TCP:</div>
<div class="line">            <span class="keywordflow">if</span> (init_tcp == 0)</div>
<div class="line">                do_init = init_tcp = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> TRANS_METHOD_STDOUT:</div>
<div class="line">            <span class="keywordflow">if</span> (init_stdout == 0)</div>
<div class="line">                do_init = init_stdout = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (do_init)</div>
<div class="line">            rtn = amba_transfer_init(stream_transfer[i].method);</div>
<div class="line">        <span class="keywordflow">if</span> (rtn &lt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> deinit_transfer(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (init_none &gt; 0)</div>
<div class="line">        init_none = amba_transfer_deinit(TRANS_METHOD_NONE);</div>
<div class="line">    <span class="keywordflow">if</span> (init_nfs &gt; 0)</div>
<div class="line">        init_nfs = amba_transfer_deinit(TRANS_METHOD_NFS);</div>
<div class="line">    <span class="keywordflow">if</span> (init_tcp &gt; 0)</div>
<div class="line">        init_tcp = amba_transfer_deinit(TRANS_METHOD_TCP);</div>
<div class="line">    <span class="keywordflow">if</span> (init_stdout)</div>
<div class="line">        init_stdout = amba_transfer_deinit(TRANS_METHOD_STDOUT);</div>
<div class="line">    <span class="keywordflow">if</span> (init_none &lt; 0 || init_nfs &lt; 0 || init_tcp &lt; 0 || init_usb &lt; 0 || init_stdout &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sigstop()</div>
<div class="line">{</div>
<div class="line">    statistics_run = 0;</div>
<div class="line">    dram_test_run = 0;</div>
<div class="line">    write_video_file_run = 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> stop_statistics()</div>
<div class="line">{</div>
<div class="line">    pipe_mesg_t msg;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;msg, 0, <span class="keyword">sizeof</span>(msg));</div>
<div class="line">    msg.stop = 1;</div>
<div class="line">    printf(<span class="stringliteral">&quot;Sending stop statistics message!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (write(statistics_pipefd[1], &amp;msg, <span class="keyword">sizeof</span>(msg)) != <span class="keyword">sizeof</span>(msg)) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to send stop message to statistics thread: %s!\n&quot;</span>, strerror(errno));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (statistics_pipefd[1] &gt;= 0) {</div>
<div class="line">        close(statistics_pipefd[1]);</div>
<div class="line">        statistics_pipefd[1] = -1;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> stop_dram_test()</div>
<div class="line">{</div>
<div class="line">    pipe_mesg_t msg;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;msg, 0, <span class="keyword">sizeof</span>(msg));</div>
<div class="line">    msg.stop = 1;</div>
<div class="line">    printf(<span class="stringliteral">&quot;Sending stop dram test message!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (write(dram_test_pipefd[1], &amp;msg, <span class="keyword">sizeof</span>(msg)) != <span class="keyword">sizeof</span>(msg)) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to send stop message to dram test thread: %s!\n&quot;</span>, strerror(errno));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (dram_test_pipefd[1] &gt;= 0) {</div>
<div class="line">        close(dram_test_pipefd[1]);</div>
<div class="line">        dram_test_pipefd[1] = -1;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> map_bsb(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a172" name="_a172"></a><a class="code hl_structRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a> query_mem = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a173" name="_a173"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a> *part_info = NULL;</div>
<div class="line"> </div>
<div class="line">    query_mem.<a id="a174" name="a174"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">mid</a> = <a id="a175" name="a175"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a>;</div>
<div class="line">    part_info = &amp;query_mem.<a id="a176" name="a176"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">arg</a>.<a id="a177" name="a177"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">partition</a>;</div>
<div class="line">    part_info-&gt;<a id="a178" name="a178"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = <a id="a179" name="a179"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa09de9a53727022c18429db179a1d1ead">IAV_PART_BSB</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a180" name="a180"></a>IAV_IOC_QUERY_MEMBLOCK, &amp;query_mem) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_MEMBLOCK&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (part_info-&gt;<a id="a181" name="a181"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a182" name="a182"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a> == 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;IAV_PART_BSB is not allocated.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    bsb_size = part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    bsb_mem = mmap(NULL, bsb_size * 2, PROT_READ, MAP_SHARED, fd_iav,</div>
<div class="line">        part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a183" name="a183"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (bsb_mem == MAP_FAILED) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;mmap (%d) failed: %s\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;bsb_mem = %p, size = 0x%x\n&quot;</span>, bsb_mem, bsb_size);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a184" name="a184"></a><a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keywordtype">int</span> err = 0;</div>
<div class="line">    pthread_t statistics_tid;</div>
<div class="line">    pthread_t dram_test_tid;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//register signal handler for Ctrl+C,  Ctrl+&#39;\&#39;  ,  and &quot;kill&quot; sys cmd</span></div>
<div class="line">    signal(SIGINT, sigstop);</div>
<div class="line">    signal(SIGQUIT, sigstop);</div>
<div class="line">    signal(SIGTERM, sigstop);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> ((fd_iav = open(<span class="stringliteral">&quot;/dev/iav&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;/dev/iav&quot;</span>);</div>
<div class="line">            ret = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">            usage();</div>
<div class="line">            ret = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (init_param(argc, argv) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;init param failed \n&quot;</span>);</div>
<div class="line">            ret = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (map_bsb() &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;map bsb failed\n&quot;</span>);</div>
<div class="line">            ret = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (init_data() &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;data initiation failed!\n&quot;</span>);</div>
<div class="line">            ret = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (init_transfer() &lt; 0) {</div>
<div class="line">            ret = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (pipe(statistics_pipefd) &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Do statistics pipe create error!\n&quot;</span>);</div>
<div class="line">            ret = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (do_statistics_flag) {</div>
<div class="line">            fcntl(statistics_pipefd[1], F_SETFL, O_NONBLOCK);</div>
<div class="line"> </div>
<div class="line">            err = pthread_create(&amp;statistics_tid, NULL, do_statistics, NULL);</div>
<div class="line">            <span class="keywordflow">if</span> (err != 0) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;can&#39;t create do statistics thread: %s\n&quot;</span>, strerror(err));</div>
<div class="line">                ret = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (do_dram_test_flag) {</div>
<div class="line">            <span class="keywordflow">if</span> (pipe(dram_test_pipefd) &lt; 0) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Dram test pipefd create error!\n&quot;</span>);</div>
<div class="line">                ret = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            fcntl(dram_test_pipefd[1], F_SETFL, O_NONBLOCK);</div>
<div class="line"> </div>
<div class="line">            err = pthread_create(&amp;dram_test_tid, NULL, dram_test, NULL);</div>
<div class="line">            <span class="keywordflow">if</span> (err != 0) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;can&#39;t create dram test thread: %s\n&quot;</span>, strerror(err));</div>
<div class="line">                ret = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }<span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ret == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (capture_encoded_video() &lt; 0) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;capture encoded video failed \n&quot;</span>);</div>
<div class="line">            ret = -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (do_statistics_flag) {</div>
<div class="line">            stop_statistics();</div>
<div class="line">            pthread_join(statistics_tid, NULL);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (do_dram_test_flag) {</div>
<div class="line">            stop_dram_test();</div>
<div class="line">            pthread_join(dram_test_tid, NULL);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (deinit_transfer() &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;deinit_transfer failed.\n&quot;</span>);</div>
<div class="line">        ret = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    deinit_stream_files(-1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fd_iav) {</div>
<div class="line">        close(fd_iav);</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> errno;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="ttc" id="aasf__structure_8h_html_a92c50087ca0e64fa93fc59402c55f8ca"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></div><div class="ttdeci">uint8_t u8</div></div>
<div class="ttc" id="aasf__structure_8h_html_ace9d960e74685e2cd84b36132dbbf8aa"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a></div><div class="ttdeci">uint16_t u16</div></div>
<div class="ttc" id="aasf__structure_8h_html_ad758b7a5c3f18ed79d2fcd23d9f16357"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a></div><div class="ttdeci">unsigned long long u64</div></div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div></div>
<div class="ttc" id="abasetypes_8h_html"><div class="ttname"><a href="../../de/ddc/basetypes_8h.html">basetypes.h</a></div><div class="ttdoc">This file defines basic types used in all IAV driver and header files.</div></div>
<div class="ttc" id="acJSON_8h_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div></div>
<div class="ttc" id="acJSON_8h_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a></div><div class="ttdeci">int count</div></div>
<div class="ttc" id="acJSON_8h_html_adb411a44855a4c49231d72a0fc9a3b3b"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div><div class="ttdeci">char const int const cJSON_bool format</div></div>
<div class="ttc" id="adummy_html"><div class="ttname"><a href="../../dummy.html">IAV_HEVC_TILE_NUM</a></div><div class="ttdeci">#define IAV_HEVC_TILE_NUM</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ga5a8457a3780c3eb2c9452cae958284e4"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ga5a8457a3780c3eb2c9452cae958284e4">iav_stream_state</a></div><div class="ttdeci">iav_stream_state</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gaedee632d62ec29c16717d808e9bd406e"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gaedee632d62ec29c16717d808e9bd406e">iav_stream_type</a></div><div class="ttdeci">iav_stream_type</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a></div><div class="ttdeci">DSP_CURRENT_MODE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a></div><div class="ttdeci">IAV_INFO_STREAM</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172a05a4e65f2c13698887b00b1c3ecc78f9"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a05a4e65f2c13698887b00b1c3ecc78f9">IAV_DESC_FRAME</a></div><div class="ttdeci">IAV_DESC_FRAME</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172ab3398b978d51349610903adcb8d5cd43"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ab3398b978d51349610903adcb8d5cd43">IAV_DESC_SLICE</a></div><div class="ttdeci">IAV_DESC_SLICE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a16e25b1a43f33b685bd92c23a5498313"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a16e25b1a43f33b685bd92c23a5498313">IAV_H265_CFG_FORCE_PSKIP</a></div><div class="ttdeci">IAV_H265_CFG_FORCE_PSKIP</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a1c861139c2cef5211143f5f2f509c027"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a1c861139c2cef5211143f5f2f509c027">IAV_H265_CFG_SLICE</a></div><div class="ttdeci">IAV_H265_CFG_SLICE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a294a490bc0db886648066a429843f11d"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a294a490bc0db886648066a429843f11d">IAV_H264_CFG_RC_STRATEGY</a></div><div class="ttdeci">IAV_H264_CFG_RC_STRATEGY</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a2b9fe74b62bd1be476523cc882f41751"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a2b9fe74b62bd1be476523cc882f41751">IAV_H265_CFG_FRAME_DROP</a></div><div class="ttdeci">IAV_H265_CFG_FRAME_DROP</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a2c2e5c9b15a2a2ec7d77fde507b19170"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a2c2e5c9b15a2a2ec7d77fde507b19170">IAV_H264_CFG_FRAME_DROP</a></div><div class="ttdeci">IAV_H264_CFG_FRAME_DROP</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a657404d7e52519f904523208473f6d77"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a657404d7e52519f904523208473f6d77">IAV_MJPEG_CFG_QUALITY</a></div><div class="ttdeci">IAV_MJPEG_CFG_QUALITY</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a7b301a723e47fd9588a2b996a56ddc30"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a7b301a723e47fd9588a2b996a56ddc30">IAV_STMCFG_DUMMY_LATENCY</a></div><div class="ttdeci">IAV_STMCFG_DUMMY_LATENCY</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a7fe661c2cfead266c1bde3dcab4ae243"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a7fe661c2cfead266c1bde3dcab4ae243">IAV_H264_CFG_SAR</a></div><div class="ttdeci">IAV_H264_CFG_SAR</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a802152f5e08b1e008e5079b765033e02"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a802152f5e08b1e008e5079b765033e02">IAV_H264_CFG_BITRATE</a></div><div class="ttdeci">IAV_H264_CFG_BITRATE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a82801dcd55b3c1d8dc211b5bd98001de"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a82801dcd55b3c1d8dc211b5bd98001de">IAV_H265_CFG_RC_STRATEGY</a></div><div class="ttdeci">IAV_H265_CFG_RC_STRATEGY</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a8a1cb91b534e9b04eb833c6c65f707be"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a8a1cb91b534e9b04eb833c6c65f707be">IAV_H264_CFG_FORCE_PSKIP</a></div><div class="ttdeci">IAV_H264_CFG_FORCE_PSKIP</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48">IAV_STMCFG_FORMAT</a></div><div class="ttdeci">IAV_STMCFG_FORMAT</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108aaf0f9821638d4718ee7a88fc84446ec9"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108aaf0f9821638d4718ee7a88fc84446ec9">IAV_H265_CFG_SAR</a></div><div class="ttdeci">IAV_H265_CFG_SAR</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108ad538c0019ebda9e6b5046fd09b716252"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108ad538c0019ebda9e6b5046fd09b716252">IAV_STMCFG_FPS</a></div><div class="ttdeci">IAV_STMCFG_FPS</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108adbfa334a65db4fdfd1992100f715cca1"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108adbfa334a65db4fdfd1992100f715cca1">IAV_H265_CFG_BITRATE</a></div><div class="ttdeci">IAV_H265_CFG_BITRATE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108afae12a633e5626bf4deb1e402c98ae4f"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108afae12a633e5626bf4deb1e402c98ae4f">IAV_H264_CFG_SLICE</a></div><div class="ttdeci">IAV_H264_CFG_SLICE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga5a8457a3780c3eb2c9452cae958284e4a0ce04427b3d31f342fd4987c24061396"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a0ce04427b3d31f342fd4987c24061396">IAV_STREAM_STATE_IDLE</a></div><div class="ttdeci">IAV_STREAM_STATE_IDLE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga5a8457a3780c3eb2c9452cae958284e4a3aec28928ac385094ced7c84be9635b2"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a3aec28928ac385094ced7c84be9635b2">IAV_STREAM_STATE_UNKNOWN</a></div><div class="ttdeci">IAV_STREAM_STATE_UNKNOWN</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga5a8457a3780c3eb2c9452cae958284e4a41fdd0209762b605c1db4b133d3f1b31"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a41fdd0209762b605c1db4b133d3f1b31">IAV_STREAM_STATE_STOPPING</a></div><div class="ttdeci">IAV_STREAM_STATE_STOPPING</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d">IAV_STREAM_STATE_ENCODING</a></div><div class="ttdeci">IAV_STREAM_STATE_ENCODING</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga5a8457a3780c3eb2c9452cae958284e4a6e9d926f59102b9563a722581c65ee55"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a6e9d926f59102b9563a722581c65ee55">IAV_STREAM_STATE_STARTING</a></div><div class="ttdeci">IAV_STREAM_STATE_STARTING</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga68d3c468f240c5ea85764670809e8e1da749352c49cd3ba3c92e88d03df29e00a"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1da749352c49cd3ba3c92e88d03df29e00a">IAV_GOP_FAST_SEEK_2_REF</a></div><div class="ttdeci">IAV_GOP_FAST_SEEK_2_REF</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga68d3c468f240c5ea85764670809e8e1dabcda486fd1bd17486ac5a8a69b2deb02"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dabcda486fd1bd17486ac5a8a69b2deb02">IAV_GOP_SVCT_3</a></div><div class="ttdeci">IAV_GOP_SVCT_3</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga68d3c468f240c5ea85764670809e8e1dac305b34a7279e93d3e9d2721dbf39281"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dac305b34a7279e93d3e9d2721dbf39281">IAV_GOP_FAST_SEEK</a></div><div class="ttdeci">IAV_GOP_FAST_SEEK</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga68d3c468f240c5ea85764670809e8e1dad97263704dbbce0ea199aab14ee5e917"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dad97263704dbbce0ea199aab14ee5e917">IAV_GOP_SVCT_4</a></div><div class="ttdeci">IAV_GOP_SVCT_4</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga68d3c468f240c5ea85764670809e8e1dae60af67c61f60828c084a2744ed39f09"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga68d3c468f240c5ea85764670809e8e1dae60af67c61f60828c084a2744ed39f09">IAV_GOP_SVCT_2</a></div><div class="ttdeci">IAV_GOP_SVCT_2</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga7bafc03a2ffa35c1b91ad8cdb44efc2ea1887e47b13a6d1166f8a0d665bafcb61"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga7bafc03a2ffa35c1b91ad8cdb44efc2ea1887e47b13a6d1166f8a0d665bafcb61">NT_IDR</a></div><div class="ttdeci">NT_IDR</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga7bafc03a2ffa35c1b91ad8cdb44efc2ead644b697b278645ada0f8d9aa5bf9274"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga7bafc03a2ffa35c1b91ad8cdb44efc2ead644b697b278645ada0f8d9aa5bf9274">NT_NON_IDR</a></div><div class="ttdeci">NT_NON_IDR</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga84627a72058502328269676b81780f89ae7e98a4c667f61d6e8a90d4bc9b8a849"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga84627a72058502328269676b81780f89ae7e98a4c667f61d6e8a90d4bc9b8a849">IAV_ONE_BITS_INFO_PER_FRAME</a></div><div class="ttdeci">IAV_ONE_BITS_INFO_PER_FRAME</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga84627a72058502328269676b81780f89aeb22a4b43946af85900ae58b30a3c3d6"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga84627a72058502328269676b81780f89aeb22a4b43946af85900ae58b30a3c3d6">IAV_ONE_BITS_INFO_PER_TILE</a></div><div class="ttdeci">IAV_ONE_BITS_INFO_PER_TILE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggae5f9963aa2058cffa863f2af34a846c1a2e89e1419404c1abcbe5af45c6bd28a5"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a2e89e1419404c1abcbe5af45c6bd28a5">IAV_PIC_TYPE_P_FRAME</a></div><div class="ttdeci">IAV_PIC_TYPE_P_FRAME</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggae5f9963aa2058cffa863f2af34a846c1a5023438b86660d10ddf54eb8498ee45f"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a5023438b86660d10ddf54eb8498ee45f">IAV_PIC_TYPE_MJPEG_FRAME</a></div><div class="ttdeci">IAV_PIC_TYPE_MJPEG_FRAME</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggae5f9963aa2058cffa863f2af34a846c1a74797e81bd4c546577ca0f3588e5c865"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a74797e81bd4c546577ca0f3588e5c865">IAV_PIC_TYPE_B_FRAME</a></div><div class="ttdeci">IAV_PIC_TYPE_B_FRAME</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggae5f9963aa2058cffa863f2af34a846c1a7d85c038f6df51d23fc7f9397400b54f"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1a7d85c038f6df51d23fc7f9397400b54f">IAV_PIC_TYPE_IDR_FRAME</a></div><div class="ttdeci">IAV_PIC_TYPE_IDR_FRAME</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggae5f9963aa2058cffa863f2af34a846c1af4f413b58ae4c91d50856a73fd7c4de2"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggae5f9963aa2058cffa863f2af34a846c1af4f413b58ae4c91d50856a73fd7c4de2">IAV_PIC_TYPE_I_FRAME</a></div><div class="ttdeci">IAV_PIC_TYPE_I_FRAME</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaedee632d62ec29c16717d808e9bd406ea04c04080b42594c20a682e29c58aeea2"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea04c04080b42594c20a682e29c58aeea2">IAV_STREAM_TYPE_INVALID</a></div><div class="ttdeci">IAV_STREAM_TYPE_INVALID</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ea7e4ce314afad3eff36d815c5a95df277">IAV_STREAM_TYPE_H264</a></div><div class="ttdeci">IAV_STREAM_TYPE_H264</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a></div><div class="ttdeci">IAV_STREAM_TYPE_H265</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaedee632d62ec29c16717d808e9bd406ead2feabb75221806525afe5d4bc053431"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ead2feabb75221806525afe5d4bc053431">IAV_STREAM_TYPE_MJPEG</a></div><div class="ttdeci">IAV_STREAM_TYPE_MJPEG</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaf270e2154242c10302df5fca9c62b356a19e1baeeb99a0aaceedaa5c517293085"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaf270e2154242c10302df5fca9c62b356a19e1baeeb99a0aaceedaa5c517293085">TSA_N</a></div><div class="ttdeci">TSA_N</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaf270e2154242c10302df5fca9c62b356a6c2bcf48369ea9b0cb82a53ac5bff888"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaf270e2154242c10302df5fca9c62b356a6c2bcf48369ea9b0cb82a53ac5bff888">TRAIL_R</a></div><div class="ttdeci">TRAIL_R</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaf270e2154242c10302df5fca9c62b356a8412c81ff02a79b6437834541a134a15"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaf270e2154242c10302df5fca9c62b356a8412c81ff02a79b6437834541a134a15">IDR_W_RADL</a></div><div class="ttdeci">IDR_W_RADL</div></div>
<div class="ttc" id="agroup__iav-typedef_html_ga10e94b422ef0c20dcdec20d31a1f5049"><div class="ttname"><a href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a></div><div class="ttdeci">unsigned int u32</div><div class="ttdef"><b>Definition:</b> basetypes.h:53</div></div>
<div class="ttc" id="agroup__iav-typedef_html_gad758b7a5c3f18ed79d2fcd23d9f16357"><div class="ttname"><a href="../../d0/dfa/group__iav-typedef.html#gad758b7a5c3f18ed79d2fcd23d9f16357">u64</a></div><div class="ttdeci">unsigned long long u64</div><div class="ttdef"><b>Definition:</b> basetypes.h:54</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa09de9a53727022c18429db179a1d1ead"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa09de9a53727022c18429db179a1d1ead">IAV_PART_BSB</a></div><div class="ttdeci">IAV_PART_BSB</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a></div><div class="ttdeci">IAV_MEM_PARTITION</div></div>
<div class="ttc" id="astream__cfg_8c_html_aaf0da9064aaa6054cae10d4cab6884cd"><div class="ttname"><a href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a></div><div class="ttdeci">#define VERIFY_STREAMID(x)</div></div>
<div class="ttc" id="astructiav__bitrate_html"><div class="ttname"><a href="../../../library/df/d72/structiav__bitrate.html">iav_bitrate</a></div></div>
<div class="ttc" id="astructiav__chan__cfg_html"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a></div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a124a81574b0fbd3d1e60e2917e5ecefe"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">iav_chan_cfg::vsrc_id</a></div><div class="ttdeci">u32 vsrc_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1315</div></div>
<div class="ttc" id="astructiav__framedesc_html"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html">iav_framedesc</a></div></div>
<div class="ttc" id="astructiav__framedesc_html_a16f01e9ac75392f8e05471ead76a95ae"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a16f01e9ac75392f8e05471ead76a95ae">iav_framedesc::data_addr_offset</a></div><div class="ttdeci">unsigned long data_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2004</div></div>
<div class="ttc" id="astructiav__framedesc_html_a1e7fcc7abfd391fd12e9c44105b3121d"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a1e7fcc7abfd391fd12e9c44105b3121d">iav_framedesc::stream_end</a></div><div class="ttdeci">u32 stream_end</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1986</div></div>
<div class="ttc" id="astructiav__framedesc_html_a307e65ffd58b067088b9f00cbd9ca09c"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a307e65ffd58b067088b9f00cbd9ca09c">iav_framedesc::slice_num</a></div><div class="ttdeci">u32 slice_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1994</div></div>
<div class="ttc" id="astructiav__framedesc_html_a4e04f3eb60d24e83a45c6bbbc1ced648"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a4e04f3eb60d24e83a45c6bbbc1ced648">iav_framedesc::tile_num</a></div><div class="ttdeci">u32 tile_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1996</div></div>
<div class="ttc" id="astructiav__framedesc_html_a51f963a9e798d29347ed1ea9c882ebfb"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a51f963a9e798d29347ed1ea9c882ebfb">iav_framedesc::encoded_frame_num</a></div><div class="ttdeci">u16 encoded_frame_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2008</div></div>
<div class="ttc" id="astructiav__framedesc_html_a583019aeb8f4f128724193f32ab7c9ec"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a583019aeb8f4f128724193f32ab7c9ec">iav_framedesc::tile_id</a></div><div class="ttdeci">u32 tile_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1995</div></div>
<div class="ttc" id="astructiav__framedesc_html_a6fcb833e69f93194b065f17833611869"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a6fcb833e69f93194b065f17833611869">iav_framedesc::enc_done_ts</a></div><div class="ttdeci">u64 enc_done_ts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2002</div></div>
<div class="ttc" id="astructiav__framedesc_html_a76f8ba65ce8f902c0657233adee58698"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a76f8ba65ce8f902c0657233adee58698">iav_framedesc::id</a></div><div class="ttdeci">u32 id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1982</div></div>
<div class="ttc" id="astructiav__framedesc_html_a7d4dd0e7496c6f3e469cbdd595d5c316"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a7d4dd0e7496c6f3e469cbdd595d5c316">iav_framedesc::stream_type</a></div><div class="ttdeci">enum iav_stream_type stream_type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1984</div></div>
<div class="ttc" id="astructiav__framedesc_html_a82da34339e47d843675a923db70727d9"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a82da34339e47d843675a923db70727d9">iav_framedesc::dsp_pts</a></div><div class="ttdeci">u64 dsp_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2001</div></div>
<div class="ttc" id="astructiav__framedesc_html_a8f3e1c561bace8d5100de02177ce0c3a"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#a8f3e1c561bace8d5100de02177ce0c3a">iav_framedesc::frame_num</a></div><div class="ttdeci">u64 frame_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2009</div></div>
<div class="ttc" id="astructiav__framedesc_html_acdcae461112d36f391aa2ab38fa574f2"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#acdcae461112d36f391aa2ab38fa574f2">iav_framedesc::arm_pts</a></div><div class="ttdeci">u64 arm_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2000</div></div>
<div class="ttc" id="astructiav__framedesc_html_acfd6273064c5acdcfc39a23a69dd4343"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#acfd6273064c5acdcfc39a23a69dd4343">iav_framedesc::size</a></div><div class="ttdeci">u32 size</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1992</div></div>
<div class="ttc" id="astructiav__framedesc_html_ad7fac670f30ba59aece395f5b2728af7"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#ad7fac670f30ba59aece395f5b2728af7">iav_framedesc::pic_type</a></div><div class="ttdeci">u32 pic_type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1985</div></div>
<div class="ttc" id="astructiav__framedesc_html_adbeafb6e77f9524829e5a8d3478f40fd"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#adbeafb6e77f9524829e5a8d3478f40fd">iav_framedesc::slice_id</a></div><div class="ttdeci">u32 slice_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1993</div></div>
<div class="ttc" id="astructiav__framedesc_html_ae3bf418630bbc93c57fa8a63032f9ca5"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#ae3bf418630bbc93c57fa8a63032f9ca5">iav_framedesc::reso</a></div><div class="ttdeci">struct iav_window reso</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2003</div></div>
<div class="ttc" id="astructiav__framedesc_html_ae5401bda5cc0670b055c52f088f2f3be"><div class="ttname"><a href="../../../library/d9/d2b/structiav__framedesc.html#ae5401bda5cc0670b055c52f088f2f3be">iav_framedesc::session_id</a></div><div class="ttdeci">u32 session_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1991</div></div>
<div class="ttc" id="astructiav__h26x__cfg_html"><div class="ttname"><a href="../../../library/d9/d64/structiav__h26x__cfg.html">iav_h26x_cfg</a></div></div>
<div class="ttc" id="astructiav__h26x__cfg_html_a76f8ba65ce8f902c0657233adee58698"><div class="ttname"><a href="../../../library/d9/d64/structiav__h26x__cfg.html#a76f8ba65ce8f902c0657233adee58698">iav_h26x_cfg::id</a></div><div class="ttdeci">u32 id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3189</div></div>
<div class="ttc" id="astructiav__h26x__cfg_html_a7d5e8cb94d471b621201386d893b5cd8"><div class="ttname"><a href="../../../library/d9/d64/structiav__h26x__cfg.html#a7d5e8cb94d471b621201386d893b5cd8">iav_h26x_cfg::gop_structure</a></div><div class="ttdeci">u32 gop_structure</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3190</div></div>
<div class="ttc" id="astructiav__h26x__cfg_html_a97d5655c88679af34a6e53b41d801984"><div class="ttname"><a href="../../../library/d9/d64/structiav__h26x__cfg.html#a97d5655c88679af34a6e53b41d801984">iav_h26x_cfg::fast_seek_intvl</a></div><div class="ttdeci">u32 fast_seek_intvl</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3234</div></div>
<div class="ttc" id="astructiav__h26x__drop__frame_html"><div class="ttname"><a href="../../../library/d7/d16/structiav__h26x__drop__frame.html">iav_h26x_drop_frame</a></div></div>
<div class="ttc" id="astructiav__h26x__pskip_html"><div class="ttname"><a href="../../../library/d1/d7c/structiav__h26x__pskip.html">iav_h26x_pskip</a></div></div>
<div class="ttc" id="astructiav__h26x__sar_html_a54a5949a9c526a25f7f552ee1965914e"><div class="ttname"><a href="../../../library/de/d50/structiav__h26x__sar.html#a54a5949a9c526a25f7f552ee1965914e">iav_h26x_sar::sar_width</a></div><div class="ttdeci">u16 sar_width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2803</div></div>
<div class="ttc" id="astructiav__h26x__sar_html_ac955bae308c67d9b59b89dc5a5c58806"><div class="ttname"><a href="../../../library/de/d50/structiav__h26x__sar.html#ac955bae308c67d9b59b89dc5a5c58806">iav_h26x_sar::sar_height</a></div><div class="ttdeci">u16 sar_height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2804</div></div>
<div class="ttc" id="astructiav__h26x__slice_html_a307e65ffd58b067088b9f00cbd9ca09c"><div class="ttname"><a href="../../../library/d1/d81/structiav__h26x__slice.html#a307e65ffd58b067088b9f00cbd9ca09c">iav_h26x_slice::slice_num</a></div><div class="ttdeci">u32 slice_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2754</div></div>
<div class="ttc" id="astructiav__h26x__slice_html_a54a0b889d81a72e959fe1091fe1b2363"><div class="ttname"><a href="../../../library/d1/d81/structiav__h26x__slice.html#a54a0b889d81a72e959fe1091fe1b2363">iav_h26x_slice::slices_per_info</a></div><div class="ttdeci">u32 slices_per_info</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2755</div></div>
<div class="ttc" id="astructiav__mem__info_html_a9ee64c7b918513891b3834b93ad0e501"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">iav_mem_info::length</a></div><div class="ttdeci">unsigned long length</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1842</div></div>
<div class="ttc" id="astructiav__mem__info_html_afde02ab53128286716345a7e3da30a7e"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">iav_mem_info::addr</a></div><div class="ttdeci">unsigned long addr</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1841</div></div>
<div class="ttc" id="astructiav__mem__part__info_html"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a></div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a189394c6bbc0d36422df8c5bc2ee1962"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">iav_mem_part_info::pid</a></div><div class="ttdeci">u32 pid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1847</div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a3bc6cd5f612ef6d8254970d363348350"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">iav_mem_part_info::mem</a></div><div class="ttdeci">struct iav_mem_info mem</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1848</div></div>
<div class="ttc" id="astructiav__mjpeg__cfg_html"><div class="ttname"><a href="../../../library/d7/d43/structiav__mjpeg__cfg.html">iav_mjpeg_cfg</a></div></div>
<div class="ttc" id="astructiav__querydesc_html"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a></div></div>
<div class="ttc" id="astructiav__queryinfo_html"><div class="ttname"><a href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a></div></div>
<div class="ttc" id="astructiav__querymem_html"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a></div></div>
<div class="ttc" id="astructiav__querymem_html_a01d475486b14a28a0583e09be9e66982"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">iav_querymem::partition</a></div><div class="ttdeci">struct iav_mem_part_info partition</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1925</div></div>
<div class="ttc" id="astructiav__querymem_html_a5955e20d0c53be1145cf813759d92d67"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">iav_querymem::arg</a></div><div class="ttdeci">union iav_querymem::@61 arg</div></div>
<div class="ttc" id="astructiav__querymem_html_ae056de5bb92261e7a28350beeb5320f8"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">iav_querymem::mid</a></div><div class="ttdeci">enum iav_mem_id mid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1923</div></div>
<div class="ttc" id="astructiav__rc__strategy_html_adadfc12688236f60b804d18f7cfa609a"><div class="ttname"><a href="../../../library/de/d11/structiav__rc__strategy.html#adadfc12688236f60b804d18f7cfa609a">iav_rc_strategy::abs_br_flag</a></div><div class="ttdeci">u32 abs_br_flag</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2664</div></div>
<div class="ttc" id="astructiav__slicedesc_html"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html">iav_slicedesc</a></div></div>
<div class="ttc" id="astructiav__slicedesc_html_a1e7fcc7abfd391fd12e9c44105b3121d"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a1e7fcc7abfd391fd12e9c44105b3121d">iav_slicedesc::stream_end</a></div><div class="ttdeci">u32 stream_end</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2018</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a2fcd84bb36c4623eb05c14c6c443c97f"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a2fcd84bb36c4623eb05c14c6c443c97f">iav_slicedesc::encoded_frame_num</a></div><div class="ttdeci">u32 encoded_frame_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2032</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a307e65ffd58b067088b9f00cbd9ca09c"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a307e65ffd58b067088b9f00cbd9ca09c">iav_slicedesc::slice_num</a></div><div class="ttdeci">u32 slice_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2029</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a4e04f3eb60d24e83a45c6bbbc1ced648"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a4e04f3eb60d24e83a45c6bbbc1ced648">iav_slicedesc::tile_num</a></div><div class="ttdeci">u32 tile_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2031</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a507231e36ac5c9ce5b57c2b5a6f1bc9c"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a507231e36ac5c9ce5b57c2b5a6f1bc9c">iav_slicedesc::data_addr_offset</a></div><div class="ttdeci">unsigned long data_addr_offset[IAV_HEVC_TILE_NUM]</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2034</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a583019aeb8f4f128724193f32ab7c9ec"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a583019aeb8f4f128724193f32ab7c9ec">iav_slicedesc::tile_id</a></div><div class="ttdeci">u32 tile_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2030</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a6f853631f16dc3e7643488091f5a083f"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a6f853631f16dc3e7643488091f5a083f">iav_slicedesc::size</a></div><div class="ttdeci">u32 size[IAV_HEVC_TILE_NUM]</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2033</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a6fcb833e69f93194b065f17833611869"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a6fcb833e69f93194b065f17833611869">iav_slicedesc::enc_done_ts</a></div><div class="ttdeci">u64 enc_done_ts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2026</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a76f8ba65ce8f902c0657233adee58698"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a76f8ba65ce8f902c0657233adee58698">iav_slicedesc::id</a></div><div class="ttdeci">u32 id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2014</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a7d4dd0e7496c6f3e469cbdd595d5c316"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a7d4dd0e7496c6f3e469cbdd595d5c316">iav_slicedesc::stream_type</a></div><div class="ttdeci">enum iav_stream_type stream_type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2016</div></div>
<div class="ttc" id="astructiav__slicedesc_html_a8f3e1c561bace8d5100de02177ce0c3a"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#a8f3e1c561bace8d5100de02177ce0c3a">iav_slicedesc::frame_num</a></div><div class="ttdeci">u64 frame_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2035</div></div>
<div class="ttc" id="astructiav__slicedesc_html_acdcae461112d36f391aa2ab38fa574f2"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#acdcae461112d36f391aa2ab38fa574f2">iav_slicedesc::arm_pts</a></div><div class="ttdeci">u64 arm_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2024</div></div>
<div class="ttc" id="astructiav__slicedesc_html_aceea0dbfe9e773672305060e6be34add"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#aceea0dbfe9e773672305060e6be34add">iav_slicedesc::bitrate_kbps</a></div><div class="ttdeci">u32 bitrate_kbps</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2021</div></div>
<div class="ttc" id="astructiav__slicedesc_html_ad7fac670f30ba59aece395f5b2728af7"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#ad7fac670f30ba59aece395f5b2728af7">iav_slicedesc::pic_type</a></div><div class="ttdeci">u32 pic_type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2017</div></div>
<div class="ttc" id="astructiav__slicedesc_html_adbeafb6e77f9524829e5a8d3478f40fd"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#adbeafb6e77f9524829e5a8d3478f40fd">iav_slicedesc::slice_id</a></div><div class="ttdeci">u32 slice_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2028</div></div>
<div class="ttc" id="astructiav__slicedesc_html_ae3bf418630bbc93c57fa8a63032f9ca5"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#ae3bf418630bbc93c57fa8a63032f9ca5">iav_slicedesc::reso</a></div><div class="ttdeci">struct iav_window reso</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2027</div></div>
<div class="ttc" id="astructiav__slicedesc_html_ae5401bda5cc0670b055c52f088f2f3be"><div class="ttname"><a href="../../../library/de/d90/structiav__slicedesc.html#ae5401bda5cc0670b055c52f088f2f3be">iav_slicedesc::session_id</a></div><div class="ttdeci">u32 session_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2023</div></div>
<div class="ttc" id="astructiav__stream__cfg_html"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a></div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a0308383d69855c752c8cc2b43db8728c"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a0308383d69855c752c8cc2b43db8728c">iav_stream_cfg::h264_drop_frame</a></div><div class="ttdeci">struct iav_h26x_drop_frame h264_drop_frame</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3139</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a17e386bedda299fc1b79dd4ad1921bac"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a17e386bedda299fc1b79dd4ad1921bac">iav_stream_cfg::h264_rc</a></div><div class="ttdeci">struct iav_bitrate h264_rc</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3133</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a22cc3e0e89273615164c352899598efb"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a22cc3e0e89273615164c352899598efb">iav_stream_cfg::h264_rc_strategy</a></div><div class="ttdeci">struct iav_rc_strategy h264_rc_strategy</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3134</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a24b75dd5c1c952bb423d2e086b7803d1"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a24b75dd5c1c952bb423d2e086b7803d1">iav_stream_cfg::arg</a></div><div class="ttdeci">union iav_stream_cfg::@81 arg</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a35ecc3fcbd933e5786be445572507dc1"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a35ecc3fcbd933e5786be445572507dc1">iav_stream_cfg::h264_slice</a></div><div class="ttdeci">struct iav_h26x_slice h264_slice</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3137</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a3639355167e1a58cc67cec02f9b62883"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a3639355167e1a58cc67cec02f9b62883">iav_stream_cfg::mjpeg_quality</a></div><div class="ttdeci">u32 mjpeg_quality</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3151</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a686049e2b2002a8e6ed9273aab87af06"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a686049e2b2002a8e6ed9273aab87af06">iav_stream_cfg::stream_dummy_latency</a></div><div class="ttdeci">u32 stream_dummy_latency</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3123</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a76f8ba65ce8f902c0657233adee58698"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a76f8ba65ce8f902c0657233adee58698">iav_stream_cfg::id</a></div><div class="ttdeci">u32 id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3116</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a7eb50103ead09f3fb04707fc18aaeada"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a7eb50103ead09f3fb04707fc18aaeada">iav_stream_cfg::h265_sar</a></div><div class="ttdeci">struct iav_h26x_sar h265_sar</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3171</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a8e95576e3516b67ed291094f9754c63a"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a8e95576e3516b67ed291094f9754c63a">iav_stream_cfg::h264_sar</a></div><div class="ttdeci">struct iav_h26x_sar h264_sar</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3147</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_a9687e1c733814030f16e3a1eb049c810"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#a9687e1c733814030f16e3a1eb049c810">iav_stream_cfg::h264_pskip</a></div><div class="ttdeci">struct iav_h26x_pskip h264_pskip</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3138</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_ae26e577bd0e72099de1a2fbaa6f01ae0"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#ae26e577bd0e72099de1a2fbaa6f01ae0">iav_stream_cfg::h265_slice</a></div><div class="ttdeci">struct iav_h26x_slice h265_slice</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3160</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_ae4192058027a558af30f8bdc85974807"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#ae4192058027a558af30f8bdc85974807">iav_stream_cfg::h265_rc</a></div><div class="ttdeci">struct iav_bitrate h265_rc</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3156</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_ae4802c4ca9395c40c04ee7df617c4d9f"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#ae4802c4ca9395c40c04ee7df617c4d9f">iav_stream_cfg::h265_pskip</a></div><div class="ttdeci">struct iav_h26x_pskip h265_pskip</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3161</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_af42f3bbb4c5c58d67865ed3e8b98c132"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#af42f3bbb4c5c58d67865ed3e8b98c132">iav_stream_cfg::h265_rc_strategy</a></div><div class="ttdeci">struct iav_rc_strategy h265_rc_strategy</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3157</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_af8a75e41c9129251d7a82658cf68b05c"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#af8a75e41c9129251d7a82658cf68b05c">iav_stream_cfg::h265_drop_frame</a></div><div class="ttdeci">struct iav_h26x_drop_frame h265_drop_frame</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3162</div></div>
<div class="ttc" id="astructiav__stream__cfg_html_afdc3860fa7139e471735ca9e51485c4c"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html#afdc3860fa7139e471735ca9e51485c4c">iav_stream_cfg::cid</a></div><div class="ttdeci">enum iav_streamcfg_id cid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3117</div></div>
<div class="ttc" id="astructiav__stream__format_html"><div class="ttname"><a href="../../../library/dd/d8d/structiav__stream__format.html">iav_stream_format</a></div></div>
<div class="ttc" id="astructiav__stream__info_html"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html">iav_stream_info</a></div></div>
<div class="ttc" id="astructiav__stream__info_html_a76f8ba65ce8f902c0657233adee58698"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html#a76f8ba65ce8f902c0657233adee58698">iav_stream_info::id</a></div><div class="ttdeci">u32 id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1075</div></div>
<div class="ttc" id="astructiav__stream__info_html_ac78453cf0c29f2b9c40cfb142185d7d9"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html#ac78453cf0c29f2b9c40cfb142185d7d9">iav_stream_info::state</a></div><div class="ttdeci">enum iav_stream_state state</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1076</div></div>
<div class="ttc" id="astructiav__system__resource_html"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a></div></div>
<div class="ttc" id="astructiav__system__resource_html_a87675bec1fc71ad0dd5cfbc714172dad"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html#a87675bec1fc71ad0dd5cfbc714172dad">iav_system_resource::enable_hp_fps</a></div><div class="ttdeci">u32 enable_hp_fps</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1260</div></div>
<div class="ttc" id="astructiav__system__resource_html_ab16f548b2c418aee70c310a931fdfab1"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html#ab16f548b2c418aee70c310a931fdfab1">iav_system_resource::encode_mode</a></div><div class="ttdeci">u8 encode_mode</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1238</div></div>
<div class="ttc" id="astructiav__window_html"><div class="ttname"><a href="../../dc/d76/structiav__window.html">iav_window</a></div><div class="ttdoc">IAV Window Size.</div><div class="ttdef"><b>Definition:</b> basetypes.h:95</div></div>
<div class="ttc" id="astructvindev__fps_html"><div class="ttname"><a href="../../../library/d8/d5f/structvindev__fps.html">vindev_fps</a></div></div>
<div class="ttc" id="astructvindev__fps_html_a0256d25b86a9f6d108e63e630fd20cf2"><div class="ttname"><a href="../../../library/d8/d5f/structvindev__fps.html#a0256d25b86a9f6d108e63e630fd20cf2">vindev_fps::fps</a></div><div class="ttdeci">unsigned int fps</div><div class="ttdef"><b>Definition:</b> iav_vin_common.h:525</div></div>
<div class="ttc" id="astructvindev__fps_html_aa1ecb62f419c3b454f5a2d4fd18d4818"><div class="ttname"><a href="../../../library/d8/d5f/structvindev__fps.html#aa1ecb62f419c3b454f5a2d4fd18d4818">vindev_fps::vsrc_id</a></div><div class="ttdeci">unsigned int vsrc_id</div><div class="ttdef"><b>Definition:</b> iav_vin_common.h:524</div></div>
<div class="ttc" id="atest__custom__sei_8h_html_a577d677ba3cecde91a6aa7b3f563ed13"><div class="ttname"><a href="../../../video/de/dd5/test__custom__sei_8h.html#a577d677ba3cecde91a6aa7b3f563ed13">BOLD_PRINT</a></div><div class="ttdeci">#define BOLD_PRINT(msg, arg...)</div></div>
<div class="ttc" id="atest__stream_8h_html"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html">test_stream.h</a></div></div>
<div class="ttc" id="atest__stream_8h_html_a8342bfd015dff2d669da85b8ae96e6ac"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#a8342bfd015dff2d669da85b8ae96e6ac">PRINT_CHARACTER_AMOUNT</a></div><div class="ttdeci">#define PRINT_CHARACTER_AMOUNT</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea001a55fbe6c86d020642d842e01b233c"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea001a55fbe6c86d020642d842e01b233c">SPLIT_SVCT_LAYER</a></div><div class="ttdeci">SPLIT_SVCT_LAYER</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea1ad6852ac8ab9104e11989e20b8616aa"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea1ad6852ac8ab9104e11989e20b8616aa">SHOW_AUDIO_CLOCK</a></div><div class="ttdeci">SHOW_AUDIO_CLOCK</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea21f6d86a4b26c0e1ccb78b1b7b1f5ddd"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea21f6d86a4b26c0e1ccb78b1b7b1f5ddd">SAVE_FRAME_INFO</a></div><div class="ttdeci">SAVE_FRAME_INFO</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea3482d1749c57f4d0ece54dd8737e8184"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea3482d1749c57f4d0ece54dd8737e8184">DRAM_TEST_METHOD</a></div><div class="ttdeci">DRAM_TEST_METHOD</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea3dc3b99435b29917ea9897a299e27150"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea3dc3b99435b29917ea9897a299e27150">HOST_IP_ADDR</a></div><div class="ttdeci">HOST_IP_ADDR</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea591222906b6218be78bc1a8814c836d7"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea591222906b6218be78bc1a8814c836d7">CHECK_PTS_INFO</a></div><div class="ttdeci">CHECK_PTS_INFO</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea637afe18583cff238d12c0522a692f50"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea637afe18583cff238d12c0522a692f50">NOFILE_TRANSER</a></div><div class="ttdeci">NOFILE_TRANSER</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea77e935819b3b2cc9bc87ccba8e7b1722"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea77e935819b3b2cc9bc87ccba8e7b1722">FILE_SIZE</a></div><div class="ttdeci">FILE_SIZE</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea8f825a034126d18b0a8ca85117df48fc"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea8f825a034126d18b0a8ca85117df48fc">TOTAL_FRAMES</a></div><div class="ttdeci">TOTAL_FRAMES</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea95763fbb86cde074e0aab8c840c28af8"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea95763fbb86cde074e0aab8c840c28af8">SHOW_PTS_INFO</a></div><div class="ttdeci">SHOW_PTS_INFO</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea988983b6caa6a345d87d0357ad9e5593"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea988983b6caa6a345d87d0357ad9e5593">SPLIT_FAST_SEEK</a></div><div class="ttdeci">SPLIT_FAST_SEEK</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeaab63096b334741d46f4182ae110c927b"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeaab63096b334741d46f4182ae110c927b">DRAM_TEST_ENABLE</a></div><div class="ttdeci">DRAM_TEST_ENABLE</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeab14ccfb4cce502857a618ad07098ea27"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeab14ccfb4cce502857a618ad07098ea27">REMOVE_TIME_STRING</a></div><div class="ttdeci">REMOVE_TIME_STRING</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeab936b39a1bdd0e57f1447ac19fa36c66"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeab936b39a1bdd0e57f1447ac19fa36c66">DRAM_TEST_STREAM_MAP</a></div><div class="ttdeci">DRAM_TEST_STREAM_MAP</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeabb865e0df690484fcd0ac460c9abbaac"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeabb865e0df690484fcd0ac460c9abbaac">STREAM_DIFF_FILE</a></div><div class="ttdeci">STREAM_DIFF_FILE</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeac845bd8136b5ab1741b9abccbf58aeac"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeac845bd8136b5ab1741b9abccbf58aeac">STATISTICS_ENABLE</a></div><div class="ttdeci">STATISTICS_ENABLE</div></div>
<div class="ttc" id="atest__stream_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeaf07a8bfb780c09b2f1786c427cb32010"><div class="ttname"><a href="../../../video/d9/d9a/test__stream_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeaf07a8bfb780c09b2f1786c427cb32010">TOTAL_SIZE</a></div><div class="ttdeci">TOTAL_SIZE</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
<div class="ttc" id="avin__init_8c_html_a5294002f7dca0cd9bcc0009a27895ef7"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a></div><div class="ttdeci">int fd_iav</div></div>
<div class="ttc" id="avout__init__cfg_8c_html_a88a5b93883c34229851d6a7a93254850"><div class="ttname"><a href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a></div><div class="ttdeci">#define AM_IOCTL(_filp, _cmd, _arg)</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
