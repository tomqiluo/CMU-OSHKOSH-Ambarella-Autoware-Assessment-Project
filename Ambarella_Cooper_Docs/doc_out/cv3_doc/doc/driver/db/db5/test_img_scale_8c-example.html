<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driver: test_img_scale.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Driver"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Driver<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('db/db5/test_img_scale_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test_img_scale.c</div></div>
</div><!--header-->
<div class="contents">
<p >This is an example of how to do arbitrary image scale.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * test_img_scale.c</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *    2021/12/22 - [Dingbin lu] created</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2021 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents ( &quot;Software&quot; ) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;termio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/ddc/basetypes_8h.html">basetypes.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iav_ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;datatx_lib.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NO_ARG          0</span></div>
<div class="line"><span class="preprocessor">#define HAS_ARG         1</span></div>
<div class="line"><span class="preprocessor">#define BOLD_PRINT(msg, arg...)     printf(&quot;\033[1m&quot;</span>msg&quot;\033[22m&quot;, arg)</div>
<div class="line"><span class="preprocessor">#define BOLD_PRINT0(msg, arg...)        printf(&quot;\033[1m&quot;</span>msg&quot;\033[22m&quot;)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef AM_IOCTL</span></div>
<div class="line"><span class="preprocessor">#define AM_IOCTL(_filp, _cmd, _arg) \</span></div>
<div class="line"><span class="preprocessor">        do {                        \</span></div>
<div class="line"><span class="preprocessor">            if (ioctl(_filp, _cmd, _arg) &lt; 0) { \</span></div>
<div class="line"><span class="preprocessor">                perror(#_cmd);      \</span></div>
<div class="line"><span class="preprocessor">                return -1;          \</span></div>
<div class="line"><span class="preprocessor">            }                       \</span></div>
<div class="line"><span class="preprocessor">        } while (0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> canvas_num = 0;</div>
<div class="line"><span class="preprocessor">#define VERIFY_CANVASID(x)  \</span></div>
<div class="line"><span class="preprocessor">        do {                \</span></div>
<div class="line"><span class="preprocessor">            if ((x) &lt; 0 || ((x) &gt;= canvas_num)) {   \</span></div>
<div class="line"><span class="preprocessor">                printf (&quot;canvas id wrong %d\n&quot;</span>, (x));   \</div>
<div class="line">                return -1;  \</div>
<div class="line">            }   \</div>
<div class="line">        } while (0)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>img_scale_s {</div>
<div class="line">    <span class="keywordtype">int</span> width;</div>
<div class="line">    <span class="keywordtype">int</span> heigth;</div>
<div class="line">    <span class="keywordtype">int</span> buffer_size_changed_flag;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> input_x;</div>
<div class="line">    <span class="keywordtype">int</span> input_y;</div>
<div class="line">    <span class="keywordtype">int</span> input_offset_changed_flag;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> input_width;</div>
<div class="line">    <span class="keywordtype">int</span> input_height;</div>
<div class="line">    <span class="keywordtype">int</span> input_size_changed_flag;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> output_x;</div>
<div class="line">    <span class="keywordtype">int</span> output_y;</div>
<div class="line">    <span class="keywordtype">int</span> output_offset_changed_flag;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> output_width;</div>
<div class="line">    <span class="keywordtype">int</span> output_height;</div>
<div class="line">    <span class="keywordtype">int</span> output_size_changed_flag;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> outbuf_pitch;</div>
<div class="line">    <span class="keywordtype">int</span> outbuf_height;</div>
<div class="line">    <span class="keywordtype">int</span> outbuf_size_changed_flag;</div>
<div class="line">} img_scale_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> input_file_format {</div>
<div class="line">    INPUT_FILE_FORMAT_YUV420 = 0,</div>
<div class="line">    INPUT_FILE_FORMAT_YUV422 = 1,</div>
<div class="line">    INPUT_FILE_FORMAT_YUV444 = 2,</div>
<div class="line">    INPUT_FILE_FORMAT_YUV400 = 3,</div>
<div class="line">    INPUT_FILE_FORMAT_RGB = 4,</div>
<div class="line">    INPUT_FILE_FORMAT_NUM,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define YUVCAP_PORT                 (2024)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> transfer_method = TRANS_METHOD_NFS;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a0" name="a0"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = -1;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *dsp_mem = NULL;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> dsp_size = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> src_canvas_id = 0;</div>
<div class="line"><span class="keyword">static</span> img_scale_t img_scale_cfg_info = {0};</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* input_buf = NULL;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> input_buf_size = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> input_buf_fd = -1;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* output_buf = NULL;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> output_buf_size = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> output_buf_fd = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> input_fd = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> output_fd_yuv = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> port = YUVCAP_PORT;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> filename[256] = {0};</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> input_filename[256];</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> input_file_fmt = INPUT_FILE_FORMAT_YUV420;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> input_file_specified = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> save_to_file = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> random_test = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> quit_random_test = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> img_scale_outbuf_width = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> img_scale_outbuf_pitch = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> img_scale_outbuf_height = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_clear_bg = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a id="_a1" name="_a1"></a><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a2" name="a2"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a3" name="a3"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aae">numeric_short_options</a> {</div>
<div class="line">    SPECIFY_INPUT_SIZE = 0,</div>
<div class="line">    SPECIFY_INPUT_OFFSET,</div>
<div class="line">    SPECIFY_OUTPUT_SIZE,</div>
<div class="line">    SPECIFY_OUTPUT_BUF_SIZE,</div>
<div class="line">    SPECIFY_OUTPUT_OFFSET,</div>
<div class="line">    SPECIFY_INPUT_FILE_FORMAT,</div>
<div class="line">    SPECIFY_INPUT_FILE,</div>
<div class="line">    SPECIFY_BUFFER_SIZE,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a4" name="a4"></a>short_opts = <span class="stringliteral">&quot;b:f:rC&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>option <a id="a5" name="a5"></a>long_opts[] = {</div>
<div class="line">    { <span class="stringliteral">&quot;canvas&quot;</span>, <a id="a6" name="a6"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;b&#39;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;binsize&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_INPUT_SIZE },</div>
<div class="line">    { <span class="stringliteral">&quot;binoffset&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_INPUT_OFFSET },</div>
<div class="line">    { <span class="stringliteral">&quot;boutsize&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_OUTPUT_SIZE },</div>
<div class="line">    { <span class="stringliteral">&quot;boutbufsize&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_OUTPUT_BUF_SIZE },</div>
<div class="line">    { <span class="stringliteral">&quot;boutoffset&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_OUTPUT_OFFSET },</div>
<div class="line">    { <span class="stringliteral">&quot;file&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;f&#39;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;random&quot;</span>, <a id="a7" name="a7"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;r&#39;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;format&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_INPUT_FILE_FORMAT },</div>
<div class="line">    { <span class="stringliteral">&quot;infile&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_INPUT_FILE },</div>
<div class="line">    { <span class="stringliteral">&quot;bsize&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SPECIFY_BUFFER_SIZE },</div>
<div class="line">    { <span class="stringliteral">&quot;clear-bg&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;C&#39;</span> },</div>
<div class="line">    { 0, 0, 0, 0 }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> <a id="a8" name="a8"></a>hint[] =</div>
<div class="line">{</div>
<div class="line">    { <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tSpecify canvas id for input buffer&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;resolution&quot;</span>, <span class="stringliteral">&quot;Specify input window size&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;resolution&quot;</span>, <span class="stringliteral">&quot;Specify input window offset&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;resolution&quot;</span>, <span class="stringliteral">&quot;Specify output window size&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;resolution&quot;</span>, <span class="stringliteral">&quot;Specify output buffer size&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;resolution&quot;</span>, <span class="stringliteral">&quot;Specify output window offset&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tSpecify file name&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tAuto random test&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tSpecify input file format, 0: NV12, 1: NV16, 2: YUV444, 3: YUV400, 4: RGB&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tSpecify input file&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tSpecify buffer size of input file&quot;</span> },</div>
<div class="line">    { <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tClear output buffer background. Only valid when output buf size is set&quot;</span> },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a id="a9" name="a9"></a>usage(<span class="keywordtype">char</span>* program_self)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> i;</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n%s usage:\n\n&quot;</span>, program_self);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(long_opts) / <span class="keyword">sizeof</span>(long_opts[0]) - 1; ++i) {</div>
<div class="line">        <span class="keywordflow">if</span> (isalpha(long_opts[i].val))</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c &quot;</span>, long_opts[i].val);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;--%s&quot;</span>, long_opts[i].<a id="a10" name="a10"></a>name);</div>
<div class="line">        <span class="keywordflow">if</span> (hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>[0] != 0)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [%s]&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nExamples:\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  1. Do image scale from the canvas\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3 lane=2\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_vin0_1080p_linear.lua --img-scale 1 --img-scale-format 0&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;--img-scale-max-in 1920x1080 --img-scale-max-out 1920x1080 --img-scale-job-queue-depth 8\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # %s -b 0 --binsize 1920x1080 --boutsize 720x480 --format 0 -f /tmp/\n&quot;</span>, program_self);</div>
<div class="line">    printf(<span class="stringliteral">&quot;  2. Do image scale from the file\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3 lane=2\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_vin0_1080p_linear.lua --img-scale 1 --img-scale-format 1 &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;--img-scale-max-in 1920x1080 --img-scale-max-out 1920x1080 --img-scale-job-queue-depth 8\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # %s -f /tmp/ --bsize 1920x1080 --infile 1920x1080_nv16 --format 1 --boutsize 720x480\n&quot;</span>, program_self);</div>
<div class="line">    printf(<span class="stringliteral">&quot;  3. Output image with offset in output buffer\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3 lane=2\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_vin0_1080p_linear.lua --img-scale 1 --img-scale-format 1 &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;--img-scale-max-in 1920x1080 --img-scale-max-out 1920x1080 --img-scale-job-queue-depth 8\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # %s -f /tmp/ --bsize 1920x1080 --infile 1920x1080_nv16 --format 1 --boutsize 720x480 &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;--boutoffset 128x128 --boutbufsize 1920x1080 -C\n&quot;</span>, program_self);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    return ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a11" name="a11"></a>map_dsp_buffer(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a12" name="_a12"></a><a class="code hl_structRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a> query_mem = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a13" name="_a13"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a> *part_info = NULL;</div>
<div class="line"> </div>
<div class="line">    query_mem.<a id="a14" name="a14"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">mid</a> = <a id="a15" name="a15"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a>;</div>
<div class="line">    part_info = &amp;query_mem.<a id="a16" name="a16"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">arg</a>.<a id="a17" name="a17"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">partition</a>;</div>
<div class="line">    part_info-&gt;<a id="a18" name="a18"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = <a id="a19" name="a19"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa">IAV_PART_DSP</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a20" name="a20"></a>IAV_IOC_QUERY_MEMBLOCK, &amp;query_mem) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_MEMBLOCK&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    dsp_size = part_info-&gt;<a id="a21" name="a21"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a22" name="a22"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    dsp_mem = mmap(NULL, dsp_size, PROT_READ | PROT_WRITE, MAP_SHARED, fd_iav,</div>
<div class="line">        part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a23" name="a23"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (dsp_mem == MAP_FAILED) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;mmap (%d) failed: %s\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> alloc_input_buf(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a24" name="_a24"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html">iav_alloc_mem_part</a> alloc_mem_part = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (input_buf_fd &gt;= 0) {</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    alloc_mem_part.<a id="a25" name="a25"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a9ee64c7b918513891b3834b93ad0e501">length</a> = size;</div>
<div class="line">    alloc_mem_part.<a id="a26" name="a26"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a8ea167dba5ed98a2ab50ff41dae8dde5">enable_cache</a> = 0;</div>
<div class="line">    alloc_mem_part.<a id="a27" name="a27"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#adac25b843a2cccd720a100c5b9b1b545">from_private</a> = 1;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a28" name="a28"></a>IAV_IOC_ALLOC_ANON_MEM_PART, &amp;alloc_mem_part) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_ALLOC_ANON_MEM_PART_FD&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    input_buf_fd = alloc_mem_part.<a id="a29" name="a29"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a>;</div>
<div class="line"> </div>
<div class="line">    input_buf_size = alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (input_buf_size) {</div>
<div class="line">        input_buf = mmap(NULL, input_buf_size, PROT_READ | PROT_WRITE, MAP_SHARED,</div>
<div class="line">            fd_iav, alloc_mem_part.<a id="a30" name="a30"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#ac1369a1f209735864674d22517edfa76">offset</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (input_buf == MAP_FAILED) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;mmap input buffer failed\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> free_input_buf(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html">iav_alloc_mem_part</a> alloc_mem_part = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (input_buf &amp;&amp; input_buf_size) {</div>
<div class="line">        munmap(input_buf, input_buf_size);</div>
<div class="line">    }</div>
<div class="line">    input_buf = NULL;</div>
<div class="line">    input_buf_size = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (input_buf_fd &gt;= 0) {</div>
<div class="line">        alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = input_buf_fd;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a31" name="a31"></a>IAV_IOC_FREE_MEM_PART, &amp;alloc_mem_part) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_FREE_MEM_PART&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        input_buf_fd = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> alloc_output_buf(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html">iav_alloc_mem_part</a> alloc_mem_part = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (output_buf_fd &gt;= 0) {</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a9ee64c7b918513891b3834b93ad0e501">length</a> = size;</div>
<div class="line">    alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a8ea167dba5ed98a2ab50ff41dae8dde5">enable_cache</a> = 0;</div>
<div class="line">    alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#adac25b843a2cccd720a100c5b9b1b545">from_private</a> = 1;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_ALLOC_ANON_MEM_PART, &amp;alloc_mem_part) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_ALLOC_ANON_MEM_PART_FD&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    output_buf_fd = alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a>;</div>
<div class="line"> </div>
<div class="line">    output_buf_size = alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (output_buf_size) {</div>
<div class="line">        output_buf = mmap(NULL, output_buf_size, PROT_READ | PROT_WRITE, MAP_SHARED,</div>
<div class="line">            fd_iav, alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#ac1369a1f209735864674d22517edfa76">offset</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (output_buf == MAP_FAILED) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;mmap output buffer failed\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> free_output_buf(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html">iav_alloc_mem_part</a> alloc_mem_part = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (output_buf &amp;&amp; output_buf_size) {</div>
<div class="line">        munmap(output_buf, output_buf_size);</div>
<div class="line">    }</div>
<div class="line">    output_buf = NULL;</div>
<div class="line">    output_buf_size = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (output_buf_fd &gt;= 0) {</div>
<div class="line">        alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = output_buf_fd;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_FREE_MEM_PART, &amp;alloc_mem_part) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_FREE_MEM_PART&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        output_buf_fd = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// first and second values must be in format of &quot;AxB&quot;</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_two_int(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> *first, <span class="keywordtype">int</span> *second, <span class="keywordtype">char</span> delimiter)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> tmp_string[16];</div>
<div class="line">    <span class="keywordtype">char</span> * separator;</div>
<div class="line"> </div>
<div class="line">    separator = strchr(name, delimiter);</div>
<div class="line">    <span class="keywordflow">if</span> (!separator) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;two int should be like A%cB.\n&quot;</span>, delimiter);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    strncpy(tmp_string, name, separator - name);</div>
<div class="line">    tmp_string[separator - <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">    *first = atoi(tmp_string);</div>
<div class="line">    strncpy(tmp_string, separator + 1, name + strlen(name) - separator);</div>
<div class="line">    *second = atoi(tmp_string);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> prepare(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a32" name="_a32"></a><a class="code hl_structRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a> resource;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;resource, 0, <span class="keyword">sizeof</span>(resource));</div>
<div class="line">    resource.encode_mode = <a id="a33" name="a33"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a34" name="a34"></a>IAV_IOC_GET_SYSTEM_RESOURCE, &amp;resource) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_GET_SYSTEM_RESOURCE error\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!resource.img_scale_cfg.enable) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Pls enable img_scale first.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a id="a35" name="a35"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#a8471b8cc1bef7761e62b3b326231e98a">canvas_num</a> = resource.canvas_num;</div>
<div class="line">    img_scale_outbuf_width = resource.img_scale_cfg.max_output.width;</div>
<div class="line">    img_scale_outbuf_pitch = <a id="a36" name="a36"></a><a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(resource.img_scale_cfg.max_output.width,</div>
<div class="line">        <a id="a37" name="a37"></a>IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">    img_scale_outbuf_height = resource.img_scale_cfg.max_output.height;</div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.outbuf_size_changed_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> (img_scale_cfg_info.outbuf_pitch &gt; img_scale_outbuf_pitch ||</div>
<div class="line">            img_scale_cfg_info.outbuf_height &gt; img_scale_outbuf_height) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Output buf size %dx%d exceeds max output size %dx%d!\n&quot;</span>,</div>
<div class="line">                img_scale_cfg_info.outbuf_pitch, img_scale_cfg_info.outbuf_height,</div>
<div class="line">                img_scale_outbuf_pitch, img_scale_outbuf_height);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (map_dsp_buffer() &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_param(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ch, first, second;</div>
<div class="line">    <span class="keywordtype">int</span> option_index = 0;</div>
<div class="line"> </div>
<div class="line">    opterr = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> ((ch = getopt_long(argc, argv, short_opts, long_opts, &amp;option_index))</div>
<div class="line">            != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line">                src_canvas_id = atoi(optarg);</div>
<div class="line">                VERIFY_CANVASID(src_canvas_id);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SPECIFY_INPUT_SIZE:</div>
<div class="line">                <span class="keywordflow">if</span> (get_two_int(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0)</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                <span class="keywordflow">if</span> (first &lt;= 0 || second &lt;= 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;invalid input size [%dx%d].\n&quot;</span>, first, second);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                img_scale_cfg_info.input_width = first;</div>
<div class="line">                img_scale_cfg_info.input_height = second;</div>
<div class="line">                img_scale_cfg_info.input_size_changed_flag = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SPECIFY_INPUT_OFFSET:</div>
<div class="line">                <span class="keywordflow">if</span> (get_two_int(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0)</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                <span class="keywordflow">if</span> (first &lt; 0 || second &lt; 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;invalid input size [%dx%d].\n&quot;</span>, first, second);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                img_scale_cfg_info.input_x= first;</div>
<div class="line">                img_scale_cfg_info.input_y = second;</div>
<div class="line">                img_scale_cfg_info.input_offset_changed_flag = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SPECIFY_OUTPUT_SIZE:</div>
<div class="line">                <span class="keywordflow">if</span> (get_two_int(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0)</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                <span class="keywordflow">if</span> (first &lt;= 0 || second &lt;= 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;invalid output size [%dx%d].\n&quot;</span>, first, second);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                img_scale_cfg_info.output_width = first;</div>
<div class="line">                img_scale_cfg_info.output_height = second;</div>
<div class="line">                img_scale_cfg_info.output_size_changed_flag = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SPECIFY_OUTPUT_OFFSET:</div>
<div class="line">                <span class="keywordflow">if</span> (get_two_int(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0)</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                <span class="keywordflow">if</span> (first &lt;= 0 || second &lt;= 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;invalid input size [%dx%d].\n&quot;</span>, first, second);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                img_scale_cfg_info.output_x = first;</div>
<div class="line">                img_scale_cfg_info.output_y = second;</div>
<div class="line">                img_scale_cfg_info.output_offset_changed_flag = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SPECIFY_OUTPUT_BUF_SIZE:</div>
<div class="line">                <span class="keywordflow">if</span> (get_two_int(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0)</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                <span class="keywordflow">if</span> (first &lt;= 0 || second &lt;= 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;invalid output buf size [%dx%d].\n&quot;</span>, first, second);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                img_scale_cfg_info.outbuf_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(first, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">                img_scale_cfg_info.outbuf_height = second;</div>
<div class="line">                img_scale_cfg_info.outbuf_size_changed_flag = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SPECIFY_BUFFER_SIZE:</div>
<div class="line">                <span class="keywordflow">if</span> (get_two_int(optarg, &amp;first, &amp;second, <span class="charliteral">&#39;x&#39;</span>) &lt; 0)</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                <span class="keywordflow">if</span> (first &lt;= 0 || second &lt;= 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;invalid buffer size [%dx%d].\n&quot;</span>, first, second);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                img_scale_cfg_info.width = first;</div>
<div class="line">                img_scale_cfg_info.heigth = second;</div>
<div class="line">                img_scale_cfg_info.buffer_size_changed_flag = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SPECIFY_INPUT_FILE_FORMAT:</div>
<div class="line">                input_file_fmt = atoi(optarg);</div>
<div class="line">                <span class="keywordflow">if</span> (input_file_fmt &gt;= INPUT_FILE_FORMAT_NUM) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;invalid input file format [%d].\n&quot;</span>, input_file_fmt);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SPECIFY_INPUT_FILE:</div>
<div class="line">                snprintf(input_filename, <span class="keyword">sizeof</span>(input_filename), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">                input_file_specified = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line">                snprintf(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">                save_to_file = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line">                random_test = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:</div>
<div class="line">                is_clear_bg = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;unknown option found: %d\n&quot;</span>, ch);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.output_offset_changed_flag ||</div>
<div class="line">        img_scale_cfg_info.outbuf_size_changed_flag) {</div>
<div class="line">        <span class="keywordflow">if</span> ((img_scale_cfg_info.output_x + img_scale_cfg_info.output_width &gt;</div>
<div class="line">            img_scale_cfg_info.outbuf_pitch) ||</div>
<div class="line">            (img_scale_cfg_info.output_y + img_scale_cfg_info.output_height &gt;</div>
<div class="line">            img_scale_cfg_info.outbuf_height)) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;output size %dx%d with offset %dx%d exceeds output buffer %dx%d!\n&quot;</span>,</div>
<div class="line">                img_scale_cfg_info.output_width, img_scale_cfg_info.output_height,</div>
<div class="line">                img_scale_cfg_info.output_x, img_scale_cfg_info.output_y,</div>
<div class="line">                img_scale_cfg_info.outbuf_pitch, img_scale_cfg_info.outbuf_height);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> save_yuv_data(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> pitch, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height, <span class="keywordtype">int</span> <a id="a38" name="a38"></a>format,</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *luma, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *chroma)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> luma_size, chroma_size, i, chroma_height;</div>
<div class="line"> </div>
<div class="line">    luma_size = width * height;</div>
<div class="line">    <span class="keywordflow">if</span> (format == <a id="a39" name="a39"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a4a5b450caee6fec582543be0dd39f5cf">IAV_YUV_FORMAT_YUV420</a>) {</div>
<div class="line">        chroma_size = luma_size / 2;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a id="a40" name="a40"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1abf3ed3f30bd12637ad4b31aada7be919">IAV_YUV_FORMAT_YUV422</a>) {</div>
<div class="line">        chroma_size = luma_size;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a id="a41" name="a41"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a7267dbad8e48f5979944f9680643b2b6">IAV_YUV_FORMAT_YUV400</a>) {</div>
<div class="line">        chroma_size = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error: Unrecognized yuv data format from DSP!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Write YUV data from memory to file */</span></div>
<div class="line">    <span class="keywordflow">if</span> (pitch == width) {</div>
<div class="line">        <span class="keywordflow">if</span> (amba_transfer_write(fd, luma, luma_size, transfer_method) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;Failed to save luma data into file !\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (chroma_size &amp;&amp; amba_transfer_write(fd, chroma, chroma_size, transfer_method) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;Failed to save chroma data into file !\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; height; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (amba_transfer_write(fd, luma, width, transfer_method) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;Failed to save luma data into file !\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            luma += pitch;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (chroma_size) {</div>
<div class="line">            chroma_height = (<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a> == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a4a5b450caee6fec582543be0dd39f5cf">IAV_YUV_FORMAT_YUV420</a>) ? height / 2 : height;</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; chroma_height; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (amba_transfer_write(fd, chroma, width, transfer_method) &lt; 0) {</div>
<div class="line">                    perror(<span class="stringliteral">&quot;Failed to save chroma data into file !\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">                chroma += pitch;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    amba_transfer_flush(fd, transfer_method);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> clear_background(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *luma, <span class="keywordtype">int</span> format, <span class="keywordtype">int</span> pitch, <span class="keywordtype">int</span> height)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define BG_Y    (0x0)</span></div>
<div class="line"><span class="preprocessor">#define BG_UV   (0x80)</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> luma_size = 0, chroma_size = 0;</div>
<div class="line">    luma_size = pitch * height;</div>
<div class="line">    <span class="keywordflow">if</span> (format == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a4a5b450caee6fec582543be0dd39f5cf">IAV_YUV_FORMAT_YUV420</a>) {</div>
<div class="line">        chroma_size = luma_size / 2;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1abf3ed3f30bd12637ad4b31aada7be919">IAV_YUV_FORMAT_YUV422</a>) {</div>
<div class="line">        chroma_size = luma_size;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a7267dbad8e48f5979944f9680643b2b6">IAV_YUV_FORMAT_YUV400</a>) {</div>
<div class="line">        chroma_size = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error: Unrecognized yuv data format %d!\n&quot;</span>, format);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (luma) {</div>
<div class="line">        memset(luma, BG_Y, luma_size);</div>
<div class="line">        <span class="keywordflow">if</span> (chroma_size) {</div>
<div class="line">            memset(luma + luma_size, BG_UV, chroma_size);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_img_scale(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a42" name="_a42"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> query_desc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a43" name="_a43"></a><a class="code hl_structRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html">iav_yuv_cap</a> *yuv_cap;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a44" name="_a44"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> canvas_cfg = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> yuv_input_buf_size = 0, yuv_output_buf_size = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> output_width = 0, output_height = 0, src_buf_id = 0, outbuf_pitch = 0, outbuf_height = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> of_pitch = 0, of_width = 0, of_height = 0;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a45" name="_a45"></a><a class="code hl_structRef" target="_blank" href="../../../library/dc/d40/structiav__wait__img__scale.html">iav_wait_img_scale</a> wait_img_scale = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a46" name="_a46"></a><a class="code hl_structRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html">iav_img_scale</a> img_scale = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a47" name="_a47"></a><a class="code hl_structRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html">iav_gdma_copy</a> gdma_copy = {0};</div>
<div class="line">    <span class="keywordtype">char</span> input_yuv_file[512];</div>
<div class="line">    <span class="keywordtype">char</span> output_yuv_file[512];</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *input_y_buf = NULL, *input_uv_buf = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    canvas_cfg.<a id="a48" name="a48"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a> = src_canvas_id;</div>
<div class="line">    <a id="a49" name="a49"></a><a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a50" name="a50"></a>IAV_IOC_GET_CANVAS_CONFIG, &amp;canvas_cfg);</div>
<div class="line">    <span class="keywordflow">if</span> (canvas_cfg.<a id="a51" name="a51"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a51993db991a3b2807df9114b0134ffdf">ext_mem</a> || canvas_cfg.<a id="a52" name="a52"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a423a515fa4f18a4a232501e84d5adbb2">manual_feed</a>) {</div>
<div class="line">        src_buf_id = <a id="a53" name="a53"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faaad312de47a183da5f2167b10c8c1e528">IAV_PART_CANVAS_POOL</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        src_buf_id = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa">IAV_PART_DSP</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    query_desc.<a id="a54" name="a54"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#aa73b12ace6ac7df824707a89ac4f91ff">qid</a> = <a id="a55" name="a55"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a>;</div>
<div class="line">    query_desc.<a id="a56" name="a56"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a id="a57" name="a57"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a id="a58" name="a58"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a> = src_canvas_id;</div>
<div class="line">    query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a id="a59" name="a59"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#ad4f2b1cfb6206d376dd2b024c7c15b9a">non_block_flag</a> &amp;= ~IAV_BUFCAP_NONBLOCK;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a60" name="a60"></a>IAV_IOC_QUERY_DESC, &amp;query_desc) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_DESC&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    yuv_cap = &amp;query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a id="a61" name="a61"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#ad1847147a26fa6e714478a599d584f45">yuv</a>;</div>
<div class="line"> </div>
<div class="line">    yuv_input_buf_size = yuv_cap-&gt;<a id="a62" name="a62"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(yuv_cap-&gt;<a id="a63" name="a63"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 16) * 2;</div>
<div class="line">    <span class="keywordflow">if</span> (alloc_input_buf(yuv_input_buf_size)) {</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    gdma_copy.<a id="a64" name="a64"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a97949d79559df32a6ff2d2b423b0be39">src_offset</a> = yuv_cap-&gt;<a id="a65" name="a65"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a7ed2668fc9c18679b1a349a2f6914f3f">y_addr_offset</a>;</div>
<div class="line">    gdma_copy.<a id="a66" name="a66"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5008710d9c1103d9591b3eda550b63f7">dst_offset</a> = 0;</div>
<div class="line">    gdma_copy.<a id="a67" name="a67"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a311c949c3fef26a92db0d704c9e7225c">src_pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">    gdma_copy.<a id="a68" name="a68"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a12669f6c0f6cc6c1e39ac929c91df9a1">dst_pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">    gdma_copy.<a id="a69" name="a69"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5103232dda61eefd81b5b849643c5753">width</a> = yuv_cap-&gt;<a id="a70" name="a70"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">    gdma_copy.<a id="a71" name="a71"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    gdma_copy.<a id="a72" name="a72"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a1c0b148c0d6c4ba4d318178fa7dd2557">src_mmap_type</a> = src_buf_id;</div>
<div class="line">    gdma_copy.<a id="a73" name="a73"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a0d0bde0d1958779c9220d9a5501b14e4">dst_mmap_type</a> = input_buf_fd;</div>
<div class="line">    gdma_copy.<a id="a74" name="a74"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a4a415c72ec8d9beafa3c8c85ae8b0e96">dst_use_dma_buf_fd</a> = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a75" name="a75"></a>IAV_IOC_GDMA_COPY, &amp;gdma_copy) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_GDMA_COPY&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a97949d79559df32a6ff2d2b423b0be39">src_offset</a> = yuv_cap-&gt;<a id="a76" name="a76"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a4eb7b75b76c9314ccc6582b332fdfb9d">uv_addr_offset</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5008710d9c1103d9591b3eda550b63f7">dst_offset</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 16);</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a311c949c3fef26a92db0d704c9e7225c">src_pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a12669f6c0f6cc6c1e39ac929c91df9a1">dst_pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5103232dda61eefd81b5b849643c5753">width</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> &gt;&gt; 1;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a1c0b148c0d6c4ba4d318178fa7dd2557">src_mmap_type</a> = src_buf_id;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a0d0bde0d1958779c9220d9a5501b14e4">dst_mmap_type</a> = input_buf_fd;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a4a415c72ec8d9beafa3c8c85ae8b0e96">dst_use_dma_buf_fd</a> = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_GDMA_COPY, &amp;gdma_copy) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_GDMA_COPY&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    img_scale.<a id="a77" name="a77"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a> = yuv_cap-&gt;<a id="a78" name="a78"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a8fb1c5212011391e7e4e75f750ed3a36">format</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.input_offset_changed_flag) {</div>
<div class="line">        img_scale.<a id="a79" name="a79"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a id="a80" name="a80"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = img_scale_cfg_info.input_x;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a id="a81" name="a81"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = img_scale_cfg_info.input_y;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.input_size_changed_flag) {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a id="a82" name="a82"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = img_scale_cfg_info.input_width;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a id="a83" name="a83"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = img_scale_cfg_info.input_height;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.output_offset_changed_flag) {</div>
<div class="line">        img_scale.<a id="a84" name="a84"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = img_scale_cfg_info.output_x;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = img_scale_cfg_info.output_y;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.output_size_changed_flag) {</div>
<div class="line">        output_width = img_scale_cfg_info.output_width;</div>
<div class="line">        output_height = img_scale_cfg_info.output_height;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        output_width = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">        output_height = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = output_width;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = output_height;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.outbuf_size_changed_flag) {</div>
<div class="line">        outbuf_pitch = img_scale_cfg_info.outbuf_pitch;</div>
<div class="line">        outbuf_height = img_scale_cfg_info.outbuf_height;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        outbuf_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(output_width, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">        outbuf_height = output_height;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    yuv_output_buf_size = img_scale_outbuf_pitch * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_outbuf_height, 16) * 3;</div>
<div class="line">    <span class="keywordflow">if</span> (alloc_output_buf(yuv_output_buf_size)) {</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.outbuf_size_changed_flag &amp;&amp; is_clear_bg) {</div>
<div class="line">        clear_background(output_buf, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a>, outbuf_pitch, outbuf_height);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    img_scale.<a id="a85" name="a85"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a id="a86" name="a86"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = input_buf_fd;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a id="a87" name="a87"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af6514d787f5e1925240357128607ee3e">use_phys</a> = 0;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a id="a88" name="a88"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#ac9b722bcb09eeb9244043100441774b1">use_dma_buf_fd</a> = 0;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a id="a89" name="a89"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a45b4ec9355164e5d76c74d0253e0982e">y_offset</a> = 0;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a id="a90" name="a90"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a id="a91" name="a91"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 16);</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a id="a92" name="a92"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a9efa8b8e4aa1423d4e68763966c3c129">uv_offset</a> = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> * img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a>;</div>
<div class="line"> </div>
<div class="line">    img_scale.<a id="a93" name="a93"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = output_buf_fd;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af6514d787f5e1925240357128607ee3e">use_phys</a> = 0;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#ac9b722bcb09eeb9244043100441774b1">use_dma_buf_fd</a> = 0;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a45b4ec9355164e5d76c74d0253e0982e">y_offset</a> = 0;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> = outbuf_pitch;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a> = outbuf_height;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a9efa8b8e4aa1423d4e68763966c3c129">uv_offset</a> = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> * img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a94" name="a94"></a>IAV_IOC_SET_IMG_SCALE, &amp;img_scale) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_SET_IMG_SCALE&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    wait_img_scale.<a id="a95" name="a95"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d40/structiav__wait__img__scale.html#aa55568ccbe384c224dfc109db3845708">task_id</a> = img_scale.<a id="a96" name="a96"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#aa55568ccbe384c224dfc109db3845708">task_id</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a97" name="a97"></a>IAV_IOC_WAIT_IMG_SCALE, &amp;wait_img_scale) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_WAIT_IMG_SCALE&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (save_to_file) {</div>
<div class="line">        <span class="keywordflow">if</span> (img_scale_cfg_info.outbuf_size_changed_flag) {</div>
<div class="line">            of_pitch = outbuf_pitch;</div>
<div class="line">            of_width = outbuf_pitch;</div>
<div class="line">            of_height = outbuf_height;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            of_pitch = outbuf_pitch;</div>
<div class="line">            of_width = output_width;</div>
<div class="line">            of_height = output_height;</div>
<div class="line">        }</div>
<div class="line">        memset(input_yuv_file, 0, <span class="keyword">sizeof</span>(input_yuv_file));</div>
<div class="line">        snprintf(input_yuv_file, <span class="keyword">sizeof</span>(input_yuv_file), <span class="stringliteral">&quot;%s_input_%dx%d.yuv&quot;</span>, filename,</div>
<div class="line">            img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>);</div>
<div class="line">        input_fd = amba_transfer_open(input_yuv_file, transfer_method, port++);</div>
<div class="line"> </div>
<div class="line">        input_y_buf = input_buf + yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> + img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a> == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a4a5b450caee6fec582543be0dd39f5cf">IAV_YUV_FORMAT_YUV420</a>) {</div>
<div class="line">            input_uv_buf = input_buf + yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 16) +</div>
<div class="line">                yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> / 2 + img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            input_uv_buf = input_buf + yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 16) +</div>
<div class="line">                yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> + img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        save_yuv_data(input_fd, yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>,</div>
<div class="line">            img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a>, input_y_buf, input_uv_buf);</div>
<div class="line"> </div>
<div class="line">        memset(output_yuv_file, 0, <span class="keyword">sizeof</span>(output_yuv_file));</div>
<div class="line">        snprintf(output_yuv_file, <span class="keyword">sizeof</span>(output_yuv_file), <span class="stringliteral">&quot;%s_output_%dx%d.yuv&quot;</span>, filename,</div>
<div class="line">            of_width, of_height);</div>
<div class="line">        output_fd_yuv = amba_transfer_open(output_yuv_file, transfer_method, port++);</div>
<div class="line">        save_yuv_data(output_fd_yuv, of_pitch, of_width, of_height, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a>,</div>
<div class="line">            output_buf, output_buf + of_pitch * of_height);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (input_fd &gt;= 0) {</div>
<div class="line">            amba_transfer_close(input_fd, transfer_method);</div>
<div class="line">            input_fd = -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (output_fd_yuv &gt;= 0) {</div>
<div class="line">            amba_transfer_close(output_fd_yuv, transfer_method);</div>
<div class="line">            output_fd_yuv = -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">DO_IMG_SCALE_EXIT:</div>
<div class="line">    free_output_buf();</div>
<div class="line">    free_input_buf();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_input_file_img_scale(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> input_pitch, input_buf_size, i, j, layer_cnt = 1, input_file_size, actual_file_size;</div>
<div class="line">    <span class="keywordtype">int</span> output_width, output_height, output_size, outbuf_pitch, outbuf_height;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> of_pitch = 0, of_width = 0, of_height = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *input_buf_temp = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html">iav_img_scale</a> img_scale = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dc/d40/structiav__wait__img__scale.html">iav_wait_img_scale</a> wait_img_scale = {0};</div>
<div class="line">    <span class="keywordtype">char</span> output_file[512];</div>
<div class="line">    <span class="keywordtype">int</span> output_fd = -1;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    input_fd = open(input_filename, O_RDONLY);</div>
<div class="line">    <span class="keywordflow">if</span> (input_fd &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Input file name: \&quot;%s\&quot; not existed!\n&quot;</span>, input_filename);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.buffer_size_changed_flag == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Pls specify input buffer size\n&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    input_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_cfg_info.width, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line"> </div>
<div class="line">    input_buf_size = input_pitch * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_cfg_info.heigth, 16) * 3;</div>
<div class="line">    <span class="keywordflow">if</span> (alloc_input_buf(input_buf_size)) {</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line">    actual_file_size = lseek(input_fd, 0, SEEK_END);</div>
<div class="line">    lseek(input_fd, 0, SEEK_SET);</div>
<div class="line">    <span class="keywordflow">switch</span> (input_file_fmt) {</div>
<div class="line">    <span class="keywordflow">case</span> INPUT_FILE_FORMAT_YUV444:</div>
<div class="line">    <span class="keywordflow">case</span> INPUT_FILE_FORMAT_RGB:</div>
<div class="line">        input_file_size = img_scale_cfg_info.heigth * img_scale_cfg_info.width * 3;</div>
<div class="line">        <span class="keywordflow">if</span> (input_file_size != actual_file_size) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Need %d bytes for YUV size %dx%d, but the YUV file size is %d!\n&quot;</span>, input_file_size,</div>
<div class="line">                img_scale_cfg_info.width, img_scale_cfg_info.heigth, actual_file_size);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {</div>
<div class="line">            input_buf_temp = input_buf + i * input_pitch * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_cfg_info.heigth, 16);</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; img_scale_cfg_info.heigth; j++) {</div>
<div class="line">                <span class="keywordflow">if</span> (read(input_fd, input_buf_temp, img_scale_cfg_info.width) != img_scale_cfg_info.width) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Read width %d failed!\n&quot;</span>, img_scale_cfg_info.width);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">                }</div>
<div class="line">                input_buf_temp += input_pitch;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> INPUT_FILE_FORMAT_YUV422:</div>
<div class="line">        input_file_size = img_scale_cfg_info.heigth * img_scale_cfg_info.width * 2;</div>
<div class="line">        <span class="keywordflow">if</span> (input_file_size != actual_file_size) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Need %d bytes for YUV size %dx%d, but the YUV file size is %d!\n&quot;</span>, input_file_size,</div>
<div class="line">                img_scale_cfg_info.width, img_scale_cfg_info.heigth, actual_file_size);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {</div>
<div class="line">            input_buf_temp = input_buf + i * input_pitch * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_cfg_info.heigth, 16);</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; img_scale_cfg_info.heigth; j++) {</div>
<div class="line">                <span class="keywordflow">if</span> (read(input_fd, input_buf_temp, img_scale_cfg_info.width) != img_scale_cfg_info.width) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Read width %d failed!\n&quot;</span>, img_scale_cfg_info.width);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">                }</div>
<div class="line">                input_buf_temp += input_pitch;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> INPUT_FILE_FORMAT_YUV420:</div>
<div class="line">        input_file_size = img_scale_cfg_info.heigth * img_scale_cfg_info.width * 3 / 2;</div>
<div class="line">        <span class="keywordflow">if</span> (input_file_size != actual_file_size) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Need %d bytes for YUV size %dx%d, but the YUV file size is %d!\n&quot;</span>, input_file_size,</div>
<div class="line">                img_scale_cfg_info.width, img_scale_cfg_info.heigth, actual_file_size);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">        }</div>
<div class="line">        input_buf_temp = input_buf;</div>
<div class="line">        <span class="comment">/* read Y */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; img_scale_cfg_info.heigth; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (read(input_fd, input_buf_temp, img_scale_cfg_info.width) != img_scale_cfg_info.width) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Read width %d failed!\n&quot;</span>, img_scale_cfg_info.width);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">            }</div>
<div class="line">            input_buf_temp += input_pitch;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* read UV */</span></div>
<div class="line">        input_buf_temp = input_buf + input_pitch * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_cfg_info.heigth, 16);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; img_scale_cfg_info.heigth / 2; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (read(input_fd, input_buf_temp, img_scale_cfg_info.width) != img_scale_cfg_info.width) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Read width %d failed!\n&quot;</span>, img_scale_cfg_info.width);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">            }</div>
<div class="line">            input_buf_temp += input_pitch;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        input_file_size = img_scale_cfg_info.heigth * img_scale_cfg_info.width;</div>
<div class="line">        <span class="keywordflow">if</span> (input_file_size != actual_file_size) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Need %d bytes for YUV size %dx%d, but the YUV file size is %d!\n&quot;</span>, input_file_size,</div>
<div class="line">                img_scale_cfg_info.width, img_scale_cfg_info.heigth, actual_file_size);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">        }</div>
<div class="line">        input_buf_temp = input_buf;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; img_scale_cfg_info.heigth; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (read(input_fd, input_buf_temp, img_scale_cfg_info.width) != img_scale_cfg_info.width) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Read width %d failed!\n&quot;</span>, img_scale_cfg_info.width);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">            }</div>
<div class="line">            input_buf_temp += input_pitch;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    img_scale.<a id="a98" name="a98"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ad4f2b1cfb6206d376dd2b024c7c15b9a">non_block_flag</a> = 1;</div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.input_offset_changed_flag) {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = img_scale_cfg_info.input_x;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = img_scale_cfg_info.input_y;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.input_size_changed_flag) {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = img_scale_cfg_info.input_width;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = img_scale_cfg_info.input_height;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = img_scale_cfg_info.width;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = img_scale_cfg_info.heigth;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.output_offset_changed_flag) {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = img_scale_cfg_info.output_x;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = img_scale_cfg_info.output_y;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.output_size_changed_flag) {</div>
<div class="line">        output_width = img_scale_cfg_info.output_width;</div>
<div class="line">        output_height = img_scale_cfg_info.output_height;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        output_width = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">        output_height = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = output_width;</div>
<div class="line">    img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = output_height;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.outbuf_size_changed_flag) {</div>
<div class="line">        outbuf_pitch = img_scale_cfg_info.outbuf_pitch;</div>
<div class="line">        outbuf_height = img_scale_cfg_info.outbuf_height;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        outbuf_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(output_width, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">        outbuf_height = output_height;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    output_size = img_scale_outbuf_pitch * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_outbuf_height, 16) * 3;</div>
<div class="line">    <span class="keywordflow">if</span> (alloc_output_buf(output_size)) {</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.outbuf_size_changed_flag &amp;&amp; is_clear_bg) {</div>
<div class="line">        clear_background(output_buf, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a>, outbuf_pitch, outbuf_height);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((input_file_fmt == INPUT_FILE_FORMAT_YUV420) || (input_file_fmt == INPUT_FILE_FORMAT_YUV422)) {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a> = (input_file_fmt == INPUT_FILE_FORMAT_YUV420) ?</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a4a5b450caee6fec582543be0dd39f5cf">IAV_YUV_FORMAT_YUV420</a> : <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1abf3ed3f30bd12637ad4b31aada7be919">IAV_YUV_FORMAT_YUV422</a>;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a id="a99" name="a99"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af58874517424bd8ff3f1ad693e6d062a">dma_buf_fd</a> = input_buf_fd;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#ac9b722bcb09eeb9244043100441774b1">use_dma_buf_fd</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af6514d787f5e1925240357128607ee3e">use_phys</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a45b4ec9355164e5d76c74d0253e0982e">y_offset</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> = input_pitch;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_cfg_info.heigth, 16);</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a9efa8b8e4aa1423d4e68763966c3c129">uv_offset</a> = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> * img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a>;</div>
<div class="line"> </div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af58874517424bd8ff3f1ad693e6d062a">dma_buf_fd</a> = output_buf_fd;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#ac9b722bcb09eeb9244043100441774b1">use_dma_buf_fd</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af6514d787f5e1925240357128607ee3e">use_phys</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a45b4ec9355164e5d76c74d0253e0982e">y_offset</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> = outbuf_pitch;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a> = outbuf_height;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a9efa8b8e4aa1423d4e68763966c3c129">uv_offset</a> = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> * img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_SET_IMG_SCALE, &amp;img_scale) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_SET_IMG_SCALE&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((input_file_fmt == INPUT_FILE_FORMAT_YUV444) || (input_file_fmt == INPUT_FILE_FORMAT_RGB) ||</div>
<div class="line">        (input_file_fmt == INPUT_FILE_FORMAT_YUV400)) {</div>
<div class="line">        <span class="keywordflow">if</span> ((input_file_fmt == INPUT_FILE_FORMAT_YUV444) || (input_file_fmt == INPUT_FILE_FORMAT_RGB)) {</div>
<div class="line">            layer_cnt = 3;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            layer_cnt = 1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a7267dbad8e48f5979944f9680643b2b6">IAV_YUV_FORMAT_YUV400</a>;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = input_buf_fd;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#ac9b722bcb09eeb9244043100441774b1">use_dma_buf_fd</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af6514d787f5e1925240357128607ee3e">use_phys</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> = input_pitch;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_cfg_info.heigth, 16);</div>
<div class="line"> </div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = output_buf_fd;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#ac9b722bcb09eeb9244043100441774b1">use_dma_buf_fd</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af6514d787f5e1925240357128607ee3e">use_phys</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> = outbuf_pitch;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a> = outbuf_height;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; layer_cnt; i++) {</div>
<div class="line">            img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a45b4ec9355164e5d76c74d0253e0982e">y_offset</a> = i * input_pitch * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_cfg_info.heigth, 16);</div>
<div class="line">            img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a45b4ec9355164e5d76c74d0253e0982e">y_offset</a> = i * outbuf_pitch * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(outbuf_height, 16);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_SET_IMG_SCALE, &amp;img_scale) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_SET_IMG_SCALE&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invaild input format %d!\n&quot;</span>, input_file_fmt);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Only need to wait for the last scaling task</span></div>
<div class="line">    wait_img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d40/structiav__wait__img__scale.html#aa55568ccbe384c224dfc109db3845708">task_id</a> = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#aa55568ccbe384c224dfc109db3845708">task_id</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_WAIT_IMG_SCALE, &amp;wait_img_scale) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_WAIT_IMG_SCALE&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (img_scale_cfg_info.outbuf_size_changed_flag) {</div>
<div class="line">        of_pitch = outbuf_pitch;</div>
<div class="line">        of_width = outbuf_pitch;</div>
<div class="line">        of_height = outbuf_height;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        of_pitch = outbuf_pitch;</div>
<div class="line">        of_width = output_width;</div>
<div class="line">        of_height = output_height;</div>
<div class="line">    }</div>
<div class="line">    memset(output_file, 0, <span class="keyword">sizeof</span>(output_file));</div>
<div class="line">    snprintf(output_file, <span class="keyword">sizeof</span>(output_file), <span class="stringliteral">&quot;%s_output_%dx%d.yuv&quot;</span>, filename,</div>
<div class="line">        of_width, of_height);</div>
<div class="line">    output_fd = amba_transfer_open(output_file, transfer_method, port++);</div>
<div class="line">    <span class="keywordflow">if</span> (output_fd &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Fail to open output file: \&quot;%s\&quot;!\n&quot;</span>, output_file);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_INPUT_FILE_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((input_file_fmt == INPUT_FILE_FORMAT_YUV420) || (input_file_fmt == INPUT_FILE_FORMAT_YUV422)) {</div>
<div class="line">        save_yuv_data(output_fd, of_pitch, of_width, of_height,</div>
<div class="line">            (input_file_fmt == INPUT_FILE_FORMAT_YUV420) ? <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a4a5b450caee6fec582543be0dd39f5cf">IAV_YUV_FORMAT_YUV420</a> : <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1abf3ed3f30bd12637ad4b31aada7be919">IAV_YUV_FORMAT_YUV422</a>,</div>
<div class="line">            output_buf, output_buf + of_pitch * of_height);</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((input_file_fmt == INPUT_FILE_FORMAT_YUV444) || (input_file_fmt == INPUT_FILE_FORMAT_RGB) ||</div>
<div class="line">        (input_file_fmt == INPUT_FILE_FORMAT_YUV400)) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; layer_cnt; i++) {</div>
<div class="line">            save_yuv_data(output_fd, of_pitch, of_width, of_height, <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a7267dbad8e48f5979944f9680643b2b6">IAV_YUV_FORMAT_YUV400</a>,</div>
<div class="line">                output_buf + i * of_pitch * of_height, NULL);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invaild input format %d!\n&quot;</span>, input_file_fmt);</div>
<div class="line">        rval = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (output_fd &gt;= 0) {</div>
<div class="line">        amba_transfer_close(output_fd, transfer_method);</div>
<div class="line">        output_fd = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">DO_INPUT_FILE_IMG_SCALE_EXIT:</div>
<div class="line">    <span class="keywordflow">if</span> (input_fd &gt;= 0) {</div>
<div class="line">        amba_transfer_close(input_fd, transfer_method);</div>
<div class="line">        input_fd = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    free_output_buf();</div>
<div class="line">    free_input_buf();</div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> rand_int_range(<span class="keywordtype">int</span> start, <span class="keywordtype">int</span> end)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> rand() % (end + 1 - start) + start;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> do_random_img_scale(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> query_desc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> canvas_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html">iav_yuv_cap</a> *yuv_cap;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> yuv_input_buf_size = 0, yuv_output_buf_size = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html">iav_img_scale</a> img_scale = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html">iav_gdma_copy</a> gdma_copy = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dc/d40/structiav__wait__img__scale.html">iav_wait_img_scale</a> wait_img_scale = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a100" name="_a100"></a><a class="code hl_structRef" target="_blank" href="../../../library/d5/d5f/structiav__enc__buf__cap.html">iav_enc_buf_cap</a> cap_buf = {0};</div>
<div class="line">    <span class="keywordtype">int</span> min_output_w, min_output_h, max_output_w, max_output_h;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> output_width = 0, output_pitch = 0, output_height = 0, src_buf_id = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0, file_count = 0;</div>
<div class="line">    <span class="keywordtype">char</span> output_yuv_file[512];</div>
<div class="line"> </div>
<div class="line">    cap_buf.<a id="a101" name="a101"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/d5f/structiav__enc__buf__cap.html#a4eb5390353fb0508442db61e89ed786b">pass_id</a> = 0;</div>
<div class="line">    cap_buf.<a id="a102" name="a102"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/d5f/structiav__enc__buf__cap.html#a2830ebfe6ef0797f46e9fcc1945f4c01">buf_id</a> = <a id="a103" name="a103"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a9acc659b6d59b9aecb2e9c5d5dceea02">IAV_SRCBUF_PF</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a104" name="a104"></a>IAV_IOC_QUERY_ENC_BUF_CAP, &amp;cap_buf);</div>
<div class="line"> </div>
<div class="line">    canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a> = src_canvas_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_CANVAS_CONFIG, &amp;canvas_cfg);</div>
<div class="line">    <span class="keywordflow">if</span> (canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a51993db991a3b2807df9114b0134ffdf">ext_mem</a> || canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a423a515fa4f18a4a232501e84d5adbb2">manual_feed</a>) {</div>
<div class="line">        src_buf_id = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faaad312de47a183da5f2167b10c8c1e528">IAV_PART_CANVAS_POOL</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        src_buf_id = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa">IAV_PART_DSP</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#aa73b12ace6ac7df824707a89ac4f91ff">qid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a>;</div>
<div class="line">    query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a> = src_canvas_id;</div>
<div class="line">    query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#ad4f2b1cfb6206d376dd2b024c7c15b9a">non_block_flag</a> &amp;= ~IAV_BUFCAP_NONBLOCK;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_QUERY_DESC, &amp;query_desc) &lt; 0) {</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_RANDOM_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    yuv_cap = &amp;query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#ad1847147a26fa6e714478a599d584f45">yuv</a>;</div>
<div class="line"> </div>
<div class="line">    yuv_input_buf_size = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 16) * 2;</div>
<div class="line">    <span class="keywordflow">if</span> (alloc_input_buf(yuv_input_buf_size)) {</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_RANDOM_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a97949d79559df32a6ff2d2b423b0be39">src_offset</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a7ed2668fc9c18679b1a349a2f6914f3f">y_addr_offset</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5008710d9c1103d9591b3eda550b63f7">dst_offset</a> = 0;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a311c949c3fef26a92db0d704c9e7225c">src_pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a12669f6c0f6cc6c1e39ac929c91df9a1">dst_pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5103232dda61eefd81b5b849643c5753">width</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a1c0b148c0d6c4ba4d318178fa7dd2557">src_mmap_type</a> = src_buf_id;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a0d0bde0d1958779c9220d9a5501b14e4">dst_mmap_type</a> = input_buf_fd;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a4a415c72ec8d9beafa3c8c85ae8b0e96">dst_use_dma_buf_fd</a> = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_GDMA_COPY, &amp;gdma_copy) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_GDMA_COPY&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_RANDOM_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a97949d79559df32a6ff2d2b423b0be39">src_offset</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a4eb7b75b76c9314ccc6582b332fdfb9d">uv_addr_offset</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5008710d9c1103d9591b3eda550b63f7">dst_offset</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 16);</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a311c949c3fef26a92db0d704c9e7225c">src_pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a12669f6c0f6cc6c1e39ac929c91df9a1">dst_pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5103232dda61eefd81b5b849643c5753">width</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> &gt;&gt; 1;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a1c0b148c0d6c4ba4d318178fa7dd2557">src_mmap_type</a> = src_buf_id;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a0d0bde0d1958779c9220d9a5501b14e4">dst_mmap_type</a> = input_buf_fd;</div>
<div class="line">    gdma_copy.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a4a415c72ec8d9beafa3c8c85ae8b0e96">dst_use_dma_buf_fd</a> = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_GDMA_COPY, &amp;gdma_copy) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_GDMA_COPY&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_RANDOM_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    yuv_output_buf_size = img_scale_outbuf_pitch * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale_outbuf_height, 16) * 3;</div>
<div class="line">    <span class="keywordflow">if</span> (alloc_output_buf(yuv_output_buf_size)) {</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> DO_RANDOM_IMG_SCALE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!quit_random_test) {</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a8fb1c5212011391e7e4e75f750ed3a36">format</a>;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(rand_int_range(1, yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>), 4);</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(rand_int_range(1, yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>), 4);</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> = <a id="a105" name="a105"></a><a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(0, yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a> - img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>), 4);</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(0, yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> - img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>), 4);</div>
<div class="line">        min_output_w = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> / cap_buf.<a id="a106" name="a106"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/d5f/structiav__enc__buf__cap.html#a641f4b1f701898439db5da676501ef54">max_zoom_in_factor</a> + 1, 4);</div>
<div class="line">        max_output_w = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> * cap_buf.<a id="a107" name="a107"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/d5f/structiav__enc__buf__cap.html#ab58fb47a278d550e74963d6fb0732ff3">max_zoom_out_factor</a> - 1, 4);</div>
<div class="line">        max_output_w = max_output_w &gt; img_scale_outbuf_width ? img_scale_outbuf_width : max_output_w;</div>
<div class="line">        min_output_h = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> / cap_buf.<a class="code hl_variableRef" target="_blank" href="../../../library/d5/d5f/structiav__enc__buf__cap.html#a641f4b1f701898439db5da676501ef54">max_zoom_in_factor</a> + 1, 4);</div>
<div class="line">        max_output_h = <a id="a108" name="a108"></a><a class="code hl_define" href="../../dummy.html">MIN</a>(<a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> * cap_buf.<a class="code hl_variableRef" target="_blank" href="../../../library/d5/d5f/structiav__enc__buf__cap.html#ab58fb47a278d550e74963d6fb0732ff3">max_zoom_out_factor</a> - 1, 4), cap_buf.<a id="a109" name="a109"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/d5f/structiav__enc__buf__cap.html#aa1281fe9a1e356ee476ec71c9f7914ac">max</a>.<a id="a110" name="a110"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>);</div>
<div class="line">        max_output_h = max_output_h &gt; img_scale_outbuf_height ? img_scale_outbuf_height : max_output_h;</div>
<div class="line">        output_width = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(min_output_w, max_output_w), 4);</div>
<div class="line">        <span class="keywordflow">if</span> (!output_width) {</div>
<div class="line">            output_width = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">        }</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> = output_width;</div>
<div class="line"> </div>
<div class="line">        output_height = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(rand_int_range(min_output_h, max_output_h), 4);</div>
<div class="line">        <span class="keywordflow">if</span> (!output_height) {</div>
<div class="line">            output_height = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">        }</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> = output_height;</div>
<div class="line"> </div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = input_buf_fd;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#ac9b722bcb09eeb9244043100441774b1">use_dma_buf_fd</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af6514d787f5e1925240357128607ee3e">use_phys</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a45b4ec9355164e5d76c74d0253e0982e">y_offset</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 16);</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a9efa8b8e4aa1423d4e68763966c3c129">uv_offset</a> = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> * img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">input_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a>;</div>
<div class="line"> </div>
<div class="line">        output_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = output_buf_fd;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#ac9b722bcb09eeb9244043100441774b1">use_dma_buf_fd</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#af6514d787f5e1925240357128607ee3e">use_phys</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a45b4ec9355164e5d76c74d0253e0982e">y_offset</a> = 0;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> = output_pitch;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a> = output_height;</div>
<div class="line">        img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a9efa8b8e4aa1423d4e68763966c3c129">uv_offset</a> = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">pitch</a> * img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">output_buf</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span>(ioctl(fd_iav, IAV_IOC_SET_IMG_SCALE, &amp;img_scale) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (errno == EAGAIN) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_SET_IMG_SCALE, try again&quot;</span>);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_SET_IMG_SCALE&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        wait_img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d40/structiav__wait__img__scale.html#aa55568ccbe384c224dfc109db3845708">task_id</a> = img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#aa55568ccbe384c224dfc109db3845708">task_id</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_WAIT_IMG_SCALE, &amp;wait_img_scale) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_WAIT_IMG_SCALE&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (save_to_file) {</div>
<div class="line">            memset(output_yuv_file, 0, <span class="keyword">sizeof</span>(output_yuv_file));</div>
<div class="line">            snprintf(output_yuv_file, <span class="keyword">sizeof</span>(output_yuv_file), <span class="stringliteral">&quot;%s_output%d_%dx%d.yuv&quot;</span>, filename, ++file_count,</div>
<div class="line">                output_width, output_height);</div>
<div class="line">            printf(<span class="stringliteral">&quot;filename: %s, test_img_scale -b %d --binoffset %dx%d --binsize %dx%d --boutsize %dx%d\n&quot;</span>,</div>
<div class="line">                output_yuv_file, src_canvas_id, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a>, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>,</div>
<div class="line">                img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">input</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>,</div>
<div class="line">                img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">output</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>);</div>
<div class="line">            output_fd_yuv = amba_transfer_open(output_yuv_file, transfer_method, port);</div>
<div class="line">            rval = save_yuv_data(output_fd_yuv, output_pitch, output_width, output_height, img_scale.<a class="code hl_variableRef" target="_blank" href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">format</a>,</div>
<div class="line">                output_buf, output_buf + output_pitch * output_height);</div>
<div class="line">            <span class="keywordflow">if</span> (output_fd_yuv &gt;= 0) {</div>
<div class="line">                amba_transfer_close(output_fd_yuv, transfer_method);</div>
<div class="line">                output_fd_yuv = -1;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">DO_RANDOM_IMG_SCALE_EXIT:</div>
<div class="line">    free_output_buf();</div>
<div class="line">    free_input_buf();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sigstop(<span class="keywordtype">int</span> a)</div>
<div class="line">{</div>
<div class="line">    quit_random_test = 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a111" name="a111"></a><a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"> </div>
<div class="line">    signal(SIGINT,  sigstop);</div>
<div class="line">    signal(SIGQUIT, sigstop);</div>
<div class="line">    signal(SIGTERM, sigstop);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        usage(argv[0]);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((fd_iav = open(<span class="stringliteral">&quot;/dev/iav&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;/dev/iav&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (prepare() &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (init_param(argc, argv) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (random_test) {</div>
<div class="line">        ret = do_random_img_scale();</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (input_file_specified) {</div>
<div class="line">        ret = do_input_file_img_scale();</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        ret = do_img_scale();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="ttc" id="aamba__defines_8h_html"><div class="ttname"><a href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a></div></div>
<div class="ttc" id="aasf__structure_8h_html_a92c50087ca0e64fa93fc59402c55f8ca"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></div><div class="ttdeci">uint8_t u8</div></div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div></div>
<div class="ttc" id="abasetypes_8h_html"><div class="ttname"><a href="../../de/ddc/basetypes_8h.html">basetypes.h</a></div><div class="ttdoc">This file defines basic types used in all IAV driver and header files.</div></div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div></div>
<div class="ttc" id="acJSON_8h_html_adb411a44855a4c49231d72a0fc9a3b3b"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div><div class="ttdeci">char const int const cJSON_bool format</div></div>
<div class="ttc" id="adummy_html"><div class="ttname"><a href="../../dummy.html">ROUND_UP</a></div><div class="ttdeci">#define ROUND_UP(x, n)</div></div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">iav_rect::y</a></div><div class="ttdeci">u32 y</div><div class="ttdoc">Offset Y.</div><div class="ttdef"><b>Definition:</b> basetypes.h:113</div></div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">iav_rect::width</a></div><div class="ttdeci">u32 width</div><div class="ttdoc">Width.</div><div class="ttdef"><b>Definition:</b> basetypes.h:114</div></div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">iav_rect::height</a></div><div class="ttdeci">u32 height</div><div class="ttdoc">Height.</div><div class="ttdef"><b>Definition:</b> basetypes.h:115</div></div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">iav_rect::x</a></div><div class="ttdeci">u32 x</div><div class="ttdoc">Offset X.</div><div class="ttdef"><b>Definition:</b> basetypes.h:112</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a></div><div class="ttdeci">DSP_CURRENT_MODE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a></div><div class="ttdeci">IAV_DESC_CANVAS</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaa1e977b4c4203d0b91b2d3533275e193a9acc659b6d59b9aecb2e9c5d5dceea02"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaa1e977b4c4203d0b91b2d3533275e193a9acc659b6d59b9aecb2e9c5d5dceea02">IAV_SRCBUF_PF</a></div><div class="ttdeci">IAV_SRCBUF_PF</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaabf1e7e9396378205769ee61a1f0dfb1a4a5b450caee6fec582543be0dd39f5cf"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a4a5b450caee6fec582543be0dd39f5cf">IAV_YUV_FORMAT_YUV420</a></div><div class="ttdeci">IAV_YUV_FORMAT_YUV420</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaabf1e7e9396378205769ee61a1f0dfb1a7267dbad8e48f5979944f9680643b2b6"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1a7267dbad8e48f5979944f9680643b2b6">IAV_YUV_FORMAT_YUV400</a></div><div class="ttdeci">IAV_YUV_FORMAT_YUV400</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaabf1e7e9396378205769ee61a1f0dfb1abf3ed3f30bd12637ad4b31aada7be919"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaabf1e7e9396378205769ee61a1f0dfb1abf3ed3f30bd12637ad4b31aada7be919">IAV_YUV_FORMAT_YUV422</a></div><div class="ttdeci">IAV_YUV_FORMAT_YUV422</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa">IAV_PART_DSP</a></div><div class="ttdeci">IAV_PART_DSP</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faaad312de47a183da5f2167b10c8c1e528"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faaad312de47a183da5f2167b10c8c1e528">IAV_PART_CANVAS_POOL</a></div><div class="ttdeci">IAV_PART_CANVAS_POOL</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a></div><div class="ttdeci">IAV_MEM_PARTITION</div></div>
<div class="ttc" id="astructhint__s_html"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html">hint_s</a></div></div>
<div class="ttc" id="astructhint__s_html_a2799cca21c05a4f99f4c8b3b178d0133"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">hint_s::str</a></div><div class="ttdeci">const char * str</div></div>
<div class="ttc" id="astructhint__s_html_aa56a50443afd9d2f7cf738fb7ffba168"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">hint_s::arg</a></div><div class="ttdeci">const char * arg</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html">iav_alloc_mem_part</a></div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_a189394c6bbc0d36422df8c5bc2ee1962"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a189394c6bbc0d36422df8c5bc2ee1962">iav_alloc_mem_part::pid</a></div><div class="ttdeci">u32 pid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1852</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_a8ea167dba5ed98a2ab50ff41dae8dde5"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a8ea167dba5ed98a2ab50ff41dae8dde5">iav_alloc_mem_part::enable_cache</a></div><div class="ttdeci">u32 enable_cache</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1855</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_a9ee64c7b918513891b3834b93ad0e501"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a9ee64c7b918513891b3834b93ad0e501">iav_alloc_mem_part::length</a></div><div class="ttdeci">unsigned long length</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1858</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_ac1369a1f209735864674d22517edfa76"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#ac1369a1f209735864674d22517edfa76">iav_alloc_mem_part::offset</a></div><div class="ttdeci">unsigned long offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1860</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_adac25b843a2cccd720a100c5b9b1b545"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#adac25b843a2cccd720a100c5b9b1b545">iav_alloc_mem_part::from_private</a></div><div class="ttdeci">u32 from_private</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1856</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a></div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_a423a515fa4f18a4a232501e84d5adbb2"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#a423a515fa4f18a4a232501e84d5adbb2">iav_canvas_cfg::manual_feed</a></div><div class="ttdeci">u16 manual_feed</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1476</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_a51993db991a3b2807df9114b0134ffdf"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#a51993db991a3b2807df9114b0134ffdf">iav_canvas_cfg::ext_mem</a></div><div class="ttdeci">u16 ext_mem</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1489</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_ae8cabdc5c24b46705eb7ad5e0fc54660"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">iav_canvas_cfg::canvas_id</a></div><div class="ttdeci">u8 canvas_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1470</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_a2f1e22f38f7be358c963bc2a979fbf4d"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">iav_canvasdesc::canvas_id</a></div><div class="ttdeci">u32 canvas_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2263</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_ad1847147a26fa6e714478a599d584f45"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#ad1847147a26fa6e714478a599d584f45">iav_canvasdesc::yuv</a></div><div class="ttdeci">struct iav_yuv_cap yuv</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2275</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_ad4f2b1cfb6206d376dd2b024c7c15b9a"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#ad4f2b1cfb6206d376dd2b024c7c15b9a">iav_canvasdesc::non_block_flag</a></div><div class="ttdeci">u32 non_block_flag</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2264</div></div>
<div class="ttc" id="astructiav__enc__buf__cap_html"><div class="ttname"><a href="../../../library/d5/d5f/structiav__enc__buf__cap.html">iav_enc_buf_cap</a></div></div>
<div class="ttc" id="astructiav__enc__buf__cap_html_a2830ebfe6ef0797f46e9fcc1945f4c01"><div class="ttname"><a href="../../../library/d5/d5f/structiav__enc__buf__cap.html#a2830ebfe6ef0797f46e9fcc1945f4c01">iav_enc_buf_cap::buf_id</a></div><div class="ttdeci">u8 buf_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1747</div></div>
<div class="ttc" id="astructiav__enc__buf__cap_html_a4eb5390353fb0508442db61e89ed786b"><div class="ttname"><a href="../../../library/d5/d5f/structiav__enc__buf__cap.html#a4eb5390353fb0508442db61e89ed786b">iav_enc_buf_cap::pass_id</a></div><div class="ttdeci">u8 pass_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1748</div></div>
<div class="ttc" id="astructiav__enc__buf__cap_html_a641f4b1f701898439db5da676501ef54"><div class="ttname"><a href="../../../library/d5/d5f/structiav__enc__buf__cap.html#a641f4b1f701898439db5da676501ef54">iav_enc_buf_cap::max_zoom_in_factor</a></div><div class="ttdeci">u16 max_zoom_in_factor</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1751</div></div>
<div class="ttc" id="astructiav__enc__buf__cap_html_aa1281fe9a1e356ee476ec71c9f7914ac"><div class="ttname"><a href="../../../library/d5/d5f/structiav__enc__buf__cap.html#aa1281fe9a1e356ee476ec71c9f7914ac">iav_enc_buf_cap::max</a></div><div class="ttdeci">struct iav_window max</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1750</div></div>
<div class="ttc" id="astructiav__enc__buf__cap_html_ab58fb47a278d550e74963d6fb0732ff3"><div class="ttname"><a href="../../../library/d5/d5f/structiav__enc__buf__cap.html#ab58fb47a278d550e74963d6fb0732ff3">iav_enc_buf_cap::max_zoom_out_factor</a></div><div class="ttdeci">u16 max_zoom_out_factor</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1752</div></div>
<div class="ttc" id="astructiav__gdma__copy_html"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html">iav_gdma_copy</a></div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a0d0bde0d1958779c9220d9a5501b14e4"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a0d0bde0d1958779c9220d9a5501b14e4">iav_gdma_copy::dst_mmap_type</a></div><div class="ttdeci">u32 dst_mmap_type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1965</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a12669f6c0f6cc6c1e39ac929c91df9a1"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a12669f6c0f6cc6c1e39ac929c91df9a1">iav_gdma_copy::dst_pitch</a></div><div class="ttdeci">u16 dst_pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1950</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a1c0b148c0d6c4ba4d318178fa7dd2557"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a1c0b148c0d6c4ba4d318178fa7dd2557">iav_gdma_copy::src_mmap_type</a></div><div class="ttdeci">u32 src_mmap_type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1961</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a311c949c3fef26a92db0d704c9e7225c"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a311c949c3fef26a92db0d704c9e7225c">iav_gdma_copy::src_pitch</a></div><div class="ttdeci">u16 src_pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1949</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a4a415c72ec8d9beafa3c8c85ae8b0e96"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a4a415c72ec8d9beafa3c8c85ae8b0e96">iav_gdma_copy::dst_use_dma_buf_fd</a></div><div class="ttdeci">u16 dst_use_dma_buf_fd</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1954</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a5008710d9c1103d9591b3eda550b63f7"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a5008710d9c1103d9591b3eda550b63f7">iav_gdma_copy::dst_offset</a></div><div class="ttdeci">unsigned long dst_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1945</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a5103232dda61eefd81b5b849643c5753"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a5103232dda61eefd81b5b849643c5753">iav_gdma_copy::width</a></div><div class="ttdeci">u16 width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1958</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a97949d79559df32a6ff2d2b423b0be39"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a97949d79559df32a6ff2d2b423b0be39">iav_gdma_copy::src_offset</a></div><div class="ttdeci">unsigned long src_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1940</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_add40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#add40f8a56ae8cc650f92a3aa4d2bac99">iav_gdma_copy::height</a></div><div class="ttdeci">u32 height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1959</div></div>
<div class="ttc" id="astructiav__img__scale_html"><div class="ttname"><a href="../../../library/da/d3b/structiav__img__scale.html">iav_img_scale</a></div></div>
<div class="ttc" id="astructiav__img__scale_html_a08ad25a527186afe77fc1a8deccf74d6"><div class="ttname"><a href="../../../library/da/d3b/structiav__img__scale.html#a08ad25a527186afe77fc1a8deccf74d6">iav_img_scale::output_buf</a></div><div class="ttdeci">struct iav_scale_buf_info output_buf</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1223</div></div>
<div class="ttc" id="astructiav__img__scale_html_a5cc577968961f6f76d740c9a5c4dc351"><div class="ttname"><a href="../../../library/da/d3b/structiav__img__scale.html#a5cc577968961f6f76d740c9a5c4dc351">iav_img_scale::input_buf</a></div><div class="ttdeci">struct iav_scale_buf_info input_buf</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1222</div></div>
<div class="ttc" id="astructiav__img__scale_html_a96d70b1736d2a18327af31d6b00c958b"><div class="ttname"><a href="../../../library/da/d3b/structiav__img__scale.html#a96d70b1736d2a18327af31d6b00c958b">iav_img_scale::output</a></div><div class="ttdeci">struct iav_rect output</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1220</div></div>
<div class="ttc" id="astructiav__img__scale_html_aa55568ccbe384c224dfc109db3845708"><div class="ttname"><a href="../../../library/da/d3b/structiav__img__scale.html#aa55568ccbe384c224dfc109db3845708">iav_img_scale::task_id</a></div><div class="ttdeci">u64 task_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1230</div></div>
<div class="ttc" id="astructiav__img__scale_html_ac2eab39ce1829256fbb1f813d5048b11"><div class="ttname"><a href="../../../library/da/d3b/structiav__img__scale.html#ac2eab39ce1829256fbb1f813d5048b11">iav_img_scale::input</a></div><div class="ttdeci">struct iav_rect input</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1219</div></div>
<div class="ttc" id="astructiav__img__scale_html_ad4f2b1cfb6206d376dd2b024c7c15b9a"><div class="ttname"><a href="../../../library/da/d3b/structiav__img__scale.html#ad4f2b1cfb6206d376dd2b024c7c15b9a">iav_img_scale::non_block_flag</a></div><div class="ttdeci">u32 non_block_flag</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1225</div></div>
<div class="ttc" id="astructiav__img__scale_html_ae7324fef292dd0ea4f0f36e3e5b2b4e0"><div class="ttname"><a href="../../../library/da/d3b/structiav__img__scale.html#ae7324fef292dd0ea4f0f36e3e5b2b4e0">iav_img_scale::format</a></div><div class="ttdeci">enum iav_yuv_format format</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1217</div></div>
<div class="ttc" id="astructiav__mem__info_html_a9ee64c7b918513891b3834b93ad0e501"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">iav_mem_info::length</a></div><div class="ttdeci">unsigned long length</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1842</div></div>
<div class="ttc" id="astructiav__mem__info_html_afde02ab53128286716345a7e3da30a7e"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">iav_mem_info::addr</a></div><div class="ttdeci">unsigned long addr</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1841</div></div>
<div class="ttc" id="astructiav__mem__part__info_html"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a></div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a189394c6bbc0d36422df8c5bc2ee1962"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">iav_mem_part_info::pid</a></div><div class="ttdeci">u32 pid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1847</div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a3bc6cd5f612ef6d8254970d363348350"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">iav_mem_part_info::mem</a></div><div class="ttdeci">struct iav_mem_info mem</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1848</div></div>
<div class="ttc" id="astructiav__querydesc_html"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a></div></div>
<div class="ttc" id="astructiav__querydesc_html_a8f1abab245b551bdff8a16e77bf819e9"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">iav_querydesc::canvas</a></div><div class="ttdeci">struct iav_canvasdesc canvas</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2419</div></div>
<div class="ttc" id="astructiav__querydesc_html_a99c68192c9905f231a62a98ee6534cbb"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">iav_querydesc::arg</a></div><div class="ttdeci">union iav_querydesc::@71 arg</div></div>
<div class="ttc" id="astructiav__querydesc_html_aa73b12ace6ac7df824707a89ac4f91ff"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#aa73b12ace6ac7df824707a89ac4f91ff">iav_querydesc::qid</a></div><div class="ttdeci">enum iav_desc_id qid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2413</div></div>
<div class="ttc" id="astructiav__querymem_html"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a></div></div>
<div class="ttc" id="astructiav__querymem_html_a01d475486b14a28a0583e09be9e66982"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">iav_querymem::partition</a></div><div class="ttdeci">struct iav_mem_part_info partition</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1925</div></div>
<div class="ttc" id="astructiav__querymem_html_a5955e20d0c53be1145cf813759d92d67"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">iav_querymem::arg</a></div><div class="ttdeci">union iav_querymem::@61 arg</div></div>
<div class="ttc" id="astructiav__querymem_html_ae056de5bb92261e7a28350beeb5320f8"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">iav_querymem::mid</a></div><div class="ttdeci">enum iav_mem_id mid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1923</div></div>
<div class="ttc" id="astructiav__scale__buf__info_html_a189394c6bbc0d36422df8c5bc2ee1962"><div class="ttname"><a href="../../../library/d9/dcb/structiav__scale__buf__info.html#a189394c6bbc0d36422df8c5bc2ee1962">iav_scale_buf_info::pid</a></div><div class="ttdeci">u32 pid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1197</div></div>
<div class="ttc" id="astructiav__scale__buf__info_html_a45b4ec9355164e5d76c74d0253e0982e"><div class="ttname"><a href="../../../library/d9/dcb/structiav__scale__buf__info.html#a45b4ec9355164e5d76c74d0253e0982e">iav_scale_buf_info::y_offset</a></div><div class="ttdeci">unsigned long y_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1205</div></div>
<div class="ttc" id="astructiav__scale__buf__info_html_a46a3d4708b9b955a65540f1c7f9d47b5"><div class="ttname"><a href="../../../library/d9/dcb/structiav__scale__buf__info.html#a46a3d4708b9b955a65540f1c7f9d47b5">iav_scale_buf_info::height</a></div><div class="ttdeci">u16 height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1213</div></div>
<div class="ttc" id="astructiav__scale__buf__info_html_a9efa8b8e4aa1423d4e68763966c3c129"><div class="ttname"><a href="../../../library/d9/dcb/structiav__scale__buf__info.html#a9efa8b8e4aa1423d4e68763966c3c129">iav_scale_buf_info::uv_offset</a></div><div class="ttdeci">unsigned long uv_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1209</div></div>
<div class="ttc" id="astructiav__scale__buf__info_html_ac9b722bcb09eeb9244043100441774b1"><div class="ttname"><a href="../../../library/d9/dcb/structiav__scale__buf__info.html#ac9b722bcb09eeb9244043100441774b1">iav_scale_buf_info::use_dma_buf_fd</a></div><div class="ttdeci">u32 use_dma_buf_fd</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1202</div></div>
<div class="ttc" id="astructiav__scale__buf__info_html_af58874517424bd8ff3f1ad693e6d062a"><div class="ttname"><a href="../../../library/d9/dcb/structiav__scale__buf__info.html#af58874517424bd8ff3f1ad693e6d062a">iav_scale_buf_info::dma_buf_fd</a></div><div class="ttdeci">int dma_buf_fd</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1198</div></div>
<div class="ttc" id="astructiav__scale__buf__info_html_af6514d787f5e1925240357128607ee3e"><div class="ttname"><a href="../../../library/d9/dcb/structiav__scale__buf__info.html#af6514d787f5e1925240357128607ee3e">iav_scale_buf_info::use_phys</a></div><div class="ttdeci">u32 use_phys</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1200</div></div>
<div class="ttc" id="astructiav__scale__buf__info_html_afae111e7926134912718c3dc283c64e4"><div class="ttname"><a href="../../../library/d9/dcb/structiav__scale__buf__info.html#afae111e7926134912718c3dc283c64e4">iav_scale_buf_info::pitch</a></div><div class="ttdeci">u16 pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1212</div></div>
<div class="ttc" id="astructiav__system__resource_html"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a></div></div>
<div class="ttc" id="astructiav__system__resource_html_a8471b8cc1bef7761e62b3b326231e98a"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html#a8471b8cc1bef7761e62b3b326231e98a">iav_system_resource::canvas_num</a></div><div class="ttdeci">u8 canvas_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1244</div></div>
<div class="ttc" id="astructiav__wait__img__scale_html"><div class="ttname"><a href="../../../library/dc/d40/structiav__wait__img__scale.html">iav_wait_img_scale</a></div></div>
<div class="ttc" id="astructiav__wait__img__scale_html_aa55568ccbe384c224dfc109db3845708"><div class="ttname"><a href="../../../library/dc/d40/structiav__wait__img__scale.html#aa55568ccbe384c224dfc109db3845708">iav_wait_img_scale::task_id</a></div><div class="ttdeci">u64 task_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1234</div></div>
<div class="ttc" id="astructiav__yuv__cap_html"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html">iav_yuv_cap</a></div></div>
<div class="ttc" id="astructiav__yuv__cap_html_a4eb7b75b76c9314ccc6582b332fdfb9d"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#a4eb7b75b76c9314ccc6582b332fdfb9d">iav_yuv_cap::uv_addr_offset</a></div><div class="ttdeci">unsigned long uv_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2184</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_a7ed2668fc9c18679b1a349a2f6914f3f"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#a7ed2668fc9c18679b1a349a2f6914f3f">iav_yuv_cap::y_addr_offset</a></div><div class="ttdeci">unsigned long y_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2183</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_a85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">iav_yuv_cap::width</a></div><div class="ttdeci">u32 width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2176</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_a8fb1c5212011391e7e4e75f750ed3a36"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#a8fb1c5212011391e7e4e75f750ed3a36">iav_yuv_cap::format</a></div><div class="ttdeci">u32 format</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2180</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_acd497cc6637ae5062f58897e65e16193"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">iav_yuv_cap::pitch</a></div><div class="ttdeci">u32 pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2178</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_add40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">iav_yuv_cap::height</a></div><div class="ttdeci">u32 height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2177</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aae"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aae">numeric_short_options</a></div><div class="ttdeci">numeric_short_options</div></div>
<div class="ttc" id="atest__fb_8h_html_a2d0022791143e08a64621257f48d9739"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a></div><div class="ttdeci">#define NO_ARG</div></div>
<div class="ttc" id="atest__fb_8h_html_affec572f11fcba59ce0cd49cbcd0110f"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a></div><div class="ttdeci">#define HAS_ARG</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
<div class="ttc" id="avin__init_8c_html_a5294002f7dca0cd9bcc0009a27895ef7"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a></div><div class="ttdeci">int fd_iav</div></div>
<div class="ttc" id="avout__init__cfg_8c_html_a88a5b93883c34229851d6a7a93254850"><div class="ttname"><a href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a></div><div class="ttdeci">#define AM_IOCTL(_filp, _cmd, _arg)</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
