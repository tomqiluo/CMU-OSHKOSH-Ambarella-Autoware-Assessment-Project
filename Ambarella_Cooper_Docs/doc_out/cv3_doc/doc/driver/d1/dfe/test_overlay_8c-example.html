<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driver: test_overlay.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Driver"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Driver<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d1/dfe/test_overlay_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test_overlay.c</div></div>
</div><!--header-->
<div class="contents">
<p >This is an example of how to apply overlay to a stream.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * test_overlay.c</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *    2013/12/02  - [Jian Tang] created</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2016 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents ( &quot;Software&quot; ) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/ddc/basetypes_8h.html">basetypes.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iav_ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DEFAULT_OVERLAY_AREA_NUM (4)</span></div>
<div class="line"><span class="preprocessor">#define MAX_ENCODE_STREAM_NUM   (IAV_STREAM_MAX_NUM_ALL)</span></div>
<div class="line"><span class="preprocessor">#define MAX_OVERLAY_AREA_NUM    (MAX_NUM_OVERLAY_AREA)</span></div>
<div class="line"><span class="preprocessor">#define MAX_BUFFER_NUM          (4)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_STREAMID(x)  do {        \</span></div>
<div class="line"><span class="preprocessor">            if (((x) &lt; 0) || ((x) &gt;= MAX_ENCODE_STREAM_NUM)) {  \</span></div>
<div class="line"><span class="preprocessor">                printf(&quot;stream id wrong %d \n&quot;</span>, (x));           \</div>
<div class="line">                return -1;  \</div>
<div class="line">            }   \</div>
<div class="line">        } while(0)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> osd_status_s {</div>
<div class="line">    INIT = 0,</div>
<div class="line">    OSD_ENABLE,</div>
<div class="line">    OSD_DISABLE,</div>
<div class="line">} osd_status_t;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define ROTATE_BIT      (0)</span></div>
<div class="line"><span class="preprocessor">#define HFLIP_BIT       (1)</span></div>
<div class="line"><span class="preprocessor">#define VFLIP_BIT       (2)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> rotate_type_s {</div>
<div class="line">    CLOCKWISE_0 = 0,</div>
<div class="line">    CLOCKWISE_90 = <a id="a0" name="a0"></a><a class="code hl_define" href="../../dummy.html">BIT</a>(ROTATE_BIT),</div>
<div class="line">    CLOCKWISE_180 = <a class="code hl_define" href="../../dummy.html">BIT</a>(<a id="a1" name="a1"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2ea53919c0c9fd8839c409d57093a76ec12">HFLIP_BIT</a>) | <a class="code hl_define" href="../../dummy.html">BIT</a>(<a id="a2" name="a2"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2eaf0d5339194eb23fed5fbfa711240b092">VFLIP_BIT</a>),</div>
<div class="line">    CLOCKWISE_270 = <a class="code hl_define" href="../../dummy.html">BIT</a>(<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2ea53919c0c9fd8839c409d57093a76ec12">HFLIP_BIT</a>) | <a class="code hl_define" href="../../dummy.html">BIT</a>(<a class="code hl_variableRef" target="_blank" href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2eaf0d5339194eb23fed5fbfa711240b092">VFLIP_BIT</a>) | <a class="code hl_define" href="../../dummy.html">BIT</a>(ROTATE_BIT),</div>
<div class="line">    AUTO_ROTATE,</div>
<div class="line">} rotate_type_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>osd_info_s {</div>
<div class="line">    <span class="keywordtype">int</span> enable;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> width;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> height;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> x;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> y;</div>
<div class="line">    <span class="keywordtype">int</span> bitmap;</div>
<div class="line">    <span class="keywordtype">int</span> update;</div>
<div class="line">    <span class="keywordtype">char</span> clut_file[256];</div>
<div class="line">    <span class="keywordtype">char</span> data_file[256];</div>
<div class="line">    <span class="keywordtype">int</span> buf_id;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> buf_data[MAX_BUFFER_NUM];</div>
<div class="line">} osd_info_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>stream_info_s {</div>
<div class="line">    <span class="keywordtype">int</span> enable;</div>
<div class="line">    rotate_type_t rotate;</div>
<div class="line">    <span class="keywordtype">int</span> win_width;</div>
<div class="line">    <span class="keywordtype">int</span> win_height;</div>
<div class="line">    osd_info_t osd[MAX_OVERLAY_AREA_NUM];</div>
<div class="line">    <span class="keywordtype">int</span> osd_insert_always;</div>
<div class="line">} stream_info_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> stream_info_t stream_info[MAX_ENCODE_STREAM_NUM];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a3" name="a3"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> stream_max_num = 12;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> overlay_max_num = DEFAULT_OVERLAY_AREA_NUM;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> update_intervals = 30;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> show_config_stream_id = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> show_config_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> verbose_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> update_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> overlay_size;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html">src/overlay_cfg.c</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> map_overlay(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a4" name="_a4"></a><a class="code hl_structRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a> query_mem = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a5" name="_a5"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a> *part_info = NULL;</div>
<div class="line"> </div>
<div class="line">    query_mem.<a id="a6" name="a6"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">mid</a> = <a id="a7" name="a7"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a>;</div>
<div class="line">    part_info = &amp;query_mem.<a id="a8" name="a8"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">arg</a>.<a id="a9" name="a9"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">partition</a>;</div>
<div class="line">    part_info-&gt;<a id="a10" name="a10"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = <a id="a11" name="a11"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa315de3f1ad692322b81caff751c23f30">IAV_PART_OVERLAY</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a12" name="a12"></a>IAV_IOC_QUERY_MEMBLOCK, &amp;query_mem) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_MEMBLOCK&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (part_info-&gt;<a id="a13" name="a13"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a14" name="a14"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a> == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;IAV_PART_OVERLAY is not allocated.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    overlay_size = part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    <a id="a15" name="a15"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#affd4b94feab1c5387223d5fed814715d">overlay_addr</a> = mmap(NULL, overlay_size, PROT_WRITE, MAP_SHARED, fd_iav,</div>
<div class="line">        part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a16" name="a16"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;overlay: map_overlay, start = 0x%p, total size = 0x%x\n&quot;</span>,</div>
<div class="line">           overlay_addr, overlay_size);</div>
<div class="line">    <span class="keywordflow">if</span> (overlay_addr == MAP_FAILED) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;mmap (%d) failed: %s\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//split into MAX_ENCODE_STREAM parts</span></div>
<div class="line">    <a id="a17" name="a17"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#a26ff9e58c084ba782fffadf10dd0a93b">overlay_yuv_size</a> = (overlay_size - <a id="a18" name="a18"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#aa01e68f485e9c8bad1d4522167c7fe3f">OVERLAY_YUV_OFFSET</a>) /</div>
<div class="line">        stream_max_num;</div>
<div class="line"> </div>
<div class="line">    <a id="a19" name="a19"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#afd064c95beb16fddfd1fbf3754b12739">buffer_num</a> = (update_intervals &gt;= <a id="a20" name="a20"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#a626bc2640fe7a6e4c84ad68bfe85e8ce">DOUBLE_BUFFER_MIN_UPDATE_INTERVALS</a> ?</div>
<div class="line">            2 : MAX_BUFFER_NUM);</div>
<div class="line">    <a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#a26ff9e58c084ba782fffadf10dd0a93b">overlay_yuv_size</a> /= <a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#afd064c95beb16fddfd1fbf3754b12739">buffer_num</a>;</div>
<div class="line">    printf(<span class="stringliteral">&quot;overlay: use [%d] buffer strategy. overlay size per stream is 0x%x\n&quot;</span>,</div>
<div class="line">           buffer_num, overlay_yuv_size);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> set_overlay(<span class="keywordtype">int</span> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, buf_id;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a21" name="_a21"></a><a class="code hl_structRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html">iav_overlay_area</a> *area;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (stream_info[stream_id].<a id="a22" name="a22"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a0e2494ebf03a421505fdc2f7499547e0">enable</a>) {</div>
<div class="line">    <span class="keywordflow">case</span> OSD_DISABLE:</div>
<div class="line">        <a id="a23" name="a23"></a>overlay_insert[stream_id].<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a0e2494ebf03a421505fdc2f7499547e0">enable</a> = 0;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> OSD_ENABLE:</div>
<div class="line">        overlay_insert[stream_id].enable = 1;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; overlay_max_num; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (overlay_insert[stream_id].area[i].<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a0e2494ebf03a421505fdc2f7499547e0">enable</a>) {</div>
<div class="line">                area = &amp;overlay_insert[stream_id].area[i];</div>
<div class="line">                buf_id = stream_info[stream_id].osd[i].buf_id;</div>
<div class="line">                area-&gt;<a id="a24" name="a24"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a16f01e9ac75392f8e05471ead76a95ae">data_addr_offset</a> = stream_info[stream_id].osd[i].buf_data[buf_id];</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    overlay_insert[stream_id].id = stream_id;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a25" name="a25"></a>IAV_IOC_SET_OVERLAY_INSERT, &amp;overlay_insert[stream_id]) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_SET_OVERLAY_INSERT&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> autorun_overlay(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, j, n, y, delta_y, buf_id, tmp, <a id="a26" name="a26"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#ad1221508cfc76342b087d11d7717f090">total_size</a>, spacing;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *overlay_data;</div>
<div class="line">    <span class="keywordtype">int</span> frame_count = 0;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a27" name="_a27"></a><a class="code hl_structRef" target="_blank" href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a> query_info;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a28" name="_a28"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html">iav_stream_info</a> *encode_info;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a29" name="_a29"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a> stream_cfg;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a30" name="_a30"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html">iav_stream_format</a> *stream_format;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html">iav_overlay_area</a> *area;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a31" name="_a31"></a><a class="code hl_structRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a> resource;</div>
<div class="line">    osd_info_t *osd;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">struct </span>timeval tm1, tm2;</div>
<div class="line">    <span class="keyword">struct </span>timeval *p_tm[2];</div>
<div class="line">    <span class="keywordtype">int</span> cur_tm = 0, retv = 0;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef VIN0_VSYNC</span></div>
<div class="line">    <span class="keywordtype">int</span> vin_fd = -1;</div>
<div class="line">    <span class="keywordtype">char</span> vin_int_arr[8];</div>
<div class="line">    <span class="keywordflow">if</span> ((vin_fd = open(<a id="a32" name="a32"></a>VIN0_VSYNC, O_RDONLY)) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;CANNOT open [%s].\n&quot;</span>, VIN0_VSYNC);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    p_tm[0] = &amp;tm1;</div>
<div class="line">    p_tm[1] = &amp;tm2;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (verbose_flag)</div>
<div class="line">        gettimeofday(&amp;tm2, NULL);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;resource, 0, <span class="keyword">sizeof</span>(resource));</div>
<div class="line">    resource.encode_mode = <a id="a33" name="a33"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a34" name="a34"></a>IAV_IOC_GET_SYSTEM_RESOURCE, &amp;resource) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;IAV_IOC_GET_SYSTEM_RESOURCE\n&quot;</span>);</div>
<div class="line">        retv = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; resource.max_stream_num; i++) {</div>
<div class="line">        memset(&amp;query_info, 0, <span class="keyword">sizeof</span>(query_info));</div>
<div class="line">        query_info.qid = <a id="a35" name="a35"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a>;</div>
<div class="line">        encode_info = &amp;query_info.arg.stream;</div>
<div class="line">        encode_info-&gt;<a id="a36" name="a36"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#a76f8ba65ce8f902c0657233adee58698">id</a> = i;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a37" name="a37"></a>IAV_IOC_QUERY_INFO, &amp;query_info) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_INFO&quot;</span>);</div>
<div class="line">            retv = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">        }</div>
<div class="line">        memset(&amp;stream_cfg, 0, <span class="keyword">sizeof</span>(stream_cfg));</div>
<div class="line">        stream_cfg.id = i;</div>
<div class="line">        stream_cfg.cid = <a id="a38" name="a38"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48">IAV_STMCFG_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a39" name="a39"></a>IAV_IOC_GET_STREAM_CONFIG, &amp;stream_cfg) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_GET_STREAM_CONFIG&quot;</span>);</div>
<div class="line">            retv = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">        }</div>
<div class="line">        stream_format = &amp;stream_cfg.arg.format;</div>
<div class="line">        <span class="keywordflow">if</span> (encode_info-&gt;<a id="a40" name="a40"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#ac78453cf0c29f2b9c40cfb142185d7d9">state</a> == <a id="a41" name="a41"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d">IAV_STREAM_STATE_ENCODING</a> ||</div>
<div class="line">            encode_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#ac78453cf0c29f2b9c40cfb142185d7d9">state</a> == <a id="a42" name="a42"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a6e9d926f59102b9563a722581c65ee55">IAV_STREAM_STATE_STARTING</a>) {</div>
<div class="line">            stream_info[i].enable = OSD_ENABLE;</div>
<div class="line">            stream_info[i].win_width = stream_format-&gt;<a id="a43" name="a43"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">enc_win</a>.<a id="a44" name="a44"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">            stream_info[i].win_height = stream_format-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">enc_win</a>.<a id="a45" name="a45"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">        overlay_data = <a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#affd4b94feab1c5387223d5fed814715d">overlay_addr</a> + <a class="code hl_defineRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#aa01e68f485e9c8bad1d4522167c7fe3f">OVERLAY_YUV_OFFSET</a> +</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#a26ff9e58c084ba782fffadf10dd0a93b">overlay_yuv_size</a> * i * <a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#afd064c95beb16fddfd1fbf3754b12739">buffer_num</a>;</div>
<div class="line">        overlay_insert[i].id = i;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (stream_info[i].enable == OSD_ENABLE) {</div>
<div class="line">            overlay_insert[i].enable = 1;</div>
<div class="line">            overlay_insert[i].osd_insert_always = stream_info[i].osd_insert_always;</div>
<div class="line">            total_size = 0;</div>
<div class="line">            spacing = <a id="a46" name="a46"></a><a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(stream_info[i].win_width /</div>
<div class="line">                    overlay_max_num, 2);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; overlay_max_num; ++j) {</div>
<div class="line">                area = &amp;overlay_insert[i].area[j];</div>
<div class="line">                osd = &amp;stream_info[i].osd[j];</div>
<div class="line">                area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a0e2494ebf03a421505fdc2f7499547e0">enable</a> = 1;</div>
<div class="line">                tmp = <a id="a47" name="a47"></a><a class="code hl_define" href="../../dummy.html">ROUND_UP</a>((stream_info[i].win_width - 48) /</div>
<div class="line">                    MAX_OVERLAY_AREA_NUM, 2);</div>
<div class="line">                area-&gt;<a id="a48" name="a48"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a6e06ce1467b8d80af1535b1bc0e43877">start_x</a> = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>(4 + spacing * j, 4);</div>
<div class="line">                area-&gt;<a id="a49" name="a49"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a5103232dda61eefd81b5b849643c5753">width</a> = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>((tmp &lt; 64 ? tmp : 64), 4);</div>
<div class="line">                area-&gt;<a id="a50" name="a50"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a> = <a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>((stream_info[i].win_height &gt; 240 ? 128 : 64), 4);</div>
<div class="line">                area-&gt;<a id="a51" name="a51"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#afae111e7926134912718c3dc283c64e4">pitch</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a5103232dda61eefd81b5b849643c5753">width</a>, <a id="a52" name="a52"></a>OSD_BUF_PITCH_ALIGN);</div>
<div class="line">                area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#ad1221508cfc76342b087d11d7717f090">total_size</a> = area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#afae111e7926134912718c3dc283c64e4">pitch</a> * area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a>;</div>
<div class="line">                area-&gt;<a id="a53" name="a53"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#ac47850d9186d86075d567a04c3c87f9d">clut_addr_offset</a> = ((overlay_max_num * i + j) %</div>
<div class="line">                    <a id="a54" name="a54"></a>OVERLAY_CLUT_NUM) * <a id="a55" name="a55"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#a280391618fab4180ec43a016941c4224">OVERLAY_CLUT_SIZE</a>;</div>
<div class="line">                <a id="a56" name="a56"></a>fill_overlay_clut(i, j, area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#ac47850d9186d86075d567a04c3c87f9d">clut_addr_offset</a>);</div>
<div class="line">                osd-&gt;buf_id = 0;</div>
<div class="line">                osd-&gt;update = 1;</div>
<div class="line">                <span class="keywordflow">for</span> (buf_id = 0; buf_id &lt; <a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#afd064c95beb16fddfd1fbf3754b12739">buffer_num</a>; buf_id++) {</div>
<div class="line">                    osd-&gt;buf_data[buf_id] = overlay_data + total_size +</div>
<div class="line">                        <a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#a26ff9e58c084ba782fffadf10dd0a93b">overlay_yuv_size</a> * buf_id - <a class="code hl_variableRef" target="_blank" href="../../../video/d9/dd6/overlay__cfg_8c.html#affd4b94feab1c5387223d5fed814715d">overlay_addr</a>;</div>
<div class="line">                }</div>
<div class="line">                total_size += area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#ad1221508cfc76342b087d11d7717f090">total_size</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (total_size &gt; overlay_yuv_size) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;OSD buffer memory is not enough, please increase it! &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;The total OSD size is %d (should be &lt;= %d).\n&quot;</span>,</div>
<div class="line">                        total_size, overlay_yuv_size);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <span class="keywordflow">for</span> (n = 0, y = 0, delta_y = 4; n &lt; 30; ++n) {</div>
<div class="line">            y += delta_y;</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (overlay_insert[i].enable) {</div>
<div class="line">                    <span class="keywordflow">for</span> (j = 0; j &lt; overlay_max_num; j++ ) {</div>
<div class="line">                        overlay_insert[i].area[j].start_y = y;</div>
<div class="line">                        <span class="keywordflow">if</span> (y + overlay_insert[i].area[j].height &gt; stream_info[i].win_height) {</div>
<div class="line">                            y = 0;</div>
<div class="line">                            overlay_insert[i].area[j].start_y = y;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <a id="a57" name="a57"></a>update_data(i);</div>
<div class="line">                    <span class="keywordflow">if</span> (set_overlay(i) &lt; 0) {</div>
<div class="line">                        retv = -1;</div>
<div class="line">                        <span class="keywordflow">goto</span> exit_auto_run;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">while</span> (frame_count &lt; update_intervals) {</div>
<div class="line"><span class="preprocessor">#ifdef VIN0_VSYNC</span></div>
<div class="line">                <a id="a58" name="a58"></a><a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(vin_fd, vin_int_arr, 8);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">                usleep(33000);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">                frame_count ++;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (frame_count &gt;= update_intervals)</div>
<div class="line">                frame_count = 0;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (verbose_flag) {</div>
<div class="line">                cur_tm = !cur_tm;</div>
<div class="line">                gettimeofday(p_tm[cur_tm], NULL);</div>
<div class="line">                printf(<span class="stringliteral">&quot;interval %ldus\n&quot;</span>,(1000000 * (p_tm[cur_tm]-&gt;tv_sec -</div>
<div class="line">                    p_tm[!cur_tm]-&gt;tv_sec) + (p_tm[cur_tm]-&gt;tv_usec -</div>
<div class="line">                    p_tm[!cur_tm]-&gt;tv_usec)));</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">exit_auto_run:</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef VIN0_VSYNC</span></div>
<div class="line">    <span class="keywordflow">if</span> (vin_fd &gt; 0) {</div>
<div class="line">        close(vin_fd);</div>
<div class="line">        vin_fd = 0;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> retv;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define STREAM_INIT_PARAMETERS()    \</span></div>
<div class="line"><span class="preprocessor">    case &#39;A&#39;:\</span></div>
<div class="line"><span class="preprocessor">    case &#39;B&#39;:\</span></div>
<div class="line"><span class="preprocessor">    case &#39;C&#39;:\</span></div>
<div class="line"><span class="preprocessor">    case &#39;D&#39;:\</span></div>
<div class="line"><span class="preprocessor">    case &#39;E&#39;:\</span></div>
<div class="line"><span class="preprocessor">        current_stream = ch - &#39;A&#39;;\</span></div>
<div class="line"><span class="preprocessor">        VERIFY_STREAMID(current_stream);\</span></div>
<div class="line"><span class="preprocessor">        stream_info[current_stream].enable = OSD_ENABLE;\</span></div>
<div class="line"><span class="preprocessor">        break;\</span></div>
<div class="line"><span class="preprocessor">    case &#39;S&#39;:\</span></div>
<div class="line"><span class="preprocessor">        current_stream = atoi(optarg);\</span></div>
<div class="line"><span class="preprocessor">        VERIFY_STREAMID(current_stream);\</span></div>
<div class="line"><span class="preprocessor">        stream_info[current_stream].enable = OSD_ENABLE;\</span></div>
<div class="line"><span class="preprocessor">        break;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DEBUG_INIT_PARAMETERS() \</span></div>
<div class="line"><span class="preprocessor">    case &#39;l&#39;:\</span></div>
<div class="line"><span class="preprocessor">        VERIFY_STREAMID(current_stream);\</span></div>
<div class="line"><span class="preprocessor">        show_config_stream_id |= (1 &lt;&lt; current_stream);\</span></div>
<div class="line"><span class="preprocessor">        show_config_flag = 1;\</span></div>
<div class="line"><span class="preprocessor">        break;\</span></div>
<div class="line"><span class="preprocessor">    case &#39;v&#39;:\</span></div>
<div class="line"><span class="preprocessor">        verbose_flag = 1;\</span></div>
<div class="line"><span class="preprocessor">        break;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define OSD_CFG_PARAMS()    \</span></div>
<div class="line"><span class="preprocessor">    case &#39;a&#39;:\</span></div>
<div class="line"><span class="preprocessor">        VERIFY_STREAMID(current_stream);\</span></div>
<div class="line"><span class="preprocessor">        current_area = atoi(optarg);\</span></div>
<div class="line"><span class="preprocessor">        VERIFY_AREAID(current_area);\</span></div>
<div class="line"><span class="preprocessor">        stream_info[current_stream].osd[current_area].enable = 1;\</span></div>
<div class="line"><span class="preprocessor">        break;\</span></div>
<div class="line"><span class="preprocessor">    case &#39;L&#39;:\</span></div>
<div class="line"><span class="preprocessor">        overlay_max_num = atoi(optarg);\</span></div>
<div class="line"><span class="preprocessor">        if (overlay_max_num &lt; 1 || overlay_max_num &gt; MAX_OVERLAY_AREA_NUM) {\</span></div>
<div class="line"><span class="preprocessor">            printf(&quot;the overlay max num shoud be [1~%d]\n&quot;</span>, MAX_OVERLAY_AREA_NUM);\</div>
<div class="line">            return -1;\</div>
<div class="line">        }\</div>
<div class="line">        printf(&quot;the overlay max num is %d\n&quot;, overlay_max_num);\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;x&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        VERIFY_AREAID(current_area);\</div>
<div class="line">        stream_info[current_stream].osd[current_area].x = atoi(optarg);\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;y&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        VERIFY_AREAID(current_area);\</div>
<div class="line">        stream_info[current_stream].osd[current_area].y = atoi(optarg);\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;w&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        VERIFY_AREAID(current_area);\</div>
<div class="line">        stream_info[current_stream].osd[current_area].width = atoi(optarg);\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;h&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        VERIFY_AREAID(current_area);\</div>
<div class="line">        stream_info[current_stream].osd[current_area].height = atoi(optarg);\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;i&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        stream_info[current_stream].osd_insert_always = !!(atoi(optarg));\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;c&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        VERIFY_AREAID(current_area);\</div>
<div class="line">        strcpy(stream_info[current_stream].osd[current_area].clut_file,\</div>
<div class="line">            optarg);\</div>
<div class="line">        stream_info[current_stream].osd[current_area].bitmap = 1;\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;d&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        VERIFY_AREAID(current_area);\</div>
<div class="line">        strcpy(stream_info[current_stream].osd[current_area].data_file,\</div>
<div class="line">            optarg);\</div>
<div class="line">        stream_info[current_stream].osd[current_area].bitmap = 1;\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;n&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        stream_info[current_stream].rotate = AUTO_ROTATE;\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;M&#39;:\</div>
<div class="line">        stream_max_num = atoi(optarg);\</div>
<div class="line">        if (stream_max_num &lt; 1 || stream_max_num &gt; MAX_ENCODE_STREAM_NUM) {\</div>
<div class="line">            printf(&quot;the stream max num shoud be [1~%d]\n&quot;, MAX_ENCODE_STREAM_NUM);\</div>
<div class="line">            return -1;\</div>
<div class="line">        }\</div>
<div class="line">        printf(&quot;the stream max num is %d\n&quot;, stream_max_num);\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;r&#39;:\</div>
<div class="line">        autorun_flag = 1;\</div>
<div class="line">        update_intervals = atoi(optarg);\</div>
<div class="line">        if (update_intervals &lt; 1) {\</div>
<div class="line">            printf(&quot;the intervals shoud &gt; 0\n&quot;);\</div>
<div class="line">            return -1;\</div>
<div class="line">        }\</div>
<div class="line">        printf(&quot;the interval for overlay is %d\n&quot;, update_intervals);\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;u&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        VERIFY_AREAID(current_area);\</div>
<div class="line">        stream_info[current_stream].osd[current_area].update = 1;\</div>
<div class="line">        update_flag = 1;\</div>
<div class="line">        break;\</div>
<div class="line">    case &#39;s&#39;:\</div>
<div class="line">        VERIFY_STREAMID(current_stream);\</div>
<div class="line">        stream_info[current_stream].enable = OSD_DISABLE;\</div>
<div class="line">        break;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NO_ARG    0</span></div>
<div class="line"><span class="preprocessor">#define HAS_ARG  1</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>option <a id="a59" name="a59"></a>long_options[] = {</div>
<div class="line">    {<span class="stringliteral">&quot;streamA&quot;</span>, <a id="a60" name="a60"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;A&#39;</span>},   <span class="comment">// -A xxxxx  means all following configs will be applied to stream A</span></div>
<div class="line">    {<span class="stringliteral">&quot;streamB&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;B&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;streamC&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;C&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;streamD&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;D&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;streamE&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;E&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;stream&quot;</span>, <a id="a61" name="a61"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;S&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;area&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;a&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;max-area-num&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;L&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;max-stream-num&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;M&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;xstart&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;x&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;ystart&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;y&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;width&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;w&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;height&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;h&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;update&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;u&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;insert-always&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;i&#39;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;clut_file&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;c&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;data_file&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;d&#39;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;norotate&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;n&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;disable&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;s&#39;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;autorun&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;r&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;show-config&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;l&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;verbose&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;v&#39;</span>},</div>
<div class="line"> </div>
<div class="line">    {0, 0, 0, 0}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a62" name="a62"></a>short_options = <span class="stringliteral">&quot;ABCDEa:x:y:w:h:ui:c:d:nM:L:sS:r:lv&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a id="_a63" name="_a63"></a><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a64" name="a64"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a65" name="a65"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> <a id="a66" name="a66"></a>hint[] = {</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream A&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream B&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream C&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream D&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset stream E&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;0~19&quot;</span>, <span class="stringliteral">&quot;\tspecify stream ID&quot;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;0~15&quot;</span>, <span class="stringliteral">&quot;\t\tset overlay area num&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;1~16&quot;</span>, <span class="stringliteral">&quot;\tset overlay area max num, default is 4.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;1~20&quot;</span>, <span class="stringliteral">&quot;\tset overlay stream max num, default is 12.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset x&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset y&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset width (must be larger than 32)&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tset height&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tupdate overlay data every second.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tAlways insert overlay including skipped frame; 0: disable, 1: enable, default is 0.&quot;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;filename&quot;</span>, <span class="stringliteral">&quot;read clut from file&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;filename&quot;</span>, <span class="stringliteral">&quot;read yuv index from file&quot;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tWhen rotate clockwise degree is 90/180/270, OSD is consistent with stream orientation.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tturn off overlay on stream&quot;</span>},</div>
<div class="line"> </div>
<div class="line">    {<span class="stringliteral">&quot;n&quot;</span>, <span class="stringliteral">&quot;\tupdate overlay info every n frame automatically&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tshow current overlay area settings&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tprint debug message&quot;</span>},</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a id="a67" name="a67"></a>usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;test_overlay usage:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(long_options) / <span class="keyword">sizeof</span>(long_options[0]) - 1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (isalpha(long_options[i].val))</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c &quot;</span>, long_options[i].val);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;--%s&quot;</span>, long_options[i].<a id="a68" name="a68"></a>name);</div>
<div class="line">        <span class="keywordflow">if</span> (hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>[0] != 0)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [%s]&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nExample:\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  Three rectangle OSD on one stream:\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    test_overlay -A -a0 -x0 -y0 -w128 -h64 -a1 -x200 -y100 -w64 -h128 -a2 -x0 -y300 -w48 -h96\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  Keep OSD upright on 270 degree clockwise stream:\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    test_encode -A --smaxsize 720x1280 -h720p --rotate 1 --hflip 1 --vflip 1 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    test_overlay -A -a0 -x100 -y200 -w100 -h200 --norotate\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  Update OSD data by rewriting osd buffer:\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    test_overlay -A -a0 -x0 -y100 -w64 -h128 -u\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  Update OSD every frame:\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    test_overlay -r 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  Always insert OSD including skipped frame:\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    test_overlay -A -a0 -x0 -y100 -w64 -h128 -u -i 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  Show current overlay area settings of streams:\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    test_overlay -A -l\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> init_param(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ch;</div>
<div class="line">    <span class="keywordtype">int</span> i, j;</div>
<div class="line">    <span class="keywordtype">int</span> error_flag[MAX_ENCODE_STREAM_NUM] = {0};</div>
<div class="line">    <span class="keywordtype">int</span> option_index = 0;</div>
<div class="line">    <span class="keywordtype">int</span> <a id="a69" name="a69"></a>current_stream = -1;        <span class="comment">// -1 is a invalid stream, for initialize data only</span></div>
<div class="line">    <span class="keywordtype">int</span> current_area = -1;          <span class="comment">// -1 is a invalid area, for initialize data only</span></div>
<div class="line"> </div>
<div class="line">    opterr = 0;</div>
<div class="line">    <span class="keywordflow">while</span> ((ch = getopt_long(argc, argv, short_options, long_options, &amp;option_index)) != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line"> </div>
<div class="line">        <a id="a70" name="a70"></a><a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#ad7384b69244455866e90c5d30d07a931">STREAM_INIT_PARAMETERS</a>()</div>
<div class="line"> </div>
<div class="line">        OSD_CFG_PARAMS()</div>
<div class="line"> </div>
<div class="line">        <a id="a71" name="a71"></a>DEBUG_INIT_PARAMETERS()</div>
<div class="line"> </div>
<div class="line">        default:</div>
<div class="line">            printf(&quot;unknown option found: %c\n&quot;, ch);</div>
<div class="line">            return -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    for (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> ((stream_info[i].enable == OSD_ENABLE) &amp;&amp;</div>
<div class="line">            !(show_config_stream_id &amp; (1 &lt;&lt; i)) ) {</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; overlay_max_num; j++) {</div>
<div class="line">                    <span class="keywordflow">if</span> (stream_info[i].osd[j].enable) {</div>
<div class="line">                        error_flag[i] = 1;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (!error_flag[i]) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Error usage! Need to specify overlay area for &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;stream %c\n&quot;</span>, <span class="charliteral">&#39;A&#39;</span> + i);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> show_overlay_config(<span class="keywordtype">int</span> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, j, total_size;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html">iav_overlay_area</a> * area = NULL;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; ++i) {</div>
<div class="line">        <span class="keywordflow">if</span> (stream_id &amp; (1 &lt;&lt; i)) {</div>
<div class="line">            overlay_insert[i].id = i;</div>
<div class="line">            <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a72" name="a72"></a>IAV_IOC_GET_OVERLAY_INSERT, &amp;overlay_insert[i]) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_GET_OVERLAY_INSERT&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            printf(<span class="stringliteral">&quot;\n  Stream %c overlay configuration :\n&quot;</span>, <span class="charliteral">&#39;A&#39;</span> + i);</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#ad1221508cfc76342b087d11d7717f090">total_size</a> = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; overlay_max_num; ++j) {</div>
<div class="line">                area = &amp;overlay_insert[i].area[j];</div>
<div class="line">                printf(<span class="stringliteral">&quot;    Area [%d] : size [%dx%d], offset [%dx%d], pitch [%d].\n&quot;</span>,</div>
<div class="line">                    j, area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a5103232dda61eefd81b5b849643c5753">width</a>, area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a46a3d4708b9b955a65540f1c7f9d47b5">height</a>, area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a6e06ce1467b8d80af1535b1bc0e43877">start_x</a>,</div>
<div class="line">                    area-&gt;<a id="a73" name="a73"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#aaacc4854ed6a383a5c2831762db5c81b">start_y</a>, area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#afae111e7926134912718c3dc283c64e4">pitch</a>);</div>
<div class="line">                <a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#ad1221508cfc76342b087d11d7717f090">total_size</a> += area-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#ad1221508cfc76342b087d11d7717f090">total_size</a>;</div>
<div class="line">            }</div>
<div class="line">            printf(<span class="stringliteral">&quot;  Total Size : [%d].\n&quot;</span>, <a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#ad1221508cfc76342b087d11d7717f090">total_size</a>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;  Always Insert : [%s].\n&quot;</span>, overlay_insert[i].osd_insert_always ? <span class="stringliteral">&quot;Enable&quot;</span> : <span class="stringliteral">&quot;Disable&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sigstop()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (stream_info[i].<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a0e2494ebf03a421505fdc2f7499547e0">enable</a> == OSD_ENABLE) {</div>
<div class="line">            overlay_insert[i].enable = 0;</div>
<div class="line">            overlay_insert[i].id = i;</div>
<div class="line">            <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_SET_OVERLAY_INSERT, &amp;overlay_insert[i]) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_SET_OVERLAY_INSERT&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    exit(0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a74" name="a74"></a><a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    signal(SIGINT, sigstop);</div>
<div class="line">    signal(SIGQUIT, sigstop);</div>
<div class="line">    signal(SIGTERM, sigstop);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((fd_iav = open(<span class="stringliteral">&quot;/dev/iav&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;/dev/iav&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        usage();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (init_param(argc, argv) &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a75" name="a75"></a>check_encode_status() &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (map_overlay() &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (show_config_flag) {</div>
<div class="line">        show_overlay_config(show_config_stream_id);</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a id="a76" name="a76"></a>autorun_flag) {</div>
<div class="line">        autorun_overlay();</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a77" name="a77"></a>prepare_overlay_config() &lt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (stream_info[i].<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a0e2494ebf03a421505fdc2f7499547e0">enable</a> != INIT) {</div>
<div class="line">                <span class="keywordflow">if</span> (set_overlay(i) &lt; 0)</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (update_flag) {</div>
<div class="line">            sleep(1);</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; stream_max_num; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (stream_info[i].<a class="code hl_variableRef" target="_blank" href="../../../library/dc/dcd/structiav__overlay__area.html#a0e2494ebf03a421505fdc2f7499547e0">enable</a> == OSD_ENABLE) {</div>
<div class="line">                    update_data(i);</div>
<div class="line">                    <span class="keywordflow">if</span> (set_overlay(i) &lt; 0)</div>
<div class="line">                        <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="aamba__defines_8h_html"><div class="ttname"><a href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a></div></div>
<div class="ttc" id="aamba__defines_8h_html_aa8f02d584fb0e103e7de071b3f79ce1f"><div class="ttname"><a href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a></div><div class="ttdeci">#define AMBA_READ_FILE(file, buf, size)</div><div class="ttdef"><b>Definition:</b> amba_defines.h:40</div></div>
<div class="ttc" id="aasf__structure_8h_html_a92c50087ca0e64fa93fc59402c55f8ca"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></div><div class="ttdeci">uint8_t u8</div></div>
<div class="ttc" id="aasf__structure_8h_html_ace9d960e74685e2cd84b36132dbbf8aa"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a></div><div class="ttdeci">uint16_t u16</div></div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div></div>
<div class="ttc" id="abasetypes_8h_html"><div class="ttname"><a href="../../de/ddc/basetypes_8h.html">basetypes.h</a></div><div class="ttdoc">This file defines basic types used in all IAV driver and header files.</div></div>
<div class="ttc" id="adummy_html"><div class="ttname"><a href="../../dummy.html">BIT</a></div><div class="ttdeci">#define BIT(n)</div></div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">iav_rect::width</a></div><div class="ttdeci">u32 width</div><div class="ttdoc">Width.</div><div class="ttdef"><b>Definition:</b> basetypes.h:114</div></div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">iav_rect::height</a></div><div class="ttdeci">u32 height</div><div class="ttdoc">Height.</div><div class="ttdef"><b>Definition:</b> basetypes.h:115</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a></div><div class="ttdeci">DSP_CURRENT_MODE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a></div><div class="ttdeci">IAV_INFO_STREAM</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga428a08cf3c46e0bd3847533c8a58e108a91dc482c7b74b55bd2448e7a6c191e48">IAV_STMCFG_FORMAT</a></div><div class="ttdeci">IAV_STMCFG_FORMAT</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a650b87779936da33300e49ee6fea821d">IAV_STREAM_STATE_ENCODING</a></div><div class="ttdeci">IAV_STREAM_STATE_ENCODING</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga5a8457a3780c3eb2c9452cae958284e4a6e9d926f59102b9563a722581c65ee55"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga5a8457a3780c3eb2c9452cae958284e4a6e9d926f59102b9563a722581c65ee55">IAV_STREAM_STATE_STARTING</a></div><div class="ttdeci">IAV_STREAM_STATE_STARTING</div></div>
<div class="ttc" id="agroup__nnctrl-helper_html_ggaeecd646cca3b6bbcc2f1e15a76ae5c2ea53919c0c9fd8839c409d57093a76ec12"><div class="ttname"><a href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2ea53919c0c9fd8839c409d57093a76ec12">HFLIP_BIT</a></div><div class="ttdeci">HFLIP_BIT</div></div>
<div class="ttc" id="agroup__nnctrl-helper_html_ggaeecd646cca3b6bbcc2f1e15a76ae5c2eaf0d5339194eb23fed5fbfa711240b092"><div class="ttname"><a href="../../../library/d9/d50/group__nnctrl-helper.html#ggaeecd646cca3b6bbcc2f1e15a76ae5c2eaf0d5339194eb23fed5fbfa711240b092">VFLIP_BIT</a></div><div class="ttdeci">VFLIP_BIT</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa315de3f1ad692322b81caff751c23f30"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa315de3f1ad692322b81caff751c23f30">IAV_PART_OVERLAY</a></div><div class="ttdeci">IAV_PART_OVERLAY</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a></div><div class="ttdeci">IAV_MEM_PARTITION</div></div>
<div class="ttc" id="aoverlay__cfg_8c_html"><div class="ttname"><a href="../../../video/d9/dd6/overlay__cfg_8c.html">overlay_cfg.c</a></div></div>
<div class="ttc" id="aoverlay__cfg_8c_html_a26ff9e58c084ba782fffadf10dd0a93b"><div class="ttname"><a href="../../../video/d9/dd6/overlay__cfg_8c.html#a26ff9e58c084ba782fffadf10dd0a93b">overlay_yuv_size</a></div><div class="ttdeci">int overlay_yuv_size</div></div>
<div class="ttc" id="aoverlay__cfg_8c_html_a280391618fab4180ec43a016941c4224"><div class="ttname"><a href="../../../video/d9/dd6/overlay__cfg_8c.html#a280391618fab4180ec43a016941c4224">OVERLAY_CLUT_SIZE</a></div><div class="ttdeci">#define OVERLAY_CLUT_SIZE</div></div>
<div class="ttc" id="aoverlay__cfg_8c_html_a626bc2640fe7a6e4c84ad68bfe85e8ce"><div class="ttname"><a href="../../../video/d9/dd6/overlay__cfg_8c.html#a626bc2640fe7a6e4c84ad68bfe85e8ce">DOUBLE_BUFFER_MIN_UPDATE_INTERVALS</a></div><div class="ttdeci">#define DOUBLE_BUFFER_MIN_UPDATE_INTERVALS</div></div>
<div class="ttc" id="aoverlay__cfg_8c_html_aa01e68f485e9c8bad1d4522167c7fe3f"><div class="ttname"><a href="../../../video/d9/dd6/overlay__cfg_8c.html#aa01e68f485e9c8bad1d4522167c7fe3f">OVERLAY_YUV_OFFSET</a></div><div class="ttdeci">#define OVERLAY_YUV_OFFSET</div></div>
<div class="ttc" id="aoverlay__cfg_8c_html_afd064c95beb16fddfd1fbf3754b12739"><div class="ttname"><a href="../../../video/d9/dd6/overlay__cfg_8c.html#afd064c95beb16fddfd1fbf3754b12739">buffer_num</a></div><div class="ttdeci">int buffer_num</div></div>
<div class="ttc" id="aoverlay__cfg_8c_html_affd4b94feab1c5387223d5fed814715d"><div class="ttname"><a href="../../../video/d9/dd6/overlay__cfg_8c.html#affd4b94feab1c5387223d5fed814715d">overlay_addr</a></div><div class="ttdeci">u8 * overlay_addr</div></div>
<div class="ttc" id="astream__cfg_8c_html_ad7384b69244455866e90c5d30d07a931"><div class="ttname"><a href="../../../video/da/d30/stream__cfg_8c.html#ad7384b69244455866e90c5d30d07a931">STREAM_INIT_PARAMETERS</a></div><div class="ttdeci">#define STREAM_INIT_PARAMETERS()</div></div>
<div class="ttc" id="astructhint__s_html"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html">hint_s</a></div></div>
<div class="ttc" id="astructhint__s_html_a2799cca21c05a4f99f4c8b3b178d0133"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">hint_s::str</a></div><div class="ttdeci">const char * str</div></div>
<div class="ttc" id="astructhint__s_html_aa56a50443afd9d2f7cf738fb7ffba168"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">hint_s::arg</a></div><div class="ttdeci">const char * arg</div></div>
<div class="ttc" id="astructiav__mem__info_html_a9ee64c7b918513891b3834b93ad0e501"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">iav_mem_info::length</a></div><div class="ttdeci">unsigned long length</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1842</div></div>
<div class="ttc" id="astructiav__mem__info_html_afde02ab53128286716345a7e3da30a7e"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">iav_mem_info::addr</a></div><div class="ttdeci">unsigned long addr</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1841</div></div>
<div class="ttc" id="astructiav__mem__part__info_html"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a></div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a189394c6bbc0d36422df8c5bc2ee1962"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">iav_mem_part_info::pid</a></div><div class="ttdeci">u32 pid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1847</div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a3bc6cd5f612ef6d8254970d363348350"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">iav_mem_part_info::mem</a></div><div class="ttdeci">struct iav_mem_info mem</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1848</div></div>
<div class="ttc" id="astructiav__overlay__area_html"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html">iav_overlay_area</a></div></div>
<div class="ttc" id="astructiav__overlay__area_html_a0e2494ebf03a421505fdc2f7499547e0"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html#a0e2494ebf03a421505fdc2f7499547e0">iav_overlay_area::enable</a></div><div class="ttdeci">u16 enable</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3053</div></div>
<div class="ttc" id="astructiav__overlay__area_html_a16f01e9ac75392f8e05471ead76a95ae"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html#a16f01e9ac75392f8e05471ead76a95ae">iav_overlay_area::data_addr_offset</a></div><div class="ttdeci">unsigned long data_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3063</div></div>
<div class="ttc" id="astructiav__overlay__area_html_a46a3d4708b9b955a65540f1c7f9d47b5"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html#a46a3d4708b9b955a65540f1c7f9d47b5">iav_overlay_area::height</a></div><div class="ttdeci">u16 height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3060</div></div>
<div class="ttc" id="astructiav__overlay__area_html_a5103232dda61eefd81b5b849643c5753"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html#a5103232dda61eefd81b5b849643c5753">iav_overlay_area::width</a></div><div class="ttdeci">u16 width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3058</div></div>
<div class="ttc" id="astructiav__overlay__area_html_a6e06ce1467b8d80af1535b1bc0e43877"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html#a6e06ce1467b8d80af1535b1bc0e43877">iav_overlay_area::start_x</a></div><div class="ttdeci">u16 start_x</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3056</div></div>
<div class="ttc" id="astructiav__overlay__area_html_aaacc4854ed6a383a5c2831762db5c81b"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html#aaacc4854ed6a383a5c2831762db5c81b">iav_overlay_area::start_y</a></div><div class="ttdeci">u16 start_y</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3057</div></div>
<div class="ttc" id="astructiav__overlay__area_html_ac47850d9186d86075d567a04c3c87f9d"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html#ac47850d9186d86075d567a04c3c87f9d">iav_overlay_area::clut_addr_offset</a></div><div class="ttdeci">unsigned long clut_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3062</div></div>
<div class="ttc" id="astructiav__overlay__area_html_ad1221508cfc76342b087d11d7717f090"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html#ad1221508cfc76342b087d11d7717f090">iav_overlay_area::total_size</a></div><div class="ttdeci">u32 total_size</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3061</div></div>
<div class="ttc" id="astructiav__overlay__area_html_afae111e7926134912718c3dc283c64e4"><div class="ttname"><a href="../../../library/dc/dcd/structiav__overlay__area.html#afae111e7926134912718c3dc283c64e4">iav_overlay_area::pitch</a></div><div class="ttdeci">u16 pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3059</div></div>
<div class="ttc" id="astructiav__queryinfo_html"><div class="ttname"><a href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a></div></div>
<div class="ttc" id="astructiav__querymem_html"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a></div></div>
<div class="ttc" id="astructiav__querymem_html_a01d475486b14a28a0583e09be9e66982"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">iav_querymem::partition</a></div><div class="ttdeci">struct iav_mem_part_info partition</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1925</div></div>
<div class="ttc" id="astructiav__querymem_html_a5955e20d0c53be1145cf813759d92d67"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">iav_querymem::arg</a></div><div class="ttdeci">union iav_querymem::@61 arg</div></div>
<div class="ttc" id="astructiav__querymem_html_ae056de5bb92261e7a28350beeb5320f8"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">iav_querymem::mid</a></div><div class="ttdeci">enum iav_mem_id mid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1923</div></div>
<div class="ttc" id="astructiav__stream__cfg_html"><div class="ttname"><a href="../../../library/d1/df3/structiav__stream__cfg.html">iav_stream_cfg</a></div></div>
<div class="ttc" id="astructiav__stream__format_html"><div class="ttname"><a href="../../../library/dd/d8d/structiav__stream__format.html">iav_stream_format</a></div></div>
<div class="ttc" id="astructiav__stream__format_html_a65ef0c6089bb9f2e7ac25171c2a27dae"><div class="ttname"><a href="../../../library/dd/d8d/structiav__stream__format.html#a65ef0c6089bb9f2e7ac25171c2a27dae">iav_stream_format::enc_win</a></div><div class="ttdeci">struct iav_rect enc_win</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2555</div></div>
<div class="ttc" id="astructiav__stream__info_html"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html">iav_stream_info</a></div></div>
<div class="ttc" id="astructiav__stream__info_html_a76f8ba65ce8f902c0657233adee58698"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html#a76f8ba65ce8f902c0657233adee58698">iav_stream_info::id</a></div><div class="ttdeci">u32 id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1075</div></div>
<div class="ttc" id="astructiav__stream__info_html_ac78453cf0c29f2b9c40cfb142185d7d9"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html#ac78453cf0c29f2b9c40cfb142185d7d9">iav_stream_info::state</a></div><div class="ttdeci">enum iav_stream_state state</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1076</div></div>
<div class="ttc" id="astructiav__system__resource_html"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a></div></div>
<div class="ttc" id="atest__fb_8h_html_a2d0022791143e08a64621257f48d9739"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a></div><div class="ttdeci">#define NO_ARG</div></div>
<div class="ttc" id="atest__fb_8h_html_affec572f11fcba59ce0cd49cbcd0110f"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a></div><div class="ttdeci">#define HAS_ARG</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
<div class="ttc" id="avin__init_8c_html_a5294002f7dca0cd9bcc0009a27895ef7"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a></div><div class="ttdeci">int fd_iav</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
