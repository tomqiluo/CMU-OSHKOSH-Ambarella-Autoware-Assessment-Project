<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driver: test_decode.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Driver"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Driver<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('df/d53/test_decode_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test_decode.c</div></div>
</div><!--header-->
<div class="contents">
<p >This is an example of how to decode a video clip.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * test_decode.c</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *  2015/01/27 - [Zhi He] create file</span></div>
<div class="line"><span class="comment"> *  2018/08/06 - [Zhaoyang Chen] update file</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2016 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents (&quot;Software&quot;) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;pthread.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;semaphore.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/ddc/basetypes_8h.html">basetypes.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iav_ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../video/da/d57/codec__parser_8h.html">codec_parser.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html">playback_helper.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;dec_msg_queue.c&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../video/d2/de8/dec__lua__cfg_8c.html">dec_lua_cfg.c</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html">test_decode.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef AM_IOCTL</span></div>
<div class="line"><span class="preprocessor">#define AM_IOCTL(_filp, _cmd, _arg) \</span></div>
<div class="line"><span class="preprocessor">        do {                        \</span></div>
<div class="line"><span class="preprocessor">            if (ioctl(_filp, _cmd, _arg) &lt; 0) { \</span></div>
<div class="line"><span class="preprocessor">                perror(#_cmd);      \</span></div>
<div class="line"><span class="preprocessor">                return -1;          \</span></div>
<div class="line"><span class="preprocessor">            }                       \</span></div>
<div class="line"><span class="preprocessor">        } while (0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define u_printf                printf</span></div>
<div class="line"><span class="preprocessor">#define u_printf_error          printf</span></div>
<div class="line"><span class="preprocessor">#define u_printf_debug          printf</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> decode_running              = 1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> feed_bitstream_done         = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> playback_1xfw               = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> last_timestamp     = 0;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define M_MSG_KILL                      0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define M_MSG_FW_FROM_BEGIN             1</span></div>
<div class="line"><span class="preprocessor">#define M_MSG_BW_FROM_END               2</span></div>
<div class="line"><span class="preprocessor">#define M_MSG_FW_FROM_CUR_GOP           3</span></div>
<div class="line"><span class="preprocessor">#define M_MSG_BW_FROM_CUR_GOP           4</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define D_FILE_READ_BUF_SIZE            (16 * 1024 * 1024)</span></div>
<div class="line"><span class="preprocessor">#define D_READ_COPY_BUF_SIZE            (16 * 1024 * 1024)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_NUM_DECODER                 8</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DAMBA_AVC_GOP_HEADER_LENGTH     22</span></div>
<div class="line"><span class="preprocessor">#define DAMBA_HEVC_GOP_HEADER_LENGTH    23</span></div>
<div class="line"><span class="preprocessor">#define DAMBA_RESERVED_SPACE            32</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_FILE_LENGTH                 512</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DECODER_BSB_ALIGN_SIZE          (1 &lt;&lt; 13)</span></div>
<div class="line"><span class="preprocessor">#define DECODER_BSB_MIN_SIZE            (1 &lt;&lt; 19)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> {</div>
<div class="line">    FAST_NAVI_MODE_ALL_FRAME_FORWARD    = 0x00,</div>
<div class="line">    FAST_NAVI_MODE_I_FRAME_FORWARD      = 0x01,</div>
<div class="line"> </div>
<div class="line">    FAST_NAVI_MODE_ALL_FRAME_BACKWARD   = 0x02,</div>
<div class="line">    FAST_NAVI_MODE_I_FRAME_BACKWARD     = 0x03,</div>
<div class="line"> </div>
<div class="line">    PLAYBACK_PENDDING                   = 0x08,</div>
<div class="line">    PLAYBACK_ERROR                      = 0x09,</div>
<div class="line">    PLAYBACK_EXIT                       = 0x0a,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">int</span> <a id="a0" name="a0"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>;                              <span class="comment">// decoder index or ID</span></div>
<div class="line">    msg_queue_t cmd_queue;                  <span class="comment">// cmd queue for operations</span></div>
<div class="line">    pthread_t thread_id;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a id="_a1" name="_a1"></a><a class="code hl_structRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html">iav_decoder_info</a> decoder_info;   <span class="comment">//iav info</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> filename[MAX_FILE_LENGTH];         <span class="comment">// file reader</span></div>
<div class="line">    FILE* file_fd;</div>
<div class="line">    <span class="keywordtype">void</span>* prealloc_file_buffer;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> rd_buffer_size;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clip_width;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clip_height;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> current_trickplay;                   <span class="comment">// trickplay</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> cur_pb_mode;                         <span class="comment">// 0: all frame, 1: I only</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> cur_speed;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p_bsb_start;                        <span class="comment">// bitstream buffer</span></div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p_bsb_end;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>decode_context* parent;</div>
<div class="line"> </div>
<div class="line">    <a id="_a2" name="_a2"></a><a class="code hl_structRef" target="_blank" href="../../../video/d4/d36/structfast__navi__file.html">fast_navi_file</a> fast_navi;               <span class="comment">// fast navi</span></div>
<div class="line">    <span class="keywordtype">int</span> navi_mode;</div>
<div class="line"> </div>
<div class="line">    FILE* p_dump_input_file;                <span class="comment">// dump bitstream buffer</span></div>
<div class="line">    <span class="keywordtype">int</span> trickplay_index;</div>
<div class="line">} decoder_instance;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">int</span> source_id;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> rotate;</div>
<div class="line">    <span class="keywordtype">int</span> flip;</div>
<div class="line">    <span class="keywordtype">int</span> offset_x;</div>
<div class="line">    <span class="keywordtype">int</span> offset_y;</div>
<div class="line">    <span class="keywordtype">int</span> width;</div>
<div class="line">    <span class="keywordtype">int</span> height;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vout_mode;</div>
<div class="line">} vout_device_info;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">int</span> iav_fd;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a3" name="_a3"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html">iav_decode_mode_config</a> mode_config;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> enable_debug_log;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> specify_fps;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> enable_prefetch;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> prefetch_count;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_fastnavi_mode;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> dump_input_bitstream;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> debug_read_direct_to_bsb;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> dec_cfg_lua;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> watch_last_pts;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> initial_navi_mode;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> initial_speed;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> vout_num;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> debug_use_dproc;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> debug_return_idle;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> playback_flag;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> repeat_count;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> enter_idle_flag;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> reset_vout_flag;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> disable_runtime_cmd_flag;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> reserved[1];</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> max_bitrate;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> framerate_den;  <span class="comment">// fps = 90000/framerate_den</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> <a id="a4" name="a4"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#ae6aee241a74597e11d6f0886cc96fbcc">max_width</a>;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> <a id="a5" name="a5"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a9960573acbcc1bced168f0e4a7f5ae89">max_height</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> max_n_to_m_ratio;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> max_gop_size;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> gop_m;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> gop_n;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *bsb_base;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> bsb_size;</div>
<div class="line"> </div>
<div class="line">    vout_device_info vout_dev_info[<a id="a6" name="a6"></a><a class="code hl_define" href="../../dummy.html">VOUT_NUM</a>];</div>
<div class="line"> </div>
<div class="line">    decoder_instance decoder[MAX_NUM_DECODER];</div>
<div class="line"> </div>
<div class="line">} decode_context;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> dec_cfg_name[MAX_FILE_LENGTH];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> fill_amba_gop_header(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_avc, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_gop_header, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> frame_tick, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> time_scale, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pts,</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> gopsize, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> m)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> tick_high = frame_tick;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> tick_low = tick_high &amp; 0x0000ffff;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> scale_high = time_scale;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> scale_low = scale_high &amp; 0x0000ffff;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pts_high = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pts_low = 0;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_data = NULL;</div>
<div class="line"> </div>
<div class="line">    tick_high &gt;&gt;= 16;</div>
<div class="line">    scale_high &gt;&gt;= 16;</div>
<div class="line"> </div>
<div class="line">    p_gop_header[0] = 0; <span class="comment">// start code prefix</span></div>
<div class="line">    p_gop_header[1] = 0;</div>
<div class="line">    p_gop_header[2] = 0;</div>
<div class="line">    p_gop_header[3] = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (is_avc) {</div>
<div class="line">        p_gop_header[4] = 0x7a; <span class="comment">// nal type is 0x1a</span></div>
<div class="line">        p_gop_header[5] = 0x01; <span class="comment">// version main</span></div>
<div class="line">        p_gop_header[6] = 0x01; <span class="comment">// version sub</span></div>
<div class="line"> </div>
<div class="line">        p_data = &amp;p_gop_header[7];</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        p_gop_header[4] = 0x34; <span class="comment">// nal type is 0x1a</span></div>
<div class="line">        p_gop_header[5] = 0x01;</div>
<div class="line">        p_gop_header[6] = 0x01; <span class="comment">// version main</span></div>
<div class="line">        p_gop_header[7] = 0x01; <span class="comment">// version sub</span></div>
<div class="line"> </div>
<div class="line">        p_data = &amp;p_gop_header[8];</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    p_data[0] = tick_high &gt;&gt; 10;</div>
<div class="line">    p_data[1] = tick_high &gt;&gt; 2;</div>
<div class="line">    p_data[2] = (tick_high &lt;&lt; 6) | (1 &lt;&lt; 5) | (tick_low &gt;&gt; 11);</div>
<div class="line">    p_data[3] = tick_low &gt;&gt; 3;</div>
<div class="line"> </div>
<div class="line">    p_data[4] = (tick_low &lt;&lt; 5) | (1 &lt;&lt; 4) | (scale_high &gt;&gt; 12);</div>
<div class="line">    p_data[5] = scale_high &gt;&gt; 4;</div>
<div class="line">    p_data[6] = (scale_high &lt;&lt; 4) | (1 &lt;&lt; 3) | (scale_low &gt;&gt; 13);</div>
<div class="line">    p_data[7] = scale_low &gt;&gt; 5;</div>
<div class="line"> </div>
<div class="line">    p_data[8] = (scale_low &lt;&lt; 3) | (1 &lt;&lt; 2) | (pts_high &gt;&gt; 14);</div>
<div class="line">    p_data[9] = pts_high &gt;&gt; 6;</div>
<div class="line"> </div>
<div class="line">    p_data[10] = (pts_high &lt;&lt; 2) | (1 &lt;&lt; 1) | (pts_low &gt;&gt; 15);</div>
<div class="line">    p_data[11] = pts_low &gt;&gt; 7;</div>
<div class="line">    p_data[12] = (pts_low &lt;&lt; 1) | 1;</div>
<div class="line"> </div>
<div class="line">    p_data[13] = gopsize;</div>
<div class="line">    p_data[14] = (m &amp; 0xf) &lt;&lt; 4;</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> update_amba_gop_header(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> is_avc, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_gop_header, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pts)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pts_high = (pts &gt;&gt; 16) &amp; 0x0000ffff;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pts_low = pts &amp; 0x0000ffff;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_pts_data = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (is_avc) {</div>
<div class="line">        p_pts_data = &amp;p_gop_header[15];</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        p_pts_data = &amp;p_gop_header[16];</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    p_pts_data[0] = (p_pts_data[0] &amp; 0xFC) | (pts_high &gt;&gt; 14);</div>
<div class="line">    p_pts_data[1] = pts_high &gt;&gt; 6;</div>
<div class="line">    p_pts_data[2] = (pts_high &lt;&lt; 2) | (1 &lt;&lt; 1) | (pts_low &gt;&gt; 15);</div>
<div class="line">    p_pts_data[3] = pts_low &gt;&gt; 7;</div>
<div class="line">    p_pts_data[4] = (pts_low &lt;&lt; 1) | 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> print_vout_info(<span class="keywordtype">int</span> iav_fd)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a7" name="_a7"></a><a class="code hl_structRef" target="_blank" href="../../../library/d6/d21/structvout__params.html">vout_params</a> params;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_define" href="../../dummy.html">VOUT_NUM</a>; i++) {</div>
<div class="line">        memset(&amp;params, 0x0, <span class="keyword">sizeof</span>(params));</div>
<div class="line">        params.id = i;</div>
<div class="line">        <a id="a8" name="a8"></a><a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, <a id="a9" name="a9"></a>IAV_IOC_VOUT_GET_PARAMS, &amp;params);</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;VOUT %d: w %d, h %d, enable %d, rotate %d, flip %d.\n&quot;</span>, i, params.vout_win.width,</div>
<div class="line">            params.vout_win.height, params.video_enable, params.video_rotate, params.video_flip);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_single_vout_info(vout_device_info* voutinfo, <span class="keywordtype">int</span> iav_fd)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d6/d21/structvout__params.html">vout_params</a> params;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;params, 0x0, <span class="keyword">sizeof</span>(params));</div>
<div class="line">    params.id = voutinfo-&gt;source_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, IAV_IOC_VOUT_GET_PARAMS, &amp;params);</div>
<div class="line">    <span class="keywordflow">if</span> (params.video_enable == 1) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;Vout[%d] is active.\n&quot;</span>, params.id);</div>
<div class="line">        voutinfo-&gt;source_id = params.id;</div>
<div class="line">        voutinfo-&gt;width = params.vout_win.width;</div>
<div class="line">        voutinfo-&gt;height = params.vout_win.height;</div>
<div class="line">        voutinfo-&gt;offset_x = params.vout_win.x;</div>
<div class="line">        voutinfo-&gt;offset_y = params.vout_win.y;</div>
<div class="line">        voutinfo-&gt;rotate = params.video_rotate;</div>
<div class="line">        voutinfo-&gt;flip = params.video_flip;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">goto</span> GET_SINGLE_VOUT_INFO_ERROR;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (voutinfo-&gt;width &amp;&amp; voutinfo-&gt;height) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[vout info][%d]: width %d, height %d, offset_x %d, offset_y %d, &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;rotate %d, flip %d.\n&quot;</span>, voutinfo-&gt;source_id, voutinfo-&gt;width,</div>
<div class="line">            voutinfo-&gt;height, voutinfo-&gt;offset_x, voutinfo-&gt;offset_y,</div>
<div class="line">            voutinfo-&gt;rotate, voutinfo-&gt;flip);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: VOUT[%d] is not configured.\n&quot;</span>, params.id);</div>
<div class="line">        <span class="keywordflow">goto</span> GET_SINGLE_VOUT_INFO_ERROR;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">GET_SINGLE_VOUT_INFO_ERROR:</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* find_h264_sps_header(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">while</span> (len) {</div>
<div class="line">        <span class="keywordflow">if</span> (!p[0] &amp;&amp; !p[1]) {</div>
<div class="line">            <span class="keywordflow">if</span> ((p[2] == 0x00) &amp;&amp; (p[3] == 0x01) &amp;&amp; ((p[4] &amp; 0x1F) == 0x07)) {</div>
<div class="line">                <span class="keywordflow">return</span> p + 5;</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((p[2] == 0x01) &amp;&amp; ((p[3] &amp; 0x1F) == 0x07)) {</div>
<div class="line">                <span class="keywordflow">return</span> p + 4;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        ++p;</div>
<div class="line">        len--;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> get_h265_vps_sps_pps(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *data_base, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> data_size,</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> **p_vps, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *vps_size, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> **p_sps,</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *sps_size, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> **p_pps, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *pps_size)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> has_vps = 0, has_sps = 0, has_pps = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *ptr = data_base, *ptr_end = data_base + data_size;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nal_type = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((NULL == ptr) || (!data_size)) {</div>
<div class="line">        u_printf_error(<span class="stringliteral">&quot;[ERROR]: NULL pointer(%p) or zero size(%d)!\n&quot;</span>,</div>
<div class="line">            data_base, data_size);</div>
<div class="line">        <span class="keywordflow">return</span> (-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (ptr &lt; ptr_end) {</div>
<div class="line">        <span class="keywordflow">if</span> (*ptr == 0x00) {</div>
<div class="line">            <span class="keywordflow">if</span> (*(ptr + 1) == 0x00) {</div>
<div class="line">                <span class="keywordflow">if</span> (*(ptr + 2) == 0x00) {</div>
<div class="line">                    <span class="keywordflow">if</span> (*(ptr + 3) == 0x01) {</div>
<div class="line">                        nal_type = (ptr[4] &gt;&gt; 1) &amp; 0x3F;</div>
<div class="line">                        <span class="keywordflow">if</span> (32 == nal_type) {</div>
<div class="line">                            has_vps = 1;</div>
<div class="line">                            *p_vps = ptr;</div>
<div class="line">                            ptr += 3;</div>
<div class="line">                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (33 == nal_type) {</div>
<div class="line">                            *p_sps = ptr;</div>
<div class="line">                            has_sps = 1;</div>
<div class="line">                            ptr += 3;</div>
<div class="line">                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (34 == nal_type) {</div>
<div class="line">                            *p_pps = ptr;</div>
<div class="line">                            has_pps = 1;</div>
<div class="line">                            ptr += 3;</div>
<div class="line">                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (has_vps &amp;&amp; has_sps &amp;&amp; has_pps) {</div>
<div class="line">                            *vps_size = (<span class="keywordtype">unsigned</span> int)((*p_sps) - (*p_vps));</div>
<div class="line">                            *sps_size = (<span class="keywordtype">unsigned</span> int)((*p_pps) - (*p_sps));</div>
<div class="line">                            *pps_size = (<span class="keywordtype">unsigned</span> int)(ptr - (*p_pps));</div>
<div class="line">                            <span class="keywordflow">return</span> 0;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*(ptr + 2) == 0x01) {</div>
<div class="line">                    nal_type = (ptr[3] &gt;&gt; 1) &amp; 0x3F;</div>
<div class="line">                    <span class="keywordflow">if</span> (32 == nal_type) {</div>
<div class="line">                        has_vps = 1;</div>
<div class="line">                        *p_vps = ptr;</div>
<div class="line">                        ptr += 2;</div>
<div class="line">                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (33 == nal_type) {</div>
<div class="line">                        has_sps = 1;</div>
<div class="line">                        *p_sps = ptr;</div>
<div class="line">                        ptr += 2;</div>
<div class="line">                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (34 == nal_type) {</div>
<div class="line">                        has_pps = 1;</div>
<div class="line">                        *p_pps = ptr;</div>
<div class="line">                        ptr += 2;</div>
<div class="line">                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (has_vps &amp;&amp; has_sps &amp;&amp; has_pps) {</div>
<div class="line">                        *vps_size = (<span class="keywordtype">unsigned</span> int)((*p_sps) - (*p_vps));</div>
<div class="line">                        *sps_size = (<span class="keywordtype">unsigned</span> int)((*p_pps) - (*p_sps));</div>
<div class="line">                        *pps_size = (<span class="keywordtype">unsigned</span> int)(ptr - (*p_pps));</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        ++ptr;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (has_vps &amp;&amp; has_sps &amp;&amp; has_pps) {</div>
<div class="line">        *vps_size = (<span class="keywordtype">unsigned</span> int)((*p_sps) - (*p_vps));</div>
<div class="line">        *sps_size = (<span class="keywordtype">unsigned</span> int)((*p_pps) - (*p_sps));</div>
<div class="line">        *pps_size = (<span class="keywordtype">unsigned</span> int)(ptr - (*p_pps));</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (-2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> _print_memory(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">while</span> (size &gt; 7) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%02x %02x %02x %02x %02x %02x %02x %02x\n&quot;</span>, p[0], p[1], p[2], p[3], p[4], p[5], p[6], p[7]);</div>
<div class="line">        p += 8;</div>
<div class="line">        size -= 8;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (size) {</div>
<div class="line">        <span class="keywordflow">while</span> (size) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;%02x &quot;</span>, p[0]);</div>
<div class="line">            p ++;</div>
<div class="line">            size --;</div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_first_and_last_8bytes(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p_end, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* buf_start,</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* buf_end, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size1 = 0, size2 = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* ptmp = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((p + 7) &lt; buf_end) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;begin(size 0x%x): %02x %02x %02x %02x, %02x %02x %02x %02x.\n&quot;</span>,</div>
<div class="line">            size, p[0], p[1], p[2], p[3], p[4], p[5], p[6], p[7]);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        size1 = buf_end - p;</div>
<div class="line">        size2 = 8 - size1;</div>
<div class="line"> </div>
<div class="line">        ptmp = p;</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;begin(size 0x%x):&quot;</span>, size);</div>
<div class="line">        <span class="keywordflow">while</span> (size1) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot; %02x&quot;</span>, ptmp[0]);</div>
<div class="line">            ptmp ++;</div>
<div class="line">            size1 --;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ptmp = buf_start;</div>
<div class="line">        <span class="keywordflow">while</span> (size2) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot; %02x&quot;</span>, ptmp[0]);</div>
<div class="line">            ptmp ++;</div>
<div class="line">            size2 --;</div>
<div class="line">        }</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (p_end &gt; (buf_start + 7)) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;end: %02x %02x %02x %02x, %02x %02x %02x %02x.\n&quot;</span>, p_end[-8], p_end[-7],</div>
<div class="line">            p_end[-6], p_end[-5], p_end[-4], p_end[-3], p_end[-2], p_end[-1]);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        size1 = p_end - buf_start;</div>
<div class="line">        size2 = 8 - size1;</div>
<div class="line"> </div>
<div class="line">        ptmp = buf_end - size2;</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;end:&quot;</span>);</div>
<div class="line">        <span class="keywordflow">while</span> (size2) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot; %02x&quot;</span>, ptmp[0]);</div>
<div class="line">            ptmp ++;</div>
<div class="line">            size2 --;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ptmp = buf_start;</div>
<div class="line">        <span class="keywordflow">while</span> (size1) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot; %02x&quot;</span>, ptmp[0]);</div>
<div class="line">            ptmp ++;</div>
<div class="line">            size1 --;</div>
<div class="line">        }</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> enter_decode_mode(decode_context* context, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> max_width, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> max_height,</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> max_bitrate, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> support_ff_fb_bw, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> use_dproc, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> max_n_to_m_ratio)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html">iav_decode_mode_config</a> *decode_mode = &amp;context-&gt;mode_config;</div>
<div class="line"> </div>
<div class="line">    decode_mode-&gt;<a id="a10" name="a10"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a35e6ea9d1ad99e035fe2f0d730c62b31">support_ff_fb_bw</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a35e6ea9d1ad99e035fe2f0d730c62b31">support_ff_fb_bw</a>;</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: Before IAV_IOC_ENTER_DECODE_MODE, max_width %d, max_height %d, max_bitrate &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;%d Mbps, support fast fwbw %d.\n&quot;</span>, <a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#ae6aee241a74597e11d6f0886cc96fbcc">max_width</a>, <a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a9960573acbcc1bced168f0e4a7f5ae89">max_height</a>, max_bitrate, <a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a35e6ea9d1ad99e035fe2f0d730c62b31">support_ff_fb_bw</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(context-&gt;iav_fd, <a id="a11" name="a11"></a>IAV_IOC_ENTER_DECODE_MODE, decode_mode);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> leave_decode_mode(decode_context* context)</div>
<div class="line">{</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: Before IAV_IOC_LEAVE_DECODE_MODE.\n&quot;</span>);</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(context-&gt;iav_fd, <a id="a12" name="a12"></a>IAV_IOC_LEAVE_DECODE_MODE, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> enter_idle(<span class="keywordtype">int</span> fd)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a13" name="_a13"></a><a class="code hl_structRef" target="_blank" href="../../../library/d7/d46/structiav__idle__params.html">iav_idle_params</a> idle_params = {0};</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: Before enter idle.\n&quot;</span>);</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd, <a id="a14" name="a14"></a>IAV_IOC_ENTER_IDLE, &amp;idle_params);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: Enter idle done.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ioctl_create_decoder(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code hl_structRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html">iav_decoder_info</a> *decode_info)</div>
<div class="line">{</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: Before IAV_IOC_CREATE_DECODER\n&quot;</span>);</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd, <a id="a15" name="a15"></a>IAV_IOC_CREATE_DECODER, decode_info);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ioctl_destroy_decoder(<span class="keywordtype">int</span> iav_fd, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> decoder_id)</div>
<div class="line">{</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: Before IAV_IOC_DESTROY_DECODER\n&quot;</span>);</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, <a id="a16" name="a16"></a>IAV_IOC_DESTROY_DECODER, decoder_id);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> open_dump_file(decoder_instance* context, <span class="keyword">const</span> <span class="keywordtype">char</span>* file_tail)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> filename[MAX_FILE_LENGTH + 128] = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;p_dump_input_file) {</div>
<div class="line">        fclose(context-&gt;p_dump_input_file);</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;Close previous opened dump file!\n&quot;</span>);</div>
<div class="line">        context-&gt;p_dump_input_file = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    snprintf(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s_%08x.%s&quot;</span>, context-&gt;filename,</div>
<div class="line">        context-&gt;trickplay_index, file_tail);</div>
<div class="line">    context-&gt;trickplay_index ++;</div>
<div class="line"> </div>
<div class="line">    context-&gt;p_dump_input_file = fopen(filename, <span class="stringliteral">&quot;wb+&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!context-&gt;p_dump_input_file) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: Open dump file [%s] fail, please check if the filename is valid.\n&quot;</span>,</div>
<div class="line">            filename);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> open_input_file(decoder_instance* inst, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> decoder_type)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_sps = NULL, *p_vps = NULL, *p_pps = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vps_size = 0, sps_size = 0, pps_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    inst-&gt;clip_width = 0;</div>
<div class="line">    inst-&gt;clip_height = 0;</div>
<div class="line"> </div>
<div class="line">    msg_queue_init(&amp;inst-&gt;cmd_queue);</div>
<div class="line">    inst-&gt;file_fd = fopen(inst-&gt;filename, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!inst-&gt;file_fd) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: Open file [%s] fail, please check if the filename is valid!\n&quot;</span>,</div>
<div class="line">            inst-&gt;filename);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    inst-&gt;rd_buffer_size = D_FILE_READ_BUF_SIZE;</div>
<div class="line">    inst-&gt;prealloc_file_buffer = malloc(inst-&gt;rd_buffer_size);</div>
<div class="line">    <span class="keywordflow">if</span> (!inst-&gt;prealloc_file_buffer) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: Buffer malloc fail, request size %d!\n&quot;</span>, inst-&gt;rd_buffer_size);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//parse sps to get bit-stream width and height</span></div>
<div class="line">    <a id="a17" name="a17"></a><a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa6d89b223ba1d6d6b2f8308b45789f60">AMBA_FREAD_FILE</a>(inst-&gt;prealloc_file_buffer, 1, 8 * 1024, inst-&gt;file_fd);</div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a18" name="a18"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a4ae5fb6b6d878ad88a8bff8b3b20af91">IAV_DEC_TYPE_H264</a> == decoder_type) {</div>
<div class="line">        p_sps = find_h264_sps_header(inst-&gt;prealloc_file_buffer, 8 * 1024);</div>
<div class="line">        <span class="keywordflow">if</span> (!p_sps) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[ERROR]: Failed to find sps in file %s!\n&quot;</span>, inst-&gt;filename);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a19" name="a19"></a><a class="code hl_functionRef" target="_blank" href="../../../video/da/d57/codec__parser_8h.html#a2fcc52d38a61df4c1a80514eea479a2e">get_h264_reso_from_sps</a>(p_sps, 256, &amp;inst-&gt;clip_width, &amp;inst-&gt;clip_height) &lt; 0) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[ERROR]: Failed to parse sps, use 1920x1080 instead!\n&quot;</span>);</div>
<div class="line">            inst-&gt;clip_width = 1920;</div>
<div class="line">            inst-&gt;clip_height = 1080;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> ((inst-&gt;clip_height == 1088) &amp;&amp; (inst-&gt;clip_width == 1920)) {</div>
<div class="line">                inst-&gt;clip_height = 1080;</div>
<div class="line">            }</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;Parsed h264 sps for file %s, clip width %d, height %d\n&quot;</span>, inst-&gt;filename,</div>
<div class="line">                inst-&gt;clip_width, inst-&gt;clip_height);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a id="a20" name="a20"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a3507538744216d4eb584662c10da89cc">IAV_DEC_TYPE_H265</a> == decoder_type) {</div>
<div class="line">         ret= get_h265_vps_sps_pps(inst-&gt;prealloc_file_buffer, 8 * 1024, &amp;p_vps, &amp;vps_size, &amp;p_sps,</div>
<div class="line">            &amp;sps_size, &amp;p_pps, &amp;pps_size);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!ret) {</div>
<div class="line">            <a id="a21" name="a21"></a><a class="code hl_functionRef" target="_blank" href="../../../video/da/d57/codec__parser_8h.html#a26b9cde66921e8fb55e2366e7f43c3a0">get_h265_reso_from_sps</a>(p_sps + 6, sps_size - 6, &amp;inst-&gt;clip_width, &amp;inst-&gt;clip_height);</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;Parsed h265 sps for file %s, clip width %d, height %d\n&quot;</span>, inst-&gt;filename,</div>
<div class="line">                inst-&gt;clip_width, inst-&gt;clip_height);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            u_printf_error(<span class="stringliteral">&quot;[ERROR]: Failed to parse h265 sps for file %s!\n&quot;</span>, inst-&gt;filename);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: Unsupported decoder type %d!\n&quot;</span>, decoder_type);</div>
<div class="line">        <span class="keywordflow">return</span> -3;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> create_decoder(decode_context *context, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> dec_id, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> dec_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html">iav_decoder_info</a> *dec_info = &amp;context-&gt;decoder[dec_id].decoder_info;</div>
<div class="line">    decoder_instance *instance = &amp;context-&gt;decoder[dec_id];</div>
<div class="line"> </div>
<div class="line">    instance-&gt;current_trickplay = <a id="a22" name="a22"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73ad6c57690f06691de342336b20504e812">IAV_DEC_RESUME</a>;</div>
<div class="line"> </div>
<div class="line">    dec_info-&gt;<a id="a23" name="a23"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a> = dec_id;</div>
<div class="line">    dec_info-&gt;<a id="a24" name="a24"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html#acf77f34fbc1b70a26ef6a14a89ea8a54">decoder_type</a> = dec_type;</div>
<div class="line">    dec_info-&gt;<a id="a25" name="a25"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html#ae686294e9676edd5a7b27f738d0bddad">num_vout</a> = context-&gt;mode_config.enable_vout[dec_id];</div>
<div class="line">    dec_info-&gt;<a id="a26" name="a26"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html#aa1b7e0a7448470096a63cc9b01d08952">video_width</a> = instance-&gt;clip_width;</div>
<div class="line">    dec_info-&gt;<a id="a27" name="a27"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html#a846773ff20fb73dfd60034f472267cee">video_height</a> = instance-&gt;clip_height;</div>
<div class="line"> </div>
<div class="line">    dec_info-&gt;<a id="a28" name="a28"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html#a1277d9039ea5adf9f1c935503cfd7233">bsb_start_offset</a> = instance-&gt;p_bsb_start - context-&gt;bsb_base;</div>
<div class="line">    dec_info-&gt;<a id="a29" name="a29"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html#a3369e573156f7e983df79c12372b557c">bsb_size</a> = instance-&gt;p_bsb_end - instance-&gt;p_bsb_start;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ioctl_create_decoder(context-&gt;iav_fd, dec_info) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[Debug]: Create_decoder[%d] done: p_bsb_start %p, p_bsb_end %p, bsb_size %d\n&quot;</span>,</div>
<div class="line">        dec_id, instance-&gt;p_bsb_start, instance-&gt;p_bsb_end, dec_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/dec/structiav__decoder__info.html#a3369e573156f7e983df79c12372b557c">bsb_size</a>);</div>
<div class="line"> </div>
<div class="line">    instance-&gt;parent = (<span class="keyword">struct </span>decode_context*)context;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;dump_input_bitstream) {</div>
<div class="line">        open_dump_file(instance, <span class="stringliteral">&quot;fw1x.dump&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> destroy_decoder(decode_context *context, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> decoder_id)</div>
<div class="line">{</div>
<div class="line">    decoder_instance *instance = &amp;context-&gt;decoder[decoder_id];</div>
<div class="line"> </div>
<div class="line">    ioctl_destroy_decoder(context-&gt;iav_fd, decoder_id);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (instance-&gt;prealloc_file_buffer) {</div>
<div class="line">        free(instance-&gt;prealloc_file_buffer);</div>
<div class="line">        instance-&gt;prealloc_file_buffer = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (instance-&gt;file_fd) {</div>
<div class="line">        fclose(instance-&gt;file_fd);</div>
<div class="line">        instance-&gt;file_fd = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (instance-&gt;p_dump_input_file) {</div>
<div class="line">        fclose(instance-&gt;p_dump_input_file);</div>
<div class="line">        instance-&gt;p_dump_input_file = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    msg_queue_deinit(&amp;instance-&gt;cmd_queue);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> load_lua_cfg(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    rval = <a id="a30" name="a30"></a><a class="code hl_functionRef" target="_blank" href="../../../video/d2/de8/dec__lua__cfg_8c.html#aa89fd9c5e0ec0ebeb8a4539cf0da4169">read_dec_cfg_from_lua</a>(dec_cfg_name, &amp;<a id="a31" name="a31"></a>mc_dec_cfg);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_cmds()</div>
<div class="line">{</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;\ntest_decode runtime cmds: press cmd + Enter\n&quot;</span>);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;\t&#39;q&#39;: Quit unit test\n&quot;</span>);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;\t&#39; &#39;: pause/resume\n&quot;</span>);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;\t&#39;s&#39;: step play\n&quot;</span>);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;\t&#39;f%%d&#39;: fast forward, %%d = 1 or 2, will choose all frame decoding, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;4, 8 will choose I frame only\n&quot;</span>);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;\t&#39;b%%d&#39;: fast backward, %%d = 1, will choose all frame decoding, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;2, 4, 8 will choose I frame only\n&quot;</span>);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;\t&#39;z%%d&#39;: zoom, %%d = 1~4, will display quater of the FOV, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;5 will randomly pick the input window, 0 return to full FOV.\n&quot;</span>);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;\t&#39;zi%%dx%%d,%%dx%%d&#39;: zoom window offest,size\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a id="a32" name="a32"></a>usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    printf(<span class="stringliteral">&quot;test_decode usage:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(<a id="a33" name="a33"></a>long_opts) / <span class="keyword">sizeof</span>(long_opts[0]) - 1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (isalpha(long_opts[i].val))</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c &quot;</span>, long_opts[i].val);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;--%s&quot;</span>, long_opts[i].<a id="a34" name="a34"></a>name);</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a35" name="a35"></a>hint[i].arg[0] != 0)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [%s]&quot;</span>, hint[i].arg);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, hint[i].str);</div>
<div class="line">    }</div>
<div class="line">    print_cmds();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_param(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv, decode_context* context)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line">    <span class="keywordtype">int</span> ch;</div>
<div class="line">    <span class="keywordtype">int</span> option_index = 0;</div>
<div class="line">    <span class="keywordtype">int</span> times = 0;</div>
<div class="line"> </div>
<div class="line">    opterr = 0;</div>
<div class="line">    <span class="keywordflow">while</span> ((ch = getopt_long(argc, argv, <a id="a36" name="a36"></a>short_opts, long_opts, &amp;option_index)) != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line">                snprintf(context-&gt;decoder[0].filename, MAX_FILE_LENGTH, <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">                context-&gt;decoder[0].filename[MAX_FILE_LENGTH - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">                context-&gt;playback_flag = 1;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] -f: %s.\n&quot;</span>, context-&gt;decoder[0].filename);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div>
<div class="line">                snprintf(dec_cfg_name, MAX_FILE_LENGTH, <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">                load_lua_cfg();</div>
<div class="line">                context-&gt;dec_cfg_lua = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line">                times = atoi(optarg);</div>
<div class="line">                <span class="keywordflow">if</span> ((times == -1) || (times == 0)) {</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;[input argument] -r, repeat till quit manually.\n&quot;</span>);</div>
<div class="line">                    context-&gt;repeat_count = -1;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;[input argument] -r, play %d times.\n&quot;</span>, times);</div>
<div class="line">                    context-&gt;repeat_count = times - 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">                context-&gt;mode_config.decoder_type[0] = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a4ae5fb6b6d878ad88a8bff8b3b20af91">IAV_DEC_TYPE_H264</a>;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] -h, decoder type is h264.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;H&#39;</span>:</div>
<div class="line">                context-&gt;mode_config.decoder_type[0] = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a3507538744216d4eb584662c10da89cc">IAV_DEC_TYPE_H265</a>;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] -H, decoder type is h265.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div>
<div class="line">                context-&gt;gop_n = atoi(optarg);</div>
<div class="line">                <span class="keywordflow">if</span> (context-&gt;gop_n &lt; 1 || context-&gt;gop_n &gt; 4095) {</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;[ERROR]: [input argument] --N invalid value [%d], must be in &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;[1~4095].\n&quot;</span>, context-&gt;gop_n);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:</div>
<div class="line">                context-&gt;gop_m = atoi(optarg);</div>
<div class="line">                <span class="keywordflow">if</span> (context-&gt;gop_m &lt; 1 || context-&gt;gop_m &gt; 3) {</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;ERROR: [input argument] --M invalid value [%d], must be in [1~3].\n&quot;</span>,</div>
<div class="line">                        context-&gt;gop_m);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a37" name="a37"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeabe3ae013477841c299e82691b42554ce">SPECIFY_IDLE</a>:</div>
<div class="line">                context-&gt;enter_idle_flag = 1;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --idle, enter idle.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a38" name="a38"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeabbdd4b479a9c12f67bfaa13d5fff368d">SPECIFY_FAST_NAVI_MODE</a>:</div>
<div class="line">                context-&gt;is_fastnavi_mode = 1;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --fastnavi, fast navi mode, will build navigation tree first.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a39" name="a39"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea65c1269bb4477d122ce344d15b917d03">SPECIFY_DUMP_INPUT_MODE</a>:</div>
<div class="line">                context-&gt;dump_input_bitstream = 1;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --dumpinput, dump input bitsream.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a40" name="a40"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeab8f9a6c3e9acf3f874668a3169aec7cc">SPECIFY_DIRECT_READ_MODE</a>:</div>
<div class="line">                context-&gt;debug_read_direct_to_bsb = 1;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --directread, direct read file data to bsb.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a41" name="a41"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeaabdd9e9712d5d4568c9cecb5d80ff74e">SPECIFY_RETURN_IDLE_MODE</a>:</div>
<div class="line">                context-&gt;debug_return_idle = !!atoi(optarg);</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] debug_return_idle = %d.\n&quot;</span>, context-&gt;debug_return_idle);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a42" name="a42"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea5a0100925f274f1e94a986c90aa1d609">SPECIFY_WATCH_LAST_PTS_MODE</a>:</div>
<div class="line">                context-&gt;watch_last_pts = !!atoi(optarg);</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --watchlastpts = %d.\n&quot;</span>, context-&gt;watch_last_pts);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a43" name="a43"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea3e18e58e19093caf7766cfd7a3a202fd">SPECIFY_DPROC_MODE</a>:</div>
<div class="line">                context-&gt;debug_use_dproc = 1;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --dproc, enable dproc in dsp.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a44" name="a44"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeacbe8c695d1313a1f1fd91b662118fe65">SPECIFY_PREFETCH_MODE</a>:</div>
<div class="line">                context-&gt;prefetch_count = atoi(optarg);</div>
<div class="line">                context-&gt;enable_prefetch = 1;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --prefetch, %d.\n&quot;</span>, context-&gt;prefetch_count);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a45" name="a45"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea861735a67f1e935151d643ed18523c02">SPECIFY_MAX_WIDTH</a>:</div>
<div class="line">                context-&gt;max_width = atoi(optarg);</div>
<div class="line">                <span class="keywordflow">if</span> (context-&gt;max_width &amp; 0xf) {</div>
<div class="line">                    context-&gt;max_width = (context-&gt;max_width &amp; 0xfff0) + 16;</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;[WARNING]: max_width is not multiple of 16, align it to %d\n&quot;</span>,</div>
<div class="line">                        context-&gt;max_width);</div>
<div class="line">                }</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --maxwidth, %d.\n&quot;</span>, context-&gt;max_width);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a46" name="a46"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeaaedb976e0616c5cb086d2c87ea44f515">SPECIFY_MAX_HEIGHT</a>:</div>
<div class="line">                context-&gt;max_height = atoi(optarg);</div>
<div class="line">                <span class="keywordflow">if</span> (context-&gt;max_height &amp; 0xf) {</div>
<div class="line">                    context-&gt;max_height = (context-&gt;max_height &amp; 0xfff0) + 16;</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;[WARNING]: max_height is not multiple of 16, align it to %d!\n&quot;</span>,</div>
<div class="line">                        context-&gt;max_height);</div>
<div class="line">                }</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --maxheight, %d.\n&quot;</span>, context-&gt;max_height);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a47" name="a47"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea13b8167e2301443dbb68aa9ffb5ed496">SPECIFY_MAX_BITRATE</a>:</div>
<div class="line">                context-&gt;max_bitrate = atoi(optarg);</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --maxbirate, %d.\n&quot;</span>, context-&gt;max_bitrate);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a48" name="a48"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea1213d9f6549548adb659e90604f3748b">SPECIFY_FRAMERATE_DEN</a>:</div>
<div class="line">                context-&gt;framerate_den = atoi(optarg);</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --frden, %d.\n&quot;</span>, context-&gt;framerate_den);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a49" name="a49"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea8c8f26816e5cd9e1363d3a48f6b1f5a2">SPECIFY_DEBUG_LOG</a>:</div>
<div class="line">                context-&gt;enable_debug_log = 1;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[input argument] --debuglog, enable debug log.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a50" name="a50"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea8ac588f923808de0bd7e23c7bad19cdf">SPECIFY_FAST_NAVI_FORWARD</a>:</div>
<div class="line">                context-&gt;initial_speed = atoi(optarg);</div>
<div class="line">                <span class="keywordflow">if</span> (2 == context-&gt;initial_speed) {</div>
<div class="line">                    context-&gt;initial_navi_mode = FAST_NAVI_MODE_ALL_FRAME_FORWARD;</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((4 == context-&gt;initial_speed) || (8 == context-&gt;initial_speed)) {</div>
<div class="line">                    context-&gt;initial_navi_mode = FAST_NAVI_MODE_I_FRAME_FORWARD;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;[input argument] --fast-forward, only 2,4,8 are valid input.\n&quot;</span>);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                }</div>
<div class="line">                context-&gt;is_fastnavi_mode = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a51" name="a51"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea54c71ad4316c9ce20f9907338043b751">SPECIFY_FAST_NAVI_BACKWARD</a>:</div>
<div class="line">                context-&gt;initial_speed = atoi(optarg);</div>
<div class="line">                <span class="keywordflow">if</span> ((1 == context-&gt;initial_speed) || (2 == context-&gt;initial_speed)</div>
<div class="line">                    || (4 == context-&gt;initial_speed) || (8 == context-&gt;initial_speed)) {</div>
<div class="line">                    context-&gt;initial_navi_mode = FAST_NAVI_MODE_I_FRAME_BACKWARD;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;[input argument] --fast-backward, only 1,2,4,8 are valid input.\n&quot;</span>);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                }</div>
<div class="line">                context-&gt;is_fastnavi_mode = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a52" name="a52"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeae6ce0ea4ace57f12dcfb9ae81328cfd0">SPECIFY_RESET_VOUT</a>:</div>
<div class="line">                context-&gt;reset_vout_flag = atoi(optarg);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a id="a53" name="a53"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea0bcdc8a2c8fafa0bf101f2c3c25778b1">SPECIFY_DISABLE_RUNTIME_CMD</a>:</div>
<div class="line">                context-&gt;disable_runtime_cmd_flag = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;unknown option found: %d\n&quot;</span>, ch);</div>
<div class="line">                rval= -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (rval) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[input argument] parameter input error...exit\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> query_bsb_status(<span class="keywordtype">int</span> iav_fd, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> decoder_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a54" name="_a54"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d49/structiav__decode__bsb.html">iav_decode_bsb</a> bsb;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;bsb, 0x0, <span class="keyword">sizeof</span>(bsb));</div>
<div class="line">    bsb.decoder_id = <a id="a55" name="a55"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d49/structiav__decode__bsb.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, <a id="a56" name="a56"></a>IAV_IOC_QUERY_DECODE_BSB, &amp;bsb);</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[BSB]: current arm write offset 0x%08lx, current dsp read offset 0x%08lx, safe room &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;(minus 256 bytes) %d, free room %d\n&quot;</span>, bsb.start_offset, bsb.dsp_read_offset, bsb.room,</div>
<div class="line">        bsb.free_room);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> query_decode_status(<span class="keywordtype">int</span> iav_fd, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> <a class="code hl_variableRef" target="_blank" href="../../../library/d8/d49/structiav__decode__bsb.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a57" name="_a57"></a><a class="code hl_structRef" target="_blank" href="../../../library/d2/d21/structiav__decode__status.html">iav_decode_status</a> status;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;status, 0x0, <span class="keyword">sizeof</span>(status));</div>
<div class="line">    status.decoder_id = <a id="a58" name="a58"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d21/structiav__decode__status.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, <a id="a59" name="a59"></a>IAV_IOC_QUERY_DECODE_STATUS, &amp;status);</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[decode status]: decode_state %d, decoded_pic_number %d, error_status %d, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;total_error_count %d, irq_count %d\n&quot;</span>, status.decode_state, status.decoded_pic_number,</div>
<div class="line">        status.error_status, status.total_error_count, status.irq_count);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[decode status, bsb]: current write offset (arm) 0x%08lx, current read offset (dsp) &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;0x%08lx, safe room (minus 256 bytes) %d, free room %d\n&quot;</span>, status.write_offset,</div>
<div class="line">        status.dsp_read_offset, status.room, status.free_room);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[decode status, last pts]: %d, is_started %d, is_send_stop_cmd %d\n&quot;</span>,</div>
<div class="line">        status.last_pts,status.is_started, status.is_send_stop_cmd);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[decode status, dram addr]: luma_addr 0x%08lx, chroma_addr 0x%08lx\n&quot;</span>,</div>
<div class="line">        status.yuv422_y_addr, status.yuv422_uv_addr);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ioctl_decode_trick_play(<span class="keywordtype">int</span> iav_fd, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> <a class="code hl_variableRef" target="_blank" href="../../../library/d2/d21/structiav__decode__status.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> trick_play)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a60" name="_a60"></a><a class="code hl_structRef" target="_blank" href="../../../library/d4/dfc/structiav__decode__trick__play.html">iav_decode_trick_play</a> trickplay;</div>
<div class="line"> </div>
<div class="line">    trickplay.<a id="a61" name="a61"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d4/dfc/structiav__decode__trick__play.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d4/dfc/structiav__decode__trick__play.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>;</div>
<div class="line">    trickplay.trick_play = <a id="a62" name="a62"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d4/dfc/structiav__decode__trick__play.html#a85a5bc94d7dd0194daa37362fc08221a">trick_play</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, <a id="a63" name="a63"></a>IAV_IOC_DECODE_TRICK_PLAY, &amp;trickplay);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ioctl_decode_start(<span class="keywordtype">int</span> iav_fd, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> <a class="code hl_variableRef" target="_blank" href="../../../library/d4/dfc/structiav__decode__trick__play.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, <a id="a64" name="a64"></a>IAV_IOC_DECODE_START, <a class="code hl_variableRef" target="_blank" href="../../../library/d4/dfc/structiav__decode__trick__play.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ioctl_decode_stop(<span class="keywordtype">int</span> iav_fd, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> <a class="code hl_variableRef" target="_blank" href="../../../library/d4/dfc/structiav__decode__trick__play.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> stop_flag)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a65" name="_a65"></a><a class="code hl_structRef" target="_blank" href="../../../library/d2/d69/structiav__decode__stop.html">iav_decode_stop</a> stop;</div>
<div class="line"> </div>
<div class="line">    stop.<a id="a66" name="a66"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d69/structiav__decode__stop.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d2/d69/structiav__decode__stop.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>;</div>
<div class="line">    stop.stop_flag = <a id="a67" name="a67"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d69/structiav__decode__stop.html#ab21271a5d192d01b25560a3ecbab210c">stop_flag</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, <a id="a68" name="a68"></a>IAV_IOC_DECODE_STOP, &amp;stop);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ioctl_decode_speed(<span class="keywordtype">int</span> iav_fd, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> <a class="code hl_variableRef" target="_blank" href="../../../library/d2/d69/structiav__decode__stop.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> speed, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> scan_mode, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> direction)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a69" name="_a69"></a><a class="code hl_structRef" target="_blank" href="../../../library/d3/d5e/structiav__decode__speed.html">iav_decode_speed</a> spd;</div>
<div class="line"> </div>
<div class="line">    spd.<a id="a70" name="a70"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/d5e/structiav__decode__speed.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/d5e/structiav__decode__speed.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>;</div>
<div class="line">    spd.direction = <a id="a71" name="a71"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/d5e/structiav__decode__speed.html#a80dcc8170b363b316d556c4b608e940f">direction</a>;</div>
<div class="line">    spd.speed = <a id="a72" name="a72"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/d5e/structiav__decode__speed.html#acc79e9fd4431192338fbbe2735739879">speed</a>;</div>
<div class="line">    spd.scan_mode = <a id="a73" name="a73"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/d5e/structiav__decode__speed.html#ada52665f858dca972520198846aa5e57">scan_mode</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, <a id="a74" name="a74"></a>IAV_IOC_DECODE_SPEED, &amp;spd);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* copy_to_bsb(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_bsb_cur, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *input, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_bsb_start, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_bsb_end)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> room;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *ptr2 = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//printf(&quot;[debug], p_bsb_cur %p, buffer %p, size %d. p_bsb_start %p, &quot;</span></div>
<div class="line">    <span class="comment">//  &quot;p_bsb_end %p\n&quot;, p_bsb_cur, buffer, size, p_bsb_start, p_bsb_end);</span></div>
<div class="line">    <span class="keywordflow">if</span> ((p_bsb_cur + size) &lt;= p_bsb_end) {</div>
<div class="line">        memcpy(p_bsb_cur, input, size);</div>
<div class="line">        <span class="keywordflow">return</span> p_bsb_cur + size;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        room = p_bsb_end - p_bsb_cur;</div>
<div class="line">        <span class="keywordflow">if</span> (room) {</div>
<div class="line">            memcpy(p_bsb_cur, input, room);</div>
<div class="line">        }</div>
<div class="line">        ptr2 = input + room;</div>
<div class="line">        size -= room;</div>
<div class="line">        <span class="keywordflow">if</span> (size) {</div>
<div class="line">            memcpy(p_bsb_start, ptr2, size);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> p_bsb_start + size;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* read_file_to_bsb(FILE* fd, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> file_offset,</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* cur_file_offset, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_bsb_cur, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p_bsb_start, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p_bsb_end)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *bsb_offset = NULL;</div>
<div class="line"> </div>
<div class="line">    fseek(fd, file_offset, SEEK_SET);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((p_bsb_cur + size) &lt;= p_bsb_end) {</div>
<div class="line">        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa6d89b223ba1d6d6b2f8308b45789f60">AMBA_FREAD_FILE</a>(p_bsb_cur, 1, size, fd);</div>
<div class="line">        *cur_file_offset = file_offset + size;</div>
<div class="line">        bsb_offset = p_bsb_cur + size;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> room = p_bsb_end - p_bsb_cur;</div>
<div class="line">        <span class="keywordflow">if</span> (room) {</div>
<div class="line">            <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa6d89b223ba1d6d6b2f8308b45789f60">AMBA_FREAD_FILE</a>(p_bsb_cur, 1, room, fd);</div>
<div class="line">        }</div>
<div class="line">        size -= room;</div>
<div class="line">        <span class="keywordflow">if</span> (size) {</div>
<div class="line">            <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa6d89b223ba1d6d6b2f8308b45789f60">AMBA_FREAD_FILE</a>(p_bsb_start, 1, size, fd);</div>
<div class="line">        }</div>
<div class="line">        *cur_file_offset = file_offset + size + room;</div>
<div class="line">        bsb_offset = p_bsb_start + size;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> bsb_offset;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> write_bsb_data(FILE *fd, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_data_start, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_data_end, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_bsb_start,</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_bsb_end)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (p_data_start &lt; p_data_end) {</div>
<div class="line">        fwrite(p_data_start, 1, p_data_end - p_data_start, fd);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (p_bsb_end &gt; p_data_start) {</div>
<div class="line">            fwrite(p_data_start, 1, p_bsb_end - p_data_start, fd);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (p_data_end &gt; p_bsb_start) {</div>
<div class="line">            fwrite(p_bsb_start, 1, p_data_end - p_bsb_start, fd);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    fflush(fd);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> request_bits_fifo(<span class="keywordtype">int</span> iav_fd, <span class="keywordtype">int</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d3/d5e/structiav__decode__speed.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> cur_pos_offset)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d49/structiav__decode__bsb.html">iav_decode_bsb</a> wait;</div>
<div class="line"> </div>
<div class="line">    wait.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d49/structiav__decode__bsb.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d8/d49/structiav__decode__bsb.html#a1cc6401238981ad83b8c09a40d71849f">decoder_id</a>;</div>
<div class="line">    wait.room = size;</div>
<div class="line">    wait.start_offset = cur_pos_offset;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, <a id="a75" name="a75"></a>IAV_IOC_WAIT_DECODE_BSB, &amp;wait);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> map_bsb(decode_context* ctx)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a76" name="_a76"></a><a class="code hl_structRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a> query_mem = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a77" name="_a77"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a> *part_info = NULL;</div>
<div class="line"> </div>
<div class="line">    query_mem.<a id="a78" name="a78"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">mid</a> = <a id="a79" name="a79"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a>;</div>
<div class="line">    part_info = &amp;query_mem.<a id="a80" name="a80"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">arg</a>.<a id="a81" name="a81"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">partition</a>;</div>
<div class="line">    part_info-&gt;<a id="a82" name="a82"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = <a id="a83" name="a83"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa2f3d77052a82568957924f8fd93495c4">IAV_PART_DEC_BSB</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(ctx-&gt;iav_fd, <a id="a84" name="a84"></a>IAV_IOC_QUERY_MEMBLOCK, &amp;query_mem);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (part_info-&gt;<a id="a85" name="a85"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a86" name="a86"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a> == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;[ERROR]: IAV_PART_DEC_BSB is not allocated!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ctx-&gt;bsb_size = part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    ctx-&gt;bsb_base = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *) mmap(NULL, ctx-&gt;bsb_size, PROT_WRITE, MAP_SHARED, ctx-&gt;iav_fd,</div>
<div class="line">        (<span class="keywordtype">size_t</span>)part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a87" name="a87"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (ctx-&gt;bsb_base == MAP_FAILED) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;mmap failed!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;bsb_mem = %p, size = %d.\n&quot;</span>, ctx-&gt;bsb_base, ctx-&gt;bsb_size);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sig_stop(<span class="keywordtype">int</span> a)</div>
<div class="line">{</div>
<div class="line">    decode_running = 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_curr_pts(<span class="keywordtype">int</span> iav_fd, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> <span class="keywordtype">id</span>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *pts)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/d21/structiav__decode__status.html">iav_decode_status</a> status;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;status, 0x0, <span class="keyword">sizeof</span>(status));</div>
<div class="line">    status.decoder_id = id;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(iav_fd, IAV_IOC_QUERY_DECODE_STATUS, &amp;status);</div>
<div class="line"> </div>
<div class="line">    *pts = status.last_pts;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>* decode_thread(<span class="keywordtype">void</span>* param)</div>
<div class="line">{</div>
<div class="line">    decoder_instance* instance = (decoder_instance*) param;</div>
<div class="line">    decode_context* context = (decode_context*) instance-&gt;parent;</div>
<div class="line">    <span class="keyword">struct</span> <a id="_a88" name="_a88"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/dfc/structiav__decode__video.html">iav_decode_video</a> decode_video;</div>
<div class="line">    msg_t msg;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> sendsize = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_frame_start = NULL, *amba_gop_header = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_bsb_cur = instance-&gt;p_bsb_start;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p_prefetching = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> nal_type = 0, slice_type, need_more_data = 0, wait_next_key_frame = 0, file_eos = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> repeat_count = context-&gt;repeat_count;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> target_prefetch_cnt = context-&gt;prefetch_count;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> curr_prefetch_cnt = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> in_prefetching = context-&gt;enable_prefetch;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> frame_index, <a id="a89" name="a89"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d21/structiav__decode__status.html#aa389272508113714ecb2bfdf578380f2">last_pts</a> = 0, gop_header_length = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> amba_avc_gop_header[DAMBA_AVC_GOP_HEADER_LENGTH] = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> amba_hevc_gop_header[DAMBA_HEVC_GOP_HEADER_LENGTH] = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> avc_end_of_stream[] = {0x00, 0x00, 0x00, 0x01, <a id="a90" name="a90"></a><a class="code hl_variableRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#ac4e3f74a62ead64a2cc7075bf0a53d92a52d0bed6bcc9eb29909bb8f860d54cde">AVC_NAL_TYPE_END_OF_STREAM</a>};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> hevc_end_of_stream[] = {0x00, 0x00, 0x00, 0x01, (<a id="a91" name="a91"></a><a class="code hl_variableRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba921f3dc9e02cf9bae7d090c1fddbb4fb">HEVC_NAL_TYPE_EOB</a> &lt;&lt; 1), 0x00};</div>
<div class="line">    <span class="keywordtype">int</span> is_avc = 0, ret = 0;</div>
<div class="line">    <span class="keywordtype">char</span> str_type[2][16] = {<span class="stringliteral">&quot;hevc&quot;</span>, <span class="stringliteral">&quot;avc&quot;</span>};</div>
<div class="line"> </div>
<div class="line">    <a id="_a92" name="_a92"></a><a class="code hl_structRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html">_t_file_reader</a> file_reader;</div>
<div class="line">    memset(&amp;file_reader, 0x0, <span class="keyword">sizeof</span>(file_reader));</div>
<div class="line">    ret = <a id="a93" name="a93"></a><a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#abf24a25de38aeb5aff78b9c8d478efe0">file_reader_init</a>(&amp;file_reader, instance-&gt;file_fd, instance-&gt;rd_buffer_size,</div>
<div class="line">        instance-&gt;prealloc_file_buffer);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        u_printf_error(<span class="stringliteral">&quot;[ERROR]: file_reader_init fail, ret %d!\n&quot;</span>, ret);</div>
<div class="line">        decode_running = 0;</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a id="a94" name="a94"></a><a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#a027b98f1ef505b679700517657eba622">file_reader_reset</a>(&amp;file_reader);</div>
<div class="line"> </div>
<div class="line">    <a id="a95" name="a95"></a><a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#ad75cca76e22fb555560c553ef1caa99f">file_reader_read_trunk</a>(&amp;file_reader);</div>
<div class="line">    p_bsb_cur = instance-&gt;p_bsb_start;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;mode_config.decoder_type[instance-&gt;index] == <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a4ae5fb6b6d878ad88a8bff8b3b20af91">IAV_DEC_TYPE_H264</a>) {</div>
<div class="line">        is_avc = 1;</div>
<div class="line">        gop_header_length = DAMBA_AVC_GOP_HEADER_LENGTH;</div>
<div class="line">        amba_gop_header = amba_avc_gop_header;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        is_avc = 0;</div>
<div class="line">        gop_header_length = DAMBA_HEVC_GOP_HEADER_LENGTH;</div>
<div class="line">        amba_gop_header = amba_hevc_gop_header;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: decode_thread %d begin for %s, framerate den %d.\n&quot;</span>, instance-&gt;index,</div>
<div class="line">        str_type[is_avc], context-&gt;framerate_den);</div>
<div class="line"> </div>
<div class="line">    fill_amba_gop_header(is_avc, amba_gop_header, context-&gt;framerate_den, 90000, 0, context-&gt;gop_n,</div>
<div class="line">        context-&gt;gop_m);</div>
<div class="line">    frame_index = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <span class="keywordflow">if</span> (msg_queue_peek(&amp;instance-&gt;cmd_queue, &amp;msg)) {</div>
<div class="line">            <span class="keywordflow">if</span> (M_MSG_KILL == msg.cmd) {</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Receive quit cmd, stop decoding and return!\n&quot;</span>);</div>
<div class="line">                ret = 0;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (is_avc) {</div>
<div class="line">            sendsize = <a id="a96" name="a96"></a><a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#ae1cb966206bf4aecc463da4d2113bbeb">get_next_frame</a>(file_reader.<a id="a97" name="a97"></a><a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#a62b6fae9306248ca33a6046b04f58aee">p_read_buffer_cur_start</a>,</div>
<div class="line">                file_reader.<a id="a98" name="a98"></a><a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#a05f930098bf036cffa1d2b2bf98eb661">p_read_buffer_cur_end</a>, &amp;nal_type, &amp;slice_type, &amp;need_more_data);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            sendsize = <a id="a99" name="a99"></a><a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#a6d1964fd9027381a450ba23d705ff55d">get_next_frame_h265</a>(file_reader.<a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#a62b6fae9306248ca33a6046b04f58aee">p_read_buffer_cur_start</a>,</div>
<div class="line">                file_reader.<a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#a05f930098bf036cffa1d2b2bf98eb661">p_read_buffer_cur_end</a>, &amp;nal_type, &amp;need_more_data);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!sendsize &amp;&amp; need_more_data) {</div>
<div class="line">            <span class="keywordflow">if</span> (!file_reader.<a id="a100" name="a100"></a><a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#a7fcd4b620cddff6eb4b47992c2a7bba5">file_remainning_size</a>) {</div>
<div class="line">                sendsize = file_reader.<a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#a05f930098bf036cffa1d2b2bf98eb661">p_read_buffer_cur_end</a> - file_reader.<a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#a62b6fae9306248ca33a6046b04f58aee">p_read_buffer_cur_start</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (sendsize &lt;= 6) {</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;[WARNING]: (decoder %d) Discard last incomplete frame, size %d!\n&quot;</span>, instance-&gt;index, sendsize);</div>
<div class="line">                    file_eos = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">//u_printf(&quot;[FLOW]: (decoder %d) File end, repeat_count(%d).\n&quot;, instance-&gt;index, repeat_count);</span></div>
<div class="line">                    <span class="comment">//check if need repeat play, if so, restart from file head</span></div>
<div class="line">                    <span class="keywordflow">if</span> (repeat_count) {</div>
<div class="line">                        <span class="keywordflow">if</span> (repeat_count != 255) {</div>
<div class="line">                            <span class="comment">//repeat_count == 255, playback till stop.</span></div>
<div class="line">                            repeat_count--;</div>
<div class="line">                        }</div>
<div class="line">                        ret = <a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#abf24a25de38aeb5aff78b9c8d478efe0">file_reader_init</a>(&amp;file_reader, instance-&gt;file_fd, instance-&gt;rd_buffer_size,</div>
<div class="line">                                instance-&gt;prealloc_file_buffer);</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                file_eos = 1;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[FLOW]: feeding very last frame\n&quot;</span>);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#ad75cca76e22fb555560c553ef1caa99f">file_reader_read_trunk</a>(&amp;file_reader);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (is_avc) {</div>
<div class="line">            <span class="keywordflow">if</span> (wait_next_key_frame &amp;&amp; (<a id="a101" name="a101"></a>AVC_NAL_TYPE_IDR &gt; nal_type)) {</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;(decoder %d) skip frame(nal_type %d, slice_type %d) till IDR.\n&quot;</span>,</div>
<div class="line">                    instance-&gt;index, nal_type, slice_type);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (context-&gt;enable_debug_log) {</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;(decoder %d) Frame index %d, nal type %d, slice type %d\n&quot;</span>, instance-&gt;index,</div>
<div class="line">                    frame_index, nal_type, slice_type);</div>
<div class="line">                <span class="comment">//u_printf(&quot;sendsize %d, need_more_data %d\n&quot;, sendsize, need_more_data);</span></div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (wait_next_key_frame &amp;&amp; ((<a id="a102" name="a102"></a>HEVC_NAL_TYPE_IDR_W_RADL != nal_type)</div>
<div class="line">                &amp;&amp; (<a id="a103" name="a103"></a>HEVC_NAL_TYPE_IDR_N_LP != nal_type))) {</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;(decoder %d) skip frame(nal_type %d) till IDR.\n&quot;</span>, instance-&gt;index,</div>
<div class="line">                    nal_type);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (context-&gt;enable_debug_log) {</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Frame index %d, nal type %d.\n&quot;</span>, frame_index, nal_type);</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Sendsize 0x%x, need_more_data %d.\n&quot;</span>, sendsize, need_more_data);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        wait_next_key_frame = 0;</div>
<div class="line">        p_frame_start = p_bsb_cur;</div>
<div class="line">        <span class="comment">//printf(&quot;Decoder %d: p_frame_start updated to %p!\n&quot;, instance-&gt;index, p_bsb_cur);</span></div>
<div class="line">        <span class="comment">//wrap case</span></div>
<div class="line">        <span class="keywordflow">if</span> (p_frame_start == instance-&gt;p_bsb_end) {</div>
<div class="line">            p_frame_start = instance-&gt;p_bsb_start;</div>
<div class="line">            <span class="comment">//printf(&quot;Decoder %d: p_frame_start updated to start %p!\n&quot;, instance-&gt;index, instance-&gt;p_bsb_start);</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((is_avc &amp;&amp; (AVC_NAL_TYPE_IDR == nal_type)) ||</div>
<div class="line">            (!is_avc &amp;&amp; ((HEVC_NAL_TYPE_IDR_W_RADL == nal_type) ||</div>
<div class="line">            (HEVC_NAL_TYPE_IDR_N_LP == nal_type)))) {</div>
<div class="line">            <span class="comment">//printf(&quot;key frame + gop header size %d\n&quot;, sendsize + DAMBA_AVC_GOP_HEADER_LENGTH);</span></div>
<div class="line">            ret = request_bits_fifo(context-&gt;iav_fd, instance-&gt;index,</div>
<div class="line">                sendsize + gop_header_length + DAMBA_RESERVED_SPACE,</div>
<div class="line">                p_frame_start - instance-&gt;p_bsb_start);</div>
<div class="line">            <span class="comment">//printf(&quot;[loop flow]: after request_bits_fifo\n&quot;);</span></div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[ERROR]: (decoder %d) request_bits_fifo() fail, ret %d!\n&quot;</span>, instance-&gt;index, ret);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">//printf(&quot;[DEBUG], before copy_to_bsb, sendsize %d\n&quot;, sendsize);</span></div>
<div class="line">            update_amba_gop_header(is_avc, amba_gop_header, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>) (context-&gt;framerate_den * frame_index));</div>
<div class="line">            p_bsb_cur = copy_to_bsb(p_bsb_cur, amba_gop_header, gop_header_length,</div>
<div class="line">                instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">//printf(&quot;non-key frame size %d.\n&quot;, sendsize);</span></div>
<div class="line">            ret = request_bits_fifo(context-&gt;iav_fd, instance-&gt;index,</div>
<div class="line">                sendsize + DAMBA_RESERVED_SPACE, p_frame_start - instance-&gt;p_bsb_start);</div>
<div class="line">            <span class="comment">//printf(&quot;[loop flow]: after request_bits_fifo.\n&quot;);</span></div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;[ERROR]: (decoder %d) request_bits_fifo() fail, ret %d!\n&quot;</span>, instance-&gt;index, ret);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../library/d2/d21/structiav__decode__status.html#aa389272508113714ecb2bfdf578380f2">last_pts</a> = context-&gt;framerate_den * frame_index;</div>
<div class="line">        frame_index ++;</div>
<div class="line"> </div>
<div class="line">        p_bsb_cur = copy_to_bsb(p_bsb_cur, file_reader.<a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#a62b6fae9306248ca33a6046b04f58aee">p_read_buffer_cur_start</a>, sendsize,</div>
<div class="line">            instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">        <span class="keywordflow">if</span> (file_eos) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[DEBUG]: (decoder %d) fill end of stream.\n&quot;</span>, instance-&gt;index);</div>
<div class="line">            <span class="keywordflow">if</span> (is_avc) {</div>
<div class="line">                p_bsb_cur = copy_to_bsb(p_bsb_cur, avc_end_of_stream, <span class="keyword">sizeof</span>(avc_end_of_stream),</div>
<div class="line">                    instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                p_bsb_cur = copy_to_bsb(p_bsb_cur, hevc_end_of_stream, <span class="keyword">sizeof</span>(hevc_end_of_stream),</div>
<div class="line">                    instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        file_reader.<a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#a62b6fae9306248ca33a6046b04f58aee">p_read_buffer_cur_start</a> += sendsize;</div>
<div class="line">        file_reader.<a id="a104" name="a104"></a><a class="code hl_variableRef" target="_blank" href="../../../video/dc/d99/struct__t__file__reader.html#ac70db0e32f9ed41206c4862cab9ba379">data_remainning_size_in_buffer</a> -= sendsize;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (in_prefetching &amp;&amp; (target_prefetch_cnt &gt; curr_prefetch_cnt)) {</div>
<div class="line">            <span class="keywordflow">if</span> (!p_prefetching) {</div>
<div class="line">                p_prefetching = p_frame_start;</div>
<div class="line">                u_printf_debug(<span class="stringliteral">&quot;[prebuffering start]: target_prefetch_cnt %d, p_prefetching %p.\n&quot;</span>,</div>
<div class="line">                    target_prefetch_cnt, p_prefetching);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            curr_prefetch_cnt ++;</div>
<div class="line">            u_printf_debug(<span class="stringliteral">&quot;[prebuffering]: curr_prefetch_cnt %d, target_prefetch_cnt %d.\n&quot;</span>,</div>
<div class="line">                curr_prefetch_cnt, target_prefetch_cnt);</div>
<div class="line">            <span class="keywordflow">if</span> (target_prefetch_cnt == curr_prefetch_cnt) {</div>
<div class="line">                u_printf_debug(<span class="stringliteral">&quot;[prebuffering done]\n&quot;</span>);</div>
<div class="line">                in_prefetching = 0;</div>
<div class="line"> </div>
<div class="line">                memset(&amp;decode_video, 0, <span class="keyword">sizeof</span>(decode_video));</div>
<div class="line">                decode_video.decoder_id = instance-&gt;index;</div>
<div class="line">                decode_video.num_frames = curr_prefetch_cnt;</div>
<div class="line"> </div>
<div class="line">                decode_video.start_ptr_offset = p_prefetching - instance-&gt;p_bsb_start;</div>
<div class="line">                decode_video.end_ptr_offset = p_bsb_cur - instance-&gt;p_bsb_start;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> ((ret = ioctl(context-&gt;iav_fd, <a id="a105" name="a105"></a>IAV_IOC_DECODE_VIDEO, &amp;decode_video)) &lt; 0) {</div>
<div class="line">                    u_printf_error(<span class="stringliteral">&quot;[ERROR]: (decoder %d) IAV_IOC_DECODE_VIDEO ret %d, &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;exit loop.\n&quot;</span>, instance-&gt;index, ret);</div>
<div class="line">                    ret = -11;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (instance-&gt;p_dump_input_file) {</div>
<div class="line">                    write_bsb_data(instance-&gt;p_dump_input_file, p_prefetching, p_bsb_cur,</div>
<div class="line">                        instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d1/dfc/structiav__decode__video.html">iav_decode_video</a> decode_video;</div>
<div class="line">            memset(&amp;decode_video, 0, <span class="keyword">sizeof</span>(decode_video));</div>
<div class="line">            decode_video.decoder_id = instance-&gt;index;</div>
<div class="line">            decode_video.num_frames = 1;</div>
<div class="line"> </div>
<div class="line">            decode_video.start_ptr_offset = p_frame_start - instance-&gt;p_bsb_start;</div>
<div class="line">            decode_video.end_ptr_offset = p_bsb_cur - instance-&gt;p_bsb_start;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">//printf(&quot;Decoder %d: BSB start 0x%lx, end 0x%lx!\n&quot;, instance-&gt;index,</span></div>
<div class="line">            <span class="comment">//  decode_video.start_ptr_offset, decode_video.end_ptr_offset);</span></div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> ((ret = ioctl(context-&gt;iav_fd, IAV_IOC_DECODE_VIDEO, &amp;decode_video)) &lt; 0) {</div>
<div class="line">                u_printf_error(<span class="stringliteral">&quot;[ERROR]: (decoder %d) IAV_IOC_DECODE_VIDEO ret %d, exit loop.\n&quot;</span>,</div>
<div class="line">                    instance-&gt;index, ret);</div>
<div class="line">                ret = -11;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">//printf(&quot;[loop flow]: after IAV_IOC_DECODE_VIDEO\n&quot;);</span></div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (context-&gt;enable_debug_log) {</div>
<div class="line">                <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> data_size = 0;</div>
<div class="line">                <span class="keywordflow">if</span> (p_bsb_cur &gt; p_frame_start) {</div>
<div class="line">                    data_size = (<a id="a106" name="a106"></a><a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>) (p_bsb_cur - p_frame_start);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    data_size = (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>) (instance-&gt;p_bsb_end - p_frame_start) +</div>
<div class="line">                        (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>) (p_bsb_cur - instance-&gt;p_bsb_start);</div>
<div class="line">                }</div>
<div class="line">                print_first_and_last_8bytes((<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>*)p_frame_start, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>*)p_bsb_cur,</div>
<div class="line">                    instance-&gt;p_bsb_start, instance-&gt;p_bsb_end, data_size);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (instance-&gt;p_dump_input_file) {</div>
<div class="line">                write_bsb_data(instance-&gt;p_dump_input_file, p_frame_start, p_bsb_cur,</div>
<div class="line">                    instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (file_eos) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[feeding flow]: (decoder %d) exit feeding loop.\n&quot;</span>, instance-&gt;index);</div>
<div class="line">            ret = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a id="a107" name="a107"></a><a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#ad38e15f8bd029ab5780e12b8965e561e">file_reader_deinit</a>(&amp;file_reader);</div>
<div class="line">    last_timestamp = last_pts;</div>
<div class="line">    feed_bitstream_done++;</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[feeding flow]: (decode_thread %d) end, last timestamp %ld.\n&quot;</span>, instance-&gt;index, last_timestamp);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (file_eos &amp;&amp; (!context-&gt;watch_last_pts) &amp;&amp; decode_running) {</div>
<div class="line">        <span class="keyword">struct </span><a id="_a108" name="_a108"></a><a class="code hl_structRef" target="_blank" href="../../../library/da/dce/structiav__decode__wait__eos.html">iav_decode_wait_eos</a> wait_eos;</div>
<div class="line">        memset(&amp;wait_eos, 0, <span class="keyword">sizeof</span>(wait_eos));</div>
<div class="line">        wait_eos.decoder_id = instance-&gt;index;</div>
<div class="line"> </div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[playback flow]: (decode_thread %d) Wait eos...\n&quot;</span>, instance-&gt;index);</div>
<div class="line">        <span class="keywordflow">if</span> ((ret = ioctl(context-&gt;iav_fd, <a id="a109" name="a109"></a>IAV_IOC_WAIT_PLAYBACK_EOS, &amp;wait_eos)) &lt; 0) {</div>
<div class="line">            u_printf_error(<span class="stringliteral">&quot;[ERROR]: (decoder id %d) IAV_IOC_WAIT_PLAYBACK_EOS ret %d.\n&quot;</span>,</div>
<div class="line">                instance-&gt;index, ret);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[playback flow]: (decoder id %d) Wait eos done.\n&quot;</span>, instance-&gt;index);</div>
<div class="line">            decode_running--;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//return 0: keep going, 1: change state, 2: exit</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> process_decode_cmd(decoder_instance* instance, decode_context* context, msg_t* msg)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> scan_mode = <a id="a110" name="a110"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a17775b31c0f89faa7583b122ef786d1d">IAV_DEC_SCAN_MODE_ALL_FRAMES</a>;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> speed;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (M_MSG_KILL == msg-&gt;cmd) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;Recieve quit cmd, return.\n&quot;</span>);</div>
<div class="line">        instance-&gt;navi_mode = PLAYBACK_EXIT;</div>
<div class="line">        <span class="keywordflow">return</span> 2;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (M_MSG_FW_FROM_BEGIN == msg-&gt;cmd) {</div>
<div class="line">        <span class="keywordflow">if</span> (FAST_NAVI_MODE_I_FRAME_BACKWARD == instance-&gt;navi_mode) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;backward ---&gt; forward\n&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;forward---&gt; forward\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        ioctl_decode_stop(context-&gt;iav_fd, instance-&gt;index, 1);</div>
<div class="line">        ioctl_decode_start(context-&gt;iav_fd, instance-&gt;index);</div>
<div class="line"> </div>
<div class="line">        u_printf(<span class="stringliteral">&quot;receive %dx fw\n&quot;</span>, msg-&gt;arg1);</div>
<div class="line">        <span class="keywordflow">if</span> ((1 == msg-&gt;arg1) || (2 == msg-&gt;arg1)) {</div>
<div class="line">            scan_mode = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a17775b31c0f89faa7583b122ef786d1d">IAV_DEC_SCAN_MODE_ALL_FRAMES</a>;</div>
<div class="line">            instance-&gt;navi_mode = FAST_NAVI_MODE_ALL_FRAME_FORWARD;</div>
<div class="line">            <span class="keywordflow">if</span> (context-&gt;dump_input_bitstream) {</div>
<div class="line">                    open_dump_file(instance, <span class="stringliteral">&quot;fw_12x.dump&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((4 == msg-&gt;arg1) || (8 == msg-&gt;arg1)) {</div>
<div class="line">            scan_mode = <a id="a111" name="a111"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a3fb0ffa93f566c7b813eb588ab27072a">IAV_DEC_SCAN_MODE_I_ONLY</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (context-&gt;dump_input_bitstream) {</div>
<div class="line">                open_dump_file(instance, <span class="stringliteral">&quot;fw_hs.dump&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            instance-&gt;navi_mode = FAST_NAVI_MODE_I_FRAME_FORWARD;</div>
<div class="line">        }</div>
<div class="line">        speed = (msg-&gt;arg1) &lt;&lt; 8;</div>
<div class="line">        ioctl_decode_speed(context-&gt;iav_fd, instance-&gt;index, speed,</div>
<div class="line">                    scan_mode, <a id="a112" name="a112"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaf641f844229bde49393b667c0314bee8adb6b016034e55d10deea6d1a8dbab2c3">IAV_DEC_DIR_FW</a>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line"> </div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (M_MSG_BW_FROM_END == msg-&gt;cmd) {</div>
<div class="line">        <span class="keywordflow">if</span> ((FAST_NAVI_MODE_ALL_FRAME_FORWARD == instance-&gt;navi_mode) ||</div>
<div class="line">            (FAST_NAVI_MODE_I_FRAME_FORWARD == instance-&gt;navi_mode)) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;forward ---&gt; backward\n&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;backward ---&gt; backward\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        ioctl_decode_stop(context-&gt;iav_fd, instance-&gt;index, 1);</div>
<div class="line">        ioctl_decode_start(context-&gt;iav_fd, instance-&gt;index);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        u_printf(<span class="stringliteral">&quot;receive %dx bw\n&quot;</span>, msg-&gt;arg1);</div>
<div class="line">        <span class="keywordflow">if</span> ((1 == msg-&gt;arg1) || (2 == msg-&gt;arg1) || (4 == msg-&gt;arg1)</div>
<div class="line">            || (8 == msg-&gt;arg1)) {</div>
<div class="line">            scan_mode = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a3fb0ffa93f566c7b813eb588ab27072a">IAV_DEC_SCAN_MODE_I_ONLY</a>;</div>
<div class="line">            instance-&gt;navi_mode = FAST_NAVI_MODE_I_FRAME_BACKWARD;</div>
<div class="line">            <span class="keywordflow">if</span> (context-&gt;dump_input_bitstream) {</div>
<div class="line">                open_dump_file(instance, <span class="stringliteral">&quot;bw_i_only.dump&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        speed = (msg-&gt;arg1) &lt;&lt; 8;</div>
<div class="line">        ioctl_decode_speed(context-&gt;iav_fd, instance-&gt;index, speed,</div>
<div class="line">            scan_mode, <a id="a113" name="a113"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaf641f844229bde49393b667c0314bee8a3da2e487ff2083db8e5f996eba894095">IAV_DEC_DIR_BW</a>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        u_printf_error(<span class="stringliteral">&quot;not support cmd %d\n&quot;</span>, msg-&gt;cmd);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>* decode_fast_navi(<span class="keywordtype">void</span>* param)</div>
<div class="line">{</div>
<div class="line">    decoder_instance* instance = (decoder_instance*) param;</div>
<div class="line">    decode_context* context = (decode_context*) instance-&gt;parent;</div>
<div class="line">    <a id="_a114" name="_a114"></a><a class="code hl_structRef" target="_blank" href="../../../video/de/d9c/struct____s__fast__navi__gop.html">fast_navi_gop</a>* p_gop;</div>
<div class="line">    <span class="keyword">struct</span> <a class="code hl_structRef" target="_blank" href="../../../library/d1/dfc/structiav__decode__video.html">iav_decode_video</a> decode_video;</div>
<div class="line">    msg_t msg;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sendsize = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> file_read_buffer_size = D_READ_COPY_BUF_SIZE;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* p_file_read_buffer = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_frame_start = context-&gt;bsb_base;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_bsb_cur = context-&gt;bsb_base;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *p_bit_start = NULL, *p_bit_end = NULL, *amba_gop_header = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> amba_avc_gop_header[DAMBA_AVC_GOP_HEADER_LENGTH] = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> amba_hevc_gop_header[DAMBA_HEVC_GOP_HEADER_LENGTH] = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> avc_end_of_sequence[] = {0x00, 0x00, 0x00, 0x01, <a id="a115" name="a115"></a><a class="code hl_variableRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#ac4e3f74a62ead64a2cc7075bf0a53d92aa09c89d245078d1b338ccb85f2e95bc2">AVC_NAL_TYPE_END_OF_SEQUENCE</a>};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> avc_end_of_stream[] = {0x00, 0x00, 0x00, 0x01, <a class="code hl_variableRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#ac4e3f74a62ead64a2cc7075bf0a53d92a52d0bed6bcc9eb29909bb8f860d54cde">AVC_NAL_TYPE_END_OF_STREAM</a>};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> hevc_end_of_sequence[] = {0x00, 0x00, 0x00, 0x01, (<a id="a116" name="a116"></a><a class="code hl_variableRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba4e66a003ca3c95a8ecf82105d0f39fc0">HEVC_NAL_TYPE_EOS</a> &lt;&lt; 1), 0x00};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> hevc_end_of_stream[] = {0x00, 0x00, 0x00, 0x01, (<a class="code hl_variableRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba921f3dc9e02cf9bae7d090c1fddbb4fb">HEVC_NAL_TYPE_EOB</a> &lt;&lt; 1), 0x00};</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cur_file_offset = 0;</div>
<div class="line">    <span class="keywordtype">int</span> running = 1, file_end = 0, is_avc = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> request_size = 0, gop_header_length = 0;</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!context-&gt;debug_read_direct_to_bsb) {</div>
<div class="line">        p_file_read_buffer = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>*) malloc(file_read_buffer_size);</div>
<div class="line">        <span class="keywordflow">if</span> (!p_file_read_buffer) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[ERROR]: No memory!\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: decode_fast_navi begin, max_gop_size = %d, framerate den %d.\n&quot;</span>,</div>
<div class="line">        context-&gt;max_gop_size, context-&gt;framerate_den);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;mode_config.decoder_type[instance-&gt;index] == <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a4ae5fb6b6d878ad88a8bff8b3b20af91">IAV_DEC_TYPE_H264</a>) {</div>
<div class="line">        is_avc = 1;</div>
<div class="line">        gop_header_length = DAMBA_AVC_GOP_HEADER_LENGTH;</div>
<div class="line">        amba_gop_header = amba_avc_gop_header;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        is_avc = 0;</div>
<div class="line">        gop_header_length = DAMBA_HEVC_GOP_HEADER_LENGTH;</div>
<div class="line">        amba_gop_header = amba_hevc_gop_header;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (running) {</div>
<div class="line">        <span class="keywordflow">switch</span> (instance-&gt;navi_mode) {</div>
<div class="line">        <span class="keywordflow">case</span> FAST_NAVI_MODE_ALL_FRAME_FORWARD:</div>
<div class="line">            p_gop = instance-&gt;fast_navi.gop_list_header.p_next;</div>
<div class="line">            cur_file_offset = p_gop-&gt;gop_offset;</div>
<div class="line">            fseek(instance-&gt;file_fd, cur_file_offset, SEEK_SET);</div>
<div class="line">            p_frame_start = p_bsb_cur = instance-&gt;p_bsb_start;</div>
<div class="line"> </div>
<div class="line">            fill_amba_gop_header(is_avc, amba_gop_header, context-&gt;framerate_den, 90000, 0,</div>
<div class="line">                context-&gt;max_gop_size, 1);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">while</span> (1) {</div>
<div class="line">                <span class="keywordflow">if</span> (msg_queue_peek(&amp;instance-&gt;cmd_queue, &amp;msg)) {</div>
<div class="line">                    ret = process_decode_cmd(instance, context, &amp;msg);</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;ff process_decode_cmd ret %d&quot;</span>, ret);</div>
<div class="line">                    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (p_gop &amp;&amp; p_gop != &amp;instance-&gt;fast_navi.gop_list_header) {</div>
<div class="line">                    <span class="keywordflow">if</span> (p_gop-&gt;p_next != &amp;instance-&gt;fast_navi.gop_list_header) {</div>
<div class="line">                        sendsize = p_gop-&gt;p_next-&gt;gop_offset - p_gop-&gt;gop_offset;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        sendsize = instance-&gt;fast_navi.file_size - p_gop-&gt;gop_offset;</div>
<div class="line">                    }</div>
<div class="line">                    p_frame_start = p_bsb_cur;</div>
<div class="line">                    <span class="comment">//wrap case</span></div>
<div class="line">                    <span class="keywordflow">if</span> (p_frame_start == instance-&gt;p_bsb_end) {</div>
<div class="line">                        p_frame_start = instance-&gt;p_bsb_start;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (p_gop-&gt;b_has_extradata) {</div>
<div class="line">                        request_size = sendsize + gop_header_length + DAMBA_RESERVED_SPACE;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        request_size = sendsize + instance-&gt;fast_navi.extradata_size +</div>
<div class="line">                            gop_header_length + DAMBA_RESERVED_SPACE;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    ret = request_bits_fifo(context-&gt;iav_fd, instance-&gt;index, request_size,</div>
<div class="line">                        p_frame_start - instance-&gt;p_bsb_start);</div>
<div class="line">                    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                        u_printf(<span class="stringliteral">&quot;[ERRO]: request_bits_fifo() fail, ret %d.\n&quot;</span>, ret);</div>
<div class="line">                        instance-&gt;navi_mode = PLAYBACK_ERROR;</div>
<div class="line">                        running = 0;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    update_amba_gop_header(is_avc, amba_gop_header,</div>
<div class="line">                        (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>)(3003 * p_gop-&gt;start_frame_index));</div>
<div class="line">                    p_bsb_cur = copy_to_bsb(p_bsb_cur, amba_gop_header, gop_header_length,</div>
<div class="line">                        instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (!p_gop-&gt;b_has_extradata) {</div>
<div class="line">                        p_bsb_cur = copy_to_bsb(p_bsb_cur, instance-&gt;fast_navi.p_extradata,</div>
<div class="line">                            instance-&gt;fast_navi.extradata_size, instance-&gt;p_bsb_start,</div>
<div class="line">                            instance-&gt;p_bsb_end);</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    p_bit_start = p_bsb_cur;</div>
<div class="line">                    <span class="keywordflow">if</span> (context-&gt;debug_read_direct_to_bsb) {</div>
<div class="line">                        p_bit_end = p_bsb_cur = read_file_to_bsb(instance-&gt;file_fd, sendsize,</div>
<div class="line">                            p_gop-&gt;gop_offset, &amp;cur_file_offset, p_bsb_cur, instance-&gt;p_bsb_start,</div>
<div class="line">                            instance-&gt;p_bsb_end);</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        fseek(instance-&gt;file_fd, p_gop-&gt;gop_offset, SEEK_SET);</div>
<div class="line">                        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa6d89b223ba1d6d6b2f8308b45789f60">AMBA_FREAD_FILE</a>(p_file_read_buffer, 1, sendsize, instance-&gt;file_fd);</div>
<div class="line">                        cur_file_offset = p_gop-&gt;gop_offset + sendsize;</div>
<div class="line">                        p_bit_end = p_bsb_cur = copy_to_bsb(p_bsb_cur, p_file_read_buffer,</div>
<div class="line">                            sendsize, instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    decode_video.decoder_id = instance-&gt;index;</div>
<div class="line">                    decode_video.num_frames = p_gop-&gt;frame_count;</div>
<div class="line">                    decode_video.start_ptr_offset = p_frame_start - instance-&gt;p_bsb_start;</div>
<div class="line">                    decode_video.end_ptr_offset = p_bsb_cur - instance-&gt;p_bsb_start;</div>
<div class="line">                    decode_video.first_frame_display = (3003 * p_gop-&gt;start_frame_index);</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (instance-&gt;p_dump_input_file) {</div>
<div class="line">                        write_bsb_data(instance-&gt;p_dump_input_file, p_bit_start, p_bit_end,</div>
<div class="line">                            instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> ((ret = ioctl(context-&gt;iav_fd, IAV_IOC_DECODE_VIDEO, &amp;decode_video)) &lt; 0) {</div>
<div class="line">                        u_printf_error(<span class="stringliteral">&quot;[ERROR]: (decoder %d) IAV_IOC_DECODE_VIDEO ret %d, &quot;</span></div>
<div class="line">                            <span class="stringliteral">&quot;exit loop.\n&quot;</span>, instance-&gt;index, ret);</div>
<div class="line">                        instance-&gt;navi_mode = PLAYBACK_ERROR;</div>
<div class="line">                        running = 0;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    p_gop = p_gop-&gt;p_next;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    instance-&gt;navi_mode = PLAYBACK_PENDDING;</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;(decoder %d) Feed data end.\n&quot;</span>, instance-&gt;index);</div>
<div class="line">                    p_gop = NULL;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> FAST_NAVI_MODE_I_FRAME_FORWARD:</div>
<div class="line">            p_gop = instance-&gt;fast_navi.gop_list_header.p_next;</div>
<div class="line">            cur_file_offset = p_gop-&gt;gop_offset;</div>
<div class="line">            fseek(instance-&gt;file_fd, cur_file_offset, SEEK_SET);</div>
<div class="line">            p_frame_start = p_bsb_cur = instance-&gt;p_bsb_start;</div>
<div class="line"> </div>
<div class="line">            fill_amba_gop_header(is_avc, amba_gop_header, context-&gt;framerate_den, 90000, 0, 1, 1);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">while</span> (1) {</div>
<div class="line">                <span class="keywordflow">if</span> (msg_queue_peek(&amp;instance-&gt;cmd_queue, &amp;msg)) {</div>
<div class="line">                    ret = process_decode_cmd(instance, context, &amp;msg);</div>
<div class="line">                    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (p_gop &amp;&amp; p_gop != &amp;instance-&gt;fast_navi.gop_list_header) {</div>
<div class="line">                    sendsize = p_gop-&gt;frames[1].frame_offset - p_gop-&gt;frames[0].frame_offset;</div>
<div class="line">                    p_frame_start = p_bsb_cur;</div>
<div class="line">                    <span class="comment">//wrap case</span></div>
<div class="line">                    <span class="keywordflow">if</span> (p_frame_start == instance-&gt;p_bsb_end) {</div>
<div class="line">                        p_frame_start = instance-&gt;p_bsb_start;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> (p_gop-&gt;b_has_extradata) {</div>
<div class="line">                        request_size = sendsize + gop_header_length + DAMBA_RESERVED_SPACE;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        request_size = sendsize + instance-&gt;fast_navi.extradata_size +</div>
<div class="line">                            gop_header_length + DAMBA_RESERVED_SPACE;</div>
<div class="line">                    }</div>
<div class="line">                    ret = request_bits_fifo(context-&gt;iav_fd, instance-&gt;index, request_size,</div>
<div class="line">                        p_frame_start - instance-&gt;p_bsb_start);</div>
<div class="line">                    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                        u_printf(<span class="stringliteral">&quot;[ERROR]: request_bits_fifo() fail, ret %d!\n&quot;</span>, ret);</div>
<div class="line">                        instance-&gt;navi_mode = PLAYBACK_ERROR;</div>
<div class="line">                        running = 0;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    update_amba_gop_header(is_avc, amba_gop_header,</div>
<div class="line">                        (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>) (3003 * p_gop-&gt;start_frame_index));</div>
<div class="line">                    p_bsb_cur = copy_to_bsb(p_bsb_cur, amba_gop_header, gop_header_length,</div>
<div class="line">                        instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">                    <span class="keywordflow">if</span> (!p_gop-&gt;b_has_extradata) {</div>
<div class="line">                        p_bsb_cur = copy_to_bsb(p_bsb_cur, instance-&gt;fast_navi.p_extradata,</div>
<div class="line">                            instance-&gt;fast_navi.extradata_size, instance-&gt;p_bsb_start,</div>
<div class="line">                            instance-&gt;p_bsb_end);</div>
<div class="line">                    }</div>
<div class="line">                    p_bit_start = p_bsb_cur;</div>
<div class="line">                    <span class="keywordflow">if</span> (context-&gt;debug_read_direct_to_bsb) {</div>
<div class="line">                        p_bit_end = p_bsb_cur = read_file_to_bsb(instance-&gt;file_fd, sendsize,</div>
<div class="line">                            p_gop-&gt;gop_offset, &amp;cur_file_offset, p_bsb_cur, instance-&gt;p_bsb_start,</div>
<div class="line">                            instance-&gt;p_bsb_end);</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        fseek(instance-&gt;file_fd, p_gop-&gt;gop_offset, SEEK_SET);</div>
<div class="line">                        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa6d89b223ba1d6d6b2f8308b45789f60">AMBA_FREAD_FILE</a>(p_file_read_buffer, 1, sendsize,</div>
<div class="line">                            instance-&gt;file_fd);</div>
<div class="line">                        cur_file_offset = p_gop-&gt;gop_offset + sendsize;</div>
<div class="line">                        p_bit_end = p_bsb_cur = copy_to_bsb(p_bsb_cur, p_file_read_buffer,</div>
<div class="line">                            sendsize, instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> (instance-&gt;p_dump_input_file) {</div>
<div class="line">                        write_bsb_data(instance-&gt;p_dump_input_file, p_bit_start, p_bit_end,</div>
<div class="line">                            instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    decode_video.decoder_id = instance-&gt;index;</div>
<div class="line">                    decode_video.num_frames = 1;</div>
<div class="line">                    decode_video.start_ptr_offset = p_frame_start - instance-&gt;p_bsb_start;</div>
<div class="line">                    decode_video.end_ptr_offset = p_bsb_cur - instance-&gt;p_bsb_start;</div>
<div class="line">                    decode_video.first_frame_display = (3003 * p_gop-&gt;start_frame_index);</div>
<div class="line">                    <span class="keywordflow">if</span> ((ret = ioctl(context-&gt;iav_fd, IAV_IOC_DECODE_VIDEO, &amp;decode_video)) &lt; 0) {</div>
<div class="line">                        u_printf_error(<span class="stringliteral">&quot;[ERROR]: (decoder %d) IAV_IOC_DECODE_VIDEO ret %d, &quot;</span></div>
<div class="line">                            <span class="stringliteral">&quot;exit loop.\n&quot;</span>, instance-&gt;index, ret);</div>
<div class="line">                        instance-&gt;navi_mode = PLAYBACK_ERROR;</div>
<div class="line">                        running = 0;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    p_gop = p_gop-&gt;p_next;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    instance-&gt;navi_mode = PLAYBACK_PENDDING;</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;(decoder %d) Feed data end.\n&quot;</span>, instance-&gt;index);</div>
<div class="line">                    p_gop = NULL;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> FAST_NAVI_MODE_I_FRAME_BACKWARD:</div>
<div class="line">            p_gop = instance-&gt;fast_navi.gop_list_header.p_pre;</div>
<div class="line">            cur_file_offset = p_gop-&gt;gop_offset;</div>
<div class="line">            fseek(instance-&gt;file_fd, cur_file_offset, SEEK_SET);</div>
<div class="line">            p_frame_start = p_bsb_cur = instance-&gt;p_bsb_start;</div>
<div class="line"> </div>
<div class="line">            fill_amba_gop_header(is_avc, amba_gop_header, context-&gt;framerate_den, 90000, 0, 1, 1);</div>
<div class="line">            file_end = 0;</div>
<div class="line">            <span class="keywordflow">while</span> (1) {</div>
<div class="line">                <span class="keywordflow">if</span> (msg_queue_peek(&amp;instance-&gt;cmd_queue, &amp;msg)) {</div>
<div class="line">                    ret = process_decode_cmd(instance, context, &amp;msg);</div>
<div class="line">                    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (p_gop &amp;&amp; p_gop != &amp;instance-&gt;fast_navi.gop_list_header) {</div>
<div class="line">                    <span class="keywordflow">if</span> (p_gop-&gt;p_pre == &amp;instance-&gt;fast_navi.gop_list_header) {</div>
<div class="line">                        file_end = 1;</div>
<div class="line">                    }</div>
<div class="line">                    sendsize = p_gop-&gt;frames[1].frame_offset - p_gop-&gt;frames[0].frame_offset;</div>
<div class="line">                    p_frame_start = p_bsb_cur;</div>
<div class="line">                    <span class="comment">//wrap case</span></div>
<div class="line">                    <span class="keywordflow">if</span> (p_frame_start == instance-&gt;p_bsb_end) {</div>
<div class="line">                        p_frame_start = instance-&gt;p_bsb_start;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> (!is_avc || p_gop-&gt;b_has_extradata) {</div>
<div class="line">                        request_size = sendsize + gop_header_length + DAMBA_RESERVED_SPACE;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        request_size = sendsize + instance-&gt;fast_navi.extradata_size +</div>
<div class="line">                            gop_header_length + DAMBA_RESERVED_SPACE;</div>
<div class="line">                    }</div>
<div class="line">                    ret = request_bits_fifo(context-&gt;iav_fd, instance-&gt;index, request_size,</div>
<div class="line">                        p_frame_start - instance-&gt;p_bsb_start);</div>
<div class="line">                    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                        u_printf(<span class="stringliteral">&quot;[ERROR]: (decoder %d) request_bits_fifo() fail, ret %d!\n&quot;</span>, instance-&gt;index, ret);</div>
<div class="line">                        instance-&gt;navi_mode = PLAYBACK_ERROR;</div>
<div class="line">                        running = 0;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                    update_amba_gop_header(is_avc, amba_gop_header,</div>
<div class="line">                        (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>)(3003 * p_gop-&gt;start_frame_index));</div>
<div class="line">                    p_bsb_cur = copy_to_bsb(p_bsb_cur, amba_gop_header, gop_header_length,</div>
<div class="line">                        instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (!p_gop-&gt;b_has_extradata) {</div>
<div class="line">                        p_bsb_cur = copy_to_bsb(p_bsb_cur, instance-&gt;fast_navi.p_extradata,</div>
<div class="line">                            instance-&gt;fast_navi.extradata_size, instance-&gt;p_bsb_start,</div>
<div class="line">                            instance-&gt;p_bsb_end);</div>
<div class="line">                    }</div>
<div class="line">                    p_bit_start = p_bsb_cur;</div>
<div class="line">                    <span class="keywordflow">if</span> (context-&gt;debug_read_direct_to_bsb) {</div>
<div class="line">                        p_bit_end = p_bsb_cur = read_file_to_bsb(instance-&gt;file_fd, sendsize,</div>
<div class="line">                            p_gop-&gt;gop_offset, &amp;cur_file_offset, p_bsb_cur, instance-&gt;p_bsb_start,</div>
<div class="line">                            instance-&gt;p_bsb_end);</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        fseek(instance-&gt;file_fd, p_gop-&gt;gop_offset, SEEK_SET);</div>
<div class="line">                        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa6d89b223ba1d6d6b2f8308b45789f60">AMBA_FREAD_FILE</a>(p_file_read_buffer, 1, sendsize, instance-&gt;file_fd);</div>
<div class="line">                        cur_file_offset = p_gop-&gt;gop_offset + sendsize;</div>
<div class="line">                        p_bit_end = p_bsb_cur = copy_to_bsb(p_bsb_cur, p_file_read_buffer,</div>
<div class="line">                            sendsize, instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> (is_avc) {</div>
<div class="line">                        <span class="keywordflow">if</span> (!file_end) {</div>
<div class="line">                            p_bsb_cur = copy_to_bsb(p_bsb_cur, avc_end_of_sequence,</div>
<div class="line">                                <span class="keyword">sizeof</span>(avc_end_of_sequence), instance-&gt;p_bsb_start,</div>
<div class="line">                                instance-&gt;p_bsb_end);</div>
<div class="line">                        } <span class="keywordflow">else</span> {</div>
<div class="line">                            p_bsb_cur = copy_to_bsb(p_bsb_cur, avc_end_of_stream,</div>
<div class="line">                                <span class="keyword">sizeof</span>(avc_end_of_stream), instance-&gt;p_bsb_start,</div>
<div class="line">                                instance-&gt;p_bsb_end);</div>
<div class="line">                            u_printf(<span class="stringliteral">&quot;(decoder %d) feed end of avc stream\n&quot;</span>, instance-&gt;index);</div>
<div class="line">                        }</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keywordflow">if</span> (!file_end) {</div>
<div class="line">                            p_bsb_cur = copy_to_bsb(p_bsb_cur, hevc_end_of_sequence,</div>
<div class="line">                                <span class="keyword">sizeof</span>(hevc_end_of_sequence), instance-&gt;p_bsb_start,</div>
<div class="line">                                instance-&gt;p_bsb_end);</div>
<div class="line">                        } <span class="keywordflow">else</span> {</div>
<div class="line">                            p_bsb_cur = copy_to_bsb(p_bsb_cur, hevc_end_of_stream,</div>
<div class="line">                                <span class="keyword">sizeof</span>(hevc_end_of_stream), instance-&gt;p_bsb_start,</div>
<div class="line">                                instance-&gt;p_bsb_end);</div>
<div class="line">                            u_printf(<span class="stringliteral">&quot;(decoder %d) feed end of hevc stream\n&quot;</span>, instance-&gt;index);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    decode_video.decoder_id = instance-&gt;index;</div>
<div class="line">                    decode_video.num_frames = 1;</div>
<div class="line">                    decode_video.start_ptr_offset = p_frame_start - instance-&gt;p_bsb_start;</div>
<div class="line">                    decode_video.end_ptr_offset = p_bsb_cur - instance-&gt;p_bsb_start;</div>
<div class="line">                    decode_video.first_frame_display = (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>) (3003 * p_gop-&gt;start_frame_index);</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (instance-&gt;p_dump_input_file) {</div>
<div class="line">                        write_bsb_data(instance-&gt;p_dump_input_file, p_bit_start, p_bit_end,</div>
<div class="line">                            instance-&gt;p_bsb_start, instance-&gt;p_bsb_end);</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> ((ret = ioctl(context-&gt;iav_fd, IAV_IOC_DECODE_VIDEO, &amp;decode_video)) &lt; 0) {</div>
<div class="line">                        u_printf_error(<span class="stringliteral">&quot;[ERROR]: (decoder %d) IAV_IOC_DECODE_VIDEO ret %d, &quot;</span></div>
<div class="line">                            <span class="stringliteral">&quot;exit loop.\n&quot;</span>, instance-&gt;index, ret);</div>
<div class="line">                        instance-&gt;navi_mode = PLAYBACK_ERROR;</div>
<div class="line">                        running = 0;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    p_gop = p_gop-&gt;p_pre;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    instance-&gt;navi_mode = PLAYBACK_PENDDING;</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;(decoder %d) Feed data end.\n&quot;</span>, instance-&gt;index);</div>
<div class="line">                    p_gop = NULL;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> PLAYBACK_PENDDING:</div>
<div class="line">            msg_queue_get(&amp;instance-&gt;cmd_queue, &amp;msg);</div>
<div class="line">            printf(<span class="stringliteral">&quot;Get cmd in pending\n&quot;</span>);</div>
<div class="line">            process_decode_cmd(instance, context, &amp;msg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> PLAYBACK_ERROR:</div>
<div class="line">            running = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> PLAYBACK_EXIT:</div>
<div class="line">            running = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (p_file_read_buffer) {</div>
<div class="line">        free(p_file_read_buffer);</div>
<div class="line">        p_file_read_buffer = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;[FLOW]: (decoder %d) decode_fast_navi end.\n&quot;</span>, instance-&gt;index);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> decide_decoder_bsb(decode_context *context, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> total_reso)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> reso = 0, bsb_size = 0, total_bsb_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;mode_config.num_decoder == 1) {</div>
<div class="line">        context-&gt;decoder[0].p_bsb_start = context-&gt;bsb_base;</div>
<div class="line">        context-&gt;decoder[0].p_bsb_end = context-&gt;bsb_base + context-&gt;bsb_size;</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[Debug]: Decoder 0 BSB size 0x%x, start_addr %p, end_addr %p.\n&quot;</span>,</div>
<div class="line">            context-&gt;bsb_size, context-&gt;decoder[0].p_bsb_start, context-&gt;decoder[0].p_bsb_end);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* decide the decoder bsb size according to the resolution */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;mode_config.num_decoder; i++) {</div>
<div class="line">        reso = context-&gt;decoder[i].clip_width * context-&gt;decoder[i].clip_height;</div>
<div class="line">        bsb_size = <a id="a117" name="a117"></a><a class="code hl_define" href="../../dummy.html">ROUND_DOWN</a>((<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a>)context-&gt;bsb_size * reso / total_reso, DECODER_BSB_ALIGN_SIZE);</div>
<div class="line">        <span class="keywordflow">if</span> (bsb_size &lt; DECODER_BSB_MIN_SIZE) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[WARNING]: Decoder %d allocated BSB size 0x%x is too small! Use min size(0x%x) &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;\n&quot;</span>, i, bsb_size, DECODER_BSB_MIN_SIZE);</div>
<div class="line">            bsb_size = DECODER_BSB_MIN_SIZE;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; context-&gt;mode_config.num_decoder - 1) {</div>
<div class="line">            context-&gt;decoder[i].p_bsb_start = context-&gt;bsb_base + total_bsb_size;</div>
<div class="line">            context-&gt;decoder[i].p_bsb_end = context-&gt;bsb_base + total_bsb_size + bsb_size;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            context-&gt;decoder[i].p_bsb_start = context-&gt;bsb_base + total_bsb_size;</div>
<div class="line">            context-&gt;decoder[i].p_bsb_end = context-&gt;bsb_base + context-&gt;bsb_size;</div>
<div class="line">        }</div>
<div class="line">        total_bsb_size += bsb_size;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (total_bsb_size &gt; context-&gt;bsb_size) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[Error]: %d decoders need total bsb size 0x%x,&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;system total bsb size only 0x%x!!!&quot;</span>, i, total_bsb_size, context-&gt;bsb_size);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[Debug]: Decoder %d BSB size 0x%x, start_addr %p, end_addr %p.\n&quot;</span>,</div>
<div class="line">                i, bsb_size, context-&gt;decoder[i].p_bsb_start, context-&gt;decoder[i].p_bsb_end);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> run_decode(decode_context* context)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cur_timestamp = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> repeat_timestamp = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> repeat_times = 0, total_reso = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> i;</div>
<div class="line">    msg_t msg;</div>
<div class="line">    <span class="keywordtype">void</span>* pv;</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;mode_config.num_decoder; i++) {</div>
<div class="line">        ret = open_input_file(&amp;context-&gt;decoder[i], context-&gt;mode_config.decoder_type[i]);</div>
<div class="line">        context-&gt;decoder[i].index = i;</div>
<div class="line">        <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (context-&gt;mode_config.max_height &lt; context-&gt;decoder[i].clip_height)</div>
<div class="line">            context-&gt;mode_config.max_height = context-&gt;decoder[i].clip_height;</div>
<div class="line">        <span class="keywordflow">if</span> (context-&gt;mode_config.max_width &lt; context-&gt;decoder[i].clip_width)</div>
<div class="line">            context-&gt;mode_config.max_width = context-&gt;decoder[i].clip_width;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (context-&gt;max_width &lt; context-&gt;decoder[i].clip_width) {</div>
<div class="line">            context-&gt;max_width = context-&gt;decoder[i].clip_width;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (context-&gt;max_height &lt; context-&gt;decoder[i].clip_height) {</div>
<div class="line">            context-&gt;max_height = context-&gt;decoder[i].clip_height;</div>
<div class="line">        }</div>
<div class="line">        total_reso += context-&gt;decoder[i].clip_width *</div>
<div class="line">            context-&gt;decoder[i].clip_height;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;total_reso = %d!\n&quot;</span>, total_reso);</div>
<div class="line">    ret = decide_decoder_bsb(context, total_reso);</div>
<div class="line">    <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//disable fast fw, fast bw and backward playback</span></div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[config]: max width %d, max height %d, max bitrate %d, disable fast fw/bw and &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;backward playabck, reset vout %d.\n&quot;</span>, context-&gt;max_width, context-&gt;max_height, context-&gt;max_bitrate,</div>
<div class="line">        context-&gt;reset_vout_flag);</div>
<div class="line">    ret = enter_decode_mode(context, context-&gt;max_width, context-&gt;max_height, context-&gt;max_bitrate,</div>
<div class="line">        0, context-&gt;debug_use_dproc, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[error]: Enter decode mode fail!!!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    playback_1xfw = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;mode_config.num_decoder; i++) {</div>
<div class="line">        ret = create_decoder(context, i, context-&gt;mode_config.decoder_type[i]);</div>
<div class="line">        <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;mode_config.num_decoder; i++) {</div>
<div class="line">        ret = ioctl_decode_start(context-&gt;iav_fd, i);</div>
<div class="line">        <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line">        ioctl_decode_speed(context-&gt;iav_fd, i, 0x100, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a17775b31c0f89faa7583b122ef786d1d">IAV_DEC_SCAN_MODE_ALL_FRAMES</a>,</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaf641f844229bde49393b667c0314bee8adb6b016034e55d10deea6d1a8dbab2c3">IAV_DEC_DIR_FW</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;mode_config.num_decoder; i++) {</div>
<div class="line">        ret = pthread_create(&amp;context-&gt;decoder[i].thread_id, NULL, decode_thread,</div>
<div class="line">            (<span class="keywordtype">void</span>*) &amp;context-&gt;decoder[i]);</div>
<div class="line">        <span class="keywordflow">if</span> (ret) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;pthread_create&quot;</span>);</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[ERROR]: pthread_create fail, ret %d!\n&quot;</span>, ret);</div>
<div class="line">            <span class="keywordflow">if</span> (0) {</div>
<div class="line">                <span class="keywordflow">goto</span> _test_decode_fail_;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                decode_thread((<span class="keywordtype">void</span>*) &amp;context-&gt;decoder[i]);</div>
<div class="line">                sleep(6);</div>
<div class="line">                destroy_decoder(context, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>) i);</div>
<div class="line">                leave_decode_mode(context);</div>
<div class="line">                <span class="keywordflow">return</span> (-18);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    decode_running = context-&gt;mode_config.num_decoder;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> buffer_old[128] = {0};</div>
<div class="line">    <span class="keywordtype">char</span> <a id="a118" name="a118"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>[128];</div>
<div class="line">    <span class="keywordtype">char</span>* p_buffer = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>;</div>
<div class="line"> </div>
<div class="line">    memset(buffer, 0x0, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">    memset(buffer_old, 0x0, <span class="keyword">sizeof</span>(buffer_old));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> flag_stdin = 0;</div>
<div class="line">    flag_stdin = fcntl(STDIN_FILENO, F_GETFL);</div>
<div class="line">    <span class="keywordflow">if</span> (fcntl(STDIN_FILENO, F_SETFL, fcntl(STDIN_FILENO,F_GETFL) | O_NONBLOCK) == -1) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: stdin_fileno set error!\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (decode_running) {</div>
<div class="line">        usleep(100000);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!context-&gt;disable_runtime_cmd_flag) {</div>
<div class="line">            memset(buffer, 0x0, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">            <span class="keywordflow">if</span> (read(STDIN_FILENO, buffer, <span class="keyword">sizeof</span>(buffer)) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">if</span> (context-&gt;watch_last_pts) {</div>
<div class="line">                    <span class="comment">//check if last frame is displayed</span></div>
<div class="line">                    <span class="keywordflow">if</span> ((feed_bitstream_done == context-&gt;mode_config.num_decoder) &amp;&amp; playback_1xfw) {</div>
<div class="line">                        ret = get_curr_pts(context-&gt;iav_fd, 0, &amp;cur_timestamp);</div>
<div class="line">                        <span class="keywordflow">if</span> (ret) {</div>
<div class="line">                            decode_running = 0;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> (((cur_timestamp + 6600) &gt; last_timestamp) &amp;&amp;</div>
<div class="line">                            (cur_timestamp &lt; (last_timestamp + 6600))) {</div>
<div class="line">                            u_printf(<span class="stringliteral">&quot;Receive last time stamp %ld, target %ld.\n&quot;</span>, cur_timestamp,</div>
<div class="line">                                last_timestamp);</div>
<div class="line">                            decode_running = 0;</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> (repeat_timestamp == cur_timestamp) {</div>
<div class="line">                            <span class="keywordflow">if</span> (repeat_times &gt; 32) {</div>
<div class="line">                                u_printf(<span class="stringliteral">&quot;Receive repeat timestamp, last %ld, target %ld, gap %ld.\n&quot;</span>,</div>
<div class="line">                                    cur_timestamp, last_timestamp, last_timestamp - cur_timestamp);</div>
<div class="line">                                decode_running = 0;</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            }</div>
<div class="line">                            repeat_times ++;</div>
<div class="line">                        } <span class="keywordflow">else</span> {</div>
<div class="line">                            repeat_times = 0;</div>
<div class="line">                        }</div>
<div class="line">                        repeat_timestamp = cur_timestamp;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (buffer[0] == <span class="charliteral">&#39;\n&#39;</span>) {</div>
<div class="line">                p_buffer = buffer_old;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Repeat last cmd:\n\t\t%s.\n&quot;</span>, buffer_old);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buffer[0] == <span class="charliteral">&#39;l&#39;</span>) {</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Show last cmd:\n\t\t%s.\n&quot;</span>, buffer_old);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                p_buffer = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>;</div>
<div class="line">                <span class="comment">//record last cmd</span></div>
<div class="line">                memcpy(buffer_old, buffer, <span class="keyword">sizeof</span>(buffer_old));</div>
<div class="line">                buffer_old[<span class="keyword">sizeof</span>(buffer_old) -1] = 0x0;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">switch</span> (p_buffer[0]) {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Quit, &#39;q&#39;\n&quot;</span>);</div>
<div class="line">                decode_running = 0;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div>
<div class="line">                <span class="keywordflow">if</span> (0) {</div>
<div class="line">                    query_bsb_status(context-&gt;iav_fd, 0);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    query_decode_status(context-&gt;iav_fd, 0);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39; &#39;</span>:</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73ad6c57690f06691de342336b20504e812">IAV_DEC_RESUME</a> == context-&gt;decoder[0].current_trickplay) {</div>
<div class="line">                    context-&gt;decoder[0].current_trickplay = <a id="a119" name="a119"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73a096003e21e15fd3a848ce5b1ef16dc92">IAV_DEC_PAUSE</a>;</div>
<div class="line">                    ioctl_decode_trick_play(context-&gt;iav_fd, 0, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73a096003e21e15fd3a848ce5b1ef16dc92">IAV_DEC_PAUSE</a>);</div>
<div class="line">                    playback_1xfw = 0;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    context-&gt;decoder[0].current_trickplay = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73ad6c57690f06691de342336b20504e812">IAV_DEC_RESUME</a>;</div>
<div class="line">                    ioctl_decode_trick_play(context-&gt;iav_fd, 0, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73ad6c57690f06691de342336b20504e812">IAV_DEC_RESUME</a>);</div>
<div class="line">                    playback_1xfw = 1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">                context-&gt;decoder[0].current_trickplay = <a id="a120" name="a120"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73aa087a19647753cd5c47e8635f7ad069a">IAV_DEC_STEP</a>;</div>
<div class="line">                ioctl_decode_trick_play(context-&gt;iav_fd, 0, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73aa087a19647753cd5c47e8635f7ad069a">IAV_DEC_STEP</a>);</div>
<div class="line">                playback_1xfw = 0;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Not support fast navigation, you need add &#39;--fastnavi&#39;.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Not support fast navigation, you need add &#39;--fastnavi&#39;.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Not supported cmd: &#39;%c&#39;.\n&quot;</span>, p_buffer[0]);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fcntl(STDIN_FILENO, F_SETFL, flag_stdin) == -1) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: stdin_fileno set error!\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: start exit.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//exit each threads</span></div>
<div class="line">    msg.cmd = M_MSG_KILL;</div>
<div class="line">    msg.ptr = NULL;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;mode_config.num_decoder; i++) {</div>
<div class="line">        msg_queue_put(&amp;context-&gt;decoder[i].cmd_queue, &amp;msg);</div>
<div class="line">        ioctl_decode_stop(context-&gt;iav_fd, i, 1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;mode_config.num_decoder; i++) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[FLOW]: Wait decoder_thread(%d) exit...\n&quot;</span>, i);</div>
<div class="line">        ret = pthread_join(context-&gt;decoder[i].thread_id, &amp;pv);</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[FLOW]: Wait decoder_thread(%d) exit done, (ret %d).\n&quot;</span>, i, ret);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">_test_decode_fail_:</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;mode_config.num_decoder; i++) {</div>
<div class="line">        ret = destroy_decoder(context, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>) i);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;debug_return_idle || context-&gt;playback_flag) {</div>
<div class="line">        leave_decode_mode(context);</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[FLOW]: After leave decode mode.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> run_fast_navi_decode(decode_context* context)</div>
<div class="line">{</div>
<div class="line">    msg_t msg;</div>
<div class="line">    <span class="keywordtype">void</span>* pv;</div>
<div class="line">    <span class="keywordtype">int</span> frame_count, ret = 0;</div>
<div class="line"> </div>
<div class="line">    ret = open_input_file(&amp;context-&gt;decoder[0], context-&gt;mode_config.decoder_type[0]);</div>
<div class="line">    <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;max_width &lt; context-&gt;decoder[0].clip_width) {</div>
<div class="line">        context-&gt;max_width = context-&gt;decoder[0].clip_width;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;max_height &lt; context-&gt;decoder[0].clip_height) {</div>
<div class="line">        context-&gt;max_height = context-&gt;decoder[0].clip_height;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a4ae5fb6b6d878ad88a8bff8b3b20af91">IAV_DEC_TYPE_H264</a> == context-&gt;mode_config.decoder_type[0]) {</div>
<div class="line">        ret = <a id="a121" name="a121"></a><a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#a121c492ce6c7eae962e8e1af32a924c7">build_fast_navi_tree</a>(context-&gt;decoder[0].file_fd,</div>
<div class="line">            &amp;context-&gt;decoder[0].fast_navi);</div>
<div class="line">        <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a3507538744216d4eb584662c10da89cc">IAV_DEC_TYPE_H265</a> == context-&gt;mode_config.decoder_type[0]) {</div>
<div class="line">        ret = <a id="a122" name="a122"></a><a class="code hl_functionRef" target="_blank" href="../../../video/dd/d03/playback__helper_8h.html#a3c189864dd8261f35c487b1cd1ff0470">build_fast_navi_tree_h265</a>(context-&gt;decoder[0].file_fd,</div>
<div class="line">            &amp;context-&gt;decoder[0].fast_navi);</div>
<div class="line">        <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;[ERROR]: Not h264 or h265.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> (-1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;decoder[0].fast_navi.gop_list_header.p_next) {</div>
<div class="line">        frame_count = context-&gt;decoder[0].fast_navi.gop_list_header.p_next-&gt;frame_count;</div>
<div class="line">        <span class="keywordflow">if</span> (frame_count) {</div>
<div class="line">            <span class="keywordflow">if</span> (context-&gt;max_gop_size &lt; frame_count) {</div>
<div class="line">                context-&gt;max_gop_size = frame_count;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    context-&gt;max_n_to_m_ratio = context-&gt;max_gop_size;</div>
<div class="line"> </div>
<div class="line">    context-&gt;decoder[0].p_bsb_start = context-&gt;bsb_base;</div>
<div class="line">    context-&gt;decoder[0].p_bsb_end = context-&gt;bsb_base + context-&gt;bsb_size;</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[config]: max width %d, max height %d, max bitrate %d, enable fast fw/bw and &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;backward playabck, reset vout %d\n&quot;</span>, context-&gt;max_width, context-&gt;max_height, context-&gt;max_bitrate,</div>
<div class="line">        context-&gt;reset_vout_flag);</div>
<div class="line">    ret = enter_decode_mode(context, context-&gt;max_width, context-&gt;max_height, context-&gt;max_bitrate,</div>
<div class="line">        1, context-&gt;debug_use_dproc, context-&gt;max_n_to_m_ratio);</div>
<div class="line">    <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ret = create_decoder(context, 0, context-&gt;mode_config.decoder_type[0]);</div>
<div class="line">    <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    ret = ioctl_decode_start(context-&gt;iav_fd, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (0 &gt; ret) {</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// initial speed, playback mode</span></div>
<div class="line">    <span class="keywordflow">if</span> (0 == context-&gt;initial_speed) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: Not specify speed use default 1x.\n&quot;</span>);</div>
<div class="line">        context-&gt;initial_speed = 1;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> speed = ((<a id="a123" name="a123"></a><a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga9e6c91d77e24643b888dbd1a1a590054">u16</a>) context-&gt;initial_speed) &lt;&lt; 8;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (context-&gt;initial_navi_mode) {</div>
<div class="line">        <span class="keywordflow">case</span> FAST_NAVI_MODE_ALL_FRAME_FORWARD:</div>
<div class="line">        ioctl_decode_speed(context-&gt;iav_fd, 0, speed, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a17775b31c0f89faa7583b122ef786d1d">IAV_DEC_SCAN_MODE_ALL_FRAMES</a>,</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaf641f844229bde49393b667c0314bee8adb6b016034e55d10deea6d1a8dbab2c3">IAV_DEC_DIR_FW</a>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> FAST_NAVI_MODE_I_FRAME_FORWARD:</div>
<div class="line">        ioctl_decode_speed(context-&gt;iav_fd, 0, speed, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a3fb0ffa93f566c7b813eb588ab27072a">IAV_DEC_SCAN_MODE_I_ONLY</a>,</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaf641f844229bde49393b667c0314bee8adb6b016034e55d10deea6d1a8dbab2c3">IAV_DEC_DIR_FW</a>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> FAST_NAVI_MODE_I_FRAME_BACKWARD:</div>
<div class="line">        ioctl_decode_speed(context-&gt;iav_fd, 0, speed, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a3fb0ffa93f566c7b813eb588ab27072a">IAV_DEC_SCAN_MODE_I_ONLY</a>,</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaf641f844229bde49393b667c0314bee8a3da2e487ff2083db8e5f996eba894095">IAV_DEC_DIR_BW</a>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: Bad initial navi mode, %d!\n&quot;</span>, context-&gt;initial_navi_mode);</div>
<div class="line">        <span class="keywordflow">return</span> (-1);</div>
<div class="line">    }</div>
<div class="line">    context-&gt;decoder[0].navi_mode = context-&gt;initial_navi_mode;</div>
<div class="line"> </div>
<div class="line">    pthread_create(&amp;context-&gt;decoder[0].thread_id, NULL, decode_fast_navi,</div>
<div class="line">        (<span class="keywordtype">void</span>*) &amp;context-&gt;decoder[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> buffer_old[128] = {0};</div>
<div class="line">    <span class="keywordtype">char</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>[128];</div>
<div class="line">    <span class="keywordtype">char</span>* p_buffer = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>;</div>
<div class="line"> </div>
<div class="line">    memset(buffer, 0x0, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">    memset(buffer_old, 0x0, <span class="keyword">sizeof</span>(buffer_old));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> flag_stdin = 0;</div>
<div class="line">    flag_stdin = fcntl(STDIN_FILENO, F_GETFL);</div>
<div class="line">    <span class="keywordflow">if</span> (fcntl(STDIN_FILENO, F_SETFL, fcntl(STDIN_FILENO, F_GETFL) | O_NONBLOCK) == -1) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: stdin_fileno set error!\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (decode_running) {</div>
<div class="line">        usleep(100000);</div>
<div class="line">        memset(buffer, 0x0, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">        <span class="keywordflow">if</span> (read(STDIN_FILENO, buffer, <span class="keyword">sizeof</span>(buffer)) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (buffer[0] == <span class="charliteral">&#39;\n&#39;</span>) {</div>
<div class="line">            p_buffer = buffer_old;</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;Repeat last cmd:\n\t\t%s.\n&quot;</span>, buffer_old);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buffer[0] == <span class="charliteral">&#39;l&#39;</span>) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;Show last cmd:\n\t\t%s.\n&quot;</span>, buffer_old);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            p_buffer = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>;</div>
<div class="line">            <span class="comment">//record last cmd</span></div>
<div class="line">            memcpy(buffer_old, buffer, <span class="keyword">sizeof</span>(buffer_old));</div>
<div class="line">            buffer_old[<span class="keyword">sizeof</span>(buffer_old) -1] = 0x0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<span class="charliteral">&#39;q&#39;</span> == p_buffer[0]) {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;Quit, &#39;q&#39;\n&quot;</span>);</div>
<div class="line">            decode_running = 0;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;p&#39;</span> == p_buffer[0]) {</div>
<div class="line">            <span class="keywordflow">if</span> (0) {</div>
<div class="line">                query_bsb_status(context-&gt;iav_fd, 0);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                query_decode_status(context-&gt;iav_fd, 0);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39; &#39;</span> == p_buffer[0]) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73ad6c57690f06691de342336b20504e812">IAV_DEC_RESUME</a> == context-&gt;decoder[0].current_trickplay) {</div>
<div class="line">                context-&gt;decoder[0].current_trickplay = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73a096003e21e15fd3a848ce5b1ef16dc92">IAV_DEC_PAUSE</a>;</div>
<div class="line">                ioctl_decode_trick_play(context-&gt;iav_fd, 0, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73a096003e21e15fd3a848ce5b1ef16dc92">IAV_DEC_PAUSE</a>);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                context-&gt;decoder[0].current_trickplay = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73ad6c57690f06691de342336b20504e812">IAV_DEC_RESUME</a>;</div>
<div class="line">                ioctl_decode_trick_play(context-&gt;iav_fd, 0, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73ad6c57690f06691de342336b20504e812">IAV_DEC_RESUME</a>);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;s&#39;</span> == p_buffer[0]) {</div>
<div class="line">            context-&gt;decoder[0].current_trickplay = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73aa087a19647753cd5c47e8635f7ad069a">IAV_DEC_STEP</a>;</div>
<div class="line">            ioctl_decode_trick_play(context-&gt;iav_fd, 0, <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73aa087a19647753cd5c47e8635f7ad069a">IAV_DEC_STEP</a>);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;f&#39;</span> == p_buffer[0]) {</div>
<div class="line">            <span class="keywordflow">if</span> (<span class="charliteral">&#39;1&#39;</span> == p_buffer[1]) {</div>
<div class="line">                msg_t msg;</div>
<div class="line">                msg.cmd = M_MSG_FW_FROM_BEGIN;</div>
<div class="line">                msg.arg1 = 1;</div>
<div class="line">                msg.arg2 = 0;</div>
<div class="line">                msg_queue_put(&amp;context-&gt;decoder[0].cmd_queue, &amp;msg);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;2&#39;</span> == p_buffer[1]) {</div>
<div class="line">                msg_t msg;</div>
<div class="line">                msg.cmd = M_MSG_FW_FROM_BEGIN;</div>
<div class="line">                msg.arg1 = 2;</div>
<div class="line">                msg.arg2 = 0;</div>
<div class="line">                msg_queue_put(&amp;context-&gt;decoder[0].cmd_queue, &amp;msg);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;4&#39;</span> == p_buffer[1]) {</div>
<div class="line">                msg_t msg;</div>
<div class="line">                msg.cmd = M_MSG_FW_FROM_BEGIN;</div>
<div class="line">                msg.arg1 = 4;</div>
<div class="line">                msg.arg2 = 0;</div>
<div class="line">                msg_queue_put(&amp;context-&gt;decoder[0].cmd_queue, &amp;msg);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;8&#39;</span> == p_buffer[1]) {</div>
<div class="line">                msg_t msg;</div>
<div class="line">                msg.cmd = M_MSG_FW_FROM_BEGIN;</div>
<div class="line">                msg.arg1 = 8;</div>
<div class="line">                msg.arg2 = 0;</div>
<div class="line">                msg_queue_put(&amp;context-&gt;decoder[0].cmd_queue, &amp;msg);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;b&#39;</span> == p_buffer[0]) {</div>
<div class="line">            <span class="keywordflow">if</span> (<span class="charliteral">&#39;1&#39;</span> == p_buffer[1]) {</div>
<div class="line">                msg_t msg;</div>
<div class="line">                msg.cmd = M_MSG_BW_FROM_END;</div>
<div class="line">                msg.arg1 = 1;</div>
<div class="line">                msg.arg2 = 0;</div>
<div class="line">                msg_queue_put(&amp;context-&gt;decoder[0].cmd_queue, &amp;msg);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;2&#39;</span> == p_buffer[1]) {</div>
<div class="line">                msg_t msg;</div>
<div class="line">                msg.cmd = M_MSG_BW_FROM_END;</div>
<div class="line">                msg.arg1 = 2;</div>
<div class="line">                msg.arg2 = 0;</div>
<div class="line">                msg_queue_put(&amp;context-&gt;decoder[0].cmd_queue, &amp;msg);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;4&#39;</span> == p_buffer[1]) {</div>
<div class="line">                msg_t msg;</div>
<div class="line">                msg.cmd = M_MSG_BW_FROM_END;</div>
<div class="line">                msg.arg1 = 4;</div>
<div class="line">                msg.arg2 = 0;</div>
<div class="line">                msg_queue_put(&amp;context-&gt;decoder[0].cmd_queue, &amp;msg);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;8&#39;</span> == p_buffer[1]) {</div>
<div class="line">                msg_t msg;</div>
<div class="line">                msg.cmd = M_MSG_BW_FROM_END;</div>
<div class="line">                msg.arg1 = 8;</div>
<div class="line">                msg.arg2 = 0;</div>
<div class="line">                msg_queue_put(&amp;context-&gt;decoder[0].cmd_queue, &amp;msg);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fcntl(STDIN_FILENO, F_SETFL, flag_stdin) == -1) {</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;[ERROR]: stdin_fileno set error!\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: Start exit.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//exit each threads</span></div>
<div class="line">    msg.cmd = M_MSG_KILL;</div>
<div class="line">    msg.ptr = NULL;</div>
<div class="line"> </div>
<div class="line">    msg_queue_put(&amp;context-&gt;decoder[0].cmd_queue, &amp;msg);</div>
<div class="line">    ioctl_decode_stop(context-&gt;iav_fd, 0, 1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: Wait decoder_thread(0) exit...\n&quot;</span>);</div>
<div class="line">    ret = pthread_join(context-&gt;decoder[0].thread_id, &amp;pv);</div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: Wait decoder_thread(0) exit done, (ret %d).\n&quot;</span>, ret);</div>
<div class="line"> </div>
<div class="line">    ret = destroy_decoder(context, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context-&gt;debug_return_idle) {</div>
<div class="line">        leave_decode_mode(context);</div>
<div class="line">        u_printf(<span class="stringliteral">&quot;FLOW]: After leave decode mode.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a124" name="a124"></a><a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> vout_num = 0, i, ret = 0;</div>
<div class="line">    decode_context context;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html">iav_decode_mode_config</a> *mode_cfg = NULL;</div>
<div class="line">    vout_device_info *<a id="a125" name="a125"></a><a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a6f7930f1096a9f89746c745c26b669e7">vout_info</a> = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        usage();</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    signal(SIGINT, sig_stop);</div>
<div class="line">    signal(SIGQUIT, sig_stop);</div>
<div class="line">    signal(SIGTERM, sig_stop);</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: test_decode start.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;context, 0x0, <span class="keyword">sizeof</span>(context));</div>
<div class="line">    context.iav_fd = -1;</div>
<div class="line"> </div>
<div class="line">    context.iav_fd = open(<span class="stringliteral">&quot;/dev/iav&quot;</span>, O_RDWR, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (context.iav_fd &lt; 0) {</div>
<div class="line">        u_printf_error(<span class="stringliteral">&quot;[ERROR]: Failed to open iav fail!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//default settings</span></div>
<div class="line">    context.debug_read_direct_to_bsb = 1;</div>
<div class="line">    context.max_width = 1920;</div>
<div class="line">    context.max_height = 1088;</div>
<div class="line">    context.framerate_den = 3003;</div>
<div class="line">    context.watch_last_pts = 0;</div>
<div class="line">    context.initial_navi_mode = FAST_NAVI_MODE_ALL_FRAME_FORWARD;</div>
<div class="line">    context.initial_speed = 1;</div>
<div class="line">    context.gop_m = 1;</div>
<div class="line">    context.gop_n = 30;</div>
<div class="line">    context.reset_vout_flag = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((ret = init_param(argc, argv, &amp;context)) &lt; 0) {</div>
<div class="line">        u_printf_error(<span class="stringliteral">&quot;[ERROR]: init_params() fail!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    mode_cfg = &amp;context.mode_config;</div>
<div class="line">    <span class="keywordflow">if</span> (context.dec_cfg_lua) {</div>
<div class="line">        mode_cfg-&gt;<a id="a126" name="a126"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a5e6c6a36ce8c85207cd885084eb60680">num_decoder</a> = <a class="code hl_variableRef" target="_blank" href="../../../video/d2/de8/dec__lua__cfg_8c.html#a9ebe61052444d40c189eb1e6997f701b">mc_dec_cfg</a>.<a id="a127" name="a127"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d6/d8d/structmchan__dec__cfg.html#ad18eb86b5033a823dc1a38ca71fb94e4">chan_num</a>;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; context.mode_config.num_decoder; i++) {</div>
<div class="line">            mode_cfg-&gt;<a id="a128" name="a128"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#abe6d84458572cf383b1c925e385e1e5f">decoder_type</a>[i] = <a class="code hl_variableRef" target="_blank" href="../../../video/d2/de8/dec__lua__cfg_8c.html#a9ebe61052444d40c189eb1e6997f701b">mc_dec_cfg</a>.<a id="a129" name="a129"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d6/d8d/structmchan__dec__cfg.html#a7e32945474bf3090a4c47d0ab1fb4ef5">dec_cfg</a>[i].<a id="a130" name="a130"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d3/d7a/structchan__dec__cfg.html#ab47b4ae55889f7a5ebb4fd0661430b2c">decoder_type</a>;</div>
<div class="line">            mode_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a35e6ea9d1ad99e035fe2f0d730c62b31">support_ff_fb_bw</a> = 0;</div>
<div class="line"> </div>
<div class="line">            memset(context.decoder[i].filename, 0, MAX_FILE_LENGTH);</div>
<div class="line">            snprintf(context.decoder[i].filename, <span class="keyword">sizeof</span>(context.decoder[i].filename), <span class="stringliteral">&quot;%s&quot;</span>, <a class="code hl_variableRef" target="_blank" href="../../../video/d2/de8/dec__lua__cfg_8c.html#a9ebe61052444d40c189eb1e6997f701b">mc_dec_cfg</a>.<a class="code hl_variableRef" target="_blank" href="../../../video/d6/d8d/structmchan__dec__cfg.html#a7e32945474bf3090a4c47d0ab1fb4ef5">dec_cfg</a>[i].<a id="a131" name="a131"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d3/d7a/structchan__dec__cfg.html#ae84210227bc19fbbe3e214c2762a3293">file_name</a>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        context.playback_flag = 1;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        mode_cfg = &amp;context.mode_config;</div>
<div class="line">        mode_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a5e6c6a36ce8c85207cd885084eb60680">num_decoder</a> = 1;</div>
<div class="line">        mode_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a35e6ea9d1ad99e035fe2f0d730c62b31">support_ff_fb_bw</a> = 0;</div>
<div class="line">        mode_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#ae6aee241a74597e11d6f0886cc96fbcc">max_width</a> = context.max_width;</div>
<div class="line">        mode_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a9960573acbcc1bced168f0e4a7f5ae89">max_height</a> = context.max_height;</div>
<div class="line">        mode_cfg-&gt;<a id="a132" name="a132"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a08b23af621bfd352c3322ed25948d4cd">enable_vout</a>[0] = 1;</div>
<div class="line">        mode_cfg-&gt;<a id="a133" name="a133"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#ae686294e9676edd5a7b27f738d0bddad">num_vout</a> = 1;</div>
<div class="line">        vout_num = 1;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//search for active vout</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_define" href="../../dummy.html">VOUT_NUM</a>; i++) {</div>
<div class="line">            context.vout_dev_info[0].source_id = i;</div>
<div class="line">            <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a6f7930f1096a9f89746c745c26b669e7">vout_info</a> = &amp;context.vout_dev_info[0];</div>
<div class="line">            ret = get_single_vout_info(<a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a6f7930f1096a9f89746c745c26b669e7">vout_info</a>, context.iav_fd);</div>
<div class="line">            <span class="keywordflow">if</span> (!ret) {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!ret) {</div>
<div class="line">            <span class="keywordflow">if</span> (0 == i) {</div>
<div class="line">                mode_cfg-&gt;<a id="a134" name="a134"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#abc30f3365ce16e96690190d107fc4f3b">max_vout0_width</a> = <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a6f7930f1096a9f89746c745c26b669e7">vout_info</a>-&gt;width;</div>
<div class="line">                mode_cfg-&gt;<a id="a135" name="a135"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#ad450185c6b46fc0f731f7276d2b07049">max_vout0_height</a> = <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a6f7930f1096a9f89746c745c26b669e7">vout_info</a>-&gt;height;</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 == i) {</div>
<div class="line">                mode_cfg-&gt;<a id="a136" name="a136"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#a53cf7eabcb0943bf1a84139b7c21ebf8">max_vout1_width</a> = <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a6f7930f1096a9f89746c745c26b669e7">vout_info</a>-&gt;width;</div>
<div class="line">                mode_cfg-&gt;<a id="a137" name="a137"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#af51704818cc919e4f2a7973b431febc9">max_vout1_height</a> = <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a6f7930f1096a9f89746c745c26b669e7">vout_info</a>-&gt;height;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">// do nothing.</span></div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            printf(<span class="stringliteral">&quot;No active vout is found!\n&quot;</span>);</div>
<div class="line">            close(context.iav_fd);</div>
<div class="line">            context.iav_fd = -1;</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    context.vout_num = vout_num;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context.reset_vout_flag) {</div>
<div class="line">        mode_cfg-&gt;<a id="a138" name="a138"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#afd1373dd80fd3d2768c609745c81d62b">not_reset_vout</a> = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        mode_cfg-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/dc7/structiav__decode__mode__config.html#afd1373dd80fd3d2768c609745c81d62b">not_reset_vout</a> = 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!context.framerate_den) {</div>
<div class="line">        u_printf_error(<span class="stringliteral">&quot;Zero frame den, use 3003 as default.\n&quot;</span>);</div>
<div class="line">        context.framerate_den = 3003;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context.playback_flag) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; context.mode_config.num_decoder; i++) {</div>
<div class="line">            <span class="keywordtype">char</span> *file_ext = strrchr(context.decoder[i].filename, <span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line">            <span class="keywordflow">if</span> (file_ext) {</div>
<div class="line">                file_ext ++;</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;Get the decoder[%d] type from file ext!\n&quot;</span>, i);</div>
<div class="line">                <span class="keywordflow">if</span> ((!strcmp(file_ext, <span class="stringliteral">&quot;h264&quot;</span>)) || (!strcmp(file_ext, <span class="stringliteral">&quot;H264&quot;</span>)) ||</div>
<div class="line">                    (!strcmp(file_ext, <span class="stringliteral">&quot;264&quot;</span>)) || (!strcmp(file_ext, <span class="stringliteral">&quot;avc&quot;</span>)) ||</div>
<div class="line">                    (!strcmp(file_ext, <span class="stringliteral">&quot;AVC&quot;</span>))) {</div>
<div class="line">                    context.mode_config.decoder_type[i] = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a4ae5fb6b6d878ad88a8bff8b3b20af91">IAV_DEC_TYPE_H264</a>;</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;File ext (%s), h264\n&quot;</span>, file_ext);</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcmp(file_ext, <span class="stringliteral">&quot;h265&quot;</span>)) || (!strcmp(file_ext, <span class="stringliteral">&quot;H265&quot;</span>)) ||</div>
<div class="line">                    (!strcmp(file_ext, <span class="stringliteral">&quot;265&quot;</span>)) || (!strcmp(file_ext, <span class="stringliteral">&quot;hevc&quot;</span>)) ||</div>
<div class="line">                    (!strcmp(file_ext, <span class="stringliteral">&quot;HEVC&quot;</span>))) {</div>
<div class="line">                    context.mode_config.decoder_type[i] = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a3507538744216d4eb584662c10da89cc">IAV_DEC_TYPE_H265</a>;</div>
<div class="line">                    u_printf(<span class="stringliteral">&quot;File ext (%s), h265\n&quot;</span>, file_ext);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    u_printf_error(<span class="stringliteral">&quot;Unknown file ext (%s)!\n&quot;</span>, file_ext);</div>
<div class="line">                    <span class="keywordflow">return</span> (-4);</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                u_printf(<span class="stringliteral">&quot;User didn&#39;t specify decoder type, and no file ext!\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> (-5);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context.is_fastnavi_mode) {</div>
<div class="line">        <span class="keywordflow">if</span> (1 == context.mode_config.num_decoder) {</div>
<div class="line">            context.is_fastnavi_mode = 1;</div>
<div class="line">            context.mode_config.support_ff_fb_bw = 1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            u_printf(<span class="stringliteral">&quot;[ERROR]: fast navi mode can only support 1 channel.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> (-2);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context.enter_idle_flag) {</div>
<div class="line">        enter_idle(context.iav_fd);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!context.playback_flag) {</div>
<div class="line">        close(context.iav_fd);</div>
<div class="line">        context.iav_fd = -1;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context.enable_debug_log) {</div>
<div class="line">        print_vout_info(context.iav_fd);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ret = map_bsb(&amp;context);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        u_printf_error(<span class="stringliteral">&quot;[ERROR]: map_bsb() fail!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> (-4);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!context.is_fastnavi_mode) {</div>
<div class="line">        run_decode(&amp;context);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        run_fast_navi_decode(&amp;context);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (context.iav_fd &gt; 0) {</div>
<div class="line">        close(context.iav_fd);</div>
<div class="line">        context.iav_fd = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    u_printf(<span class="stringliteral">&quot;[FLOW]: test_decode end.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="aamba__defines_8h_html"><div class="ttname"><a href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a></div></div>
<div class="ttc" id="aamba__defines_8h_html_aa6d89b223ba1d6d6b2f8308b45789f60"><div class="ttname"><a href="../../d0/dc8/amba__defines_8h.html#aa6d89b223ba1d6d6b2f8308b45789f60">AMBA_FREAD_FILE</a></div><div class="ttdeci">#define AMBA_FREAD_FILE(buf, bytes, size, fp)</div><div class="ttdef"><b>Definition:</b> amba_defines.h:52</div></div>
<div class="ttc" id="aasf__structure_8h_html_a92c50087ca0e64fa93fc59402c55f8ca"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></div><div class="ttdeci">uint8_t u8</div></div>
<div class="ttc" id="aasf__structure_8h_html_ace9d960e74685e2cd84b36132dbbf8aa"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a></div><div class="ttdeci">uint16_t u16</div></div>
<div class="ttc" id="aasf__structure_8h_html_ad758b7a5c3f18ed79d2fcd23d9f16357"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a></div><div class="ttdeci">unsigned long long u64</div></div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div></div>
<div class="ttc" id="abasetypes_8h_html"><div class="ttname"><a href="../../de/ddc/basetypes_8h.html">basetypes.h</a></div><div class="ttdoc">This file defines basic types used in all IAV driver and header files.</div></div>
<div class="ttc" id="acJSON_8h_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div></div>
<div class="ttc" id="acJSON_8h_html_aff2566f4c366b48d73479bef43ee4d2e"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a></div><div class="ttdeci">char * buffer</div></div>
<div class="ttc" id="acodec__parser_8h_html"><div class="ttname"><a href="../../../video/da/d57/codec__parser_8h.html">codec_parser.h</a></div></div>
<div class="ttc" id="acodec__parser_8h_html_a26b9cde66921e8fb55e2366e7f43c3a0"><div class="ttname"><a href="../../../video/da/d57/codec__parser_8h.html#a26b9cde66921e8fb55e2366e7f43c3a0">get_h265_reso_from_sps</a></div><div class="ttdeci">int get_h265_reso_from_sps(unsigned char *p_data, unsigned int data_size, unsigned int *pic_width, unsigned int *pic_height)</div></div>
<div class="ttc" id="acodec__parser_8h_html_a2fcc52d38a61df4c1a80514eea479a2e"><div class="ttname"><a href="../../../video/da/d57/codec__parser_8h.html#a2fcc52d38a61df4c1a80514eea479a2e">get_h264_reso_from_sps</a></div><div class="ttdeci">int get_h264_reso_from_sps(unsigned char *p_data, unsigned int data_size, unsigned int *width, unsigned int *height)</div></div>
<div class="ttc" id="adec__lua__cfg_8c_html"><div class="ttname"><a href="../../../video/d2/de8/dec__lua__cfg_8c.html">dec_lua_cfg.c</a></div></div>
<div class="ttc" id="adec__lua__cfg_8c_html_a9ebe61052444d40c189eb1e6997f701b"><div class="ttname"><a href="../../../video/d2/de8/dec__lua__cfg_8c.html#a9ebe61052444d40c189eb1e6997f701b">mc_dec_cfg</a></div><div class="ttdeci">struct mchan_dec_cfg mc_dec_cfg</div></div>
<div class="ttc" id="adec__lua__cfg_8c_html_aa89fd9c5e0ec0ebeb8a4539cf0da4169"><div class="ttname"><a href="../../../video/d2/de8/dec__lua__cfg_8c.html#aa89fd9c5e0ec0ebeb8a4539cf0da4169">read_dec_cfg_from_lua</a></div><div class="ttdeci">int read_dec_cfg_from_lua(const char *lua_file, struct mchan_dec_cfg *mc_dec_cfg)</div></div>
<div class="ttc" id="adummy_html"><div class="ttname"><a href="../../dummy.html">VOUT_NUM</a></div><div class="ttdeci">#define VOUT_NUM</div></div>
<div class="ttc" id="agroup__iav-ioctl-dec-helper_html_gga68888f85123436b2de9afff5e219a333a3507538744216d4eb584662c10da89cc"><div class="ttname"><a href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a3507538744216d4eb584662c10da89cc">IAV_DEC_TYPE_H265</a></div><div class="ttdeci">IAV_DEC_TYPE_H265</div></div>
<div class="ttc" id="agroup__iav-ioctl-dec-helper_html_gga68888f85123436b2de9afff5e219a333a4ae5fb6b6d878ad88a8bff8b3b20af91"><div class="ttname"><a href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#gga68888f85123436b2de9afff5e219a333a4ae5fb6b6d878ad88a8bff8b3b20af91">IAV_DEC_TYPE_H264</a></div><div class="ttdeci">IAV_DEC_TYPE_H264</div></div>
<div class="ttc" id="agroup__iav-ioctl-dec-helper_html_ggaefacfca9a21eccc2a8c5861132965e73a096003e21e15fd3a848ce5b1ef16dc92"><div class="ttname"><a href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73a096003e21e15fd3a848ce5b1ef16dc92">IAV_DEC_PAUSE</a></div><div class="ttdeci">IAV_DEC_PAUSE</div></div>
<div class="ttc" id="agroup__iav-ioctl-dec-helper_html_ggaefacfca9a21eccc2a8c5861132965e73aa087a19647753cd5c47e8635f7ad069a"><div class="ttname"><a href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73aa087a19647753cd5c47e8635f7ad069a">IAV_DEC_STEP</a></div><div class="ttdeci">IAV_DEC_STEP</div></div>
<div class="ttc" id="agroup__iav-ioctl-dec-helper_html_ggaefacfca9a21eccc2a8c5861132965e73ad6c57690f06691de342336b20504e812"><div class="ttname"><a href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaefacfca9a21eccc2a8c5861132965e73ad6c57690f06691de342336b20504e812">IAV_DEC_RESUME</a></div><div class="ttdeci">IAV_DEC_RESUME</div></div>
<div class="ttc" id="agroup__iav-ioctl-dec-helper_html_ggaf641f844229bde49393b667c0314bee8a3da2e487ff2083db8e5f996eba894095"><div class="ttname"><a href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaf641f844229bde49393b667c0314bee8a3da2e487ff2083db8e5f996eba894095">IAV_DEC_DIR_BW</a></div><div class="ttdeci">IAV_DEC_DIR_BW</div></div>
<div class="ttc" id="agroup__iav-ioctl-dec-helper_html_ggaf641f844229bde49393b667c0314bee8adb6b016034e55d10deea6d1a8dbab2c3"><div class="ttname"><a href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaf641f844229bde49393b667c0314bee8adb6b016034e55d10deea6d1a8dbab2c3">IAV_DEC_DIR_FW</a></div><div class="ttdeci">IAV_DEC_DIR_FW</div></div>
<div class="ttc" id="agroup__iav-ioctl-dec-helper_html_ggaffb54b687778b4d57f4dc9ea9102a091a17775b31c0f89faa7583b122ef786d1d"><div class="ttname"><a href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a17775b31c0f89faa7583b122ef786d1d">IAV_DEC_SCAN_MODE_ALL_FRAMES</a></div><div class="ttdeci">IAV_DEC_SCAN_MODE_ALL_FRAMES</div></div>
<div class="ttc" id="agroup__iav-ioctl-dec-helper_html_ggaffb54b687778b4d57f4dc9ea9102a091a3fb0ffa93f566c7b813eb588ab27072a"><div class="ttname"><a href="../../../library/de/d22/group__iav-ioctl-dec-helper.html#ggaffb54b687778b4d57f4dc9ea9102a091a3fb0ffa93f566c7b813eb588ab27072a">IAV_DEC_SCAN_MODE_I_ONLY</a></div><div class="ttdeci">IAV_DEC_SCAN_MODE_I_ONLY</div></div>
<div class="ttc" id="agroup__iav-typedef_html_ga10e94b422ef0c20dcdec20d31a1f5049"><div class="ttname"><a href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a></div><div class="ttdeci">unsigned int u32</div><div class="ttdef"><b>Definition:</b> basetypes.h:53</div></div>
<div class="ttc" id="agroup__iav-typedef_html_ga9e6c91d77e24643b888dbd1a1a590054"><div class="ttname"><a href="../../d0/dfa/group__iav-typedef.html#ga9e6c91d77e24643b888dbd1a1a590054">u16</a></div><div class="ttdeci">unsigned short u16</div><div class="ttdef"><b>Definition:</b> basetypes.h:52</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa2f3d77052a82568957924f8fd93495c4"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa2f3d77052a82568957924f8fd93495c4">IAV_PART_DEC_BSB</a></div><div class="ttdeci">IAV_PART_DEC_BSB</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a></div><div class="ttdeci">IAV_MEM_PARTITION</div></div>
<div class="ttc" id="aiav__utils_8h_html_a6f7930f1096a9f89746c745c26b669e7"><div class="ttname"><a href="../../d6/d56/iav__utils_8h.html#a6f7930f1096a9f89746c745c26b669e7">vout_info</a></div><div class="ttdeci">#define vout_info(str, arg...)</div><div class="ttdef"><b>Definition:</b> iav_utils.h:345</div></div>
<div class="ttc" id="aplayback__helper_8h_html"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html">playback_helper.h</a></div></div>
<div class="ttc" id="aplayback__helper_8h_html_a027b98f1ef505b679700517657eba622"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#a027b98f1ef505b679700517657eba622">file_reader_reset</a></div><div class="ttdeci">void file_reader_reset(_t_file_reader *p_reader)</div></div>
<div class="ttc" id="aplayback__helper_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba4e66a003ca3c95a8ecf82105d0f39fc0"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba4e66a003ca3c95a8ecf82105d0f39fc0">HEVC_NAL_TYPE_EOS</a></div><div class="ttdeci">HEVC_NAL_TYPE_EOS</div></div>
<div class="ttc" id="aplayback__helper_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba921f3dc9e02cf9bae7d090c1fddbb4fb"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba921f3dc9e02cf9bae7d090c1fddbb4fb">HEVC_NAL_TYPE_EOB</a></div><div class="ttdeci">HEVC_NAL_TYPE_EOB</div></div>
<div class="ttc" id="aplayback__helper_8h_html_a121c492ce6c7eae962e8e1af32a924c7"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#a121c492ce6c7eae962e8e1af32a924c7">build_fast_navi_tree</a></div><div class="ttdeci">int build_fast_navi_tree(FILE *file_fd, fast_navi_file *navi_tree)</div></div>
<div class="ttc" id="aplayback__helper_8h_html_a3c189864dd8261f35c487b1cd1ff0470"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#a3c189864dd8261f35c487b1cd1ff0470">build_fast_navi_tree_h265</a></div><div class="ttdeci">int build_fast_navi_tree_h265(FILE *file_fd, fast_navi_file *navi_tree)</div></div>
<div class="ttc" id="aplayback__helper_8h_html_a6d1964fd9027381a450ba23d705ff55d"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#a6d1964fd9027381a450ba23d705ff55d">get_next_frame_h265</a></div><div class="ttdeci">unsigned int get_next_frame_h265(unsigned char *pstart, unsigned char *pend, unsigned char *p_nal_type, unsigned char *need_more_data)</div></div>
<div class="ttc" id="aplayback__helper_8h_html_abf24a25de38aeb5aff78b9c8d478efe0"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#abf24a25de38aeb5aff78b9c8d478efe0">file_reader_init</a></div><div class="ttdeci">int file_reader_init(_t_file_reader *p_reader, FILE *file_fd, unsigned long read_buffer_size, void *prealloc_file_buffer)</div></div>
<div class="ttc" id="aplayback__helper_8h_html_ac4e3f74a62ead64a2cc7075bf0a53d92a52d0bed6bcc9eb29909bb8f860d54cde"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#ac4e3f74a62ead64a2cc7075bf0a53d92a52d0bed6bcc9eb29909bb8f860d54cde">AVC_NAL_TYPE_END_OF_STREAM</a></div><div class="ttdeci">AVC_NAL_TYPE_END_OF_STREAM</div></div>
<div class="ttc" id="aplayback__helper_8h_html_ac4e3f74a62ead64a2cc7075bf0a53d92aa09c89d245078d1b338ccb85f2e95bc2"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#ac4e3f74a62ead64a2cc7075bf0a53d92aa09c89d245078d1b338ccb85f2e95bc2">AVC_NAL_TYPE_END_OF_SEQUENCE</a></div><div class="ttdeci">AVC_NAL_TYPE_END_OF_SEQUENCE</div></div>
<div class="ttc" id="aplayback__helper_8h_html_ad38e15f8bd029ab5780e12b8965e561e"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#ad38e15f8bd029ab5780e12b8965e561e">file_reader_deinit</a></div><div class="ttdeci">void file_reader_deinit(_t_file_reader *p_reader)</div></div>
<div class="ttc" id="aplayback__helper_8h_html_ad75cca76e22fb555560c553ef1caa99f"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#ad75cca76e22fb555560c553ef1caa99f">file_reader_read_trunk</a></div><div class="ttdeci">int file_reader_read_trunk(_t_file_reader *p_reader)</div></div>
<div class="ttc" id="aplayback__helper_8h_html_ae1cb966206bf4aecc463da4d2113bbeb"><div class="ttname"><a href="../../../video/dd/d03/playback__helper_8h.html#ae1cb966206bf4aecc463da4d2113bbeb">get_next_frame</a></div><div class="ttdeci">unsigned int get_next_frame(unsigned char *pstart, unsigned char *pend, unsigned char *p_nal_type, unsigned char *p_slice_type, unsigned char *need_more_data)</div></div>
<div class="ttc" id="astruct____s__fast__navi__gop_html"><div class="ttname"><a href="../../../video/de/d9c/struct____s__fast__navi__gop.html">__s_fast_navi_gop</a></div></div>
<div class="ttc" id="astruct__t__file__reader_html"><div class="ttname"><a href="../../../video/dc/d99/struct__t__file__reader.html">_t_file_reader</a></div></div>
<div class="ttc" id="astruct__t__file__reader_html_a05f930098bf036cffa1d2b2bf98eb661"><div class="ttname"><a href="../../../video/dc/d99/struct__t__file__reader.html#a05f930098bf036cffa1d2b2bf98eb661">_t_file_reader::p_read_buffer_cur_end</a></div><div class="ttdeci">unsigned char * p_read_buffer_cur_end</div></div>
<div class="ttc" id="astruct__t__file__reader_html_a62b6fae9306248ca33a6046b04f58aee"><div class="ttname"><a href="../../../video/dc/d99/struct__t__file__reader.html#a62b6fae9306248ca33a6046b04f58aee">_t_file_reader::p_read_buffer_cur_start</a></div><div class="ttdeci">unsigned char * p_read_buffer_cur_start</div></div>
<div class="ttc" id="astruct__t__file__reader_html_a7fcd4b620cddff6eb4b47992c2a7bba5"><div class="ttname"><a href="../../../video/dc/d99/struct__t__file__reader.html#a7fcd4b620cddff6eb4b47992c2a7bba5">_t_file_reader::file_remainning_size</a></div><div class="ttdeci">unsigned long file_remainning_size</div></div>
<div class="ttc" id="astruct__t__file__reader_html_ac70db0e32f9ed41206c4862cab9ba379"><div class="ttname"><a href="../../../video/dc/d99/struct__t__file__reader.html#ac70db0e32f9ed41206c4862cab9ba379">_t_file_reader::data_remainning_size_in_buffer</a></div><div class="ttdeci">unsigned long data_remainning_size_in_buffer</div></div>
<div class="ttc" id="astructchan__dec__cfg_html_ab47b4ae55889f7a5ebb4fd0661430b2c"><div class="ttname"><a href="../../../video/d3/d7a/structchan__dec__cfg.html#ab47b4ae55889f7a5ebb4fd0661430b2c">chan_dec_cfg::decoder_type</a></div><div class="ttdeci">u32 decoder_type</div></div>
<div class="ttc" id="astructchan__dec__cfg_html_ae84210227bc19fbbe3e214c2762a3293"><div class="ttname"><a href="../../../video/d3/d7a/structchan__dec__cfg.html#ae84210227bc19fbbe3e214c2762a3293">chan_dec_cfg::file_name</a></div><div class="ttdeci">char file_name[MAX_STR_LEN]</div></div>
<div class="ttc" id="astructfast__navi__file_html"><div class="ttname"><a href="../../../video/d4/d36/structfast__navi__file.html">fast_navi_file</a></div></div>
<div class="ttc" id="astructiav__decode__bsb_html"><div class="ttname"><a href="../../../library/d8/d49/structiav__decode__bsb.html">iav_decode_bsb</a></div></div>
<div class="ttc" id="astructiav__decode__bsb_html_a1cc6401238981ad83b8c09a40d71849f"><div class="ttname"><a href="../../../library/d8/d49/structiav__decode__bsb.html#a1cc6401238981ad83b8c09a40d71849f">iav_decode_bsb::decoder_id</a></div><div class="ttdeci">u8 decoder_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3981</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html">iav_decode_mode_config</a></div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_a08b23af621bfd352c3322ed25948d4cd"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#a08b23af621bfd352c3322ed25948d4cd">iav_decode_mode_config::enable_vout</a></div><div class="ttdeci">u8 enable_vout[IAV_MAX_DECODER_NUMBER]</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3946</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_a35e6ea9d1ad99e035fe2f0d730c62b31"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#a35e6ea9d1ad99e035fe2f0d730c62b31">iav_decode_mode_config::support_ff_fb_bw</a></div><div class="ttdeci">u8 support_ff_fb_bw</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3931</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_a53cf7eabcb0943bf1a84139b7c21ebf8"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#a53cf7eabcb0943bf1a84139b7c21ebf8">iav_decode_mode_config::max_vout1_width</a></div><div class="ttdeci">u32 max_vout1_width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3943</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_a5e6c6a36ce8c85207cd885084eb60680"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#a5e6c6a36ce8c85207cd885084eb60680">iav_decode_mode_config::num_decoder</a></div><div class="ttdeci">u8 num_decoder</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3929</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_a9960573acbcc1bced168f0e4a7f5ae89"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#a9960573acbcc1bced168f0e4a7f5ae89">iav_decode_mode_config::max_height</a></div><div class="ttdeci">u32 max_height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3939</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_abc30f3365ce16e96690190d107fc4f3b"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#abc30f3365ce16e96690190d107fc4f3b">iav_decode_mode_config::max_vout0_width</a></div><div class="ttdeci">u32 max_vout0_width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3941</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_abe6d84458572cf383b1c925e385e1e5f"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#abe6d84458572cf383b1c925e385e1e5f">iav_decode_mode_config::decoder_type</a></div><div class="ttdeci">u8 decoder_type[IAV_MAX_DECODER_NUMBER]</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3937</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_ad450185c6b46fc0f731f7276d2b07049"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#ad450185c6b46fc0f731f7276d2b07049">iav_decode_mode_config::max_vout0_height</a></div><div class="ttdeci">u32 max_vout0_height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3942</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_ae686294e9676edd5a7b27f738d0bddad"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#ae686294e9676edd5a7b27f738d0bddad">iav_decode_mode_config::num_vout</a></div><div class="ttdeci">u8 num_vout</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3930</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_ae6aee241a74597e11d6f0886cc96fbcc"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#ae6aee241a74597e11d6f0886cc96fbcc">iav_decode_mode_config::max_width</a></div><div class="ttdeci">u32 max_width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3938</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_af51704818cc919e4f2a7973b431febc9"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#af51704818cc919e4f2a7973b431febc9">iav_decode_mode_config::max_vout1_height</a></div><div class="ttdeci">u32 max_vout1_height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3944</div></div>
<div class="ttc" id="astructiav__decode__mode__config_html_afd1373dd80fd3d2768c609745c81d62b"><div class="ttname"><a href="../../../library/d8/dc7/structiav__decode__mode__config.html#afd1373dd80fd3d2768c609745c81d62b">iav_decode_mode_config::not_reset_vout</a></div><div class="ttdeci">u8 not_reset_vout</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3933</div></div>
<div class="ttc" id="astructiav__decode__speed_html"><div class="ttname"><a href="../../../library/d3/d5e/structiav__decode__speed.html">iav_decode_speed</a></div></div>
<div class="ttc" id="astructiav__decode__speed_html_a1cc6401238981ad83b8c09a40d71849f"><div class="ttname"><a href="../../../library/d3/d5e/structiav__decode__speed.html#a1cc6401238981ad83b8c09a40d71849f">iav_decode_speed::decoder_id</a></div><div class="ttdeci">u8 decoder_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:4006</div></div>
<div class="ttc" id="astructiav__decode__speed_html_a80dcc8170b363b316d556c4b608e940f"><div class="ttname"><a href="../../../library/d3/d5e/structiav__decode__speed.html#a80dcc8170b363b316d556c4b608e940f">iav_decode_speed::direction</a></div><div class="ttdeci">u8 direction</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:4009</div></div>
<div class="ttc" id="astructiav__decode__speed_html_acc79e9fd4431192338fbbe2735739879"><div class="ttname"><a href="../../../library/d3/d5e/structiav__decode__speed.html#acc79e9fd4431192338fbbe2735739879">iav_decode_speed::speed</a></div><div class="ttdeci">u16 speed</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:4011</div></div>
<div class="ttc" id="astructiav__decode__speed_html_ada52665f858dca972520198846aa5e57"><div class="ttname"><a href="../../../library/d3/d5e/structiav__decode__speed.html#ada52665f858dca972520198846aa5e57">iav_decode_speed::scan_mode</a></div><div class="ttdeci">u8 scan_mode</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:4010</div></div>
<div class="ttc" id="astructiav__decode__status_html"><div class="ttname"><a href="../../../library/d2/d21/structiav__decode__status.html">iav_decode_status</a></div></div>
<div class="ttc" id="astructiav__decode__status_html_a1cc6401238981ad83b8c09a40d71849f"><div class="ttname"><a href="../../../library/d2/d21/structiav__decode__status.html#a1cc6401238981ad83b8c09a40d71849f">iav_decode_status::decoder_id</a></div><div class="ttdeci">u8 decoder_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:4021</div></div>
<div class="ttc" id="astructiav__decode__status_html_aa389272508113714ecb2bfdf578380f2"><div class="ttname"><a href="../../../library/d2/d21/structiav__decode__status.html#aa389272508113714ecb2bfdf578380f2">iav_decode_status::last_pts</a></div><div class="ttdeci">u32 last_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:4028</div></div>
<div class="ttc" id="astructiav__decode__stop_html"><div class="ttname"><a href="../../../library/d2/d69/structiav__decode__stop.html">iav_decode_stop</a></div></div>
<div class="ttc" id="astructiav__decode__stop_html_a1cc6401238981ad83b8c09a40d71849f"><div class="ttname"><a href="../../../library/d2/d69/structiav__decode__stop.html#a1cc6401238981ad83b8c09a40d71849f">iav_decode_stop::decoder_id</a></div><div class="ttdeci">u8 decoder_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3993</div></div>
<div class="ttc" id="astructiav__decode__stop_html_ab21271a5d192d01b25560a3ecbab210c"><div class="ttname"><a href="../../../library/d2/d69/structiav__decode__stop.html#ab21271a5d192d01b25560a3ecbab210c">iav_decode_stop::stop_flag</a></div><div class="ttdeci">u8 stop_flag</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3994</div></div>
<div class="ttc" id="astructiav__decode__trick__play_html"><div class="ttname"><a href="../../../library/d4/dfc/structiav__decode__trick__play.html">iav_decode_trick_play</a></div></div>
<div class="ttc" id="astructiav__decode__trick__play_html_a1cc6401238981ad83b8c09a40d71849f"><div class="ttname"><a href="../../../library/d4/dfc/structiav__decode__trick__play.html#a1cc6401238981ad83b8c09a40d71849f">iav_decode_trick_play::decoder_id</a></div><div class="ttdeci">u8 decoder_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:4000</div></div>
<div class="ttc" id="astructiav__decode__trick__play_html_a85a5bc94d7dd0194daa37362fc08221a"><div class="ttname"><a href="../../../library/d4/dfc/structiav__decode__trick__play.html#a85a5bc94d7dd0194daa37362fc08221a">iav_decode_trick_play::trick_play</a></div><div class="ttdeci">u8 trick_play</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:4001</div></div>
<div class="ttc" id="astructiav__decode__video_html"><div class="ttname"><a href="../../../library/d1/dfc/structiav__decode__video.html">iav_decode_video</a></div></div>
<div class="ttc" id="astructiav__decode__wait__eos_html"><div class="ttname"><a href="../../../library/da/dce/structiav__decode__wait__eos.html">iav_decode_wait_eos</a></div></div>
<div class="ttc" id="astructiav__decoder__info_html"><div class="ttname"><a href="../../../library/d6/dec/structiav__decoder__info.html">iav_decoder_info</a></div></div>
<div class="ttc" id="astructiav__decoder__info_html_a1277d9039ea5adf9f1c935503cfd7233"><div class="ttname"><a href="../../../library/d6/dec/structiav__decoder__info.html#a1277d9039ea5adf9f1c935503cfd7233">iav_decoder_info::bsb_start_offset</a></div><div class="ttdeci">unsigned long bsb_start_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3959</div></div>
<div class="ttc" id="astructiav__decoder__info_html_a1cc6401238981ad83b8c09a40d71849f"><div class="ttname"><a href="../../../library/d6/dec/structiav__decoder__info.html#a1cc6401238981ad83b8c09a40d71849f">iav_decoder_info::decoder_id</a></div><div class="ttdeci">u8 decoder_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3950</div></div>
<div class="ttc" id="astructiav__decoder__info_html_a3369e573156f7e983df79c12372b557c"><div class="ttname"><a href="../../../library/d6/dec/structiav__decoder__info.html#a3369e573156f7e983df79c12372b557c">iav_decoder_info::bsb_size</a></div><div class="ttdeci">u32 bsb_size</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3958</div></div>
<div class="ttc" id="astructiav__decoder__info_html_a846773ff20fb73dfd60034f472267cee"><div class="ttname"><a href="../../../library/d6/dec/structiav__decoder__info.html#a846773ff20fb73dfd60034f472267cee">iav_decoder_info::video_height</a></div><div class="ttdeci">u32 video_height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3956</div></div>
<div class="ttc" id="astructiav__decoder__info_html_aa1b7e0a7448470096a63cc9b01d08952"><div class="ttname"><a href="../../../library/d6/dec/structiav__decoder__info.html#aa1b7e0a7448470096a63cc9b01d08952">iav_decoder_info::video_width</a></div><div class="ttdeci">u32 video_width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3955</div></div>
<div class="ttc" id="astructiav__decoder__info_html_acf77f34fbc1b70a26ef6a14a89ea8a54"><div class="ttname"><a href="../../../library/d6/dec/structiav__decoder__info.html#acf77f34fbc1b70a26ef6a14a89ea8a54">iav_decoder_info::decoder_type</a></div><div class="ttdeci">u8 decoder_type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3951</div></div>
<div class="ttc" id="astructiav__decoder__info_html_ae686294e9676edd5a7b27f738d0bddad"><div class="ttname"><a href="../../../library/d6/dec/structiav__decoder__info.html#ae686294e9676edd5a7b27f738d0bddad">iav_decoder_info::num_vout</a></div><div class="ttdeci">u8 num_vout</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3952</div></div>
<div class="ttc" id="astructiav__idle__params_html"><div class="ttname"><a href="../../../library/d7/d46/structiav__idle__params.html">iav_idle_params</a></div></div>
<div class="ttc" id="astructiav__mem__info_html_a9ee64c7b918513891b3834b93ad0e501"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">iav_mem_info::length</a></div><div class="ttdeci">unsigned long length</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1842</div></div>
<div class="ttc" id="astructiav__mem__info_html_afde02ab53128286716345a7e3da30a7e"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">iav_mem_info::addr</a></div><div class="ttdeci">unsigned long addr</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1841</div></div>
<div class="ttc" id="astructiav__mem__part__info_html"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a></div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a189394c6bbc0d36422df8c5bc2ee1962"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">iav_mem_part_info::pid</a></div><div class="ttdeci">u32 pid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1847</div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a3bc6cd5f612ef6d8254970d363348350"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">iav_mem_part_info::mem</a></div><div class="ttdeci">struct iav_mem_info mem</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1848</div></div>
<div class="ttc" id="astructiav__querymem_html"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a></div></div>
<div class="ttc" id="astructiav__querymem_html_a01d475486b14a28a0583e09be9e66982"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">iav_querymem::partition</a></div><div class="ttdeci">struct iav_mem_part_info partition</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1925</div></div>
<div class="ttc" id="astructiav__querymem_html_a5955e20d0c53be1145cf813759d92d67"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">iav_querymem::arg</a></div><div class="ttdeci">union iav_querymem::@61 arg</div></div>
<div class="ttc" id="astructiav__querymem_html_ae056de5bb92261e7a28350beeb5320f8"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">iav_querymem::mid</a></div><div class="ttdeci">enum iav_mem_id mid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1923</div></div>
<div class="ttc" id="astructmchan__dec__cfg_html_a7e32945474bf3090a4c47d0ab1fb4ef5"><div class="ttname"><a href="../../../video/d6/d8d/structmchan__dec__cfg.html#a7e32945474bf3090a4c47d0ab1fb4ef5">mchan_dec_cfg::dec_cfg</a></div><div class="ttdeci">struct chan_dec_cfg dec_cfg[IAV_MAX_DECODER_NUMBER]</div></div>
<div class="ttc" id="astructmchan__dec__cfg_html_ad18eb86b5033a823dc1a38ca71fb94e4"><div class="ttname"><a href="../../../video/d6/d8d/structmchan__dec__cfg.html#ad18eb86b5033a823dc1a38ca71fb94e4">mchan_dec_cfg::chan_num</a></div><div class="ttdeci">u32 chan_num</div></div>
<div class="ttc" id="astructvout__params_html"><div class="ttname"><a href="../../../library/d6/d21/structvout__params.html">vout_params</a></div></div>
<div class="ttc" id="atest__decode_8h_html"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html">test_decode.h</a></div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea0bcdc8a2c8fafa0bf101f2c3c25778b1"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea0bcdc8a2c8fafa0bf101f2c3c25778b1">SPECIFY_DISABLE_RUNTIME_CMD</a></div><div class="ttdeci">SPECIFY_DISABLE_RUNTIME_CMD</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea1213d9f6549548adb659e90604f3748b"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea1213d9f6549548adb659e90604f3748b">SPECIFY_FRAMERATE_DEN</a></div><div class="ttdeci">SPECIFY_FRAMERATE_DEN</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea13b8167e2301443dbb68aa9ffb5ed496"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea13b8167e2301443dbb68aa9ffb5ed496">SPECIFY_MAX_BITRATE</a></div><div class="ttdeci">SPECIFY_MAX_BITRATE</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea3e18e58e19093caf7766cfd7a3a202fd"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea3e18e58e19093caf7766cfd7a3a202fd">SPECIFY_DPROC_MODE</a></div><div class="ttdeci">SPECIFY_DPROC_MODE</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea54c71ad4316c9ce20f9907338043b751"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea54c71ad4316c9ce20f9907338043b751">SPECIFY_FAST_NAVI_BACKWARD</a></div><div class="ttdeci">SPECIFY_FAST_NAVI_BACKWARD</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea5a0100925f274f1e94a986c90aa1d609"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea5a0100925f274f1e94a986c90aa1d609">SPECIFY_WATCH_LAST_PTS_MODE</a></div><div class="ttdeci">SPECIFY_WATCH_LAST_PTS_MODE</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea65c1269bb4477d122ce344d15b917d03"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea65c1269bb4477d122ce344d15b917d03">SPECIFY_DUMP_INPUT_MODE</a></div><div class="ttdeci">SPECIFY_DUMP_INPUT_MODE</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea861735a67f1e935151d643ed18523c02"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea861735a67f1e935151d643ed18523c02">SPECIFY_MAX_WIDTH</a></div><div class="ttdeci">SPECIFY_MAX_WIDTH</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea8ac588f923808de0bd7e23c7bad19cdf"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea8ac588f923808de0bd7e23c7bad19cdf">SPECIFY_FAST_NAVI_FORWARD</a></div><div class="ttdeci">SPECIFY_FAST_NAVI_FORWARD</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaea8c8f26816e5cd9e1363d3a48f6b1f5a2"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaea8c8f26816e5cd9e1363d3a48f6b1f5a2">SPECIFY_DEBUG_LOG</a></div><div class="ttdeci">SPECIFY_DEBUG_LOG</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeaabdd9e9712d5d4568c9cecb5d80ff74e"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeaabdd9e9712d5d4568c9cecb5d80ff74e">SPECIFY_RETURN_IDLE_MODE</a></div><div class="ttdeci">SPECIFY_RETURN_IDLE_MODE</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeaaedb976e0616c5cb086d2c87ea44f515"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeaaedb976e0616c5cb086d2c87ea44f515">SPECIFY_MAX_HEIGHT</a></div><div class="ttdeci">SPECIFY_MAX_HEIGHT</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeab8f9a6c3e9acf3f874668a3169aec7cc"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeab8f9a6c3e9acf3f874668a3169aec7cc">SPECIFY_DIRECT_READ_MODE</a></div><div class="ttdeci">SPECIFY_DIRECT_READ_MODE</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeabbdd4b479a9c12f67bfaa13d5fff368d"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeabbdd4b479a9c12f67bfaa13d5fff368d">SPECIFY_FAST_NAVI_MODE</a></div><div class="ttdeci">SPECIFY_FAST_NAVI_MODE</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeabe3ae013477841c299e82691b42554ce"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeabe3ae013477841c299e82691b42554ce">SPECIFY_IDLE</a></div><div class="ttdeci">SPECIFY_IDLE</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeacbe8c695d1313a1f1fd91b662118fe65"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeacbe8c695d1313a1f1fd91b662118fe65">SPECIFY_PREFETCH_MODE</a></div><div class="ttdeci">SPECIFY_PREFETCH_MODE</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aaeae6ce0ea4ace57f12dcfb9ae81328cfd0"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aaeae6ce0ea4ace57f12dcfb9ae81328cfd0">SPECIFY_RESET_VOUT</a></div><div class="ttdeci">SPECIFY_RESET_VOUT</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
<div class="ttc" id="avout__init__cfg_8c_html_a88a5b93883c34229851d6a7a93254850"><div class="ttname"><a href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a></div><div class="ttdeci">#define AM_IOCTL(_filp, _cmd, _arg)</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
