<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driver: test_efm.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Driver"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Driver<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d3/de2/test_efm_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test_efm.c</div></div>
</div><!--header-->
<div class="contents">
<p >This is an example of how to encode from memory and encode from raw input.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * test_efm.c</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *     2015/07/01 - [Zhaoyang Chen] created file</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2016 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents ( &quot;Software&quot; ) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;poll.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/ddc/basetypes_8h.html">basetypes.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;pthread.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;semaphore.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;arm_neon.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" target="_blank" href="../../../video/d3/d9f/test__efm_8h.html">test_efm.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;iav_ioctl.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;lib_efm.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    YUV420_IYUV = 0,    <span class="comment">// Pattern: YYYYYYYYUUVV</span></div>
<div class="line">    YUV420_YV12 = 1,    <span class="comment">// Pattern: YYYYYYYYVVUU</span></div>
<div class="line">    YUV420_NV12 = 2,    <span class="comment">// Pattern: YYYYYYYYUVUV</span></div>
<div class="line">    YUV422_YU16 = 3,    <span class="comment">// Pattern: YYYYYYYYUUUUVVVV</span></div>
<div class="line">    YUV422_YV16 = 4,    <span class="comment">// Pattern: YYYYYYYYVVVVUUUU</span></div>
<div class="line">    YUV422_NV16 = 5,    <span class="comment">// Pattern: YYYYYYYYUVUVUVUV</span></div>
<div class="line">    RGB_RAW = 6,        <span class="comment">// Bayer pattern RGB</span></div>
<div class="line">    YUV_FORMAT_TOTAL_NUM,</div>
<div class="line">    YUV_FORMAT_FIRST = YUV420_IYUV,</div>
<div class="line">    YUV_FORMAT_LAST = YUV_FORMAT_TOTAL_NUM,</div>
<div class="line">} YUV_FORMAT;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    EFM_TYPE_YUV_FILE = 0,</div>
<div class="line">    EFM_TYPE_YUV_CAPTURE = 1,</div>
<div class="line">    EFM_TYPE_RAW_YUV = 2,   <span class="comment">//NV16</span></div>
<div class="line">    EFM_TYPE_RAW_RGB = 3,</div>
<div class="line">    EFM_TYPE_RAW_NV12 = 4,</div>
<div class="line">    EFM_TYPE_EIS_RAW = 5,</div>
<div class="line">    EFM_TYPE_RAW_FROM_CANVAS = 6,</div>
<div class="line">    EFM_TYPE_TOTAL_NUM,</div>
<div class="line">    EFM_TYPE_FIRST = EFM_TYPE_YUV_FILE,</div>
<div class="line">    EFM_TYPE_LAST = EFM_TYPE_TOTAL_NUM,</div>
<div class="line">} EFM_TYPE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    MEM_CPY_TYPE_GDMA = 0,</div>
<div class="line">    MEM_CPY_TYPE_ARM = 1,</div>
<div class="line">} MEM_CPY_TYPE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    ME_TRANSFER_NORMAL = 0,</div>
<div class="line">    ME_TRANSFER_NEON = 1,</div>
<div class="line">    ME_TRANSFER_TYPE_NUM,</div>
<div class="line">    ME_TRANSFER_TYPE_FIRST = ME_TRANSFER_NORMAL,</div>
<div class="line">    ME_TRANSFER_TYPE_LAST = ME_TRANSFER_TYPE_NUM,</div>
<div class="line">} ME_TRANSFER_TYPE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    BUF_LUMA = 0,       <span class="comment">// Luma of source buffer</span></div>
<div class="line">    BUF_ME1 = 1,        <span class="comment">// ME1 with 1/4 width/height of source buffer</span></div>
<div class="line">    BUF_ME0_8 = 2,      <span class="comment">// ME0 with 1/8 width/height of source buffer</span></div>
<div class="line">    BUF_ME0_16 = 3,     <span class="comment">// ME0 with 1/16 width/height of source buffer</span></div>
<div class="line">} BUF_TYPE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    FEED_NORMAL = 0,    <span class="comment">// feed YUV from file in the normal way, stop after specified loops</span></div>
<div class="line">    FEED_REPEATE = 1,   <span class="comment">// keep feeding YUV from file endlessly, repeating last frame when ended</span></div>
<div class="line">    FEED_TYPE_NUM,</div>
<div class="line">} FEED_YUV_TYPE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    RAW_FORMAT_UNCOMPRESSED     = 0,</div>
<div class="line">    RAW_FORMAT_COMPRESSED   = 1,</div>
<div class="line">    RAW_FORMAT_PACKED   = 2,</div>
<div class="line">    RAW_FORMAT_NUM,</div>
<div class="line">} RAW_FORMAT;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define PIXEL_IN_MB     (16)</span></div>
<div class="line"><span class="preprocessor">#define PTS_CLK         (90000U)</span></div>
<div class="line"><span class="preprocessor">#define RAW_BUF_NUM     (4)</span></div>
<div class="line"><span class="preprocessor">#define WAIT_2S         (2000)</span></div>
<div class="line"><span class="preprocessor">#define MAX_FILE_NUM    (100)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef AM_IOCTL</span></div>
<div class="line"><span class="preprocessor">#define AM_IOCTL(_filp, _cmd, _arg) \</span></div>
<div class="line"><span class="preprocessor">        do {                        \</span></div>
<div class="line"><span class="preprocessor">            if (ioctl(_filp, _cmd, _arg) &lt; 0) { \</span></div>
<div class="line"><span class="preprocessor">                perror(#_cmd);      \</span></div>
<div class="line"><span class="preprocessor">                return -1;          \</span></div>
<div class="line"><span class="preprocessor">            }                       \</span></div>
<div class="line"><span class="preprocessor">        } while (0)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_ENCODE_STREAM_NUM   (IAV_STREAM_MAX_NUM_ALL)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_STREAMID(x)  do {        \</span></div>
<div class="line"><span class="preprocessor">            if (((x) &lt; 0) || ((x) &gt;= MAX_ENCODE_STREAM_NUM)) {  \</span></div>
<div class="line"><span class="preprocessor">                printf(&quot;stream id wrong %d \n&quot;</span>, (x));           \</div>
<div class="line">                return -1;  \</div>
<div class="line">            }   \</div>
<div class="line">        } while(0)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERIFY_CANVASID(x)  \</span></div>
<div class="line"><span class="preprocessor">        do {                \</span></div>
<div class="line"><span class="preprocessor">            if ((x) &lt; 0 || ((x) &gt;= IAV_MAX_CANVAS_BUF_NUM)) {   \</span></div>
<div class="line"><span class="preprocessor">                printf (&quot;canvas id wrong %d\n&quot;</span>, (x));   \</div>
<div class="line">                return -1;  \</div>
<div class="line">            }   \</div>
<div class="line">        } while (0)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a0" name="a0"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> file_frame_count[MAX_FILE_NUM];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> fd_index_curr = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d7/d81/group__video-sharing-service-struct-group.html#ga96849c6a73d4bbc29bbeef33f96f8411">yuv_format</a> = YUV420_NV12;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> yuv_name[240];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> me1_name[240];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> me0_name[240];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> raw_name[240];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> raw_ce_name[240];</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> frame_num = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> loop_num = 1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> single_input_flag = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> file_index_start = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> file_index_end = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a id="_a1" name="_a1"></a><a class="code hl_struct" href="../../dc/d76/structiav__window.html">iav_window</a> frame_size;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code hl_struct" href="../../dc/d76/structiav__window.html">iav_window</a> ce_size;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> type = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> frame_rate = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> canvas_id = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> from_ext_mem = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> verbose = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> exit_efm = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> mem_cpy_type = MEM_CPY_TYPE_GDMA;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> me_transfer_type = ME_TRANSFER_NORMAL;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> feed_type = FEED_NORMAL;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> me1_from_file = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> me0_from_file = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> raw_ce_from_file = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> raw_format = RAW_FORMAT_UNCOMPRESSED;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* canvas_pool_mem = NULL;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* canvas_pool_phy_mem = NULL;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> canvas_pool_size = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* dsp_mem = NULL;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* dsp_phy_mem = NULL;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> dsp_size = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* buf_mem = NULL;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> buf_mem_phy_addr = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> total_buf_size = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> single_buf_size = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> raw_batch_num = 1;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> vinc_id = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> anon_part_id = -1;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* luma_buf = NULL;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* me1_buf = NULL;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* me0_buf = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> sem_t write_sem;</div>
<div class="line"><span class="keyword">static</span> sem_t read_sem;</div>
<div class="line"><span class="keyword">static</span> pthread_t raw_thread_id;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a2" name="a2"></a>current_stream = -1;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> use_me0 = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> use_fixed_pattern = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> audio_clock = 0;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> stream_type = 0;</div>
<div class="line"><span class="keyword">static</span> sem_t sem;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> map_usr_buffer(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a3" name="_a3"></a><a class="code hl_structRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a> query_mem = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a4" name="_a4"></a><a class="code hl_structRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a> *part_info = NULL;</div>
<div class="line"> </div>
<div class="line">    query_mem.<a id="a5" name="a5"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">mid</a> = <a id="a6" name="a6"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a>;</div>
<div class="line">    part_info = &amp;query_mem.<a id="a7" name="a7"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">arg</a>.<a id="a8" name="a8"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">partition</a>;</div>
<div class="line">    part_info-&gt;<a id="a9" name="a9"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = <a id="a10" name="a10"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa9c6871121818aa47f659dea5f7b93f1a">IAV_PART_USR</a>;</div>
<div class="line">    <a id="a11" name="a11"></a><a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a12" name="a12"></a>IAV_IOC_QUERY_MEMBLOCK, &amp;query_mem);</div>
<div class="line"> </div>
<div class="line">    total_buf_size = part_info-&gt;<a id="a13" name="a13"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a14" name="a14"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (total_buf_size == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;user size should be &gt; 0 for raw!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    buf_mem_phy_addr = part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a id="a15" name="a15"></a><a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>;</div>
<div class="line">    buf_mem = mmap(NULL, total_buf_size, PROT_READ | PROT_WRITE, MAP_SHARED,</div>
<div class="line">        fd_iav, part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (buf_mem == MAP_FAILED) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;mmap IAV_PART_USR failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a16" name="a16"></a>map_dsp_buffer(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a> query_mem = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a> *part_info = NULL;</div>
<div class="line"> </div>
<div class="line">    query_mem.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">mid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a>;</div>
<div class="line">    part_info = &amp;query_mem.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">partition</a>;</div>
<div class="line">    part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = <a id="a17" name="a17"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa">IAV_PART_DSP</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_QUERY_MEMBLOCK, &amp;query_mem);</div>
<div class="line"> </div>
<div class="line">    dsp_size = part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    dsp_phy_mem = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>;</div>
<div class="line">    dsp_mem = mmap(NULL, dsp_size, PROT_READ | PROT_WRITE, MAP_SHARED, fd_iav,</div>
<div class="line">        part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (dsp_mem == MAP_FAILED) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;mmap IAV_PART_DSP failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> map_canvas_pool_buffer(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a> query_mem = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a> *part_info = NULL;</div>
<div class="line"> </div>
<div class="line">    query_mem.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">mid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a>;</div>
<div class="line">    part_info = &amp;query_mem.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">partition</a>;</div>
<div class="line">    part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = <a id="a18" name="a18"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faaad312de47a183da5f2167b10c8c1e528">IAV_PART_CANVAS_POOL</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_QUERY_MEMBLOCK, &amp;query_mem);</div>
<div class="line"> </div>
<div class="line">    canvas_pool_size = part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    canvas_pool_phy_mem = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>;</div>
<div class="line">    canvas_pool_mem = mmap(NULL, canvas_pool_size, PROT_READ, MAP_SHARED, fd_iav, part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">mem</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">addr</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (canvas_pool_mem == MAP_FAILED) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;mmap IAV_PART_CANVAS_POOL failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> map_buf_for_yuv(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a19" name="_a19"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> canvas_cfg = {0};</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"> </div>
<div class="line">    ret = map_usr_buffer();</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to map usr mem!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> MAP_BUF_FOR_YUV_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ret = map_dsp_buffer();</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to map dsp mem!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> MAP_BUF_FOR_YUV_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a20" name="a20"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ad25de23139382a40fae433639dbc04e9">type</a> == EFM_TYPE_YUV_CAPTURE) {</div>
<div class="line">        canvas_cfg.<a id="a21" name="a21"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a22" name="a22"></a>IAV_IOC_GET_CANVAS_CONFIG, &amp;canvas_cfg);</div>
<div class="line">        <span class="keywordflow">if</span> (canvas_cfg.<a id="a23" name="a23"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a51993db991a3b2807df9114b0134ffdf">ext_mem</a> || canvas_cfg.<a id="a24" name="a24"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a423a515fa4f18a4a232501e84d5adbb2">manual_feed</a>) {</div>
<div class="line">            ret = map_canvas_pool_buffer();</div>
<div class="line">            <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Failed to map canvas mem!\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> MAP_BUF_FOR_YUV_EXIT;</div>
<div class="line">            }</div>
<div class="line">            from_ext_mem = 1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            from_ext_mem = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">MAP_BUF_FOR_YUV_EXIT:</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> alloc_buf_for_raw(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> size)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a25" name="_a25"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html">iav_alloc_mem_part</a> alloc_mem_part = {0};</div>
<div class="line"> </div>
<div class="line">    alloc_mem_part.<a id="a26" name="a26"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a9ee64c7b918513891b3834b93ad0e501">length</a> = size;</div>
<div class="line">    alloc_mem_part.<a id="a27" name="a27"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a8ea167dba5ed98a2ab50ff41dae8dde5">enable_cache</a> = 0;</div>
<div class="line">    alloc_mem_part.<a id="a28" name="a28"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#adac25b843a2cccd720a100c5b9b1b545">from_private</a> = 1;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a29" name="a29"></a>IAV_IOC_ALLOC_ANON_MEM_PART, &amp;alloc_mem_part);</div>
<div class="line">    anon_part_id = alloc_mem_part.<a id="a30" name="a30"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a>;</div>
<div class="line">    total_buf_size = alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a9ee64c7b918513891b3834b93ad0e501">length</a>;</div>
<div class="line">    buf_mem_phy_addr = alloc_mem_part.<a id="a31" name="a31"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#ac1369a1f209735864674d22517edfa76">offset</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (total_buf_size) {</div>
<div class="line">        buf_mem = mmap(NULL, alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a9ee64c7b918513891b3834b93ad0e501">length</a>, PROT_READ | PROT_WRITE, MAP_SHARED,</div>
<div class="line">            fd_iav, alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#ac1369a1f209735864674d22517edfa76">offset</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (buf_mem == MAP_FAILED) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;mmap anon buffer failed\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> free_buf_for_raw(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html">iav_alloc_mem_part</a> alloc_mem_part = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (buf_mem &amp;&amp; total_buf_size) {</div>
<div class="line">        munmap(buf_mem, total_buf_size);</div>
<div class="line">        buf_mem = NULL;</div>
<div class="line">        total_buf_size = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (anon_part_id &gt;= 0) {</div>
<div class="line">        alloc_mem_part.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = anon_part_id;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a32" name="a32"></a>IAV_IOC_FREE_MEM_PART, &amp;alloc_mem_part);</div>
<div class="line">        anon_part_id = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a33" name="a33"></a>get_arbitrary_resolution(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a34" name="a34"></a>name, <span class="keywordtype">int</span> *width, <span class="keywordtype">int</span> *height)</div>
<div class="line">{</div>
<div class="line">    sscanf(name, <span class="stringliteral">&quot;%dx%d&quot;</span>, width, height);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a id="a35" name="a35"></a>usage(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    printf(<span class="stringliteral">&quot;\ntest_efm usage:\n\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(<a id="a36" name="a36"></a>long_options) / <span class="keyword">sizeof</span>(long_options[0]) - 1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (isalpha(long_options[i].val))</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c &quot;</span>, long_options[i].val);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;--%s&quot;</span>, long_options[i].name);</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a37" name="a37"></a>hint[i].arg[0] != 0)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [%s]&quot;</span>, hint[i].arg);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, hint[i].str);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nExamples:\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;****************************************  EFM  ***************************************\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  1. Encode H.264 stream from efm buffer: Input from main buffer to EFM buffer\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_multi_efm.lua\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -b 24 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -A -t 1 -b 0\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  2. Encode multi H.264 stream from efm buffer: Input from main and third buffer to EFM buffer\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_multi_efm.lua\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -b 24 -e -B -h720p -b 24 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -A -t 1 -b 0\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -B -t 1 -b 2 (in another console)\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -B -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  3. Encode H.264 stream from efm buffer: Input from YUV (NV12) file to EFM buffer\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_multi_efm.lua\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -b 24 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -A -t 0 -y 1080p_nv12.yuv -s 1920x1080\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  4. Encode H.264 stream from efm buffer: Input from 4 YUV (NV12) files to EFM buffer with 4 loops\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_multi_efm.lua\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -b 24 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -A -t 0 -y 1080p_nv12 -s 1920x1080 -I 0~3 -L 4 -T 0\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  5. Encode H.265 stream from efm buffer: Input from main buffer to EFM buffer\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_multi_efm.lua\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -H1080p -b 24 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -A -t 1 -b 0\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  6. Encode H.265 stream from efm buffer: Input from YUV (NV12) file to EFM buffer\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_multi_efm.lua\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -H1080p -b 24 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -A -t 0 -y 1080p_nv12.yuv -s 1920x1080\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  7. Encode H.265 stream from efm buffer: Input from 4 YUV (NV12) files to EFM buffer with 4 loops\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_multi_efm.lua\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -H1080p -b 24 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -A -t 0 -y 1080p_nv12 -s 1920x1080 -I 0~3 -L 4 -T 0\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  8. Generate ME data with NEON\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg cv5_multi_efm.lua\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -b 24 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -A -t 0 -y 1080p_nv12.yuv -s 1920x1080 -d 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;**************************************************************************************\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;****************************************  EFR  ***************************************\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  9. Encode from RGB RAW: Input from RGB (RAW) file to VIN\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na;modprobe ambds vin_virtual_flag=1 custom_format_enable=1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear_efr_rgb.lua --vout-cfg &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;/usr/share/ambarella/lua_scripts/vout_hdmi.lua --raw-capture 1 --enc-raw-rgb 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 3 -i cap_raw_raw_1920x1080_3840.raw  -s 1920x1080 -T 1 -r 30 -R 0 --vin-id 14\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  10. Encode from compressed RGB RAW: Input from RGB (RAW) file to VIN\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na; modprobe ambds vin_virtual_flag=1 custom_format_enable=1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg compressed_raw_4k.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi --enc-raw-rgb 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 3 -i 3840x2160_3244_cpr.raw -s 3244x2160 -e ce_960x2160_816_cpr.raw --ce-size 816x2160 &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;-T 1 --raw-format 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  11. Encode from 12-bit packed RGB RAW: Input from RGB (RAW) file to VIN\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na; modprobe ambds vin_virtual_flag=1 custom_format_enable=1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg uncompressed_pack_raw_packed_4k.lua --vout-cfg &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;/usr/share/ambarella/lua_scripts/vout_hdmi.lua --raw-capture 1 --enc-raw-rgb 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 3 -i 3840x2160_5764_pck_12bits.raw -s 5764x2160 -e &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;ce_960x2160_1444_pck_12bits.raw --ce-size 1444x2160 -T 1 --raw-format 2\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  12. Encode from YUV NV16 RAW: Input from YUV (NV16) file to VIN\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na; modprobe ambds vin_virtual_flag=1 custom_format_enable=1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear_efr_yuv.lua &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;--vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-raw-yuv 1 --raw-capture 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 2 -i 1080p_nv16.raw -s 1920x1080 -T 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  13. Encode from YUV NV12 RAW: Input from YUV (NV12) file to VIN\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na; modprobe ambds vin_virtual_flag=1 custom_format_enable=1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear_efr_yuv.lua &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;--vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-raw-nv12 1 --raw-capture 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 4 -i 1080p_nv12.raw -s 1920x1080 -T 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  14. Encode from RGB RAW with multi channel and multi source: two input and two channel\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na; modprobe ambds vin_virtual_flag=1 virtual_vsrc_num=2 custom_format_enable=1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_dual_chan_dual_input_raw_encode.lua &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;--vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --raw-capture 1 --enc-raw-rgb 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 3 -i cap_raw_raw_1920x1080_3840_v1.raw -s 1920x1080 -T 1 --vin-id 14\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 3 -i cap_raw_raw_3840x2160_7680_v2.raw -s 3840x2160 -T 1 --vin-id 15\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  15. Encode from RGB RAW with multi channel and single source: one input and two channel\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na; modprobe ambds vin_virtual_flag=1 custom_format_enable=1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_dual_chan_dual_input_raw_encode.lua &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;--vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --raw-capture 1 --enc-raw-rgb 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 3 -i cap_raw_raw_1920x1080_3840.raw -s 1920x1080 -T 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h1080p -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  16. EIS: Capture RAW from live sensor then feed to EFR channel\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # modprobe eis_mc\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # modprobe gyro_icm20648_mc\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # modprobe ambds vin_virtual_flag=1 custom_format_enable=1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_4k_linear_eis.lua --raw-capture 1 --enc-raw-rgb 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 5 -V 14\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -h 3840x2160 -b 2 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;  17. Capture YUV(NV12) RAW from canvas then feed to EFR channel\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # modprobe ambds vin_virtual_flag=1 custom_format_enable=1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_aaa_service -a &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_dual_chan_one_sensor_one_yuv_efr.lua &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;--vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --enc-raw-nv12 1\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_manual_feed -a0 -Q0 &amp;\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_efm -t 6 -b 0 -V 14\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -H 3840x2160 -b 4 -e\n&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;    # test_encode -A -s\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//first second value must in format &quot;x~y&quot; if delimiter is &#39;~&#39;</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a38" name="a38"></a>get_two_unsigned_int(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> *first, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> *second, <span class="keywordtype">char</span> delimiter)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> tmp_string[16] = {0};</div>
<div class="line">    <span class="keywordtype">char</span> * separator = NULL;</div>
<div class="line"> </div>
<div class="line">    separator = strchr(name, delimiter);</div>
<div class="line">    <span class="keywordflow">if</span> (!separator) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;range should be like a%cb \n&quot;</span>, delimiter);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    strncpy(tmp_string, name, separator - name);</div>
<div class="line">    tmp_string[separator - <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">    *first = atoi(tmp_string);</div>
<div class="line">    strncpy(tmp_string, separator + 1,  name + strlen(name) -separator);</div>
<div class="line">    *second = atoi(tmp_string);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> init_param(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ch = 0, value = 0;</div>
<div class="line">    <span class="keywordtype">int</span> width = 0, height = 0;</div>
<div class="line">    <span class="keywordtype">int</span> option_index = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> min_value = 0, max_value = 0;</div>
<div class="line"> </div>
<div class="line">    opterr = 0;</div>
<div class="line">    <span class="keywordflow">while</span> ((ch = getopt_long(argc, argv, <a id="a39" name="a39"></a>short_options, long_options,</div>
<div class="line">        &amp;option_index)) != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div>
<div class="line">            current_stream = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>:</div>
<div class="line">            current_stream = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:</div>
<div class="line">            current_stream = 2;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:</div>
<div class="line">            current_stream = 3;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:</div>
<div class="line">            current_stream = 4;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:</div>
<div class="line">            min_value = atoi(optarg);</div>
<div class="line">            <a id="a40" name="a40"></a><a class="code hl_defineRef" target="_blank" href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a>(min_value);</div>
<div class="line">            current_stream = min_value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> ((value &lt; EFM_TYPE_FIRST) || (value &gt;= EFM_TYPE_LAST)) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid EFM type id %d, should be [%d, %d).\n&quot;</span>,</div>
<div class="line">                    value, EFM_TYPE_FIRST, EFM_TYPE_LAST);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            type = value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <a class="code hl_enumerationRef" target="_blank" href="../../../library/d7/d81/group__video-sharing-service-struct-group.html#ga96849c6a73d4bbc29bbeef33f96f8411">yuv_format</a> = value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            VERIFY_CANVASID(value);</div>
<div class="line">            canvas_id = value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (value &lt; RAW_FORMAT_UNCOMPRESSED || value &gt;= RAW_FORMAT_NUM) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid raw data type %d, should be [%d, %d).\n&quot;</span>,</div>
<div class="line">                    value, RAW_FORMAT_UNCOMPRESSED, RAW_FORMAT_NUM);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            raw_format = value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:</div>
<div class="line">            strcpy(yuv_name, optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div>
<div class="line">            strcpy(raw_name, optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:</div>
<div class="line">            strcpy(raw_ce_name, optarg);</div>
<div class="line">            raw_ce_from_file = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div>
<div class="line">            strcpy(me1_name, optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:</div>
<div class="line">            strcpy(me0_name, optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            frame_num = value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">            get_arbitrary_resolution(optarg, &amp;width, &amp;height);</div>
<div class="line">            frame_size.width = width;</div>
<div class="line">            frame_size.height = height;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a41" name="a41"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d3/d9f/test__efm_8h.html#a2e9b2d078c1fb89a8e683b2215186f63ac1c5aa1f9aeb910aa410d126ea642b6f">CE_SIZE_FLAG</a>:</div>
<div class="line">            get_arbitrary_resolution(optarg, &amp;width, &amp;height);</div>
<div class="line">            ce_size.width = width;</div>
<div class="line">            ce_size.height = height;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line">            frame_rate = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>:</div>
<div class="line">            loop_num = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (loop_num &lt;= 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invaild loop num [%d], it must be larger than 0.\n&quot;</span>, loop_num);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>:</div>
<div class="line">            <span class="keywordflow">if</span> (get_two_unsigned_int(optarg, &amp;min_value, &amp;max_value, <span class="charliteral">&#39;~&#39;</span>) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (min_value &gt; max_value) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid file index range [%d~%d]!\n&quot;</span>, min_value, max_value);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            file_index_start = min_value;</div>
<div class="line">            file_index_end = max_value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div>
<div class="line">            mem_cpy_type = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;T&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (value &gt;= FEED_TYPE_NUM || value &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid feed type %d, should be 0~%d.\n&quot;</span>,</div>
<div class="line">                    value, FEED_TYPE_NUM - 1);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            feed_type = value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div>
<div class="line">            verbose = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> ((value &gt; (<a id="a42" name="a42"></a>VIN_CONTROLLER_NUM - 1)) || (value &lt; <a id="a43" name="a43"></a>IAV_MAX_REAL_VIN_NUM)) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid param for vin id [%d] should be within [%d~%d].\n&quot;</span>,</div>
<div class="line">                    value, IAV_MAX_REAL_VIN_NUM, (VIN_CONTROLLER_NUM - 1));</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            vinc_id = value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> ((value &lt; ME_TRANSFER_TYPE_FIRST) || (value &gt;= ME_TRANSFER_TYPE_LAST)) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid ME transfer type id %d, should be [%d, %d).\n&quot;</span>,</div>
<div class="line">                    value, ME_TRANSFER_TYPE_FIRST, ME_TRANSFER_TYPE_LAST);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            me_transfer_type = value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a id="a44" name="a44"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d3/d9f/test__efm_8h.html#a2e9b2d078c1fb89a8e683b2215186f63a9192f26f9296b3e4ac550642ed0a13a5">FIXED_PATTERN_FLAG</a>:</div>
<div class="line">            use_fixed_pattern = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            printf(<span class="stringliteral">&quot;unknown option found: %c\n&quot;</span>, ch);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!raw_ce_from_file &amp;&amp; ((raw_format == RAW_FORMAT_COMPRESSED) ||</div>
<div class="line">        (raw_format == RAW_FORMAT_PACKED))) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Need to specify ce file when raw compression or raw packed enabled!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (raw_ce_from_file &amp;&amp; (!ce_size.height || !ce_size.width)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Need to specify ce size when raw ce from file!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sigstop(<span class="keywordtype">int</span> sig)</div>
<div class="line">{</div>
<div class="line">    exit_efm = 1;</div>
<div class="line">    <span class="keywordflow">if</span> ((type == EFM_TYPE_YUV_FILE) || (type == EFM_TYPE_YUV_CAPTURE)) {</div>
<div class="line">        sem_post(&amp;sem);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_me1_buffer(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf_in, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *me_out)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width_in = 0, height_in = 0, width_out = 0, result = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, j = 0, k = 0, l = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *start = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (buf_in == NULL || me_out == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid address for write_me0_buffer!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    width_in = frame_size.width;</div>
<div class="line">    height_in = frame_size.height;</div>
<div class="line">    width_out = <a id="a45" name="a45"></a><a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, 4) &gt;&gt; 2;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// TODO: Add special handling for last line if necessary</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; height_in / 4; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; width_out; j++) {</div>
<div class="line">            result = 0;</div>
<div class="line">            start = buf_in + i * 4 * width_in + j * 4;</div>
<div class="line">            <span class="keywordflow">for</span> (k = 0; k &lt; 4; k++) {</div>
<div class="line">                <span class="keywordflow">for</span> (l = 0; l &lt; 4; l++) {</div>
<div class="line">                    result += start[k * width_in + l];</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            me_out[i * width_out + j] = (result + 8) &gt;&gt; 4;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_me0_buffer(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf_in, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *me_out)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width_in = 0, height_in = 0, width_out = 0, result = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, j = 0, k = 0, l = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *start = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (buf_in == NULL || me_out == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid address for write_me0_buffer!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    width_in = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, 4) &gt;&gt; 2;</div>
<div class="line">    height_in = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.height, 4) &gt;&gt; 2;</div>
<div class="line">    width_out = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, 8) &gt;&gt; 3;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// TODO: Add special handling for last line if necessary</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; height_in / 2; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; width_out; j++) {</div>
<div class="line">            result = 0;</div>
<div class="line">            start = buf_in + i * 2 * width_in + j * 2;</div>
<div class="line">            <span class="keywordflow">for</span> (k = 0; k &lt; 2; k++) {</div>
<div class="line">                <span class="keywordflow">for</span> (l = 0; l &lt; 2; l++) {</div>
<div class="line">                    result += start[k * width_in + l];</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            me_out[i * width_out + j] = (result + 2) &gt;&gt; 2;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> transfer_me1_buf_by_neon(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf_in, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width_in, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> height_in,</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf_out, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width_out)</div>
<div class="line">{</div>
<div class="line">    uint16x8_t line01 = {0}, line23 = {0};</div>
<div class="line">    uint32x4_t line = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> i = 0, j = 0, add_num = 8, ratio = 4;</div>
<div class="line">    <span class="keywordtype">int</span> out = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *start = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; height_in; j += 4) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; width_in; i += 16) {</div>
<div class="line">            start = buf_in + j * width_in + i;</div>
<div class="line"> </div>
<div class="line">            line01 = vpadalq_u8(vpaddlq_u8(vld1q_u8(start)), vld1q_u8(start + width_in));</div>
<div class="line">            line23 = vpadalq_u8(vpaddlq_u8(vld1q_u8(start + 2 * width_in)), vld1q_u8(start + 3 * width_in));</div>
<div class="line">            line = vpadalq_u16(vpaddlq_u16(line01), line23);</div>
<div class="line"> </div>
<div class="line">            buf_out[out] = ((vgetq_lane_u32(line, 0) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 1] = ((vgetq_lane_u32(line, 1) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 2] = ((vgetq_lane_u32(line, 2) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 3] = ((vgetq_lane_u32(line, 3) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            out += 4;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> transfer_me0_buf_by_neon(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf_in, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width_in, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> height_in,</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf_out, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width_out)</div>
<div class="line">{</div>
<div class="line">    uint16x8_t line0 = {0}, line1 = {0}, line = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> i, j, add_num = 2, ratio = 2;</div>
<div class="line">    <span class="keywordtype">int</span> out = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *start = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; height_in; j += 2) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; width_in; i += 16) {</div>
<div class="line">            start = buf_in + j * width_in + i;</div>
<div class="line"> </div>
<div class="line">            line0 = vpaddlq_u8(vld1q_u8(start));</div>
<div class="line">            line1 = vpaddlq_u8(vld1q_u8(start + width_in));</div>
<div class="line">            line = vaddq_u16(line0, line1);</div>
<div class="line"> </div>
<div class="line">            buf_out[out] = ((vgetq_lane_u16(line, 0) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 1] = ((vgetq_lane_u16(line, 1) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 2] = ((vgetq_lane_u16(line, 2) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 3] = ((vgetq_lane_u16(line, 3) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 4] = ((vgetq_lane_u16(line, 4) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 5] = ((vgetq_lane_u16(line, 5) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 6] = ((vgetq_lane_u16(line, 6) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            buf_out[out + 7] = ((vgetq_lane_u16(line, 7) + add_num) &gt;&gt; ratio) &amp; 0xff;</div>
<div class="line">            out += 8;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> write_me_buffer_by_neon(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *buf_in, BUF_TYPE type_in, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *me_out, BUF_TYPE type_out)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width_in = 0, height_in = 0, width_out = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (type_in == BUF_LUMA) {</div>
<div class="line">        width_in = frame_size.width;</div>
<div class="line">        height_in = frame_size.height;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        width_in = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, 4) &gt;&gt; 2;</div>
<div class="line">        height_in =  <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.height, 4) &gt;&gt; 2;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (type_out == BUF_ME1) {</div>
<div class="line">        width_out = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, 4) &gt;&gt; 2;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        width_out = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, 8) &gt;&gt; 3;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (type_in == BUF_LUMA &amp;&amp; type_out == BUF_ME1) {</div>
<div class="line">        transfer_me1_buf_by_neon(buf_in, width_in, height_in, me_out, width_out);</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type_in == BUF_ME1 &amp;&amp; type_out == BUF_ME0_8) {</div>
<div class="line">        transfer_me0_buf_by_neon(buf_in, width_in, height_in, me_out, width_out);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid buffer type for write_me_buffer!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> generate_me1_file(<span class="keywordtype">int</span> file_index, <span class="keywordtype">char</span> *yuv_name_tmp, <span class="keywordtype">char</span> *me1_name_tmp)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width = 0, height = 0, luma_size = 0, me1_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, fd_yuv = -1, fd_me1 = -1;</div>
<div class="line"> </div>
<div class="line">    fd_yuv = open(yuv_name_tmp, O_LARGEFILE | O_RDONLY);</div>
<div class="line">    <span class="keywordflow">if</span> (fd_yuv &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;YUV file name: \&quot;%s\&quot; not existed!\n&quot;</span>, yuv_name_tmp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Start to generate me1 file from YUV!\n&quot;</span>);</div>
<div class="line">    fd_me1 = open(me1_name_tmp, O_LARGEFILE | O_CREAT | O_WRONLY, 644);</div>
<div class="line">    <span class="keywordflow">if</span> (fd_me1 &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to create me1 file %s!\n&quot;</span>, me1_name_tmp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    me1_from_file = 1;</div>
<div class="line">    width = frame_size.width;</div>
<div class="line">    height = frame_size.height;</div>
<div class="line">    luma_size = width * height;</div>
<div class="line">    luma_buf = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)malloc(luma_size);</div>
<div class="line">    <span class="keywordflow">if</span> (luma_buf == NULL) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    width = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, 4) &gt;&gt; 2;</div>
<div class="line">    height = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.height, 4) &gt;&gt; 2;</div>
<div class="line">    me1_size = width * height;</div>
<div class="line">    me1_buf = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)malloc(me1_size);</div>
<div class="line">    <span class="keywordflow">if</span> (me1_buf == NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (luma_buf != NULL) {</div>
<div class="line">            free(luma_buf);</div>
<div class="line">            luma_buf = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; file_frame_count[file_index]; ++i) {</div>
<div class="line">        <a id="a46" name="a46"></a><a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_yuv, luma_buf, luma_size);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// ignore chroma;</span></div>
<div class="line">        lseek(fd_yuv, luma_size &gt;&gt; 1, SEEK_CUR);</div>
<div class="line">        <span class="keywordflow">if</span> (me_transfer_type == ME_TRANSFER_NORMAL) {</div>
<div class="line">            <span class="keywordflow">if</span> (write_me1_buffer(luma_buf, me1_buf) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (write_me_buffer_by_neon(luma_buf, BUF_LUMA, me1_buf, BUF_ME1) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a id="a47" name="a47"></a><a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#a6022838300921ede682be48effc14015">AMBA_WRITE_FILE</a>(fd_me1, me1_buf, me1_size);</div>
<div class="line">    }</div>
<div class="line">    close(fd_yuv);</div>
<div class="line">    fd_yuv = -1;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;Saved me1 file to %s!\n&quot;</span>, me1_name_tmp);</div>
<div class="line">    <span class="keywordflow">if</span> (fd_me1 &gt;= 0) {</div>
<div class="line">        close(fd_me1);</div>
<div class="line">        fd_me1 = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (luma_buf != NULL) {</div>
<div class="line">        free(luma_buf);</div>
<div class="line">        luma_buf = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (me1_buf != NULL) {</div>
<div class="line">        free(me1_buf);</div>
<div class="line">        me1_buf = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> generate_me0_file(BUF_TYPE type, <span class="keywordtype">int</span> file_index,</div>
<div class="line">    <span class="keywordtype">char</span> *me1_name_tmp, <span class="keywordtype">char</span> *me0_name_tmp)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width = 0, height = 0, me1_size = 0, me0_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, fd_me1 = -1, fd_me0 = -1;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;Start to generate me0 file from YUV!\n&quot;</span>);</div>
<div class="line">    fd_me0 = open(me0_name_tmp, O_LARGEFILE | O_CREAT | O_WRONLY, 644);</div>
<div class="line">    <span class="keywordflow">if</span> (fd_me0 &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to create me0 file %s!\n&quot;</span>, me0_name_tmp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    fd_me1 = open(me1_name_tmp, O_LARGEFILE | O_RDONLY);</div>
<div class="line">    <span class="keywordflow">if</span> (fd_me1 &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to open me1 file %s!\n&quot;</span>, me1_name_tmp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    me0_from_file = 1;</div>
<div class="line">    width = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, 4) &gt;&gt; 2;</div>
<div class="line">    height = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.height, 4) &gt;&gt; 2;</div>
<div class="line">    me1_size = width * height;</div>
<div class="line">    me1_buf = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)malloc(me1_size);</div>
<div class="line">    <span class="keywordflow">if</span> (me1_buf == NULL) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    width = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, 8) &gt;&gt; 3;</div>
<div class="line">    height = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.height, 8) &gt;&gt; 3;</div>
<div class="line">    me0_size = width * height;</div>
<div class="line">    me0_buf = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)malloc(me0_size);</div>
<div class="line">    <span class="keywordflow">if</span> (me0_buf == NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (me1_buf != NULL) {</div>
<div class="line">            free(me1_buf);</div>
<div class="line">            me1_buf = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; file_frame_count[file_index]; ++i) {</div>
<div class="line">        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_me1, me1_buf, me1_size);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (me_transfer_type == ME_TRANSFER_NORMAL) {</div>
<div class="line">            <span class="keywordflow">if</span> (write_me0_buffer(me1_buf, me0_buf) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (write_me_buffer_by_neon(me1_buf, BUF_ME1, me0_buf, type) &lt; 0) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#a6022838300921ede682be48effc14015">AMBA_WRITE_FILE</a>(fd_me0, me0_buf, me0_size);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;Saved me0 file to %s!\n&quot;</span>, me0_name_tmp);</div>
<div class="line">    <span class="keywordflow">if</span> (fd_me1 &gt;= 0) {</div>
<div class="line">        close(fd_me1);</div>
<div class="line">        fd_me1 = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (fd_me0 &gt;= 0) {</div>
<div class="line">        close(fd_me0);</div>
<div class="line">        fd_me0 = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (me1_buf != NULL) {</div>
<div class="line">        free(me1_buf);</div>
<div class="line">        me1_buf = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (me0_buf != NULL) {</div>
<div class="line">        free(me0_buf);</div>
<div class="line">        me0_buf = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> prepare_yuv_params(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>efm_stream_cfg stream_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> canvas_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a48" name="_a48"></a><a class="code hl_structRef" target="_blank" href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a> query_info = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a49" name="_a49"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html">iav_stream_info</a> *stream_info = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../dc/d76/structiav__window.html">iav_window</a> *yuv_size = &amp;stream_cfg.pool_info.yuv_size;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> single_size = 0, frame_num_per_loop = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> frame_height_aligned = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line">    <span class="keywordtype">int</span> fd_yuv = -1;</div>
<div class="line">    <span class="keywordtype">int</span> me0_flag = 1, me1_flag = 1;</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keyword">struct </span>stat statbuff = {0};</div>
<div class="line">    <span class="keywordtype">char</span> yuv_name_tmp[256] = {0};</div>
<div class="line">    <span class="keywordtype">char</span> me1_name_tmp[256] = {0};</div>
<div class="line">    <span class="keywordtype">char</span> me0_name_tmp[256] = {0};</div>
<div class="line"> </div>
<div class="line">    memset(&amp;stream_cfg, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> efm_stream_cfg));</div>
<div class="line">    stream_cfg.stream_id = stream_id;</div>
<div class="line">    <span class="keywordflow">if</span> (efm_get_stream_cfg(&amp;stream_cfg) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Get efm stream config failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!stream_cfg.efm_enable) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;enc_from_mem not enabled, please enable it in test_encode!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    stream_type = stream_cfg.stream_type;</div>
<div class="line">    use_me0 = (stream_type == <a id="a50" name="a50"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (type == EFM_TYPE_YUV_FILE) {</div>
<div class="line">        <span class="keywordflow">if</span> (file_index_start == -1) {</div>
<div class="line">            file_index_start = 0;</div>
<div class="line">            file_index_end = 0;</div>
<div class="line">        }</div>
<div class="line">        frame_height_aligned = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.height, PIXEL_IN_MB);</div>
<div class="line">        <span class="keywordflow">if</span> (!frame_size.width &amp;&amp; !frame_size.height) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Frame size is not specified!\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (frame_size.width &gt; yuv_size-&gt;<a id="a51" name="a51"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> ||</div>
<div class="line">            frame_height_aligned &gt; yuv_size-&gt;<a id="a52" name="a52"></a><a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Aligned Frame size is %dx%d, can not larger than %dx%d!\n&quot;</span>,</div>
<div class="line">                frame_size.width, frame_height_aligned,</div>
<div class="line">                yuv_size-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>, yuv_size-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        single_size = frame_size.width * frame_size.height * 3 &gt;&gt; 1;</div>
<div class="line">        <span class="keywordflow">if</span> (frame_rate == -1) {</div>
<div class="line">            frame_rate = 30;</div>
<div class="line">            printf(<span class="stringliteral">&quot;Use frame rate %d as default, if no speficied!\n&quot;</span>,</div>
<div class="line">                frame_rate);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (frame_rate == 0 || <a id="a53" name="a53"></a><a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a1fb0b57da8f35f1c47328e737e14b99d">PTS_CLK</a> % frame_rate){</div>
<div class="line">            printf(<span class="stringliteral">&quot;Incorrect frame rate %d!\n&quot;</span>, frame_rate);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (yuv_name[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;YUV file name not specified!\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (me0_name[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;No me0 files are specified, need to create them.\n&quot;</span>);</div>
<div class="line">            me0_flag = 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (me1_name[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;No me1 files are specified, need to create them.\n&quot;</span>);</div>
<div class="line">            me1_flag = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (file_index_start == file_index_end) {</div>
<div class="line">            single_input_flag = 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = file_index_start; i &lt;= file_index_end; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (single_input_flag == 1) {</div>
<div class="line">                strcpy(yuv_name_tmp, yuv_name);</div>
<div class="line">                sprintf(me1_name_tmp, <span class="stringliteral">&quot;%s.me1&quot;</span>, yuv_name);</div>
<div class="line">                sprintf(me0_name_tmp, <span class="stringliteral">&quot;%s.me0&quot;</span>, yuv_name);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                sprintf(yuv_name_tmp, <span class="stringliteral">&quot;%s_%d.yuv&quot;</span>, yuv_name, i);</div>
<div class="line">                sprintf(me1_name_tmp, <span class="stringliteral">&quot;%s_%d.me1&quot;</span>, yuv_name, i);</div>
<div class="line">                sprintf(me0_name_tmp, <span class="stringliteral">&quot;%s_%d.me0&quot;</span>, yuv_name, i);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            fd_yuv = open(yuv_name_tmp, O_LARGEFILE | O_RDONLY);</div>
<div class="line">            <span class="keywordflow">if</span> (fd_yuv &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;YUV file name: \&quot;%s\&quot; not existed!\n&quot;</span>, yuv_name_tmp);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (fstat(fd_yuv, &amp;statbuff) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;fstat&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            total_size = statbuff.st_size;</div>
<div class="line">            close(fd_yuv);</div>
<div class="line">            fd_yuv = -1;</div>
<div class="line">            <span class="comment">// Fix Me:  Assume YUV420 always</span></div>
<div class="line">            file_frame_count[i] = total_size / single_size;</div>
<div class="line">            frame_num_per_loop += file_frame_count[i];</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (me1_flag == 0) {</div>
<div class="line">                ret = generate_me1_file(i, yuv_name_tmp, me1_name_tmp);</div>
<div class="line">                <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                    me1_from_file = 0;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    me1_from_file = 1;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                me1_from_file = 1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (use_me0) {</div>
<div class="line">                <span class="keywordflow">if</span> (me0_flag == 0) {</div>
<div class="line">                    ret = generate_me0_file(BUF_ME0_8, i,</div>
<div class="line">                        me1_name_tmp, me0_name_tmp);</div>
<div class="line">                    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                        me0_from_file = 0;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        me0_from_file = 1;</div>
<div class="line">                    }</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    me0_from_file = 1;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (frame_num == -1 &amp;&amp; feed_type != FEED_REPEATE ) {</div>
<div class="line">            frame_num = frame_num_per_loop * loop_num;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a> = canvas_id;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_CANVAS_CONFIG, &amp;canvas_cfg);</div>
<div class="line">        <span class="keywordflow">if</span> (canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ad25de23139382a40fae433639dbc04e9">type</a> != <a id="a54" name="a54"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga72de8a505ff4d73f6252097b3bf5b993a8ec3b63ed4b19ee5d0c42942db33d3e6">IAV_CANVAS_TYPE_ENCODE</a>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Invalid EFM source canvas buffer type, should be \&quot;encode\&quot;.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        frame_size.width = canvas_cfg.<a id="a55" name="a55"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#aa1281fe9a1e356ee476ec71c9f7914ac">max</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">        frame_size.height = canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#aa1281fe9a1e356ee476ec71c9f7914ac">max</a>.<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">        frame_height_aligned = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.height, PIXEL_IN_MB);</div>
<div class="line">        <span class="keywordflow">if</span> (frame_size.width &gt; yuv_size-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> ||</div>
<div class="line">            frame_height_aligned &gt; yuv_size-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Aligned Frame size is %dx%d, can not larger than %dx%d!\n&quot;</span>,</div>
<div class="line">                frame_size.width, frame_height_aligned,</div>
<div class="line">                yuv_size-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>, yuv_size-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_enumerationRef" target="_blank" href="../../../library/d7/d81/group__video-sharing-service-struct-group.html#ga96849c6a73d4bbc29bbeef33f96f8411">yuv_format</a> = YUV420_NV12;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_enumerationRef" target="_blank" href="../../../library/d7/d81/group__video-sharing-service-struct-group.html#ga96849c6a73d4bbc29bbeef33f96f8411">yuv_format</a> != YUV420_NV12) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Incorrect YUV format: %d, should be %d!\n&quot;</span>, <a class="code hl_enumerationRef" target="_blank" href="../../../library/d7/d81/group__video-sharing-service-struct-group.html#ga96849c6a73d4bbc29bbeef33f96f8411">yuv_format</a>,</div>
<div class="line">            YUV420_NV12);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (frame_num == 0 || frame_num &lt; -1) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Incorrect frame number to be encoded: %d!\n&quot;</span>, frame_num);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset(&amp;query_info, 0, <span class="keyword">sizeof</span>(query_info));</div>
<div class="line">    query_info.<a id="a56" name="a56"></a><a class="code hl_variableRef" target="_blank" href="../../../library/db/d5e/structiav__queryinfo.html#a9c6b243764195cdf9bc3b73afab15e67">qid</a> = <a id="a57" name="a57"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a>;</div>
<div class="line">    stream_info = &amp;query_info.<a id="a58" name="a58"></a><a class="code hl_variableRef" target="_blank" href="../../../library/db/d5e/structiav__queryinfo.html#ade33181cf2ac4bf3f4c607b879c42b72">arg</a>.<a id="a59" name="a59"></a><a class="code hl_variableRef" target="_blank" href="../../../library/db/d5e/structiav__queryinfo.html#ad697b7616a385b827252c9eaf05c40cb">stream</a>;</div>
<div class="line">    stream_info-&gt;<a id="a60" name="a60"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/d08/structiav__stream__info.html#a76f8ba65ce8f902c0657233adee58698">id</a> = stream_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a61" name="a61"></a>IAV_IOC_QUERY_INFO, &amp;query_info);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> gdma_copy(<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* src, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> src_pitch, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* dst, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> dst_pitch,</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> height, <span class="keywordtype">int</span> ext_mem)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a62" name="_a62"></a><a class="code hl_structRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html">iav_gdma_copy</a> param = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ext_mem) {</div>
<div class="line">        param.<a id="a63" name="a63"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a97949d79559df32a6ff2d2b423b0be39">src_offset</a> = (<a id="a64" name="a64"></a><a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)(src - canvas_pool_phy_mem);</div>
<div class="line">        param.<a id="a65" name="a65"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a1c0b148c0d6c4ba4d318178fa7dd2557">src_mmap_type</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faaad312de47a183da5f2167b10c8c1e528">IAV_PART_CANVAS_POOL</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">/* Aligned to DSP physical base for GDMA copy */</span></div>
<div class="line">        param.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a97949d79559df32a6ff2d2b423b0be39">src_offset</a> = (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)(src - dsp_phy_mem);</div>
<div class="line">        param.<a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a1c0b148c0d6c4ba4d318178fa7dd2557">src_mmap_type</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa">IAV_PART_DSP</a>;</div>
<div class="line">    }</div>
<div class="line">    param.<a id="a66" name="a66"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5008710d9c1103d9591b3eda550b63f7">dst_offset</a> = (<a class="code hl_typedef" href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a>)(dst - (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)buf_mem_phy_addr);</div>
<div class="line">    param.<a id="a67" name="a67"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a0d0bde0d1958779c9220d9a5501b14e4">dst_mmap_type</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa9c6871121818aa47f659dea5f7b93f1a">IAV_PART_USR</a>;</div>
<div class="line"> </div>
<div class="line">    param.<a id="a68" name="a68"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a311c949c3fef26a92db0d704c9e7225c">src_pitch</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a311c949c3fef26a92db0d704c9e7225c">src_pitch</a>;</div>
<div class="line">    param.<a id="a69" name="a69"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a12669f6c0f6cc6c1e39ac929c91df9a1">dst_pitch</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a12669f6c0f6cc6c1e39ac929c91df9a1">dst_pitch</a>;</div>
<div class="line">    param.<a id="a70" name="a70"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5103232dda61eefd81b5b849643c5753">width</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#a5103232dda61eefd81b5b849643c5753">width</a>;</div>
<div class="line">    param.<a id="a71" name="a71"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d11/structiav__gdma__copy.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a72" name="a72"></a>IAV_IOC_GDMA_COPY, &amp;param);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> fill_efm_yuv_from_capture(<span class="keyword">struct</span> <a id="_a73" name="_a73"></a><a class="code hl_structRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> *desc, <span class="keyword">struct</span> efm_buf_info *efm_buf)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a74" name="_a74"></a><a class="code hl_structRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html">iav_yuv_cap</a> *yuv_src = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a75" name="_a75"></a><a class="code hl_structRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html">iav_me_cap</a> *me1_src = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html">iav_me_cap</a> *me0_src = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *src = NULL, *dest = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, <a id="a76" name="a76"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> = 0;</div>
<div class="line"> </div>
<div class="line">    yuv_src = &amp;desc-&gt;<a id="a77" name="a77"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a id="a78" name="a78"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a id="a79" name="a79"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#ad1847147a26fa6e714478a599d584f45">yuv</a>;</div>
<div class="line">    <span class="comment">// fill YUV luma</span></div>
<div class="line">    <span class="keywordflow">if</span> (mem_cpy_type == MEM_CPY_TYPE_GDMA) {</div>
<div class="line">        <span class="keywordflow">if</span> (from_ext_mem) {</div>
<div class="line">            src = canvas_pool_phy_mem + yuv_src-&gt;<a id="a80" name="a80"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a7ed2668fc9c18679b1a349a2f6914f3f">y_addr_offset</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            src = dsp_phy_mem + yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a7ed2668fc9c18679b1a349a2f6914f3f">y_addr_offset</a>;</div>
<div class="line">        }</div>
<div class="line">        dest = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;yuv_luma_phy_addr;</div>
<div class="line"> </div>
<div class="line">        gdma_copy(src, yuv_src-&gt;<a id="a81" name="a81"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, dest, efm_buf-&gt;yuv_pitch,</div>
<div class="line">            yuv_src-&gt;<a id="a82" name="a82"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>, yuv_src-&gt;<a id="a83" name="a83"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, from_ext_mem);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (from_ext_mem) {</div>
<div class="line">            src = canvas_pool_mem + yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a7ed2668fc9c18679b1a349a2f6914f3f">y_addr_offset</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            src = dsp_mem + yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a7ed2668fc9c18679b1a349a2f6914f3f">y_addr_offset</a>;</div>
<div class="line">        }</div>
<div class="line">        dest = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;yuv_luma_vir_addr;</div>
<div class="line">        if (efm_buf-&gt;yuv_pitch == yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>) {</div>
<div class="line">            memcpy(dest, src, yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">                memcpy(dest + i * efm_buf-&gt;yuv_pitch,</div>
<div class="line">                    src + i * yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// fill YUV chroma</span></div>
<div class="line">    <span class="keywordflow">if</span> (mem_cpy_type == MEM_CPY_TYPE_GDMA) {</div>
<div class="line">        <span class="keywordflow">if</span> (from_ext_mem) {</div>
<div class="line">            src = canvas_pool_phy_mem + yuv_src-&gt;<a id="a84" name="a84"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a4eb7b75b76c9314ccc6582b332fdfb9d">uv_addr_offset</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            src = dsp_phy_mem + yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a4eb7b75b76c9314ccc6582b332fdfb9d">uv_addr_offset</a>;</div>
<div class="line">        }</div>
<div class="line">        dest = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;yuv_chroma_phy_addr;</div>
<div class="line">        gdma_copy(src, yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, dest, efm_buf-&gt;yuv_pitch,</div>
<div class="line">            yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>, yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> &gt;&gt; 1, from_ext_mem);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (from_ext_mem) {</div>
<div class="line">            src = canvas_pool_mem + yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a4eb7b75b76c9314ccc6582b332fdfb9d">uv_addr_offset</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            src = dsp_mem + yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a4eb7b75b76c9314ccc6582b332fdfb9d">uv_addr_offset</a>;</div>
<div class="line">        }</div>
<div class="line">        dest = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;yuv_chroma_vir_addr;</div>
<div class="line">        if (efm_buf-&gt;yuv_pitch == yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>) {</div>
<div class="line">            memcpy(dest, src, yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> &gt;&gt; 1);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> = yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> &gt;&gt; 1;</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">                memcpy(dest + i * efm_buf-&gt;yuv_pitch,</div>
<div class="line">                    src + i * yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, yuv_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (stream_type != <a id="a85" name="a85"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ead2feabb75221806525afe5d4bc053431">IAV_STREAM_TYPE_MJPEG</a>) {</div>
<div class="line">        me1_src = &amp;desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a id="a86" name="a86"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a6174724560c4025946fb0498c0022a84">me1</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (me1_src-&gt;<a id="a87" name="a87"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a16f01e9ac75392f8e05471ead76a95ae">data_addr_offset</a> != 0 &amp;&amp; me1_src-&gt;<a id="a88" name="a88"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> != 0) {</div>
<div class="line">            <span class="comment">// fill me1</span></div>
<div class="line">            <span class="keywordflow">if</span> (mem_cpy_type == MEM_CPY_TYPE_GDMA) {</div>
<div class="line">                src = dsp_phy_mem + me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a16f01e9ac75392f8e05471ead76a95ae">data_addr_offset</a>;</div>
<div class="line">                dest = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;me1_phy_addr;</div>
<div class="line">                gdma_copy(src, me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, dest, efm_buf-&gt;me1_pitch,</div>
<div class="line">                    me1_src-&gt;<a id="a89" name="a89"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a85db88ffee2944ecd35c616393976289">width</a>, me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 0);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                src = dsp_mem + me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a16f01e9ac75392f8e05471ead76a95ae">data_addr_offset</a>;</div>
<div class="line">                dest = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;me1_vir_addr;</div>
<div class="line">                if (efm_buf-&gt;me1_pitch == me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>) {</div>
<div class="line">                    memcpy(dest, src, me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="keywordflow">for</span> (i = 0; i &lt; me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">                        memcpy(dest + i * efm_buf-&gt;me1_pitch,</div>
<div class="line">                            src + i * me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, me1_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a85db88ffee2944ecd35c616393976289">width</a>);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// generate me0</span></div>
<div class="line">        <span class="keywordflow">if</span> (use_me0) {</div>
<div class="line">            me0_src = &amp;desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a id="a90" name="a90"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a549b17e342b011260d718344bf31ea07">me0</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (mem_cpy_type == MEM_CPY_TYPE_GDMA) {</div>
<div class="line">                src = dsp_phy_mem + me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a16f01e9ac75392f8e05471ead76a95ae">data_addr_offset</a>;</div>
<div class="line">                dest = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;me0_phy_addr;</div>
<div class="line">                gdma_copy(src, me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, dest, efm_buf-&gt;me0_pitch,</div>
<div class="line">                    me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a85db88ffee2944ecd35c616393976289">width</a>, me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, 0);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                src = dsp_mem + me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a16f01e9ac75392f8e05471ead76a95ae">data_addr_offset</a>;</div>
<div class="line">                dest = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;me0_vir_addr;</div>
<div class="line">                if (efm_buf-&gt;me0_pitch == me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>) {</div>
<div class="line">                    memcpy(dest, src, me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="keywordflow">for</span> (i = 0; i &lt; me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">                        memcpy(dest + i * efm_buf-&gt;me0_pitch,</div>
<div class="line">                            src + i * me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, me0_src-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a85db88ffee2944ecd35c616393976289">width</a>);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> fill_yuv_from_file(<span class="keyword">struct</span> efm_buf_info *efm_buf)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *luma_addr = NULL, *chroma_addr = NULL, *me1_addr = NULL, *me0_addr = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> i = 0, j = 0, k = 0, <a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a> = 0, result = 0;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#a85db88ffee2944ecd35c616393976289">width</a> = 0, <a class="code hl_variableRef" target="_blank" href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a> = 0, height_align = 0, size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> width_me1 = 0, height_me1 = 0;</div>
<div class="line">    <span class="keywordtype">int</span> width_me0 = 0, height_me0 = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *start = NULL;</div>
<div class="line">    <span class="keyword">struct </span>timeval curr = {0};</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> <a id="a91" name="a91"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> loop_count = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> repeat_last_frame = 0;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">long</span> offset = 0;</div>
<div class="line">    <span class="keywordtype">int</span> fd_yuv = -1, fd_me1 = -1, fd_me0 = -1;</div>
<div class="line">    <span class="keywordtype">char</span> yuv_name_tmp[256] = {0};</div>
<div class="line">    <span class="keywordtype">char</span> me1_name_tmp[256] = {0};</div>
<div class="line">    <span class="keywordtype">char</span> me0_name_tmp[256] = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (single_input_flag) {</div>
<div class="line">        strcpy(yuv_name_tmp, yuv_name);</div>
<div class="line">        sprintf(me1_name_tmp, <span class="stringliteral">&quot;%s.me1&quot;</span>, yuv_name);</div>
<div class="line">        sprintf(me0_name_tmp, <span class="stringliteral">&quot;%s.me0&quot;</span>, yuv_name);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        sprintf(yuv_name_tmp, <span class="stringliteral">&quot;%s_%d.yuv&quot;</span>, yuv_name, fd_index_curr);</div>
<div class="line">        sprintf(me1_name_tmp, <span class="stringliteral">&quot;%s_%d.me1&quot;</span>, yuv_name, fd_index_curr);</div>
<div class="line">        sprintf(me0_name_tmp, <span class="stringliteral">&quot;%s_%d.me0&quot;</span>, yuv_name, fd_index_curr);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    fd_yuv = open(yuv_name_tmp, O_LARGEFILE | O_RDONLY);</div>
<div class="line">    <span class="keywordflow">if</span> (fd_yuv &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;YUV file name: \&quot;%s\&quot; not existed!\n&quot;</span>, yuv_name_tmp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    width = frame_size.width;</div>
<div class="line">    height = frame_size.height;</div>
<div class="line">    height_align = efm_buf-&gt;yuv_height;</div>
<div class="line">    width_me1 = (<a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(width, 4) &gt;&gt; 2);</div>
<div class="line">    height_me1 =(<a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(height, 4) &gt;&gt; 2);</div>
<div class="line">    width_me0 = (<a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(width, 8) &gt;&gt; 3);</div>
<div class="line">    height_me0 =(<a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(height, 8) &gt;&gt; 3);</div>
<div class="line">    size = width * height;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (repeat_last_frame) {</div>
<div class="line">        offset = 0 - (<span class="keywordtype">long</span> long)(size * 3 &gt;&gt; 1);</div>
<div class="line">        lseek(fd_yuv, offset, SEEK_END);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        offset = (<span class="keywordtype">long</span> long)(size * 3 &gt;&gt; 1) * <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div>
<div class="line">        lseek(fd_yuv, offset, SEEK_SET);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (verbose) {</div>
<div class="line">        gettimeofday(&amp;curr, NULL);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Before YUV: %u.%u!\n&quot;</span>, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>)curr.tv_sec, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>)curr.tv_usec);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    luma_addr = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;yuv_luma_vir_addr;</div>
<div class="line">    chroma_addr = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;yuv_chroma_vir_addr;</div>
<div class="line">    me1_addr = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;me1_vir_addr;</div>
<div class="line">    me0_addr = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *)efm_buf-&gt;me0_vir_addr;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (efm_buf-&gt;yuv_pitch == width) {</div>
<div class="line">        <span class="comment">// just copy to dest buffer when pitch is the same as width</span></div>
<div class="line">        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_yuv, luma_addr, size);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// copy to dest buffer line by line</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; height; i++) {</div>
<div class="line">            <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_yuv, luma_addr + i * efm_buf-&gt;yuv_pitch, width);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/*deal with luma aligned repeating lines*/</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = height; i &lt; height_align; i++ ) {</div>
<div class="line">        offset = 0 - (<span class="keywordtype">long</span> long)width;</div>
<div class="line">        lseek(fd_yuv, offset, SEEK_CUR);</div>
<div class="line">        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_yuv, luma_addr + i * efm_buf-&gt;yuv_pitch, width);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/*chroma*/</span></div>
<div class="line">    <span class="keywordflow">if</span> (efm_buf-&gt;yuv_pitch == width) {</div>
<div class="line">        size &gt;&gt;= 1;</div>
<div class="line">        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_yuv, chroma_addr, size);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; height / 2; i++) {</div>
<div class="line">            <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_yuv, chroma_addr + i * efm_buf-&gt;yuv_pitch, width);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/*deal with chroma aligned repeating lines*/</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = height / 2; i &lt; height_align / 2; i++) {</div>
<div class="line">        offset = 0 - (<span class="keywordtype">long</span> long)width;</div>
<div class="line">        lseek(fd_yuv, offset, SEEK_CUR);</div>
<div class="line">        <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_yuv, chroma_addr + i * efm_buf-&gt;yuv_pitch, width);</div>
<div class="line">    }</div>
<div class="line">    close(fd_yuv);</div>
<div class="line">    fd_yuv = -1;</div>
<div class="line">    <span class="keywordflow">if</span> (verbose) {</div>
<div class="line">        gettimeofday(&amp;curr, NULL);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Before ME1: %u.%u!\n&quot;</span>, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>)curr.tv_sec, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>)curr.tv_usec);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (me1_from_file == 0) {</div>
<div class="line">        <span class="comment">// generate me1 based on luma</span></div>
<div class="line">        pitch = efm_buf-&gt;yuv_pitch;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; efm_buf-&gt;me1_height; i++) {</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; efm_buf-&gt;me1_width; j++) {</div>
<div class="line">                result = 0;</div>
<div class="line">                start = luma_addr + i * 4 * pitch + j * 4;</div>
<div class="line">                <span class="keywordflow">for</span> (k = 0; k &lt; 4; k++) {</div>
<div class="line">                    result += start[k * pitch] + start[k * pitch + 1] +</div>
<div class="line">                        start[k * pitch + 2] + start[k * pitch + 3];</div>
<div class="line">                }</div>
<div class="line">                me1_addr[i * efm_buf-&gt;me1_pitch + j] = (result + 8) &gt;&gt; 4;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        fd_me1 = open(me1_name_tmp, O_LARGEFILE | O_RDONLY);</div>
<div class="line">        <span class="keywordflow">if</span> (fd_me1 &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;me1 file name: \&quot;%s\&quot; not existed!\n&quot;</span>, me1_name_tmp);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        size = width_me1 * height_me1;</div>
<div class="line">        <span class="keywordflow">if</span> (repeat_last_frame) {</div>
<div class="line">            offset = 0 - (<span class="keywordtype">long</span> long)size;</div>
<div class="line">            lseek(fd_me1, offset, SEEK_END);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            offset = (<span class="keywordtype">long</span> long)(size * count);</div>
<div class="line">            lseek(fd_me1, offset, SEEK_SET);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (efm_buf-&gt;me1_pitch == width_me1) {</div>
<div class="line">            <span class="comment">// just copy to dest buffer when pitch is the same as width</span></div>
<div class="line">            size = width_me1 * height_me1;</div>
<div class="line">            <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_me1, me1_addr, size);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">/* copy to dest buffer line by line */</span></div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; height_me1; i++) {</div>
<div class="line">                <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_me1, me1_addr + i * efm_buf-&gt;me1_pitch, width_me1);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/*deal with aligned lines*/</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = height_me1; i &lt; (height_align / 4); i++ ) {</div>
<div class="line">            offset = 0 - (<span class="keywordtype">long</span> long)width_me1;</div>
<div class="line">            lseek(fd_me1, offset, SEEK_CUR);</div>
<div class="line">            <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_me1, me1_addr + i * efm_buf-&gt;me1_pitch, width_me1);</div>
<div class="line">        }</div>
<div class="line">        close(fd_me1);</div>
<div class="line">        fd_me1 = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (use_me0) {</div>
<div class="line">        <span class="keywordflow">if</span> (me0_from_file == 0) {</div>
<div class="line">            <span class="comment">// generate me0 (1/8) based on me1 (1/4)</span></div>
<div class="line">            pitch = efm_buf-&gt;yuv_pitch;</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; efm_buf-&gt;me0_height; i++) {</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; efm_buf-&gt;me0_width; j++) {</div>
<div class="line">                    result = 0;</div>
<div class="line">                    start = me1_addr + i * 2 * pitch + j * 2;</div>
<div class="line">                    <span class="keywordflow">for</span> (k = 0; k &lt; 2; k++) {</div>
<div class="line">                        result += start[k * pitch] + start[k * pitch + 1];</div>
<div class="line">                    }</div>
<div class="line">                    me0_addr[i * efm_buf-&gt;me1_pitch + j] = (result + 2) &gt;&gt; 2;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            fd_me0 = open(me0_name_tmp, O_LARGEFILE | O_RDONLY);</div>
<div class="line">            <span class="keywordflow">if</span> (fd_me0 &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;me0 file name: \&quot;%s\&quot; not existed!\n&quot;</span>, me0_name_tmp);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            size = width_me0 * height_me0;</div>
<div class="line">            <span class="keywordflow">if</span> (repeat_last_frame) {</div>
<div class="line">                offset = 0 - (<span class="keywordtype">long</span> long)size;</div>
<div class="line">                lseek(fd_me0, offset, SEEK_END);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                offset = (<span class="keywordtype">long</span> long)(size * count);</div>
<div class="line">                lseek(fd_me0, offset, SEEK_SET);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (efm_buf-&gt;me0_pitch == width_me0) {</div>
<div class="line">                <span class="comment">// just copy to dest buffer when pitch is the same as width</span></div>
<div class="line">                size = width_me0 * height_me0;;</div>
<div class="line">                <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_me0, me0_addr, size);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">/* copy to dest buffer line by line */</span></div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; height_me0; i++) {</div>
<div class="line">                    <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_me0, me0_addr + i * efm_buf-&gt;me0_pitch, width_me0);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">/*deal with aligned lines*/</span></div>
<div class="line">            <span class="keywordflow">for</span> (i = height_me0; i &lt; height_align / 8; i++ ) {</div>
<div class="line">                offset = 0 - (<span class="keywordtype">long</span> long)width_me0;</div>
<div class="line">                lseek(fd_me0, offset, SEEK_CUR);</div>
<div class="line">                <a class="code hl_define" href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a>(fd_me0, me0_addr + i * efm_buf-&gt;me0_pitch, width_me0);</div>
<div class="line">            }</div>
<div class="line">            close(fd_me0);</div>
<div class="line">            fd_me0 = -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (verbose) {</div>
<div class="line">        gettimeofday(&amp;curr, NULL);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Done frame: %u.%u!\n&quot;</span>, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>)curr.tv_sec, (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>)curr.tv_usec);</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>++;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (count &gt;= file_frame_count[fd_index_curr]) {</div>
<div class="line">        <span class="keywordflow">if</span> (feed_type == FEED_REPEATE &amp;&amp; fd_index_curr == file_index_end) {</div>
<div class="line">            repeat_last_frame = 1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;</div>
<div class="line">            <span class="keywordflow">if</span> (fd_index_curr == file_index_end) {</div>
<div class="line">                fd_index_curr = file_index_start;</div>
<div class="line">                loop_count += 1;</div>
<div class="line">                printf(<span class="stringliteral">&quot;Has finished [%d] loop.\n&quot;</span>, loop_count);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fd_index_curr &lt; file_index_end &amp;&amp;</div>
<div class="line">                fd_index_curr &gt;= file_index_start) {</div>
<div class="line">                fd_index_curr++;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Unexpected fd_index [%d]!\n&quot;</span>, fd_index_curr);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> fill_yuv_frame(<span class="keyword">struct</span> efm_buf_info *efm_buf, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a>* pts, <span class="keywordtype">int</span> count)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> desc = {0};</div>
<div class="line">    <span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> pts_file = 0;</div>
<div class="line">    <span class="keyword">struct </span>timeval start_time = {0};</div>
<div class="line">    <span class="keyword">struct </span>timeval end_time = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> time_intvl_us = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (type == EFM_TYPE_YUV_CAPTURE) {</div>
<div class="line">        memset(&amp;desc, 0, <span class="keyword">sizeof</span>(desc));</div>
<div class="line">        desc.<a id="a92" name="a92"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#aa73b12ace6ac7df824707a89ac4f91ff">qid</a> = <a id="a93" name="a93"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a>;</div>
<div class="line">        desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a id="a94" name="a94"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a> = canvas_id;</div>
<div class="line">        desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a id="a95" name="a95"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a0d4d0a98d64cba20aaf8e4fc5735c6ba">is_dsp_hw_pts</a> = 1;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a96" name="a96"></a>IAV_IOC_QUERY_DESC, &amp;desc);</div>
<div class="line">        gettimeofday(&amp;start_time, NULL);</div>
<div class="line"> </div>
<div class="line">        fill_efm_yuv_from_capture(&amp;desc, efm_buf);</div>
<div class="line">        gettimeofday(&amp;end_time, NULL);</div>
<div class="line">        <span class="keywordflow">if</span> (verbose) {</div>
<div class="line">            time_intvl_us = (end_time.tv_sec - start_time.tv_sec) * 1000000 +</div>
<div class="line">                end_time.tv_usec - start_time.tv_usec;</div>
<div class="line">            printf(<span class="stringliteral">&quot;copy frame %d consume %u us,&quot;</span>, count, time_intvl_us);</div>
<div class="line">        }</div>
<div class="line">        *pts = desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#ad1847147a26fa6e714478a599d584f45">yuv</a>.<a id="a97" name="a97"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a86aaeaa289cbe23f062a634e9f6f06c2">mono_pts</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        fill_yuv_from_file(efm_buf);</div>
<div class="line">        *pts = pts_file;</div>
<div class="line">        pts_file += <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a1fb0b57da8f35f1c47328e737e14b99d">PTS_CLK</a> / frame_rate;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> feed_yuv_loop(<span class="keyword">struct</span> efm_usr_cfg *cfg, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> stream_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>efm_buf_info req_buf;</div>
<div class="line">    <span class="keyword">struct </span>efm_feed_cfg feed_cfg;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> frame_pts = 0;</div>
<div class="line">    <span class="keyword">struct </span>timeval pre = {0, 0}, curr = {0, 0};</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> delta_us = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (map_buf_for_yuv() &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to map buf for yuv!\n&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">return</span> rval;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    fd_index_curr = file_index_start;</div>
<div class="line">    sem_init(&amp;sem, 0, 0);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;START feeding YUV frames:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span>(!exit_efm) {</div>
<div class="line">        <span class="keywordflow">if</span> (count &gt;= frame_num &amp;&amp; frame_num != -1) {</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;  Feed frame %8u:\t&quot;</span>, count);</div>
<div class="line">        memset(&amp;req_buf, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> efm_buf_info));</div>
<div class="line">        req_buf.stream_id = stream_id;</div>
<div class="line">        rval = efm_get_buf(&amp;req_buf);</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (rval == EFM_EINVALID_STREAM_STATE) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Get: wait sem to wake up\n&quot;</span>);</div>
<div class="line">                sem_wait(&amp;sem);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Get efm buf failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        fill_yuv_frame(&amp;req_buf, &amp;frame_pts, count);</div>
<div class="line"> </div>
<div class="line">        memset(&amp;feed_cfg, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> efm_feed_cfg));</div>
<div class="line">        feed_cfg.pts = frame_pts;</div>
<div class="line"> </div>
<div class="line">        gettimeofday(&amp;curr, NULL);</div>
<div class="line">        delta_us = (curr.tv_sec - pre.tv_sec) * 1000000UL + curr.tv_usec - pre.tv_usec;</div>
<div class="line">        if (delta_us &lt; 1000000UL / frame_rate) {</div>
<div class="line">            delta_us = 1000000UL / frame_rate - delta_us;</div>
<div class="line">            usleep(delta_us);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        rval = efm_feed_buf(&amp;req_buf, &amp;feed_cfg);</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (rval == EFM_EINVALID_STREAM_STATE) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Feed: wait sem to wake up\n&quot;</span>);</div>
<div class="line">                sem_wait(&amp;sem);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Feed efm buf failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        gettimeofday(&amp;pre, NULL);</div>
<div class="line">        printf(<span class="stringliteral">&quot;  Handshake frame %3u, done!\n&quot;</span>, count);</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>++;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> get_audio_clock(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define CLOCK_BUF_LEN   (4096)</span></div>
<div class="line">    <span class="keywordtype">char</span> *clock_buf = NULL, *clock_ptr = NULL, *end_ptr = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> audio_clock = 12288000; <span class="comment">// default to 12.288MHz</span></div>
<div class="line">    <span class="keywordtype">int</span> fd_proc = -1;</div>
<div class="line"> </div>
<div class="line">    fd_proc = open(<span class="stringliteral">&quot;/proc/ambarella/clock&quot;</span>, O_RDONLY);</div>
<div class="line">    <span class="keywordflow">if</span> (fd_proc &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to open /proc/ambarella/clock!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> GET_AUDIO_CLOCK_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    lseek(fd_proc, 0L, SEEK_SET);</div>
<div class="line">    clock_buf = malloc(CLOCK_BUF_LEN);</div>
<div class="line">    <span class="keywordflow">if</span> (read(fd_proc, clock_buf, CLOCK_BUF_LEN) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;read error.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> GET_AUDIO_CLOCK_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    clock_ptr = strstr(clock_buf, <span class="stringliteral">&quot;gclk_audio:&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (clock_ptr == NULL) {</div>
<div class="line">        <span class="keywordflow">goto</span> GET_AUDIO_CLOCK_EXIT;</div>
<div class="line">    }</div>
<div class="line">    clock_ptr += strlen(<span class="stringliteral">&quot;gclk_audio:&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    audio_clock = strtol(clock_ptr, &amp;end_ptr, 10);</div>
<div class="line"> </div>
<div class="line">GET_AUDIO_CLOCK_EXIT:</div>
<div class="line">    <span class="keywordflow">if</span> (fd_proc &gt;= 0) {</div>
<div class="line">        close(fd_proc);</div>
<div class="line">        fd_proc = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (clock_buf) {</div>
<div class="line">        free(clock_buf);</div>
<div class="line">        clock_buf = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> audio_clock;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_efr_cfgs()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a98" name="_a98"></a><a class="code hl_structRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a> resource = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a99" name="_a99"></a><a class="code hl_structRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> chan_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a100" name="_a100"></a><a class="code hl_structRef" target="_blank" href="../../../library/d2/ddf/structvindev__devinfo.html">vindev_devinfo</a> <a id="a101" name="a101"></a><a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a9e94358557fef0c4eeaca8d310d22ae9">vin_info</a> = {0};</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> state = 0, i = 0;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a102" name="a102"></a>IAV_IOC_GET_IAV_STATE, &amp;state);</div>
<div class="line">    <span class="keywordflow">if</span> ((state != <a id="a103" name="a103"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggafc7fb94a411b7cedcb91492097fdb928a24f1c67d4886473779ceba84546aa9f4">IAV_STATE_PREVIEW</a>) &amp;&amp;</div>
<div class="line">        (state != <a id="a104" name="a104"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggafc7fb94a411b7cedcb91492097fdb928a3f68c2db148568fb9fa0af2f4ca2fa38">IAV_STATE_ENCODING</a>)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;IAV state should be Preview/Encode for EFM!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset(&amp;resource, 0, <span class="keyword">sizeof</span>(resource));</div>
<div class="line">    resource.<a id="a105" name="a105"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#ab16f548b2c418aee70c310a931fdfab1">encode_mode</a> = <a id="a106" name="a106"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a107" name="a107"></a>IAV_IOC_GET_SYSTEM_RESOURCE, &amp;resource);</div>
<div class="line">    <span class="keywordflow">if</span> (!resource.<a id="a108" name="a108"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#a035a9d1a4c2696cdc5944e537e3b049e">enc_raw_yuv</a> &amp;&amp; !resource.<a id="a109" name="a109"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#a8818e6e6ff702b046f2647b4e013dba1">enc_raw_rgb</a> &amp;&amp; !resource.<a id="a110" name="a110"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#a2c47e2f21d864f674304b03836972be4">enc_raw_nv12</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Enc from raw is not enabled, please enable it in test_encode!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; resource.<a id="a111" name="a111"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#a42f03995f03acd4c0dc2a174cadb648d">chan_num</a>; i++) {</div>
<div class="line">        chan_cfg.<a id="a112" name="a112"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a85599fa0eac7165aaca13aa21f0e6b38">chan_id</a> = i;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a113" name="a113"></a>IAV_IOC_GET_CHAN_CONFIG, &amp;chan_cfg);</div>
<div class="line">        <span class="keywordflow">if</span> (!<a id="a114" name="a114"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/ddf/structvindev__devinfo.html#a46b71fcd4a1b1b6b2f60e9ea79030a6d">vinc_id</a>) {</div>
<div class="line">            <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a9e94358557fef0c4eeaca8d310d22ae9">vin_info</a>.vsrc_id = chan_cfg.<a id="a115" name="a115"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a>;</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a116" name="a116"></a>IAV_IOC_VIN_GET_DEVINFO, &amp;<a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a9e94358557fef0c4eeaca8d310d22ae9">vin_info</a>);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a9e94358557fef0c4eeaca8d310d22ae9">vin_info</a>.vinc_id &gt;= IAV_MAX_REAL_VIN_NUM) {</div>
<div class="line">                <a class="code hl_variableRef" target="_blank" href="../../../library/d2/ddf/structvindev__devinfo.html#a46b71fcd4a1b1b6b2f60e9ea79030a6d">vinc_id</a> = <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a9e94358557fef0c4eeaca8d310d22ae9">vin_info</a>.vinc_id;</div>
<div class="line">                printf(<span class="stringliteral">&quot;Didn&#39;t specify the vinc_id. Used the vinc %d as default!\n&quot;</span>, <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a9e94358557fef0c4eeaca8d310d22ae9">vin_info</a>.vinc_id);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> prepare_raw_params(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>stat statbuff = {0};</div>
<div class="line">    <span class="keywordtype">char</span> raw_name_tmp[256] = {0};</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, fd_raw = -1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> single_size = 0, single_ce_size = 0, frame_num_per_loop = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> total_size = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!frame_size.width || !frame_size.height) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Incorrect frame size %ux%u!\n&quot;</span>,</div>
<div class="line">            frame_size.width, frame_size.height);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (file_index_start == -1) {</div>
<div class="line">        file_index_start = 0;</div>
<div class="line">        file_index_end = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (file_index_start == file_index_end) {</div>
<div class="line">        single_input_flag = 1;</div>
<div class="line">    }</div>
<div class="line">    fd_index_curr = file_index_start;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = file_index_start; i &lt;= file_index_end; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (single_input_flag == 1) {</div>
<div class="line">            strcpy(raw_name_tmp, raw_name);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            sprintf(raw_name_tmp, <span class="stringliteral">&quot;%s_%d.raw&quot;</span>, raw_name, i);</div>
<div class="line">        }</div>
<div class="line">        fd_raw = open(raw_name_tmp, O_LARGEFILE | O_RDONLY);</div>
<div class="line">        <span class="keywordflow">if</span> (fd_raw &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RAW file name: \&quot;%s\&quot; not existed!\n&quot;</span>, raw_name_tmp);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (type == EFM_TYPE_RAW_NV12) {</div>
<div class="line">            single_size = frame_size.width * frame_size.height * 3 / 2;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (raw_format == RAW_FORMAT_UNCOMPRESSED) {</div>
<div class="line">                single_size = frame_size.width * frame_size.height * 2;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                single_size = frame_size.width * frame_size.height;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (fstat(fd_raw, &amp;statbuff) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;fstat&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        total_size = statbuff.st_size;</div>
<div class="line">        close(fd_raw);</div>
<div class="line">        fd_raw = -1;</div>
<div class="line">        file_frame_count[i] = total_size / single_size;</div>
<div class="line">        frame_num_per_loop += file_frame_count[i];</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (frame_num == -1 &amp;&amp; feed_type != FEED_REPEATE) {</div>
<div class="line">        frame_num = frame_num_per_loop * loop_num;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (frame_rate == -1) {</div>
<div class="line">        frame_rate = 30;</div>
<div class="line">        printf(<span class="stringliteral">&quot;Use frame rate %d as default, if no speficied!\n&quot;</span>, frame_rate);</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (frame_rate == 0 || <a class="code hl_define" href="../../d6/d56/iav__utils_8h.html#a1fb0b57da8f35f1c47328e737e14b99d">PTS_CLK</a> % frame_rate){</div>
<div class="line">        printf(<span class="stringliteral">&quot;Incorrect frame rate %d!\n&quot;</span>, frame_rate);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    sem_init(&amp;read_sem, 0, 0);</div>
<div class="line">    sem_init(&amp;write_sem, 0, 1);</div>
<div class="line">    audio_clock = get_audio_clock();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (type) {</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_YUV:</div>
<div class="line">        single_size = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, <a id="a117" name="a117"></a>IAV_DSP_BUF_PITCH_ALIGN) * frame_size.height * 2;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_NV12:</div>
<div class="line">        single_size = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, IAV_DSP_BUF_PITCH_ALIGN) * frame_size.height * 3 / 2;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_RGB:</div>
<div class="line">        <span class="keywordflow">if</span> (raw_format == RAW_FORMAT_UNCOMPRESSED) {</div>
<div class="line">            single_size = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, IAV_DSP_BUF_PITCH_ALIGN) * frame_size.height * 2;</div>
<div class="line">            single_ce_size = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width &gt;&gt; 2, IAV_DSP_BUF_PITCH_ALIGN) * frame_size.height * 2;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            single_size = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, IAV_DSP_BUF_PITCH_ALIGN) * frame_size.height;</div>
<div class="line">            single_ce_size = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width &gt;&gt; 2, IAV_DSP_BUF_PITCH_ALIGN) * frame_size.height;</div>
<div class="line">        }</div>
<div class="line">        single_size += single_ce_size;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        printf(<span class="stringliteral">&quot;Incorrect EFM type %d for RAW!\n&quot;</span>, type);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (alloc_buf_for_raw(single_size * RAW_BUF_NUM) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    single_buf_size = total_buf_size / RAW_BUF_NUM;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> prepare_fixed_rgb_pattern(<span class="keywordtype">int</span> fd_raw, <span class="keywordtype">int</span> fd_ce, <span class="keyword">struct</span> <a class="code hl_struct" href="../../dc/d76/structiav__window.html">iav_window</a> *win)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *src_addr = NULL, *dst_addr = NULL, *buf_addr = buf_mem;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, j = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rgb_line_size = 0, ce_line_size = 0, pitch = 0, ce_pitch = 0, ret = 0, raw_size = 0, ce_size = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* pattern: origin, vflip, hflip, vflip | hflip */</span></div>
<div class="line">    <span class="keywordflow">if</span> (fd_raw &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Image should open first.\n&quot;</span>);</div>
<div class="line">        ret = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> PREPARE_FIXED_RGB_PATTERN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 1. origin */</span></div>
<div class="line">    rgb_line_size = win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> &lt;&lt; 1;</div>
<div class="line">    pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(rgb_line_size, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">    dst_addr = buf_mem;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* rgb */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (read(fd_raw, dst_addr, rgb_line_size) != rgb_line_size) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Read frame_size.width %d failed!\n&quot;</span>, rgb_line_size);</div>
<div class="line">        }</div>
<div class="line">        dst_addr += pitch;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ce */</span></div>
<div class="line">    ce_line_size = win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> &gt;&gt; 1;</div>
<div class="line">    ce_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(pitch &gt;&gt; 2, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">    src_addr = buf_mem;</div>
<div class="line">    raw_size = pitch * win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    ce_size = ce_pitch * win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    dst_addr = buf_mem + raw_size * RAW_BUF_NUM;</div>
<div class="line">    <span class="keywordflow">if</span> (fd_ce &gt; 0) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (read(fd_ce, dst_addr, ce_line_size) != ce_line_size) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Read frame_size.width %d failed!\n&quot;</span>, ce_line_size);</div>
<div class="line">            }</div>
<div class="line">            dst_addr += ce_pitch;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; rgb_line_size &gt;&gt; 2; j++) {</div>
<div class="line">                dst_addr[j] = *(src_addr + 4 * j);</div>
<div class="line">                dst_addr[j + 1] = *(src_addr + 4 * j + 1);</div>
<div class="line">            }</div>
<div class="line">            dst_addr += ce_pitch;</div>
<div class="line">            src_addr += pitch;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 2. vflip */</span></div>
<div class="line">    <span class="comment">/* rgb */</span></div>
<div class="line">    buf_addr += raw_size;</div>
<div class="line">    src_addr = buf_mem;</div>
<div class="line">    dst_addr = buf_addr + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> - 1) * pitch;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        memcpy(dst_addr, src_addr, pitch);</div>
<div class="line">        dst_addr -= pitch;</div>
<div class="line">        src_addr += pitch;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* ce */</span></div>
<div class="line">    src_addr = buf_mem + raw_size * RAW_BUF_NUM;</div>
<div class="line">    dst_addr = buf_mem + raw_size * RAW_BUF_NUM + ce_size + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> - 1) * ce_pitch;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        memcpy(dst_addr, src_addr, ce_pitch);</div>
<div class="line">        dst_addr -= ce_pitch;</div>
<div class="line">        src_addr += ce_pitch;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 3. hflip */</span></div>
<div class="line">    <span class="comment">/* rgb */</span></div>
<div class="line">    buf_addr += raw_size;</div>
<div class="line">    src_addr = buf_mem;</div>
<div class="line">    dst_addr = buf_addr;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; (rgb_line_size &gt;&gt; 1); j++) {</div>
<div class="line">            *(dst_addr + (rgb_line_size - j * 2 - 2)) = *(src_addr + j * 2);</div>
<div class="line">            *(dst_addr + (rgb_line_size - j * 2 - 1)) = *(src_addr + j * 2 + 1);</div>
<div class="line">        }</div>
<div class="line">        src_addr += pitch;</div>
<div class="line">        dst_addr += pitch;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* ce */</span></div>
<div class="line">    src_addr = buf_mem + raw_size * RAW_BUF_NUM;</div>
<div class="line">    dst_addr = buf_mem + raw_size * RAW_BUF_NUM + ce_size * 2;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; (ce_line_size &gt;&gt; 1); j++) {</div>
<div class="line">            *(dst_addr + (ce_line_size - j * 2 - 2)) = *(src_addr + j * 2);</div>
<div class="line">            *(dst_addr + (ce_line_size - j * 2 - 1)) = *(src_addr + j * 2 + 1);</div>
<div class="line">        }</div>
<div class="line">        src_addr += ce_pitch;</div>
<div class="line">        dst_addr += ce_pitch;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 4. hflip | vflip */</span></div>
<div class="line">    <span class="comment">/* luma */</span></div>
<div class="line">    buf_addr += raw_size;</div>
<div class="line">    src_addr = buf_mem;</div>
<div class="line">    dst_addr = buf_addr + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> - 1) * pitch;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; (rgb_line_size &gt;&gt; 1); j++) {</div>
<div class="line">            *(dst_addr + (rgb_line_size - j * 2 - 2)) = *(src_addr + j * 2);</div>
<div class="line">            *(dst_addr + (rgb_line_size - j * 2 - 1)) = *(src_addr + j * 2 + 1);</div>
<div class="line">        }</div>
<div class="line">        dst_addr -= pitch;</div>
<div class="line">        src_addr += pitch;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* ce */</span></div>
<div class="line">    src_addr = buf_mem + raw_size * RAW_BUF_NUM;</div>
<div class="line">    dst_addr = buf_mem + raw_size * RAW_BUF_NUM + ce_size * 3 + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> - 1) * ce_pitch;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; (ce_line_size &gt;&gt; 1); j++) {</div>
<div class="line">            *(dst_addr + (ce_line_size - j * 2 - 2)) = *(src_addr + j * 2);</div>
<div class="line">            *(dst_addr + (ce_line_size - j * 2 - 1)) = *(src_addr + j * 2 + 1);</div>
<div class="line">        }</div>
<div class="line">        dst_addr -= ce_pitch;</div>
<div class="line">        src_addr += ce_pitch;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 5. hflip */</span></div>
<div class="line">    buf_addr += raw_size;</div>
<div class="line">    src_addr = buf_mem + raw_size * 2;</div>
<div class="line">    dst_addr = buf_addr;</div>
<div class="line">    memcpy(dst_addr, src_addr, raw_size);</div>
<div class="line">    <span class="comment">/* ce */</span></div>
<div class="line">    src_addr = buf_mem + raw_size * RAW_BUF_NUM + ce_size * 2;</div>
<div class="line">    dst_addr = buf_mem + raw_size * RAW_BUF_NUM + ce_size * 4;</div>
<div class="line">    memcpy(dst_addr, src_addr, ce_size);</div>
<div class="line"> </div>
<div class="line">PREPARE_FIXED_RGB_PATTERN_EXIT:</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> prepare_fixed_yuv422_pattern(<span class="keywordtype">int</span> fd_raw, <span class="keyword">struct</span> <a class="code hl_struct" href="../../dc/d76/structiav__window.html">iav_window</a> *win)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *src_addr = NULL, *dst_addr = NULL, *buf_addr = buf_mem;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0, j = 0;</div>
<div class="line">    <span class="keywordtype">int</span> pitch = 0, ret = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* pattern: origin, vflip, hflip, vflip | hflip */</span></div>
<div class="line">    <span class="keywordflow">if</span> (fd_raw &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Image should open first.\n&quot;</span>);</div>
<div class="line">        ret = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> PREPARE_FIXED_YUV422_PATTERN_EXIT;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* 1. origin */</span></div>
<div class="line">    pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">    dst_addr = buf_mem;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> &lt;&lt; 1); i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (read(fd_raw, dst_addr, win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>) != win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Read frame_size.width %d failed!\n&quot;</span>, win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>);</div>
<div class="line">        }</div>
<div class="line">        dst_addr += pitch;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 2. vflip */</span></div>
<div class="line">    <span class="comment">/* luma */</span></div>
<div class="line">    buf_addr += single_buf_size;</div>
<div class="line">    src_addr = buf_mem;</div>
<div class="line">    dst_addr = buf_addr + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> - 1) * pitch;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        memcpy(dst_addr, src_addr, pitch);</div>
<div class="line">        dst_addr -= pitch;</div>
<div class="line">        src_addr += pitch;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* chroma */</span></div>
<div class="line">    src_addr = buf_mem + pitch * win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    dst_addr = buf_addr + pitch * ((win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> &lt;&lt; 1) - 1);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        memcpy(dst_addr, src_addr, pitch);</div>
<div class="line">        dst_addr -= pitch;</div>
<div class="line">        src_addr += pitch;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 3. hflip */</span></div>
<div class="line">    <span class="comment">/* luma */</span></div>
<div class="line">    buf_addr += single_buf_size;</div>
<div class="line">    src_addr = buf_mem;</div>
<div class="line">    dst_addr = buf_addr;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>; j++) {</div>
<div class="line">            *(dst_addr + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> - j - 1)) = *(src_addr + j);</div>
<div class="line">        }</div>
<div class="line">        src_addr += pitch;</div>
<div class="line">        dst_addr += pitch;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* chroma */</span></div>
<div class="line">    src_addr = buf_mem + pitch * win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    dst_addr = buf_addr + pitch * win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>; j++) {</div>
<div class="line">            *(dst_addr + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> - j - 1)) = *(src_addr + j);</div>
<div class="line">        }</div>
<div class="line">        src_addr += pitch;</div>
<div class="line">        dst_addr += pitch;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 4. hflip | vflip */</span></div>
<div class="line">    <span class="comment">/* luma */</span></div>
<div class="line">    buf_addr += single_buf_size;</div>
<div class="line">    src_addr = buf_mem;</div>
<div class="line">    dst_addr = buf_addr + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> - 1) * pitch;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>; j++) {</div>
<div class="line">            *(dst_addr + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> - j - 1)) = *(src_addr + j);</div>
<div class="line">        }</div>
<div class="line">        dst_addr -= pitch;</div>
<div class="line">        src_addr += pitch;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* chroma */</span></div>
<div class="line">    src_addr = buf_mem + pitch * win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">    dst_addr = buf_addr + pitch * ((win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a> &lt;&lt; 1) - 1);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">height</a>; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a>; j++) {</div>
<div class="line">            *(dst_addr + (win-&gt;<a class="code hl_variable" href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">width</a> - j - 1)) = *(src_addr + j);</div>
<div class="line">        }</div>
<div class="line">        dst_addr -= pitch;</div>
<div class="line">        src_addr += pitch;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 5. hflip */</span></div>
<div class="line">    buf_addr += single_buf_size;</div>
<div class="line">    src_addr = buf_mem + single_buf_size * 2;</div>
<div class="line">    dst_addr = buf_addr;</div>
<div class="line">    memcpy(dst_addr, src_addr, single_buf_size);</div>
<div class="line"> </div>
<div class="line">PREPARE_FIXED_YUV422_PATTERN_EXIT:</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> exit_raw_loop(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (raw_thread_id != 0) {</div>
<div class="line">        <span class="comment">/* unblock thread sem */</span></div>
<div class="line">        sem_post(&amp;write_sem);</div>
<div class="line">        pthread_join(raw_thread_id, NULL);</div>
<div class="line">        raw_thread_id = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> fill_raw_thread(<span class="keywordtype">void</span>* args)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> i = 0, j = 0, k = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> raw_pitch = 0, hdec_pitch = 0, line_size = 0, hdec_line_size =0, chroma_height = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> single_size = 0, single_rgb_size = 0, single_yuv_size = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> single_hdec_size = 0, single_input_frame_size = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> *addr = NULL, *hdec_addr = NULL, *rgb_addr = NULL;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0, batch_count = 0, tmp_count = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> *rgb_ptr = NULL, *hds_ptr = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> loop_count = 0;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">long</span> offset = 0;</div>
<div class="line">    <span class="keywordtype">int</span> fd_raw = -1;</div>
<div class="line">    <span class="keywordtype">int</span> raw_ce_fd = -1;</div>
<div class="line">    <span class="keywordtype">char</span> raw_name_tmp[256];</div>
<div class="line">    <span class="keywordtype">char</span> raw_ce_name_tmp[256];</div>
<div class="line">    <span class="keywordtype">int</span> fd_index_pre = -1;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> frame_count_curr = 0;</div>
<div class="line">    <span class="keywordtype">int</span> repeat_last_frame = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> raw_buf_wr_idx = 0;</div>
<div class="line">    <span class="keywordtype">int</span> gen_pattern_done = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!exit_efm) {</div>
<div class="line">        <span class="keywordflow">if</span> (fd_index_pre == -1 || fd_index_pre != fd_index_curr) {</div>
<div class="line">            fd_index_pre = fd_index_curr;</div>
<div class="line">            <span class="keywordflow">if</span> (fd_raw &lt; 0) {</div>
<div class="line">                <span class="keywordflow">if</span> (single_input_flag) {</div>
<div class="line">                    strcpy(raw_name_tmp, raw_name);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    sprintf(raw_name_tmp, <span class="stringliteral">&quot;%s_%d.raw&quot;</span>, raw_name, fd_index_curr);</div>
<div class="line">                }</div>
<div class="line">                fd_raw = open(raw_name_tmp, O_LARGEFILE | O_RDONLY);</div>
<div class="line">                <span class="keywordflow">if</span> (fd_raw &lt; 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;RAW file name: \&quot;%s\&quot; not existed!\n&quot;</span>, raw_name_tmp);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (raw_ce_from_file) {</div>
<div class="line">                <span class="keywordflow">if</span> (raw_ce_fd &lt; 0) {</div>
<div class="line">                    <span class="keywordflow">if</span> (single_input_flag) {</div>
<div class="line">                        strcpy(raw_ce_name_tmp, raw_ce_name);</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        sprintf(raw_ce_name_tmp, <span class="stringliteral">&quot;%s_%d.raw&quot;</span>, raw_ce_name, fd_index_curr);</div>
<div class="line">                    }</div>
<div class="line">                    raw_ce_fd = open(raw_ce_name_tmp, O_LARGEFILE | O_RDONLY);</div>
<div class="line">                    <span class="keywordflow">if</span> (raw_ce_fd &lt; 0) {</div>
<div class="line">                        printf(<span class="stringliteral">&quot;RAW file name: \&quot;%s\&quot; not existed!\n&quot;</span>, raw_ce_name_tmp);</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        sem_wait(&amp;write_sem);</div>
<div class="line">        <span class="keywordflow">if</span> (tmp_count + raw_batch_num &gt;= file_frame_count[fd_index_curr]) {</div>
<div class="line">            batch_count = file_frame_count[fd_index_curr] % raw_batch_num;</div>
<div class="line">            batch_count = (batch_count == 0) ? 1 : batch_count;</div>
<div class="line">            tmp_count = 0;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            batch_count = raw_batch_num;</div>
<div class="line">            tmp_count += batch_count;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ((frame_num - count) &lt; batch_count) {</div>
<div class="line">            batch_count = frame_num - <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (use_fixed_pattern) {</div>
<div class="line">            <span class="keywordflow">if</span> (gen_pattern_done == 0) {</div>
<div class="line">                <span class="keywordflow">if</span> (type == EFM_TYPE_RAW_RGB) {</div>
<div class="line">                    prepare_fixed_rgb_pattern(fd_raw, raw_ce_fd, &amp;frame_size);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    prepare_fixed_yuv422_pattern(fd_raw, &amp;frame_size);</div>
<div class="line">                }</div>
<div class="line">                gen_pattern_done = 1;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (type == EFM_TYPE_RAW_RGB) {</div>
<div class="line">                <span class="keywordflow">if</span> (raw_format == RAW_FORMAT_UNCOMPRESSED) {</div>
<div class="line">                    line_size = frame_size.width &lt;&lt; 1;</div>
<div class="line">                    raw_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(line_size, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">                    <span class="keywordflow">if</span> (ce_size.width) {</div>
<div class="line">                        hdec_line_size = ce_size.width &lt;&lt; 1;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        hdec_line_size = line_size &gt;&gt; 2;</div>
<div class="line">                    }</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    line_size = frame_size.width;</div>
<div class="line">                    raw_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(line_size, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">                    <span class="keywordflow">if</span> (ce_size.width) {</div>
<div class="line">                        hdec_line_size = ce_size.width;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        hdec_line_size = line_size &gt;&gt; 2;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                hdec_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(hdec_line_size, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">                single_rgb_size = raw_pitch * frame_size.height;</div>
<div class="line">                <span class="keywordflow">for</span> (i = 0; i &lt; batch_count; i++) {</div>
<div class="line">                    <span class="keywordflow">if</span> (raw_pitch == line_size) {</div>
<div class="line">                        addr = buf_mem + (raw_buf_wr_idx + i) * single_rgb_size;</div>
<div class="line">                        <span class="keywordflow">if</span> (repeat_last_frame) {</div>
<div class="line">                            offset = 0 - (<span class="keywordtype">long</span> long)single_rgb_size;</div>
<div class="line">                            lseek(fd_raw, offset, SEEK_CUR);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> (read(fd_raw, addr, single_rgb_size) != single_rgb_size) {</div>
<div class="line">                            printf(<span class="stringliteral">&quot;Read single_rgb_size %d failed!\n&quot;</span>, single_rgb_size);</div>
<div class="line">                        }</div>
<div class="line">                        rgb_addr = addr;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="comment">// read line by line for Bayer pattern RGB raw</span></div>
<div class="line">                        addr = buf_mem + (raw_buf_wr_idx + i) * single_rgb_size;</div>
<div class="line">                        <span class="keywordflow">if</span> (repeat_last_frame) {</div>
<div class="line">                            offset = 0 - (<span class="keywordtype">long</span> long)(line_size * frame_size.height);</div>
<div class="line">                            lseek(fd_raw, offset, SEEK_CUR);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">for</span> (j = 0; j &lt; frame_size.height; j++) {</div>
<div class="line">                            <span class="keywordflow">if</span> (read(fd_raw, addr, line_size) != line_size) {</div>
<div class="line">                                printf(<span class="stringliteral">&quot;Read line_size %d failed!\n&quot;</span>, line_size);</div>
<div class="line">                            }</div>
<div class="line">                            addr += raw_pitch;</div>
<div class="line">                        }</div>
<div class="line">                        rgb_addr = addr - single_rgb_size;</div>
<div class="line">                    }</div>
<div class="line">                    single_hdec_size = hdec_pitch * frame_size.height;</div>
<div class="line">                    hdec_addr = buf_mem + (raw_buf_wr_idx + i) * single_hdec_size +</div>
<div class="line">                        RAW_BUF_NUM * single_rgb_size;</div>
<div class="line">                    <span class="keywordflow">if</span> (hdec_pitch == hdec_line_size) {</div>
<div class="line">                        <span class="keywordflow">if</span> (raw_ce_from_file) {</div>
<div class="line">                            <span class="keywordflow">if</span> (repeat_last_frame) {</div>
<div class="line">                                offset = 0 - (<span class="keywordtype">long</span> long)single_hdec_size;</div>
<div class="line">                                lseek(raw_ce_fd, offset, SEEK_CUR);</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">if</span> (read(raw_ce_fd, hdec_addr, single_hdec_size) != single_hdec_size) {</div>
<div class="line">                                printf(<span class="stringliteral">&quot;Read single_hdec_size %d failed!\n&quot;</span>, single_hdec_size);</div>
<div class="line">                            }</div>
<div class="line">                        } <span class="keywordflow">else</span> {</div>
<div class="line">                            <span class="keywordflow">for</span> (j = 0; j &lt; frame_size.height; j++) {</div>
<div class="line">                                hds_ptr = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> *)(hdec_addr + j * hdec_pitch);</div>
<div class="line">                                rgb_ptr = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> *)(rgb_addr + j * raw_pitch);</div>
<div class="line">                                <span class="keywordflow">for</span> (k = 0; k &lt; frame_size.width / 4; k++) {</div>
<div class="line">                                    hds_ptr[k] = *(rgb_ptr + 4 * k);</div>
<div class="line">                                }</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keywordflow">if</span> (raw_ce_from_file) {</div>
<div class="line">                            <span class="keywordflow">if</span> (repeat_last_frame) {</div>
<div class="line">                                offset = 0 - (<span class="keywordtype">long</span> long)(hdec_line_size * frame_size.height);</div>
<div class="line">                                lseek(raw_ce_fd, offset, SEEK_CUR);</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">for</span> (j = 0; j &lt; frame_size.height; j++) {</div>
<div class="line">                                <span class="keywordflow">if</span> (read(raw_ce_fd, hdec_addr, hdec_line_size) != hdec_line_size) {</div>
<div class="line">                                    printf(<span class="stringliteral">&quot;Read line_size %d failed!\n&quot;</span>, hdec_line_size);</div>
<div class="line">                                }</div>
<div class="line">                                hdec_addr += hdec_pitch;</div>
<div class="line">                            }</div>
<div class="line">                        } <span class="keywordflow">else</span> {</div>
<div class="line">                            <span class="keywordflow">for</span> (j = 0; j &lt; frame_size.height; j++) {</div>
<div class="line">                                hds_ptr = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> *)(hdec_addr + j * hdec_pitch);</div>
<div class="line">                                rgb_ptr = (<a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> *)(rgb_addr + j * raw_pitch);</div>
<div class="line">                                <span class="keywordflow">for</span> (k = 0; k &lt; frame_size.width / 4; k++) {</div>
<div class="line">                                    hds_ptr[k] = *(rgb_ptr + 4 * k);</div>
<div class="line">                                }</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                line_size = frame_size.width;</div>
<div class="line">                raw_pitch = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(line_size, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">                <span class="keywordflow">if</span> (type == EFM_TYPE_RAW_YUV) {</div>
<div class="line">                    single_yuv_size = raw_pitch * frame_size.height * 2;</div>
<div class="line">                    single_input_frame_size = frame_size.width * frame_size.height * 2;</div>
<div class="line">                    chroma_height = frame_size.height;</div>
<div class="line">                } <span class="keywordflow">else</span> { <span class="comment">//if (type == EFM_TYPE_RAW_NV12)</span></div>
<div class="line">                    single_yuv_size = raw_pitch * frame_size.height * 3 / 2;</div>
<div class="line">                    single_input_frame_size = frame_size.width * frame_size.height * 3 / 2;</div>
<div class="line">                    chroma_height = frame_size.height / 2;</div>
<div class="line">                }</div>
<div class="line">                single_size = single_yuv_size;</div>
<div class="line">                <span class="keywordflow">if</span> (raw_pitch == line_size) {</div>
<div class="line">                    <span class="keywordflow">for</span> (i = 0; i &lt; batch_count; i++) {</div>
<div class="line">                        addr = buf_mem + (raw_buf_wr_idx + i) * single_size;</div>
<div class="line">                        <span class="keywordflow">if</span> (repeat_last_frame) {</div>
<div class="line">                            offset = 0 - (<span class="keywordtype">long</span> long)single_yuv_size;</div>
<div class="line">                            lseek(fd_raw, offset, SEEK_CUR);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> (read(fd_raw, addr, single_yuv_size) != single_yuv_size) {</div>
<div class="line">                            printf(<span class="stringliteral">&quot;Read single_yuv_size %d failed!\n&quot;</span>, single_yuv_size);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// read line by line for both luma and chroma</span></div>
<div class="line">                    <span class="keywordflow">for</span>(i = 0; i &lt; batch_count; i++) {</div>
<div class="line">                        <span class="comment">// read luma;</span></div>
<div class="line">                        addr = buf_mem + (raw_buf_wr_idx + i) * single_size;</div>
<div class="line">                        <span class="keywordflow">if</span> (repeat_last_frame) {</div>
<div class="line">                            offset = 0 - (<span class="keywordtype">long</span> long)(single_input_frame_size);</div>
<div class="line">                            lseek(fd_raw, offset, SEEK_CUR);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">for</span> (j = 0; j &lt; frame_size.height; j++) {</div>
<div class="line">                            <span class="keywordflow">if</span> (read(fd_raw, addr, frame_size.width) != frame_size.width) {</div>
<div class="line">                                printf(<span class="stringliteral">&quot;Read frame_size.width %d failed!\n&quot;</span>, frame_size.width);</div>
<div class="line">                            }</div>
<div class="line">                            addr += raw_pitch;</div>
<div class="line">                        }</div>
<div class="line">                        <span class="comment">// read chroma, width is the same as luma (uv interleaved);</span></div>
<div class="line">                        <span class="keywordflow">for</span> (j = 0; j &lt; chroma_height; j++) {</div>
<div class="line">                            <span class="keywordflow">if</span> (read(fd_raw, addr, frame_size.width) != frame_size.width) {</div>
<div class="line">                                printf(<span class="stringliteral">&quot;Read frame_size.width %d failed!\n&quot;</span>, frame_size.width);</div>
<div class="line">                            }</div>
<div class="line">                            addr += raw_pitch;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> + batch_count;</div>
<div class="line">        sem_post(&amp;read_sem);</div>
<div class="line">        raw_buf_wr_idx = (raw_buf_wr_idx + 1) % RAW_BUF_NUM;</div>
<div class="line">        frame_count_curr += raw_batch_num;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (frame_count_curr &gt;= file_frame_count[fd_index_curr]) {</div>
<div class="line">            <span class="keywordflow">if</span> (feed_type == FEED_REPEATE &amp;&amp; fd_index_curr == file_index_end) {</div>
<div class="line">                repeat_last_frame = 1;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                frame_count_curr = 0;</div>
<div class="line">                <span class="keywordflow">if</span> (fd_index_curr == file_index_end) {</div>
<div class="line">                    fd_index_curr = file_index_start;</div>
<div class="line">                    loop_count += 1;</div>
<div class="line">                    fd_index_pre = -1;</div>
<div class="line">                    printf(<span class="stringliteral">&quot;\nHas finished [%d] loop.\n&quot;</span>, loop_count);</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fd_index_curr &lt; file_index_end &amp;&amp;</div>
<div class="line">                    fd_index_curr &gt;= file_index_start) {</div>
<div class="line">                    fd_index_curr++;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unexpected fd_index [%d]!\n&quot;</span>, fd_index_curr);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                close(fd_raw);</div>
<div class="line">                fd_raw = -1;</div>
<div class="line">                <span class="keywordflow">if</span> (raw_ce_from_file) {</div>
<div class="line">                    close(raw_ce_fd);</div>
<div class="line">                    raw_ce_fd = -1;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (fd_raw &gt;= 0) {</div>
<div class="line">        close(fd_raw);</div>
<div class="line">        fd_raw = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (raw_ce_fd &gt;= 0) {</div>
<div class="line">        close(raw_ce_fd);</div>
<div class="line">        raw_ce_fd = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    return ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> feed_raw_through_buffer()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a118" name="_a118"></a><a class="code hl_structRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html">iav_raw_enc_setup</a> setup = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a119" name="_a119"></a><a class="code hl_structRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html">iav_raw_enc_cfg</a> enc_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span>timeval pre = {0, 0}, curr = {0, 0};</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> delta_us = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0, batch_count = 0, tmp_count = 0, raw_buf_rd_idx = 0;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> pts = 0, fixed_pattern_idx = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (pthread_create(&amp;raw_thread_id, NULL, (<span class="keywordtype">void</span>*)fill_raw_thread, NULL)</div>
<div class="line">        != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to create thread fill_raw_thread!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    setup.<a id="a120" name="a120"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#ad48d706a7ccf63d2518eb8f6f8b4d3ee">vinc_id</a> = vinc_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a121" name="a121"></a>IAV_IOC_GET_RAW_ENCODE, &amp;setup);</div>
<div class="line">    pts = setup.<a id="a122" name="a122"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a026152937e063c9685cde0d6da188305">frame_pts</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (pts) {</div>
<div class="line">        pts += (audio_clock / frame_rate) * raw_batch_num;</div>
<div class="line">    }</div>
<div class="line">    memset(&amp;setup, 0, <span class="keyword">sizeof</span>(setup));</div>
<div class="line">    enc_cfg.<a id="a123" name="a123"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#ad48d706a7ccf63d2518eb8f6f8b4d3ee">vinc_id</a> = vinc_id;</div>
<div class="line">    enc_cfg.<a id="a124" name="a124"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a09231b55490ecef4330af8b002c8c373">total_buf_num</a> = RAW_BUF_NUM;</div>
<div class="line">    enc_cfg.<a id="a125" name="a125"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a9bff1f81783f904d7caa7edf3c9e4828">raw_buf_addr</a> = buf_mem_phy_addr;</div>
<div class="line">    <span class="keywordflow">switch</span> (type) {</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_YUV:</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_NV12:</div>
<div class="line">        enc_cfg.<a id="a126" name="a126"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6f1d5bb48e5e918d7918fe33b8fb52ac">raw_pitch</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">        enc_cfg.<a id="a127" name="a127"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a5812a880ef7a7bcd41f4506138ff782e">raw_width</a> = frame_size.width;</div>
<div class="line">        enc_cfg.<a id="a128" name="a128"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a371a617a9bb42977a24e8cceb7f28d1e">raw_height</a> = frame_size.height;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_RGB:</div>
<div class="line">        <span class="keywordflow">if</span> (raw_format == RAW_FORMAT_UNCOMPRESSED) {</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6f1d5bb48e5e918d7918fe33b8fb52ac">raw_pitch</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width &lt;&lt; 1, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6f1d5bb48e5e918d7918fe33b8fb52ac">raw_pitch</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(frame_size.width, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">        }</div>
<div class="line">        enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a5812a880ef7a7bcd41f4506138ff782e">raw_width</a> = frame_size.width;</div>
<div class="line">        enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a371a617a9bb42977a24e8cceb7f28d1e">raw_height</a> = frame_size.height;</div>
<div class="line">        enc_cfg.<a id="a129" name="a129"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a3f44cdf6a01b1ed33ee2b294852bc667">raw_hdec_pitch</a> = <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6f1d5bb48e5e918d7918fe33b8fb52ac">raw_pitch</a> &gt;&gt; 2, IAV_DSP_BUF_PITCH_ALIGN);</div>
<div class="line">        <span class="keywordflow">if</span> (ce_size.width) {</div>
<div class="line">            enc_cfg.<a id="a130" name="a130"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#ae7c0bbc1241ec9a23c4ffd0755f0c149">raw_hdec_width</a> = ce_size.width;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#ae7c0bbc1241ec9a23c4ffd0755f0c149">raw_hdec_width</a> = enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a5812a880ef7a7bcd41f4506138ff782e">raw_width</a> &gt;&gt; 2;</div>
<div class="line">        }</div>
<div class="line">        enc_cfg.<a id="a131" name="a131"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a243a4bc34640c52bdcd3b3807e0bc88a">raw_hdec_height</a> = frame_size.height;</div>
<div class="line">        enc_cfg.<a id="a132" name="a132"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a7bc625ecd09c4d6672f5f52022238898">raw_hdec_buf_addr</a> = enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a9bff1f81783f904d7caa7edf3c9e4828">raw_buf_addr</a> +</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6f1d5bb48e5e918d7918fe33b8fb52ac">raw_pitch</a> * enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a371a617a9bb42977a24e8cceb7f28d1e">raw_height</a> * RAW_BUF_NUM;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        printf(<span class="stringliteral">&quot;Incorrect EFM type %d for RAW!\n&quot;</span>, type);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a133" name="a133"></a>IAV_IOC_SET_RAW_ENC_CFG, &amp;enc_cfg);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;START feeding RAW frames:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span>(!exit_efm) {</div>
<div class="line">        <span class="keywordflow">if</span> (count &gt;= frame_num &amp;&amp; frame_num != -1) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Finish feeding RAW frames!\n&quot;</span>);</div>
<div class="line">            exit_efm = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        sem_wait(&amp;read_sem);</div>
<div class="line">        <span class="keywordflow">if</span> (tmp_count + raw_batch_num &gt;= file_frame_count[fd_index_curr]) {</div>
<div class="line">            batch_count = file_frame_count[fd_index_curr] % raw_batch_num;</div>
<div class="line">            batch_count = (batch_count == 0) ? 1 : batch_count;</div>
<div class="line">            tmp_count = 0;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            batch_count = raw_batch_num;</div>
<div class="line">            tmp_count += batch_count;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ((frame_num - count) &lt; batch_count) {</div>
<div class="line">            batch_count = frame_num - <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot;  Feed frame %u ~ %u,&quot;</span>, count, count + batch_count - 1);</div>
<div class="line">        gettimeofday(&amp;curr, NULL);</div>
<div class="line">        delta_us = (curr.tv_sec - pre.tv_sec) * 1000000UL + curr.tv_usec - pre.tv_usec;</div>
<div class="line">        if (delta_us &lt; 1000000UL * batch_count / frame_rate) {</div>
<div class="line">            delta_us = 1000000UL * batch_count / frame_rate - delta_us;</div>
<div class="line">            usleep(delta_us);</div>
<div class="line">        }</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#ad48d706a7ccf63d2518eb8f6f8b4d3ee">vinc_id</a> = vinc_id;</div>
<div class="line">        <span class="keywordflow">if</span> (use_fixed_pattern) {</div>
<div class="line">            fixed_pattern_idx = (fixed_pattern_idx + 1) % RAW_BUF_NUM;</div>
<div class="line">            setup.<a id="a134" name="a134"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#af95b8a73365a3b46171c83786387379f">raw_daddr_buf_idx</a> = fixed_pattern_idx;</div>
<div class="line">            <span class="keywordflow">if</span> (type == EFM_TYPE_RAW_RGB) {</div>
<div class="line">                setup.<a id="a135" name="a135"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a960a38adb165a70f961acd7038915e23">raw_hdec_daddr_buf_idx</a> = fixed_pattern_idx;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#af95b8a73365a3b46171c83786387379f">raw_daddr_buf_idx</a> = raw_buf_rd_idx;</div>
<div class="line">            <span class="keywordflow">if</span> (type == EFM_TYPE_RAW_RGB) {</div>
<div class="line">                setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a960a38adb165a70f961acd7038915e23">raw_hdec_daddr_buf_idx</a> = raw_buf_rd_idx;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a026152937e063c9685cde0d6da188305">frame_pts</a> = pts;</div>
<div class="line">        pts += (audio_clock / frame_rate) * raw_batch_num;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a136" name="a136"></a>IAV_IOC_SET_RAW_ENCODE, &amp;setup);</div>
<div class="line">        gettimeofday(&amp;pre, NULL);</div>
<div class="line">        printf(<span class="stringliteral">&quot;done!\t&quot;</span>);</div>
<div class="line">        <span class="comment">// ensure once in 1 frame time</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;Wait frame %u ~ %u,&quot;</span>, count, count + batch_count - 1);</div>
<div class="line">        rval = ioctl(fd_iav, <a id="a137" name="a137"></a>IAV_IOC_WAIT_RAW_ENCODE, &amp;vinc_id);</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Sleep 1 second to make sure &gt;= 1 frame time!\n&quot;</span>);</div>
<div class="line">            sleep(1);</div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot;done!\n&quot;</span>);</div>
<div class="line">        raw_buf_rd_idx = (raw_buf_rd_idx + 1) % RAW_BUF_NUM;</div>
<div class="line">        sem_post(&amp;write_sem);</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> += batch_count;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    exit_raw_loop();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> feed_eis_raw()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/ddf/structvindev__devinfo.html">vindev_devinfo</a> src_vin_info = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html">iav_raw_enc_setup</a> setup = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html">iav_raw_enc_cfg</a> enc_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> query_desc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a138" name="_a138"></a><a class="code hl_structRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html">iav_rawbufdesc</a> *raw_desc = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a139" name="_a139"></a><a class="code hl_structRef" target="_blank" href="../../../library/d7/d28/structvin__global__info.html">vin_global_info</a> vsrc_info = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> src_chan_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> dst_chan_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a> resource = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a> query_mem = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a> query_dsp_mem = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a> *raw_pool_info = NULL, *dsp_part_info = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a140" name="_a140"></a><a class="code hl_structRef" target="_blank" href="../../../library/d5/df0/structiav__mem__layout__info.html">iav_mem_layout_info</a> mem_layout = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a141" name="_a141"></a><a class="code hl_structRef" target="_blank" href="../../../library/d6/d27/structiav__mem__layout__raw__pool.html">iav_mem_layout_raw_pool</a> *raw_pool_layout = &amp;mem_layout.<a id="a142" name="a142"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/df0/structiav__mem__layout__info.html#aed8ff96a020be93ee12a6e6f24b6e21e">raw_pool_layout</a>;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> raw_size = 0, raw_buf_num = 0, <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0, src_chan_id = 0, dst_chan_id = 0;</div>
<div class="line">    <span class="keywordtype">int</span> max_chan_num = 0, i = 0, eis_delay_count = 0, first_feed = 1;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    resource.<a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#ab16f548b2c418aee70c310a931fdfab1">encode_mode</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_SYSTEM_RESOURCE, &amp;resource);</div>
<div class="line">    max_chan_num = resource.<a class="code hl_variableRef" target="_blank" href="../../../library/df/d3a/structiav__system__resource.html#a42f03995f03acd4c0dc2a174cadb648d">chan_num</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a143" name="a143"></a>IAV_IOC_VIN_GET_GLOBAL_INFO, &amp;vsrc_info);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; max_chan_num; i++) {</div>
<div class="line">        dst_chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a85599fa0eac7165aaca13aa21f0e6b38">chan_id</a> = i;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_CHAN_CONFIG, &amp;dst_chan_cfg);</div>
<div class="line">        <span class="keywordflow">if</span> (vsrc_info.<a id="a144" name="a144"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d7/d28/structvin__global__info.html#a00ca1a1ae2c71f63a8c221f59b5d2f9a">vsrc_map</a>[vinc_id] &amp; (1U &lt;&lt; dst_chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a>)) {</div>
<div class="line">            dst_chan_id = dst_chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a85599fa0eac7165aaca13aa21f0e6b38">chan_id</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (!dst_chan_cfg.<a id="a145" name="a145"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a3cd146006e9777dd2ac94a9fa2a04dc8">eis_delay_count</a>) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Chan [%d] must be eis dst channel!\n&quot;</span>, dst_chan_id);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            src_chan_id = dst_chan_cfg.<a id="a146" name="a146"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a6f0aa224b6c72880fab4b7e1c529c097">raw_src_chan</a>;</div>
<div class="line">            eis_delay_count = dst_chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a3cd146006e9777dd2ac94a9fa2a04dc8">eis_delay_count</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (i &gt;= max_chan_num) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Cannot find the channel connected with vinc:%d\n&quot;</span>, vinc_id);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    src_chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a85599fa0eac7165aaca13aa21f0e6b38">chan_id</a> = src_chan_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_CHAN_CONFIG, &amp;src_chan_cfg);</div>
<div class="line"> </div>
<div class="line">    raw_buf_num = src_chan_cfg.<a id="a147" name="a147"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#ab5082c5eeff4344b77412968ace1c2ad">raw_feed_frame_num</a>;</div>
<div class="line">    src_vin_info.<a id="a148" name="a148"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/ddf/structvindev__devinfo.html#aa1ecb62f419c3b454f5a2d4fd18d4818">vsrc_id</a> = src_chan_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">vsrc_id</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_VIN_GET_DEVINFO, &amp;src_vin_info);</div>
<div class="line"> </div>
<div class="line">    query_mem.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">mid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a>;</div>
<div class="line">    raw_pool_info = &amp;query_mem.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">partition</a>;</div>
<div class="line">    raw_pool_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = <a id="a149" name="a149"></a><a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa3a7c67c8501dec6873b2d59fc7f147aa">IAV_PART_RAW_POOL</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_QUERY_MEMBLOCK, &amp;query_mem);</div>
<div class="line"> </div>
<div class="line">    query_dsp_mem.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">mid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a>;</div>
<div class="line">    dsp_part_info = &amp;query_dsp_mem.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">partition</a>;</div>
<div class="line">    dsp_part_info-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">pid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa">IAV_PART_DSP</a>;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_QUERY_MEMBLOCK, &amp;query_dsp_mem);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;mem_layout, 0, <span class="keyword">sizeof</span>(mem_layout));</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, <a id="a150" name="a150"></a>IAV_IOC_QUERY_MEM_LAYOUT_INFO, &amp;mem_layout);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;START feeding RAW frames:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span>(!exit_efm) {</div>
<div class="line">        memset(&amp;query_desc, 0, <span class="keyword">sizeof</span>(query_desc));</div>
<div class="line">        query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#aa73b12ace6ac7df824707a89ac4f91ff">qid</a> = <a id="a151" name="a151"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a613e1aa4924d1c0f8367b06cd6322116">IAV_DESC_RAW</a>;</div>
<div class="line">        raw_desc = &amp;query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a id="a152" name="a152"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a5cd6fb272dd1d5453eb1458556323b9c">raw</a>;</div>
<div class="line">        raw_desc-&gt;<a id="a153" name="a153"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#ad8249632e6536acaee21e364da350419">vin_id</a> = src_vin_info.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/ddf/structvindev__devinfo.html#a46b71fcd4a1b1b6b2f60e9ea79030a6d">vinc_id</a>;</div>
<div class="line">        raw_desc-&gt;<a id="a154" name="a154"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#afd839666b69f0e4e24ef81f81b756a00">skip_cache_sync</a> = 1;</div>
<div class="line">        raw_desc-&gt;<a id="a155" name="a155"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a0d4d0a98d64cba20aaf8e4fc5735c6ba">is_dsp_hw_pts</a> = 1;</div>
<div class="line">        raw_desc-&gt;<a id="a156" name="a156"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a9651609c41d100c012697b5847c94a35">delay_frames</a> = eis_delay_count;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_QUERY_DESC, &amp;query_desc) &lt; 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (errno == EINTR) {</div>
<div class="line">                <span class="comment">/* skip to do nothing */</span></div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_DESC&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (first_feed) {</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#ad48d706a7ccf63d2518eb8f6f8b4d3ee">vinc_id</a> = vinc_id;</div>
<div class="line">            <span class="keywordflow">if</span> (raw_desc-&gt;<a id="a157" name="a157"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#aa862cf8c61aa0b5952fce3b1456d8e58">raw_base_addr_offset</a>) {</div>
<div class="line">                <span class="comment">/* This is for MIPI VC HDR case */</span></div>
<div class="line">                raw_size = raw_desc-&gt;<a id="a158" name="a158"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * raw_desc-&gt;<a id="a159" name="a159"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">                enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a9bff1f81783f904d7caa7edf3c9e4828">raw_buf_addr</a> = raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#aa862cf8c61aa0b5952fce3b1456d8e58">raw_base_addr_offset</a> + dsp_part_info-&gt;mem.addr;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                raw_size = raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#acd497cc6637ae5062f58897e65e16193">pitch</a> * <a class="code hl_define" href="../../dummy.html">ROUND_UP</a>(raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, PIXEL_IN_MB);</div>
<div class="line">                enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a9bff1f81783f904d7caa7edf3c9e4828">raw_buf_addr</a> = raw_pool_layout-&gt;<a id="a160" name="a160"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/d27/structiav__mem__layout__raw__pool.html#a5ea707d750b2aaa86d0311f93deeafff">phys_base</a> +</div>
<div class="line">                    raw_pool_layout-&gt;<a id="a161" name="a161"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d6/d27/structiav__mem__layout__raw__pool.html#a8782bac11623f5def2d2bc8444d5072e">buf_layout</a>[src_vin_info.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/ddf/structvindev__devinfo.html#a46b71fcd4a1b1b6b2f60e9ea79030a6d">vinc_id</a>].<a id="a162" name="a162"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d2e/structiav__mem__layout.html#a4ba37e6b40e12ce1d1e5dbee0323069d">offset</a>;</div>
<div class="line">            }</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6f1d5bb48e5e918d7918fe33b8fb52ac">raw_pitch</a> = raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a5812a880ef7a7bcd41f4506138ff782e">raw_width</a> = raw_desc-&gt;<a id="a163" name="a163"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a371a617a9bb42977a24e8cceb7f28d1e">raw_height</a> = raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a3f44cdf6a01b1ed33ee2b294852bc667">raw_hdec_pitch</a> = raw_desc-&gt;<a id="a164" name="a164"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a65ab2a7e837fe71b9088a96bf1383287">ce_pitch</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#ae7c0bbc1241ec9a23c4ffd0755f0c149">raw_hdec_width</a> = raw_desc-&gt;<a id="a165" name="a165"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a8054907a7ac004bf54b0376ef0e7b68e">ce_width</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a243a4bc34640c52bdcd3b3807e0bc88a">raw_hdec_height</a> = raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a7bc625ecd09c4d6672f5f52022238898">raw_hdec_buf_addr</a> = enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a9bff1f81783f904d7caa7edf3c9e4828">raw_buf_addr</a> + raw_buf_num * raw_size;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a09231b55490ecef4330af8b002c8c373">total_buf_num</a> = raw_buf_num;</div>
<div class="line">            printf(<span class="stringliteral">&quot;RAW desc pitch %d, widthxheight %dx%d, ce pitch %d, wxh %dx%d\n&quot;</span>,</div>
<div class="line">                raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a85db88ffee2944ecd35c616393976289">width</a>, raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>,</div>
<div class="line">                raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a65ab2a7e837fe71b9088a96bf1383287">ce_pitch</a>, raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a8054907a7ac004bf54b0376ef0e7b68e">ce_width</a>, raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_SET_RAW_ENC_CFG, &amp;enc_cfg);</div>
<div class="line">            first_feed = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot; Feed frame %u ,&quot;</span>, count);</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#ad48d706a7ccf63d2518eb8f6f8b4d3ee">vinc_id</a> = vinc_id;</div>
<div class="line">        setup.<a id="a166" name="a166"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a86aaeaa289cbe23f062a634e9f6f06c2">mono_pts</a> = raw_desc-&gt;<a id="a167" name="a167"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a86aaeaa289cbe23f062a634e9f6f06c2">mono_pts</a>;</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a026152937e063c9685cde0d6da188305">frame_pts</a> = raw_desc-&gt;<a id="a168" name="a168"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a3e79318d5450a7237b8b26540d294c02">dsp_pts</a>;</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#af95b8a73365a3b46171c83786387379f">raw_daddr_buf_idx</a> = (raw_desc-&gt;<a id="a169" name="a169"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#a5e73c34ecc25399bf626f162618c9467">raw_addr_offset</a> - raw_desc-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d9/dfe/structiav__rawbufdesc.html#aa862cf8c61aa0b5952fce3b1456d8e58">raw_base_addr_offset</a> -</div>
<div class="line">            raw_pool_layout-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d6/d27/structiav__mem__layout__raw__pool.html#a8782bac11623f5def2d2bc8444d5072e">buf_layout</a>[src_vin_info.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/ddf/structvindev__devinfo.html#a46b71fcd4a1b1b6b2f60e9ea79030a6d">vinc_id</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/df/d2e/structiav__mem__layout.html#a4ba37e6b40e12ce1d1e5dbee0323069d">offset</a>) / raw_size;</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a960a38adb165a70f961acd7038915e23">raw_hdec_daddr_buf_idx</a> =  setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#af95b8a73365a3b46171c83786387379f">raw_daddr_buf_idx</a>;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_SET_RAW_ENCODE, &amp;setup);</div>
<div class="line">        printf(<span class="stringliteral">&quot;done!\t&quot;</span>);</div>
<div class="line">        <span class="comment">/* ensure once in 1 frame time */</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;Wait frame %u,&quot;</span>, count);</div>
<div class="line">        rval = ioctl(fd_iav, IAV_IOC_WAIT_RAW_ENCODE, &amp;vinc_id);</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Sleep 1 second to make sure &gt;= 1 frame time!\n&quot;</span>);</div>
<div class="line">            sleep(1);</div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot;done!\n&quot;</span>);</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>++;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> feed_raw_from_canvas_capture(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html">iav_raw_enc_setup</a> setup = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html">iav_raw_enc_cfg</a> enc_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> canvas_cfg = {0};</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a> query_desc = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a170" name="_a170"></a><a class="code hl_structRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html">iav_canvasdesc</a> *canvas = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html">iav_yuv_cap</a> *yuv_cap = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../library/d5/df0/structiav__mem__layout__info.html">iav_mem_layout_info</a> mem_layout = {0};</div>
<div class="line">    <span class="keyword">struct </span><a id="_a171" name="_a171"></a><a class="code hl_structRef" target="_blank" href="../../../library/d2/dd3/structiav__mem__layout__canvas.html">iav_mem_layout_canvas</a> *canvas_pool_layout = &amp;mem_layout.<a id="a172" name="a172"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/df0/structiav__mem__layout__info.html#a30f848b3d8b434233acff21a538f85cc">canvas_pool_layout</a>;</div>
<div class="line">    <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> raw_size = 0, <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;</div>
<div class="line">    <span class="keywordtype">int</span> first_feed = 1;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (canvas_id &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid canvas id %d! Please use \&quot;-b\&quot; to set the canvas id.\n&quot;</span>, canvas_id);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> FEED_RAW_FROM_CANVAS_CAPTURE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a> = canvas_id;</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_GET_CANVAS_CONFIG, &amp;canvas_cfg);</div>
<div class="line">    <span class="keywordflow">if</span> (canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ad25de23139382a40fae433639dbc04e9">type</a> != <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga72de8a505ff4d73f6252097b3bf5b993a8ec3b63ed4b19ee5d0c42942db33d3e6">IAV_CANVAS_TYPE_ENCODE</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid EFR source canvas buffer type, should be \&quot;encode\&quot;.\n&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> FEED_RAW_FROM_CANVAS_CAPTURE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a51993db991a3b2807df9114b0134ffdf">ext_mem</a> &amp; !canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a423a515fa4f18a4a232501e84d5adbb2">manual_feed</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Source canvas [%d] must use external memory or manual feed mode!\n&quot;</span>, canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a>);</div>
<div class="line">        rval = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> FEED_RAW_FROM_CANVAS_CAPTURE_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset(&amp;mem_layout, 0, <span class="keyword">sizeof</span>(mem_layout));</div>
<div class="line">    <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_QUERY_MEM_LAYOUT_INFO, &amp;mem_layout);</div>
<div class="line"> </div>
<div class="line">    memset(&amp;query_desc, 0, <span class="keyword">sizeof</span>(query_desc));</div>
<div class="line">    query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#aa73b12ace6ac7df824707a89ac4f91ff">qid</a> = <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a>;</div>
<div class="line">    canvas = &amp;query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>;</div>
<div class="line">    canvas-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a> = canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a>;</div>
<div class="line">    <span class="comment">/* For manual feed canvas, before querying, release all possible locked canvas buffers */</span></div>
<div class="line">    <span class="keywordflow">if</span> (canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a423a515fa4f18a4a232501e84d5adbb2">manual_feed</a>) {</div>
<div class="line">        canvas-&gt;<a id="a173" name="a173"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a8e2c6914bc84c9db050bcada45f26d2b">feed_seq_num</a> = -1;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, <a id="a174" name="a174"></a>IAV_IOC_RELEASE_CANVAS_BUF, &amp;query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_RELEASE_CANVAS_BUF\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> FEED_RAW_FROM_CANVAS_CAPTURE_EXIT;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;START feeding YUV RAW frames from canvas_[%u] to virtual vin_[%d]:\n&quot;</span>, canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">canvas_id</a>, vinc_id);</div>
<div class="line">    <span class="keywordflow">while</span>(!exit_efm) {</div>
<div class="line">        canvas-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a0d4d0a98d64cba20aaf8e4fc5735c6ba">is_dsp_hw_pts</a> = 1;</div>
<div class="line">        canvas-&gt;<a id="a175" name="a175"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#afd839666b69f0e4e24ef81f81b756a00">skip_cache_sync</a> = 1;</div>
<div class="line">        <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_QUERY_DESC, &amp;query_desc) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;IAV_IOC_QUERY_DESC&quot;</span>);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        yuv_cap = &amp;canvas-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#ad1847147a26fa6e714478a599d584f45">yuv</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (first_feed) {</div>
<div class="line">            raw_size = canvas_pool_layout-&gt;<a id="a176" name="a176"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/dd3/structiav__mem__layout__canvas.html#a625dedeb528813af594cc20679364571">buf_layout</a>[canvas-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a>].<a id="a177" name="a177"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d2e/structiav__mem__layout.html#ab6f6e9a74595b722b09d32114c76b08c">unit_size</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#ad48d706a7ccf63d2518eb8f6f8b4d3ee">vinc_id</a> = vinc_id;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a9bff1f81783f904d7caa7edf3c9e4828">raw_buf_addr</a> = canvas_pool_layout-&gt;<a id="a178" name="a178"></a><a class="code hl_variableRef" target="_blank" href="../../../library/d2/dd3/structiav__mem__layout__canvas.html#a5ea707d750b2aaa86d0311f93deeafff">phys_base</a> + canvas_pool_layout-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d2/dd3/structiav__mem__layout__canvas.html#a625dedeb528813af594cc20679364571">buf_layout</a>[canvas-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/df/d2e/structiav__mem__layout.html#a4ba37e6b40e12ce1d1e5dbee0323069d">offset</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6f1d5bb48e5e918d7918fe33b8fb52ac">raw_pitch</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a5812a880ef7a7bcd41f4506138ff782e">raw_width</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a371a617a9bb42977a24e8cceb7f28d1e">raw_height</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>;</div>
<div class="line">            enc_cfg.<a id="a179" name="a179"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6d27f67e8f31e8048673a6f173b27ba8">raw_max_height</a> = (raw_size / enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6f1d5bb48e5e918d7918fe33b8fb52ac">raw_pitch</a>) * 2 / 3;</div>
<div class="line">            enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a09231b55490ecef4330af8b002c8c373">total_buf_num</a> = canvas_pool_layout-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d2/dd3/structiav__mem__layout__canvas.html#a625dedeb528813af594cc20679364571">buf_layout</a>[canvas-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a>].<a id="a180" name="a180"></a><a class="code hl_variableRef" target="_blank" href="../../../library/df/d2e/structiav__mem__layout.html#a438d9043168d90b8e757f353a4f7867d">unit_num</a>;</div>
<div class="line">            enc_cfg.<a id="a181" name="a181"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a77e017ad1f77b3a55444812a32088d64">is_from_ext_mem</a> = 1;</div>
<div class="line">            printf(<span class="stringliteral">&quot;YUV pitch %d, widthxheight %dx%d, raw_max_height=%d\n&quot;</span>,</div>
<div class="line">                yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">pitch</a>, yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">width</a>, yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">height</a>, enc_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6d27f67e8f31e8048673a6f173b27ba8">raw_max_height</a>);</div>
<div class="line">            <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_SET_RAW_ENC_CFG, &amp;enc_cfg);</div>
<div class="line">            first_feed = 0;</div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot; Feed frame %u ,&quot;</span>, count);</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#ad48d706a7ccf63d2518eb8f6f8b4d3ee">vinc_id</a> = vinc_id;</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a86aaeaa289cbe23f062a634e9f6f06c2">mono_pts</a> = yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a86aaeaa289cbe23f062a634e9f6f06c2">mono_pts</a>;</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a026152937e063c9685cde0d6da188305">frame_pts</a> = yuv_cap-&gt;<a id="a182" name="a182"></a><a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a3e79318d5450a7237b8b26540d294c02">dsp_pts</a>;</div>
<div class="line">        setup.<a class="code hl_variableRef" target="_blank" href="../../../library/d2/d5e/structiav__raw__enc__setup.html#af95b8a73365a3b46171c83786387379f">raw_daddr_buf_idx</a> = (yuv_cap-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/dc/d6a/structiav__yuv__cap.html#a7ed2668fc9c18679b1a349a2f6914f3f">y_addr_offset</a> -</div>
<div class="line">            canvas_pool_layout-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d2/dd3/structiav__mem__layout__canvas.html#a625dedeb528813af594cc20679364571">buf_layout</a>[canvas-&gt;<a class="code hl_variableRef" target="_blank" href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">canvas_id</a>].<a class="code hl_variableRef" target="_blank" href="../../../library/df/d2e/structiav__mem__layout.html#a4ba37e6b40e12ce1d1e5dbee0323069d">offset</a>) / raw_size;</div>
<div class="line">        <a class="code hl_defineRef" target="_blank" href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a>(fd_iav, IAV_IOC_SET_RAW_ENCODE, &amp;setup);</div>
<div class="line">        printf(<span class="stringliteral">&quot;done!\t&quot;</span>);</div>
<div class="line">        <span class="comment">/* ensure once in 1 frame time */</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;Wait frame %u,&quot;</span>, count);</div>
<div class="line">        rval = ioctl(fd_iav, IAV_IOC_WAIT_RAW_ENCODE, &amp;vinc_id);</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Sleep 1 second to make sure &gt;= 1 frame time!\n&quot;</span>);</div>
<div class="line">            sleep(1);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (canvas_cfg.<a class="code hl_variableRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html#a423a515fa4f18a4a232501e84d5adbb2">manual_feed</a>) {</div>
<div class="line">            <span class="comment">/* Release the canvas buffer*/</span></div>
<div class="line">            <span class="keywordflow">if</span> (ioctl(fd_iav, IAV_IOC_RELEASE_CANVAS_BUF, &amp;query_desc.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">arg</a>.<a class="code hl_variableRef" target="_blank" href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">canvas</a>) &lt; 0) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;IAV_IOC_RELEASE_CANVAS_BUF\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot;done!\n&quot;</span>);</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>++;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">FEED_RAW_FROM_CANVAS_CAPTURE_EXIT:</div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> feed_raw_loop(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (check_efr_cfgs() &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Check EFR cfgs failed!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (type == EFM_TYPE_EIS_RAW) {</div>
<div class="line">        feed_eis_raw();</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == EFM_TYPE_RAW_FROM_CANVAS) {</div>
<div class="line">        feed_raw_from_canvas_capture();</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (prepare_raw_params() &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Check EFR for RAW parameters failed!\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        feed_raw_through_buffer();</div>
<div class="line"> </div>
<div class="line">        free_buf_for_raw();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> efm_iav_state_notifier(<span class="keywordtype">void</span> *private_data, <a class="code hl_typedefRef" target="_blank" href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gafc7fb94a411b7cedcb91492097fdb928">iav_state</a>, <span class="keywordtype">int</span> reinit_status)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (reinit_status &lt; 0) {</div>
<div class="line">        exit_efm = 1;</div>
<div class="line">        sem_post(&amp;sem);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gafc7fb94a411b7cedcb91492097fdb928">iav_state</a> == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggafc7fb94a411b7cedcb91492097fdb928a24f1c67d4886473779ceba84546aa9f4">IAV_STATE_PREVIEW</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Wait efm stream[%d] Start...\n&quot;</span>, current_stream);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_enumerationRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gafc7fb94a411b7cedcb91492097fdb928">iav_state</a> == <a class="code hl_variableRef" target="_blank" href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggafc7fb94a411b7cedcb91492097fdb928a3f68c2db148568fb9fa0af2f4ca2fa38">IAV_STATE_ENCODING</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (prepare_yuv_params(current_stream) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Check EFM for YUV parameters failed!\n&quot;</span>);</div>
<div class="line">            exit_efm = 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    sem_post(&amp;sem);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a183" name="a183"></a><a class="code hl_functionRef" target="_blank" href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>efm_usr_cfg cfg = {0};</div>
<div class="line">    <span class="comment">//register signal handler for Ctrl+C, Ctrl+&#39;\&#39;, and &quot;kill&quot; sys cmd</span></div>
<div class="line">    signal(SIGINT,  sigstop);</div>
<div class="line">    signal(SIGQUIT, sigstop);</div>
<div class="line">    signal(SIGTERM, sigstop);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// open iav dev</span></div>
<div class="line">    <span class="keywordflow">if</span> ((fd_iav = open(<span class="stringliteral">&quot;/dev/iav&quot;</span>, O_RDWR, 0)) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;/dev/iav&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        usage();</div>
<div class="line">        <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (init_param(argc, argv) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (type) {</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_YUV_FILE:</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_YUV_CAPTURE:</div>
<div class="line">        cfg.iav_fd = <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a>;</div>
<div class="line">        cfg.iav_state_notifier = efm_iav_state_notifier;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (efm_lib_init(&amp;cfg) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Init EFM Lib failed\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (prepare_yuv_params(current_stream) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Check EFM for YUV parameters failed!\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">goto</span> MAIN_EXIT;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        feed_yuv_loop(&amp;cfg, current_stream);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_NV12:</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_RGB:</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_YUV:</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_EIS_RAW:</div>
<div class="line">    <span class="keywordflow">case</span> EFM_TYPE_RAW_FROM_CANVAS:</div>
<div class="line">        feed_raw_loop();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        printf(<span class="stringliteral">&quot;Incorrect type: %d! So quit directly!&quot;</span>, type);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">MAIN_EXIT:</div>
<div class="line">    <span class="keywordflow">if</span> (fd_iav &gt;= 0) {</div>
<div class="line">        close(fd_iav);</div>
<div class="line">        <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a> = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> ((type == EFM_TYPE_YUV_FILE) || (type == EFM_TYPE_YUV_CAPTURE)) {</div>
<div class="line">        efm_lib_deinit();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="ttc" id="aamba__defines_8h_html"><div class="ttname"><a href="../../d0/dc8/amba__defines_8h.html">amba_defines.h</a></div></div>
<div class="ttc" id="aamba__defines_8h_html_a6022838300921ede682be48effc14015"><div class="ttname"><a href="../../d0/dc8/amba__defines_8h.html#a6022838300921ede682be48effc14015">AMBA_WRITE_FILE</a></div><div class="ttdeci">#define AMBA_WRITE_FILE(file, buf, size)</div><div class="ttdef"><b>Definition:</b> amba_defines.h:46</div></div>
<div class="ttc" id="aamba__defines_8h_html_aa8f02d584fb0e103e7de071b3f79ce1f"><div class="ttname"><a href="../../d0/dc8/amba__defines_8h.html#aa8f02d584fb0e103e7de071b3f79ce1f">AMBA_READ_FILE</a></div><div class="ttdeci">#define AMBA_READ_FILE(file, buf, size)</div><div class="ttdef"><b>Definition:</b> amba_defines.h:40</div></div>
<div class="ttc" id="aasf__structure_8h_html_a92c50087ca0e64fa93fc59402c55f8ca"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></div><div class="ttdeci">uint8_t u8</div></div>
<div class="ttc" id="aasf__structure_8h_html_ace9d960e74685e2cd84b36132dbbf8aa"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a></div><div class="ttdeci">uint16_t u16</div></div>
<div class="ttc" id="aasf__structure_8h_html_ad758b7a5c3f18ed79d2fcd23d9f16357"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a></div><div class="ttdeci">unsigned long long u64</div></div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../../library/d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div></div>
<div class="ttc" id="abasetypes_8h_html"><div class="ttname"><a href="../../de/ddc/basetypes_8h.html">basetypes.h</a></div><div class="ttdoc">This file defines basic types used in all IAV driver and header files.</div></div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div></div>
<div class="ttc" id="acJSON_8h_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a></div><div class="ttdeci">int count</div></div>
<div class="ttc" id="adummy_html"><div class="ttname"><a href="../../dummy.html">ROUND_UP</a></div><div class="ttdeci">#define ROUND_UP(x, n)</div></div>
<div class="ttc" id="agroup__IAV_html_ga85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../df/dc0/group__IAV.html#ga85db88ffee2944ecd35c616393976289">iav_window::width</a></div><div class="ttdeci">u32 width</div><div class="ttdoc">Window width.</div><div class="ttdef"><b>Definition:</b> basetypes.h:96</div></div>
<div class="ttc" id="agroup__IAV_html_gadd40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../df/dc0/group__IAV.html#gadd40f8a56ae8cc650f92a3aa4d2bac99">iav_window::height</a></div><div class="ttdeci">u32 height</div><div class="ttdoc">Window height.</div><div class="ttdef"><b>Definition:</b> basetypes.h:97</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gafc7fb94a411b7cedcb91492097fdb928"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gafc7fb94a411b7cedcb91492097fdb928">iav_state</a></div><div class="ttdeci">iav_state</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga0d4aa56417117a810935674737c2f2e7a701c550e5c83dc2c5d86f5c30d02cb9e">DSP_CURRENT_MODE</a></div><div class="ttdeci">DSP_CURRENT_MODE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga1a439af5ebc8b8d356cfc7bfc7929a22ace7d9bb636c732a531b482ae6e20b835">IAV_INFO_STREAM</a></div><div class="ttdeci">IAV_INFO_STREAM</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172a613e1aa4924d1c0f8367b06cd6322116"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172a613e1aa4924d1c0f8367b06cd6322116">IAV_DESC_RAW</a></div><div class="ttdeci">IAV_DESC_RAW</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga3606b35b652dca594dc455dfb0b9f172ad1eb61f9c66c08ad24169d01d4d0ee9e">IAV_DESC_CANVAS</a></div><div class="ttdeci">IAV_DESC_CANVAS</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_gga72de8a505ff4d73f6252097b3bf5b993a8ec3b63ed4b19ee5d0c42942db33d3e6"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#gga72de8a505ff4d73f6252097b3bf5b993a8ec3b63ed4b19ee5d0c42942db33d3e6">IAV_CANVAS_TYPE_ENCODE</a></div><div class="ttdeci">IAV_CANVAS_TYPE_ENCODE</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406eaab2edc95139487533074803b16316534">IAV_STREAM_TYPE_H265</a></div><div class="ttdeci">IAV_STREAM_TYPE_H265</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggaedee632d62ec29c16717d808e9bd406ead2feabb75221806525afe5d4bc053431"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggaedee632d62ec29c16717d808e9bd406ead2feabb75221806525afe5d4bc053431">IAV_STREAM_TYPE_MJPEG</a></div><div class="ttdeci">IAV_STREAM_TYPE_MJPEG</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggafc7fb94a411b7cedcb91492097fdb928a24f1c67d4886473779ceba84546aa9f4"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggafc7fb94a411b7cedcb91492097fdb928a24f1c67d4886473779ceba84546aa9f4">IAV_STATE_PREVIEW</a></div><div class="ttdeci">IAV_STATE_PREVIEW</div></div>
<div class="ttc" id="agroup__iav-ioctl-general-helper_html_ggafc7fb94a411b7cedcb91492097fdb928a3f68c2db148568fb9fa0af2f4ca2fa38"><div class="ttname"><a href="../../../library/d3/de3/group__iav-ioctl-general-helper.html#ggafc7fb94a411b7cedcb91492097fdb928a3f68c2db148568fb9fa0af2f4ca2fa38">IAV_STATE_ENCODING</a></div><div class="ttdeci">IAV_STATE_ENCODING</div></div>
<div class="ttc" id="agroup__iav-typedef_html_ga10e94b422ef0c20dcdec20d31a1f5049"><div class="ttname"><a href="../../d0/dfa/group__iav-typedef.html#ga10e94b422ef0c20dcdec20d31a1f5049">u32</a></div><div class="ttdeci">unsigned int u32</div><div class="ttdef"><b>Definition:</b> basetypes.h:53</div></div>
<div class="ttc" id="agroup__video-sharing-service-struct-group_html_ga96849c6a73d4bbc29bbeef33f96f8411"><div class="ttname"><a href="../../../library/d7/d81/group__video-sharing-service-struct-group.html#ga96849c6a73d4bbc29bbeef33f96f8411">yuv_format</a></div><div class="ttdeci">yuv_format</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa233f816c90d5a9175965d509dc2a3faa">IAV_PART_DSP</a></div><div class="ttdeci">IAV_PART_DSP</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa3a7c67c8501dec6873b2d59fc7f147aa"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa3a7c67c8501dec6873b2d59fc7f147aa">IAV_PART_RAW_POOL</a></div><div class="ttdeci">IAV_PART_RAW_POOL</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faa9c6871121818aa47f659dea5f7b93f1a"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faa9c6871121818aa47f659dea5f7b93f1a">IAV_PART_USR</a></div><div class="ttdeci">IAV_PART_USR</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_a6e160acba2472e919b41321d8fbe72faaad312de47a183da5f2167b10c8c1e528"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#a6e160acba2472e919b41321d8fbe72faaad312de47a183da5f2167b10c8c1e528">IAV_PART_CANVAS_POOL</a></div><div class="ttdeci">IAV_PART_CANVAS_POOL</div></div>
<div class="ttc" id="aiav__ioctl_8h_html_aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524"><div class="ttname"><a href="../../../library/de/d89/iav__ioctl_8h.html#aa4ef4a9add627e30f58595a1e8a78225ad6cd45b3e12fec076b535370ba973524">IAV_MEM_PARTITION</a></div><div class="ttdeci">IAV_MEM_PARTITION</div></div>
<div class="ttc" id="aiav__utils_8h_html_a1fb0b57da8f35f1c47328e737e14b99d"><div class="ttname"><a href="../../d6/d56/iav__utils_8h.html#a1fb0b57da8f35f1c47328e737e14b99d">PTS_CLK</a></div><div class="ttdeci">#define PTS_CLK</div><div class="ttdef"><b>Definition:</b> iav_utils.h:44</div></div>
<div class="ttc" id="aiav__utils_8h_html_a9e94358557fef0c4eeaca8d310d22ae9"><div class="ttname"><a href="../../d6/d56/iav__utils_8h.html#a9e94358557fef0c4eeaca8d310d22ae9">vin_info</a></div><div class="ttdeci">#define vin_info(str, arg...)</div><div class="ttdef"><b>Definition:</b> iav_utils.h:340</div></div>
<div class="ttc" id="astream__cfg_8c_html_aaf0da9064aaa6054cae10d4cab6884cd"><div class="ttname"><a href="../../../video/da/d30/stream__cfg_8c.html#aaf0da9064aaa6054cae10d4cab6884cd">VERIFY_STREAMID</a></div><div class="ttdeci">#define VERIFY_STREAMID(x)</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html">iav_alloc_mem_part</a></div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_a189394c6bbc0d36422df8c5bc2ee1962"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a189394c6bbc0d36422df8c5bc2ee1962">iav_alloc_mem_part::pid</a></div><div class="ttdeci">u32 pid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1852</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_a8ea167dba5ed98a2ab50ff41dae8dde5"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a8ea167dba5ed98a2ab50ff41dae8dde5">iav_alloc_mem_part::enable_cache</a></div><div class="ttdeci">u32 enable_cache</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1855</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_a9ee64c7b918513891b3834b93ad0e501"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#a9ee64c7b918513891b3834b93ad0e501">iav_alloc_mem_part::length</a></div><div class="ttdeci">unsigned long length</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1858</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_ac1369a1f209735864674d22517edfa76"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#ac1369a1f209735864674d22517edfa76">iav_alloc_mem_part::offset</a></div><div class="ttdeci">unsigned long offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1860</div></div>
<div class="ttc" id="astructiav__alloc__mem__part_html_adac25b843a2cccd720a100c5b9b1b545"><div class="ttname"><a href="../../../library/d8/d3d/structiav__alloc__mem__part.html#adac25b843a2cccd720a100c5b9b1b545">iav_alloc_mem_part::from_private</a></div><div class="ttdeci">u32 from_private</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1856</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a></div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_a423a515fa4f18a4a232501e84d5adbb2"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#a423a515fa4f18a4a232501e84d5adbb2">iav_canvas_cfg::manual_feed</a></div><div class="ttdeci">u16 manual_feed</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1476</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_a51993db991a3b2807df9114b0134ffdf"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#a51993db991a3b2807df9114b0134ffdf">iav_canvas_cfg::ext_mem</a></div><div class="ttdeci">u16 ext_mem</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1489</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_aa1281fe9a1e356ee476ec71c9f7914ac"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#aa1281fe9a1e356ee476ec71c9f7914ac">iav_canvas_cfg::max</a></div><div class="ttdeci">struct iav_window max</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1517</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_ad25de23139382a40fae433639dbc04e9"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#ad25de23139382a40fae433639dbc04e9">iav_canvas_cfg::type</a></div><div class="ttdeci">enum iav_canvas_type type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1516</div></div>
<div class="ttc" id="astructiav__canvas__cfg_html_ae8cabdc5c24b46705eb7ad5e0fc54660"><div class="ttname"><a href="../../../library/dd/d01/structiav__canvas__cfg.html#ae8cabdc5c24b46705eb7ad5e0fc54660">iav_canvas_cfg::canvas_id</a></div><div class="ttdeci">u8 canvas_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1470</div></div>
<div class="ttc" id="astructiav__canvasdesc_html"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html">iav_canvasdesc</a></div></div>
<div class="ttc" id="astructiav__canvasdesc_html_a0d4d0a98d64cba20aaf8e4fc5735c6ba"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#a0d4d0a98d64cba20aaf8e4fc5735c6ba">iav_canvasdesc::is_dsp_hw_pts</a></div><div class="ttdeci">u32 is_dsp_hw_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2265</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_a2f1e22f38f7be358c963bc2a979fbf4d"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#a2f1e22f38f7be358c963bc2a979fbf4d">iav_canvasdesc::canvas_id</a></div><div class="ttdeci">u32 canvas_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2263</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_a549b17e342b011260d718344bf31ea07"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#a549b17e342b011260d718344bf31ea07">iav_canvasdesc::me0</a></div><div class="ttdeci">struct iav_me_cap me0</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2277</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_a6174724560c4025946fb0498c0022a84"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#a6174724560c4025946fb0498c0022a84">iav_canvasdesc::me1</a></div><div class="ttdeci">struct iav_me_cap me1</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2276</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_a8e2c6914bc84c9db050bcada45f26d2b"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#a8e2c6914bc84c9db050bcada45f26d2b">iav_canvasdesc::feed_seq_num</a></div><div class="ttdeci">u64 feed_seq_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2278</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_ad1847147a26fa6e714478a599d584f45"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#ad1847147a26fa6e714478a599d584f45">iav_canvasdesc::yuv</a></div><div class="ttdeci">struct iav_yuv_cap yuv</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2275</div></div>
<div class="ttc" id="astructiav__canvasdesc_html_afd839666b69f0e4e24ef81f81b756a00"><div class="ttname"><a href="../../../library/d5/dfb/structiav__canvasdesc.html#afd839666b69f0e4e24ef81f81b756a00">iav_canvasdesc::skip_cache_sync</a></div><div class="ttdeci">u32 skip_cache_sync</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2269</div></div>
<div class="ttc" id="astructiav__chan__cfg_html"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a></div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a124a81574b0fbd3d1e60e2917e5ecefe"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a124a81574b0fbd3d1e60e2917e5ecefe">iav_chan_cfg::vsrc_id</a></div><div class="ttdeci">u32 vsrc_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1315</div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a3cd146006e9777dd2ac94a9fa2a04dc8"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a3cd146006e9777dd2ac94a9fa2a04dc8">iav_chan_cfg::eis_delay_count</a></div><div class="ttdeci">u32 eis_delay_count</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1415</div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a6f0aa224b6c72880fab4b7e1c529c097"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a6f0aa224b6c72880fab4b7e1c529c097">iav_chan_cfg::raw_src_chan</a></div><div class="ttdeci">u32 raw_src_chan</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1417</div></div>
<div class="ttc" id="astructiav__chan__cfg_html_a85599fa0eac7165aaca13aa21f0e6b38"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#a85599fa0eac7165aaca13aa21f0e6b38">iav_chan_cfg::chan_id</a></div><div class="ttdeci">u32 chan_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1314</div></div>
<div class="ttc" id="astructiav__chan__cfg_html_ab5082c5eeff4344b77412968ace1c2ad"><div class="ttname"><a href="../../../library/d9/db4/structiav__chan__cfg.html#ab5082c5eeff4344b77412968ace1c2ad">iav_chan_cfg::raw_feed_frame_num</a></div><div class="ttdeci">u32 raw_feed_frame_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1352</div></div>
<div class="ttc" id="astructiav__gdma__copy_html"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html">iav_gdma_copy</a></div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a0d0bde0d1958779c9220d9a5501b14e4"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a0d0bde0d1958779c9220d9a5501b14e4">iav_gdma_copy::dst_mmap_type</a></div><div class="ttdeci">u32 dst_mmap_type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1965</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a12669f6c0f6cc6c1e39ac929c91df9a1"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a12669f6c0f6cc6c1e39ac929c91df9a1">iav_gdma_copy::dst_pitch</a></div><div class="ttdeci">u16 dst_pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1950</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a1c0b148c0d6c4ba4d318178fa7dd2557"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a1c0b148c0d6c4ba4d318178fa7dd2557">iav_gdma_copy::src_mmap_type</a></div><div class="ttdeci">u32 src_mmap_type</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1961</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a311c949c3fef26a92db0d704c9e7225c"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a311c949c3fef26a92db0d704c9e7225c">iav_gdma_copy::src_pitch</a></div><div class="ttdeci">u16 src_pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1949</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a5008710d9c1103d9591b3eda550b63f7"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a5008710d9c1103d9591b3eda550b63f7">iav_gdma_copy::dst_offset</a></div><div class="ttdeci">unsigned long dst_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1945</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a5103232dda61eefd81b5b849643c5753"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a5103232dda61eefd81b5b849643c5753">iav_gdma_copy::width</a></div><div class="ttdeci">u16 width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1958</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_a97949d79559df32a6ff2d2b423b0be39"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#a97949d79559df32a6ff2d2b423b0be39">iav_gdma_copy::src_offset</a></div><div class="ttdeci">unsigned long src_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1940</div></div>
<div class="ttc" id="astructiav__gdma__copy_html_add40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../library/de/d11/structiav__gdma__copy.html#add40f8a56ae8cc650f92a3aa4d2bac99">iav_gdma_copy::height</a></div><div class="ttdeci">u32 height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1959</div></div>
<div class="ttc" id="astructiav__me__cap_html"><div class="ttname"><a href="../../../library/dd/d42/structiav__me__cap.html">iav_me_cap</a></div></div>
<div class="ttc" id="astructiav__me__cap_html_a16f01e9ac75392f8e05471ead76a95ae"><div class="ttname"><a href="../../../library/dd/d42/structiav__me__cap.html#a16f01e9ac75392f8e05471ead76a95ae">iav_me_cap::data_addr_offset</a></div><div class="ttdeci">unsigned long data_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2195</div></div>
<div class="ttc" id="astructiav__me__cap_html_a85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../../library/dd/d42/structiav__me__cap.html#a85db88ffee2944ecd35c616393976289">iav_me_cap::width</a></div><div class="ttdeci">u32 width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2188</div></div>
<div class="ttc" id="astructiav__me__cap_html_acd497cc6637ae5062f58897e65e16193"><div class="ttname"><a href="../../../library/dd/d42/structiav__me__cap.html#acd497cc6637ae5062f58897e65e16193">iav_me_cap::pitch</a></div><div class="ttdeci">u32 pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2190</div></div>
<div class="ttc" id="astructiav__me__cap_html_add40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../library/dd/d42/structiav__me__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">iav_me_cap::height</a></div><div class="ttdeci">u32 height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2189</div></div>
<div class="ttc" id="astructiav__mem__info_html_a9ee64c7b918513891b3834b93ad0e501"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#a9ee64c7b918513891b3834b93ad0e501">iav_mem_info::length</a></div><div class="ttdeci">unsigned long length</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1842</div></div>
<div class="ttc" id="astructiav__mem__info_html_afde02ab53128286716345a7e3da30a7e"><div class="ttname"><a href="../../../library/da/dae/structiav__mem__info.html#afde02ab53128286716345a7e3da30a7e">iav_mem_info::addr</a></div><div class="ttdeci">unsigned long addr</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1841</div></div>
<div class="ttc" id="astructiav__mem__layout__canvas_html"><div class="ttname"><a href="../../../library/d2/dd3/structiav__mem__layout__canvas.html">iav_mem_layout_canvas</a></div></div>
<div class="ttc" id="astructiav__mem__layout__canvas_html_a5ea707d750b2aaa86d0311f93deeafff"><div class="ttname"><a href="../../../library/d2/dd3/structiav__mem__layout__canvas.html#a5ea707d750b2aaa86d0311f93deeafff">iav_mem_layout_canvas::phys_base</a></div><div class="ttdeci">unsigned long phys_base</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1685</div></div>
<div class="ttc" id="astructiav__mem__layout__canvas_html_a625dedeb528813af594cc20679364571"><div class="ttname"><a href="../../../library/d2/dd3/structiav__mem__layout__canvas.html#a625dedeb528813af594cc20679364571">iav_mem_layout_canvas::buf_layout</a></div><div class="ttdeci">struct iav_mem_layout buf_layout[IAV_MAX_CANVAS_BUF_NUM]</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1688</div></div>
<div class="ttc" id="astructiav__mem__layout__info_html"><div class="ttname"><a href="../../../library/d5/df0/structiav__mem__layout__info.html">iav_mem_layout_info</a></div></div>
<div class="ttc" id="astructiav__mem__layout__info_html_a30f848b3d8b434233acff21a538f85cc"><div class="ttname"><a href="../../../library/d5/df0/structiav__mem__layout__info.html#a30f848b3d8b434233acff21a538f85cc">iav_mem_layout_info::canvas_pool_layout</a></div><div class="ttdeci">struct iav_mem_layout_canvas canvas_pool_layout</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1705</div></div>
<div class="ttc" id="astructiav__mem__layout__info_html_aed8ff96a020be93ee12a6e6f24b6e21e"><div class="ttname"><a href="../../../library/d5/df0/structiav__mem__layout__info.html#aed8ff96a020be93ee12a6e6f24b6e21e">iav_mem_layout_info::raw_pool_layout</a></div><div class="ttdeci">struct iav_mem_layout_raw_pool raw_pool_layout</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1704</div></div>
<div class="ttc" id="astructiav__mem__layout__raw__pool_html"><div class="ttname"><a href="../../../library/d6/d27/structiav__mem__layout__raw__pool.html">iav_mem_layout_raw_pool</a></div></div>
<div class="ttc" id="astructiav__mem__layout__raw__pool_html_a5ea707d750b2aaa86d0311f93deeafff"><div class="ttname"><a href="../../../library/d6/d27/structiav__mem__layout__raw__pool.html#a5ea707d750b2aaa86d0311f93deeafff">iav_mem_layout_raw_pool::phys_base</a></div><div class="ttdeci">unsigned long phys_base</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1692</div></div>
<div class="ttc" id="astructiav__mem__layout__raw__pool_html_a8782bac11623f5def2d2bc8444d5072e"><div class="ttname"><a href="../../../library/d6/d27/structiav__mem__layout__raw__pool.html#a8782bac11623f5def2d2bc8444d5072e">iav_mem_layout_raw_pool::buf_layout</a></div><div class="ttdeci">struct iav_mem_layout buf_layout[IAV_MAX_REAL_VIN_NUM]</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1695</div></div>
<div class="ttc" id="astructiav__mem__layout_html_a438d9043168d90b8e757f353a4f7867d"><div class="ttname"><a href="../../../library/df/d2e/structiav__mem__layout.html#a438d9043168d90b8e757f353a4f7867d">iav_mem_layout::unit_num</a></div><div class="ttdeci">u32 unit_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1666</div></div>
<div class="ttc" id="astructiav__mem__layout_html_a4ba37e6b40e12ce1d1e5dbee0323069d"><div class="ttname"><a href="../../../library/df/d2e/structiav__mem__layout.html#a4ba37e6b40e12ce1d1e5dbee0323069d">iav_mem_layout::offset</a></div><div class="ttdeci">u32 offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1663</div></div>
<div class="ttc" id="astructiav__mem__layout_html_ab6f6e9a74595b722b09d32114c76b08c"><div class="ttname"><a href="../../../library/df/d2e/structiav__mem__layout.html#ab6f6e9a74595b722b09d32114c76b08c">iav_mem_layout::unit_size</a></div><div class="ttdeci">u32 unit_size</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1665</div></div>
<div class="ttc" id="astructiav__mem__part__info_html"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html">iav_mem_part_info</a></div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a189394c6bbc0d36422df8c5bc2ee1962"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a189394c6bbc0d36422df8c5bc2ee1962">iav_mem_part_info::pid</a></div><div class="ttdeci">u32 pid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1847</div></div>
<div class="ttc" id="astructiav__mem__part__info_html_a3bc6cd5f612ef6d8254970d363348350"><div class="ttname"><a href="../../../library/d1/d73/structiav__mem__part__info.html#a3bc6cd5f612ef6d8254970d363348350">iav_mem_part_info::mem</a></div><div class="ttdeci">struct iav_mem_info mem</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1848</div></div>
<div class="ttc" id="astructiav__querydesc_html"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html">iav_querydesc</a></div></div>
<div class="ttc" id="astructiav__querydesc_html_a5cd6fb272dd1d5453eb1458556323b9c"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#a5cd6fb272dd1d5453eb1458556323b9c">iav_querydesc::raw</a></div><div class="ttdeci">struct iav_rawbufdesc raw</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2417</div></div>
<div class="ttc" id="astructiav__querydesc_html_a8f1abab245b551bdff8a16e77bf819e9"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#a8f1abab245b551bdff8a16e77bf819e9">iav_querydesc::canvas</a></div><div class="ttdeci">struct iav_canvasdesc canvas</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2419</div></div>
<div class="ttc" id="astructiav__querydesc_html_a99c68192c9905f231a62a98ee6534cbb"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#a99c68192c9905f231a62a98ee6534cbb">iav_querydesc::arg</a></div><div class="ttdeci">union iav_querydesc::@71 arg</div></div>
<div class="ttc" id="astructiav__querydesc_html_aa73b12ace6ac7df824707a89ac4f91ff"><div class="ttname"><a href="../../../library/d8/de5/structiav__querydesc.html#aa73b12ace6ac7df824707a89ac4f91ff">iav_querydesc::qid</a></div><div class="ttdeci">enum iav_desc_id qid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2413</div></div>
<div class="ttc" id="astructiav__queryinfo_html"><div class="ttname"><a href="../../../library/db/d5e/structiav__queryinfo.html">iav_queryinfo</a></div></div>
<div class="ttc" id="astructiav__queryinfo_html_a9c6b243764195cdf9bc3b73afab15e67"><div class="ttname"><a href="../../../library/db/d5e/structiav__queryinfo.html#a9c6b243764195cdf9bc3b73afab15e67">iav_queryinfo::qid</a></div><div class="ttdeci">enum iav_info_id qid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1171</div></div>
<div class="ttc" id="astructiav__queryinfo_html_ad697b7616a385b827252c9eaf05c40cb"><div class="ttname"><a href="../../../library/db/d5e/structiav__queryinfo.html#ad697b7616a385b827252c9eaf05c40cb">iav_queryinfo::stream</a></div><div class="ttdeci">struct iav_stream_info stream</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1176</div></div>
<div class="ttc" id="astructiav__queryinfo_html_ade33181cf2ac4bf3f4c607b879c42b72"><div class="ttname"><a href="../../../library/db/d5e/structiav__queryinfo.html#ade33181cf2ac4bf3f4c607b879c42b72">iav_queryinfo::arg</a></div><div class="ttdeci">union iav_queryinfo::@54 arg</div></div>
<div class="ttc" id="astructiav__querymem_html"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html">iav_querymem</a></div></div>
<div class="ttc" id="astructiav__querymem_html_a01d475486b14a28a0583e09be9e66982"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a01d475486b14a28a0583e09be9e66982">iav_querymem::partition</a></div><div class="ttdeci">struct iav_mem_part_info partition</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1925</div></div>
<div class="ttc" id="astructiav__querymem_html_a5955e20d0c53be1145cf813759d92d67"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#a5955e20d0c53be1145cf813759d92d67">iav_querymem::arg</a></div><div class="ttdeci">union iav_querymem::@61 arg</div></div>
<div class="ttc" id="astructiav__querymem_html_ae056de5bb92261e7a28350beeb5320f8"><div class="ttname"><a href="../../../library/de/dc3/structiav__querymem.html#ae056de5bb92261e7a28350beeb5320f8">iav_querymem::mid</a></div><div class="ttdeci">enum iav_mem_id mid</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1923</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html">iav_raw_enc_cfg</a></div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a09231b55490ecef4330af8b002c8c373"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a09231b55490ecef4330af8b002c8c373">iav_raw_enc_cfg::total_buf_num</a></div><div class="ttdeci">u8 total_buf_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3595</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a243a4bc34640c52bdcd3b3807e0bc88a"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a243a4bc34640c52bdcd3b3807e0bc88a">iav_raw_enc_cfg::raw_hdec_height</a></div><div class="ttdeci">u16 raw_hdec_height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3602</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a371a617a9bb42977a24e8cceb7f28d1e"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a371a617a9bb42977a24e8cceb7f28d1e">iav_raw_enc_cfg::raw_height</a></div><div class="ttdeci">u16 raw_height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3601</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a3f44cdf6a01b1ed33ee2b294852bc667"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a3f44cdf6a01b1ed33ee2b294852bc667">iav_raw_enc_cfg::raw_hdec_pitch</a></div><div class="ttdeci">u16 raw_hdec_pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3598</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a5812a880ef7a7bcd41f4506138ff782e"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a5812a880ef7a7bcd41f4506138ff782e">iav_raw_enc_cfg::raw_width</a></div><div class="ttdeci">u16 raw_width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3599</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a6d27f67e8f31e8048673a6f173b27ba8"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6d27f67e8f31e8048673a6f173b27ba8">iav_raw_enc_cfg::raw_max_height</a></div><div class="ttdeci">u16 raw_max_height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3596</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a6f1d5bb48e5e918d7918fe33b8fb52ac"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a6f1d5bb48e5e918d7918fe33b8fb52ac">iav_raw_enc_cfg::raw_pitch</a></div><div class="ttdeci">u16 raw_pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3597</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a77e017ad1f77b3a55444812a32088d64"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a77e017ad1f77b3a55444812a32088d64">iav_raw_enc_cfg::is_from_ext_mem</a></div><div class="ttdeci">u32 is_from_ext_mem</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3605</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a7bc625ecd09c4d6672f5f52022238898"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a7bc625ecd09c4d6672f5f52022238898">iav_raw_enc_cfg::raw_hdec_buf_addr</a></div><div class="ttdeci">unsigned long raw_hdec_buf_addr</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3604</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_a9bff1f81783f904d7caa7edf3c9e4828"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#a9bff1f81783f904d7caa7edf3c9e4828">iav_raw_enc_cfg::raw_buf_addr</a></div><div class="ttdeci">unsigned long raw_buf_addr</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3603</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_ad48d706a7ccf63d2518eb8f6f8b4d3ee"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#ad48d706a7ccf63d2518eb8f6f8b4d3ee">iav_raw_enc_cfg::vinc_id</a></div><div class="ttdeci">u8 vinc_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3594</div></div>
<div class="ttc" id="astructiav__raw__enc__cfg_html_ae7c0bbc1241ec9a23c4ffd0755f0c149"><div class="ttname"><a href="../../../library/dc/db6/structiav__raw__enc__cfg.html#ae7c0bbc1241ec9a23c4ffd0755f0c149">iav_raw_enc_cfg::raw_hdec_width</a></div><div class="ttdeci">u16 raw_hdec_width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3600</div></div>
<div class="ttc" id="astructiav__raw__enc__setup_html"><div class="ttname"><a href="../../../library/d2/d5e/structiav__raw__enc__setup.html">iav_raw_enc_setup</a></div></div>
<div class="ttc" id="astructiav__raw__enc__setup_html_a026152937e063c9685cde0d6da188305"><div class="ttname"><a href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a026152937e063c9685cde0d6da188305">iav_raw_enc_setup::frame_pts</a></div><div class="ttdeci">u64 frame_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3615</div></div>
<div class="ttc" id="astructiav__raw__enc__setup_html_a86aaeaa289cbe23f062a634e9f6f06c2"><div class="ttname"><a href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a86aaeaa289cbe23f062a634e9f6f06c2">iav_raw_enc_setup::mono_pts</a></div><div class="ttdeci">u64 mono_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3616</div></div>
<div class="ttc" id="astructiav__raw__enc__setup_html_a960a38adb165a70f961acd7038915e23"><div class="ttname"><a href="../../../library/d2/d5e/structiav__raw__enc__setup.html#a960a38adb165a70f961acd7038915e23">iav_raw_enc_setup::raw_hdec_daddr_buf_idx</a></div><div class="ttdeci">u8 raw_hdec_daddr_buf_idx</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3613</div></div>
<div class="ttc" id="astructiav__raw__enc__setup_html_ad48d706a7ccf63d2518eb8f6f8b4d3ee"><div class="ttname"><a href="../../../library/d2/d5e/structiav__raw__enc__setup.html#ad48d706a7ccf63d2518eb8f6f8b4d3ee">iav_raw_enc_setup::vinc_id</a></div><div class="ttdeci">u8 vinc_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3611</div></div>
<div class="ttc" id="astructiav__raw__enc__setup_html_af95b8a73365a3b46171c83786387379f"><div class="ttname"><a href="../../../library/d2/d5e/structiav__raw__enc__setup.html#af95b8a73365a3b46171c83786387379f">iav_raw_enc_setup::raw_daddr_buf_idx</a></div><div class="ttdeci">u8 raw_daddr_buf_idx</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:3612</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html">iav_rawbufdesc</a></div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_a0d4d0a98d64cba20aaf8e4fc5735c6ba"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#a0d4d0a98d64cba20aaf8e4fc5735c6ba">iav_rawbufdesc::is_dsp_hw_pts</a></div><div class="ttdeci">u32 is_dsp_hw_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2096</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_a3e79318d5450a7237b8b26540d294c02"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#a3e79318d5450a7237b8b26540d294c02">iav_rawbufdesc::dsp_pts</a></div><div class="ttdeci">u32 dsp_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2111</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_a5e73c34ecc25399bf626f162618c9467"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#a5e73c34ecc25399bf626f162618c9467">iav_rawbufdesc::raw_addr_offset</a></div><div class="ttdeci">unsigned long raw_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2110</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_a65ab2a7e837fe71b9088a96bf1383287"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#a65ab2a7e837fe71b9088a96bf1383287">iav_rawbufdesc::ce_pitch</a></div><div class="ttdeci">u16 ce_pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2113</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_a8054907a7ac004bf54b0376ef0e7b68e"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#a8054907a7ac004bf54b0376ef0e7b68e">iav_rawbufdesc::ce_width</a></div><div class="ttdeci">u16 ce_width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2114</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_a85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#a85db88ffee2944ecd35c616393976289">iav_rawbufdesc::width</a></div><div class="ttdeci">u32 width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2105</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_a86aaeaa289cbe23f062a634e9f6f06c2"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#a86aaeaa289cbe23f062a634e9f6f06c2">iav_rawbufdesc::mono_pts</a></div><div class="ttdeci">u64 mono_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2109</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_a9651609c41d100c012697b5847c94a35"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#a9651609c41d100c012697b5847c94a35">iav_rawbufdesc::delay_frames</a></div><div class="ttdeci">u32 delay_frames</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2103</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_aa862cf8c61aa0b5952fce3b1456d8e58"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#aa862cf8c61aa0b5952fce3b1456d8e58">iav_rawbufdesc::raw_base_addr_offset</a></div><div class="ttdeci">unsigned long raw_base_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2120</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_acd497cc6637ae5062f58897e65e16193"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#acd497cc6637ae5062f58897e65e16193">iav_rawbufdesc::pitch</a></div><div class="ttdeci">u32 pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2108</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_ad8249632e6536acaee21e364da350419"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#ad8249632e6536acaee21e364da350419">iav_rawbufdesc::vin_id</a></div><div class="ttdeci">u32 vin_id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2094</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_add40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#add40f8a56ae8cc650f92a3aa4d2bac99">iav_rawbufdesc::height</a></div><div class="ttdeci">u32 height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2107</div></div>
<div class="ttc" id="astructiav__rawbufdesc_html_afd839666b69f0e4e24ef81f81b756a00"><div class="ttname"><a href="../../../library/d9/dfe/structiav__rawbufdesc.html#afd839666b69f0e4e24ef81f81b756a00">iav_rawbufdesc::skip_cache_sync</a></div><div class="ttdeci">u32 skip_cache_sync</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2101</div></div>
<div class="ttc" id="astructiav__stream__info_html"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html">iav_stream_info</a></div></div>
<div class="ttc" id="astructiav__stream__info_html_a76f8ba65ce8f902c0657233adee58698"><div class="ttname"><a href="../../../library/d8/d08/structiav__stream__info.html#a76f8ba65ce8f902c0657233adee58698">iav_stream_info::id</a></div><div class="ttdeci">u32 id</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1075</div></div>
<div class="ttc" id="astructiav__system__resource_html"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html">iav_system_resource</a></div></div>
<div class="ttc" id="astructiav__system__resource_html_a035a9d1a4c2696cdc5944e537e3b049e"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html#a035a9d1a4c2696cdc5944e537e3b049e">iav_system_resource::enc_raw_yuv</a></div><div class="ttdeci">u32 enc_raw_yuv</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1258</div></div>
<div class="ttc" id="astructiav__system__resource_html_a2c47e2f21d864f674304b03836972be4"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html#a2c47e2f21d864f674304b03836972be4">iav_system_resource::enc_raw_nv12</a></div><div class="ttdeci">u32 enc_raw_nv12</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1259</div></div>
<div class="ttc" id="astructiav__system__resource_html_a42f03995f03acd4c0dc2a174cadb648d"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html#a42f03995f03acd4c0dc2a174cadb648d">iav_system_resource::chan_num</a></div><div class="ttdeci">u8 chan_num</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1245</div></div>
<div class="ttc" id="astructiav__system__resource_html_a8818e6e6ff702b046f2647b4e013dba1"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html#a8818e6e6ff702b046f2647b4e013dba1">iav_system_resource::enc_raw_rgb</a></div><div class="ttdeci">u32 enc_raw_rgb</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1257</div></div>
<div class="ttc" id="astructiav__system__resource_html_ab16f548b2c418aee70c310a931fdfab1"><div class="ttname"><a href="../../../library/df/d3a/structiav__system__resource.html#ab16f548b2c418aee70c310a931fdfab1">iav_system_resource::encode_mode</a></div><div class="ttdeci">u8 encode_mode</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:1238</div></div>
<div class="ttc" id="astructiav__window_html"><div class="ttname"><a href="../../dc/d76/structiav__window.html">iav_window</a></div><div class="ttdoc">IAV Window Size.</div><div class="ttdef"><b>Definition:</b> basetypes.h:95</div></div>
<div class="ttc" id="astructiav__yuv__cap_html"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html">iav_yuv_cap</a></div></div>
<div class="ttc" id="astructiav__yuv__cap_html_a3e79318d5450a7237b8b26540d294c02"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#a3e79318d5450a7237b8b26540d294c02">iav_yuv_cap::dsp_pts</a></div><div class="ttdeci">u32 dsp_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2181</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_a4eb7b75b76c9314ccc6582b332fdfb9d"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#a4eb7b75b76c9314ccc6582b332fdfb9d">iav_yuv_cap::uv_addr_offset</a></div><div class="ttdeci">unsigned long uv_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2184</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_a7ed2668fc9c18679b1a349a2f6914f3f"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#a7ed2668fc9c18679b1a349a2f6914f3f">iav_yuv_cap::y_addr_offset</a></div><div class="ttdeci">unsigned long y_addr_offset</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2183</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_a85db88ffee2944ecd35c616393976289"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#a85db88ffee2944ecd35c616393976289">iav_yuv_cap::width</a></div><div class="ttdeci">u32 width</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2176</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_a86aaeaa289cbe23f062a634e9f6f06c2"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#a86aaeaa289cbe23f062a634e9f6f06c2">iav_yuv_cap::mono_pts</a></div><div class="ttdeci">u64 mono_pts</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2182</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_acd497cc6637ae5062f58897e65e16193"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#acd497cc6637ae5062f58897e65e16193">iav_yuv_cap::pitch</a></div><div class="ttdeci">u32 pitch</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2178</div></div>
<div class="ttc" id="astructiav__yuv__cap_html_add40f8a56ae8cc650f92a3aa4d2bac99"><div class="ttname"><a href="../../../library/dc/d6a/structiav__yuv__cap.html#add40f8a56ae8cc650f92a3aa4d2bac99">iav_yuv_cap::height</a></div><div class="ttdeci">u32 height</div><div class="ttdef"><b>Definition:</b> iav_ioctl.h:2177</div></div>
<div class="ttc" id="astructvin__global__info_html"><div class="ttname"><a href="../../../library/d7/d28/structvin__global__info.html">vin_global_info</a></div></div>
<div class="ttc" id="astructvin__global__info_html_a00ca1a1ae2c71f63a8c221f59b5d2f9a"><div class="ttname"><a href="../../../library/d7/d28/structvin__global__info.html#a00ca1a1ae2c71f63a8c221f59b5d2f9a">vin_global_info::vsrc_map</a></div><div class="ttdeci">unsigned int vsrc_map[AMBA_VINC_MAX_NUM]</div><div class="ttdef"><b>Definition:</b> iav_vin_common.h:800</div></div>
<div class="ttc" id="astructvindev__devinfo_html"><div class="ttname"><a href="../../../library/d2/ddf/structvindev__devinfo.html">vindev_devinfo</a></div></div>
<div class="ttc" id="astructvindev__devinfo_html_a46b71fcd4a1b1b6b2f60e9ea79030a6d"><div class="ttname"><a href="../../../library/d2/ddf/structvindev__devinfo.html#a46b71fcd4a1b1b6b2f60e9ea79030a6d">vindev_devinfo::vinc_id</a></div><div class="ttdeci">unsigned int vinc_id</div><div class="ttdef"><b>Definition:</b> iav_vin_common.h:455</div></div>
<div class="ttc" id="astructvindev__devinfo_html_aa1ecb62f419c3b454f5a2d4fd18d4818"><div class="ttname"><a href="../../../library/d2/ddf/structvindev__devinfo.html#aa1ecb62f419c3b454f5a2d4fd18d4818">vindev_devinfo::vsrc_id</a></div><div class="ttdeci">unsigned int vsrc_id</div><div class="ttdef"><b>Definition:</b> iav_vin_common.h:454</div></div>
<div class="ttc" id="atest__efm_8h_html"><div class="ttname"><a href="../../../video/d3/d9f/test__efm_8h.html">test_efm.h</a></div></div>
<div class="ttc" id="atest__efm_8h_html_a2e9b2d078c1fb89a8e683b2215186f63a9192f26f9296b3e4ac550642ed0a13a5"><div class="ttname"><a href="../../../video/d3/d9f/test__efm_8h.html#a2e9b2d078c1fb89a8e683b2215186f63a9192f26f9296b3e4ac550642ed0a13a5">FIXED_PATTERN_FLAG</a></div><div class="ttdeci">FIXED_PATTERN_FLAG</div></div>
<div class="ttc" id="atest__efm_8h_html_a2e9b2d078c1fb89a8e683b2215186f63ac1c5aa1f9aeb910aa410d126ea642b6f"><div class="ttname"><a href="../../../video/d3/d9f/test__efm_8h.html#a2e9b2d078c1fb89a8e683b2215186f63ac1c5aa1f9aeb910aa410d126ea642b6f">CE_SIZE_FLAG</a></div><div class="ttdeci">CE_SIZE_FLAG</div></div>
<div class="ttc" id="atest__vout__cfg_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../../video/db/d1a/test__vout__cfg_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div></div>
<div class="ttc" id="avin__init_8c_html_a5294002f7dca0cd9bcc0009a27895ef7"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a5294002f7dca0cd9bcc0009a27895ef7">fd_iav</a></div><div class="ttdeci">int fd_iav</div></div>
<div class="ttc" id="avout__init__cfg_8c_html_a88a5b93883c34229851d6a7a93254850"><div class="ttname"><a href="../../../video/de/ddf/vout__init__cfg_8c.html#a88a5b93883c34229851d6a7a93254850">AM_IOCTL</a></div><div class="ttdeci">#define AM_IOCTL(_filp, _cmd, _arg)</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
