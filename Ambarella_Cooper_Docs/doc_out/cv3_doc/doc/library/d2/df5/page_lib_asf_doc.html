<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: Ambarella Simulation Framework Library API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Library<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d2/df5/page_lib_asf_doc.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Ambarella Simulation Framework Library API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="asf_history"></a>
0. Revision History</h1>
<a class="anchor" id="asf_lib_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Library Version </th><th align="left">Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td>0.0.2 </td><td>20220517 </td><td>Initial Version </td></tr>
<tr>
<td>0.0.2 </td><td>20230227 </td><td>Added more JSON examples </td></tr>
<tr>
<td>0.0.2 </td><td>20230412 </td><td>Added troubleshooting sections. Updated compile steps for common plugin version 0.2.0. </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="asf_intro"></a>
1. ASF Introduction</h1>
<h2><a class="anchor" id="asf_intro_overview"></a>
1.1 Overview</h2>
<p >The Ambarella simulation framework (ASF) provides a solution: per the developer's requirements, ASF captures remote data in one time-space and simulates it locally in another time-space. Through the simulation, developers can get the same test environment and real data as the remote side, which is more efficient and user-friendly for debugging or algorithm optimization.</p>
<dl class="section user"><dt>Advantages:</dt><dd><ul>
<li>ASF can be deployed easily to any Ambarella camera to record data from multiple different devices (inertial measurement unit (IMU), radar, lidar, vision sensor, controller area network (CAN), and more), repack on PC or ArmÂ®, and replay on the same hardware board.</li>
<li>Unified format: based on ASF format, customers can migrate the development of the "replay" stage among different Ambarella platforms (from CV2x to CV5x, or CV3 and future chips).</li>
<li>Database: customers can easily search, select, split, merge, and view the "recorded" data. graphical user interface (GUI) tool.</li>
<li>Time stamp accuracy: customers can align multiple devices in the same time domain and adjust the data in the repack and replay stages.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="asf_intro_3r"></a>
1.2 Record, Repack, and Replay</h2>
<p >Within this framework, there are three main processes: record, repack, and replay. </p><dl class="section user"><dt>Record</dt><dd>Capture and store data blocks continuously from the data provider. The database is also used to record key data information. </dd></dl>
<dl class="section user"><dt>Repack</dt><dd>According to the data information in the database, repack data sequences with specified rules (such as presentation time stamp (PTS), device dependencies, and more). </dd></dl>
<dl class="section user"><dt>Replay</dt><dd>Replay the repacked data on the local device.</dd></dl>
<div class="image">
<img src="../../3r.png" alt=""/>
<div class="caption">
Figure 1-1. Record, Repack, and Replay.</div></div>
<h2><a class="anchor" id="asf_intro_structure"></a>
1.3 Data Structure</h2>
<div class="image">
<img src="../../asf_structure.png" alt=""/>
<div class="caption">
Figure 1-2. Data Structure.</div></div>
<p >The following tables provide details of the ASF data structure. </p><dl class="section user"><dt>struct asf_block_info</dt><dd><a class="anchor" id="asf_block_info"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Item</th><th align="left">Description </th></tr>
<tr>
<td><b>type</b></td><td><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#ga8fd251101ebdb52e0b6b4f0e1e0f0e8e">asf_block_type</a> </td></tr>
<tr>
<td><b>enable</b></td><td>Block enable flag </td></tr>
<tr>
<td><b>unit_size</b></td><td>Block data unit size </td></tr>
<tr>
<td><b>unit_num</b></td><td>Block data unit number </td></tr>
<tr>
<td><b>offset</b></td><td>Start offset of block data from <a class="el" href="../../d2/df5/page_lib_asf_doc.html#asf_header">asf_header</a> </td></tr>
<tr>
<td><b>crc</b></td><td>Cyclic redundancy check (CRC) value for block data integrity check </td></tr>
<tr>
<td><b>dev_id</b></td><td>Device ID for block </td></tr>
<tr>
<td><b>sys_time</b></td><td>Capture time based on system timer </td></tr>
<tr>
<td><b>mono_time</b></td><td>Capture time based on hardware timer </td></tr>
<tr>
<td><b>user_time</b></td><td>Reserved for user-defined timer </td></tr>
</table>
</dd></dl>
<dl class="section user"><dt>struct asf_header</dt><dd><a class="anchor" id="asf_header"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Item</th><th align="left">Description </th></tr>
<tr>
<td><b>magic_number</b></td><td><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#gab11ef388c358b0aebb66deeef4379489">ASF_HEADER_MAGIC</a> </td></tr>
<tr>
<td><b>version</b></td><td><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#ga690324550937ed448a610abbba66e6f1">asf_header_version</a> </td></tr>
<tr>
<td><b>header_size</b></td><td>ASF cluster header size </td></tr>
<tr>
<td><b>data_size</b></td><td>Total ASF cluster data size </td></tr>
<tr>
<td><b>block_num</b></td><td>ASF cluster block number </td></tr>
<tr>
<td><b>crc</b></td><td>CRC value for ASF data integrity check </td></tr>
<tr>
<td><b>descriptor</b></td><td>ASF descriptor </td></tr>
<tr>
<td><b>block_info</b></td><td><a class="el" href="../../d2/df5/page_lib_asf_doc.html#asf_block_info">asf_block_info</a> </td></tr>
</table>
</dd></dl>
<hr  />
<h1><a class="anchor" id="asf_record"></a>
2. Record</h1>
<div class="image">
<img src="../../general_record_flow.png" alt=""/>
<div class="caption">
Figure 2-1. Record Flow.</div></div>
<h2><a class="anchor" id="asf_record_type"></a>
2.1 Supported Record Data Types</h2>
<p >The record process currently supports the following data types:</p><ul>
<li>System</li>
<li>Sensor</li>
<li>Gyro</li>
<li>Bitstream</li>
</ul>
<p >For data type details, see section <a class="el" href="../../d2/df5/page_lib_asf_doc.html#asf_record_plugin">2.2 Record Plugins</a>.</p>
<h2><a class="anchor" id="asf_record_plugin"></a>
2.2 Record Plugins</h2>
<p >In order to more flexibly expand various data recordings, ASF uses plugins to meet this requirement.</p>
<h3><a class="anchor" id="asf_record_plugin_type"></a>
2.2.1 Customized Record Data Types</h3>
<p >The following table details the storage types that Ambarella currently supports in the plugin method. </p><a class="anchor" id="supported_plugin"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Module</th><th align="left">Plugin</th><th align="left">Data Type</th><th align="left">Info Type</th><th align="left">Option</th><th align="left">Description </th></tr>
<tr>
<td><b>Sensor</b></td><td>libasf_common.so </td><td><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#gga8fd251101ebdb52e0b6b4f0e1e0f0e8ea7cd11909e82aa07a3bb8a9e971ffc108">ASF_BLOCK_SENSOR</a> </td><td><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#gga8fd251101ebdb52e0b6b4f0e1e0f0e8ea4c36eddc777a5fbab59b2eaf0fa2b081">ASF_HW_INFO_BLOCK_SENSOR</a> </td><td><b>vsrc_id</b></td><td>Video source (vsrc) ID </td></tr>
<tr>
<td rowspan="2"><b>Gryo</b></td><td rowspan="2">libasf_common.so </td><td rowspan="2"><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#gga8fd251101ebdb52e0b6b4f0e1e0f0e8ea33c528ec0bbf7802ac459be55e82ea8d">ASF_BLOCK_GYRO</a> </td><td rowspan="2"><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#gga8fd251101ebdb52e0b6b4f0e1e0f0e8ea5413252cce1442008d92c88228136374">ASF_HW_INFO_BLOCK_GYRO</a> </td><td><b>id</b></td><td>Video input (VIN) ID </td></tr>
<tr>
<td><b>shift_realtime_enable</b></td><td>Calculate gyro initial shift before recording </td></tr>
<tr>
<td><b>Stream</b></td><td>libasf_common.so </td><td><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#gga8fd251101ebdb52e0b6b4f0e1e0f0e8ea194b6bb02925fd9d3f521a79b05af82b">ASF_BLOCK_BITSTREAM</a> </td><td>None</td><td><b>id</b> </td><td>Stream ID </td></tr>
</table>
<h3><a class="anchor" id="asf_record_plugin_add_new"></a>
2.2.2 Adding New Customized Plugins</h3>
<dl class="section user"><dt>Plugin Layout</dt><dd>A plugin consists of single or multiple modules. Modules are the smallest elements of a plugin. In general, a module at most contains two recording data processes. One process capture data frequently and save it as a data cluster. The other process is only required to capture data once and save it as an infomation cluster. <div class="image">
<img src="../../library_layout.png" alt=""/>
<div class="caption">
Figure 2-1. ASF Library Layout.</div></div>
</dd></dl>
<dl class="section user"><dt>Implement Module Functions</dt><dd>During the recording process, once a module is created, its related information will be recorded in the following structure: <a class="anchor" id="asf_block_obj"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Item</th><th align="left">Description </th></tr>
<tr>
<td><b>type</b></td><td><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#ga8fd251101ebdb52e0b6b4f0e1e0f0e8e">asf_block_type</a> </td></tr>
<tr>
<td><b>info_type</b></td><td><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#ga8fd251101ebdb52e0b6b4f0e1e0f0e8e">asf_block_type</a> </td></tr>
<tr>
<td><b>dev_id</b></td><td>Module device ID </td></tr>
<tr>
<td><b>uuid</b></td><td>Module unique universal identification (UUID) </td></tr>
<tr>
<td><b>name</b></td><td>Module name </td></tr>
<tr>
<td><b>serial_id</b></td><td>Moulde serial ID </td></tr>
<tr>
<td><b>description</b></td><td>Module description </td></tr>
<tr>
<td><b>mono_freq</b></td><td><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#ga51c521b8d8784a17fb9c866c68597ed9">ASF_DEFAULT_MONO_PTS_FREQ</a> </td></tr>
<tr>
<td><b>priv_data</b></td><td>Module private data pointer </td></tr>
<tr>
<td><b>ops</b></td><td><a class="el" href="../../dc/d7c/structasf__block__ops.html">asf_block_ops</a> </td></tr>
</table>
The following functions in <a class="el" href="../../dc/d7c/structasf__block__ops.html">asf_block_ops</a> must be realized in each module. <a class="anchor" id="ops function"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Function</th><th align="left">Description </th></tr>
<tr>
<td>int (*data_query)(void *args, struct asf_block* block)</td><td>Data query function </td></tr>
<tr>
<td>int (*info_query)(void *args, struct asf_block* block)</td><td>Infoquery function </td></tr>
<tr>
<td>int (*is_finish)(void)</td><td>Extra exit if required; Return "0" for no extra exit </td></tr>
</table>
</dd></dl>
<dl class="section user"><dt>Implement Plugin Functions</dt><dd>The following functions must be realized in each plugin: <a class="anchor" id="plugin function"></a>
<table class="doxtable">
<caption></caption>
<tr>
<td>int <a class="el" href="../../dd/d66/group__ASF__FUNCTION__GROUP.html#ga0c6eea0aee7e2897efb25fff3129780b">asf_get_module_num(void)</a></td><td>Get module number in plugin </td></tr>
<tr>
<td>int <a class="el" href="../../dd/d66/group__ASF__FUNCTION__GROUP.html#ga36f3dd41dda2fee9acca2e024366e84e">asf_get_module_name(u32 index, char *name)</a></td><td>Get module name in plugin through index </td></tr>
<tr>
<td>struct asf_block_obj* <a class="el" href="../../dd/d66/group__ASF__FUNCTION__GROUP.html#ga1f8a520bf86efe8e41f3a590940b0b0d">asf_create_module(char *name, cJSON *cfg)</a></td><td>Create module with specified module name </td></tr>
<tr>
<td>int <a class="el" href="../../dd/d66/group__ASF__FUNCTION__GROUP.html#ga9607d8f66b25fbcf4afb13010486929b">asf_delete_module(struct asf_block_obj *obj)</a></td><td>Delete module </td></tr>
<tr>
<td>void <a class="el" href="../../dd/d66/group__ASF__FUNCTION__GROUP.html#ga60e45be2e2e935e3d24628339a264244">asf_get_plugin_version(struct asf_plugin_version *version)</a></td><td>Get plugin version information </td></tr>
</table>
</dd></dl>
<dl class="section user"><dt>Add Makefile</dt><dd>Add the plugin makefile command in <code>ambarella/packages/asf/source/make.inc</code>. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>For more details, see the example in <code>ambarella/packages/asf/source/plugin_common/asf_common_plugin.c</code>.</dd></dl>
<h2><a class="anchor" id="asf_record_json"></a>
2.3 Record Configuration</h2>
<h3><a class="anchor" id="asf_record_json_mode"></a>
2.3.1 Record Mode and Event</h3>
<dl class="section user"><dt>Standard Mode</dt><dd>Record only once with a specified duration after an application starts. </dd></dl>
<dl class="section user"><dt>Trigger Mode</dt><dd>Data is temporarily stored in a ring buffer after the application starts. Users can save the data to a file by triggering an event. </dd></dl>
<dl class="section user"><dt>Event</dt><dd><b>Event</b> is introduced to distinguish the multiple recording actions in trigger mode. Each recording action is an event. When a recording application is running, the application logs the start and end time of the event in the database. In standard mode, as there is only one recording action and only one event.</dd></dl>
<h3><a class="anchor" id="asf_record_json_config"></a>
2.3.2 Configuration</h3>
<p >ASF recording uses JavaScript Object Notation (JSON) format text as a configuration file. </p><dl class="section user"><dt>Example: Record stream 0 in trigger mode</dt><dd><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;plugin&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;path&quot;: &quot;/usr/lib/libasf_common.so&quot;,</div>
<div class="line">            &quot;module&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;name&quot;: &quot;stream&quot;,</div>
<div class="line">                    &quot;cfg&quot;: {</div>
<div class="line">                        &quot;id&quot;: 0</div>
<div class="line">                    }</div>
<div class="line">                },</div>
<div class="line">            ]</div>
<div class="line">        }</div>
<div class="line">    ],</div>
<div class="line">    &quot;system&quot;: {</div>
<div class="line">        &quot;db_path&quot;: &quot;/tmp/test.db&quot;,</div>
<div class="line">        &quot;file_path&quot;: &quot;/tmp&quot;,</div>
<div class="line">        &quot;file_name&quot;: &quot;sample.bin&quot;,</div>
<div class="line">        &quot;file_size_limit_MB&quot;: 30,</div>
<div class="line">        &quot;cache_size_limit_MB&quot;: 32,</div>
<div class="line">        &quot;duration_second&quot;: 3,</div>
<div class="line">        &quot;mode&quot;: &quot;trigger&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Example: Record in standard mode for 10 seconds</dt><dd><div class="fragment"><div class="line">{</div>
<div class="line"> ...</div>
<div class="line">    &quot;system&quot;: {</div>
<div class="line">        &quot;db_path&quot;: &quot;/tmp/test.db&quot;,</div>
<div class="line">        &quot;file_path&quot;: &quot;/tmp&quot;,</div>
<div class="line">        &quot;file_name&quot;: &quot;sample.bin&quot;,</div>
<div class="line">        &quot;file_size_limit_MB&quot;: 30,</div>
<div class="line">        &quot;cache_size_limit_MB&quot;: 32,</div>
<div class="line">        &quot;duration_second&quot;: 10,</div>
<div class="line">        &quot;mode&quot;: &quot;standard&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<p>The following lists general option node details in configurations: </p><a class="anchor" id="record options"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Node</th><th align="left">Value Type</th><th align="left">Description </th></tr>
<tr>
<td><b>plugin</b></td><td>Array Node</td><td>Array node for all plugin binaries </td></tr>
<tr>
<td><b>path</b></td><td>String</td><td>Plugin binary path </td></tr>
<tr>
<td><b>module</b></td><td>Array Node</td><td>Array node for module enabled in plugin binary </td></tr>
<tr>
<td><b>name</b></td><td>String</td><td>Module name for parent module node </td></tr>
<tr>
<td><b>cfg</b></td><td>Node</td><td>Configuration node for parent module node; content is customized by the plugin module </td></tr>
<tr>
<td><b>system</b></td><td>Node</td><td>Node for general configurations </td></tr>
<tr>
<td><b>db_path</b></td><td>String</td><td>Record database path </td></tr>
<tr>
<td><b>file_path</b></td><td>String</td><td>Record data binary store path </td></tr>
<tr>
<td><b>file_name</b></td><td>String</td><td>Record data binary name </td></tr>
<tr>
<td><b>file_size_limit_MB</b></td><td>Number</td><td>For large amounts of data, the recording of data binaries is split into several blocks. This option determines the maximum size of a single block </td></tr>
<tr>
<td><b>cache_size_limit_MB</b></td><td>Number</td><td>Temporary memory size in trigger mode </td></tr>
<tr>
<td><b>duration_second</b></td><td>Number</td><td>Record duration in standard mode </td></tr>
<tr>
<td><b>mode</b></td><td>String</td><td>Mode option: "trigger" or "standard" </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Users can find the sample JSON record in <code>ambarella/packages/asf/unit_test/json_sample</code>.</dd></dl>
<h3><a class="anchor" id="asf_record_trigger_mode"></a>
2.3.3 Record in Trigger Mode</h3>
<p >Different from standard mode, the application will keep running in trigger mode until it is manually stopped by the user. Events are triggered by a specific message through the socket. The message should be sent in the format "cap:[pre second]:[post second]"; "pre second" represents the amount of time that the user wants to capture in the cache, while "post second" represents the amount of time that the user wants to capture during a livestream. The valid previous time duration depends the size of the cache configured by the user (<b>cache_size_limit_MB</b>). If the "pre second" duration is greater than the total cache time duration, the actual previous data duration will equal the total cache time. Currently, the socket IP is 127.0.0.1 and the port is 9000.</p>
<p >The following table shows the difference between two modes. </p><a class="anchor" id="record modes"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Mode</th><th align="left">Memory Usage</th><th align="left">Backtracking Support </th><th align="left">Multiple Recordings </th></tr>
<tr>
<td><b>Standard</b></td><td>Small</td><td>No</td><td>No </td></tr>
<tr>
<td><b>Trigger</b></td><td>Depand on cache size</td><td>Yes</td><td>Yes </td></tr>
</table>
<dl class="section user"><dt>Example: Record previous 10 seconds in trigger mode</dt><dd><div class="fragment"><div class="line">board A # test_asf --record-cfg record.json</div>
<div class="line">board B # nc 127.0.0.1 9000 //Use netcat and connect at 127.0.0.1:9000</div>
<div class="line">board B # cap:10:0</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Example: Record previous 5 s and 20 s live in trigger mode</dt><dd><div class="fragment"><div class="line">board A # test_asf --record-cfg record.json</div>
<div class="line">board B # nc 127.0.0.1 9000 //Use netcat and connect at 127.0.0.1:9000</div>
<div class="line">board B # cap:5:20</div>
</div><!-- fragment --></dd></dl>
<h2><a class="anchor" id="asf_record_compile"></a>
2.4 Compilation</h2>
<p >The following compile options must be configured before building the ASF recording application.</p><ul>
<li>Add ASF library &amp; test:</li>
<li>For CV2x SDK 3.0 Amba build: <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">[*] Ambarella Package Configuration  ---&gt;</div>
<div class="line">    [*]   Build Ambarella ASF library  ---&gt;</div>
<div class="line">        [*]   Build Ambarella ASF test app  packages</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">prebuild  ---&gt;</div>
<div class="line">    oss  ---&gt;</div>
<div class="line">        [*] prebuild-cjson (prebuild/oss/armv8-a/cjson)</div>
<div class="line">packages  ---&gt;</div>
<div class="line">    [*] libasf (packages/asf)</div>
<div class="line">    [*] asf-test (packages/asf)</div>
</div><!-- fragment --></li>
<li>For SDK Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">meta-ambalib  ---&gt;</div>
<div class="line">    recipes-video  ---&gt;</div>
<div class="line">         [*] libasf (meta-ambalib/recipes-video/libasf)</div>
<div class="line">meta-ambaapp  ---&gt;</div>
<div class="line">    recipes-test  ---&gt;</div>
<div class="line">         [*] asf-test (meta-ambaapp/recipes-test/asf-test)</div>
</div><!-- fragment --></li>
<li>Add Sqlite3 library</li>
<li>For CV2x SDK 3.0 Amba build: <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">[*] Ambarella File System Configuration  ---&gt;</div>
<div class="line">    Open Source Software (OSS)  ---&gt;</div>
<div class="line">        System Basic Libraries  ---&gt;</div>
<div class="line">            [*] Add SQLite into root_fs</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">prebuild  ---&gt;</div>
<div class="line">    oss  ---&gt;</div>
<div class="line">        [*] prebuild-sqlite (prebuild/oss/armv8-a/sqlite)</div>
</div><!-- fragment --></li>
<li>For SDK Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">meta-oe  ---&gt;</div>
<div class="line">    recipes-dbs  ---&gt;</div>
<div class="line">        [*] sqlite (meta-oe/recipes-dbs/sqlite)</div>
</div><!-- fragment --></li>
</ul>
<hr  />
<h1><a class="anchor" id="asf_repack"></a>
3. Repack</h1>
<p >Users can transform and reorganize record data using the repack application. Typically, there are four stages to the repack process.</p><ul>
<li>Sanity check: check each block item in the data base. Verify clusters and block CRC. Find the corrupted data in the binary.</li>
<li>Statistic: update the statistics of the module and check if any data was dropped.</li>
<li>Pre-process (optional): according to the configuration file, processed data is generated with source block data.</li>
<li>Repack: according to the configuration file, re-align the data according to the mono PTS (or system time) and reorganize it in a new cluster. <div class="image">
<img src="../../general_repack_flow.png" alt=""/>
<div class="caption">
Figure 3-1. Repack Flow.</div></div>
</li>
</ul>
<h2><a class="anchor" id="asf_repack_opt"></a>
3.1 Supported Repack Operations</h2>
<dl class="section user"><dt>Decode</dt><dd>This is a supported operation in the preprocess stage. This operation transforms H.264 and H.265 data into YUV data. </dd></dl>
<dl class="section user"><dt>Stream Extract</dt><dd>Extract stream data from a block and merge it into a single binary. </dd></dl>
<dl class="section user"><dt>Data Trim</dt><dd>This is an operation for all repack and supported action input data. This operation filters the data with specfied rules. The data trim operation can be divided into two types: item selection and time selection. With item selection, items can be filtered one by one. With time selection, items can be filtered by their system time. <div class="image">
<img src="../../trim_with_item.png" alt=""/>
<div class="caption">
Figure 3-2. Trim Item.</div></div>
 <div class="image">
<img src="../../trim_with_time.png" alt=""/>
<div class="caption">
Figure 3-3. Trim Time.</div></div>
 </dd></dl>
<dl class="section user"><dt>No Discard</dt><dd>In general, different types of source data will be aligned and repacked according to the mono PTS. If one portion of data does not match the others, it will be ignored in the repack process. The <b>no_discard</b> flag can be set if the user does not want this action to occur. In this case, all data can be packed in the repack process. <div class="image">
<img src="../../no_discard.png" alt=""/>
<div class="caption">
Figure 3-4. No Discard.</div></div>
</dd></dl>
<h2><a class="anchor" id="asf_repack_json"></a>
3.2 Repack Configuration</h2>
<p >ASF repack also uses the JSON format text as a configuration file. </p><dl class="section user"><dt>Example: Decode stream to YUV, then repack</dt><dd><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;preprocess&quot;: {</div>
<div class="line">        &quot;action&quot;: [</div>
<div class="line">            {</div>
<div class="line">                &quot;name&quot;: &quot;decode&quot;,</div>
<div class="line">                &quot;cfg&quot;: {</div>
<div class="line">                    &quot;input&quot;: [{</div>
<div class="line">                        &quot;data_type&quot;: 3,</div>
<div class="line">                        &quot;dev_id&quot;: 0,</div>
<div class="line">                        &quot;slice&quot;: {</div>
<div class="line">                            &quot;type&quot;: &quot;item&quot;,</div>
<div class="line">                            &quot;duration&quot;: 120</div>
<div class="line">                        }</div>
<div class="line">                    }],</div>
<div class="line">                    &quot;output&quot;: [{</div>
<div class="line">                        &quot;data_type&quot;: 2,</div>
<div class="line">                        &quot;dev_id&quot;: 0</div>
<div class="line">                    }]</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        ],</div>
<div class="line">        &quot;cfg&quot;: {</div>
<div class="line">            &quot;tmp_folder&quot;: &quot;tmp&quot;,</div>
<div class="line">            &quot;tmp_bin_size_limit_MB&quot;: 100</div>
<div class="line">        }</div>
<div class="line">    },</div>
<div class="line">    &quot;repack&quot; : {</div>
<div class="line">        &quot;input&quot;: [{</div>
<div class="line">            &quot;data_type&quot;: 2,</div>
<div class="line">            &quot;dev_id&quot;: 0,</div>
<div class="line">            &quot;no_discard&quot;: 1,</div>
<div class="line">            &quot;slice&quot;: {</div>
<div class="line">               &quot;type&quot;: &quot;time&quot;,</div>
<div class="line">                &quot;start&quot;: 1,</div>
<div class="line">                &quot;duration&quot;: 5</div>
<div class="line">            }</div>
<div class="line">        }],</div>
<div class="line">        &quot;cfg&quot;: {</div>
<div class="line">            &quot;output_name&quot;: &quot;sample_output.bin&quot;,</div>
<div class="line">            &quot;output_size_limit_MB&quot;: 150,</div>
<div class="line">            &quot;repack_pts_delta_factor&quot;: 0.49</div>
<div class="line">        },</div>
<div class="line">    },</div>
<div class="line">    &quot;system&quot;: {</div>
<div class="line">        &quot;event_id&quot;: [0],</div>
<div class="line">        &quot;work_folder&quot;: &quot;./sample&quot;,</div>
<div class="line">        &quot;db_name&quot;: &quot;test.db&quot;,</div>
<div class="line">        &quot;statis_delta_factor&quot;: 0.2</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Example: Extract stream</dt><dd><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;preprocess&quot;: {</div>
<div class="line">        &quot;action&quot;: [</div>
<div class="line">            {</div>
<div class="line">                &quot;name&quot;: &quot;stream_extract&quot;,</div>
<div class="line">                &quot;cfg&quot;: {</div>
<div class="line">                    &quot;input&quot;: [{</div>
<div class="line">                        &quot;data_type&quot;: 3,</div>
<div class="line">                        &quot;dev_id&quot;: 0</div>
<div class="line">                    }],</div>
<div class="line">                    &quot;extract_file_name&quot;: &quot;stream_out.h264&quot;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        ],</div>
<div class="line">        &quot;cfg&quot;: {</div>
<div class="line">            &quot;tmp_folder&quot;: &quot;tmp&quot;,</div>
<div class="line">            &quot;tmp_bin_size_limit_MB&quot;: 100</div>
<div class="line">        }</div>
<div class="line">    },</div>
<div class="line">    &quot;system&quot;: {</div>
<div class="line">         &quot;event_id&quot;: [0],</div>
<div class="line">         &quot;work_folder&quot;: &quot;./sample&quot;,</div>
<div class="line">         &quot;db_name&quot;: &quot;test.db&quot;,</div>
<div class="line">         &quot;statis_delta_factor&quot;: 0.2</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Example: Trim stream data with time range 1 ~ 4</dt><dd><div class="fragment"><div class="line">{</div>
<div class="line">...</div>
<div class="line">    &quot;repack&quot; : {</div>
<div class="line">        &quot;input&quot;: [{</div>
<div class="line">            &quot;data_type&quot;: 2,</div>
<div class="line">            &quot;dev_id&quot;: 0,</div>
<div class="line">            &quot;slice&quot;: {</div>
<div class="line">               &quot;type&quot;: &quot;time&quot;,</div>
<div class="line">                &quot;start&quot;: 1,</div>
<div class="line">                &quot;duration&quot;: 3</div>
<div class="line">            }</div>
<div class="line">        }],</div>
<div class="line">     ...</div>
<div class="line">    },</div>
<div class="line"> ...</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Example: Trim stream data with item range 5 ~ 100</dt><dd><div class="fragment"><div class="line">{</div>
<div class="line">...</div>
<div class="line">    &quot;repack&quot; : {</div>
<div class="line">        &quot;input&quot;: [{</div>
<div class="line">            &quot;data_type&quot;: 2,</div>
<div class="line">            &quot;dev_id&quot;: 0,</div>
<div class="line">            &quot;slice&quot;: {</div>
<div class="line">               &quot;type&quot;: &quot;item&quot;,</div>
<div class="line">                &quot;start&quot;: 5,</div>
<div class="line">                &quot;duration&quot;: 95</div>
<div class="line">            }</div>
<div class="line">        }],</div>
<div class="line">     ...</div>
<div class="line">    },</div>
<div class="line"> ...</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Example: Repack data with event ID 2</dt><dd><div class="fragment"><div class="line">{</div>
<div class="line"> ...</div>
<div class="line">    &quot;system&quot;: {</div>
<div class="line">        &quot;event_id&quot;: [2],</div>
<div class="line">        &quot;work_folder&quot;: &quot;./sample&quot;,</div>
<div class="line">        &quot;db_name&quot;: &quot;test.db&quot;,</div>
<div class="line">        &quot;statis_delta_factor&quot;: 0.2</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<p>The following lists general option node details in the configurations. </p><a class="anchor" id="repack options"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Node</th><th align="left">Value Type</th><th align="left">Description </th></tr>
<tr>
<td><b>preprocess</b></td><td>Node</td><td>Node for preprocess (optional) </td></tr>
<tr>
<td><b>action</b></td><td>Array Node</td><td>Array node for supported preprocess actions </td></tr>
<tr>
<td><b>name</b></td><td>String</td><td>Action name for parent action node </td></tr>
<tr>
<td><b>cfg</b></td><td>Node</td><td>Configuration node for parent node </td></tr>
<tr>
<td><b>input</b></td><td>Node</td><td>Input source data node for action / repack nodes </td></tr>
<tr>
<td><b>output</b></td><td>Node</td><td>Output data node for action node </td></tr>
<tr>
<td><b>data_type</b></td><td>Number</td><td>Data type <a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html#ga8fd251101ebdb52e0b6b4f0e1e0f0e8e">asf_block_type</a> </td></tr>
<tr>
<td><b>dev_id</b></td><td>Number</td><td>Data module device ID </td></tr>
<tr>
<td><b>slice</b></td><td>Node</td><td>Node for module data selection (optional) </td></tr>
<tr>
<td><b>type</b></td><td>String</td><td>Data selection type: "item" or "time" </td></tr>
<tr>
<td><b>duration</b></td><td>Number</td><td>Data duration for data trim. The default is "0" which means full time or full long. If the type is "item", it means data item count. If the type is "time", it means time duration. The system will always get the valid duration even if the target duration exceeds the input data duration. It is optional </td></tr>
<tr>
<td><b>start</b></td><td>Number</td><td>Data start offset for data trim. The default is 0. If the type is "item", it means item start offset count. If the type is "time", it means time start offset. It is optional </td></tr>
<tr>
<td><b>no_discard</b></td><td>Number</td><td>No discard flag for repack input module. Refer to <a class="el" href="../../d2/df5/page_lib_asf_doc.html#asf_repack_opt">3.1 Supported Repack Operations</a> for more details </td></tr>
<tr>
<td><b>extract_file_name</b></td><td>String</td><td>Extract stream output file name in action <b>stream_extract</b> </td></tr>
<tr>
<td><b>tmp_folder</b></td><td>String</td><td>Temporary file path for parent action in preprocessing </td></tr>
<tr>
<td><b>tmp_bin_size_limit_MB</b></td><td>Number</td><td>For large amounts of data, the temporary data binary will be split into several blocks. This option determines the single block maximum size </td></tr>
<tr>
<td><b>repack</b></td><td>Node</td><td>Node for repack </td></tr>
<tr>
<td><b>output_name</b></td><td>String</td><td>Output file name for repack </td></tr>
<tr>
<td><b>output_size_limit_MB</b></td><td>Number</td><td>For large amounts of data, the output data binary will be split into several blocks. This option determines the single block maximum size </td></tr>
<tr>
<td><b>repack_pts_delta_factor</b></td><td>Number</td><td>Threshold factor for time alignment in the repack process </td></tr>
<tr>
<td><b>system</b></td><td>Node</td><td>Node for general configurations </td></tr>
<tr>
<td><b>event_id</b></td><td>Number Array</td><td>Used event ID array for preprocess and repack </td></tr>
<tr>
<td><b>work_folder</b></td><td>String</td><td>Work folder root path for repack application </td></tr>
<tr>
<td><b>db_name</b></td><td>String</td><td>Database name </td></tr>
<tr>
<td><b>statis_delta_factor</b></td><td>Number</td><td>Threshold factor for data cluster statistic </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Find the sample repack JSON in <code>ambarella/packages/asf/unit_test/json_sample</code> .</dd></dl>
<h2><a class="anchor" id="asf_repack_compile"></a>
3.3 Compilation</h2>
<p >Users can compile and run the repack application using the following commands on the host PC. </p><div class="fragment"><div class="line">build $ cd ambarella/packages/asf/pc_browser</div>
<div class="line">build $ make</div>
<div class="line">build $ chmod +x bin/asf_browser</div>
<div class="line">build $ ./asf_browser</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="asf_replay"></a>
4. Replay</h1>
<p >After recording and repacking, users are given the required time-aligned data. Now, the data can be replayed on the local side. </p>
<h2><a class="anchor" id="asf_replay_flow"></a>
4.1 Replay Flow</h2>
<div class="image">
<img src="../../general_replay_flow.png" alt=""/>
<div class="caption">
Figure 4-1. Replay Flow.</div></div>
<h2><a class="anchor" id="asf_replay_case"></a>
4.2 Supported Replay Cases</h2>
<p >Currently, there is no general replay application in ASF. Users can parse and replay the required data from the repack binary. The following cases are supported for replay cases.</p><ul>
<li>Replay in electronic image stabilization (EIS) simulation: <a class="el" href="../../d2/df5/page_lib_asf_doc.html#asf_example_eis_replay">5.1.3 EIS Simulation Replay</a></li>
</ul>
<hr  />
<h1><a class="anchor" id="asf_example"></a>
5. Application Examples</h1>
<h2><a class="anchor" id="asf_exmaple_eis"></a>
5.1 EIS Simulation</h2>
<p >The following compile options must be configured before running the EIS simulation.</p><ul>
<li>Enable EIS library:</li>
<li>For CV2x SDK 3.0 Amba build: <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">[*] Ambarella Prebuild  ---&gt;</div>
<div class="line">    [*]   Configure Ambarella eis library  ---&gt;</div>
<div class="line">        Config EIS Library Version (Config multi-channel EIS library)  ---&gt;</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">prebuild  ---&gt;</div>
<div class="line">    library  ---&gt;</div>
<div class="line">        [*] prebuild-eis (prebuild/library/eis/dsp_v5)</div>
</div><!-- fragment --></li>
<li>For SDK Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">meta-ambalib  ---&gt;</div>
<div class="line">    recipes-prebuild  ---&gt;</div>
<div class="line">        [*] prebuild-eis (meta-ambalib/recipes-prebuild/prebuild-eis)</div>
</div><!-- fragment --></li>
<li>Enable EIS driver:</li>
<li>For CV2x SDK 3.0 Amba build: <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">[*] Ambarella Linux Configuration  ---&gt;</div>
<div class="line">    [*]   Ambarella Private Drivers Configuration  ---&gt;</div>
<div class="line">        [*]   Build Ambarella <span class="keyword">private</span> EIS modules  ---&gt;</div>
<div class="line">            Choose EIS Driver Type (Build EIS driver multi channel)  ---&gt;</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">drv_modules  ---&gt;</div>
<div class="line">    platform  ---&gt;</div>
<div class="line">        [*] ambeis-header (drv_modules/platform/eis)</div>
</div><!-- fragment --></li>
<li>For SDK Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">meta-ambabsp  ---&gt;</div>
<div class="line">    recipes-video  ---&gt;</div>
<div class="line">        [*] ambeis-header (meta-ambabsp/recipes-video/ambeis-header)</div>
</div><!-- fragment --></li>
<li>Enable gyro driver:</li>
<li>For CV2x SDK 3.0 Amba build: <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">[*] Ambarella Linux Configuration  ---&gt;</div>
<div class="line">    [*]   Ambarella Private Drivers Configuration  ---&gt;</div>
<div class="line">        [*]   Build Ambarella <span class="keyword">private</span> gyro modules</div>
<div class="line">            Choose Gyro Driver Type (GYRO_MULTI_CHANNEL)  ---&gt;</div>
<div class="line">            Gyro Sensor Multi Channel (MPU9250_SPI)  ---&gt;</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">drv_modules  ---&gt;</div>
<div class="line">    platform  ---&gt;</div>
<div class="line">        gyro  ---&gt;</div>
<div class="line">            [*] kernel-module-mpu9250 (drv_modules/platform/gyro/mpu9250)</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">meta-ambabsp  ---&gt;</div>
<div class="line">    recipes-gyro  ---&gt;</div>
<div class="line">        [*] kernel-module-mpu9250 (meta-ambabsp/recipes-gyro/kernel-module-mpu9250)</div>
</div><!-- fragment --></li>
</ul>
<h3><a class="anchor" id="asf_example_eis_record"></a>
5.1.1 EIS Simulation Record</h3>
<p >This record case uses 1080p RGB sensor input. For EIS simulation, sensor RAW, gyro data, and sensor-related settings are required. Because sensor RAW uses excessive storage space, saving encoded bitstreams is more efficient. This data is saved in ASF data format. </p><div class="image">
<img src="../../eis_record_flow.png" alt=""/>
<div class="caption">
Figure 5-1. EIS Record Flow.</div></div>
<ul>
<li>Record with <a href="../../scripts/eis_record.json" target="_blank"><b>eis_record.json </b></a> configuration: <div class="fragment"><div class="line">board # (CV2x) init.sh --imx274_mipi</div>
<div class="line">board # (CV5x) init.sh --na; modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # modprobe gyro_mpu9250_mc</div>
<div class="line">board # (CV2x) test_encode -i 1080p --hdmi 1080p</div>
<div class="line">board # (CV5x) test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua</div>
<div class="line">                           --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board # test_encode -A -H 1080p -b 0 -e</div>
<div class="line">board # test_asf --record-cfg eis_record.json</div>
</div><!-- fragment --></li>
</ul>
<h3><a class="anchor" id="asf_example_eis_repack"></a>
5.1.2 EIS Simulation Repack</h3>
<p >Unpack the ASF data cluster, decode the stream block, then pack the ASF cluster again with the decoded YUV block.</p><ul>
<li>Repack with <a href="../../scripts/eis_repack.json" target="_blank"><b>eis_repack.json </b></a> configuration: <div class="fragment"><div class="line">build $ cd ambarella/packages/asf/pc_browser/bin</div>
<div class="line">build $ ./asf_browser --repack-cfg eis_repack.json</div>
</div><!-- fragment --></li>
</ul>
<h3><a class="anchor" id="asf_example_eis_replay"></a>
5.1.3 EIS Simulation Replay</h3>
<p >1080p YUV 420 block data is used as source input. According to the gyro and sensor data, a related warp table is generated and applied to the channel. The final EIS result can be shown through a stream or video output (VOUT). </p><div class="image">
<img src="../../eis_replay_flow.png" alt=""/>
<div class="caption">
Figure 5-2. EIS Replay Flow.</div></div>
 <div class="fragment"><div class="line">board # init.sh --yuv1080p30</div>
<div class="line">board # test_aaa_service -a&amp;</div>
<div class="line">board # test_encode --resource-cfg replay_simulate_1080p.lua --enc-raw-nv12 1</div>
<div class="line">board # test_eis_warp_replay -i 6 -F 3500 --filter-scale 512,1024,512 --filter-mode 1</div>
<div class="line">--replay-file-prefix /sdcard/mmcblk1p1/chessboard_regression.bin</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="asf_qa"></a>
6. Troubleshooting</h1>
<p >This chapter provides frequently asked questions (FAQs) and answers about ASF. More information will be added in the future.</p>
<h2><a class="anchor" id="asf_q1"></a>
Question 1: What record mode should the customer use?</h2>
<p ><b>Answer:</b> There are two record modes in ASF. Users can check the details of these modes in <a class="el" href="../../d2/df5/page_lib_asf_doc.html#asf_record_json">2.3 Record Configuration</a>. In short, standard mode is a subset of trigger mode, and it can only cover simple tasks. Storage input / output (I/O) performance is also required in order to be considered. In the current ASF version, data querying and data writing for each task is completed in one thread. Therefore, if the write part could be blocked long term, (such as when using a secure digital (SD) card), trigger mode is recommended by Ambarella.</p>
<h2><a class="anchor" id="asf_q2"></a>
Question 2: How is an "Invalid event id 1" issue on the repack stage managed?</h2>
<p ><b>Answer:</b> Each record event has a unique ID ( <a class="el" href="../../d2/df5/page_lib_asf_doc.html#asf_record_json_mode">2.3.1 Record Mode and Event</a>). Double-check the repack option "event_id" configured in the repack configuration file, whether or not the event exists.</p>
<h2><a class="anchor" id="asf_q3"></a>
Question 3: In the record stage, what is "shift_realtime_enable" used for?</h2>
<p ><b>Answer:</b> The "shift_realtime_enable" is an option for gyro mode ( <a class="el" href="../../d2/df5/page_lib_asf_doc.html#asf_record_plugin_type">2.2.1 Customized Record Data Types</a>). When this option is enabled, additional data will be captured as zero-float data at the module-preparing stage.</p>
<h2><a class="anchor" id="asf_q4"></a>
Question 4: How can users confirm that the record data has not been corrupted?</h2>
<p ><b>Answer:</b> Customers can use the "asf_browser" application to check the record data binary with the option "-f". This will check the data integrity. The following commands demonstrate data integrity checks. </p><div class="fragment"><div class="line">board # asf_browser -f record.bin</div>
<div class="line">=== Sanity Check Raw Cluster Binary ===</div>
<div class="line">Read Magic: No such file or directory</div>
<div class="line">Read file end</div>
<div class="line">===Total count: 20===</div>
<div class="line">===Error count: 0===</div>
<div class="line">===Pass count: 20===</div>
</div><!-- fragment --><h2><a class="anchor" id="asf_q5"></a>
Question 5: How are record binaries split?</h2>
<p ><b>Answer:</b> The option "file_size_limit_MB" in the repack configuration file sets the maximum size of the record binary ( <a class="el" href="../../d2/df5/page_lib_asf_doc.html#asf_record_json_config">2.3.2 Configuration</a>). If the record binary size is greater than the maximum size, ASF will create and save a new file.</p>
<h2><a class="anchor" id="asf_q6"></a>
Question 6: What does the "Invalid items found:" message mean in the repack stage?</h2>
<p ><b>Answer:</b> In the repack stage, an application checks the data PTSs. If the PTSs are not consecutive, then this error is reported. This usually indicates that there was data loss during the recording process.</p>
<h2><a class="anchor" id="asf_q7"></a>
Question 7: Why does data loss occur in the record stage?</h2>
<p ><b>Answer:</b> There are many possible reasons for this issue, including system blocking, storage I/O blocking, recording moudle errors, and hardware issues.</p>
<h2><a class="anchor" id="asf_q8"></a>
Question 8: Should the recording stream resolution and VIN resolution be the same in EIS cases?</h2>
<p ><b>Answer:</b> Yes, the resolutions must be the same because stream data will be transferred to YUV data, which will feed as VIN data in the replay stage. Differences in resolution will affect the EIS results.</p>
<h2><a class="anchor" id="asf_q9"></a>
Question 9: In EIS cases, why does the "IAV_IOC_IMG_GET_STATISTICS" error print in the console?</h2>
<p ><b>Answer:</b> In the replay stage, encode from RAW (EFR) is used to simulate real VIN input. This error will print when there is no feed in image audio video (IAV), so it is reasonable that this error shows before and after the replay application runs.</p>
<h2><a class="anchor" id="asf_q10"></a>
Question 10: In EIS cases, what does the "Set RAW failed" error message mean in the replay stage?</h2>
<p ><b>Answer:</b> This error indicates something is wrong when feeding VIN frames. This is most likely caused by configuring incorrect virtual VIN I with the replay application "test_eis_warp_replay". The virtual VIN ID for different evaluation kit (EVK) boards is different. For CV2x, it is likely set as the last VIN ID + 1.</p>
<h2><a class="anchor" id="asf_q11"></a>
Qustion 11: Why is replay slow in EIS cases?</h2>
<p ><b>Answer:</b> The main reason is the storage I/O limitation. Customers can attempt using other storage media to read replay binaries.</p>
<h2><a class="anchor" id="asf_q12"></a>
Qustion 12: In EIS cases, why is the number of frames replayed less than the recorded ones?</h2>
<p ><b>Answer:</b> Check the repack configuration file if "slice"-related options were used, as they will affect the data selection range in the repack stage. Refer to asf_repack_json.or for "slice"-related options.</p>
<hr  />
<h1><a class="anchor" id="asf_api"></a>
7. ASF Library API</h1>
<p >Visit the following link for details of the application programming interface (API) functions.</p><ul>
<li><a class="el" href="../../dd/d66/group__ASF__FUNCTION__GROUP.html">ASF Library API</a> explains API functions.</li>
<li><a class="el" href="../../dd/d20/group__ASF__DEFINE__GROUP.html">ASF Macro</a> shows related macros.</li>
<li><a class="el" href="../../d3/d14/group__ASF__ENUM__GROUP.html">ASF Enumeration</a> shows related enumerations.</li>
<li><a class="el" href="../../d6/d21/group__ASF__STRUCT__GROUP.html">ASF Structure</a> shows related structures.</li>
</ul>
<hr  />
<h1><a class="anchor" id="asf_license"></a>
8. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ("Software") are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
