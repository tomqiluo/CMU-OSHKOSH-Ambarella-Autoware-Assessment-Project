<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: Vsrc Guard Library API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Library<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dd/d44/page_lib_vg_doc.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Vsrc Guard Library API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="vg_history"></a>
0. Revision History</h1>
<a class="anchor" id="vg_lib_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Library Version </th><th align="left">Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td>0.0.1 </td><td>20240112 </td><td>Initial Version </td></tr>
</table>
<h1><a class="anchor" id="vg_lib"></a>
1. VSRC Guard Library</h1>
<h2><a class="anchor" id="vg_intro"></a>
1.1 VSRC Guard Library Introduction</h2>
<p >The video source (VSRC) guard (VG) library provides user applications with the ability to subscribe to sensor status. The VG library is based on the data distribution service (DDS). Based on the VSRC guard library, the publisher service application acquires video data, publishes it via DDS, and manages the lifetime of the published data. User applications can subscribe to video data and verify if it is expired at any stage of data processing, and then restore the sensor to its normal state.<br  />
 Refer to <a class="el" href="../../df/d98/page_lib_vss_doc.html#dds_brief">Data Distribution Service Introduction</a> for more information about DDS.</p>
<div class="image">
<img src="../../vg_lib.png" alt=""/>
<div class="caption">
Figure 1-1. VG library Introduction.</div></div>
<h2><a class="anchor" id="vg_lib_api"></a>
1.2 VSRC Guard Library Application Programming Interface (API)</h2>
<p >Refer to the following links for API function details:</p><ul>
<li><a class="el" href="../../d8/dab/group__VSRC__GUARD__FUNCTION__GROUP.html">Vsrc Guard Library API</a> explains VG API functions</li>
<li><a class="el" href="../../d6/dbf/group__VSRC__GUARD__STRUCT__GROUP.html">Vsrc Guard Library Structure</a> shows structures related to the VG library</li>
</ul>
<p >Internal description of each API: </p><dl class="section user"><dt>lib_vg_init</dt><dd><div class="image">
<img src="../../vg_init.png" alt=""/>
<div class="caption">
Figure 1-2. lib_vg_init Introduction.</div></div>
</dd></dl>
<dl class="section user"><dt>lib_vg_deinit</dt><dd><div class="image">
<img src="../../vg_deinit.png" alt=""/>
<div class="caption">
Figure 1-3. lib_vg_deinit Introduction.</div></div>
</dd></dl>
<dl class="section user"><dt>lib_vg_start</dt><dd><div class="image">
<img src="../../vg_start.png" alt=""/>
<div class="caption">
Figure 1-4. lib_vg_start Introduction.</div></div>
</dd></dl>
<dl class="section user"><dt>lib_vg_stop</dt><dd><div class="image">
<img src="../../vg_stop.png" alt=""/>
<div class="caption">
Figure 1-5. lib_vg_stop Introduction.</div></div>
</dd></dl>
<h2><a class="anchor" id="vg_lib_usage"></a>
1.3 VSRC Guard Library Usage</h2>
<p >If users are required to use this library in code, they must activate "Build Ambarella
IAV utils VSRC GUARD library" in <code>make menuconfig</code> to compile it.</p>
<ul>
<li>For CV2x / CV5x / CV72 Amba build: <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">  [*] Ambarella Package Configuration  ---&gt;</div>
<div class="line">   [*]   Build Ambarella IAV utils VSRC GUARD library</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  packages  ---&gt;</div>
<div class="line">    iav_utils  ---&gt;</div>
<div class="line">      [*] libiav-vsrc-guard (packages/iav_utils/dsp_v5/lib_vsrc_guard)</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  meta-ambalib  ---&gt;</div>
<div class="line">     recipes-video  ---&gt;</div>
<div class="line">         [*] libiav-vsrc-guard (meta-ambalib/recipes-video/libiav-vsrc-guard)</div>
</div><!-- fragment --></li>
</ul>
<hr  />
<h1><a class="anchor" id="vg_service"></a>
2. VSRC Guard Service</h1>
<h2><a class="anchor" id="vg_service_intro"></a>
2.1 VSRC Guard Service Introduction</h2>
<p >The application <code>vsrc_guard_service</code> is an upper-layer application for the VG library. In order to use the VG library more efficiently, <code>vsrc_guard_service</code> provides the sample code for calling the associated APIs. The application can revert the state of the sensor based on the information subscribed by VG library.</p>
<p >The following are the main functional interfaces of the application and its workflow.</p>
<div class="image">
<img src="../../vg_service_api.png" alt=""/>
<div class="caption">
Figure 2-1. VG Service API.</div></div>
<div class="image">
<img src="../../vg_service_flow.png" alt=""/>
<div class="caption">
Figure 2-2. VG Service Workflow.</div></div>
<h2><a class="anchor" id="vg_service_usage"></a>
2.2 VSRC Guard Service Usage</h2>
<p >The <code>vsrc_guard_service</code> depends on VG library and must be configured before continuing when users enable <code>libiav-vsrc-guard</code> according to <a class="el" href="../../dd/d44/page_lib_vg_doc.html#vg_lib_usage">VSRC Guard Library Usage</a>. The <code>vsrc_guard_service</code> runs in the background when the system is booted up.</p>
<ul>
<li>For CV2x / CV5x / CV72 Amba build: <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">  [*] Ambarella Package Configuration  ---&gt;</div>
<div class="line">  [*]   Build Ambarella IAV utils VSRC GUARD library</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  packages  ---&gt;</div>
<div class="line">    iav_utils  ---&gt;</div>
<div class="line">      [*] libiav-vsrc-guard (packages/iav_utils/dsp_v5/lib_vsrc_guard)</div>
<div class="line">      [*] vsrc-guard-service (packages/iav_utils/dsp_v6/service_vsrc_guard)</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  meta-ambalib  ---&gt;</div>
<div class="line">     recipes-video  ---&gt;</div>
<div class="line">         [*] libiav-vsrc-guard (meta-ambalib/recipes-video/libiav-vsrc-guard)</div>
<div class="line">         [*] vsrc-guard-service (meta-ambalib/recipes-video/vsrc-guard-service)</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="vg_service_effect"></a>
2.3 VSRC Guard Service Application Notes</h2>
<p >Due to the variety of sensors and serializers / deserializers (SERDES) and different connection scenarios between the sensor and SERDES, the VSRC guard service functions with the supportability scope below:</p>
<a class="anchor" id="vg_service_support_scope"></a>
<table class="doxtable">
<caption>Table 5-1. Vsrc Guard Service Support Scope.</caption>
<tr>
<th>Case </th><th>Subscribe to Topics with Abnormal Sensor Status </th><th>Sensor / SERDES Recovery </th></tr>
<tr>
<td align="center">Multiple sensors without SERDES </td><td>Supported </td><td>Supported </td></tr>
<tr>
<td align="center">Multiple sensors and SERDES (sensor and SERDES in one-&gt;one connection) </td><td>Supported </td><td>Supported </td></tr>
<tr>
<td align="center">Multiple sensors and SERDES (sensor and SERDES in multiple-&gt;one connection) </td><td>Supported </td><td>Not supported </td></tr>
</table>
<h2><a class="anchor" id="vg_service_case"></a>
2.4 Example Cases</h2>
<dl class="section user"><dt>One Sensor with One SERDES</dt><dd>For CV2, the Lua script for the system resource settings can be found at <a href="../../scripts/cv2_vin0_1920x1200_linear.lua" target="_blank"><b>cv2_vin0_1920x1200_linear.lua</b></a>. <div class="fragment"><div class="line">board# init.sh --na</div>
<div class="line">board# modprobe max9296 <span class="keywordtype">id</span>=0x01 vinc_id=0x0 gmsl_mode=3 mfp4_clk=1 sen_rst_gpio=0</div>
<div class="line">board# modprobe ox03c10_mipi_brg</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# vsrc_guard_service &amp;</div>
<div class="line">board# test_encode --resource-cfg cv2_vin0_1920x1200_linear.lua --hdmi 1080p --vsync-detect-disable 0</div>
</div><!-- fragment --></dd></dl>
<p>For CV5x / CV72: </p><div class="fragment"><div class="line">board# init.sh --na</div>
<div class="line">board# modprobe max9296 <span class="keywordtype">id</span>=0x01</div>
<div class="line">board# modprobe imx390_mipi_brg</div>
<div class="line">board# vsrc_guard_service &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vsync-detect-disable 0    <span class="comment">// For CV5</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vsync-detect-disable 0)    <span class="comment">// For CV72</span></div>
</div><!-- fragment --><dl class="section user"><dt>Multiple Sensors with Multiple SERDES (One-One Map)</dt><dd>For CV2: <div class="fragment"><div class="line">board# init.sh --na</div>
<div class="line">board# modprobe max9296 <span class="keywordtype">id</span>=0x0101 vinc_id=0x20</div>
<div class="line">board# test_aaa_service -a &amp;</div>
<div class="line">board# modprobe os08a10_mipi_brg fsync=1</div>
<div class="line">board# vsrc_guard_service &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv2_vin0_1_1080p_linear --hdmi 1080p --vsync-detect-disable 0</div>
</div><!-- fragment --></dd></dl>
<p>For CV5x / CV72: </p><div class="fragment"><div class="line">board# init.sh --na</div>
<div class="line">board# modprobe max9296 <span class="keywordtype">id</span>=0x0101</div>
<div class="line">board# modprobe imx390_mipi_brg fsync=1</div>
<div class="line">board# vsrc_guard_service &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vsync-detect-disable 0    <span class="comment">// For CV5</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1_4k_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua --vsync-detect-disable 0)    <span class="comment">// For CV72</span></div>
</div><!-- fragment --><p >Users can simulate the sensor-broken situation by entering the command <code>test_vin_cap -p</code>vin-id`<code> to verify this function. The</code>vsrc_guard_service` started at the command line outputs the following printout when the sensor is restored successfully: </p><div class="fragment"><div class="line">Start to restore vsrc[0] <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a045797d72bb59ca4d36a8c96381033cd">vin_mode</a> 0x28 and <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> 0.</div>
<div class="line">Start to restore vin frame rate 17066667.</div>
<div class="line">Power off vsrc[0].</div>
<div class="line">Succeed to restore vsrc[0] <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a045797d72bb59ca4d36a8c96381033cd">vin_mode</a> 0x28 and <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a> 0.</div>
<div class="line">Succeed to restore vin frame rate 17066667.</div>
<div class="ttc" id="avin__init_8c_html_a045797d72bb59ca4d36a8c96381033cd"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a045797d72bb59ca4d36a8c96381033cd">vin_mode</a></div><div class="ttdeci">int vin_mode</div></div>
<div class="ttc" id="avin__init_8c_html_a9586a0cc85ebac1f283fc9f2d94c82e2"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a9586a0cc85ebac1f283fc9f2d94c82e2">hdr_mode</a></div><div class="ttdeci">int hdr_mode</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>In order for <code>vsrc_guard_service</code> to function properly, <code>vsync-detect-disable</code> must be set to 0.<br  />
 The <code>vsrc_guard_service</code> runs in the background by default, and the cases above demonstrate how to manually start the process.</dd></dl>
<hr  />
<h1><a class="anchor" id="vg_license"></a>
3. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ("Software") are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
