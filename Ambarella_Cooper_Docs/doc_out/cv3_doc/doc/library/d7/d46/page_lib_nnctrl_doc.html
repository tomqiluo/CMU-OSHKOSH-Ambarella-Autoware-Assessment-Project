<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: NNCtrl Library API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Library<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d46/page_lib_nnctrl_doc.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">NNCtrl Library API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="nnctrl_history"></a>
0. Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Library Version   </th><th class="markdownTableHeadLeft">Updated Date   </th><th class="markdownTableHeadLeft">Modification    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0.2.8   </td><td class="markdownTableBodyLeft">20190829   </td><td class="markdownTableBodyLeft">Initial Version    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0.2.9   </td><td class="markdownTableBodyLeft">20190910   </td><td class="markdownTableBodyLeft">Support issued split number times ioctl to driver for each network    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0.2.9   </td><td class="markdownTableBodyLeft">20200325   </td><td class="markdownTableBodyLeft">Support update_pitch on network port    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0.3.0   </td><td class="markdownTableBodyLeft">20200527   </td><td class="markdownTableBodyLeft">Support dma-buf:fd API for network    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0.3.0   </td><td class="markdownTableBodyLeft">20200803   </td><td class="markdownTableBodyLeft">Support encrypted network    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0.3.0   </td><td class="markdownTableBodyLeft">20200803   </td><td class="markdownTableBodyLeft">Add API <a class="el" href="../../dd/da5/group__nnctrl-api-details.html#ga2e54cd7df70002d6a5f8bee58dc5a3ba">nnctrl_get_net_bin_version()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0.3.0   </td><td class="markdownTableBodyLeft">20200807   </td><td class="markdownTableBodyLeft">Add API <a class="el" href="../../dd/da5/group__nnctrl-api-details.html#ga7aa3e9c1f751b754c427196f57138df5">nnctrl_resume_net_ext()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">0.3.0   </td><td class="markdownTableBodyLeft">20200818   </td><td class="markdownTableBodyLeft">Remove data struct dvi_desc, pitch_byte_offset and pitch_bsize in <a class="el" href="../../db/de7/structio__dim.html" title="The io dimension description.">io_dim</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0.3.0   </td><td class="markdownTableBodyLeft">20200901   </td><td class="markdownTableBodyLeft">Add API <a class="el" href="../../dd/da5/group__nnctrl-api-details.html#ga6fa2cee14a51afe39fa23b827a84bbf9">nnctrl_run_one_dag_of_net()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">1.0.0   </td><td class="markdownTableBodyLeft">20200910   </td><td class="markdownTableBodyLeft">Support LSTM network by loop descriptor, Upgrade cavalry_gen version to 2.2.8.1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">1.0.0   </td><td class="markdownTableBodyLeft">20201030   </td><td class="markdownTableBodyLeft">Support mprotect dvi and cmd memory of Network binary    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">1.0.0   </td><td class="markdownTableBodyLeft">20201106   </td><td class="markdownTableBodyLeft">Support check chip version in Network binary. Upgrade cavalry_gen to version: 2.2.8.2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">1.1.0   </td><td class="markdownTableBodyLeft">20210921   </td><td class="markdownTableBodyLeft">Support Bi-directional LSTM. Upgrade cavalry_gen to version: 2.2.8.3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">1.2.2   </td><td class="markdownTableBodyLeft">20230423   </td><td class="markdownTableBodyLeft">Support DDI (const port) for CV2x. Upgrade cavalry_gen to version: 2.2.8.4    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">3.1.0   </td><td class="markdownTableBodyLeft">20230710   </td><td class="markdownTableBodyLeft">Support CV72, using cavalry_gen version 3.0.2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">1.2.2   </td><td class="markdownTableBodyLeft">20231103   </td><td class="markdownTableBodyLeft">CV2x: Support separate intermediate IO memory   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="nnctrl_introduction"></a>
1. Introduction</h1>
<p >Neural network control (NNCtrl) is used for users to control the neural network.</p>
<hr  />
<h1><a class="anchor" id="nnctrl_library_example_usage"></a>
2. Example Usage</h1>
<p >NNCtrl library is based on the Cavalry driver, users should enable the Cavalry driver first, then enable NNCtrl library. Follow these commands to build the library:</p>
<ul>
<li>For CV2x SDK 3.0 Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">         [*] Ambarella Package Configuration  ---&gt;</div>
<div class="line">             [*]   Build Ambarella neural network control library</div>
<div class="line"> </div>
<div class="line">         [*] Ambarella Unit Test Configuration  ---&gt;</div>
<div class="line">             [*]     Ambarella Private Linux Unit test configs  ---&gt;</div>
<div class="line">                [*]   Build CV unit tests</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">         packages  ---&gt;</div>
<div class="line">             [*]   libnnctrl (packages/nnctrl)</div>
<div class="line"> </div>
<div class="line">         unit_test  ---&gt;</div>
<div class="line">             <span class="keyword">private</span>  ---&gt;</div>
<div class="line">                 [*] cv-test (unit_test/<span class="keyword">private</span>/cv_test/cavalry_v2)  ---&gt;</div>
<div class="line">                 [*] cv-stereo-test (unit_test/<span class="keyword">private</span>/cv_test/cavalry_v2)</div>
<div class="line">                 [*] cv-fex-test (unit_test/<span class="keyword">private</span>/cv_test/cavalry_v2)</div>
<div class="line">                 [*] cv-fma-test (unit_test/<span class="keyword">private</span>/cv_test/cavalry_v2)</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">         meta-ambalib  ---&gt;</div>
<div class="line">             recipes-cavalry  ---&gt;</div>
<div class="line">                 [*]   libnnctrl (meta-ambalib/recipes-cavalry/libnnctrl)</div>
<div class="line"> </div>
<div class="line">         meta-ambaapp  ---&gt;</div>
<div class="line">             recipes-test  ---&gt;</div>
<div class="line">                 [*] cv-fex-test (meta-ambaapp/recipes-test/cv-test)</div>
<div class="line">                 [*] cv-fma-test (meta-ambaapp/recipes-test/cv-test)</div>
<div class="line">                 [*] cv-stereo-test (meta-ambaapp/recipes-test/cv-test)</div>
<div class="line">                 [*] cv-test (meta-ambaapp/recipes-test/cv-test)  ---&gt;</div>
</div><!-- fragment --> </li>
</ul>
<h2><a class="anchor" id="nnctrl_library_cavalry_gen"></a>
2.1 cavalry_gen</h2>
<p >The cavalry_gen provides a method for condensing many output files contained within CNNGen and saving them into one file. The following steps demonstrate an example: </p><div class="fragment"><div class="line">build # cavalry_gen -d vas_output/ -f NET_cavalry.bin</div>
<div class="line">Using cavalry_gen version latest</div>
<div class="line">Save to file NET_cavalry.bin with file size 34376004.</div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_cavalry_gen_api_version"></a>
2.1.1 cavalry_gen_api_version</h2>
<p >Note that Cavalry gen version should match Cavalry parser version shown in test_nnctrl. Otherwise it will report an error in libnnctrl. For example, all versions are 2.2.8.2 as below. </p><div class="fragment"><div class="line">build (or board) <span class="preprocessor"># cavalry_gen --version</span></div>
<div class="line">version 2.2.8.2 ( HASH 77c9eb9 )</div>
<div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> NET_cavalry.bin --bin-version</div>
<div class="line">[NET_cavalry.bin] Net Binary Cavalry Gen Version: 2.2.8.2</div>
<div class="line">board # test_nnctrl --version</div>
<div class="line">Cavalry Parser Version: 2.2.8.2</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div><div class="ttdef"><b>Definition:</b> cJSON.h:255</div></div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_cavalry_gen_chip_version"></a>
2.1.2 cavalry_gen_chip_version</h2>
<p >In order to avoid to run the wrong version network binary on board, the cavalry_gen 2.2.8.2 includes chip arch information in network binary by the corresponding CNNGen tools. </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> NET_cavalry.bin --bin-version</div>
<div class="line">[NET_cavalry.bin] Net Binary Cavalry Gen Version: 2.2.8.2</div>
<div class="line">VDG Chip Arch: cv22</div>
</div><!-- fragment --><p >Libnnctrl will report an error if using the wrong chip network binary. The following example is tested on CV22 board, but network binary is built for CV2. </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> NET_Cavalry_cv2.bin --bin-version</div>
<div class="line">[NET_Cavalry_cv2.bin] Net Binary Cavalry Gen Version: 2.2.8.2</div>
<div class="line">VDG Chip Arch: cv2</div>
<div class="line">board # <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> /etc/ambarella.conf</div>
<div class="line">board # echo $AMBARELLA_ARCH</div>
<div class="line">cv22</div>
<div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> NET_Cavalry_cv2.bin --in input -e</div>
<div class="line">[LIBNN  ERR] Compiled ARCH is: 1 - cv22, but VDG ARCH in NET.bin is: 2 - cv2</div>
<div class="line">[LIBNN  ERR] Please update NET.bin with CNNGen cv22 Env</div>
<div class="line">[LIBNN  ERR] Check VDG ARCH error in NET.bin</div>
<div class="ttc" id="avin__init_8c_html_a07a87b2e6ed927503e2f95f119c9fc23"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a></div><div class="ttdeci">int source</div></div>
</div><!-- fragment --><p >Previous cavalry_gen 2.2.8.2 does not have chip arch information inside, so NNCtrl will bypass the chip check. </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> NET_Cavalry.bin --bin-version</div>
<div class="line">[NET_Cavalry.bin] Net Binary Cavalry Gen Version: 2.2.8.1</div>
<div class="line">VDG Chip Arch: Bypass</div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_test_nnctrl"></a>
2.2 test_nnctrl Application</h2>
<p >The test_nnctrl is one simple application that uses NNCtrl library to run the network on CVflow™ hardware. Customers can reference it as a sample code to write their own application. It supports file mode only, by feeding input file to network and will generate output file after the network finishes.</p>
<h2><a class="anchor" id="nnctrl_library_test_nnctrl_show_io_info"></a>
2.2.1 test_nnctrl Show IO Information</h2>
<p >It shows network's input and output information, such as dimension, data_format, size and more. For example, the network insightface is shown as below. </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> insightface_cavalry_fix8.bin  --show-io</div>
<div class="line">=======================</div>
<div class="line">Net id: 0, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a>: insightface_cavalry_fix8.bin IO:</div>
<div class="line">Input: 0 [data] dim: (1, 3, 112, 112), pitch: 128 (2000, 16), dram_fmt: 0, bitvector: 0, data_fmt: (1, 0, 7, 0), size: 43008</div>
<div class="line">Output: 0 [fc1_scale] dim: (1, 1, 1, 512), pitch: 1024 (588, 16), dram_fmt: 0, bitvector: 0, data_fmt: (1, 1, 0, 4), size: 1024</div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div><div class="ttdef"><b>Definition:</b> cJSON.h:264</div></div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_test_nnctrl_reuse_mem"></a>
2.2.2 test_nnctrl Reuse Port Memory</h2>
<p >It mainly reuses the network's intermediate port memory. The library considers all port as blob, so blob memory size is decreased if enabling reuse_mem flag. The test_nnctrl will enable this reuse_mem by default, and can disable it by adding "--off-reuse" option. For example, blob size is decreased from 1557536 to 759808 after enabling reuse_mem in network insightface.</p>
<p ><b>Enable</b> reuse_mem: </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> insightface_cavalry_fix8.bin --in data=13.bin --out fc1_scale=output.bin</div>
<div class="line">Network [0] [insightface_cavalry_fix8.bin] total memory size: 35041056, dvi: 34280968, blob: 759808. Bandwidth size: 37552712</div>
</div><!-- fragment --><p> <b>Disable</b> reuse_mem: </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> insightface_cavalry_fix8.bin --in data=13.bin --out fc1_scale=output.bin --off-reuse</div>
<div class="line">Network [0] [insightface_cavalry_fix8.bin] total memory size: 35838784, dvi: 34280968, blob: 1557536. Bandwidth size: 37552712</div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_test_nnctrl_dump_net"></a>
2.2.3 test_nnctrl Dump Net</h2>
<p >It dumps all DVI and port memory in the network. All DVI files should be identical in "parser" folder when running cavalry_gen. Port files can be used to debug accuracy issues by analyzing layer's output. The test_nnctrl will close reuse_mem when dumping net, and generate "dvi_dump" and "blob_dump" folder by using "--dump" option. For example, all DVI files in test_nnctrl and cavalry_gen should be identical when using network insightface. </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> insightface_cavalry_fix8.bin --in data --out fc1_scale --dump /tmp</div>
<div class="line">Network [0] [insightface_cavalry_fix8.bin] total memory size: 35838784, dvi: 34280968, blob: 1557536. Bandwidth size: 37552712</div>
<div class="line">Dump blob dir: /tmp/blob_dump</div>
<div class="line">Dump dvi dir: /tmp/dvi_dump</div>
<div class="line">board # md5sum /tmp/dvi_dump/insightface_*.dvi</div>
<div class="line">b6f04aa7153b8da0f44cc84b09b036c5  /tmp/dvi_dump/insightface_prim_split_0.dvi</div>
<div class="line">...</div>
<div class="line">ff857d4558ecf44d2c973ca8b8eb1b15  /tmp/dvi_dump/insightface_prim_split_20.dvi</div>
<div class="line">build # cavalry_gen -d vas_output/ -f insightface_cavalry_fix8.bin -v</div>
<div class="line">build # md5sum parse/insightface_*.dvi</div>
<div class="line">b6f04aa7153b8da0f44cc84b09b036c5  parse/insightface_prim_split_0.dvi</div>
<div class="line">...</div>
<div class="line">ff857d4558ecf44d2c973ca8b8eb1b15  parse/insightface_prim_split_20.dvi</div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_test_nnctrl_no_mem"></a>
2.2.3 test_nnctrl io no_mem</h2>
<p >Normally, libnnctrl will assign the memory for all ports and DVIs. The library still supports to use the memory specified by the application. Users can add "--no" option after port option. For example, blob size reported by libnnctrl is decreased from 759808 to 716800 byte, the reduction is equal to "data" port size 43008 byte.</p>
<p ><b>Disable</b> no_mem </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> insightface_cavalry_fix8.bin --in data --out fc1_scale</div>
<div class="line">Input: 0 [data] dim: (1, 3, 112, 112), pitch: 128 (2000, 16), dram_fmt: 0, bitvector: 0, data_fmt: (1, 0, 7, 0), size: 43008, phys: 0x626b1720, virt: 0x7fbe30e720</div>
<div class="line">Output: 0 [fc1_scale] dim: (1, 1, 1, 512), pitch: 1024 (588, 16), dram_fmt: 0, bitvector: 0, data_fmt: (1, 1, 0, 4), size: 1024, phys: 0x6274d9a0, virt: 0x7fbe3aa9a0</div>
<div class="line">Network [0] [insightface_cavalry_fix8.bin] total memory size: 35041056, dvi: 34280968, blob: 759808. Bandwidth size: 37552712</div>
</div><!-- fragment --><p> <b>Enable</b> no_mem on input </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> insightface_cavalry_fix8.bin --in data --no --out fc1_scale</div>
<div class="line">Do not allocate net [0] input [0] memory in libnnctrl.</div>
<div class="line">Input_ext phys: 0x62770000, dram_size: 43008, size: 43008, virt: 0x7fa254f000</div>
<div class="line">Input: 0 [data] dim: (1, 3, 112, 112), pitch: 128 (2000, 16), dram_fmt: 0, bitvector: 0, data_fmt: (1, 0, 7, 0), size: 43008, phys: 0x62770000, virt: 0x7fa254f000</div>
<div class="line">Output: 0 [fc1_scale] dim: (1, 1, 1, 512), pitch: 1024 (588, 16), dram_fmt: 0, bitvector: 0, data_fmt: (1, 1, 0, 4), size: 1024, phys: 0x627431a0, virt: 0x7fa469d1a0</div>
<div class="line">Network [0] [insightface_cavalry_fix8.bin] total memory size: 34998048, dvi: 34280968, blob: 716800. Bandwidth size: 37552712</div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_test_nnctrl_multi_io"></a>
2.2.4 test_nnctrl multi-io</h2>
<p >The test_nnctrl supports multiple inputs and outputs by using multiple "--in" or "--out" options. For example, Yolov3 has three outputs as below. </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> yolo_v3_cavalry_fix8_full.bin --in data --out conv59 --out conv67 --out conv75</div>
<div class="line">Input: 0 [data] dim: (1, 3, 416, 416), pitch: 416 (752, 16), dram_fmt: 0, bitvector: 0, data_fmt: (0, 0, 8, 0), size: 519168, phys: 0x63ed28e0, virt: 0x7fa313d8e0</div>
<div class="line">Output: 0 [conv59] dim: (1, 255, 13, 13), pitch: 64 (916, 16), dram_fmt: 0, bitvector: 0, data_fmt: (1, 2, 0, 7), size: 212160, phys: 0x63fa80a0, virt: 0x7fa32130a0</div>
<div class="line">Output: 1 [conv67] dim: (1, 255, 26, 26), pitch: 128 (1332, 16), dram_fmt: 0, bitvector: 0, data_fmt: (1, 2, 0, 7), size: 848640, phys: 0x6432d4e0, virt: 0x7fa35984e0</div>
<div class="line">Output: 2 [conv75] dim: (1, 255, 52, 52), pitch: 224 (588, 16), dram_fmt: 0, bitvector: 0, data_fmt: (1, 2, 0, 7), size: 2970240, phys: 0x643fc7e0, virt: 0x7fa36677e0</div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_test_nnctrl_multi_net"></a>
2.2.5 test_nnctrl Multi-net</h2>
<p >The test_nnctrl supports multiple networks by using multiple "--b" options. For example, the application runs Yolov3 full and sp50 sequentially. </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> yolo_v3_cavalry_fix8_full.bin --in data --out conv59 --out conv67 --out conv75</div>
<div class="line"> -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> yolo_v3_cavalry_fix8_sp50.bin --in data --out conv59 - -out conv67 --out conv75</div>
<div class="line">Total neural network num: 2</div>
<div class="line">Network [0] [yolo_v3_cavalry_fix8_full.bin] total memory size: 67967584, dvi: 59582100, blob: 8384896. Bandwidth size: 103555796</div>
<div class="line">Network [1] [yolo_v3_cavalry_fix8_sp50.bin] total memory size: 48796352, dvi: 40836988, blob: 7958912. Bandwidth size: 73300860</div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_test_nnctrl_io_rotate_flip"></a>
2.2.6 test_nnctrl IO Rotate Flip</h2>
<p >The test_nnctrl supports rotate and flip DRAM feature. There are 5 bitmap for 5 operations. Bitmap order (High -&gt; Low): 4: pflip; 3: dflip; 2: vflip; 1: hflip; 0: rotate. For example, if input data is feeding by clock-wise 270 degree, it will generate identical ouput when feeding input by rotating 90 degree clockwise. For example, the following network insightface shows that "output.bin" and "output_rotate.bin" are the same.</p>
<p ><b>Original</b> Input </p><div class="fragment"><div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> insightface_cavalry_fix8.bin --in data=13.bin --out fc1_scale=output.bin</div>
<div class="line">board # md5sum output.bin</div>
<div class="line">b1e2b7c305cf9f8150e1fe95682d2f62  output.bin</div>
</div><!-- fragment --><p> <b>Clock-wise</b> 270 degree Input </p><div class="fragment"><div class="line">There is one tool <span class="stringliteral">&quot;binroate.py&quot;</span> in <span class="stringliteral">&quot;tools/rotate&quot;</span> folder of CNNGen samples package.</div>
<div class="line">Rotate original file with 270 degree clockwise before feeding to the network.</div>
<div class="line">build # binrotate.py -i 13.bin -width 112 -height 112 -chan 3 -r 270 -o 13_270.bin</div>
<div class="line">board # test_nnctrl -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> insightface_cavalry_fix8.bin --in data=13_270.bin --rotate-flip 0x1 --out fc1_scale=output_rotate.bin</div>
<div class="line">board # md5sum output_rotate.bin</div>
<div class="line">b1e2b7c305cf9f8150e1fe95682d2f62  output_rotate.bin</div>
</div><!-- fragment --><h2><a class="anchor" id="nnctrl_library_test_nnctrl_dram_bandwith"></a>
2.3 Vector Processor (VP) DRAM Bandwidth</h2>
<p >The test_nnctrl supports calculation of the current VP dynamic random access memory (DRAM) bandwidth. The VP DRAM bandwidth will be decreased if digital signal processor (DSP) or Arm® accesses the DRAM in background. The test_nnctrl checks approximately if the VP-obtained DRAM bandwidth is sufficient for the network.</p>
<p >Both DSP and Arm are idle </p><div class="fragment"><div class="line">board # test_nnctrl -w</div>
<div class="line">VP BW: 10099 MB/s = 67109028 B / 6645.68 us</div>
<div class="line">==== Check Bandwidth ====</div>
<div class="line">Total VP Margin BW: 9594 MB/s = 10099 MB x (100 - 5)%</div>
</div><!-- fragment --><p >Arm is busy, and check if DRAM bandwidth is sufficient for the network insightface as below. </p><div class="fragment"><div class="line">board # memtester-arm 100 &amp;  (Type command in another console, used to simulate busy ARM process)</div>
<div class="line">board # test_nnctrl -w -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> insightface_cavalry_fix8.bin --in data --out fc1_scale</div>
<div class="line">VP BW: 6205 MB/s = 67109028 B / 10815.43 us</div>
<div class="line">Network [0] [insightface_cavalry_fix8.bin] total memory size: 35041056, dvi: 34280968, blob: 759808. Bandwidth size: 37552712</div>
<div class="line">==== Check Bandwidth ====</div>
<div class="line">Total VP Margin BW: 5894 MB/s = 6205 MB x (100 - 5)%</div>
<div class="line">Net [0] BW : 1496 MB/s = 37552712 B / 25096 us</div>
<div class="line">Check BW Result: pass</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="sec_nnctrl_api"></a>
3. NNCtrl API</h1>
<p >Visit the following link to find details of the API function.</p><ul>
<li><a class="el" href="../../dd/da5/group__nnctrl-api-details.html">NNCtrl Library API details</a> shows API lists.</li>
<li><a class="el" href="../../d9/d50/group__nnctrl-helper.html">NNCtrl Library API helper</a> shows related macros enumerations and structures.</li>
</ul>
<hr  />
<h1><a class="anchor" id="sec_nnctrl_lic"></a>
4. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ( "Software" ) are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
