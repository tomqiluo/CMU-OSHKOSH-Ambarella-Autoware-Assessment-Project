<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: Dewarp Library API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Library<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/d8b/page_lib_dewarp_doc.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Dewarp Library API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><b>The contents of this document are proprietary and confidential information of Ambarella International LP.</b></p>
<h1><a class="anchor" id="dewarp_support"></a>
Important Declaration about Dewarp Support</h1>
<p >The dewarp module is an important part of the Ambarella Linux software development kit (SDK); it has the ablility to warp images from video input (VIN) / the pre-main buffer to the YUV buffer in the image digital signal processor (IDSP). It is different from the dewarp module in simulations or any other open source library. <br  />
From the software perspective of the dewarp library, all warp-related parameters are used to compute the warp table, grid information, input window, and more. The image audio video (IAV) driver and application perform validity checks in terms of alignment, boundary, and required hardware resource. Afterwards, all related parameters are wrapped into one digital signal processor (DSP) command and applied to the IDSP. The IDSP pipeline supports lens dewarp correction (LDC) or multi-region warp, which are closely connected to the warp hardware resource. Users must understand that not all warp cases are supported during evaluation. Based on the description above, Ambarella suggests following the steps below for specific warp cases. For any questions, contact the Ambarella Shanghai team. <br  />
1. Become familiar with the targeted warp correction parameters. All valid ranges are theoretical ranges; they generate different warp effects with unique resolutions, lenses, and complimentary metal-oxide semiconductor (CMOS) sensors. <br  />
2. Determine the CMOS sensor, lens type, and system specifications to estimate the required hardware resources. <br  />
3. Fine-tune the warp effect. Ambarella can provide technical support in this stage. <br  />
4. Establish the test set by users. Ensure the set covers the worst cases that may occur in real applications and that the test results in the same conclusions between the Ambarella evaluation kit (EVK) boards and users' boards. <br  />
5. Add the test set into the Ambarella quality assurance (QA) team's regression test to ensure that any updates to the dewarp module or ucode do not impede functions required by the user. <br  />
6. After the Ambarella-standard QA test, users should be notified of required modifications about the targeted warp correction. Users can either ask for formal hotfix or refuse to update their version, giving feedback to Ambarella. Ambarella should confirm the possibility of porting updates to the specific version and notify the users. <br  />
<b>Ambarella is responsible for broken images caused by the dewarp module for the following conditions:</b> <br  />
- Artifacts occur from the cases in the test set <br  />
- Unexpected blocks for warp-related parameters from the cases in the test set <br  />
- Dewarp module hotfix is delivered to users without going through the test set <br  />
<b>Ambarella is NOT responsible for broken images caused by the dewarp module for the following conditions:</b> <br  />
- The CMOS sensor, lens type, and / or system specifications are changed <br  />
- The actual use cases are out of the user-created test set <br  />
- The unit test codes "test_ldc.c", "test_ldc.h", and "test_dewarp.c" are reference codes. Users write their own application that call the dewarp library should go through step 4 above to ensure that the test sets result in the same conclusions between the Ambarella EVK boards and users' boards.</p>
<h1><a class="anchor" id="dewarp_history"></a>
0. Revision History</h1>
<a class="anchor" id="lib_dewarp_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Library Version </th><th>Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td>2.0.0 </td><td>20220919 </td><td>Initial Version </td></tr>
<tr>
<td>2.1.0 </td><td>20220927 </td><td>Enable point mapping (1D+1D) with rotation pipeline <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#LDC_and_dewarp">1.3 LDC and Multi-Region Warp</a>, <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#point_mapping">2.14 Point Mapping</a> </td></tr>
<tr>
<td>2.1.1 </td><td>20221017 </td><td>Refined the warp grid computation for encode mode 1 <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_vector_view">1.4 Warping Vector (Area) / Corrected View</a> </td></tr>
<tr>
<td>2.1.2 </td><td>20230222 </td><td>Align vwarp output width 64 for MCTF restriction <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_align">5.3 Warp Alignment</a> </td></tr>
<tr>
<td>2.1.3 </td><td>20230225 </td><td>Align hwarp output width with 64 according to c2y restriction under encode mode 0 <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_align">5.3 Warp Alignment</a> </td></tr>
<tr>
<td>2.1.4 </td><td>20230616 </td><td>Added ME1 v/h table for motion stream under encode mode 5 <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#ldc_me1">5.8 ME1 H/V for Lens Warp</a> </td></tr>
<tr>
<td>2.1.5 </td><td>20230621 </td><td>Added LDC support for encode mode 9 AISP <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#LDC_and_dewarp">1.3 LDC and Multi-Region Warp</a> </td></tr>
<tr>
<td>2.1.5 </td><td>20230717 </td><td>Added the 2D vector validity rules <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#transform_twin_vector_to_idsp_format">2.11 Transform 2D Vector to 1D+1D</a> </td></tr>
<tr>
<td rowspan="2">2.1.6 </td><td rowspan="2">20220720 </td><td>1. Added the check for ME1 warp table <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#ldc_me1">5.8 ME1 H/V for Lens Warp</a> </td></tr>
<tr>
<td>2. Refine the grid-level 2D vector conversion <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#transform_twin_vector_to_idsp_format">2.11 Transform 2D Vector to 1D+1D</a> </td></tr>
<tr>
<td>3.0.0 </td><td>20231011 </td><td>Support up to 16x channels warp <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#v6_ldc_intro">1.2 CV5x / CV7x Lens Distortion Correction Introduction</a> </td></tr>
<tr>
<td rowspan="3">3.1.0 </td><td rowspan="3">20231017 </td><td>1. LDC: Added conversion with pure float coordinate <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#transform_twin_vector_to_idsp_format">2.11 Transform 2D Vector to 1D+1D</a> </td></tr>
<tr>
<td>2. LDC: Added correction mode warp by perspective matrix(3x3) <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#perspective_matrix">2.13 Warp by Perspective Matrix</a> </td></tr>
<tr>
<td>3. Added warp input mode <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_input_mode">5.7 Warp Input Mode</a> </td></tr>
<tr>
<td>3.1.1 </td><td>20231031 </td><td>Supported grid level coordinate file for conversion <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#transform_twin_vector_to_idsp_format">2.11 Transform 2D Vector to 1D+1D</a> </td></tr>
<tr>
<td>3.1.2 </td><td>20231114 </td><td>Supported vertical upscale in vertical warp for encode mode 1 (Hwarp first) pipeline <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#LDC_and_dewarp">1.3 LDC and Multi-Region Warp</a> </td></tr>
<tr>
<td>3.1.2 </td><td>20231201 </td><td>Refined the description for vwarp waitlines <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_hw_res">5.2 Warp Hardware Resource</a> <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_qa_q9">Question 9: How to get the vertical warp waitlines under encode mode 0?</a> </td></tr>
<tr>
<td>3.1.3 </td><td>20231206 </td><td>Refined the input window configuration for AISP mode. <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#LDC_and_dewarp">1.3 LDC and Multi-Region Warp</a> </td></tr>
<tr>
<td>3.1.3 </td><td>20240104 </td><td>Separated <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#lens_lut_example">4.1.7 Lens LUT Examples</a> from the section <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#lens_lut">4.1.6 Lens LUT Mode</a> </td></tr>
<tr>
<td>3.1.3 </td><td>20240111 </td><td>Changed correction table <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_correction_mode">warp correction table</a> </td></tr>
<tr>
<td>3.1.4 </td><td>20240115 </td><td>Vector computation refine for Hwarp first, vertical upscale under encode mode 1. <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#LDC_and_dewarp">1.3 LDC and Multi-Region Warp</a> </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="dewarp_overview"></a>
1. Overview</h1>
<p >This document provides guidelines for implementing multi-region warp and flexible perspective correction (including lens distortion correction (LDC)) using the CV5x / CV7x Flexible Linux Software Development Kit (SDK). Currently, the multi-region warp feature is enabled only in multi-region warp mode, and functions only for a single channel.</p>
<p >This chapter contains the following sections:</p><ul>
<li>Section <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#v6_fisheye_intro">1.1 CV5x / CV7x Multi-Region Warp Mode Introduction</a></li>
<li>Section <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#v6_ldc_intro">1.2 CV5x / CV7x Lens Distortion Correction Introduction</a></li>
<li>Section <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#LDC_and_dewarp">1.3 LDC and Multi-Region Warp</a></li>
<li>Section <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_vector_view">1.4 Warping Vector (Area) / Corrected View</a></li>
</ul>
<h2><a class="anchor" id="v6_fisheye_intro"></a>
1.1 CV5x / CV7x Multi-Region Warp Mode Introduction</h2>
<p >"IDSP Multi-Region Warp" (encode mode 1) is one of the important image digital signal progessor (IDSP) modes on CV5x / CV7x platforms, such as CV2x and S2 / S2E. Customers can have their internet protocol camera (IPC) products render multiple warp view layouts in the main buffer with one single channel. Each warp view runs through the IDSP warp hardware with a geometry warp table to obtain a variety of monitor-friendly views. Typically, the cameras are mounted with a fisheye lens (large field of view (FoV)). <br  />
Different from other platforms, such as CV2x and S2 / S2E, encode mode 1 requires configurations for dual real channels for one video input (VIN) source. One channel is connected to a real VIN source under encode mode 0/5 without warp operations, which is named "unwarped channel". The other channel is from one dummy VIN (ambds) under encode mode 1, which is named "warped channel". The unwarped channel has unwarped images for all the buffers; the YUV from the main buffer of this channel functions as a video source (VSRC) for the warped channel (EFR with YUV raw). As a result, the canvas with the main buffer from the unwarped channel CANNOT be encoded, and it appears as the pre-main buffer for the warped channel. This will be referred to as the fake pre-main buffer. Users must be familiar with the concepts "warped channel", "unwarped channel", "fake pre-main buffer", as this documents adapts them for more detailed introductions below.</p>
<h2><a class="anchor" id="v6_ldc_intro"></a>
1.2 CV5x / CV7x Lens Distortion Correction Introduction</h2>
<p >LDC is supported on below encode modes: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Mode ID   </th><th class="markdownTableHeadCenter">Mode Name    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">Normal ISO mode    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">5   </td><td class="markdownTableBodyCenter">High dynamic range (HDR) line-interleaved mode    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">9   </td><td class="markdownTableBodyCenter">AISP mode   </td></tr>
</table>
<p>LDC brings one warp effect to the main buffer through the IDSP warp hardware, so there are no multiples but only one warp view exists with the same size as main buffer output. Currently, dewarp library could support up to <b>16x channels</b> warp table computation, the application can specify a channel bitmap "warp_channel_map" according to active system configuration. <br  />
For more details about the differences between LDC and multi-region warp, refer to <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#LDC_and_dewarp">1.3 LDC and Multi-Region Warp</a>.</p>
<h2><a class="anchor" id="LDC_and_dewarp"></a>
1.3 LDC and Multi-Region Warp</h2>
<p >The major differences between LDC and multi-region warp are as follows:</p><ol type="1">
<li><b>Correction mode:</b> LDC only supports multi-region warp wall mount correction modes. To enable multi-region warp enable ceiling / desktop mount, refer to <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#ceiling_desktop_panorama_fulframe">2.8 Ceiling / Desktop Panorama and Full Frame</a>. <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#ceiling_desktop_rectilinear">2.9 Ceiling / Desktop Rectilinear</a>. <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#ceiling_desktop_sub">2.10 Ceiling / Desktop Sub-Region</a></li>
<li><b>Encode mode:</b> LDC functions in mode 0 (normal ISO mode) and mode 5 (HDR line-interleaved mode). Multi-region warp functions in mode 1 (Multi_Region_Warp Mode).</li>
<li><b>Pipeline:</b> <div class="image">
<img src="../../v6_multi_region_warp_pipeline.png" alt=""/>
<div class="caption">
Figure 1-1. Multi-Region Warp Pipeline.</div></div>
 <br  />
 <br  />
 <div class="image">
<img src="../../v6_LDC_pipeline.png" alt=""/>
<div class="caption">
Figure 1-2. LDC Pipeline.</div></div>
</li>
<li><b>System resource:</b> Refer to option (max_padding_width/lens_warp) and max warp input / output width in <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_system_config">5. System Configuration</a>.</li>
<li><b>Granularity:</b> For one view, multi-region warp can support multiple areas, while LDC only has one area (group of vector). When applying wall rectilinear for main buffer 1080p, multi-region warp can split one view into four areas to apply the vector. Multi-region warp can support up to twelve areas for one channel.</li>
<li><b>Warp DPTZ (digital pan / tilt / zoom):</b> As there is only one area for the main buffer, warp DPTZ is not available for LDC. However, users can enable DPTZ II after LDC. <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_dptz">5.6 Warp DPTZ</a></li>
<li><b>Different application programming interface (API) functions and different applications:</b> <a class="el" href="../../d6/d90/group__dewarp-api-api.html">Dewarp Library API Details</a> (test_ldc.c, test_dewarp.c).</li>
</ol>
<h2><a class="anchor" id="warp_vector_view"></a>
1.4 Warping Vector (Area) / Corrected View</h2>
<p >The warp area is one physical rectangular area located in the main buffer of the warped channel that renders the desired warp effect, which is realized by the warp engine hardware in the IDSP. This hardware enables horizontal and vertical (H/V) warp for each warp area. The H/V warp stage requires a warp table at the grid level to demand a pixel shift for the specific point; the warp table size and grid spacing are not permitted to be set with an arbitrary value, but calculated by the library automatically according to the restriction of the warp engine hardware. Below is a list of dewarp engine hardware restrictions. <br  />
<b>Warp area minimum width: 112</b> <br  />
<b>Warp area maximum width: 2048</b> <br  />
<b>Maximum warp area number: 12</b> <br  />
<b>Maximum warp table size: 128x96 (HxV) </b> <br  />
<b>Grid spacing: 8, 16, 32, 64, 128, 256, 512 </b> <br  />
<b>Warp view</b> is described in the user application scope while "warping vector (area)" is described in the CV5x / CV7x image audio video (IAV) scope. It is possible for each warp view to include two or four axisymmetric warp areas combined into one final warp effect; the active warp area number for one warp view depends on the active <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_correction_mode">Correction Mode</a>. Check the sample application <a class="el" href="../../d2/d55/test_dewarp_8c-example.html">test_dewarp.c</a> for more details.</p>
<hr  />
<h1><a class="anchor" id="dewarp_correction_mode"></a>
2. Correction Mode</h1>
<p >This section defines correction modes for wall mount, ceiling mount, and desktop mount. In addition, a schematic and explanations of parameters for each correction mode are also provided below.</p>
<a class="anchor" id="correction_mode_table"></a>
<table class="doxtable">
<caption>Table 2-1. Overview of all correction modes</caption>
<tr>
<th>Correction Mode </th><th style="width:128px">LDC / Fisheye </th><th>Pros and Cons </th><th>Application </th></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#no_transform">No Transform</a> </td><td>LDC and Fisheye </td><td>Same as DPTZ I but costs more bandwidth loss </td><td>Original fisheye view in multiple regions warp </td></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#no_transform_rotate">No Transform Rotate</a> </td><td>LDC and Fisheye </td><td>Cannot rotate with arbitrary angles </td><td>N/A </td></tr>
<tr>
<td align="middle" rowspan="4"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_rectilinear">Wall Rectilinear</a> </td><td rowspan="4">LDC and Fisheye </td><td>1. Flexibly control radical distortion removal <br  />
2. All the lines are stretched to straight </td><td>Undistortion without calibrated parameters </td></tr>
<tr>
<td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_adv_polar_warp">Polar Warp</a><br  />
3. Perspective changing by polar coordinates </td><td>Rectilinear with different perspective transform </td></tr>
<tr>
<td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_eyeball_rotation">Eyeball Rotation</a><br  />
4. Flexibly select any ROI of input image with distortion removal </td><td>Pan / tilt / rotate or region of interest (ROI) </td></tr>
<tr>
<td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_adv_py">Advance Pitch/Yaw</a><br  />
5. Virtually adjust perspective warp with pitch / yaw of image boundary </td><td><p class="starttd">ROI on corridor view</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td align="middle" rowspan="5"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_panorama">Wall Panorama</a> </td><td rowspan="5">LDC and Fisheye </td><td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_cylinder_panorama">Cylinder</a><br  />
1. Vertical lines are straight <br  />
2. Horizontal FoV can be specified <br  />
3. Aspect ratio 8:3 </td><td>General panoramic view </td></tr>
<tr>
<td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_mercator">Mercator</a><br  />
4. Aspect ratio 1:1 </td><td>Map projection </td></tr>
<tr>
<td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_equirectangular">Equirectangular</a><br  />
5.a Projection according to longitude and latitude lines<br  />
5.b Largest vertical FoV <br  />
5.c The north and south pole are avaiable <br  />
5.d Aspect ratio 1:1 </td><td>Doorbell </td></tr>
<tr>
<td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_squircular">Squircular</a><br  />
6. A shape intermediate between a square and a circle </td><td>Doorbell </td></tr>
<tr>
<td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_pano_fan">Fan Warp</a><br  />
7. Adjust gravity direction in panoramic view </td><td><p class="starttd">General panoramic view</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td align="middle" rowspan="2"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_vertical_panorama">Wall Vertical Panorama</a> </td><td rowspan="2">LDC and Fisheye </td><td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_transverse_cylinder">Transverse Cylinder</a><br  />
1. Horizontal lines are straight <br  />
2. Vertical FoV can be specified <br  />
3. Aspect ratio 3:8 </td><td>General vertical panoramic view </td></tr>
<tr>
<td><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_transverse_mercator">Transverse Mercator</a><br  />
4. Aspect ratio 1:1 </td><td><p class="starttd">Transverse mecator</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_pincushion">Wall Pincushion</a> </td><td>LDC and Fisheye </td><td>Remove pincushion distortion </td><td>Lens warp in large optical zoom </td></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#wall_pannini">Wall Pannini</a> </td><td>LDC and Fisheye </td><td>Large FoV with limited distortion in horizontal direction </td><td><p class="starttd">Doorbell</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#ceiling_desktop_panorama_fulframe">Ceiling/Desktop Panorama and Fulframe</a> </td><td align="middle">Fisheye </td><td>Full view of fisheye </td><td>1. Surround 360 view <br  />
2. Double panorama </td></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#ceiling_desktop_rectilinear">Ceiling/Desktop Rectilinear</a> </td><td align="middle">Fisheye </td><td>1. Do rectilinear for North / South / East / West part<br  />
2. Gravity direction point to fisheye circle </td><td>Ceiling mount quad view surveillance </td></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#ceiling_desktop_sub">Ceiling/Desktop Sub Region</a> </td><td align="middle">Fisheye </td><td>1. Flexibly select any ROI of input image with distortion removal <br  />
2. Gravity direction is pointing to the fisheye circle </td><td><p class="starttd">1. Ceiling mount surveillance camera <br  />
2. Video conference camera</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#transform_twin_vector_to_idsp_format">2D Vector Conversion</a> </td><td align="middle">LDC </td><td>1. Multiple formats of 2D vector generation:<br  />
a. Pixel level 2D vector <br  />
b. Grid level 2D vector <br  />
c. Pure coodinate file <br  />
2. Conversion deviation is within 1 pixel unit </td><td>Customized warp effect </td></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#load_zzy_calib_param">Load Calibration Parameters for Undistortion</a> </td><td align="middle">LDC </td><td>Prepare below parameters in advance for undistortion:<br  />
a. Radical / tangential distortion parameters <br  />
2. Intrinsic matrix </td><td>1. Do camera undistortion precisely <br  />
2. Stereo camera warp for disparity map </td></tr>
<tr>
<td align="middle"><a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#perspective_matrix">Warp by Perspective Matrix</a> </td><td align="middle">LDC </td><td>Flexibly specify perspective transformation </td><td>Perspective transformation </td></tr>
</table>
<h2><a class="anchor" id="no_transform"></a>
2.1 No Transform</h2>
<p ><b>No transform:</b> No transform image from the wide angle sensor. Usually, it is an image that curves in both horizontal and vertical directions. </p><div class="image">
<img src="../../no_transform_model.png" alt=""/>
<div class="caption">
Figure 2-1. No Transform Model.</div></div>
<p> <b>View source:</b> The user specifies the source of the view from either the fake pre-main buffer or sub-buffers of unwarped channels. <br  />
<b>Up / down scaling:</b> The scaling factor from the source in the fake pre-main buffer to the output view in the main buffer is decided by the source size and the output size.</p>
<h2><a class="anchor" id="no_transform_rotate"></a>
2.2 No Transform Rotate</h2>
<p >This is an advanced mode fpr no transform <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#no_transform">2.1 No Transform</a>, which enables rotation in the range [-180, 180] (for LDC, the range is limited to [-45, 45]) and zoom in the range [0.25f, 4.0f]. </p><div class="image">
<img src="../../no_trans_rotate_model.png" alt=""/>
<div class="caption">
Figure 2-2. No Transform Rotate Model.</div></div>
<p> <br  />
<b>View size:</b> The width of the warp view should be less than or equal to the maximum area width of the corresponding CV5x / CV7x platform. <br  />
<b>Warp area number:</b> Warp view can only have one warp area. Multiple areas for this correction are not supported. </p><div class="image">
<img src="../../no_trans_rotate.png" alt=""/>
<div class="caption">
Figure 2-3. No Transform Rotate.</div></div>
<h2><a class="anchor" id="wall_rectilinear"></a>
2.3 Wall Rectilinear</h2>
<p ><b>Rectilinear:</b> The dewarped image with correction in both horizontal and vertical directions. In this view, the image is restored in the vertical and horizontal directions. </p><div class="image">
<img src="../../rectilinear_model.png" alt=""/>
<div class="caption">
Figure 2-4. Rectilinear Model.</div></div>
<p> <b>View size:</b> Assume that the radius of the fisheye circle in the fake pre-main buffer is R. The following size is not mandatory, but recommended. <br  />
Rectilinear view width / height &lt;= 2R <br  />
<b>View center:</b> The center remains the same as the fisheye circle. When the zoom factor is 1.0x, the objects in the center of the corrected view maintain the same size as the fisheye view. To see the view center in the fisheye and wall mount modes, see the images within the red circles in Figure 2-5 Wall Rectilinear FoV. <br  />
<b>Gravity line:</b> The image is restored along the direction of the gravity line (yellow line in Figure 2-6 Wall Rectilinear). <br  />
<b>Horizontal line:</b> The image is restored along the direction of the horizontal line (Figure 2-6 Wall Rectilinear). </p><div class="image">
<img src="../../wall_rectilinear_fov.png" alt=""/>
<div class="caption">
Figure 2-5. Wall Rectilinear FoV.</div></div>
<p> <br  />
<b>FoV:</b> The FoV for the rectilinear view depends on the view size. Horizontal FoV = 2 * arctan (view width / 2 / focal length) Vertical FoV = 2 * arctan (view height / 2 / focal length) <br  />
For example, the fisheye circle size is 2048 pixels at 185 degrees. The lens's projection method is f-theta. The focal length is 2048 / (185 / 180 * Pi) = 634.3. The horizontal / vertical FoV in Figure 2-6 Wall Rectilinear view is 116 degrees. In Figure 2-5 Wall Rectilinear FoV, 95 degrees is for 1536x1536 and 76 degrees is for 1024x1024. </p><div class="image">
<img src="../../wall_rectilinear_zoom.jpg" alt=""/>
<div class="caption">
Figure 2-6. Wall Rectilinear.</div></div>
<p> <br  />
<b>Zooming in/out:</b> The objects far from the center appear "stretched". See the image within the blue circles in Figure 2-5 Wall Rectilinear. Zooming out the rectilinear view enables a wider FoV but includes more "stretched" objects. </p><div class="image">
<img src="../../wall_rectilinear_zoom_factor.png" alt=""/>
<div class="caption">
Figure 2-7. Wall Rectilinear Zoom.</div></div>
<p> <br  />
<b>Advanced warp: </b> Advanced warp corrections include wall rectilinear, pan / tilt / rotate, region of interest (ROI)+rotate, advanced polar warp, and advanced pitch / yaw.</p>
<h3><a class="anchor" id="wall_adv_polar_warp"></a>
2.3.1 Advance Polar Warp</h3>
<p >Currently, only wall rectilinear correction supports advanced polar warp. Polar coordinates ( \(r*\theta\)) are used to indicate the parameters of polar warp: \(r\) indicates polar strength while \(\theta\) indicates direction. While polar warp offers a different perspective of an object, its FoV almost always remains the same. </p><div class="image">
<img src="../../polar_warp.png" alt=""/>
<div class="caption">
Figure 2-7. Polar Warp.</div></div>
<h3><a class="anchor" id="wall_eyeball_rotation"></a>
2.3.2 Tilt / Pan / Rotate or ROI / Rotate</h3>
<p >The lens tilt / pan / rotate correction functions with different camera positions. Currently, only wall rectilinear mode supports tilt / pan / rotate. Because the full range of horizontal FoV, wall panorama / wall cylindrical panorama / wall mercator / wall equirectangular supports pitch, not tilt. <br  />
<b>Tilt:</b> Rotate about center vertically. Tilt degree range is [-90, +90]. <br  />
<b>Pan:</b> Rotate about center horizontally. Pan degree range is [-90, +90]. <br  />
<b>Rotate:</b> Rotate about center symmetry. Rotate degree range is limited to [-180, +180]. </p><div class="image">
<img src="../../lens_ptr.png" alt=""/>
<div class="caption">
Figure 2-8. Wall Mount Lens Tilt / Pan / Rotate.</div></div>
<h3><a class="anchor" id="wall_adv_py"></a>
2.3.3 Advanced Pitch / Yaw</h3>
<p >Currently, only wall rectilinear supports advanced pitch / yaw. While pitch / yaw enables all pixels or grids to rotate around the axis with the same angle, advanced pitch / yaw specifies a different angle for each row or column of an image. The current version of advanced warp requires pitch / yaw values at both borders of the image (top / bottom, left / right); the value of internal rows or columns between them is calculated using linear interpolation. </p><div class="image">
<img src="../../avdv_py.png" alt=""/>
<div class="caption">
Figure 2-9. Wall Rectilinear: Advanced Pitch / Yaw.</div></div>
<h2><a class="anchor" id="wall_panorama"></a>
2.4 Wall Panorama</h2>
<p ><b>Panorama:</b> The dewarped image is corrected only in the vertical direction. In this view, the image is restored in the vertical direction. </p><div class="image">
<img src="../../panorama_model.png" alt=""/>
<div class="caption">
Figure 2-10. Panorama Model.</div></div>
<p> Currently, the dewarp library supports four types of cylindrical panoramic projection, each with different features. The following images illustrate the differences between panoramic views. </p><div class="image">
<img src="../../panorama_cmparison.png" alt=""/>
<div class="caption">
Figure 2-11. Comparison of Panoramic Views.</div></div>
<h3><a class="anchor" id="wall_cylinder_panorama"></a>
2.4.1 General Cylindrical and Panorama</h3>
<p >In panoramic imaging, the cylindrical projection is most frequently used for prints of wide panoramas, which occupy large ranges (&gt;120 degrees) of longitude. While cylindrical projection preserves verticals, it cannot represent data near the poles (nadir and zenith), which are distorted and stretched indefinitely. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">H-FoV   </th><th class="markdownTableHeadCenter">V-FoV   </th><th class="markdownTableHeadCenter">Horizontal Curvature   </th><th class="markdownTableHeadCenter">Width / Height Ratio    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Interactive parameters   </td><td class="markdownTableBodyCenter">Proportional to H-FoV   </td><td class="markdownTableBodyCenter">The closer to the top or bottom of the image, the more curved it is   </td><td class="markdownTableBodyCenter">8:3   </td></tr>
</table>
<p><br  />
<b>View size:</b> Assume the radius of the fisheye circle in the fake pre-main buffer is R. Although the following size is not mandatory, Ambarella recommends the following: <br  />
Panorama view width &lt;= 2R <br  />
Panorama view width / Panorama view height = 8 / 3 <br  />
<b>View center:</b> The center remains the same as the fisheye circle. The objects in the center of the corrected view maintain the same size as in the fisheye view. Observe the red circles in Figure 2-12 Wall Panorama. <br  />
<b>Gravity line:</b> The image is restored in the direction of the gravity line (yellow vertical line in Figure 2-12 Wall Panorama). </p><div class="image">
<img src="../../wall_panorama.png" alt=""/>
<div class="caption">
Figure 2-12. Wall Panorama.</div></div>
<p> <br  />
<b>FoV:</b> The horizontal FoV (Figure 2-13 Wall Panorama: Horizontal FoV) must to be specified by the user. The vertical FoV (Figure 2-14 Wall Panorama: Vertical FoV) depends on the view height. The greater the view height is, the wider the vertical FoV will be. </p><div class="image">
<img src="../../wall_panor_h_fov.png" alt=""/>
<div class="caption">
Figure 2-13. Wall Panorama: Horizontal FoV</div></div>
 <div class="image">
<img src="../../wall_panor_v_fov.png" alt=""/>
<div class="caption">
Figure 2-14. Wall Panorama: Vertical FoV.</div></div>
<p> <br  />
<b>Fan warp by moving the warp axis:</b> The fan degree is specified by the user. The range is [-100~100]; it can perform panorama with fan warp using the moving warp axis, rather than providing the same vertical FoV.</p>
<h3><a class="anchor" id="wall_mercator"></a>
2.4.2 Mercator</h3>
<p >The Mercator projection is a cylindrical map projection that represents lines of a constant course. This projection enables a larger vertical FoV than general cylindrical or panoramic projections, and a smaller vertical FoV than equirectangular, when the horizontal FoV is the same. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">H-FoV   </th><th class="markdownTableHeadCenter">V-FoV   </th><th class="markdownTableHeadCenter">Horizontal Curvature   </th><th class="markdownTableHeadCenter">Width / Height Ratio    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Interactive parameters   </td><td class="markdownTableBodyCenter">Proportional to H-FoV   </td><td class="markdownTableBodyCenter">The closer to the top or bottom of the image, the more curved it is   </td><td class="markdownTableBodyCenter">1:1   </td></tr>
</table>
<p><b>View size:</b> Assume the radius of the fisheye circle in the fake pre-main buffer is R. The following size is not mandatory but recommended by Ambarella. <br  />
Mercator view height = Mercator view width &lt;= 2R <br  />
Mercator view width / panorama view height = 1 /1 <br  />
<b>View center:</b> The center remains the same as the fisheye circle. The objects in the center of the corrected view maintain the same size as they do in the fisheye view. See the red circles in Figure 2-15 Wall Mercator. <br  />
<b>Gravity line:</b> The image is restored in the direction of the gravity line (yellow vertical line in Figure 2-15 Wall Mercator). </p><div class="image">
<img src="../../wall_mercator.png" alt=""/>
<div class="caption">
Figure 2-15. Wall Mercator.</div></div>
<p> Mercator projection is the most commonly used map projection. The central meridian projects in a straight line. Other meridians project to straight lines with X constant. The Equator projects to the straight line, and parallel circles project to the straight lines of the constant Y. The projection is unbounded in the Y direction. The poles lie at infinity. The Mercator projection distorts the size of objects as the latitude increases from the Equator to the poles. Only the vertical straight lines and the horizontal line remain as straight lines in the panorama. All other lines become curved.</p>
<h3><a class="anchor" id="wall_equirectangular"></a>
2.4.3 Equirectangular</h3>
<p >Also referred to as the "non-projection", equirectangular projection is a representation of the sphere that maps longitude directly to the horizontal coordinate, and latitude to the vertical coordinate. It is commonly used as the projection type of the source images for spherical panorama viewers. In addition, it has the largest vertical FoV, with the south and north poles of the sphere visible in the output. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">H-FoV   </th><th class="markdownTableHeadCenter">V-FoV   </th><th class="markdownTableHeadCenter">Horizontal Curvature   </th><th class="markdownTableHeadCenter">Width / Height Ratio    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Interactive parameters   </td><td class="markdownTableBodyCenter">Proportional to H-FoV   </td><td class="markdownTableBodyCenter">The closer to the top or bottom of the image, the more curved it is   </td><td class="markdownTableBodyCenter">1:1   </td></tr>
</table>
<p><br  />
<b>View size:</b> Assume the radius of the fisheye circle in the fake pre-main buffer is R. The following size is not mandatory, but recommended by Ambarella. <br  />
Equirectangular view width &lt;= 2R <br  />
Equirectangular view width / panorama view height = 1 / 1 <br  />
<b>View center:</b> The center remains the same with the fisheye circle. The objects in the center of the corrected view maintain the same size as they do in the fisheye view. See the red circles in Figure 2-16 Wall Equirectangular. <br  />
<b>Gravity line:</b> The image is restored in the direction of the gravity line (yellow vertical line in Figure 2-16 Wall Equirectangular). </p><div class="image">
<img src="../../wall_equirectangular.png" alt=""/>
<div class="caption">
Figure 2-16. Wall Equirectangular.</div></div>
<p> The equirectangular projection maps meridians to vertical straight lines of constant spacing (for meridional intervals of constant spacing), and circles of latitude to horizontal straight lines of constant spacing (for constant intervals of parallels). The projection is neither equal area nor conformal. It is not often used in navigation or cadastral mapping. Only vertical straight lines and the horizon line remain straight lines in the panorama; all other lines become curved.</p>
<h3><a class="anchor" id="wall_squircular"></a>
2.4.4 Squircular</h3>
<div class="image">
<img src="../../squircular_model.png" alt=""/>
<div class="caption">
Figure 2-17. Squircular Model.</div></div>
<p> In this view, the fisheye circle is mapped to a square with little FoV loss; distortion cannot be removed completely. Users can also specify the horizontal FoV with the option "h" and change the vertical FoV via vertical zoom. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">H-FoV   </th><th class="markdownTableHeadCenter">V-FoV   </th><th class="markdownTableHeadCenter">Horizontal Curvature   </th><th class="markdownTableHeadCenter">Width / Height Ratio    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Interactive parameters   </td><td class="markdownTableBodyCenter">Proportional to H-FoV   </td><td class="markdownTableBodyCenter">The closer to the corner of the image, the more curved it is   </td><td class="markdownTableBodyCenter">1:1   </td></tr>
</table>
<p><br  />
<b>View size:</b> Assume the radius of the fisheye circle in the fake pre-main buffer is R. The following size is not mandatory, but recommended by Ambarella. <br  />
Squircular view width &lt;= 2R <br  />
Squircular view width / panorama view height = 1 / 1 </p><div class="image">
<img src="../../wall_squircular.png" alt=""/>
<div class="caption">
Figure 2-17. Wall Squircular.</div></div>
<p> A squircle is a shape intermediate between a square and a circle. There are at least two definitions of "squircle" in use, the most common of which is based on the superellipse. The word "squircle" is a portmanteau of the words "square" and "circle". Squircles have been applied in design and optics.</p>
<h3><a class="anchor" id="wall_pano_fan"></a>
2.4.5 Fan Warp</h3>
<div class="image">
<img src="../../fan_warp.png" alt=""/>
<div class="caption">
Figure 2-18. Wall Mount: Panorama with Fan Warp.</div></div>
<p> The results of fan warp in a panoramic view resemble a fan. In the panoramic view, the image is restored in the vertical direction, and only the horizontal line in the middle of the image is straightened. Using fan warp, the unique straight horizontal line is vertically shifted up and down.</p>
<h2><a class="anchor" id="wall_vertical_panorama"></a>
2.5 Wall Vertical Panorama</h2>
<p ><b>Vertical panorama:</b> In this view, the image is restored only in the horizontal direction. It is a transverse transformation of horizontal panoramic correction. </p><div class="image">
<img src="../../vertical_panorama_model.png" alt=""/>
<div class="caption">
Figure 2-19. Vertical Panorama Model.</div></div>
<h3><a class="anchor" id="wall_transverse_mercator"></a>
2.5.1 Transverse Mercator</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">V-FoV   </th><th class="markdownTableHeadCenter">H-FoV   </th><th class="markdownTableHeadCenter">Vertical Curvature   </th><th class="markdownTableHeadCenter">Width / Height Ratio    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Interactive parameters   </td><td class="markdownTableBodyCenter">Proportional to V-FoV   </td><td class="markdownTableBodyCenter">The closer to the left or right of the image, the more curved it is   </td><td class="markdownTableBodyCenter">1:1   </td></tr>
</table>
<p><b>View size:</b> Assume the radius of the fisheye circle in the fake pre-main buffer is R. The following size is not mandatory but recommended by Ambarella. <br  />
Transverse mercator view height &lt;= 2R <br  />
Transverse mercator view width / panorama view height = 1 / 1 <br  />
When the vertical FoV becomes larger, the ratio of width / height = 3 / 8 <br  />
<b>View center:</b> The center remains the same as the fisheye circle. The objects in the center of the corrected view maintain the same size as in the fisheye view. Observe the red circles in Figure 2-20 Wall Mount: Transverse Mercator. <br  />
<b>Gravity line:</b> The image is restored in the direction of the horizontal line (yellow vertical line in Figure 2-20 Wall Mount: Transverse Mercator) <br  />
The transverse mercator map projection is an adaptation of a map projection widely used in national and international mapping systems around the world. Turning the Mercator projection's cylinder so that it is tangential to the Earth along a meridian (longitude line) instead of the Equator results in the Transverse Mercator projection. </p><div class="image">
<img src="../../transverse_mercator.png" alt=""/>
<div class="caption">
Figure 2-20. Wall Mount: Transverse Mercator.</div></div>
<h3><a class="anchor" id="wall_transverse_cylinder"></a>
2.5.2 Transverse General Cylindrical</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">V-FoV   </th><th class="markdownTableHeadCenter">H-FoV   </th><th class="markdownTableHeadCenter">Vertical Curvature   </th><th class="markdownTableHeadCenter">Width / Height Ratio    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Interactive parameters   </td><td class="markdownTableBodyCenter">Proportional to V-FoV   </td><td class="markdownTableBodyCenter">The closer to the left or right of the image, the more curved it is   </td><td class="markdownTableBodyCenter">3:8   </td></tr>
</table>
<p><b>View size:</b> Assume the radius of the fisheye circle in the fake pre-main buffer is R. The following size is not mandatory but recommended by Ambarella. <br  />
Transverse cylinder view height &lt;= 2R <br  />
Transverse cylinder view width / panorama view height = 3 / 8 <br  />
<b>View center:</b> The center remains the same as the fisheye circle. The objects in the center of the corrected view maintain the same size as in the fisheye view. Observe the red circles in Figure 2-21 Wall Mount: Vertical Panorama. <br  />
<b>Gravity line:</b> The image is restored in the direction of the horizontal line (yellow vertical line in Figure 2-21 Wall Mount: Vertical Panorama). </p><div class="image">
<img src="../../trans_cylinder.png" alt=""/>
<div class="caption">
Figure 2-21. Wall Mount: Vertical Panorama.</div></div>
<p> The vertical panorama is similar to the horizontal panorama, except for the projection order. The vertical panorama simply corrects the horizontal line while the vertical line is curved, as in the fisheye view. However, this correction is not typically used because the result is unsuitable for human vision.</p>
<h2><a class="anchor" id="wall_pannini"></a>
2.6 Wall Pannini</h2>
<p >Pannini projection is an approach to creating wide-angle views that avoid the stretching that occurs for wide standard perspective views, such as wall rectilinear. The projection is a variant on a cylindrical projection; that is, vertical structures remain straight in the projection. </p><div class="image">
<img src="../../wall_pannini.png" alt=""/>
<div class="caption">
Figure 2-22. Wall Mount: Pannini.</div></div>
<h2><a class="anchor" id="wall_pincushion"></a>
2.7 Wall Pincushion</h2>
<p >Pincushion causes straight lines outside the image center to be bent inwards (like a pincushion). Pincushion distortion, the exact opposite of barrel distortion, is a lens radical distortion. With pincushion, it is easier to detect with a telephoto lens. It occurs due to image magnification increasing towards the edges of the frame optical axis. It is important to know that most zoom lenses that go from wide angle to standard or telephoto focal lengths typically suffer from barrel distortion at the shortest focal length, which gradually transitions to pincushion distortion towards the longest end. </p><div class="image">
<img src="../../wall_pincushion.png" alt=""/>
<div class="caption">
Figure 2-23. Wall Mount: Pincushion.</div></div>
<h2><a class="anchor" id="ceiling_desktop_panorama_fulframe"></a>
2.8 Ceiling / Desktop Panorama and Full Frame</h2>
<p ><b>Panorama:</b> Dewarped image with correction in vertical directions. In this view, users should set the orientation (north / south / west / east (NSWE) and horizontal angle range in degrees. <br  />
<b>Full frame:</b> Dewarped image with correction in vertical directions; projection type is the same as equirectangular. It projects half of the full FoV of lens in radial directions. In this view, users should set the orientation (NSWE) and horizontal angle range in degrees. It should have a larger vertical FoV than that of panoramic. </p><div class="image">
<img src="../../cd_model.png" alt=""/>
<div class="caption">
Figure 2-24. Ceiling / Desktop Panorama Model.</div></div>
<p> <br  />
<b>View size:</b> Assume that the radius of the fisheye circle in the fake pre-main buffer is R. The following size is not mandatory, but recommended by Ambarella. <br  />
Panorama view width / height &lt;= R <br  />
<b>Orientation:</b> The definition of the orientation in the fisheye circle is shown in Figure 2-26 Ceiling Panorama: 360 View. <br  />
<b>Gravity line:</b> In the ceiling mount view, the gravity lines point to the fisheye center. Only the gravity lines in the north are vertical to the ground. In the corrected view, all lines in the direction of the gravity are restored. <br  />
<b>Top angle:</b> The top angle defines the maximum incident angle in the corrected view. Ensure that the value is close to Pi/2, or the objects at the bottom of the rectilinear view may appear "over-stretched". <br  />
<b>FoV:</b> The horizontal FoV is specified by users. The definition of the horizontal FoV is shown in Figure 2-25 Ceiling Panorama: Horizontal FoV. The vertical FoV depends on the zoom-in factor and view height. </p><div class="image">
<img src="../../ceiling_panor_fov.png" alt=""/>
<div class="caption">
Figure 2-25. Ceiling Panorama: Horizontal FoV.</div></div>
<p> <br  />
<b>Zoom in in vertical:</b> The area further from the top angle may appear too "stretched". User can zoom in the vertical direction to eliminate the stretched appearance. <br  />
<b>360 Panorama:</b> A 360-degree panoramic picture is composed of four 90-degree panorama warp views separately in the north / south / west / east orientations. Each 90-degree warp view can be divided into two warp areas. The four 90-degree panorama warp views must use the same top angle and FoV to achieve seamless stitching on the edge. The order of the 90 pictures in a 360-degree panorama view can be assigned according to the requirement. </p><div class="image">
<img src="../../ceiling_panor_view.png" alt=""/>
<div class="caption">
Figure 2-26. Ceiling Panorama: 360-Degree View.</div></div>
<h2><a class="anchor" id="ceiling_desktop_rectilinear"></a>
2.9 Ceiling / Desktop Rectilinear</h2>
<p ><b>Rectilinear:</b> Dewarped image with correction in both the horizontal and vertical directions. In this view, users should set the orientation (NSWE) of the part for warp correction. </p><div class="image">
<img src="../../cd_rectilinear_model.png" alt=""/>
<div class="caption">
Figure 2-27. Ceiling / Desktop Rectilinear Model.</div></div>
<p> <br  />
<b>View size:</b> Suppose that the radius of the fisheye circle in the fake pre-main buffer is R. The following size is not mandatory, but recommended by Ambarella. <br  />
Rectilinear view width &lt;= 2R <br  />
Rectilinear view height &lt;= R </p><div class="image">
<img src="../../ceiling_orient.png" alt=""/>
<div class="caption">
Figure 2-28. Ceiling Mount: Definition of Orientation.</div></div>
<p> <br  />
<b>Orientation:</b> The definition of the orientation in the fisheye circle is shown in Figure 2-28 Ceiling Mount: Definition of Orientation. <br  />
<b>Gravity line:</b> In the ceiling mount view, the gravity lines are pointing to the fisheye center. Only the gravity lines in the north are vertical to the ground. In the corrected view, all lines (yellow vertical line in Figure 2-29 Ceiling Rectilinear) in the direction of the gravity are restored. <br  />
<b>Horizontal Line:</b> Lines in the horizontal direction (yellow horizontal line in Figure 2-29 Ceiling Rectilinear) are restored. </p><div class="image">
<img src="../../ceiling_rectilinear.png" alt=""/>
<div class="caption">
Figure 2-29. Ceiling Rectilinear.</div></div>
<p> <br  />
<b>Top angle:</b> The top angle defines the maximum incident angle in the corrected view. Ensure that the value is close to Pi/2, or the objects on the bottom of the rectilinear view may appear "over-stretched". Figure 2-30 Ceiling Mount: Definition of Top Angle shows the rectilinear view with two top angles. </p><div class="image">
<img src="../../top_angle_def.png" alt=""/>
<div class="caption">
Figure 2-30. Ceiling Mount: Definition of Top Angle.</div></div>
 <div class="image">
<img src="../../top_angle_ex.png" alt=""/>
<div class="caption">
Figure 2-31. Ceiling Rectilinear: Top Angle.</div></div>
<p> <br  />
<b>FoV:</b> The FoV of the rectilinear view depends on its size. The larger the view size is, the wider the FoV is. <br  />
<b>Zoom in:</b> The corrected view can be zoomed in around the point at the top angle.</p>
<h2><a class="anchor" id="ceiling_desktop_sub"></a>
2.10 Ceiling / Desktop Sub-Region</h2>
<p ><b>Sub-region:</b> Dewarped image with correction in both the horizontal and vertical directions. In this view, users can set the projected orientation (NSWE) for warp correction. Orientation refers to projected orientation rather than location orientation. The orientations of west and east should correspond with stream rotation. Pan / tilt angles are also set in degrees. </p><div class="image">
<img src="../../cd_sub_model.png" alt=""/>
<div class="caption">
Figure 2-32. Ceiling / Desktop Sub-Region Model.</div></div>
 <div class="image">
<img src="../../ceiling_subx4.png" alt=""/>
<div class="caption">
Figure 2-33. Ceiling Sub-Region x4.</div></div>
<p> Although similar to wall mount in that there is one mapping pair of pan and tilt angles for each ROI center in the fisheye view, the definitions of the pan-tilt angles are different. <br  />
<b>View size:</b> Assume the radius of the fisheye circle in the fake pre-main buffer is R. The following size is not mandatory, but recommended by Ambarella. <br  />
Sub-region width / height &lt;= R <br  />
<b>View center:</b> The view center is specified by users. When the zoom factor is 1.0x, the objects in the center of the corrected view maintain the same size as they do in the fisheye view. </p><div class="image">
<img src="../../ceiling_sub_roi.png" alt=""/>
<div class="caption">
Figure 2-34. Ceiling Sub-Region: ROI Center.</div></div>
<p> <br  />
<b>Note that:</b> <br  />
<b>1)</b> The incident angle of the view center must be within Pi/2, which means the distance from the point to the fisheye center must be no greater than F(Pi/2). F( ) is the lens's projection function. <br  />
<b>2)</b> If only one warp area is enabled in this mode, there will be distortion if both the pan and tilt angles are large. The distortion can be avoided if two warp areas are used. <br  />
<b>Pan-tilt angle:</b> The pan-tilt angle is specified by users. The definition of the pan-tilt system can be referred in Figure 2-35 Ceiling Sub-Region: Pan-Tilt Angle. <br  />
<b>Note that:</b> <br  />
<b>1)</b> There is distortion when both the pan and tilt angles are large if only one warp area is enabled. The tolerance of the sum of pan and tilt angles is not a fixed value; it depends on the zoom factor and FoV of the corrected picture. <br  />
<b>2)</b> If two warp areas are enabled, this distortion can be eliminated. <br  />
<b>FoV:</b> The FoV of the corrected view depends on the size of the view and the zoom factor. <br  />
<b>Zooming in:</b> The corrected view can be zoomed in around the view center. </p><div class="image">
<img src="../../ceiling_sub_pan_tilt.png" alt=""/>
<div class="caption">
Figure 2-35. Ceiling Sub-Region: Pan-Tilt Angle.</div></div>
 <div class="image">
<img src="../../ceiling_sub_fov.png" alt=""/>
<div class="caption">
Figure 2-36. Ceiling Sub-Region: FoV (Pan Angle = 33 , Tilt Angle = -60).</div></div>
<h2><a class="anchor" id="transform_twin_vector_to_idsp_format"></a>
2.11 Transform 2D Vector to 1D+1D</h2>
<p >The dewarp library generates 1D+1D vectors, which can be recognized by the IDSP. 1D+1D performs horizontal or vertical warp first, and then the other directions afterwards. This is different from performing the horizontal and vertical warp simultaneously with a 2D vector or remapped coordinate file. <br  />
The dewarp library provides transformation function "lens_warp_from_twin_vector" and "lens_warp_from_twin_coord" which could reproduce a customized warp result with the deviation within one pixel. Generally, the coordinate of the source in input domain for each output point should be found, for example, (Xo, Yo) is from (Xi, Yi). Note that (Xi, Yi) should be sufficiently accurate at the sub-pixel level (1/16 pixel); do NOT round up, round down, or complete any other operations that could cause accuracy loss. Currently, this feature can be enabled in encode modes with lens warp enable; it cannot be enabled in encode mode 1. </p>
<h3><a class="anchor" id="autotoc_md0"></a>
lens_warp_from_twin_vector</h3>
<p ><br  />
The function <b>"lens_warp_from_twin_vector"</b> requires a fixed format for the 2D vector in binary.</p><ol type="1">
<li>Each 2D vector value should be a signed short (s11.4) caluclated from (input coordinate - output coordinate) * 16. For example, x_part=(Xi-Xo)*16, y_part=(Yi-Yo)*16.</li>
<li>Separate x_part and y_part into planar formats. The x_part is located at the first half.</li>
<li>The 2D vector can be either pixel level or grid level. For a grid-level 2D table, the pixel number between two grids (called grid spacing) is restricted to be 8 / 16 / 32 / 64 / 128, and the grid number in the horizontal direction is restricted less than 128, while the grid number in the vertical direction is restricted less than 96. For example, Ambarella suggests that a 2D vector for 1080p should be column=121, row=69, and grid spacing is 16 for both the horizontal and vertical directions. The dewarp library includes one API <a class="el" href="../../d6/d90/group__dewarp-api-api.html#gac2f7d08c6119c2472eab67f3838ab42f">lens_warp_get_grid_spacing</a> to aid users in obtaining the actual grid spacing value for the specific window resolution. <p class="formulaDsp">
\[ horizontal\_grid\_spacing = \frac{1920}{16} + 1 = 121; \]
</p>
 <p class="formulaDsp">
\[ vertical\_grid\_spacing = \frac{round\_up(1080, 16)}{16} + 1 = 69; \]
</p>
</li>
</ol>
<p ><br  />
<b> 2D Vector Validity Rules </b> <br  />
Users must follow the rules below when generating a 2D vector. Ignoring any of the following rules can lead to image artifacts and other unpredictable errors for processes that utilize the converted 1D+1D warp table.</p><ol type="1">
<li>Point coordinate sign check: the pixels in the VIN domain, with the coodinate origin at the top-left of the image, must not be assigned a negative value. Ambarella suggests setting the coordinate to zero as a workround. Similar rules apply for coorinates originating at the top-right / bottom-left / bottom-right of the iamge.</li>
<li>Coordinate monotonic: use one row of output images as an example. If point A is located with a larger coorindate value than point B, the source point in the VIN domain for point A must have a larger coordinate value than that of point B. The same rules apply for image columns when calculating the vertical part of the 2D vector.</li>
<li>2D vector size: the 2D vector is always at the pixel level or grid level. Users must obtain the resolution with the output size aligned to a magic number (8 / 16 / 32 / 64 / 128 / 256). Refer to the function "lens_warp_get_grid_spacing" or run the commands below: <div class="fragment"><div class="line"><span class="preprocessor"># test_ldc -c 0 --get-align 1920x1080</span></div>
<div class="line">[INFO]  get_twin_vector_alignment:</div>
<div class="line">The alignment should be 16 <span class="keywordflow">for</span> width(1920) and 16 for height(1080). Afer padding, the final resolution for</div>
<div class="line">2D vector generating is 1920x1088.</div>
</div><!-- fragment --></li>
<li>Maximum shift in pixel units: the vector value is saved in s16 (signed short, s11.4), so the maximum shift is no larger than 2048 pixels.</li>
<li>Lens warp under encode mode 0 is limited by vertical warp waitlines. It indicates the amount of image lines pre-loaded from smem, which is served for the vertical warp stage. The value can be set using "max-vwarp-wait-lines" in channel configuration, only in the DSP idle state. Therefore, users must obtain the required waitlines according to the 2D vector beforehand, then bring it into system smem consumption. Users can obtain the source codes of computing waitlines with the 2D vector from the Ambarella Shanghai SDK team.</li>
<li>To avoid the repeated line artifacts in the horizontal warp stage, the "max-padding-width" from channel configuration should be set as a reasonable value. Too much padding width brings IDSP performance penalty. Ambarella recommends that users get help from the host tool "amba_warp_tool_x86_v1.0.0".</li>
</ol>
<p ><br  />
 </p>
<h3><a class="anchor" id="autotoc_md1"></a>
lens_warp_from_twin_coord</h3>
<p ><br  />
The function <b>"lens_warp_from_twin_coord"</b> supports loading pure float coordinate. No need to generate 2D vector beforehand but the rules below must be followed when saving the coordinate value into a binary.</p><ol type="1">
<li>(Xi, Yi) is saved in <a class="el" href="../../de/dc8/structfpoint__t.html" title="point coordinate value in float.">fpoint_t</a> format for each (Xo, Yo). Both (Xi, Yi) and (Xo, Yo) are at the top left coordinate origin, and the negative coodinate is NOT allowed.</li>
<li>This function accepts both pixel level and grid level coordinate file. Same restriction as the grid level twin vector mentioned above.</li>
<li>The coordinate file must contain extra rows or columns according to the alignment requirements. For a specific resolution, refer to the function "lens_warp_get_grid_spacing" and the example above.</li>
</ol>
<h2><a class="anchor" id="load_zzy_calib_param"></a>
2.12 Loading Zhang Zhengyou Calibration Parameters</h2>
<p >The dewarp library is capable of loading calibration parameters generated via the Zhang Zhengyou method.</p><ul>
<li>Intrinsic matrix: [fx, fy, cx, cy]</li>
<li>Optimal intrinsic matrix: [fx, fy, cx, cy]</li>
<li>Radical distortion parameters: [k1, k2, k3, k4, k5, k6]</li>
<li>Tangential distortion parameters: [p1, p2]</li>
</ul>
<h2><a class="anchor" id="perspective_matrix"></a>
2.13 Warp by Perspective Matrix</h2>
<p >The essence of perspective transformation is to project the image from one viewing plane to another. The relationship between two viewing planes can be described by a perspective matrix (3x3) mathematically. <br  />
 The perspective matrix can be obtained from the coordinates of four corresponding points in two images. The open source library "OpenCV" provides the API "getPerspectiveTransform(...)" to load the four corresponding points and output the matrix in an array. </p><div class="image">
<img src="../../perspective_matrix.png" alt=""/>
<div class="caption">
Figure 2-37. Perspective Matrix.</div></div>
<h2><a class="anchor" id="point_mapping"></a>
2.14 Point Mapping</h2>
<p >The point mapping feature is designed to map the point from the corrected view to the uncorrected view, or perform calculation in the reverse direction.</p>
<h3><a class="anchor" id="point_mapping_warp_param"></a>
2.14.1 Point Mapping with Warp Parameters</h3>
<p >In this method, users must prepare all related warp parameters to the dewarp library; the process is similar to generating a warp table. Note that this method is only supported in multi-region warp mode (encode mode 1), and the uncorrected view here indicates the fake pre-main buffer domain. Refer to the example <a class="elRef" target="_blank" href="../../../video/d5/d18/fs_adv_dewarp.html#ut_point_mapping">point mapping with warp parameters</a> in the feature sets.</p>
<p >There are four coordinate systems in the library. In each of the coordinate systems, the X axis points to the right and the Y axis points to the bottom.</p><ol type="1">
<li><b>Coordinate system of the pre-main buffer:</b> The upper left corner of the pre-main buffer is the ordinate origin, called <code>Pre-Main</code> in the following sections.</li>
<li><b>Coordinate system of the fisheye circle:</b> The center of the fisheye circle is the ordinate origin. It is called <code>Fisheye</code>.</li>
<li><b>Coordinate system of the main buffer:</b> The upper left corner of the main buffer is the ordinate origin. It is called <code>Main</code>.</li>
<li><b>Coordinate System of the Corrected View:</b> The upper left corner of the corrected view is the ordinate origin. It is called <code>View</code>.</li>
</ol>
<div class="image">
<img src="../../coordinate_systems.png" alt=""/>
<div class="caption">
Figure 2-38. Coordinate Systems.</div></div>
<h3><a class="anchor" id="point_mapping_warp_table"></a>
2.14.2 Point Mapping with 1D+1D Warp Table</h3>
<p >In this method, users are not required to prepare the related warp parameters, but must prepare the generated warp tables (horizontal and vertical), related grid information, and input / output size and location. Note that this method is only supported in the encode mode that supports "lens-warp", and the uncorrected view here indicates the VIN domain. Refer to the example <a class="elRef" target="_blank" href="../../../video/de/d79/fs_adv_ldc.html#fs_point_mapping_warp_table">Point Mapping with 1D+1D Warp Table</a>.</p>
<div class="image">
<img src="../../point_mapping_1D+1D.png" alt=""/>
<div class="caption">
Figure 2-39. Point Mapping with 1D+1D Warp Table.</div></div>
<hr  />
<h1><a class="anchor" id="dewarp_lua_parser"></a>
3. Dewarp Lua Parser</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Version   </th><th class="markdownTableHeadCenter">Update Date   </th><th class="markdownTableHeadLeft">Modification    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">1.0.0   </td><td class="markdownTableBodyCenter">20221020   </td><td class="markdownTableBodyLeft">Create dewarp Lua parser library   </td></tr>
</table>
<p >The dewarp Lua is different from the Lua scripts of entering the preview for test_encode; it is a newly defined script format used to configure the unit test "test_dewarp" command. <br  />
There are almost 12 different dewarp modes (more may be supported in the future) supported in the Ambarella dewarp library (check Section <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_correction_mode">Correction Mode</a>). Several advanced modes are derived from specific dewarp modes, such as polar mode from wall rectilinear and fan warp from wall panorama. After users check the test_dewarp help information, they may find that some options function for all views, some function only for specific modes, and some are shared between a group of modes. The dewarp Lua script makes this configuration more clear and convenient. The following is an overview of the Lua, which contains four parts:</p><ul>
<li>Part 1: resource information, which is effective for all channels</li>
<li>Part 2: per-channel information, which is effective for all views</li>
<li>Part 3: per-view information, which is effective for specific views</li>
<li>Part 4: per-warp mode information, which is effective for the warp modes from corresponding views</li>
</ul>
<div class="image">
<img src="../../dewarp_lua_overall.png" alt=""/>
<div class="caption">
Figure 3-1. Dewarp Lua Scripts Overview.</div></div>
<p >The following is an overview for "warp_mode_adv_param", which lists all parameters for each warp mode. Users can select the required warp mode parameters for their projects and remove the others.</p>
<div class="image">
<img src="../../warp_mode_adv_param.png" alt=""/>
<div class="caption">
Figure 3-2. warp_mode_adv_param.</div></div>
<p >Below are reference examples. Contact the Ambarella SDK support team for assistance.</p>
<h2><a class="anchor" id="dlp_wall_rectilinear"></a>
3.1 Dewarp Lua for Wall Rectilinear</h2>
<p ><a href="../../scripts/dewarp_lua_wall_rectilinear.lua" target="_blank"><b>dewarp_lua_wall_rectilinear.lua</b></a></p>
<div class="fragment"><div class="line">board # test_dewarp --dewarp-lua-file /usr/share/ambarella/lua_scripts/dewarp_lua_wall_rectilinear.lua</div>
</div><!-- fragment --><div class="image">
<img src="../../dewarp_lua_wall_rectilinear.png" alt=""/>
<div class="caption">
Figure 3-3. Dewarp Lua Wall Rectilinear.</div></div>
<h2><a class="anchor" id="dlp_double_panorama"></a>
3.2 Dewarp Lua for Ceiling Double Panorama</h2>
<p ><a href="../../scripts/dewarp_lua_ceiling_double_panorama.lua" target="_blank"><b>dewarp_lua_ceiling_double_panorama.lua</b></a></p>
<div class="fragment"><div class="line">board # test_dewarp --dewarp-lua-file /usr/share/ambarella/lua_scripts/dewarp_lua_ceiling_double_panorama.lua</div>
</div><!-- fragment --><div class="image">
<img src="../../dewarp_lua_ceiling_double_panorama.png" alt=""/>
<div class="caption">
Figure 3-4. Dewarp Lua Ceiling Double Panorama.</div></div>
<hr  />
<h1><a class="anchor" id="lens_sensor"></a>
4. Lens and Sensor</h1>
<p >This chapter detaily introduce the lens attributes that used in our warp library, and how to select a perfect match of sensor and lens for different warp application, also bring a fast method to get the fisheye image center without doing camera calibration. </p><pre class="fragment">- Section @ref lens_info
- Section @ref sensor_select
- Section @ref fisheye_center
</pre> <h2><a class="anchor" id="lens_info"></a>
4.1 Lens</h2>
<h3><a class="anchor" id="lens_attribute"></a>
4.1.1 Attributes in Lens Datasheet</h3>
<p >Lens attributes are introduced in this section to aid users in fine-tuning their warp results for different warp views.</p>
<h3><a class="anchor" id="lens_info_fl_inc_angle"></a>
4.1.2 Focal length and incident angle:</h3>
<p >For a lens, the focal length (f) is the distance from the optical center to the focal sensor. The incident angle ( \(\theta\)) is the angle between the optical axis and the light ray. The figure below shows the details.</p>
<div class="image">
<img src="../../f_incident.jpg" alt=""/>
<div class="caption">
Figure 4-1. Focal Length and Incident Angle.</div></div>
<h3><a class="anchor" id="lens_info_fov"></a>
4.1.3 Field of view (FoV):</h3>
<p >The FoV is the angle over which objects can be seen. The FoV is the maximum value of the incident angle that can be recorded in the sensor plane. There are three FoV concepts described in the lens datasheet: horizontal FoV, vertical FoV, and diagonal FoV.</p>
<h3><a class="anchor" id="lens_info_img_circle"></a>
4.1.4 Image circle:</h3>
<p >The image circle is the primary physical characteristic of a fisheye lens. It remains the same irrespective of how the lens is mounted or what type of sensor is used. This value can be found in the lens datasheet. </p><p class="formulaDsp">
\[ Image\_circle\_on\_sensor (pixels) = Lens\_image\_circle(mm) * \frac{1000}{sensor\_cell\_unit(um)} \]
</p>
<p> Information on the cell unit of the sensor cell can be obtained from the sensor's datasheet. <br  />
In a wide angle lens, the lens circle cannot be obtained from the sensor. Ambarella suggests performing calculations to retrieve the correct image circle size in pixels.</p>
<h3><a class="anchor" id="lens_info_proj_func"></a>
4.1.5 Lens projection function:</h3>
<p >The distance (r) of a point from the optical center depends on the focal length (f) and the incident angle ( \(\theta\)): \(r = F(\theta)\) <br  />
The direction of a light ray cannot be changed after going through a regular (non-fisheye) lens. The distance (r) from the optical center to the mapping point on the sensor is \(r = f * tan(\theta)\). When the incident angle approaches Pi/2, the distance (r) will be infinite and it will be impossible to record this information in the sensor.</p>
<div class="image">
<img src="../../non_fisheye_lens.jpg" alt=""/>
<div class="caption">
Figure 4-2. Non-Fisheye Lens.</div></div>
<p >In a fisheye or wide-angle lens (Figure 4-2 Non-Fisheye Lens), the direction of the light ray will be changed after the light ray passes through the lens. The conversion is performed through the projection function, which can be found in the lens datasheet. The following functions are the most commonly used.</p>
<div class="image">
<img src="../../fisheye_lens.jpg" alt=""/>
<div class="caption">
Figure 4-3. Fisheye Lens.</div></div>
<p ><br  />
<b>Equidistant</b> (also called f-theta): \(r = f * \theta\) <br  />
<b>Stereographic</b> (also called tailored distortion): \(r = 2 * f * tan(\frac{\theta}{2})\) <br  />
<b>Look-up table (LUT):</b> The mapping between the distance and incident angle is supplied in a table by the lens vendor. Neither the equidistant nor the stereographic equation can be applied to lens distortion. Lenses are all designed with various projection functions. This is the major projection method used in fisheye dewarp. <br  />
When capturing a wide scene with a fisheye or wide-range lens, the objects far from the optical center are "squeezed". The distortion is determined by the projection function. Usually, stereographic lenses preserve more details on the area of a large FoV. For ceiling-mount cameras, the stereographic lens is a better choice.</p>
<h3><a class="anchor" id="lens_lut"></a>
4.1.6 Lens LUT Mode</h3>
<p >Amarella CV5x / CV7x supports removing the lens distortion by looking up the lens distortion table provided by lens vendors, it is the relationship between the incident angles and real height calculated from lens optical center, the valid range for real height is [0, half of image circle radius]. This method is called "Lens LUT method" and belongs to one of the lens projection function mentioned in <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#lens_info">4.1 Lens</a>. It does not impact the typical correction modes <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_correction_mode">Correction Mode</a> but only impact on how the pixel is projected as a result of lens intrinsic radical distortion. <br  />
To be recognized by dewarp library, the LUT file is demanded to be generated in the format below including lens basic attributs and distortion table:</p><ul>
<li>Lens ID</li>
<li>Lens FoV</li>
<li>Lens image circle in um</li>
<li>Lens effective focus length in um</li>
<li>Lens LUT number</li>
<li>Lens LUT step</li>
<li>Lens LUT distortion table(saved lut_radius)</li>
</ul>
<p ><b>Lens ID:</b> Ambarella CV5x / CV7x SDK currently supports the following lenses. Each lens ID is defined by a hexadecimal, as shown below.</p><ul>
<li>EVETAR_F117B021IRM12 = 0x00000000</li>
<li>EVETAR_F117B12924IRM12 = 0x00000001</li>
<li>EVETAR_F132B0108IRM12R4 = 0x00000002</li>
<li>EVETAR_M13B02118W = 0x00000003</li>
</ul>
<p ><b>Lens LUT step:</b> the degrees of each step in the Lens LUT distortion table (saved lut_radius).</p>
<p ><b>Lens LUT number:</b> the numbers of pairs betweeb real height and incident angle.</p>
<p ><b>Lens LUT distortion table:</b> the relationship between the incident angle and the LUT radius (real height / lens image circle). As the fisheye circle is symmetrical, the table below shows the angle and the real height from 0 degrees to MAX_FOX / 2. The LUT step means the incident angle step that is allowed to be a float type.</p>
<p >To convert the real height in pixel unit, the <code>test_ldc</code> or <code>test_dewarp</code> application need to take the sensor unit size and effective focal length into consideration. </p><p class="formulaDsp">
\[ lut\_radius[n] = \frac{real\_height[n]}{lens\_image\_circle} \]
</p>
<h3><a class="anchor" id="lens_lut_example"></a>
4.1.7 Lens LUT Examples</h3>
<p ><b> Example 1: How to generate Lens LUT distortion table. </b></p><ol type="1">
<li>Get the table below that is an original distortion table format provided by lens vendor. The lens EFL is 1.08 mm, and the image circle is 3.5 mm. <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Angle (degree)   </th><th class="markdownTableHeadCenter">Real Height (mm)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0.02    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">2   </td><td class="markdownTableBodyCenter">0.04    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">3   </td><td class="markdownTableBodyCenter">0.06    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">...   </td><td class="markdownTableBodyCenter">...    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">100   </td><td class="markdownTableBodyCenter">1.73   </td></tr>
</table>
</li>
<li>Divided the real height with image circle (3.5 mm) <br  />
 lut_radius[0]= 0 <br  />
 lut_radius[1]= 0.02/3.5 <br  />
 lut_radius[2]= 0.04/3.5 <br  />
 lut_radius[3]= 0.06/3.5 <br  />
 . . . <br  />
 lut_radius[100]= 1.73 /3.5</li>
<li>Saved the lut_radius value as shown below, ensure that the radius in the table is monotonic increasing. <div class="fragment"><div class="line">&lt;br&gt;cat lut_radius.txt</div>
<div class="line">0</div>
<div class="line">0.005714</div>
<div class="line">0.011428</div>
<div class="line">0.017142</div>
<div class="line">...</div>
<div class="line">0.494285</div>
</div><!-- fragment --></li>
</ol>
<p ><b> Example 2: Generate lens binary file for dewarp library with tool "lens_data_tool". </b> </p><div class="fragment"><div class="line">Generate lens binary file:</div>
<div class="line"><span class="preprocessor">#lens_bin --in-lut lut_radius_file --bin lens_binary_file -i 1 -F 200 --lut-num 101 --image-circle 3500 -e 1080 --lut-step 1 -m 0</span></div>
<div class="line">Parse lens binary file:</div>
<div class="line"><span class="preprocessor">#lens_bin --bin lens_binary_file -m 1</span></div>
</div><!-- fragment --><p> This tool is located in</p><ul>
<li>Cooper SDK path: <code>./ambarella/prebuild/library/lens</code></li>
<li>Firmware: <code>/usr/share/ambarella/lens/</code></li>
</ul>
<p ><b> Example 3: Lens LUT Mode in LDC. </b> </p><div class="fragment"><div class="line">board # init.sh --imx274_mipi</div>
<div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear_ldc.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua      <span class="comment">// For CV5 or CV52</span></div>
<div class="line">(Or board# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv72_vin0_1080p_linear_ldc.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua)  <span class="comment">// For CV72</span></div>
<div class="line">board # rtsp_server</div>
<div class="line">board # test_encode -A -h1080p -e</div>
<div class="line">board # test_ldc -c 0 -R 1088 -F 200 -L 2 -m 1 --lut-efl 667 --lut-bin /etc/lens/EVETAR_F132B0108IRM12R4.bin -v</div>
</div><!-- fragment --><p> <code>--lut-efl</code> effective focal length (EFL) in pixels can be found in the lens' specifications. Take the value as an example, EFL for F132B0108IRM12 is 1.08 mm, and the cell unit width of sensor imx274 is 1.62 um. </p><p class="formulaDsp">
\[ efl\_in\_pixel = 1.08 * \frac{1000}{1.62} = 667 \]
</p>
<h2><a class="anchor" id="sensor_select"></a>
4.2 Sensor Selection</h2>
<h3><a class="anchor" id="full_fisheye_circle"></a>
4.2.1 Full Fisheye Circle</h3>
<p >The complimentary metal-oxide semiconductor (CMOS) sensor includes an "optical format" which can be 1/3 inch, 1/2.3 inch, and so on. Typically, the the optical format number is estimated, and users should refer to the datasheet for the size of the CMOS sensor. </p><div class="image">
<img src="../../Sensor_Full_Resolution_2304x1536.png" alt=""/>
<div class="caption">
Figure 4-4. Sensor with Full Resolution 2304x1536.</div></div>
<p> For example, if a sensor has full resolution 2304x1536, and each pixel is 2.2x2.2 um, the user can calculate the width to be 2304*2.2= 5068.8 um and the height to be 1536*2.2 = 3379.2 um. Therefore, the sensor active image size is 5.068x3.379 mm. When users compare the sensor's active image size to the lens image circle size, they should use this method (by calculation from the cell size and pixel count), but not directly refer to the "optical
   format" in the sensor datasheet. Refer to the following figure for an example of using a fisheye lens with the same sensor. Users can obtain different results using a different fisheye lens with different image circle diameters.</p>
<div class="image">
<img src="../../match_of_lens_sensor.png" alt=""/>
<div class="caption">
Figure 4-5. Different Fisheye Lens and Image Circle Diameter.</div></div>
<p >It is important to note the following:</p><ol type="1">
<li>The number of pixels captured is directly proportional to the amount of information that the user receives. If the user is able to capture more pixels from the same sensor to record a picture, the user will receive more information. If the encoding resolution (pixel count) is the same, with more pixels captured, the picture will have improved image sharpness and higher visual resolution. <br  />
To perform dewarp with the same sensor, the type A situation is usually better than type B.</li>
<li>If the image circle has some part of the image that does not fall into the sensor image area, that part of the information will be lost in the FoV. If the user is concerned about the vertical FoV on the sensor, as in the ceiling mount dewarp use case, type C or D cannot be used. <br  />
If the user is not concerned about the vertical FoV and only uses it for the wall mount use case, with type C, full horizontal FoV can be obtained. Because it captures more pixels in the horizontal direction, it will result in greater image sharpness and higher visual resolution than type A or B.</li>
<li>Most fisheye lenses have better resolution at the center, and the center of the image is "amplified" with details. The corners do not have as much detail as the center. If the user is only concerned about the center of image, and not as concerned about the FoV, they can attempt to use type D, which uses the best resolution of the lens and all pixels of the sensor to get the best center image. <br  />
Wall-mount fisheye dewarp camera design: <br  />
Ambarella recommends using type C. If type C cannot be used, Ambarella recommends using type A. <br  />
Ceiling-mount (or both ceiling and wall mount) fisheye dewarp camera design: <br  />
Ambarella recommends using type A. <br  />
Note that it is harder to identify the correct lens for the 16:9 aspect ratio sensors because the sensor height is relatively small. However, because a fisheye lens with a small image circle typically has a high resolution, Ambarella recommends using a 1/3-inch sensor or larger with the aspect ratio of 4:3 or 3:2.</li>
</ol>
<h3><a class="anchor" id="fisheye_IQ"></a>
4.2.2 Fisheye Image Quality</h3>
<p >A sensor with more pixels has better resolution and better visual resolution. Visual resolution is measured using an actual lens with the sensor in proper light conditions to focus on the test chart to determine how many lines it can reach, or use a test pattern with line pairs to obtain the MTF value. However, note that more pixels does not always indicate a better visual resolution. <br  />
The following pictures show the difference between two different sensors using the same regular lens, shooting the same target at the same lux level. </p><div class="image">
<img src="../../difference_of_two_lens_sensor.png" alt=""/>
<div class="caption">
Figure 4-6. Regular Lens with Two Different Sensors.</div></div>
<p> <br  />
Although a low-cost 5M CMOS sensor may use more pixels for the same object, it may not necessarily provide greater details. The images in this section show that a high-quality 1080p sensor may have the same level of details as a 5M sensor, and provide an image with a higher signal-to-noise ratio (SNR) and better resolution. <br  />
Therefore, it is important for users to choose the correct sensor. Because dewarp includes an extra rescaler, it can cause further loss of resolution. While designing a fisheye dewarp camera, the user must follow the suggestions provided in the CV5x/CV7x Linux SDK to select the correct sensor.</p>
<h3><a class="anchor" id="mount_lens"></a>
4.2.3 Mounting Lens</h3>
<p >The lens should be accurately mounted so that the image circle center is the sensor's optical sensor. </p><div class="image">
<img src="../../correct_mounting.png" alt=""/>
<div class="caption">
Figure 4-7. Comparison of Two Cameras' Design for Correct Mounting.</div></div>
<p> Camera A shows that the lens is correctly mounted with the sensor; however, Camera B, shows the lens and sensors are incorrectly mounted, with some X-Y offset. Additionally, because the image circle in Camera B is already beyond the sensor image area, it cannot be perfectly compensated using a software solution. Adjusting the mechanical setup of the lens can correct this issue. </p><div class="image">
<img src="../../perfect_mounting.png" alt=""/>
<div class="caption">
Figure 4-8. Comparison of Two Cameras' Design for a Perfect Image Circle.</div></div>
<p> The figure above shows that Camera C has a perfect image circle, but Camera D's image circle is elliptical. This is because in Camera D, the lens optical axis is not 100% perpendicular to the sensor surface. This can occur because the lens holder's screw thread is too loose or the lens holder is not correctly mounted to the sensor board's printed circuit board (PCB). <br  />
In Camera D's setup, there will be problems on the image output. The following figure shows the image output from the left side and right side of Camera D: </p><div class="image">
<img src="../../left_right_cameraD.png" alt=""/>
<div class="caption">
Figure 4-9. Image Output Left Side and Right Side of Camera D.</div></div>
<p> The figures in this section show that mounting the lens incorrectly can produce an incomplete or elliptical image circle, causing inconsistent focusing of the images.</p>
<h2><a class="anchor" id="fisheye_center"></a>
4.3 Fisheye Center</h2>
<p >Before dewarping, the fisheye circle center must be identified in the fake pre-main buffer of the unwarped channel (multi-region dewarp) or VIN (LDC). Ambarella suggests performing Zhang Zhengyou calibration using a chessboard, from which the result is sufficiently accurate. Another convenient, but less accurate, the method is the tool <code>fish_center_calibration.sh</code>. This tool is provided to find the circle center in the image. The related files: <code>./ambarella/unit_test/private/package_test/arch_v6/scripts/fishey_center</code> <br  />
The steps of the script are as follows:</p><ol type="1">
<li>Reboot the board.</li>
<li>Initialize VIN and force IAV to enter preview mode with the selected sensor, resolution, and commands.</li>
<li>Ensure that the lens is focused correctly. The preview from the high-definition multimedia interface (HDMI®) cable will help the camera to adjust the focus.</li>
<li>Cover the lens with a white half-transparent cap. The goal is to ensure that the fisheye circle is bright enough and the rest is dark. The edge of the circle must be clear.</li>
<li>The script will run <b>cali_fisheye_center</b> to find the center axis. If there are no error messages, the result is reliable. Users can perform one more test (which is supported in the script) and verify that the result is reliable. Users can choose one of the results. The radius is for reference only, it cannot be used as a circle radius for dewarping.</li>
<li>If the results are very different, ensure the following: The light is bright enough inside the circle. The edge is clear and sharp. There is no leakage of light on the edge. <div class="image">
<img src="../../fish_center_calibration.png" alt=""/>
<div class="caption">
Figure 4-10. Results of fish_center_calibration.sh.</div></div>
</li>
</ol>
<hr  />
<h1><a class="anchor" id="warp_system_config"></a>
5. System Configuration</h1>
<p >This chater introduces warp related configuration in system level including hardware resource, warp alignment, buffer layout, the ME1 warp table for different encode modes; Some features such as warp DPTZ and warp input mode. </p><pre class="fragment">- Section @ref warp_dual_chan
- Section @ref warp_hw_res
- Section @ref warp_align
- Section @ref pm_on_warp
- Section @ref post_buffer_layout
- Section @ref warp_dptz
- Section @ref warp_input_mode
- Section @ref ldc_me1
</pre> <h2><a class="anchor" id="warp_dual_chan"></a>
5.1 Dual Channel for Multi-Region Warp</h2>
<h3><a class="anchor" id="autotoc_md2"></a>
Pros and Cons</h3>
<p >Below is a comparison of multi-region warp between CV2x, CV5x, and CV72x. <br  />
<b>Pros</b>: <br  />
1. Although dual channels are implemented for encode mode 1, the IDSP performance is almost the same. <br  />
2. The unwarp channel can be flexibly configured as encode mode 0/5. <br  />
3. There is no pass concept in CV5x / CV7x mode 1. <br  />
<b>Cons</b>: <br  />
Users must confgure the partner relationship using the system option "raw_src_chan". </p>
<h3><a class="anchor" id="autotoc_md3"></a>
EFR with YUV for warped channel:</h3>
<p >The main buffer of the unwarped channel is connected to the warped channel by one dummy sensor, which is performed by AMBDS. Regardless of the main buffer resolution from the unwarped channel, AMBDS handles the VSRC configuration. </p>
<h3><a class="anchor" id="autotoc_md4"></a>
Fake pre-main:</h3>
<p >On the CV5x / CV7x platforms, the main buffer from the unwarped channel functions as the video source of the warped channel, called the fake pre-main buffer. Ambarella does not suggest performing LDC for the unwarped channel, as it could break the camera geometry relationship.</p><ul>
<li>Input window Once the sensor and the lens are selected, the fisheye circle's diameter calculated in the unit of pixels is known and fixed. Before sending the fisheye circle into the warping stage, Ambarella recommends configuring the pre-main input window width and height: <br  />
Pre-main input window = lens image circle on sensor (pixels) <br  />
Vertical upscaling is not supported by the pre-main input window or the pre-main buffer in multi-region warping mode, as upscaling causes dark padding be added around the circle view in order to meet the input window height restriction.</li>
<li>Buffer size: As mentioned in previous sections, the recommended view size for each mode is related to the fisheye circle's radius in the pre-main buffer. The fisheye circle's radius is estimated by the view size. For example, if 800x600 is picked up for sub-region dewarping, the preferred pre-main buffer size is no less than 1600x1600.</li>
</ul>
<h2><a class="anchor" id="warp_hw_res"></a>
5.2 Warp Hardware Resource</h2>
<h3><a class="anchor" id="autotoc_md5"></a>
Maximum Warp Input / Output Width:</h3>
<p >In addition to the maximum size of the source buffers and streams, the maximum width for warping areas must be configured in the system resource setting. <br  />
The maximum width does not refer to the width of the corrected view. Rather, it sets the limit for the warping area. For example, a 2048x768 wall panorama view contains two warping areas. The maximum width for the input warping area is 2048 and output is 2048 / 2 = 1024. <br  />
There is no equation to calculate the maximum value of the input warping area. Use the fake pre-main buffer width as the maximum input warping width. If the system resource is insufficient, try reducing this value gradually so that it does not break the dewarping effect. </p>
<h3><a class="anchor" id="autotoc_md6"></a>
max_padding_width / lens_warp:</h3>
<p >The valid range is 0 to 256, the same for LDC. When entering multi-region warp encode mode, set the option "lens-warp" to 0 in the Lua configuration. </p>
<h3><a class="anchor" id="autotoc_md7"></a>
max_vwarp_blk_height:</h3>
<p >When processing one warp macroblock (16x16) in the vertical warp stage, warp engine hardware fetches image lines configured by <b>max_vwarp_blk_height</b>. Usually, this is related to active warp cases. Users can specify it in the Lua using the item "max_vwarp_blk_height = 28"; the valid range is [0, 64]. It affects both warp cases in LDC and multi-region warp. The default value is 28 for LDC cases and 64 for multi-region warp cases. </p>
<h3><a class="anchor" id="autotoc_md8"></a>
max_vwarp_wait_lines:</h3>
<p >Under encode mode 0, the vertical warp stage of lens warp requires enough <b>wait lines</b> to avoid the artifacts generated. The vertical warp no longer requires <b>max_vwarp_blk_height</b>. Confirm the <b>max_vwarp_wait_lines</b> via the LDC application, which reports the wait lines required by the active warp case, and then configure it to back to the Lua file for the system and re-enter the preview again. <br  />
 It is not wise to configure a large wait lines for the system which probably leads to DSP assertion of internal resource shortage before entering preview. The internale resource is shared by all the system modules like encoding streams, canvas size and so on. So it is better to set the minimum waitlines demanded to satisfy all the warp cases. Here a mathematic formula is provided to help users understand the relationship between wait lines and different incident angles(theta) \([ focal_length = \frac{EFL(mm)}{pixel_cell_unit_size(mm)} wait lines (pixels) = focal_length * tan(\theta) - focal_length * \theta \)]</p>
<h2><a class="anchor" id="warp_align"></a>
5.3 Warp Alignment</h2>
<a class="anchor" id="warp_alignment_table"></a>
<table class="doxtable">
<caption>Table 5-1. Warp Alignment</caption>
<tr>
<th>Encode mode </th><th>Pipeline </th><th>Input/Output </th><th>Offset </th><th align="left">Width &amp; Height </th></tr>
<tr>
<td rowspan="4">Mode 0/5, LDC </td><td rowspan="4">Horizontal warp first </td><td rowspan="2">Input </td><td>x-4 </td><td>width-16 </td></tr>
<tr>
<td>y-2 </td><td>height-8 </td></tr>
<tr>
<td rowspan="2">Output </td><td>N/A </td><td>width-16 </td></tr>
<tr>
<td>N/A </td><td>height-8 </td></tr>
<tr>
<td rowspan="8">Mode 1, Multi-Region Warp </td><td rowspan="4">Horizontal warp first </td><td rowspan="2">Input </td><td>x-16 </td><td>width-16 </td></tr>
<tr>
<td>y-8 </td><td>height-8 </td></tr>
<tr>
<td rowspan="2">Output </td><td>x-8 </td><td>width-32 </td></tr>
<tr>
<td>y-8 </td><td>height-16 </td></tr>
<tr>
<td rowspan="4">Vertical warp first </td><td rowspan="2">Input </td><td>x-16 </td><td>width-16 </td></tr>
<tr>
<td>y-8 </td><td>height-16 </td></tr>
<tr>
<td rowspan="2">Output </td><td>x-16 </td><td>width-32 </td></tr>
<tr>
<td>y-16 </td><td>height-8 </td></tr>
</table>
<h2><a class="anchor" id="pm_on_warp"></a>
5.4 Privacy Mask (PM) on Warp View</h2>
<h3><a class="anchor" id="autotoc_md9"></a>
Privacy Mask with LDC:</h3>
<p >Privacy masks can be added after LDC is enabled, even in the rotation pipeline. Once a new warp effect is applied in a specific channel, the PM added in the previous warp effect will be placed in the wrong location with new warp table compensation. Users must disable the PM and add it again. In order for the PM to function correctly with LDC, the warp table should be applied first. <br  />
Users should refer to option "use-warp-table" in test_privacymask.c, which controls two types of PM after LDC: </p><div class="image">
<img src="../../PM_w_LDC.png" alt=""/>
<div class="caption">
Figure 5-1. No Jaggy with Distortion versus Rectangle PM with Jaggy.</div></div>
 <h3><a class="anchor" id="autotoc_md10"></a>
Circle PM on Fisheye:</h3>
<p >In order to cover up light leakage from the lens and create a sharp edge for the fisheye circle, users can apply a complement PM for circles; see the examples below. This type of PM is added in the pre-main buffer domain. </p><div class="image">
<img src="../../pm_fisheye.png" alt=""/>
<div class="caption">
Figure 5-2. Circle PM on Fisheye.</div></div>
<h2><a class="anchor" id="post_buffer_layout"></a>
5.5 Main Buffer Layout Design</h2>
<h3><a class="anchor" id="autotoc_md11"></a>
Main Buffer Size:</h3>
<p >The corrected views are placed in the main buffer space. The user is expected to specify the size of the main buffer according to the layout of the views. </p><div class="image">
<img src="../../main_buffer.png" alt=""/>
<div class="caption">
Figure 5-3. Main Buffer.</div></div>
<p> Main Buffer Layout: Ambarella recommends that users specify the position of the views in a compact manner in order to optimize dynamic random access memory (DRAM) for the main buffer. For example, assume that two views are to be placed in the main buffer. One view is a 1920x720 wall panorama and the other is 800x600. The total main buffer size for Layout A is 2720x720 and Layout B is 1920x1320. Between the two layouts, Layout A is a better choice from the DRAM usage perspective. </p><div class="image">
<img src="../../layout_1920x720_VGA.png" alt=""/>
<div class="caption">
Figure 5-4. Layouts of 1920x720+VGA on Main Buffer.</div></div>
 <h3><a class="anchor" id="autotoc_md12"></a>
Wall Mount: Rectilinear</h3>
<div class="image">
<img src="../../layout_rectilinear.png" alt=""/>
<div class="caption">
Figure 5-5. Rectilinear Layout.</div></div>
<p> <br  />
<b>Example 1</b> Wall Mount: Fisheye view (no transformation) + Rectilinear + 180 Panorama Refer to the example No Transform + Wall Rectilinear + Wall Panorama in the document dewarp unit test. </p><div class="image">
<img src="../../no_trans_sub_panor.png" alt=""/>
<div class="caption">
Figure 5-6. Wall Mount: Fisheye View (No Transform) + Sub-Region + 180 Panorama.</div></div>
<p> <br  />
<b>Example 2</b> Wall Mount: Fisheye view (no transformation) + polar warp + advance yaw + Mercator Refer to the example Wall Rectilinear + Wall Polar Warp + Wall Advance Pitch + Wall Mercator in the document dewarp unit test. </p><div class="image">
<img src="../../fisheye_polar_adv_yaw_mercator.png" alt=""/>
<div class="caption">
Figure 5-7. Wall Mount: Fisheye View, Polar Warp, Advance Yaw, Mercator.</div></div>
<p> <br  />
<b>Example 3</b> Wall Mount: 180 Panorama + Eyeball Rotation x4 Refer to the example Wall Panorma + Eyeball Rotation in the document dewarp unit test. </p><div class="image">
<img src="../../panor_eyeball.png" alt=""/>
<div class="caption">
Figure 5-8. Wall Mount: 180 Panorama + Eyeball Rotation.</div></div>
<p> <br  />
<b>Example 4</b> Ceiling Mount: Sub-region x4 Refer to the example Ceiling Rectilinear North and South, West and East in the document dewarp unit test. </p><div class="image">
<img src="../../ceiling_sub_regionx4.png" alt=""/>
<div class="caption">
Figure 5-9. Ceiling Mount: Sub-Region x4.</div></div>
<p> <br  />
<b>Example 5</b> Ceiling Mount: Double 180 Panorama Refer to the example Ceiling Double Panorama in the document dewarp unit test. </p><div class="image">
<img src="../../ceiling_double_panor.png" alt=""/>
<div class="caption">
Figure 5-10. Ceiling Mount: Double 180 Panorama.</div></div>
<p> <br  />
<b>Example 6</b> Ceiling Mount: 360 Panorama Refer to the example Ceiling Panorama Mode - 360 in document dewarp unit test. </p><div class="image">
<img src="../../360_Panorama.png" alt=""/>
<div class="caption">
Figure 5-11. Ceiling Mount: 360 Panorama.</div></div>
<h2><a class="anchor" id="warp_dptz"></a>
5.6 Warp DPTZ</h2>
<p >When configuring a preview buffer as a warp buffer, the content is scaled from post-main by default. DPTZ II is not supported in multi-region warping mode, which indicates that the input window does not function in this mode. </p><div class="image">
<img src="../../default_layout_prev.png" alt=""/>
<div class="caption">
Figure 5-12. Default Area Layout on Warped Preview Buffer.</div></div>
<p> The IAV driver assigns the default area layout for the preview buffer each time the warping control parameters are reset. The following section introduces the concept of "warp DPTZ", which allows the user to disable the default behavior and set the customized layout on the sub-buffers. Refer to example in feature sets <a class="elRef" target="_blank" href="../../../video/d5/d18/fs_adv_dewarp.html#ut_warp_dptz">Example 33: Warp DPTZ</a>. </p><div class="image">
<img src="../../warp_dptz_prev.png" alt=""/>
<div class="caption">
Figure 5-13. Warp DPTZ on Sub-Buffer.</div></div>
<p> <br  />
Note that this type of digital PTZ (warping DPTZ) is not DPTZ (II). The DPTZ in this section functions in the warping views dimension only, as shown in figure 5-14 Warp DPTZ on Sub-Buffer (a). One warping DPTZ cannot cross two warping views at a time. If the application requires the area across two views, it must use two warping DPTZ views, as shown in (b). If the application must exchange the location of some warp views, refer to (c). If the application requires area across two views, and must perform an upscale for one view and a downscale for another view, refer to (d). <br  />
<b>Keep Warp DPTZ:</b> <br  />
When changing the warp effect on the specified areas, the IAV driver attempts to re-draw warp DPTZ on the preview buffer by default. If users are required to use the customized warp DPTZ parameters to keep the customized warp layout, they should turn on the "keeping warp DPTZ" flag for the relative sub-buffer when calling the warp control API.</p>
<h2><a class="anchor" id="warp_input_mode"></a>
5.7 Warp Input Mode</h2>
<p >To meet different requirements from system resource perspective, the application could specify the input mode type <a class="el" href="../../d0/da9/group__dewarp-helper.html#ga37e4becfa7855f1cc2794cb84a6a2a18">WARP_INPUT_MODE</a>, below table shows the pros and cons. </p><a class="anchor" id="warp_input_mode_table"></a>
<table class="doxtable">
<caption>Table 5-2. Warp input mode</caption>
<tr>
<th>Input mode Type </th><th>Notes </th><th>Pipeline </th><th>Pros and Cons </th></tr>
<tr>
<td align="middle">WIM_MIN_BOUNDING_RECT </td><td>Minimum bounding rectangle (default) </td><td>N/A </td><td>Pros: DRAM bandwidth and raw padding wise <br  />
Cons: Cost more vertical warp block height or wait lines for H+V pipeline </td></tr>
<tr>
<td align="middle">WIM_ORIGINAL_INPUT </td><td>Original full VIN size or premain buffer size </td><td>H+V </td><td>Pros: Wise for vertical warp block height or wait lines <br  />
Cons: Cost more DRAM bandwidth and raw padding </td></tr>
<tr>
<td align="middle">WIM_MIN_WIDTH_MAX_HEIGHT </td><td>Minimum bounding rectangle width and original input height </td><td>H+V </td><td>Pros: Wise for raw padding and vertical warp block height or wait lines <br  />
Cons: DRAM bandwidth is larger than WIM_MIN_BOUNDING_RECT </td></tr>
</table>
<h2><a class="anchor" id="ldc_me1"></a>
5.8 ME1 H/V for Lens Warp</h2>
<p >The motion estimation block, which is used to ensure the image quality of the stream when motion occurs in the FoV, is designed for lens warp pipeline under encode mode 5/9 only. It takes the quad size for both width and height of main buffer size and derives from the normal horizontal or vertical table with different grid spacing and counts. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Encode mode   </th><th class="markdownTableHeadCenter">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">High dynamic range (HDR) line-interleaved mode   </td><td class="markdownTableBodyCenter">ME1 size vertical warp table    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AISP mode   </td><td class="markdownTableBodyCenter">Both ME1 size horizontal and vertical warp table   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="dewarp_development"></a>
6. Dewarp Development</h1>
<p >This chapter introduce the workflow of unit test application (test_ldc and test_dewarp) and the basic data structure for warp library initialization, and targets to help users get familiar with the methods of utilizing warp library and develop their owne application. It contains the following sections:</p>
<ul>
<li>Section <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_intro_init_param">6.1 Introduction to "dewarp_init_param"</a></li>
<li>Section <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_ldc_dev">6.2 LDC Development</a></li>
<li>Section <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#multi_region_warp">6.3 Multi-Region Warp Development</a></li>
</ul>
<h2><a class="anchor" id="dewarp_intro_init_param"></a>
6.1 Introduction to "dewarp_init_param"</h2>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"> <a class="code hl_struct" href="../../da/d9c/structversion__t.html">version_t</a> version;</div>
<div class="line"> <a class="code hl_struct" href="../../d0/d2b/structmemblock__t.html">memblock_t</a> heap;</div>
<div class="line"> <a class="code hl_struct" href="../../d0/d2b/structmemblock__t.html">memblock_t</a> stack;</div>
<div class="line"> <a class="code hl_struct" href="../../d1/d9a/structchannel__info__t.html">channel_info_t</a> channel_info[<a class="code hl_define" href="../../d0/da9/group__dewarp-helper.html#ga20a06eba1fa71a79ab4d20b095b52911">MAX_CHANNEL_NUM</a>];</div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> debug_check_disable : 1;</div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> debug_reserved : 31;</div>
<div class="line">} <a class="code hl_struct" href="../../dc/d06/structdewarp__init__t.html">dewarp_init_t</a>;</div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div><div class="ttdef"><b>Definition:</b> asf_structure.h:46</div></div>
<div class="ttc" id="agroup__dewarp-helper_html_ga20a06eba1fa71a79ab4d20b095b52911"><div class="ttname"><a href="../../d0/da9/group__dewarp-helper.html#ga20a06eba1fa71a79ab4d20b095b52911">MAX_CHANNEL_NUM</a></div><div class="ttdeci">#define MAX_CHANNEL_NUM</div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:47</div></div>
<div class="ttc" id="astructchannel__info__t_html"><div class="ttname"><a href="../../d1/d9a/structchannel__info__t.html">channel_info_t</a></div><div class="ttdoc">channel context.</div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:361</div></div>
<div class="ttc" id="astructdewarp__init__t_html"><div class="ttname"><a href="../../dc/d06/structdewarp__init__t.html">dewarp_init_t</a></div><div class="ttdoc">dewarp init information.</div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:377</div></div>
<div class="ttc" id="astructmemblock__t_html"><div class="ttname"><a href="../../d0/d2b/structmemblock__t.html">memblock_t</a></div><div class="ttdoc">memory information, start address and size in one byte.</div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:203</div></div>
<div class="ttc" id="astructversion__t_html"><div class="ttname"><a href="../../da/d9c/structversion__t.html">version_t</a></div><div class="ttdoc">The version of the dewarp correction library.</div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:157</div></div>
</div><!-- fragment --> <div class="fragment"><div class="line">   <span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> enable : 1;</div>
<div class="line">    <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> channel_id : 4;</div>
<div class="line">    <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> vcap_mode : 4;</div>
<div class="line">    <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> reserved : 23;</div>
<div class="line">    <a class="code hl_struct" href="../../d1/dd2/structinput__limit__t.html">input_limit_t</a> max_input;</div>
<div class="line">    <a class="code hl_struct" href="../../df/d5c/structrect__t.html">rect_t</a> post_buffer_size;</div>
<div class="line">    <a class="code hl_struct" href="../../d3/d14/structlens__info__t.html">lens_info_t</a> lens_info;</div>
<div class="line">    <a class="code hl_struct" href="../../da/dcb/structfisheye__area__t.html">fisheye_area_t</a> fisheye_area;</div>
<div class="line">    <a class="code hl_struct" href="../../d6/d15/structwarp__limit__t.html">warp_limit_t</a> warp_limit;</div>
<div class="line">} <a class="code hl_struct" href="../../d1/d9a/structchannel__info__t.html">channel_info_t</a>;</div>
<div class="ttc" id="astructfisheye__area__t_html"><div class="ttname"><a href="../../da/dcb/structfisheye__area__t.html">fisheye_area_t</a></div><div class="ttdoc">multi-region-warp, max area number in one view for specific correction.</div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:329</div></div>
<div class="ttc" id="astructinput__limit__t_html"><div class="ttname"><a href="../../d1/dd2/structinput__limit__t.html">input_limit_t</a></div><div class="ttdoc">max input information. LDC:VIN; Multi-Region-Warp:Premain.</div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:232</div></div>
<div class="ttc" id="astructlens__info__t_html"><div class="ttname"><a href="../../d3/d14/structlens__info__t.html">lens_info_t</a></div><div class="ttdoc">lens information used in inialize dewarp library</div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:316</div></div>
<div class="ttc" id="astructrect__t_html"><div class="ttname"><a href="../../df/d5c/structrect__t.html">rect_t</a></div><div class="ttdoc">rectangle width and height.</div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:194</div></div>
<div class="ttc" id="astructwarp__limit__t_html"><div class="ttname"><a href="../../d6/d15/structwarp__limit__t.html">warp_limit_t</a></div><div class="ttdef"><b>Definition:</b> amba_lib_dewarp.h:351</div></div>
</div><!-- fragment --><p >Check the definition of <a class="el" href="../../dc/d06/structdewarp__init__t.html" title="dewarp init information.">dewarp_init_t</a> and <a class="el" href="../../d1/d9a/structchannel__info__t.html" title="channel context.">channel_info_t</a>. For lens warp under AISP (encode mode 9), users are required to configure DSP_AISP_MODE for "vcap_mode". Other items in channel_info are almost the same as those for other encode modes; refer to the steps and sample codes in <a class="el" href="../../d8/d98/test_ldc_8c-example.html">test_ldc.c</a> or <a class="el" href="../../d2/d55/test_dewarp_8c-example.html">test_dewarp.c</a>.</p>
<h2><a class="anchor" id="dewarp_ldc_dev"></a>
6.2 LDC Development</h2>
<p >Refer to <a class="el" href="../../d8/d98/test_ldc_8c-example.html">test_ldc.c</a> to learn how to develop user applications.</p><ul>
<li>Malloc memory for the warp table according to the channel number &ndash; <a class="el" href="../../db/dab/lib__pm_8c.html#a94f7c5ada0e0c783a434608a656fdceb">map_warp()</a>.</li>
<li>Configure general dewarp, Lens FoV, max radius, lens projection, center coordinate, verbose option, and save the vector flag.</li>
<li>Configure <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_correction_mode">warp correction</a> and advanced warp parameters.</li>
<li>Initialize the dewarp library.<ol type="1">
<li>Set the log level for the dewarp library.</li>
<li>Check lens projection type in the LUT.</li>
<li>Obtain the VIN and main buffer sizes.</li>
<li>Malloc the heap memory used by the library. Assign "dewarp_init_param.heap.addr".</li>
<li>Set the default value for parameters used by multi-region warp.</li>
</ol>
</li>
<li>Create a warp table <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_vector_view">create_lens_warp_vector(channel_id)</a> -&gt; Check warp table information -&gt; Update to IAV driver via "IAV_IOC_CFG_WARP_CTRL" and "IAV_IOC_CFG_WARP_CTRL".</li>
<li>Deinitialize the dewarp library.<ol type="1">
<li>Free the heap memory malloced for library computation.</li>
<li>Free the array used for the LUT.</li>
<li>Free the memory used for twin vector conversion to 1D+1D mode.</li>
</ol>
</li>
</ul>
<h2><a class="anchor" id="multi_region_warp"></a>
6.3 Multi-Region Warp Development</h2>
<p >Refer to <a class="el" href="../../d2/d55/test_dewarp_8c-example.html">test_dewarp.c</a> to learn how to develop user applications.</p><ul>
<li>Malloc the memory for the warp table according to the channel number.</li>
<li>Configure general dewarp, mount method, Lens FoV, max radius, projection type, center coordinate, verbose option, and save the vector flag.</li>
<li>Configure warp parameters for each view, update view map, and view ID, <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#post_buffer_layout">view size and view offset</a>, <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_correction_mode">warp correction</a>, advance warp parameters, max area number, and area behavior (change, update or clear).</li>
<li>Initialize the dewarp library.<ol type="1">
<li>Set the log level for the dewarp library.</li>
<li>Check the lens projection type in the LUT.</li>
<li>Sum up the total area number for vector memory deployment.</li>
<li>Count area numbers for each view for area update behavior.</li>
<li>Obtain pre-main and post-main buffer size.</li>
<li>Malloc the heap memory used by the library. Assign "dewarp_init_param.heap.addr".</li>
</ol>
</li>
<li>Create a warp table "create_fisheye_warp_vector()" for each warp view -&gt; Count the area numbers for each view for area update behavior -&gt; Check the warp table information -&gt; Update to IAV driver via "IAV_IOC_CFG_WARP_CTRL" and "IAV_IOC_CFG_WARP_CTRL".</li>
<li>Deinitialize the dewarp library.<ol type="1">
<li>Free the heap memory malloced for library computation.</li>
<li>Free the array used for the LUT.</li>
<li>Free the memory used for twin vector conversion to 1D+1D mode.</li>
</ol>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="dewarp_qa"></a>
7. Dewarp Trouble Shooting</h1>
<p >This chapter provides frequently asked questions (FAQs) and answers that are specific to multi-region dewarp and LDC. More information will be added in the future.</p>
<h2><a class="anchor" id="dewarp_qa_q1"></a>
Question 1: What is the difference between LDC and multi-region dewarp?</h2>
<p ><b>Answer:</b> <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#LDC_and_dewarp">1.3 LDC and Multi-Region Warp</a>.</p>
<h2><a class="anchor" id="dewarp_qa_q2"></a>
Question 2: Why there are artifacts in the warp results when performing rotation in large angles?</h2>
<p ><b>Answer:</b> It should be clear that the Ambarella IDSP warp engine is implemented differently from the pure memory operation of 2D warp. There is a limitation on the warp engine to fetch pixels from lines far away. <br  />
To minimize artifacts, Ambarella suggests configuring the proper warp region resolution and other parameters that affect the hardware resource demanded by the warp table.</p>
<h2><a class="anchor" id="dewarp_qa_q3"></a>
Question 3: How can users get a panning effect from ceiling-mount 360 panorama?</h2>
<p ><b>Answer:</b> Warp Encode Sync Process</p>
<h2><a class="anchor" id="dewarp_qa_q4"></a>
Question 4: What are easy ways to configure parameters for different warp views using test_dewarp?</h2>
<p ><b>Answer:</b> <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#dewarp_lua_parser">Dewarp Lua Parser</a></p>
<h2><a class="anchor" id="dewarp_qa_q5"></a>
Question 5: Are there examples for each correction mode?</h2>
<p ><b>Answer:</b> <a class="elRef" target="_blank" href="../../../video/de/d79/fs_adv_ldc.html">Lens Distortion Correction</a> and <a class="elRef" target="_blank" href="../../../video/d5/d18/fs_adv_dewarp.html">Multi-Region Warp</a></p>
<h2><a class="anchor" id="dewarp_qa_q6"></a>
Question 6: How do users sharpen a fisheye edge?</h2>
<p ><b>Answer:</b> As a result of deviation from installation, light may leak at the edge of the fisheye circle. Users are encouraged to try a circle privacy mask, which can be set at the pixel level to block any useless pixels. PM_fisheye</p>
<h2><a class="anchor" id="dewarp_qa_q7"></a>
Question 7: Does multi-region warp mode function with multiple VIN sources?</h2>
<p ><b>Answer:</b> No. Contact the Ambarella Shanghai SDK team with any requests.</p>
<h2><a class="anchor" id="dewarp_qa_q8"></a>
Question 8: How can the warp view aspect ratio be maintained?</h2>
<p ><b>Answer:</b> The aspect ratio may be inappropriate for some views in the post-main buffer, which is caused by warp correction; users can tune the option "sar" from test_encode for a more satisfying aspect ratio when starting to encode. </p><div class="fragment"><div class="line">board # test_encode -A -h 2048x2048 --sar 1/1 -e</div>
</div><!-- fragment --><h2><a class="anchor" id="dewarp_qa_q9"></a>
Question 9: How to get the vertical warp waitlines under encode mode 0?</h2>
<p ><b>Answer:</b> <a class="el" href="../../da/d8b/page_lib_dewarp_doc.html#warp_hw_res">5.2 Warp Hardware Resource</a></p>
<hr  />
<h1><a class="anchor" id="dewarp_api_sec"></a>
8. Dewarp API</h1>
<p >Visit the following link to see details of the API function.</p><ul>
<li><a class="el" href="../../d6/d90/group__dewarp-api-api.html">Dewarp Library API Details</a> explains API functions.</li>
<li><a class="el" href="../../d0/da9/group__dewarp-helper.html">Dewarp Library API Helper</a> shows related structures, macros, and enumerations.</li>
<li>The return error number has been added for dewarp library APIs. <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">ERROR NUMBER   </th><th class="markdownTableHeadCenter">DESCRIPTION    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="../../d0/da9/group__dewarp-helper.html#ga7af0b28d056d70a9366b12a37d390d35">DEWARP_SUCCESS</a>   </td><td class="markdownTableBodyCenter">Return success    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="../../d0/da9/group__dewarp-helper.html#ga483797bf3b79feb57d55ac98d9d9d431">DEWARP_EINVALID</a>   </td><td class="markdownTableBodyCenter">Invalid arguement    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="../../d0/da9/group__dewarp-helper.html#ga4f4bcec7de39f5a99f5aebf69456162e">DEWARP_EPERM</a>   </td><td class="markdownTableBodyCenter">Operation not permitted    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="../../d0/da9/group__dewarp-helper.html#ga0134cdabcbfd7d3ca7cf5a8a29ef36ff">DEWARP_EFAULT</a>   </td><td class="markdownTableBodyCenter">Bad address   </td></tr>
</table>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="dewarp_license"></a>
9. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ( "Software" ) are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
