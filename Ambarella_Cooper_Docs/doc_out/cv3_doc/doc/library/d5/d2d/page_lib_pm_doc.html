<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: PrivacyMask Library API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Library<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d5/d2d/page_lib_pm_doc.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">PrivacyMask Library API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="privacymask_history"></a>
0. Revision History</h1>
<a class="anchor" id="privacymask_lib_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Library Version </th><th align="left">Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td>0.0.2 </td><td>20221230 </td><td>Initial Version </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="privacymask_intro"></a>
1. Introduction</h1>
<p >The privacy mask (PM) library provides a group of flexible and friendly application programming interfaces(APIs) for users to easily integrate the PM feature into their application. It supports filling or clearing triangular, rectangular, quadrangular, circular privacy masks. It also provides some low-level APIs for users to implment privacy masks in other shapes. </p><dl class="section note"><dt>Note</dt><dd>The PM library can only support single-color PMs, and the library can only be used by single-user applications.</dd></dl>
<hr  />
<h1><a class="anchor" id="pm_lib_process"></a>
2. Privacy Mask Usage Guide</h1>
<ul>
<li>For CV2x, the source code of the PM library can be found under the path: <code>ambarella/packages/iav_utils/arch_v5/privacymask</code>.</li>
<li>For CV5x, the source code of the PM library can be found under the path: <code>ambarella/packages/iav_utils/arch_v6/privacymask</code>. Usage of the PM library includes the following steps:</li>
</ul>
<div class="image">
<img src="../../privacymask_usage_process.jpg" alt=""/>
<div class="caption">
Figure 2-1. Usage Process.</div></div>
<p >(1) <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga75c53543b745e9883b4fe533179c5c0c">pm_get_sys_info()</a> implementation flow</p>
<p >The <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga75c53543b745e9883b4fe533179c5c0c">pm_get_sys_info()</a> implementation flow is as follows. </p><div class="image">
<img src="../../pm_get_sys_info.jpg" alt=""/>
<div class="caption">
Figure 2-2. PM Get System Information Flow.</div></div>
<p >(2) <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#gac5e218a9b9c8e048756ec1294f7edb7b">pm_lib_init()</a> implementation flow</p>
<p >The <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#gac5e218a9b9c8e048756ec1294f7edb7b">pm_lib_init()</a> implementation flow is as follows. </p><div class="image">
<img src="../../pm_lib_init.jpg" alt=""/>
<div class="caption">
Figure 2-3. PM Library Initialization Flow.</div></div>
<p >The following tables list the details of key structures. </p><dl class="section user"><dt>Table 2-1. Struct pm_usr_cfg.</dt><dd><a class="anchor" id="pm_usr_cfg"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Item</th><th align="left">Description </th></tr>
<tr>
<td><b>use_warp_table_chan_map</b></td><td>Warp enable per channel's map </td></tr>
<tr>
<td><b>loop_step</b></td><td>Per pixel PM loop step </td></tr>
</table>
</dd></dl>
<dl class="section user"><dt>Table 2-2. Struct pm_sys_info.</dt><dd><a class="anchor" id="pm_sys_info"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Item</th><th align="left">Description </th></tr>
<tr>
<td><b>channel_num</b></td><td>Channel number in case of system </td></tr>
<tr>
<td><b>enc_mode</b></td><td>Current digital signal processor (DSP) encoding mode </td></tr>
<tr>
<td><b>mask_info[IAV_MAX_CHANNEL_NUM]</b></td><td>Mask information per channel </td></tr>
<tr>
<td><b>pm_domain_size[IAV_MAX_CHANNEL_NUM]</b></td><td>PM domain size per channel </td></tr>
<tr>
<td><b>main_domain_size[IAV_MAX_CHANNEL_NUM]</b></td><td>Main domain size per channel </td></tr>
</table>
</dd></dl>
<dl class="section user"><dt>Table 2-3.Struct pm_chan_info.</dt><dd><a class="anchor" id="pm_chan_info"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Item</th><th align="left">Description </th></tr>
<tr>
<td><b>pm_virt_addr</b></td><td>Mask buffer virtual address per channel </td></tr>
<tr>
<td><b>pm_mem_size</b></td><td>Mask buffer size per channel </td></tr>
<tr>
<td><b>vin_info</b></td><td>Video input (VIN) configuration </td></tr>
<tr>
<td><b>main_input_win</b></td><td>Main buffer window configuration </td></tr>
<tr>
<td><b>width_scaler</b></td><td>VIN width scaler ratio for per channel </td></tr>
<tr>
<td><b>height_scaler</b></td><td>VIN height scaler ratio for per channel </td></tr>
<tr>
<td><b>input_width_scaler</b></td><td>Main buffer input window width scaler ratio for per channel </td></tr>
<tr>
<td><b>input_height_scaler</b></td><td>Main buffer input window height scaler ratio for per channel </td></tr>
<tr>
<td><b>rotate_flip</b></td><td>Horizontal flip, vertical flip, and rotate flag </td></tr>
</table>
</dd></dl>
<p>(3) <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga3d615ae6358735f81cfed390de7da550">pm_get_cfg()</a> implementation flow</p>
<ul>
<li><a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga3d615ae6358735f81cfed390de7da550">pm_get_cfg()</a> obtains the PM configuration, virtual address, and size of the PM buffer.</li>
</ul>
<p >(4) PM fill shape implementation flow</p>
<p >The PM library can support filling or clearing triangular, rectangular, quadrangular, and circular PMs. It can also support filling frame border artifact based on mask YUV when using LDC case. The following table details functions in pm fill shape: </p><dl class="section user"><dt>Table 2-4. PM Fill Function.</dt><dd><a class="anchor" id="fill function"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Function</th><th align="left">Description </th></tr>
<tr>
<td>int <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#gafdf15c2c2724903df88b5982ed5324f7">pm_fill_rect(u8 chan_id, struct iav_rect *pm_rect, u8 pm_remove)</a>;</td><td>Fill rectangle mask </td></tr>
<tr>
<td>int <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga99523a316a9dba9d75b3f0e1d047ec5c">pm_fill_circle(u8 chan_id, struct iav_circle *circle, u8 pm_remove)</a>;</td><td>Fill circle mask </td></tr>
<tr>
<td>int <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga7a7b565844f7e71b71766338df9978ef">pm_fill_polygon(u8 chan_id, struct iav_polygon *polygon, u8 pm_remove)</a>;</td><td>Fill polygon mask </td></tr>
<tr>
<td>int <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#gaa435c5e716d18c934fe8136eea19c535">pm_fill_frame_border_by_mask(u8 chan_id, u8 *luma_data)</a>;</td><td>Fill frame border based on mask frame </td></tr>
</table>
</dd></dl>
<p>The parameters are explained as follows: </p><div class="fragment"><div class="line">chan_id -&gt; mask <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a></div>
<div class="line">pm_remove -&gt; 0: fill, 1: clear</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>iav_rect {</div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> x; </div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> y; </div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> width; </div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> height; </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>iav_circle {</div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> center_x; </div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> center_y; </div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> radius; </div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> reserved;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>iav_polygon {</div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> vertice_num; </div>
<div class="line"> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a> reserved[3];</div>
<div class="line"> <span class="keyword">struct </span>iav_point vertex[4]; </div>
<div class="line">};</div>
<div class="ttc" id="aasf__structure_8h_html_a92c50087ca0e64fa93fc59402c55f8ca"><div class="ttname"><a href="../../d2/d47/asf__structure_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></div><div class="ttdeci">uint8_t u8</div><div class="ttdef"><b>Definition:</b> asf_structure.h:44</div></div>
<div class="ttc" id="aasf__structure_8h_html_ace9d960e74685e2cd84b36132dbbf8aa"><div class="ttname"><a href="../../d2/d47/asf__structure_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a></div><div class="ttdeci">uint16_t u16</div><div class="ttdef"><b>Definition:</b> asf_structure.h:45</div></div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div><div class="ttdef"><b>Definition:</b> asf_structure.h:46</div></div>
<div class="ttc" id="avin__init_8c_html_adf7dff2c57c0da9a4a2b70e3e815be31"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a></div><div class="ttdeci">int channel</div></div>
</div><!-- fragment --><p >(5) <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#gaf1453cbfba821ec0127060f02e705d56">pm_insert()</a>, pm_apply(), and <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#gacc9ff6312f9bda4152dd4bb065f98217">pm_clear()</a> implementation flow</p><ul>
<li><a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#gaf1453cbfba821ec0127060f02e705d56">pm_insert()</a>: Update the current channel's PM configuration to the image audio video(IAV) driver. Before calling <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#gaf1453cbfba821ec0127060f02e705d56">pm_insert()</a>, users can call <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga3d615ae6358735f81cfed390de7da550">pm_get_cfg()</a> to get current PM configuration. PM color can be set through configuring Y, U, and V. Note that each time, only one color can be used for all inserted PMs. The PM color is set to black by default.<br  />
</li>
<li><a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga81c5b410770fee38546ef45895d0b95e">pm_apply_cfg()</a>: Apply all channel's PM configuration into the DSP.<br  />
</li>
<li><a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#gacc9ff6312f9bda4152dd4bb065f98217">pm_clear()</a>: Clear all inserted PMs.</li>
</ul>
<p >(6) PM domain convert APIs </p><dl class="section user"><dt>Table 2-5. PM Convert APIs.</dt><dd><a class="anchor" id="convet function"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Function</th><th align="left">Description </th></tr>
<tr>
<td>void <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga045aae10e0ee3df0132eef397b78cf28">pm_rect_to_pm_domain(u8 chan_id, struct iav_rect *pm_rect)</a>;</td><td>Converts PM rectangular coordinate from main domain to pm domain </td></tr>
<tr>
<td>void <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga8c2d760cefc6fd131cdf7c83fd3323c2">pm_point_to_pm_domain(u8 chan_id, struct iav_point *point)</a>;</td><td>Converts PM point coordinate from main domain to pm domain </td></tr>
<tr>
<td>struct iav_point <a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html#ga664f5cf6937741c75dc609b377c6b2c9">pm_warp_map_to_point(u8 chan_id, struct iav_point point_in)</a>;</td><td>Converts PM point coordinate from main domain to warp domain </td></tr>
</table>
</dd></dl>
<p>For more details about the main domain and PM domain, users can can refer to <a class="elRef" target="_blank" href="../../../video/da/de1/fs_basic_pm.html#section_pm">1. Privacy Mask</a>.</p>
<hr  />
<h1><a class="anchor" id="pm_example"></a>
3. Privacy Mask Examples</h1>
<p >For PM examples, refer to <a class="elRef" target="_blank" href="../../../video/da/de1/fs_basic_pm.html#section_sc_pm_examples">2. Single-Color Privacy Mask Examples</a>.</p>
<hr  />
<h1><a class="anchor" id="pm_lib_api"></a>
4. Privacy Mask Library API</h1>
<p >Refer to the following link for API function details.</p><ul>
<li><a class="el" href="../../d8/d26/group__PM__FUNCTION__GROUP.html">Privacy Mask Library API</a> explains API functions.</li>
<li><a class="el" href="../../dc/dea/group__PM__STRUCT__GROUP.html">Privacy Mask Structure</a> shows related structures.</li>
</ul>
<hr  />
<h1><a class="anchor" id="pm_license"></a>
5. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ("Software") are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
