<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: Video Sharing Service Library API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Library<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('df/d98/page_lib_vss_doc.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Video Sharing Service Library API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="vss_history"></a>
0. Revision History</h1>
<a class="anchor" id="vss_lib_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Library Version </th><th align="left">Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td>0.0.1 </td><td>20230717 </td><td>Initial Version </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="vss_intro"></a>
1. Video Sharing Service Introduction</h1>
<p >The video sharing service (VSS) is a library for user applications to publish and subscribe to video frames and bitstreams with low latency. VSS is based on the data distribution service (DDS). Based on the VSS library, the publisher service application acquires video data, publishes it via DDS, and manages the lifetime of the published data. User applications can subscribe to video data and verify if it is expired at any stage of data processing. </p><div class="image">
<img src="../../vss_introduction.png" alt=""/>
<div class="caption">
Figure 1-1. VSS Introduction.</div></div>
<dl class="section user"><dt>Advantages:</dt><dd><ul>
<li>VSS provides a method for data sharing without memory copy, of which the target is to effectively save dynamic random-access memory (DRAM) bandwidth.</li>
<li>Multiple user applications can subscribe to the same topic sharing the same video frame data.</li>
<li>VSS offers the flexibility to change different DDS libraries, such as Cyclone DDS and FastDDS.</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Notes:</dt><dd><ul>
<li>VSS only supports manual feed mode (<code>manual_feed = 1</code> in the Lua script) for pyramid. For canvas, VSS does not support manual feed mode.</li>
<li>The value of <code>zero_copy</code> in the Lua script should be set to 1. The function <code>zero_copy = 0</code> is implemented in the next stage.</li>
<li>The option "--list-topics, -l" in the test application <code>test_vss_subscriber</code> is not currently supported; it will be supported after enabling the topic discovery feature in the upcoming Cyclone DDS library.</li>
<li>Currently, only Cyclone DDS is available in the Ambarella software development kit (SDK). Ambarella will support more types of DDS in the future.</li>
<li>The file save function in the test application <code>test_vss_subscriber</code> is an auxiliary function. Currently, only saving one YUV frame into file can be guarenteed (option: -c 1). When multiple YUV frames are captured, some succeeding frames may be lost due to the delay caused by saving the current frame to the file.</li>
<li>The publish and subscribe functions for streams will be available at a later time.</li>
</ul>
</dd></dl>
<hr  />
<h1><a class="anchor" id="vss_lib_api"></a>
2. Video Sharing Service Library Application Programming Interface (API)</h1>
<p >Refer to the following link for API function details.</p><ul>
<li><a class="el" href="../../de/d18/group__video-sharing-service-video-frame.html">Video Sharing Service Library API</a> explains VSS API functions.</li>
<li><a class="el" href="../../d6/d2d/group__video-sharing-service-utility.html">Video Sharing Service Library Utility API</a> explains VSS Utility API functions.</li>
<li><a class="el" href="../../d7/d81/group__video-sharing-service-struct-group.html">Video Sharing Service Structure</a> shows VSS related structures.</li>
<li><a class="el" href="../../d2/d89/group__vss-config-parser.html">Video Sharing Service Configuration Parser API</a> explains VSS Configuration Parser API functions.</li>
<li><a class="el" href="../../da/da2/group__vss-config-struct-group.html">Video Sharing Service Configuration Parser Structure</a> shows VSS Configuration Parser related structures.</li>
</ul>
<hr  />
<h1><a class="anchor" id="vss_usage"></a>
3. VSS Usage</h1>
<p >When using the VSS library, the digital signal processor (DSP) must be in the preview or encoding state, otherwise VSS will report errors.<br  />
 To enable VSS function and verify it, follow the steps below:</p><ol type="1">
<li>Enable the VSS feature. <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">        [*] Ambarella Package Configuration  ---&gt;</div>
<div class="line">          [*]   Build Ambarella video_sharing_service</div>
</div><!-- fragment --><ul>
<li>If the multi-channel function is used, such as in the following CV72 example, the "Max VIN Channel Number" must be set in menuconfig. <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">        [*] Ambarella Linux Configuration  ---&gt;</div>
<div class="line">          [*]   Ambarella Private Drivers Configuration  ---&gt;</div>
<div class="line">            [*]   Define Common Macros  ---&gt;</div>
<div class="line">              (4)   Max VIN Channel Number</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Enter into the preview.<br  />
 The examples of the test commands are listed below.<br  />
<ul>
<li>For CV22, the Lua script for the system resource settings can be found from <a href="../../scripts/cv22_vin0_1080p_linear.lua" target="_blank"><b>cv22_vin0_1080p_linear.lua</b></a>. <div class="fragment"><div class="line">board# init.sh --imx274_mipi</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg cv22_vin0_1080p_linear.lua --hdmi 1080p</div>
<div class="line">...</div>
</div><!-- fragment --></li>
<li>For CV5, the Lua script for system resource settings can be found from <a href="../../scripts/cv22_vin0_1080p_linear.lua" target="_blank"><b>cv5_vin0_1080p_linear.lua</b></a>. <div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">...</div>
</div><!-- fragment --></li>
<li>For CV72, the Lua script for system resource settings can be found from <a href="../../scripts/cv72_three_chan_single_sensor_1080p.lua" target="_blank"><b>cv72_three_chan_single_sensor_1080p.lua</b></a>. <div class="fragment"><div class="line">board# init.sh --na;modprobe imx274_mipi vinc_id=8</div>
<div class="line">board# test_aaa_service -a&amp;</div>
<div class="line">board# test_encode --resource-cfg cv72_three_chan_single_sensor_1080p.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi_720p.lua</div>
<div class="line">...</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Change the VSS Lua script according to the canvas and pyramid settings in step 2.<br  />
<ul>
<li>The VSS Lua script example for CV22 and CV5 can be found <a href="../../scripts/vss_cfg.lua" target="_blank"><b>here</b></a>.</li>
<li>The VSS Lua script example for CV72 can be found <a href="../../scripts/cv72_vss_cfg.lua" target="_blank"><b>here</b></a>.</li>
</ul>
</li>
<li>Start the publisher daemon in one console. <div class="fragment"><div class="line">board # video_sharing_service_publisher</div>
<div class="line">===============================</div>
<div class="line">    l -- load configure from the specified file path</div>
<div class="line">    a -- start all vss publisher(s)</div>
<div class="line">    x -- stop all vss publisher(s)</div>
<div class="line">    s -- start current vss publisher</div>
<div class="line">    e -- stop current vss publisher</div>
<div class="line">    d -- <span class="keyword">delete</span> a vss publisher</div>
<div class="line">    c -- set current vss publisher</div>
<div class="line">    t -- list all vss publisher(s)</div>
<div class="line">    p -- print current vss publisher info</div>
<div class="line">    g -- change the log level</div>
<div class="line">    q -- Quit</div>
<div class="line">===============================</div>
</div><!-- fragment --> Suggested steps:<br  />
<ul>
<li>a. Load the VSS configuration; use "l" to load the Lua script first. If nothing is input, it will use the default script (<code>/usr/share/ambarella/vss/lua/vss_cfg.lua</code>).</li>
<li>b. Show all loaded topic names. Use "t" to show all topic names to be published. The initial publish states should be "stopped".</li>
<li>c. Start the publisher. Use option "a" to start all publishers, or "c -&gt; s" to start one publisher.</li>
<li>d. Show all topic names again. Use "t" to show all publish topic names, and the publish states should be "running". <div class="fragment"><div class="line">======vss_publisher_info=======</div>
<div class="line">ID: 1 state: running  topic_name: yuv_canvas_0_chan_map_1_yuv420_1920x1080p30</div>
<div class="line">ID: 2 state: running  topic_name: yuv_multi_canvas_1_chan_map_1_yuv420_720x480p30_canvas_2_chan_map_1_yuv420_1920x1080p30</div>
<div class="line">ID: 3 state: running  topic_name: yuv_chan0_srcbuf_4_scale_0_layer0_1280x720_layer1_908x510_layer2_640x360_layer3_456x256_layer4_320x180_layer5_228x128p3</div>
<div class="line">...</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Start the subscriber application <code>test_vss_subscriber</code> in another console to subscribe to a topic which is in a running state listed in step 4 and sub-step d. <div class="fragment"><div class="line">board # test_vss_subscriber -t yuv_canvas_0_chan_map_1_yuv420_1920x1080p30</div>
<div class="line">seq: 10077, 1920x1080, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>: YUV420, lifetime: 100, pts: 32834436, zero_copy: 1, y_addr: 0x7f73bde780, uv_addr: 0x7f73def380, latency: 1.31</div>
<div class="line">seq: 10078, 1920x1080, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>: YUV420, lifetime: 100, pts: 32837436, zero_copy: 1, y_addr: 0x7f73efd380, uv_addr: 0x7f7410df80, latency: 0.28</div>
<div class="line">seq: 10079, 1920x1080, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>: YUV420, lifetime: 100, pts: 32840436, zero_copy: 1, y_addr: 0x7f7421bf80, uv_addr: 0x7f7442cb80, latency: 0.27</div>
<div class="line">seq: 10080, 1920x1080, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>: YUV420, lifetime: 100, pts: 32843436, zero_copy: 1, y_addr: 0x7f738bfb80, uv_addr: 0x7f73ad0780, latency: 0.16</div>
<div class="line">seq: 10081, 1920x1080, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>: YUV420, lifetime: 100, pts: 32846435, zero_copy: 1, y_addr: 0x7f73bde780, uv_addr: 0x7f73def380, latency: 0.16</div>
<div class="line">seq: 10082, 1920x1080, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>: YUV420, lifetime: 100, pts: 32849436, zero_copy: 1, y_addr: 0x7f73efd380, uv_addr: 0x7f7410df80, latency: 0.20</div>
<div class="line">...</div>
<div class="ttc" id="acJSON_8h_html_adb411a44855a4c49231d72a0fc9a3b3b"><div class="ttname"><a href="../../d1/d82/cJSON_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div><div class="ttdeci">char const int const cJSON_bool format</div><div class="ttdef"><b>Definition:</b> cJSON.h:163</div></div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="dds_brief"></a>
4. Data Distribution Service Introduction</h1>
<p >The "data distribution service for real-time systems" is an open standard from the Object Management Group (OMG). This standard is the specification of API of a publish-subscribe communication middleware for distributed systems. Distributed applications using DDS can publish or subscribe to "topics" of information and use a rich set of quality-of-service parameters to set up different aspects of communication, such as reliability, persistence, redundancy, lifespan, transport settings, resources, and more.</p>
<div class="image">
<img src="../../dds_introduction.png" alt=""/>
<div class="caption">
Figure 3-1. DSS Introduction.</div></div>
<hr  />
<h1><a class="anchor" id="pm_license"></a>
5. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ("Software") are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
