<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: test_pvanet.cpp</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Library<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/d51/test_pvanet_8cpp-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">test_pvanet.cpp</div></div>
</div><!--header-->
<div class="contents">
<p >This is a source code file of test_pvanet.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * test_pvanet.cpp</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *    2018/11/20  - [Tao Wu] created</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2018 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents ( &quot;Software&quot; ) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;pthread.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;semaphore.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;libgen.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cavalry_ioctl.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../de/db0/cavalry__mem_8h.html">cavalry_mem.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../db/d9f/nnctrl_8h.html">nnctrl.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;half/half.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../db/dda/data__fmt_8h.html">data_fmt.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d7/d58/opt__layers_8hpp.html">opt_layers.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;custom_def.h&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;opencv2/highgui.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;opencv2/imgcodecs.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;opencv2/imgproc/imgproc.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MEASURE_TIME_VAR() \</span></div>
<div class="line"><span class="preprocessor">    struct timeval tv1, tv2; \</span></div>
<div class="line"><span class="preprocessor">    unsigned long tv_diff</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MEASURE_TIME_START(s) do { \</span></div>
<div class="line"><span class="preprocessor">    gettimeofday(&amp;tv1, NULL); \</span></div>
<div class="line"><span class="preprocessor">    printf(&quot;%s : t1 = %lu.%lu\n&quot;</span>, s, tv1.tv_sec, tv1.tv_usec); \</div>
<div class="line">} while (0)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MEASURE_TIME_END(s) do { \</span></div>
<div class="line"><span class="preprocessor">    gettimeofday(&amp;tv2, NULL); \</span></div>
<div class="line"><span class="preprocessor">    tv_diff = (unsigned long) 1000000 * (unsigned long) (tv2.tv_sec - tv1.tv_sec) + \</span></div>
<div class="line"><span class="preprocessor">        (unsigned long) (tv2.tv_usec - tv1.tv_usec); \</span></div>
<div class="line"><span class="preprocessor">    tv1 = tv2; \</span></div>
<div class="line"><span class="preprocessor">    printf(&quot;%s : t2 = %lu.%lu, diff = %lu us\n&quot;</span>, s, tv1.tv_sec, tv1.tv_usec, tv_diff); \</div>
<div class="line">} while (0)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>half_float;</div>
<div class="line"><span class="keyword">using namespace </span>cv;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define RINGBUF_NUM (2)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>thread_ipc {</div>
<div class="line">    sem_t arm_stage_1_ready; <span class="comment">/* keep order: N-2.ARM_1 before N.ARM_1 */</span></div>
<div class="line">    sem_t vp_stage_1_ready; <span class="comment">/* keep order: N-2.VP_1 before N.VP_1 */</span></div>
<div class="line"> </div>
<div class="line">    sem_t vp_stage_1_done; <span class="comment">/* notify ARM_1 */</span></div>
<div class="line">    sem_t arm_stage_1_done; <span class="comment">/* notify VP_2 */</span></div>
<div class="line">    sem_t vp_stage_2_done; <span class="comment">/* notify ARM_2 */</span></div>
<div class="line"> </div>
<div class="line">    sem_t arm_stage_2_done; <span class="comment">/* notify show_bbox */</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define FILENAME_LENGTH     (256)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> Scalar COLORS[] = {</div>
<div class="line">    CV_RGB(255, 255, 255),</div>
<div class="line">    CV_RGB(0, 0, 255),</div>
<div class="line">    CV_RGB(0, 255, 0),</div>
<div class="line">    CV_RGB(255, 0, 0),</div>
<div class="line">    CV_RGB(255, 255, 0),</div>
<div class="line">    CV_RGB(255, 0, 255),</div>
<div class="line">    CV_RGB(0, 255, 255),</div>
<div class="line">    CV_RGB(255, 128, 128),</div>
<div class="line">    CV_RGB(128, 255, 128),</div>
<div class="line">    CV_RGB(128, 128, 255),</div>
<div class="line">    CV_RGB(128, 255, 255),</div>
<div class="line">    CV_RGB(255, 128, 255),</div>
<div class="line">    CV_RGB(255, 255, 128),</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>io_match {</div>
<div class="line">    uint32_t load_input : 1;</div>
<div class="line">    uint32_t store_output : 1;</div>
<div class="line">    uint32_t no_mem : 1;</div>
<div class="line">    uint32_t crc_inited : 1;</div>
<div class="line">    uint32_t out_stored : 1;</div>
<div class="line">    uint32_t reserved_0 : 27;</div>
<div class="line"> </div>
<div class="line">    uint32_t crc_result;</div>
<div class="line"> </div>
<div class="line">    uint8_t *virt_addr;</div>
<div class="line">    cv_daddr_t dram_addr;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> dram_size;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> data_size;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a id="_a0" name="_a0"></a><a class="code hl_struct" href="../../db/de7/structio__dim.html">io_dim</a> dim;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a1" name="_a1"></a><a class="code hl_struct" href="../../d8/d06/structio__data__fmt.html">io_data_fmt</a> data_fmt;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> port_name[CAVALRY_IO_NAME_MAX];</div>
<div class="line">    <span class="keywordtype">char</span> file_name[FILENAME_LENGTH];</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>net_match {</div>
<div class="line">    uint32_t verbose : 1; <span class="comment">/* nerual network verbose */</span></div>
<div class="line">    uint32_t reuse_mem : 1;</div>
<div class="line">    uint32_t dump_en : 1;</div>
<div class="line">    uint32_t print_time : 1;</div>
<div class="line">    uint32_t have_no_mem_io : 1;</div>
<div class="line">    uint32_t reserved_0 : 27;</div>
<div class="line"> </div>
<div class="line">    uint32_t net_id;</div>
<div class="line">    uint32_t iter_num;</div>
<div class="line">    <span class="keywordtype">char</span> net_name[FILENAME_LENGTH];</div>
<div class="line">    <span class="keywordtype">char</span> path_dump[FILENAME_LENGTH];</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a id="_a2" name="_a2"></a><a class="code hl_struct" href="../../d3/deb/structnet__run__cfg.html">net_run_cfg</a> net_rev;</div>
<div class="line"> </div>
<div class="line">    uint32_t net_bw_sz; <span class="comment">/* Total size */</span></div>
<div class="line">    uint32_t net_bw_us; <span class="comment">/* VP time, unit: us */</span></div>
<div class="line">    <span class="keyword">struct </span><a id="_a3" name="_a3"></a><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> net_m;</div>
<div class="line"> </div>
<div class="line">    uint32_t in_num;</div>
<div class="line">    uint32_t out_num;</div>
<div class="line">    <span class="keyword">struct </span>io_match in_pair[<a id="a4" name="a4"></a><a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>];</div>
<div class="line">    <span class="keyword">struct </span>io_match out_pair[<a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>];</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a id="_a5" name="_a5"></a><a class="code hl_struct" href="../../dc/d4a/structnet__input__cfg.html">net_input_cfg</a> net_in;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a6" name="_a6"></a><a class="code hl_struct" href="../../d7/dfc/structnet__output__cfg.html">net_output_cfg</a> net_out;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> io_type {</div>
<div class="line">    IO_INVALID = 0,</div>
<div class="line">    IO_INPUT = 1,</div>
<div class="line">    IO_OUTPUT = 2,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> run_mode {</div>
<div class="line">    MODE_SERIAL = 0,</div>
<div class="line">    MODE_PARALLEL = 1,</div>
<div class="line">    MODE_RANDOM = 2,</div>
<div class="line">    MODE_NUM,</div>
<div class="line">    MODE_FIRST = MODE_SERIAL,</div>
<div class="line">    MODE_LAST = MODE_RANDOM,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>pva_ext_mem {</div>
<div class="line">    <span class="comment">/* ARM_1 output */</span></div>
<div class="line">    half *nms_out[RINGBUF_NUM];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* The final result contain bbox */</span></div>
<div class="line">    half *bbox_out;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_NET_NUM (4)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>nnctrl_param {</div>
<div class="line">    <span class="keywordtype">int</span> fd_cav;</div>
<div class="line"> </div>
<div class="line">    uint32_t verbose : 1; <span class="comment">/* nnctrl library verbose */</span></div>
<div class="line">    uint32_t all_cache_en : 1; <span class="comment">/* 0: nocached; 1: cached */</span></div>
<div class="line">    uint32_t all_check_md5 : 1;</div>
<div class="line">    uint32_t all_print_time : 1;</div>
<div class="line">    uint32_t all_early_quit : 1;</div>
<div class="line">    uint32_t all_run_loop : 1;</div>
<div class="line">    uint32_t reserved_0: 26;</div>
<div class="line"> </div>
<div class="line">    uint32_t early_quit_flag : 1;</div>
<div class="line">    uint32_t ck_bw_flag : 1;</div>
<div class="line">    uint32_t save_img_flag : 1;</div>
<div class="line">    uint32_t pipeline_en_flag : 1;</div>
<div class="line">    uint32_t reserved_1 : 28;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> run_mode mode;</div>
<div class="line">    uint32_t all_inter_num;</div>
<div class="line"> </div>
<div class="line">    uint32_t net_num;</div>
<div class="line">    <span class="keyword">struct </span>net_match net_pair[MAX_NET_NUM];</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>pva_ext_mem ext_m;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* external memory */</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> rpn_cls_m[RINGBUF_NUM];  <span class="comment">/* VP_stage_1 output */</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> rpn_bbox_m[RINGBUF_NUM]; <span class="comment">/* VP_stage_1 output */</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> concat_m[RINGBUF_NUM];   <span class="comment">/* VP_stage_1 ouput */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> roi_m[RINGBUF_NUM]; <span class="comment">/* VP_stage_2 input */</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> rcnn_cls_prob_m[RINGBUF_NUM];    <span class="comment">/* VP_stage_2 output */</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> rcnn_bbox_m[RINGBUF_NUM];        <span class="comment">/* VP_stage_2 output */</span></div>
<div class="line"> </div>
<div class="line">    uint32_t num_rois[RINGBUF_NUM]; <span class="comment">/* num of rois after NMS in ARM_stage_1 */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* thread communication */</span></div>
<div class="line">    <span class="keyword">struct </span>thread_ipc th_ipc;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* thread pool*/</span></div>
<div class="line">    uint32_t thpool_num;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* draw bbox on jpg file */</span></div>
<div class="line">    <span class="keywordtype">char</span> output_img_name[FILENAME_LENGTH];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> path_dump_arm[FILENAME_LENGTH];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> cls_threshold;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define THREAD_NUM_MIN (1)</span></div>
<div class="line"><span class="preprocessor">#define THREAD_NUM_MAX (8)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>nnctrl_param G_nnctrl;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NO_ARG      0</span></div>
<div class="line"><span class="preprocessor">#define HAS_ARG     1</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> <a class="code hl_enumerationRef" target="_blank" href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aae">numeric_short_options</a> {</div>
<div class="line">    INPUT,</div>
<div class="line">    OUTPUT,</div>
<div class="line">    NO_MEM,</div>
<div class="line">    DUMP_MODE,</div>
<div class="line">    DUMP_ARM_MODE,</div>
<div class="line">    CLS_THRESHOLD,</div>
<div class="line">    SAVE_IMG,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>option <a id="a7" name="a7"></a>long_options[] = {</div>
<div class="line">    {<span class="stringliteral">&quot;cvr-bin&quot;</span>, <a id="a8" name="a8"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;b&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;in&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, INPUT},</div>
<div class="line">    {<span class="stringliteral">&quot;out&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, OUTPUT},</div>
<div class="line">    {<span class="stringliteral">&quot;no&quot;</span>, <a id="a9" name="a9"></a><a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, NO_MEM},</div>
<div class="line">    {<span class="stringliteral">&quot;dump&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, DUMP_MODE},</div>
<div class="line">    {<span class="stringliteral">&quot;dump-arm&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, DUMP_ARM_MODE},</div>
<div class="line">    {<span class="stringliteral">&quot;cls-thresh&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, CLS_THRESHOLD},</div>
<div class="line">    {<span class="stringliteral">&quot;out-img&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, SAVE_IMG},</div>
<div class="line">    {<span class="stringliteral">&quot;net-verbose&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;v&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;ctrl-verbose&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;V&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;print-time&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;e&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;cache&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;c&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;iter&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;t&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;th-num&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a>, 0, <span class="charliteral">&#39;T&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;pipeline&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;p&#39;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;help&quot;</span>, <a class="code hl_defineRef" target="_blank" href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a>, 0, <span class="charliteral">&#39;h&#39;</span>},</div>
<div class="line">    {0, 0, 0, 0}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a10" name="a10"></a>short_options = <span class="stringliteral">&quot;b:vVect:T:ph&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a id="_a11" name="_a11"></a><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a12" name="a12"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a id="a13" name="a13"></a><a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_structRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html">hint_s</a> <a id="a14" name="a14"></a>hint[] = {</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tCavalry_gen generated binary, it is network binary&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\t\tInput port name and filename to load, specify after network&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tOutput port name and filename to save, specify after network&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\t\tDo not allocate input memory in libnnctrl, specify after network&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tThe path to blob dump and dvi dump, specify after network. Path should exist&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tThe path to dump ARM_1 and VP_2 output in ROIs Num. Path should exist&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tSet cls-threshold, default is 0.25&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tDraw BBox result on original image file, save result file with prefix \&quot;out_\&quot;&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tprint verbose info of neural network, specify after network&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\tprint verbose info of nnctrl library&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tprint execute time of all neural network. Default is disable&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tmmap cache memory. Default is noncache&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tIteration of run network, loop forever (0xffffffff) if set 0. Default is 1&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tThread number in thread pool. Default is 4. Rang is [1, 8]&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tDisable VP and ARM pipeline process. Default is pipeline.&quot;</span>},</div>
<div class="line">    {<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\t\tPrint help info&quot;</span>},</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a id="a15" name="a15"></a><a class="code hl_function" href="../../dc/d60/test__smartfb_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *itself = <span class="stringliteral">&quot;test_pvanet&quot;</span>;</div>
<div class="line">    uint32_t i = 0;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;%s usage:\n&quot;</span>, itself);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(long_options) / <span class="keyword">sizeof</span>(long_options[0]) - 1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (isalpha(long_options[i].val))</div>
<div class="line">            printf(<span class="stringliteral">&quot;-%c &quot;</span>, long_options[i].val);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;--%s&quot;</span>, long_options[i].<a id="a16" name="a16"></a><a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>[0] != 0)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [%s]&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">arg</a>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, hint[i].<a class="code hl_variableRef" target="_blank" href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">str</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\nExample:\n\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;1. Run pvanet:\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  # %s -c -b arch_cv22/pvanet_rpn_cavalry.bin --in data=input.bin&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; --out rpn_cls_prob_reshape --no --out rpn_bbox_pred --no&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; --out concat_convf_permute --no&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; -b arch_cv22/pvanet_rcnn_compress_cavalry.bin --in roi_pool_conv5 --no&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; --out cls_prob --no --out bbox_pred --no &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\n\n&quot;</span>, itself);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> set_io_pair(<span class="keywordtype">char</span> *in_opt, <span class="keyword">struct</span> io_match *io_pair)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *fn_ptr = NULL;</div>
<div class="line">    <span class="keywordtype">size_t</span> len1, len2;</div>
<div class="line"> </div>
<div class="line">    fn_ptr = strchr(in_opt, <span class="charliteral">&#39;=&#39;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (fn_ptr) {</div>
<div class="line">        *fn_ptr = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">        fn_ptr++;</div>
<div class="line">        len1 = strlen(fn_ptr);</div>
<div class="line">        len2 = strlen(in_opt);</div>
<div class="line">        <span class="keywordflow">if</span> (len1 &gt;= <span class="keyword">sizeof</span>(io_pair-&gt;file_name)) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;io port file [%s] is too long, max[%lu]\n&quot;</span>,</div>
<div class="line">                fn_ptr, <span class="keyword">sizeof</span>(io_pair-&gt;file_name));</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (len2 &gt;= <span class="keyword">sizeof</span>(io_pair-&gt;port_name)) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;io port name [%s] is too long, max[%lu]\n&quot;</span>,</div>
<div class="line">                in_opt, <span class="keyword">sizeof</span>(io_pair-&gt;port_name));</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        memcpy(io_pair-&gt;port_name, in_opt, len2);</div>
<div class="line">        io_pair-&gt;port_name[len2] = 0;</div>
<div class="line"> </div>
<div class="line">        memcpy(io_pair-&gt;file_name, fn_ptr, len1);</div>
<div class="line">        io_pair-&gt;file_name[len1] = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        len2 = strlen(in_opt);</div>
<div class="line">        <span class="keywordflow">if</span> (len2 &gt;= <span class="keyword">sizeof</span>(io_pair-&gt;port_name)) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;io port name [%s] is too long, max[%lu]\n&quot;</span>,</div>
<div class="line">                in_opt, <span class="keyword">sizeof</span>(io_pair-&gt;port_name));</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        memcpy(io_pair-&gt;port_name, in_opt, len2);</div>
<div class="line">        io_pair-&gt;port_name[len2] = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_param(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = &amp;G_nnctrl;</div>
<div class="line">    <span class="keyword">enum</span> io_type io_t = IO_INVALID;</div>
<div class="line">    uint32_t net_idx = 0;</div>
<div class="line">    uint32_t in_idx = 0;</div>
<div class="line">    uint32_t out_idx = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> ch = 0;</div>
<div class="line">    <span class="keywordtype">int</span> value = 0;</div>
<div class="line">    <span class="keywordtype">int</span> option_index = 0;</div>
<div class="line">    <span class="keywordtype">float</span> f_value = 0.0f;</div>
<div class="line">    <span class="keywordtype">char</span> opt_buf[CAVALRY_IO_NAME_MAX + 1 + FILENAME_LENGTH];</div>
<div class="line"> </div>
<div class="line">    opterr = 0;</div>
<div class="line">    <span class="keywordflow">while</span> ((ch = getopt_long(argc, argv, short_options, long_options, &amp;option_index)) != -1) {</div>
<div class="line">        <span class="keywordflow">switch</span> (ch) {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line">            value = strlen(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (value &gt;= FILENAME_LENGTH) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Filename [%s] is too long [%u] (&gt;%u).\n&quot;</span>, optarg,</div>
<div class="line">                value, FILENAME_LENGTH);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            net_idx = pctrl-&gt;net_num;</div>
<div class="line">            pctrl-&gt;net_pair[net_idx].reuse_mem = 1; <span class="comment">/* Enable reuse mem by default */</span></div>
<div class="line">            snprintf(pctrl-&gt;net_pair[net_idx].net_name, <span class="keyword">sizeof</span>(pctrl-&gt;net_pair[net_idx].net_name), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">            printf(<span class="stringliteral">&quot;Cavalry Bin: [%u][%s]\n&quot;</span>, net_idx, pctrl-&gt;net_pair[net_idx].net_name);</div>
<div class="line">            pctrl-&gt;net_num++;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> INPUT:</div>
<div class="line">            value = strlen(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (value &gt; CAVALRY_IO_NAME_MAX + 1 + FILENAME_LENGTH) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;io pair [%s] is too long [%u] (&gt;%u).\n&quot;</span>, optarg,</div>
<div class="line">                value, CAVALRY_IO_NAME_MAX + 1 + FILENAME_LENGTH);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            snprintf(opt_buf, <span class="keyword">sizeof</span>(opt_buf), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">            printf(<span class="stringliteral">&quot;INPUT: [%s]\n&quot;</span>, opt_buf);</div>
<div class="line">            in_idx = pctrl-&gt;net_pair[net_idx].in_num;</div>
<div class="line">            <span class="keywordflow">if</span> (in_idx &gt;= <a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;IO pair number is too much: %u &gt; %u.\n&quot;</span>, in_idx, <a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (set_io_pair(opt_buf, &amp;pctrl-&gt;net_pair[net_idx].in_pair[in_idx]) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;parse io pair [%s] failed, discard.\n&quot;</span>, opt_buf);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pctrl-&gt;net_pair[net_idx].in_pair[in_idx].load_input = 1;</div>
<div class="line">            pctrl-&gt;net_pair[net_idx].in_num++;</div>
<div class="line">            io_t = IO_INPUT;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> OUTPUT:</div>
<div class="line">            value = strlen(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (value &gt; CAVALRY_IO_NAME_MAX + 1 + FILENAME_LENGTH) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;io pair [%s] is too long [%u] (&gt;%u).\n&quot;</span>, optarg,</div>
<div class="line">                value, CAVALRY_IO_NAME_MAX + 1 + FILENAME_LENGTH);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            snprintf(opt_buf, <span class="keyword">sizeof</span>(opt_buf), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">            printf(<span class="stringliteral">&quot;OUTPUT: [%s]\n&quot;</span>, opt_buf);</div>
<div class="line">            out_idx = pctrl-&gt;net_pair[net_idx].out_num;</div>
<div class="line">            <span class="keywordflow">if</span> (out_idx &gt;= <a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;IO pair number is too much: %u &gt; %u.\n&quot;</span>, out_idx, <a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (set_io_pair(opt_buf, &amp;pctrl-&gt;net_pair[net_idx].out_pair[out_idx]) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;parse io pair [%s] failed, discard.\n&quot;</span>, opt_buf);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pctrl-&gt;net_pair[net_idx].out_num++;</div>
<div class="line">            io_t = IO_OUTPUT;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> NO_MEM:</div>
<div class="line">            <span class="keywordflow">if</span> (io_t == IO_INPUT) {</div>
<div class="line">                pctrl-&gt;net_pair[net_idx].in_pair[in_idx].no_mem = 1;</div>
<div class="line">                printf(<span class="stringliteral">&quot;Do not allocate net [%u] input [%u] memory in libnnctrl.\n&quot;</span>,</div>
<div class="line">                    net_idx, in_idx);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (io_t == IO_OUTPUT) {</div>
<div class="line">                pctrl-&gt;net_pair[net_idx].out_pair[out_idx].no_mem = 1;</div>
<div class="line">                printf(<span class="stringliteral">&quot;Do not allocate net [%u] output [%u] memory in libnnctrl.\n&quot;</span>,</div>
<div class="line">                    net_idx, out_idx);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;--no option only for io port\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (value == 0) {</div>
<div class="line">                pctrl-&gt;all_inter_num = ~0;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                pctrl-&gt;all_inter_num = value;</div>
<div class="line">            }</div>
<div class="line">            printf(<span class="stringliteral">&quot;Iteration number [%u]\n&quot;</span>, pctrl-&gt;all_inter_num);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> DUMP_MODE:</div>
<div class="line">            value = strlen(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (value &gt; FILENAME_LENGTH) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Path to dump [%s] is too long [%u] (&gt;%u).\n&quot;</span>, optarg,</div>
<div class="line">                    value, FILENAME_LENGTH);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pctrl-&gt;net_pair[net_idx].dump_en = 1;</div>
<div class="line">            pctrl-&gt;net_pair[net_idx].reuse_mem = 0;</div>
<div class="line">            snprintf(pctrl-&gt;net_pair[net_idx].path_dump, <span class="keyword">sizeof</span>(pctrl-&gt;net_pair[net_idx].path_dump), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">            printf(<span class="stringliteral">&quot;Implied disabling blob memory reuse in order to dump.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> DUMP_ARM_MODE:</div>
<div class="line">            value = strlen(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (value &gt; FILENAME_LENGTH) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Path to dump-arm [%s] is too long [%u] (&gt;%u).\n&quot;</span>, optarg,</div>
<div class="line">                    value, FILENAME_LENGTH);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            snprintf(pctrl-&gt;path_dump_arm, <span class="keyword">sizeof</span>(pctrl-&gt;path_dump_arm), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> CLS_THRESHOLD:</div>
<div class="line">            f_value = atof(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> ((f_value &lt; 0.0f) || (f_value &gt; 1.0f)) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid cls-threadhold: %f, [0.0, 1.0]\n&quot;</span>, f_value);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pctrl-&gt;cls_threshold = f_value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SAVE_IMG:</div>
<div class="line">            snprintf(pctrl-&gt;output_img_name, <span class="keyword">sizeof</span>(pctrl-&gt;output_img_name), <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">            pctrl-&gt;save_img_flag = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;T&#39;</span>:</div>
<div class="line">            value = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> ((value &lt; THREAD_NUM_MIN) || (value &gt; THREAD_NUM_MAX)) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalide thread num: %d, [%d, %d]\n&quot;</span>, value,</div>
<div class="line">                    THREAD_NUM_MIN, THREAD_NUM_MAX);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            pctrl-&gt;thpool_num = value;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div>
<div class="line">            pctrl-&gt;pipeline_en_flag = 0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div>
<div class="line">            pctrl-&gt;net_pair[net_idx].verbose = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div>
<div class="line">            pctrl-&gt;verbose = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div>
<div class="line">            pctrl-&gt;all_cache_en = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:</div>
<div class="line">            pctrl-&gt;all_print_time = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">            <a class="code hl_function" href="../../dc/d60/test__smartfb_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>();</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            printf(<span class="stringliteral">&quot;unknown option found: %c\n&quot;</span>, ch);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> alloc_cv_mem(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size, cv_daddr_t *pphys, uint8_t **pvirt)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = &amp;G_nnctrl;</div>
<div class="line">    <span class="keywordtype">void</span> *virt = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> phys = 0;</div>
<div class="line">    uint8_t cache_en = pctrl-&gt;all_cache_en;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a17" name="a17"></a><a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#ga78fe436b7764d49520410be725783432">cavalry_mem_alloc</a>(&amp;size, &amp;phys, &amp;virt, cache_en) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;cavalry_mem_alloc err\n&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        *pphys = phys;</div>
<div class="line">        *pvirt = (uint8_t *)virt;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sync_cache_mem(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> phys,</div>
<div class="line">    uint8_t clean, uint8_t invalid)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = &amp;G_nnctrl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (pctrl-&gt;all_cache_en) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a18" name="a18"></a><a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#gae5462177e0abc1ff7de5a4e5932d9e34">cavalry_mem_sync_cache</a>(size, phys, clean, invalid) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;cavalry_mem_sync_cache err\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> free_all_cv_mem(<span class="keyword">struct</span> nnctrl_param *pctrl)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>net_match *pnet = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> *pmem = NULL;</div>
<div class="line">    uint32_t i = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; pctrl-&gt;net_num; i++) {</div>
<div class="line">        pnet = &amp;pctrl-&gt;net_pair[i];</div>
<div class="line">        pmem = &amp;pnet-&gt;net_m;</div>
<div class="line">        <span class="keywordflow">if</span> (pmem-&gt;<a id="a19" name="a19"></a><a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> &amp;&amp; pmem-&gt;<a id="a20" name="a20"></a><a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a id="a21" name="a21"></a><a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#gae80d26c23fcc3eb0f578f32647f90a7a">cavalry_mem_free</a>(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>,</div>
<div class="line">                pmem-&gt;<a id="a22" name="a22"></a><a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0 ) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;cavalry_mem_free net_m err\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pmem = &amp;pctrl-&gt;rpn_cls_m[0];</div>
<div class="line">    <span class="keywordflow">if</span> (pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> &amp;&amp; pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#gae80d26c23fcc3eb0f578f32647f90a7a">cavalry_mem_free</a>(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> * RINGBUF_NUM,</div>
<div class="line">            pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0 ) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;cavalry_mem_free rpn_cls_m err\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pmem = &amp;pctrl-&gt;rpn_bbox_m[0];</div>
<div class="line">    <span class="keywordflow">if</span> (pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> &amp;&amp; pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#gae80d26c23fcc3eb0f578f32647f90a7a">cavalry_mem_free</a>(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> * RINGBUF_NUM,</div>
<div class="line">            pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0 ) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;cavalry_mem_free rpn_bbox_m err\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pmem = &amp;pctrl-&gt;concat_m[0];</div>
<div class="line">    <span class="keywordflow">if</span> (pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> &amp;&amp; pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#gae80d26c23fcc3eb0f578f32647f90a7a">cavalry_mem_free</a>(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> * RINGBUF_NUM,</div>
<div class="line">            pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0 ) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;cavalry_mem_free concat_m err\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pmem = &amp;pctrl-&gt;roi_m[0];</div>
<div class="line">    <span class="keywordflow">if</span> (pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> &amp;&amp; pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#gae80d26c23fcc3eb0f578f32647f90a7a">cavalry_mem_free</a>(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> * RINGBUF_NUM,</div>
<div class="line">            pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0 ) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;cavalry_mem_free roi_m err\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pmem = &amp;pctrl-&gt;rcnn_cls_prob_m[0];</div>
<div class="line">    <span class="keywordflow">if</span> (pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> &amp;&amp; pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#gae80d26c23fcc3eb0f578f32647f90a7a">cavalry_mem_free</a>(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> * RINGBUF_NUM,</div>
<div class="line">            pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0 ) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;cavalry_mem_free rcnn_cls_prob_m err\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pmem = &amp;pctrl-&gt;rcnn_bbox_m[0];</div>
<div class="line">    <span class="keywordflow">if</span> (pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> &amp;&amp; pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#gae80d26c23fcc3eb0f578f32647f90a7a">cavalry_mem_free</a>(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> * RINGBUF_NUM,</div>
<div class="line">            pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0 ) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;cavalry_mem_free rcnn_bbox_m err\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> free_all_alloc_mem(<span class="keyword">struct</span> nnctrl_param *pctrl)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (pctrl-&gt;ext_m.nms_out[0]) {</div>
<div class="line">        free(pctrl-&gt;ext_m.nms_out[0]);</div>
<div class="line">        pctrl-&gt;ext_m.nms_out[0] = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (pctrl-&gt;ext_m.bbox_out) {</div>
<div class="line">        free(pctrl-&gt;ext_m.bbox_out);</div>
<div class="line">        pctrl-&gt;ext_m.bbox_out = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> load_file(<span class="keyword">const</span> <span class="keyword">struct</span> io_match *io)</div>
<div class="line">{</div>
<div class="line">    FILE *in = NULL;</div>
<div class="line">    uint32_t file_size = 0;</div>
<div class="line">    uint32_t file_data_pitch = 0;</div>
<div class="line">    uint32_t io_data_pitch = 0;</div>
<div class="line">    uint32_t io_data_rows = 0;</div>
<div class="line">    uint32_t io_data_row_size = 0;</div>
<div class="line">    uint8_t *io_data = NULL;</div>
<div class="line">    uint32_t i = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> ((in = fopen(io-&gt;file_name, <span class="stringliteral">&quot;rb&quot;</span>)) == NULL) {</div>
<div class="line">            perror(io-&gt;file_name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (fseek(in, 0, SEEK_END) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;fseek input file&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        file_size = ftell(in);</div>
<div class="line">        io_data_pitch = io-&gt;dim.pitch;</div>
<div class="line">        io_data_rows = io-&gt;dim.plane * io-&gt;dim.depth * io-&gt;dim.height;</div>
<div class="line">        io_data_row_size = io-&gt;dim.width * (1 &lt;&lt; io-&gt;data_fmt.size);</div>
<div class="line">        io_data = io-&gt;virt_addr;</div>
<div class="line">        file_data_pitch = file_size / io_data_rows;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((file_size % io_data_rows) || (file_data_pitch &lt; io_data_row_size)) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;file size [%u] doesn&#39;t match input shape [%lux%lux%luxPitch]\n&quot;</span>,</div>
<div class="line">                file_size, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)io-&gt;dim.plane, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)io-&gt;dim.depth,</div>
<div class="line">                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)io-&gt;dim.height);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (fseek(in, 0, SEEK_SET) &lt; 0) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;fseek input file&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; io_data_rows; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (fread(io_data, 1, io_data_row_size, in) != io_data_row_size) {</div>
<div class="line">                perror(<span class="stringliteral">&quot;fread input file&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (file_data_pitch &gt; io_data_row_size) {</div>
<div class="line">                <span class="keywordflow">if</span> (fseek(in, file_data_pitch - io_data_row_size, SEEK_CUR) &lt; 0) {</div>
<div class="line">                    perror(<span class="stringliteral">&quot;fseek input file&quot;</span>);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            io_data += io_data_pitch;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (in) {</div>
<div class="line">        fclose(in);</div>
<div class="line">        in = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> store_file(<span class="keyword">const</span> <span class="keywordtype">char</span> *file_name, uint8_t *<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>, uint32_t size)</div>
<div class="line">{</div>
<div class="line">    FILE *out = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> ((out = fopen(file_name, <span class="stringliteral">&quot;w+b&quot;</span>)) == NULL) {</div>
<div class="line">            perror(file_name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (fwrite(<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>, 1, size, out) != size) {</div>
<div class="line">            perror(file_name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (out) {</div>
<div class="line">        fclose(out);</div>
<div class="line">        out = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Return value:  -1: err;   0: ok;   1: ok, input has set no_mem */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> load_input_io(<span class="keyword">struct</span> net_match *pnet)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>io_match *io = NULL;</div>
<div class="line">    uint32_t k = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (k = 0; k &lt; pnet-&gt;in_num; k++) {</div>
<div class="line">        io = &amp;pnet-&gt;in_pair[k];</div>
<div class="line">        <span class="keywordflow">if</span> (io-&gt;virt_addr == NULL) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Not found addr for input port [%s]\n&quot;</span>, io-&gt;port_name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (strlen(io-&gt;file_name) &gt; 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (load_file(io) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Load input port [%s] with file [%s] failed!\n&quot;</span>,</div>
<div class="line">                    io-&gt;port_name, io-&gt;file_name);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            sync_cache_mem(io-&gt;data_size, io-&gt;dram_addr, 1, 0);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        pnet-&gt;have_no_mem_io = 1;</div>
<div class="line">        rval = 1;  <span class="comment">/* input has set no_mem */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> invalid_output_mem(<span class="keyword">struct</span> net_match *pnet)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>io_match *io = NULL;</div>
<div class="line">    uint32_t k = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (k = 0; k &lt; pnet-&gt;out_num; k ++) {</div>
<div class="line">        io = &amp;pnet-&gt;out_pair[k];</div>
<div class="line">        sync_cache_mem(io-&gt;data_size, io-&gt;dram_addr, 0, 1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> process_output_mem(<span class="keyword">struct</span> net_match *pnet)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define EXT_LEN (32)</span></div>
<div class="line">    <span class="keyword">struct </span>io_match *io = NULL;</div>
<div class="line">    uint32_t k = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (k = 0; k &lt; pnet-&gt;out_num; k ++) {</div>
<div class="line">        io = &amp;pnet-&gt;out_pair[k];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* STORE output blob */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strlen(io-&gt;file_name) &gt; 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (io-&gt;out_stored == 0) {</div>
<div class="line">                <span class="keywordflow">if</span> (store_file(io-&gt;file_name, io-&gt;virt_addr, io-&gt;data_size) &lt; 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Store output port [%s] to file [%s] failed\n&quot;</span>,</div>
<div class="line">                        io-&gt;port_name, io-&gt;file_name);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                }</div>
<div class="line">                io-&gt;out_stored = 1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> arm_stage_1_pre(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> arm_stage_2_pre(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> vp_stage_1_pre(<span class="keyword">struct</span> <a class="code hl_struct" href="../../d7/dfc/structnet__output__cfg.html">net_output_cfg</a> *net_out)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = &amp;G_nnctrl;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> *pmem = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> mem;</div>
<div class="line">    uint32_t one_size = 0, i = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (net_out-&gt;<a id="a23" name="a23"></a><a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#a17afdb10821678afccc3bec8d83e1625">out_num</a> != 3) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;VP stage 1 output num is not equal 3\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    pmem = &amp;mem;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        one_size = net_out-&gt;<a id="a24" name="a24"></a><a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[0].<a id="a25" name="a25"></a><a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>;</div>
<div class="line">        pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> = one_size * RINGBUF_NUM;</div>
<div class="line">        <span class="keywordflow">if</span> (alloc_cv_mem(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>,</div>
<div class="line">            &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;alloc_cv_mem err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; RINGBUF_NUM; i++) {</div>
<div class="line">            pctrl-&gt;rpn_cls_m[i].virt_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;rpn_cls_m[i].phy_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;rpn_cls_m[i].mem_size = one_size;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        one_size = net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[1].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>;</div>
<div class="line">        pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> = one_size * RINGBUF_NUM;</div>
<div class="line">        <span class="keywordflow">if</span> (alloc_cv_mem(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>,</div>
<div class="line">            &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;alloc_cv_mem err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; RINGBUF_NUM; i++) {</div>
<div class="line">            pctrl-&gt;rpn_bbox_m[i].virt_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;rpn_bbox_m[i].phy_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;rpn_bbox_m[i].mem_size = one_size;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        one_size = net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[2].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>;</div>
<div class="line">        pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> = one_size * RINGBUF_NUM;</div>
<div class="line">        <span class="keywordflow">if</span> (alloc_cv_mem(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>,</div>
<div class="line">            &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;alloc_cv_mem err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; RINGBUF_NUM; i++) {</div>
<div class="line">            pctrl-&gt;concat_m[i].virt_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;concat_m[i].phy_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;concat_m[i].mem_size = one_size;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> set_net_io_no_mem(<span class="keyword">struct</span> net_match *pnet,</div>
<div class="line">    <span class="keyword">struct</span> <a class="code hl_struct" href="../../dc/d4a/structnet__input__cfg.html">net_input_cfg</a> *net_in, <span class="keyword">struct</span> <a class="code hl_struct" href="../../d7/dfc/structnet__output__cfg.html">net_output_cfg</a> *net_out)</div>
<div class="line">{</div>
<div class="line">    uint32_t i = 0;</div>
<div class="line"> </div>
<div class="line">    net_in-&gt;<a id="a26" name="a26"></a><a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a88b08f224c035fa5cae2217e6d67afda">in_num</a> = pnet-&gt;in_num;</div>
<div class="line">    net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#a17afdb10821678afccc3bec8d83e1625">out_num</a> = pnet-&gt;out_num;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a88b08f224c035fa5cae2217e6d67afda">in_num</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (i &gt; <a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Overflow input num: %u, max: %u&quot;</span>, i, <a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        net_in-&gt;<a id="a27" name="a27"></a><a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a id="a28" name="a28"></a><a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">name</a> = pnet-&gt;in_pair[i].port_name;</div>
<div class="line">        <span class="keywordflow">if</span> (pnet-&gt;in_pair[i].no_mem) {</div>
<div class="line">            net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a id="a29" name="a29"></a><a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a05b251f6f4721e4b738a9439a7eda472">no_mem</a> = 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#a17afdb10821678afccc3bec8d83e1625">out_num</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (i &gt; <a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Overflow output num: %u, max: %u&quot;</span>, i, <a class="code hl_define" href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a id="a30" name="a30"></a><a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">name</a> = pnet-&gt;out_pair[i].port_name;</div>
<div class="line">        <span class="keywordflow">if</span> (pnet-&gt;out_pair[i].no_mem) {</div>
<div class="line">            net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a id="a31" name="a31"></a><a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a05b251f6f4721e4b738a9439a7eda472">no_mem</a> = 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_net_io_size_no_mem(<span class="keyword">struct</span> nnctrl_param *pctrl, uint32_t idx,</div>
<div class="line">    <span class="keyword">struct</span> <a class="code hl_struct" href="../../dc/d4a/structnet__input__cfg.html">net_input_cfg</a> *net_in, <span class="keyword">struct</span> <a class="code hl_struct" href="../../d7/dfc/structnet__output__cfg.html">net_output_cfg</a> *net_out)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>net_match *pnet = NULL;</div>
<div class="line">    uint32_t i = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    pnet = &amp;pctrl-&gt;net_pair[idx];</div>
<div class="line">    <span class="keywordflow">if</span> (pnet == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;pnet is NULL\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a88b08f224c035fa5cae2217e6d67afda">in_num</a>; i++) {</div>
<div class="line">        pnet-&gt;in_pair[i].data_size = net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a id="a32" name="a32"></a><a class="code hl_variable" href="../../d2/d45/structinput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>;</div>
<div class="line">        pnet-&gt;in_pair[i].dram_size= net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a> == 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Input [%u] [%s] get invalid size: 0x%lx\n&quot;</span>,</div>
<div class="line">                i, net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">name</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ((idx == 1) &amp;&amp; !pnet-&gt;in_pair[i].no_mem) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RCNN&#39;s input should use --no option\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#a17afdb10821678afccc3bec8d83e1625">out_num</a>; i++) {</div>
<div class="line">        pnet-&gt;out_pair[i].data_size = net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>;</div>
<div class="line">        pnet-&gt;out_pair[i].dram_size = net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a> == 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Output [%u] [%s] get invalid size: 0x%lx\n&quot;</span>,</div>
<div class="line">                i, net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">name</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!pnet-&gt;out_pair[i].no_mem) {</div>
<div class="line">            <span class="keywordflow">if</span> (idx == 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;RPN&#39;s output should use --no option\n&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idx == 1) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;RCNN&#39;s output should use --no option\n&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid pvanet index\n&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (idx == 1) {</div>
<div class="line">        <span class="keywordflow">if</span> (arm_stage_1_pre() &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;arm_stage_1_pre err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">return</span> rval;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (arm_stage_2_pre() &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;arm_stage_2_pre err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">return</span> rval;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[0].<a id="a33" name="a33"></a><a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a> = pctrl-&gt;roi_m[0].phy_addr;</div>
<div class="line">        pnet-&gt;in_pair[0].dram_addr = pctrl-&gt;roi_m[0].phy_addr;</div>
<div class="line">        pnet-&gt;in_pair[0].virt_addr = pctrl-&gt;roi_m[0].virt_addr;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a88b08f224c035fa5cae2217e6d67afda">in_num</a>; i++) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;%u.Input_ext [%u]: phys: 0x%lx, size: %lu, virt: %p\n&quot;</span>, idx, i,</div>
<div class="line">                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)pnet-&gt;in_pair[i].dram_addr,</div>
<div class="line">                pnet-&gt;in_pair[i].dram_size, pnet-&gt;in_pair[i].virt_addr);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (idx == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (vp_stage_1_pre(net_out) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;vp_stage_1_pre err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">return</span> rval;</div>
<div class="line">        }</div>
<div class="line">        net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[0].<a id="a34" name="a34"></a><a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a> = pctrl-&gt;rpn_cls_m[0].phy_addr;</div>
<div class="line">        net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[1].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a> = pctrl-&gt;rpn_bbox_m[0].phy_addr;</div>
<div class="line">        net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[2].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a> = pctrl-&gt;concat_m[0].phy_addr;</div>
<div class="line"> </div>
<div class="line">        pnet-&gt;out_pair[0].dram_addr = pctrl-&gt;rpn_cls_m[0].phy_addr;</div>
<div class="line">        pnet-&gt;out_pair[0].virt_addr = pctrl-&gt;rpn_cls_m[0].virt_addr;</div>
<div class="line"> </div>
<div class="line">        pnet-&gt;out_pair[1].dram_addr = pctrl-&gt;rpn_bbox_m[0].phy_addr;</div>
<div class="line">        pnet-&gt;out_pair[1].virt_addr = pctrl-&gt;rpn_bbox_m[0].virt_addr;</div>
<div class="line"> </div>
<div class="line">        pnet-&gt;out_pair[2].dram_addr = pctrl-&gt;concat_m[0].phy_addr;</div>
<div class="line">        pnet-&gt;out_pair[2].virt_addr = pctrl-&gt;concat_m[0].virt_addr;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#a17afdb10821678afccc3bec8d83e1625">out_num</a>; i++) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;%u.Output_ext [%u]: phys: 0x%lx, size: %lu, virt: %p\n&quot;</span>, idx, i,</div>
<div class="line">                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)pnet-&gt;out_pair[i].dram_addr,</div>
<div class="line">                pnet-&gt;out_pair[i].dram_size, pnet-&gt;out_pair[i].virt_addr);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idx == 1) {</div>
<div class="line">        net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[0].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a> = pctrl-&gt;rcnn_cls_prob_m[0].phy_addr;</div>
<div class="line">        net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[1].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a> = pctrl-&gt;rcnn_bbox_m[0].phy_addr;</div>
<div class="line"> </div>
<div class="line">        pnet-&gt;out_pair[0].dram_addr = pctrl-&gt;rcnn_cls_prob_m[0].phy_addr;</div>
<div class="line">        pnet-&gt;out_pair[0].virt_addr = pctrl-&gt;rcnn_cls_prob_m[0].virt_addr;</div>
<div class="line"> </div>
<div class="line">        pnet-&gt;out_pair[1].dram_addr = pctrl-&gt;rcnn_bbox_m[0].phy_addr;</div>
<div class="line">        pnet-&gt;out_pair[1].virt_addr = pctrl-&gt;rcnn_bbox_m[0].virt_addr;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#a17afdb10821678afccc3bec8d83e1625">out_num</a>; i++) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;%u.Output_ext [%u]: phys: 0x%lx, size: %lu, virt: %p\n&quot;</span>, idx, i,</div>
<div class="line">                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)pnet-&gt;out_pair[i].dram_addr,</div>
<div class="line">                pnet-&gt;out_pair[i].dram_size, pnet-&gt;out_pair[i].virt_addr);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_net_io_cfg(<span class="keyword">struct</span> net_match *pnet, <span class="keyword">struct</span> <a class="code hl_struct" href="../../dc/d4a/structnet__input__cfg.html">net_input_cfg</a> *net_in,</div>
<div class="line">    <span class="keyword">struct</span> <a class="code hl_struct" href="../../d7/dfc/structnet__output__cfg.html">net_output_cfg</a> *net_out)</div>
<div class="line">{</div>
<div class="line">    uint32_t i = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a88b08f224c035fa5cae2217e6d67afda">in_num</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (pnet-&gt;in_pair[i].no_mem == 0) {</div>
<div class="line">            pnet-&gt;in_pair[i].dram_addr = net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a>;</div>
<div class="line">            pnet-&gt;in_pair[i].data_size = net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>;</div>
<div class="line">            <span class="keywordflow">if</span> ((net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a> == 0) || (net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a> == 0)) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Input [%u] [%s] get invalid addr: 0x%lx, size: 0x%lx\n&quot;</span>,</div>
<div class="line">                    i, net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">name</a>,</div>
<div class="line">                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            pnet-&gt;in_pair[i].virt_addr = pnet-&gt;net_m.virt_addr +</div>
<div class="line">                pnet-&gt;in_pair[i].dram_addr - pnet-&gt;net_m.phy_addr;</div>
<div class="line">        }</div>
<div class="line">        pnet-&gt;in_pair[i].dim = net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a id="a35" name="a35"></a><a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>;</div>
<div class="line">        pnet-&gt;in_pair[i].data_fmt = net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a id="a36" name="a36"></a><a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>;</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Input [%u] [%s] dimension: %lu, %lu, %lu, %lu, pitch: %lu, &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;dram_format: %u, data_format: %d, %d, %d, %d. &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;phys: 0x%lx, size: %lu, virt: %p\n&quot;</span>,</div>
<div class="line">            i, net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">name</a>,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a id="a37" name="a37"></a><a class="code hl_variable" href="../../db/de7/structio__dim.html#afab25cb00475c5e5167bd688c8935f1d">plane</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a id="a38" name="a38"></a><a class="code hl_variable" href="../../db/de7/structio__dim.html#af3562adee51a826821063e1a6e7dcd5b">depth</a>,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a id="a39" name="a39"></a><a class="code hl_variable" href="../../db/de7/structio__dim.html#a2a80572814f32a23139da84a214f3e7e">height</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a id="a40" name="a40"></a><a class="code hl_variable" href="../../db/de7/structio__dim.html#a3f3081bbf4aed5f1d478704ef9f0ec49">width</a>,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a id="a41" name="a41"></a><a class="code hl_variable" href="../../db/de7/structio__dim.html#a6151b90948f9409a6ad67219369dd801">pitch</a>, net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a id="a42" name="a42"></a><a class="code hl_variable" href="../../db/de7/structio__dim.html#a5574b64abdcb1e8455471e18f6947d04">dram_fmt</a>,</div>
<div class="line">            net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>.<a id="a43" name="a43"></a><a class="code hl_variable" href="../../d8/d06/structio__data__fmt.html#a0e0ace816facf5d8b503eb83e8e798b8">sign</a>, net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>.<a id="a44" name="a44"></a><a class="code hl_variable" href="../../d8/d06/structio__data__fmt.html#ae5dc6ffcd9b7605c7787791e40cc6bb0">size</a>,</div>
<div class="line">            net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>.<a id="a45" name="a45"></a><a class="code hl_variable" href="../../d8/d06/structio__data__fmt.html#a375c68753379e89f4548d93e5e41d41d">expoffset</a>, net_in-&gt;<a class="code hl_variable" href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">in_desc</a>[i].<a class="code hl_variable" href="../../d2/d45/structinput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>.<a id="a46" name="a46"></a><a class="code hl_variable" href="../../d8/d06/structio__data__fmt.html#ad9cd444e0d5bf7539865ca6dc194d92e">expbits</a>,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)pnet-&gt;in_pair[i].dram_addr, pnet-&gt;in_pair[i].data_size, pnet-&gt;in_pair[i].virt_addr);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#a17afdb10821678afccc3bec8d83e1625">out_num</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (pnet-&gt;out_pair[i].no_mem == 0) {</div>
<div class="line">            pnet-&gt;out_pair[i].dram_addr = net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a>;</div>
<div class="line">            pnet-&gt;out_pair[i].data_size = net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>;</div>
<div class="line">            <span class="keywordflow">if</span> ((net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a> == 0) || (net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a> == 0)) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Output [%u] [%s] get invalid addr: 0x%lx, size: 0x%lx\n&quot;</span>,</div>
<div class="line">                    i, net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">name</a>,</div>
<div class="line">                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a7dc04adf5758857da0cf009c816560de">addr</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">size</a>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            pnet-&gt;out_pair[i].virt_addr = pnet-&gt;net_m.virt_addr +</div>
<div class="line">                pnet-&gt;out_pair[i].dram_addr - pnet-&gt;net_m.phy_addr;</div>
<div class="line">        }</div>
<div class="line">        pnet-&gt;out_pair[i].dim = net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a id="a47" name="a47"></a><a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>;</div>
<div class="line">        pnet-&gt;out_pair[i].data_fmt = net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a id="a48" name="a48"></a><a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>;</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Output [%u] [%s] dimension: %lu, %lu, %lu, %lu, pitch: %lu, &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;dram_format: %u, data_format: %d, %d, %d, %d. &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;phys: 0x%lx, size: %lu, virt: %p\n&quot;</span>,</div>
<div class="line">            i, net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">name</a>,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a class="code hl_variable" href="../../db/de7/structio__dim.html#afab25cb00475c5e5167bd688c8935f1d">plane</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a class="code hl_variable" href="../../db/de7/structio__dim.html#af3562adee51a826821063e1a6e7dcd5b">depth</a>,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a class="code hl_variable" href="../../db/de7/structio__dim.html#a2a80572814f32a23139da84a214f3e7e">height</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a class="code hl_variable" href="../../db/de7/structio__dim.html#a3f3081bbf4aed5f1d478704ef9f0ec49">width</a>,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a class="code hl_variable" href="../../db/de7/structio__dim.html#a6151b90948f9409a6ad67219369dd801">pitch</a>, net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">dim</a>.<a class="code hl_variable" href="../../db/de7/structio__dim.html#a5574b64abdcb1e8455471e18f6947d04">dram_fmt</a>,</div>
<div class="line">            net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>.<a class="code hl_variable" href="../../d8/d06/structio__data__fmt.html#a0e0ace816facf5d8b503eb83e8e798b8">sign</a>, net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>.<a class="code hl_variable" href="../../d8/d06/structio__data__fmt.html#ae5dc6ffcd9b7605c7787791e40cc6bb0">size</a>,</div>
<div class="line">            net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>.<a class="code hl_variable" href="../../d8/d06/structio__data__fmt.html#a375c68753379e89f4548d93e5e41d41d">expoffset</a>, net_out-&gt;<a class="code hl_variable" href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">out_desc</a>[i].<a class="code hl_variable" href="../../d9/dcb/structoutput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">data_fmt</a>.<a class="code hl_variable" href="../../d8/d06/structio__data__fmt.html#ad9cd444e0d5bf7539865ca6dc194d92e">expbits</a>,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)pnet-&gt;out_pair[i].dram_addr, pnet-&gt;out_pair[i].data_size, pnet-&gt;out_pair[i].virt_addr);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_one_net(<span class="keyword">struct</span> nnctrl_param *pctrl, uint32_t idx)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a49" name="_a49"></a><a class="code hl_struct" href="../../da/df5/structnet__cfg.html">net_cfg</a> net_cf;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../dc/d4a/structnet__input__cfg.html">net_input_cfg</a> net_in;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d7/dfc/structnet__output__cfg.html">net_output_cfg</a> net_out;</div>
<div class="line">    <span class="keyword">struct </span>net_match *pnet = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> net_id = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    pnet = &amp;pctrl-&gt;net_pair[idx];</div>
<div class="line">    <span class="keywordflow">if</span> (pnet == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;start net with NULL pointer\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    memset((<span class="keywordtype">void</span> *)&amp;net_cf, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="../../da/df5/structnet__cfg.html">net_cfg</a>));</div>
<div class="line">    memset((<span class="keywordtype">void</span> *)&amp;net_in, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="../../dc/d4a/structnet__input__cfg.html">net_input_cfg</a>));</div>
<div class="line">    memset((<span class="keywordtype">void</span> *)&amp;net_out, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="../../d7/dfc/structnet__output__cfg.html">net_output_cfg</a>));</div>
<div class="line"> </div>
<div class="line">    net_cf.net_file = pnet-&gt;net_name;</div>
<div class="line">    net_cf.verbose = pnet-&gt;verbose;</div>
<div class="line">    net_cf.reuse_mem = pnet-&gt;reuse_mem;</div>
<div class="line">    net_cf.print_time = pnet-&gt;print_time;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (idx == 1) {</div>
<div class="line">        <span class="comment">/* the second VP stage */</span></div>
<div class="line">        net_cf.net_loop_cnt = NUM_POST_NMS_BBOX;</div>
<div class="line">        printf(<span class="stringliteral">&quot;RCNN net_loop_cnt: %d\n&quot;</span>, net_cf.net_loop_cnt);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (set_net_io_no_mem(pnet, &amp;net_in, &amp;net_out) &lt; 0) {</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        net_id = <a id="a50" name="a50"></a><a class="code hl_function" href="../../dd/da5/group__nnctrl-api-details.html#ga1979e4b7a487fba5776122920fa01a0d">nnctrl_init_net</a>(&amp;net_cf, &amp;net_in, &amp;net_out);</div>
<div class="line">        <span class="keywordflow">if</span> (net_id &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;nnctrl_init_net err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (net_cf.net_mem_total == 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;nnctrl_init_net get total size is zero\n&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                pnet-&gt;net_id = net_id;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        pnet-&gt;net_m.mem_size = net_cf.net_mem_total;</div>
<div class="line">        <span class="keywordflow">if</span> (alloc_cv_mem(pnet-&gt;net_m.mem_size, &amp;pnet-&gt;net_m.phy_addr,</div>
<div class="line">            &amp;pnet-&gt;net_m.virt_addr) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;alloc cv mem err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (pnet-&gt;net_m.virt_addr == NULL) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;alloc cv mem is NULL\n&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (get_net_io_size_no_mem(pctrl, idx, &amp;net_in, &amp;net_out) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;get net io size err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a51" name="a51"></a><a class="code hl_function" href="../../dd/da5/group__nnctrl-api-details.html#ga40ea8c04b3430d95b1b4921160bf44cc">nnctrl_load_net</a>(net_id, &amp;pnet-&gt;net_m, &amp;net_in, &amp;net_out) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;nnctrl load net err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        sync_cache_mem(pnet-&gt;net_m.mem_size, pnet-&gt;net_m.phy_addr, 1, 0);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (get_net_io_cfg(pnet, &amp;net_in, &amp;net_out) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;get net io cfg err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (load_input_io(pnet) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;load input err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        pnet-&gt;net_in = net_in;</div>
<div class="line">        pnet-&gt;net_out = net_out;</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rval == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Network [%d] [%s] total memory size: %lu, dvi: %lu, blob: %lu. Bandwidth size: %lu\n&quot;</span>,</div>
<div class="line">            pnet-&gt;net_id, pnet-&gt;net_name, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_cf.net_mem_total,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_cf.dvi_mem_total, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_cf.blob_mem_total,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)net_cf.bandwidth_total);</div>
<div class="line">        pnet-&gt;net_bw_sz = net_cf.bandwidth_total;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *run_one_net(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>net_match *pnet = (<span class="keyword">struct </span>net_match *)arg;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a52" name="_a52"></a><a class="code hl_struct" href="../../d8/df3/structnet__result.html">net_result</a> net_ret;</div>
<div class="line">    <span class="keyword">struct </span>timeval tv1, tv2;</div>
<div class="line">    <span class="keywordtype">void</span> *ret = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tv_diff = 0, total_tv_diff = 0;</div>
<div class="line">    <span class="keywordtype">double</span> total_vp_us = 0, one_vp_us = 0;</div>
<div class="line">    uint32_t cnt = 0, max_cnt = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0, result = 0;</div>
<div class="line"> </div>
<div class="line">    max_cnt = pnet-&gt;iter_num;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">for</span> (cnt = 0; G_nnctrl.all_run_loop &amp;&amp; (cnt &lt; max_cnt); cnt++) {</div>
<div class="line">            gettimeofday(&amp;tv1, NULL);</div>
<div class="line">            one_vp_us = 0;</div>
<div class="line">            result = <a id="a53" name="a53"></a><a class="code hl_function" href="../../dd/da5/group__nnctrl-api-details.html#ga22348832dabd8161328a34f9892f93e0">nnctrl_run_net</a>(pnet-&gt;net_id, &amp;net_ret, &amp;pnet-&gt;net_rev,</div>
<div class="line">                &amp;pnet-&gt;net_in, &amp;pnet-&gt;net_out);</div>
<div class="line">            one_vp_us += net_ret.vp_time_us;</div>
<div class="line">            <span class="keywordflow">if</span> (result &lt; 0) {</div>
<div class="line">                <span class="keywordflow">if</span> (result == -EAGAIN) {</div>
<div class="line">                    <span class="keywordflow">do</span> {</div>
<div class="line">                        result = <a id="a54" name="a54"></a><a class="code hl_function" href="../../dd/da5/group__nnctrl-api-details.html#ga12db598f56dd9956a8bd54ea4533c95c">nnctrl_resume_net</a>(pnet-&gt;net_id, &amp;net_ret);</div>
<div class="line">                        one_vp_us += net_ret.vp_time_us;</div>
<div class="line">                        <span class="keywordflow">if</span> (result == -EINTR) {</div>
<div class="line">                            printf(<span class="stringliteral">&quot;interrupt by signal in resume\n&quot;</span>);</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                    } <span class="keywordflow">while</span> (result == -EAGAIN);</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result == -EINTR) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;interrupt by signal in run\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;nnctrl_run_net failed at iteration [%d], ret: %d\n&quot;</span>, cnt, result);</div>
<div class="line">                    rval = -1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            gettimeofday(&amp;tv2, NULL);</div>
<div class="line">            tv_diff = (<span class="keywordtype">unsigned</span> long) 1000000 * (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) (tv2.tv_sec - tv1.tv_sec) +</div>
<div class="line">                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) (tv2.tv_usec - tv1.tv_usec);</div>
<div class="line">            total_tv_diff += tv_diff;</div>
<div class="line">            total_vp_us += one_vp_us;</div>
<div class="line"> </div>
<div class="line">            invalid_output_mem(pnet);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (process_output_mem(pnet) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;process output mem err at iteration [%d]\n&quot;</span>, cnt);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (pnet-&gt;dump_en) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a id="a55" name="a55"></a><a class="code hl_function" href="../../dd/da5/group__nnctrl-api-details.html#ga964c3b506357a71707479d55a0af66f6">nnctrl_dump_net</a>(pnet-&gt;net_id, pnet-&gt;path_dump) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;dump blob and dvi err\n&quot;</span>);</div>
<div class="line">                rval = -1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;nnctrl_run_net err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (max_cnt &gt; 1) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Network [%d] [%s] iteration: %u / %u.&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot; AVG: vp time: %0.2f us, arm time: %lu us\n&quot;</span>,</div>
<div class="line">            pnet-&gt;net_id, pnet-&gt;net_name, cnt, max_cnt,</div>
<div class="line">            total_vp_us / cnt, total_tv_diff / cnt);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">        ret = NULL;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        pnet-&gt;net_bw_us = total_vp_us / cnt;</div>
<div class="line">        ret = arg;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> arm_stage_1_pre(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = &amp;G_nnctrl;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> *pmem = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> mem;</div>
<div class="line">    half *nms_out = NULL;</div>
<div class="line">    uint32_t one_size = 0, i = 0;</div>
<div class="line">    uint32_t nms_size = 0, roi_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        nms_size = RINGBUF_NUM * NUM_POST_NMS_BBOX * 4 * <span class="keyword">sizeof</span>(half);</div>
<div class="line">        nms_out = (half *)malloc(nms_size);</div>
<div class="line">        <span class="keywordflow">if</span> (!nms_out) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;nms_out: out of memory\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            memset((<span class="keywordtype">void</span> *)nms_out, 0, nms_size);</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; RINGBUF_NUM; i++) {</div>
<div class="line">                pctrl-&gt;ext_m.nms_out[i] = nms_out + (NUM_POST_NMS_BBOX * 4) * i;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        roi_size = pctrl-&gt;net_pair[1].in_pair[0].data_size;</div>
<div class="line">        pmem = &amp;mem;</div>
<div class="line">        pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> = RINGBUF_NUM * NUM_POST_NMS_BBOX * roi_size;</div>
<div class="line">        <span class="keywordflow">if</span> (alloc_cv_mem(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>,</div>
<div class="line">            &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;alloc_cv_mem roi_m err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        memset(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>, 0, pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>);</div>
<div class="line">        sync_cache_mem(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>, pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, 1, 0);</div>
<div class="line">        one_size = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> / RINGBUF_NUM;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; RINGBUF_NUM; i++) {</div>
<div class="line">            pctrl-&gt;roi_m[i].virt_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;roi_m[i].phy_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;roi_m[i].mem_size = one_size;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> arm_stage_2_pre(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = &amp;G_nnctrl;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> *pmem = NULL;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../d5/ddc/structnet__mem.html">net_mem</a> mem;</div>
<div class="line">    uint32_t one_size = 0, out_size = 0, i = 0;</div>
<div class="line">    uint32_t rcnn_cls_size = 0, rcnn_bbox_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    pmem = &amp;mem;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        rcnn_cls_size = pctrl-&gt;net_pair[1].out_pair[0].data_size;</div>
<div class="line">        rcnn_bbox_size = pctrl-&gt;net_pair[1].out_pair[1].data_size;</div>
<div class="line"> </div>
<div class="line">        one_size = NUM_POST_NMS_BBOX * rcnn_cls_size;</div>
<div class="line">        pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> = one_size * RINGBUF_NUM;</div>
<div class="line">        <span class="keywordflow">if</span> (alloc_cv_mem(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>,</div>
<div class="line">            &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;alloc_cv_mem rcnn_cls_prob_m err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; RINGBUF_NUM; i++) {</div>
<div class="line">            pctrl-&gt;rcnn_cls_prob_m[i].virt_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;rcnn_cls_prob_m[i].phy_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;rcnn_cls_prob_m[i].mem_size = one_size;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        one_size = NUM_POST_NMS_BBOX * rcnn_bbox_size;</div>
<div class="line">        pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a> = one_size * RINGBUF_NUM;</div>
<div class="line">        <span class="keywordflow">if</span> (alloc_cv_mem(pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">mem_size</a>,</div>
<div class="line">            &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a>, &amp;pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a>) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;alloc_cv_mem rcnn_bbox_m err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; RINGBUF_NUM; i++) {</div>
<div class="line">            pctrl-&gt;rcnn_bbox_m[i].virt_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">virt_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;rcnn_bbox_m[i].phy_addr = pmem-&gt;<a class="code hl_variable" href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">phy_addr</a> + one_size * i;</div>
<div class="line">            pctrl-&gt;rcnn_bbox_m[i].mem_size = one_size;</div>
<div class="line">        }</div>
<div class="line">        out_size = (N_CLASSES + NUM_POST_NMS_BBOX * N_CLASSES * 5) * <span class="keyword">sizeof</span>(half);</div>
<div class="line">        half *output = (half *)malloc(out_size);</div>
<div class="line">        <span class="keywordflow">if</span> (!output) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;output is NULL\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            memset((<span class="keywordtype">void</span> *)output, 0, out_size);</div>
<div class="line">            pctrl-&gt;ext_m.bbox_out = output;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DATASIZE_16_BITS 1</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_data_format_fp16(<span class="keyword">struct</span> <a class="code hl_struct" href="../../d8/d06/structio__data__fmt.html">io_data_fmt</a> *<a id="a56" name="a56"></a><a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;sign != 1) || (<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;size != DATASIZE_16_BITS) ||</div>
<div class="line">        (<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;expoffset != 0) || (<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;expbits != 4)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;data_format (%u, %u, %u, %u) is not FP16\n&quot;</span>,</div>
<div class="line">            <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;sign, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;size, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;expoffset, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;expbits);</div>
<div class="line">        rval = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_data_format_fx16(<span class="keyword">struct</span> <a class="code hl_struct" href="../../d8/d06/structio__data__fmt.html">io_data_fmt</a> *<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;size != DATASIZE_16_BITS) || (<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;expbits != 0)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;data_format (%u, %u, %u, %u) is not FX16\n&quot;</span>,</div>
<div class="line">            <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;sign, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;size, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;expoffset, <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a>-&gt;expbits);</div>
<div class="line">        rval = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_dim(<span class="keyword">struct</span> <a class="code hl_struct" href="../../db/de7/structio__dim.html">io_dim</a> *dim)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dim-&gt;<a class="code hl_variable" href="../../db/de7/structio__dim.html#a3f3081bbf4aed5f1d478704ef9f0ec49">width</a> &amp; 0xf) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;width (%lu) should be multiply 16\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)dim-&gt;<a class="code hl_variable" href="../../db/de7/structio__dim.html#a3f3081bbf4aed5f1d478704ef9f0ec49">width</a>);</div>
<div class="line">        rval = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_net_io_desc(<span class="keyword">struct</span> nnctrl_param *pctrl)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>net_match *pnet = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        pnet = &amp;pctrl-&gt;net_pair[0];</div>
<div class="line">        <span class="keywordflow">if</span> (check_data_format_fp16(&amp;pnet-&gt;net_out.out_desc[0].data_fmt) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RPN&#39;s output [%s] CLS shoud be FP16\n&quot;</span>, pnet-&gt;net_out.out_desc[0].name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (check_data_format_fp16(&amp;pnet-&gt;net_out.out_desc[1].data_fmt) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RPN&#39;s output [%s] BBox shoud be FP16\n&quot;</span>, pnet-&gt;net_out.out_desc[1].name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (check_data_format_fx16(&amp;pnet-&gt;net_out.out_desc[2].data_fmt) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RPN&#39;s output [%s] FMap shoud be FX16\n&quot;</span>, pnet-&gt;net_out.out_desc[2].name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (check_dim(&amp;pnet-&gt;net_out.out_desc[2].dim) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RPN&#39;s output [%s] width is wrong\n&quot;</span>, pnet-&gt;net_out.out_desc[2].name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        pnet = &amp;pctrl-&gt;net_pair[1];</div>
<div class="line">        <span class="keywordflow">if</span> (check_dim(&amp;pnet-&gt;net_in.in_desc[0].dim) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RCNN&#39;s input [%s] width is wrong\n&quot;</span>, pnet-&gt;net_in.in_desc[0].name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (check_data_format_fx16(&amp;pnet-&gt;net_in.in_desc[0].data_fmt) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RCNN&#39;s input [%s] FMap shoud be FX16\n&quot;</span>, pnet-&gt;net_in.in_desc[0].name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (check_data_format_fp16(&amp;pnet-&gt;net_out.out_desc[0].data_fmt) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RCNN&#39;s output [%s] CLS shoud be FP16\n&quot;</span>, pnet-&gt;net_out.out_desc[0].name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (check_data_format_fp16(&amp;pnet-&gt;net_out.out_desc[1].data_fmt) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;RCNN&#39;s output [%s] BBox shoud be FP16\n&quot;</span>, pnet-&gt;net_out.out_desc[1].name);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_opt_layers_lib(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = &amp;G_nnctrl;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a57" name="_a57"></a><a class="code hl_struct" href="../../d2/d52/structopt__layers__version.html">opt_layers_version</a> opt_ver;</div>
<div class="line">    <span class="keyword">struct </span><a id="_a58" name="_a58"></a><a class="code hl_struct" href="../../de/d21/structfrcnn__desc.html">frcnn_desc</a> <a class="code hl_struct" href="../../de/d21/structfrcnn__desc.html">frcnn_desc</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="../../de/d21/structfrcnn__desc.html">frcnn_desc</a> *pdesc = &amp;<a class="code hl_struct" href="../../de/d21/structfrcnn__desc.html">frcnn_desc</a>;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a59" name="a59"></a><a class="code hl_function" href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga1f283dc0114cf1a5b0494d6c3a9e61cb">opt_layers_get_version</a>(&amp;opt_ver) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;opt_layers_get_version err\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s: %u.%u.%u, mod-time: 0x%x\n&quot;</span>, opt_ver.description,</div>
<div class="line">        opt_ver.major, opt_ver.minor, opt_ver.patch, opt_ver.mod_time);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (check_net_io_desc(pctrl) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Check network io err\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    memset(pdesc, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="../../de/d21/structfrcnn__desc.html">frcnn_desc</a>));</div>
<div class="line">    pdesc-&gt;<a id="a60" name="a60"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a582bac1b6223ef1ebc7e243b42463604">thread_num</a> = pctrl-&gt;thpool_num;</div>
<div class="line">    pdesc-&gt;<a id="a61" name="a61"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#ae664ac0bccf21fb86f6a8af7e2d23001">num_anchor</a> = NUM_ANCHORS;</div>
<div class="line">    pdesc-&gt;<a id="a62" name="a62"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a64fab2121d684b52f12a717b85654729">num_pre_nms_bbox</a> = NUM_PRE_NMS_BBOX;</div>
<div class="line">    pdesc-&gt;<a id="a63" name="a63"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#aab0d57aa773525a7ae83fad3c72c01ac">num_post_nms_bbox</a> = NUM_POST_NMS_BBOX;</div>
<div class="line">    pdesc-&gt;<a id="a64" name="a64"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#aac475ad5fd925c09c1e056a5865bd8c0">num_classes</a> = N_CLASSES;</div>
<div class="line">    pdesc-&gt;<a id="a65" name="a65"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a4bf6a689494bf7b2fc68686c4df2682f">bbox_min_size</a> = MIN_SIZE;</div>
<div class="line"> </div>
<div class="line">    pdesc-&gt;<a id="a66" name="a66"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a577eb7b3aba727e565f9235822a3acd1">iou_pre_rpn_threshold</a> = IOU_THRESH;</div>
<div class="line">    pdesc-&gt;<a id="a67" name="a67"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#aa11b0eefae314af7530e003acfcf7d69">iou_post_rcnn_threshold</a> = IOU_THRESH_POST_RCNN;</div>
<div class="line">    pdesc-&gt;<a id="a68" name="a68"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#acf87702e36ef3a7e8fb36f292c400299">cls_prob_threshold</a> = pctrl-&gt;cls_threshold;</div>
<div class="line"> </div>
<div class="line">    pdesc-&gt;<a id="a69" name="a69"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a431c1a52143e011627460aba8f5e5b7d">img_height</a> = pctrl-&gt;net_pair[0].net_in.in_desc[0].dim.height;</div>
<div class="line">    pdesc-&gt;<a id="a70" name="a70"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a7ca3a7aadb30f671947e9fd4d829cd41">img_width</a> = pctrl-&gt;net_pair[0].net_in.in_desc[0].dim.width;</div>
<div class="line">    pdesc-&gt;<a id="a71" name="a71"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#ab3360db9380d3f908efd8fb6d8c0db6c">fmap_scale</a> = (pctrl-&gt;net_pair[0].net_in.in_desc[0].dim.height /</div>
<div class="line">        pctrl-&gt;net_pair[0].net_out.out_desc[1].dim.height);</div>
<div class="line"> </div>
<div class="line">    pdesc-&gt;<a id="a72" name="a72"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a5c196e032bb0427f79edcaa00f1fe793">fmap_depth</a> = (pctrl-&gt;net_pair[0].net_out.out_desc[2].dim.width *</div>
<div class="line">        pctrl-&gt;net_pair[0].net_out.out_desc[2].dim.plane);</div>
<div class="line">    pdesc-&gt;<a id="a73" name="a73"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#acd0fea60ef48bbd685b5b858bf3f578b">fmap_height</a> = pctrl-&gt;net_pair[0].net_out.out_desc[2].dim.depth;</div>
<div class="line">    pdesc-&gt;<a id="a74" name="a74"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a53c9bc862e062f98174547c23025bedf">fmap_width</a> = pctrl-&gt;net_pair[0].net_out.out_desc[2].dim.height;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* can not get fmap pitch from out_desc after change fmap dimension */</span></div>
<div class="line">    pdesc-&gt;<a id="a75" name="a75"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a4eb23d978e08723800d01eda0d1f7867">fmap_pitch</a> = ((((pdesc-&gt;<a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a53c9bc862e062f98174547c23025bedf">fmap_width</a> *</div>
<div class="line">        (1 &lt;&lt; pctrl-&gt;net_pair[0].net_out.out_desc[2].data_fmt.size) + 31) &gt;&gt; 5) &lt;&lt; 5) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">    pdesc-&gt;<a id="a76" name="a76"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a6bd12a72f30c6d78cd1bfc33c921edb4">fmap_sign</a> = pctrl-&gt;net_pair[0].net_out.out_desc[2].data_fmt.sign;</div>
<div class="line"> </div>
<div class="line">    pdesc-&gt;<a id="a77" name="a77"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#aebcba508bbf559eb92f0adc6c579042b">pooled_height</a> = pctrl-&gt;net_pair[1].net_in.in_desc[0].dim.depth;</div>
<div class="line">    pdesc-&gt;<a id="a78" name="a78"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a5f1908390975de96487e6acadbf552dd">pooled_width</a> = pctrl-&gt;net_pair[1].net_in.in_desc[0].dim.height;</div>
<div class="line">    pdesc-&gt;<a id="a79" name="a79"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a266046be9a17a34f8358285d68a0d21e">pooled_pitch</a> = (pctrl-&gt;net_pair[1].net_in.in_desc[0].dim.pitch &gt;&gt;</div>
<div class="line">        pctrl-&gt;net_pair[1].net_in.in_desc[0].data_fmt.size);</div>
<div class="line"> </div>
<div class="line">    pdesc-&gt;<a id="a80" name="a80"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a56f2ba2fbd31d46bc729cbb997fc18e3">rpn_cls_pitch</a> = (pctrl-&gt;net_pair[0].net_out.out_desc[0].dim.pitch &gt;&gt;</div>
<div class="line">        pctrl-&gt;net_pair[0].net_out.out_desc[0].data_fmt.size);</div>
<div class="line">    pdesc-&gt;<a id="a81" name="a81"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a2e01c7302817b385f25c138d5d73f49a">rpn_bbox_pitch</a> = (pctrl-&gt;net_pair[0].net_out.out_desc[1].dim.pitch &gt;&gt;</div>
<div class="line">        pctrl-&gt;net_pair[0].net_out.out_desc[1].data_fmt.size);</div>
<div class="line"> </div>
<div class="line">    pdesc-&gt;<a id="a82" name="a82"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#aad29c63fa1eb6281ef264c413e9b124f">rcnn_cls_pitch</a> = (pctrl-&gt;net_pair[1].net_out.out_desc[0].dim.pitch &gt;&gt;</div>
<div class="line">        pctrl-&gt;net_pair[1].net_out.out_desc[0].data_fmt.size);</div>
<div class="line">    pdesc-&gt;<a id="a83" name="a83"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a69b0210fc2c018f602414120ffeff00c">rcnn_bbox_pitch</a> = (pctrl-&gt;net_pair[1].net_out.out_desc[1].dim.pitch &gt;&gt;</div>
<div class="line">        pctrl-&gt;net_pair[1].net_out.out_desc[1].data_fmt.size);</div>
<div class="line"> </div>
<div class="line">    pdesc-&gt;<a id="a84" name="a84"></a><a class="code hl_variable" href="../../de/d21/structfrcnn__desc.html#a15c7fce50178b2c6e2e4dcb42e0c1f0c">verbose</a> = pctrl-&gt;verbose;</div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a85" name="a85"></a><a class="code hl_function" href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga5095956a02846240c0402fbffefde73d">opt_layers_frcnn_init</a>(pdesc, anchors_array) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;opt_layers_frcnn_init err\n&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> show_bbox_result(half *out, uint32_t n_classes)</div>
<div class="line">{</div>
<div class="line">    half *p_out = NULL;</div>
<div class="line">    half *header = NULL;</div>
<div class="line">    uint32_t total_out_count = 0;</div>
<div class="line">    uint32_t out_count = 0;</div>
<div class="line">    uint32_t i = 0, ind = 0;</div>
<div class="line"> </div>
<div class="line">    header = out;</div>
<div class="line">    printf(<span class="stringliteral">&quot;=================== BBox Result =====================\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (ind = 0; ind &lt; n_classes; ind++) {</div>
<div class="line">        p_out = out + n_classes + total_out_count * 5;</div>
<div class="line">        out_count = (uint16_t) *header;</div>
<div class="line">        <span class="keywordflow">if</span> (out_count &gt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Class [%d] [%s] keep [%d] bboxes\n&quot;</span>, ind, class_names[ind], out_count);</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; out_count; i ++) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;  BBOX[%d]: x1 = %f, y1 = %f, x2 = %f, y2 = %f, scores = %f\n&quot;</span>,</div>
<div class="line">                    i, (<span class="keywordtype">float</span>)p_out[5 * i], (<span class="keywordtype">float</span>)p_out[5 * i + 1], (<span class="keywordtype">float</span>)p_out[5 * i + 2],</div>
<div class="line">                    (<span class="keywordtype">float</span>)p_out[5 * i + 3], (<span class="keywordtype">float</span>)p_out[5 * i + 4]);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        total_out_count += NUM_POST_NMS_BBOX;</div>
<div class="line">        header++;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;================================================\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> draw_bbox_img(half *out, uint32_t n_classes, <span class="keyword">const</span> <span class="keywordtype">char</span> *in_filename)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define NUM_COLORS (sizeof(COLORS) / sizeof(Scalar))</span></div>
<div class="line"><span class="preprocessor">#define PREFIX_STR &quot;out&quot;</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = &amp;G_nnctrl;</div>
<div class="line">    <span class="keyword">struct </span>net_match *pnet = NULL;</div>
<div class="line">    <span class="keyword">struct </span>stat status;</div>
<div class="line">    half *p_out = NULL;</div>
<div class="line">    half *header = NULL;</div>
<div class="line">    uint32_t total_out_count = 0;</div>
<div class="line">    uint32_t out_count = 0;</div>
<div class="line">    uint32_t i = 0, ind = 0;</div>
<div class="line">    int32_t w = 0, h = 0, ori_img_w = 0, ori_img_h = 0;</div>
<div class="line">    <span class="keywordtype">char</span> name_prob[128] = {0};</div>
<div class="line">    <span class="keywordtype">char</span> out_filename[FILENAME_LENGTH+32];</div>
<div class="line">    <span class="keywordtype">char</span> *dirc = NULL, *basec = NULL, *bname = NULL, *dname = NULL;</div>
<div class="line">    Mat ori_img;</div>
<div class="line">    Mat out_img;</div>
<div class="line"> </div>
<div class="line">    pnet = &amp;pctrl-&gt;net_pair[0];</div>
<div class="line">    h = pnet-&gt;net_in.in_desc[0].dim.height;</div>
<div class="line">    w = pnet-&gt;net_in.in_desc[0].dim.width;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (stat(in_filename, &amp;status) &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;stat&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Not found img file: %s\n&quot;</span>, in_filename);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ori_img = imread(in_filename, IMREAD_COLOR);</div>
<div class="line">    ori_img_h = ori_img.rows;</div>
<div class="line">    ori_img_w = ori_img.cols;</div>
<div class="line">    <span class="keywordflow">if</span> ((h != ori_img_h) || (w != ori_img_w)) {</div>
<div class="line">        resize(ori_img, out_img, Size(w, h), INTER_LINEAR);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        out_img = ori_img;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    header = out;</div>
<div class="line">    <span class="keywordflow">for</span> (ind = 0; ind &lt; n_classes; ind++) {</div>
<div class="line">        p_out = out + n_classes + total_out_count * 5;</div>
<div class="line">        out_count = (uint16_t) *header;</div>
<div class="line">        <span class="keywordflow">if</span> (out_count &gt; 0) {</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; out_count; i ++) {</div>
<div class="line">                rectangle(out_img, Point(p_out[5 * i], p_out[5 * i + 1]),</div>
<div class="line">                    Point(p_out[5 * i + 2], p_out[5 * i + 3]), COLORS[ind % NUM_COLORS], 2);</div>
<div class="line">                snprintf(name_prob, <span class="keyword">sizeof</span>(name_prob), <span class="stringliteral">&quot;%s(%.2f)&quot;</span>, class_names[ind], (<span class="keywordtype">float</span>)p_out[5 * i + 4]);</div>
<div class="line">                putText(out_img, name_prob, Point(p_out[5 * i], p_out[5 * i + 1] + 20),</div>
<div class="line">                    FONT_HERSHEY_COMPLEX, 0.5, COLORS[ind % NUM_COLORS], 1);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        total_out_count += NUM_POST_NMS_BBOX;</div>
<div class="line">        header++;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        dirc = strdup(in_filename);</div>
<div class="line">        <span class="keywordflow">if</span> (!dirc) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;strdup dir err\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        basec = strdup(in_filename);</div>
<div class="line">        <span class="keywordflow">if</span> (!basec) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;strdup base err\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        dname = dirname(dirc);</div>
<div class="line">        bname = basename(basec);</div>
<div class="line">        snprintf(out_filename, <span class="keyword">sizeof</span>(out_filename), <span class="stringliteral">&quot;%s/%s_%s&quot;</span>,</div>
<div class="line">            dname, PREFIX_STR, bname);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((h != ori_img_h) || (w != ori_img_w)) {</div>
<div class="line">            resize(out_img, ori_img, Size(ori_img_w, ori_img_h), INTER_LINEAR);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            ori_img = out_img;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (imwrite(out_filename, ori_img)) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Save bbox file %s done\n&quot;</span>, out_filename);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Save bbox file %s failed, please check write permission\n&quot;</span>, out_filename);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line">    <span class="keywordflow">if</span> (basec) {</div>
<div class="line">        free(basec);</div>
<div class="line">        basec = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (dirc) {</div>
<div class="line">        free(dirc);</div>
<div class="line">        dirc = NULL;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> *vp_stage_1_run_thd(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = (<span class="keyword">struct </span>nnctrl_param *)arg;</div>
<div class="line">    <span class="keywordtype">void</span> *ret = NULL;</div>
<div class="line">    uint32_t cnt = 0;</div>
<div class="line">    MEASURE_TIME_VAR();</div>
<div class="line">    uint8_t buf_idx = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (cnt = 0; pctrl-&gt;all_run_loop &amp;&amp; (cnt &lt; pctrl-&gt;all_inter_num); cnt++) {</div>
<div class="line">        sem_wait(&amp;pctrl-&gt;th_ipc.vp_stage_1_ready);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (pctrl-&gt;verbose) {</div>
<div class="line">            MEASURE_TIME_START(<span class="stringliteral">&quot;VP_1&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        pctrl-&gt;net_pair[0].net_out.out_desc[0].addr = pctrl-&gt;rpn_cls_m[buf_idx].phy_addr;</div>
<div class="line">        pctrl-&gt;net_pair[0].net_out.out_desc[1].addr = pctrl-&gt;rpn_bbox_m[buf_idx].phy_addr;</div>
<div class="line">        pctrl-&gt;net_pair[0].net_out.out_desc[2].addr = pctrl-&gt;concat_m[buf_idx].phy_addr;</div>
<div class="line">        ret = run_one_net(&amp;pctrl-&gt;net_pair[0]);</div>
<div class="line">        <span class="keywordflow">if</span> (ret == NULL) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;run_pvanet net idx: 0 err\n&quot;</span>);</div>
<div class="line">            pctrl-&gt;all_run_loop = 0;</div>
<div class="line">        }</div>
<div class="line">        printf (<span class="stringliteral">&quot;%u.VP_1\n&quot;</span>, (cnt + 1));</div>
<div class="line">        <span class="keywordflow">if</span> (pctrl-&gt;verbose) {</div>
<div class="line">            MEASURE_TIME_END(<span class="stringliteral">&quot;VP_1&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        sem_post(&amp;pctrl-&gt;th_ipc.vp_stage_1_done);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Ring Buffer */</span></div>
<div class="line">        buf_idx++;</div>
<div class="line">        <span class="keywordflow">if</span> (buf_idx == RINGBUF_NUM) {</div>
<div class="line">            buf_idx = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> arg;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> *vp_stage_2_run_thd(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define RCNN_CLS_STR &quot;rcnn_cls&quot;</span></div>
<div class="line"><span class="preprocessor">#define RCNN_BBOX_STR &quot;rcnn_bbox&quot;</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = (<span class="keyword">struct </span>nnctrl_param *)arg;</div>
<div class="line">    <span class="keywordtype">void</span> *ret = NULL;</div>
<div class="line">    uint32_t cnt = 0, n_rois = 0, size = 0;</div>
<div class="line">    uint32_t rcnn_cls_size = 0, rcnn_bbox_size = 0;</div>
<div class="line">    MEASURE_TIME_VAR();</div>
<div class="line">    uint8_t buf_idx = 0;</div>
<div class="line">    <span class="keywordtype">char</span> filename[FILENAME_LENGTH + 32] = {0};</div>
<div class="line"> </div>
<div class="line">    rcnn_cls_size = pctrl-&gt;net_pair[1].out_pair[0].data_size;</div>
<div class="line">    rcnn_bbox_size = pctrl-&gt;net_pair[1].out_pair[1].data_size;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (cnt = 0; pctrl-&gt;all_run_loop &amp;&amp; (cnt &lt; pctrl-&gt;all_inter_num); cnt++) {</div>
<div class="line">        sem_wait(&amp;pctrl-&gt;th_ipc.arm_stage_1_done);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (pctrl-&gt;verbose) {</div>
<div class="line">            MEASURE_TIME_START(<span class="stringliteral">&quot;VP_2&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        n_rois = pctrl-&gt;num_rois[buf_idx];</div>
<div class="line">        pctrl-&gt;net_pair[1].net_in.in_desc[0].addr = pctrl-&gt;roi_m[buf_idx].phy_addr;</div>
<div class="line">        pctrl-&gt;net_pair[1].net_out.out_desc[0].addr = pctrl-&gt;rcnn_cls_prob_m[buf_idx].phy_addr;</div>
<div class="line">        pctrl-&gt;net_pair[1].net_out.out_desc[1].addr = pctrl-&gt;rcnn_bbox_m[buf_idx].phy_addr;</div>
<div class="line">        pctrl-&gt;net_pair[1].net_rev.net_loop_cnt = n_rois;</div>
<div class="line">        ret = run_one_net(&amp;pctrl-&gt;net_pair[1]);</div>
<div class="line">        <span class="keywordflow">if</span> (ret == NULL) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;run_pvanet net idx: 1 err\n&quot;</span>);</div>
<div class="line">            pctrl-&gt;all_run_loop = 0;</div>
<div class="line">        }</div>
<div class="line">        printf (<span class="stringliteral">&quot;%u.VP_2\n&quot;</span>, (cnt + 1));</div>
<div class="line">        <span class="keywordflow">if</span> (pctrl-&gt;verbose) {</div>
<div class="line">            MEASURE_TIME_END(<span class="stringliteral">&quot;VP_2&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        sem_post(&amp;pctrl-&gt;th_ipc.vp_stage_2_done);</div>
<div class="line"> </div>
<div class="line">        sem_post(&amp;pctrl-&gt;th_ipc.vp_stage_1_ready);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* dump VP_2 output with ROIs_Num */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strlen(pctrl-&gt;path_dump_arm) &gt; 0) {</div>
<div class="line">            size = n_rois * rcnn_cls_size;</div>
<div class="line">            snprintf(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s/%s_%u.bin&quot;</span>,</div>
<div class="line">                pctrl-&gt;path_dump_arm, RCNN_CLS_STR, n_rois);</div>
<div class="line">            <span class="keywordflow">if</span> (store_file(filename, (uint8_t *)pctrl-&gt;rcnn_cls_prob_m[buf_idx].virt_addr, size) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Store rcnn_cls: %s err\n&quot;</span>, filename);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Store rcnn_cls: %s ok\n&quot;</span>, filename);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            size = n_rois * rcnn_bbox_size;</div>
<div class="line">            snprintf(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s/%s_%u.bin&quot;</span>,</div>
<div class="line">                pctrl-&gt;path_dump_arm, RCNN_BBOX_STR, n_rois);</div>
<div class="line">            <span class="keywordflow">if</span> (store_file(filename, (uint8_t *)pctrl-&gt;rcnn_bbox_m[buf_idx].virt_addr, size) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Store rcnn_bbox: %s err\n&quot;</span>, filename);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Store rcnn_bbox: %s ok\n&quot;</span>, filename);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Ring Buffer */</span></div>
<div class="line">        buf_idx++;</div>
<div class="line">        <span class="keywordflow">if</span> (buf_idx == RINGBUF_NUM) {</div>
<div class="line">            buf_idx = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> arg;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> *arm_stage_1_run_thd(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define ROIS_BBOX_STR &quot;rois_bbox&quot;</span></div>
<div class="line"><span class="preprocessor">#define ROI_POOLED_STR &quot;roi_pooled&quot;</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = (<span class="keyword">struct </span>nnctrl_param *)arg;</div>
<div class="line">    uint32_t cnt = 0, size = 0, n_rois = 0, roi_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    MEASURE_TIME_VAR();</div>
<div class="line">    uint8_t buf_idx = 0;</div>
<div class="line">    <span class="keywordtype">char</span> filename[FILENAME_LENGTH + 32] = {0};</div>
<div class="line"> </div>
<div class="line">    roi_size = pctrl-&gt;net_pair[1].in_pair[0].data_size;</div>
<div class="line">    <span class="keywordflow">for</span> (cnt = 0; pctrl-&gt;all_run_loop &amp;&amp; (cnt &lt; pctrl-&gt;all_inter_num); cnt++) {</div>
<div class="line">        sem_wait(&amp;pctrl-&gt;th_ipc.vp_stage_1_done);</div>
<div class="line"> </div>
<div class="line">        sem_wait(&amp;pctrl-&gt;th_ipc.arm_stage_1_ready);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (pctrl-&gt;verbose) {</div>
<div class="line">            MEASURE_TIME_START(<span class="stringliteral">&quot;ARM_1&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ret = <a id="a86" name="a86"></a><a class="code hl_function" href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga4a90dcbb2aa0b87f858270184bebd017">opt_layers_frcnn_pre_nms_roi</a>((half *)pctrl-&gt;rpn_cls_m[buf_idx].virt_addr,</div>
<div class="line">            (half *)pctrl-&gt;rpn_bbox_m[buf_idx].virt_addr,</div>
<div class="line">            (<a class="code hl_typedef" href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga18b7d2247a3a6b2e043cc350c4bc9362">fmap_t</a> *)pctrl-&gt;concat_m[buf_idx].virt_addr,</div>
<div class="line">            (<a class="code hl_typedef" href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga18b7d2247a3a6b2e043cc350c4bc9362">fmap_t</a> *)pctrl-&gt;roi_m[buf_idx].virt_addr,</div>
<div class="line">            (half *)pctrl-&gt;ext_m.nms_out[buf_idx]);</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;opt_layers_frcnn_pre_nms_roi err\n&quot;</span>);</div>
<div class="line">            pctrl-&gt;all_run_loop = 0;</div>
<div class="line">            pctrl-&gt;num_rois[buf_idx] = 0;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            pctrl-&gt;num_rois[buf_idx] = ret;</div>
<div class="line">        }</div>
<div class="line">        n_rois = pctrl-&gt;num_rois[buf_idx];</div>
<div class="line"> </div>
<div class="line">        sync_cache_mem(n_rois * roi_size, pctrl-&gt;roi_m[buf_idx].phy_addr, 1, 0);</div>
<div class="line">        printf (<span class="stringliteral">&quot;%u.ARM_1, NMS out ROIs Num: %u\n&quot;</span>, (cnt + 1), n_rois);</div>
<div class="line">        <span class="keywordflow">if</span> (pctrl-&gt;verbose) {</div>
<div class="line">            MEASURE_TIME_END(<span class="stringliteral">&quot;ARM_1&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        sem_post(&amp;pctrl-&gt;th_ipc.arm_stage_1_done);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* dump ARM_1 output */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strlen(pctrl-&gt;path_dump_arm) &gt; 0) {</div>
<div class="line"> </div>
<div class="line">            size = n_rois * 4 * <span class="keyword">sizeof</span>(half);</div>
<div class="line">            snprintf(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s/%s_%u.bin&quot;</span>,</div>
<div class="line">                pctrl-&gt;path_dump_arm, ROIS_BBOX_STR, n_rois);</div>
<div class="line">            <span class="keywordflow">if</span> (store_file(filename, (uint8_t *)pctrl-&gt;ext_m.nms_out[buf_idx], size) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Store rois_bbox: %s err\n&quot;</span>, filename);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Store rois_bbox: %s ok\n&quot;</span>, filename);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            size = n_rois * pctrl-&gt;net_pair[1].in_pair[0].data_size;</div>
<div class="line">            snprintf(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s/%s_%u.bin&quot;</span>,</div>
<div class="line">                pctrl-&gt;path_dump_arm, ROI_POOLED_STR, n_rois);</div>
<div class="line">            <span class="keywordflow">if</span> (store_file(filename, pctrl-&gt;roi_m[buf_idx].virt_addr, size) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Store roi_pooled: %s err\n&quot;</span>, filename);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Store roi_pooled: %s ok\n&quot;</span>, filename);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Ring Buffer */</span></div>
<div class="line">        buf_idx++;</div>
<div class="line">        <span class="keywordflow">if</span> (buf_idx == RINGBUF_NUM) {</div>
<div class="line">            buf_idx = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> arg;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> *show_result(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = (<span class="keyword">struct </span>nnctrl_param *)arg;</div>
<div class="line">    uint32_t cnt = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (cnt = 0; pctrl-&gt;all_run_loop &amp;&amp; (cnt &lt; pctrl-&gt;all_inter_num); cnt++) {</div>
<div class="line">        sem_wait(&amp;pctrl-&gt;th_ipc.arm_stage_2_done);</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Iteration Num: %u\n&quot;</span>, (cnt + 1));</div>
<div class="line">        show_bbox_result(pctrl-&gt;ext_m.bbox_out, N_CLASSES);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> arg;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> run_pvanet(<span class="keyword">struct</span> nnctrl_param *pctrl)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define TNUM (4)</span></div>
<div class="line"> </div>
<div class="line">    pthread_t tid[TNUM];</div>
<div class="line">    uint32_t cnt = 0, i = 0, j = 0, n_rois = 0;</div>
<div class="line">    uint32_t rcnn_cls_size = 0, rcnn_bbox_size = 0;</div>
<div class="line">    <span class="keywordtype">int</span> ret_t[TNUM] = {-1};</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line">    MEASURE_TIME_VAR();</div>
<div class="line">    <span class="keyword">struct </span>timeval tv_1, tv_2;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tv_us = 0;</div>
<div class="line">    uint8_t buf_idx = 0;</div>
<div class="line"> </div>
<div class="line">    rcnn_cls_size = pctrl-&gt;net_pair[1].out_pair[0].data_size;</div>
<div class="line">    rcnn_bbox_size = pctrl-&gt;net_pair[1].out_pair[1].data_size;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        ret_t[0] = pthread_create(&amp;tid[0], NULL, vp_stage_1_run_thd, pctrl);</div>
<div class="line">        <span class="keywordflow">if</span> (ret_t[0]) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;pthread_create vp_stage_1&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        ret_t[1] = pthread_create(&amp;tid[1], NULL, vp_stage_2_run_thd, pctrl);</div>
<div class="line">        <span class="keywordflow">if</span> (ret_t[1]) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;pthread_create vp_stage_2&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ret_t[2] = pthread_create(&amp;tid[2], NULL, arm_stage_1_run_thd, pctrl);</div>
<div class="line">        <span class="keywordflow">if</span> (ret_t[2]) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;pthread_create arm_stage_1&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ret_t[3] = pthread_create(&amp;tid[3], NULL, show_result, pctrl);</div>
<div class="line">        <span class="keywordflow">if</span> (ret_t[3]) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;pthread_create show_result&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (pctrl-&gt;pipeline_en_flag) {</div>
<div class="line">            j = 2;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            j = 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (cnt = 0; cnt &lt; j; cnt++) {</div>
<div class="line">            sem_post(&amp;pctrl-&gt;th_ipc.arm_stage_1_ready);</div>
<div class="line">            sem_post(&amp;pctrl-&gt;th_ipc.vp_stage_1_ready);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        gettimeofday(&amp;tv_1, NULL);</div>
<div class="line">        <span class="keywordflow">for</span> (cnt = 0; pctrl-&gt;all_run_loop &amp;&amp; (cnt &lt; pctrl-&gt;all_inter_num); cnt++) {</div>
<div class="line">            <span class="comment">/* ARM_stage_2 */</span></div>
<div class="line">            sem_wait(&amp;pctrl-&gt;th_ipc.vp_stage_2_done);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (pctrl-&gt;verbose) {</div>
<div class="line">                MEASURE_TIME_START(<span class="stringliteral">&quot;ARM_2&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            n_rois = pctrl-&gt;num_rois[buf_idx];</div>
<div class="line">            sync_cache_mem(n_rois * rcnn_cls_size,</div>
<div class="line">                pctrl-&gt;rcnn_cls_prob_m[buf_idx].phy_addr, 0, 1);</div>
<div class="line">            sync_cache_mem(n_rois * rcnn_bbox_size,</div>
<div class="line">                pctrl-&gt;rcnn_bbox_m[buf_idx].phy_addr, 0, 1);</div>
<div class="line"> </div>
<div class="line">            <a id="a87" name="a87"></a><a class="code hl_function" href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga8f52a44895bec2115084f2fb0f7337ff">opt_layers_frcnn_post_nms</a>(</div>
<div class="line">                (half *)pctrl-&gt;rcnn_cls_prob_m[buf_idx].virt_addr,</div>
<div class="line">                (half *)pctrl-&gt;rcnn_bbox_m[buf_idx].virt_addr,</div>
<div class="line">                pctrl-&gt;ext_m.nms_out[buf_idx],</div>
<div class="line">                pctrl-&gt;ext_m.bbox_out,</div>
<div class="line">                n_rois);</div>
<div class="line"> </div>
<div class="line">            printf (<span class="stringliteral">&quot;%u.ARM_2\n&quot;</span>, (cnt + 1));</div>
<div class="line">            <span class="keywordflow">if</span> (pctrl-&gt;verbose) {</div>
<div class="line">                MEASURE_TIME_END(<span class="stringliteral">&quot;ARM_2&quot;</span>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            sem_post(&amp;pctrl-&gt;th_ipc.arm_stage_2_done);</div>
<div class="line"> </div>
<div class="line">            sem_post(&amp;pctrl-&gt;th_ipc.arm_stage_1_ready);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* Ring Buffer */</span></div>
<div class="line">            buf_idx++;</div>
<div class="line">            <span class="keywordflow">if</span> (buf_idx == RINGBUF_NUM) {</div>
<div class="line">                buf_idx = 0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        gettimeofday(&amp;tv_2, NULL);</div>
<div class="line">        tv_us = (<span class="keywordtype">unsigned</span> long) 1000000 * (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) (tv_2.tv_sec - tv_1.tv_sec) +</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) (tv_2.tv_usec - tv_1.tv_usec);</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; TNUM; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (ret_t[i] == 0) {</div>
<div class="line">            pthread_join(tid[i], NULL);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!rval) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Total_num: %u, total_time: %lu us, avg_time: %lu us\n&quot;</span>,</div>
<div class="line">            cnt, tv_us, tv_us/cnt);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> start_all_nets(<span class="keyword">struct</span> nnctrl_param *pctrl)</div>
<div class="line">{</div>
<div class="line">    uint32_t done_num = 0;</div>
<div class="line">    <span class="keywordtype">int</span> net_num = 0;</div>
<div class="line">    <span class="keywordtype">int</span> idx = 0, rval = 0;</div>
<div class="line"> </div>
<div class="line">    net_num = pctrl-&gt;net_num;</div>
<div class="line">    <span class="keywordflow">if</span> (net_num != 2) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;PVANnet shold specify two &lt;cavalry_gen&gt;.bin\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (idx = 0; idx &lt; net_num; idx++) {</div>
<div class="line">        pctrl-&gt;net_pair[idx].print_time= pctrl-&gt;all_print_time;</div>
<div class="line">        pctrl-&gt;net_pair[idx].iter_num = 1;</div>
<div class="line">        <span class="keywordflow">if</span> (init_one_net(pctrl, idx) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;start one net idx [%u] err\n&quot;</span>, idx);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        done_num++;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (init_opt_layers_lib() &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;init opt layers err\n&quot;</span>);</div>
<div class="line">        rval = -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (rval == 0) {</div>
<div class="line">        rval = run_pvanet(pctrl);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (done_num &gt; 0) {</div>
<div class="line">        <span class="keywordflow">for</span> (idx = (done_num -1); idx &gt;= 0; idx--) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a id="a88" name="a88"></a><a class="code hl_function" href="../../dd/da5/group__nnctrl-api-details.html#gaa2441a5c368143831d587ed6a4412549">nnctrl_exit_net</a>(pctrl-&gt;net_pair[idx].net_id) &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;exit net idx [%u] err\n&quot;</span>, idx);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_nnctrl_lib(<span class="keyword">struct</span> nnctrl_param *pctrl)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a id="_a89" name="_a89"></a><a class="code hl_struct" href="../../d1/d44/structnnctrl__version.html">nnctrl_version</a> ver;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a90" name="a90"></a><a class="code hl_function" href="../../dd/da5/group__nnctrl-api-details.html#ga945387bab991147baebaf92cf47389cd">nnctrl_get_version</a>(&amp;ver) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;nnctrl get version err&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a id="a91" name="a91"></a><a class="code hl_function" href="../../dd/da5/group__nnctrl-api-details.html#ga91383318499db0b0e6a998e6608a8916">nnctrl_init</a>(pctrl-&gt;fd_cav, 0) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;nnctrl_init err\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Total neural network num: %d\n&quot;</span>, pctrl-&gt;net_num);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> init_thread_ipc(<span class="keyword">struct</span> thread_ipc *ipc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (sem_init(&amp;ipc-&gt;vp_stage_1_ready, 0, 0)) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;sem_init&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (sem_init(&amp;ipc-&gt;arm_stage_1_ready, 0, 0)) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;sem_init&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (sem_init(&amp;ipc-&gt;vp_stage_1_done, 0, 0)) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;sem_init&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (sem_init(&amp;ipc-&gt;arm_stage_1_done, 0, 0)) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;sem_init&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (sem_init(&amp;ipc-&gt;vp_stage_2_done, 0, 0)) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;sem_init&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (sem_init(&amp;ipc-&gt;arm_stage_2_done, 0, 0)) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;sem_init&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> destory_thread_ipc(<span class="keyword">struct</span> thread_ipc *ipc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (sem_destroy(&amp;ipc-&gt;arm_stage_2_done)) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;sem_destroy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (sem_destroy(&amp;ipc-&gt;vp_stage_2_done)) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;sem_destroy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (sem_destroy(&amp;ipc-&gt;arm_stage_1_done)) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;sem_destroy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (sem_destroy(&amp;ipc-&gt;vp_stage_1_done)) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;sem_destroy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (sem_destroy(&amp;ipc-&gt;arm_stage_1_ready)) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;sem_destroy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (sem_destroy(&amp;ipc-&gt;vp_stage_1_ready)) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;sem_destroy&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sigstop(<span class="keywordtype">int</span> arg)</div>
<div class="line">{</div>
<div class="line">    G_nnctrl.all_run_loop = 0;</div>
<div class="line">    printf(<span class="stringliteral">&quot;sigstop msg\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a92" name="a92"></a><a class="code hl_function" href="../../dc/d60/test__smartfb_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>nnctrl_param *pctrl = &amp;G_nnctrl;</div>
<div class="line">    <span class="keywordtype">int</span> rval = 0;</div>
<div class="line"> </div>
<div class="line">    signal(SIGINT, sigstop);</div>
<div class="line">    signal(SIGQUIT, sigstop);</div>
<div class="line">    signal(SIGTERM, sigstop);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        <a class="code hl_function" href="../../dc/d60/test__smartfb_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>();</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset((<span class="keywordtype">void</span> *)pctrl, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> nnctrl_param));</div>
<div class="line">    pctrl-&gt;all_inter_num = 1; <span class="comment">/* Set iteration to 1 by default */</span></div>
<div class="line">    pctrl-&gt;all_run_loop = 1;</div>
<div class="line">    pctrl-&gt;pipeline_en_flag = 1; <span class="comment">/* Set pipeline enable by default */</span></div>
<div class="line">    pctrl-&gt;thpool_num = 4; <span class="comment">/* Set thread num to 4 by default */</span></div>
<div class="line">    pctrl-&gt;cls_threshold = CLS_PROB_THRESHOLD;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (init_param(argc, argv) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pctrl-&gt;fd_cav = open(CAVALRY_DEV_NODE, O_RDWR, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (pctrl-&gt;fd_cav &lt; 0) {</div>
<div class="line">        perror(CAVALRY_DEV_NODE);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (<a id="a93" name="a93"></a><a class="code hl_function" href="../../d3/dbf/group__cavalry__mem-api-details.html#ga201938043385c5764ad3e2f4df21343d">cavalry_mem_init</a>(pctrl-&gt;fd_cav, 0) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;cavalry_mem_init err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (init_nnctrl_lib(pctrl) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;init nnctrl lib err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (init_thread_ipc(&amp;pctrl-&gt;th_ipc) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;init thread ipc err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (start_all_nets(pctrl) &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;start all nets err\n&quot;</span>);</div>
<div class="line">            rval = -1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((pctrl-&gt;save_img_flag) &amp;&amp; (!rval)) {</div>
<div class="line">            draw_bbox_img(pctrl-&gt;ext_m.bbox_out, N_CLASSES,</div>
<div class="line">                pctrl-&gt;output_img_name);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    destory_thread_ipc(&amp;pctrl-&gt;th_ipc);</div>
<div class="line"> </div>
<div class="line">    <a id="a94" name="a94"></a><a class="code hl_function" href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga2cb6fde258756029b84bd718034a7658">opt_layers_frcnn_exit</a>();</div>
<div class="line">    free_all_alloc_mem(pctrl);</div>
<div class="line">    free_all_cv_mem(pctrl);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (pctrl-&gt;fd_cav &gt;= 0) {</div>
<div class="line">        close(pctrl-&gt;fd_cav);</div>
<div class="line">        pctrl-&gt;fd_cav = -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div><div class="ttdef"><b>Definition:</b> cJSON.h:264</div></div>
<div class="ttc" id="acJSON_8h_html_aa813b2b7bde1a5a1f528cd9d9aa9ee7d"><div class="ttname"><a href="../../d1/d82/cJSON_8h.html#aa813b2b7bde1a5a1f528cd9d9aa9ee7d">fmt</a></div><div class="ttdeci">int cJSON_bool fmt</div><div class="ttdef"><b>Definition:</b> cJSON.h:160</div></div>
<div class="ttc" id="acavalry__mem_8h_html"><div class="ttname"><a href="../../de/db0/cavalry__mem_8h.html">cavalry_mem.h</a></div></div>
<div class="ttc" id="adata__fmt_8h_html"><div class="ttname"><a href="../../db/dda/data__fmt_8h.html">data_fmt.h</a></div></div>
<div class="ttc" id="agroup__cavalry__mem-api-details_html_ga201938043385c5764ad3e2f4df21343d"><div class="ttname"><a href="../../d3/dbf/group__cavalry__mem-api-details.html#ga201938043385c5764ad3e2f4df21343d">cavalry_mem_init</a></div><div class="ttdeci">AMBA_API int cavalry_mem_init(IN int fd_cav, IN uint8_t verbose)</div></div>
<div class="ttc" id="agroup__cavalry__mem-api-details_html_ga78fe436b7764d49520410be725783432"><div class="ttname"><a href="../../d3/dbf/group__cavalry__mem-api-details.html#ga78fe436b7764d49520410be725783432">cavalry_mem_alloc</a></div><div class="ttdeci">AMBA_API int cavalry_mem_alloc(IN unsigned long *psize, OUT unsigned long *pphys, OUT void **pvirt, IN uint8_t cache_en)</div></div>
<div class="ttc" id="agroup__cavalry__mem-api-details_html_gae5462177e0abc1ff7de5a4e5932d9e34"><div class="ttname"><a href="../../d3/dbf/group__cavalry__mem-api-details.html#gae5462177e0abc1ff7de5a4e5932d9e34">cavalry_mem_sync_cache</a></div><div class="ttdeci">AMBA_API int cavalry_mem_sync_cache(IN unsigned long size, IN unsigned long phys, IN uint8_t clean, IN uint8_t invalid)</div></div>
<div class="ttc" id="agroup__cavalry__mem-api-details_html_gae80d26c23fcc3eb0f578f32647f90a7a"><div class="ttname"><a href="../../d3/dbf/group__cavalry__mem-api-details.html#gae80d26c23fcc3eb0f578f32647f90a7a">cavalry_mem_free</a></div><div class="ttdeci">AMBA_API int cavalry_mem_free(IN unsigned long size, IN unsigned long phys, IN void *virt)</div></div>
<div class="ttc" id="agroup__cavalry__opt__layers-api-details_html_ga18b7d2247a3a6b2e043cc350c4bc9362"><div class="ttname"><a href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga18b7d2247a3a6b2e043cc350c4bc9362">fmap_t</a></div><div class="ttdeci">uint16_t fmap_t</div><div class="ttdoc">The feature map data type.</div><div class="ttdef"><b>Definition:</b> data_fmt.h:50</div></div>
<div class="ttc" id="agroup__cavalry__opt__layers-api-details_html_ga1f283dc0114cf1a5b0494d6c3a9e61cb"><div class="ttname"><a href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga1f283dc0114cf1a5b0494d6c3a9e61cb">opt_layers_get_version</a></div><div class="ttdeci">AMBA_API int opt_layers_get_version(OUT struct opt_layers_version *ver)</div></div>
<div class="ttc" id="agroup__cavalry__opt__layers-api-details_html_ga2cb6fde258756029b84bd718034a7658"><div class="ttname"><a href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga2cb6fde258756029b84bd718034a7658">opt_layers_frcnn_exit</a></div><div class="ttdeci">AMBA_API void opt_layers_frcnn_exit(void)</div></div>
<div class="ttc" id="agroup__cavalry__opt__layers-api-details_html_ga4a90dcbb2aa0b87f858270184bebd017"><div class="ttname"><a href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga4a90dcbb2aa0b87f858270184bebd017">opt_layers_frcnn_pre_nms_roi</a></div><div class="ttdeci">AMBA_API int opt_layers_frcnn_pre_nms_roi(IN half *rpn_cls_score, IN half *rpn_bbox, IN fmap_t *rpn_fmap, OUT fmap_t *roi_out, OUT half *nms_out)</div></div>
<div class="ttc" id="agroup__cavalry__opt__layers-api-details_html_ga5095956a02846240c0402fbffefde73d"><div class="ttname"><a href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga5095956a02846240c0402fbffefde73d">opt_layers_frcnn_init</a></div><div class="ttdeci">AMBA_API int opt_layers_frcnn_init(IN struct frcnn_desc *desc, IN float *anchors_array)</div></div>
<div class="ttc" id="agroup__cavalry__opt__layers-api-details_html_ga8f52a44895bec2115084f2fb0f7337ff"><div class="ttname"><a href="../../da/dae/group__cavalry__opt__layers-api-details.html#ga8f52a44895bec2115084f2fb0f7337ff">opt_layers_frcnn_post_nms</a></div><div class="ttdeci">AMBA_API int opt_layers_frcnn_post_nms(IN half *rcnn_cls_prob, IN half *rcnn_bbox, IN half *nms_out, OUT half *bbox_result, IN uint32_t num_rois)</div></div>
<div class="ttc" id="agroup__nnctrl-api-details_html_ga12db598f56dd9956a8bd54ea4533c95c"><div class="ttname"><a href="../../dd/da5/group__nnctrl-api-details.html#ga12db598f56dd9956a8bd54ea4533c95c">nnctrl_resume_net</a></div><div class="ttdeci">AMBA_API int nnctrl_resume_net(IN int net_id, OUT struct net_result *net_ret)</div></div>
<div class="ttc" id="agroup__nnctrl-api-details_html_ga1979e4b7a487fba5776122920fa01a0d"><div class="ttname"><a href="../../dd/da5/group__nnctrl-api-details.html#ga1979e4b7a487fba5776122920fa01a0d">nnctrl_init_net</a></div><div class="ttdeci">AMBA_API int nnctrl_init_net(INOUT struct net_cfg *net_cf, INOUT struct net_input_cfg *net_in, INOUT struct net_output_cfg *net_out)</div></div>
<div class="ttc" id="agroup__nnctrl-api-details_html_ga22348832dabd8161328a34f9892f93e0"><div class="ttname"><a href="../../dd/da5/group__nnctrl-api-details.html#ga22348832dabd8161328a34f9892f93e0">nnctrl_run_net</a></div><div class="ttdeci">AMBA_API int nnctrl_run_net(IN int net_id, OUT struct net_result *net_ret, IN struct net_run_cfg *net_run, IN struct net_input_cfg *net_in, IN struct net_output_cfg *net_out)</div></div>
<div class="ttc" id="agroup__nnctrl-api-details_html_ga40ea8c04b3430d95b1b4921160bf44cc"><div class="ttname"><a href="../../dd/da5/group__nnctrl-api-details.html#ga40ea8c04b3430d95b1b4921160bf44cc">nnctrl_load_net</a></div><div class="ttdeci">AMBA_API int nnctrl_load_net(IN int net_id, IN struct net_mem *net_m, INOUT struct net_input_cfg *net_in, INOUT struct net_output_cfg *net_out)</div></div>
<div class="ttc" id="agroup__nnctrl-api-details_html_ga91383318499db0b0e6a998e6608a8916"><div class="ttname"><a href="../../dd/da5/group__nnctrl-api-details.html#ga91383318499db0b0e6a998e6608a8916">nnctrl_init</a></div><div class="ttdeci">AMBA_API int nnctrl_init(IN int fd_cav, IN uint8_t verbose)</div></div>
<div class="ttc" id="agroup__nnctrl-api-details_html_ga945387bab991147baebaf92cf47389cd"><div class="ttname"><a href="../../dd/da5/group__nnctrl-api-details.html#ga945387bab991147baebaf92cf47389cd">nnctrl_get_version</a></div><div class="ttdeci">AMBA_API int nnctrl_get_version(OUT struct nnctrl_version *ver)</div></div>
<div class="ttc" id="agroup__nnctrl-api-details_html_ga964c3b506357a71707479d55a0af66f6"><div class="ttname"><a href="../../dd/da5/group__nnctrl-api-details.html#ga964c3b506357a71707479d55a0af66f6">nnctrl_dump_net</a></div><div class="ttdeci">AMBA_API int nnctrl_dump_net(IN int net_id, IN const char *path)</div></div>
<div class="ttc" id="agroup__nnctrl-api-details_html_gaa2441a5c368143831d587ed6a4412549"><div class="ttname"><a href="../../dd/da5/group__nnctrl-api-details.html#gaa2441a5c368143831d587ed6a4412549">nnctrl_exit_net</a></div><div class="ttdeci">AMBA_API int nnctrl_exit_net(IN int net_id)</div></div>
<div class="ttc" id="agroup__nnctrl-helper_html_ga0e2b8805187717eb546342bcea70a22a"><div class="ttname"><a href="../../d9/d50/group__nnctrl-helper.html#ga0e2b8805187717eb546342bcea70a22a">MAX_IO_NUM</a></div><div class="ttdeci">#define MAX_IO_NUM</div><div class="ttdoc">define max number of network's port (input and output)</div><div class="ttdef"><b>Definition:</b> nnctrl.h:399</div></div>
<div class="ttc" id="annctrl_8h_html"><div class="ttname"><a href="../../db/d9f/nnctrl_8h.html">nnctrl.h</a></div></div>
<div class="ttc" id="aopt__layers_8hpp_html"><div class="ttname"><a href="../../d7/d58/opt__layers_8hpp.html">opt_layers.hpp</a></div></div>
<div class="ttc" id="astructfrcnn__desc_html"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html">frcnn_desc</a></div><div class="ttdoc">The network of Faster-RCNN configuration in initialization.</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:96</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a15c7fce50178b2c6e2e4dcb42e0c1f0c"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a15c7fce50178b2c6e2e4dcb42e0c1f0c">frcnn_desc::verbose</a></div><div class="ttdeci">uint8_t verbose</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:100</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a266046be9a17a34f8358285d68a0d21e"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a266046be9a17a34f8358285d68a0d21e">frcnn_desc::pooled_pitch</a></div><div class="ttdeci">uint32_t pooled_pitch</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:139</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a2e01c7302817b385f25c138d5d73f49a"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a2e01c7302817b385f25c138d5d73f49a">frcnn_desc::rpn_bbox_pitch</a></div><div class="ttdeci">uint32_t rpn_bbox_pitch</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:133</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a431c1a52143e011627460aba8f5e5b7d"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a431c1a52143e011627460aba8f5e5b7d">frcnn_desc::img_height</a></div><div class="ttdeci">uint32_t img_height</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:123</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a4bf6a689494bf7b2fc68686c4df2682f"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a4bf6a689494bf7b2fc68686c4df2682f">frcnn_desc::bbox_min_size</a></div><div class="ttdeci">uint32_t bbox_min_size</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:135</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a4eb23d978e08723800d01eda0d1f7867"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a4eb23d978e08723800d01eda0d1f7867">frcnn_desc::fmap_pitch</a></div><div class="ttdeci">uint32_t fmap_pitch</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:131</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a53c9bc862e062f98174547c23025bedf"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a53c9bc862e062f98174547c23025bedf">frcnn_desc::fmap_width</a></div><div class="ttdeci">uint32_t fmap_width</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:130</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a56f2ba2fbd31d46bc729cbb997fc18e3"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a56f2ba2fbd31d46bc729cbb997fc18e3">frcnn_desc::rpn_cls_pitch</a></div><div class="ttdeci">uint32_t rpn_cls_pitch</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:134</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a577eb7b3aba727e565f9235822a3acd1"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a577eb7b3aba727e565f9235822a3acd1">frcnn_desc::iou_pre_rpn_threshold</a></div><div class="ttdeci">float iou_pre_rpn_threshold</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:144</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a582bac1b6223ef1ebc7e243b42463604"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a582bac1b6223ef1ebc7e243b42463604">frcnn_desc::thread_num</a></div><div class="ttdeci">uint8_t thread_num</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:97</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a5c196e032bb0427f79edcaa00f1fe793"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a5c196e032bb0427f79edcaa00f1fe793">frcnn_desc::fmap_depth</a></div><div class="ttdeci">uint32_t fmap_depth</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:128</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a5f1908390975de96487e6acadbf552dd"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a5f1908390975de96487e6acadbf552dd">frcnn_desc::pooled_width</a></div><div class="ttdeci">uint32_t pooled_width</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:138</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a64fab2121d684b52f12a717b85654729"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a64fab2121d684b52f12a717b85654729">frcnn_desc::num_pre_nms_bbox</a></div><div class="ttdeci">uint32_t num_pre_nms_bbox</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:119</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a69b0210fc2c018f602414120ffeff00c"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a69b0210fc2c018f602414120ffeff00c">frcnn_desc::rcnn_bbox_pitch</a></div><div class="ttdeci">uint32_t rcnn_bbox_pitch</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:141</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a6bd12a72f30c6d78cd1bfc33c921edb4"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a6bd12a72f30c6d78cd1bfc33c921edb4">frcnn_desc::fmap_sign</a></div><div class="ttdeci">uint8_t fmap_sign</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:101</div></div>
<div class="ttc" id="astructfrcnn__desc_html_a7ca3a7aadb30f671947e9fd4d829cd41"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#a7ca3a7aadb30f671947e9fd4d829cd41">frcnn_desc::img_width</a></div><div class="ttdeci">uint32_t img_width</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:124</div></div>
<div class="ttc" id="astructfrcnn__desc_html_aa11b0eefae314af7530e003acfcf7d69"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#aa11b0eefae314af7530e003acfcf7d69">frcnn_desc::iou_post_rcnn_threshold</a></div><div class="ttdeci">float iou_post_rcnn_threshold</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:145</div></div>
<div class="ttc" id="astructfrcnn__desc_html_aab0d57aa773525a7ae83fad3c72c01ac"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#aab0d57aa773525a7ae83fad3c72c01ac">frcnn_desc::num_post_nms_bbox</a></div><div class="ttdeci">uint32_t num_post_nms_bbox</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:120</div></div>
<div class="ttc" id="astructfrcnn__desc_html_aac475ad5fd925c09c1e056a5865bd8c0"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#aac475ad5fd925c09c1e056a5865bd8c0">frcnn_desc::num_classes</a></div><div class="ttdeci">uint32_t num_classes</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:121</div></div>
<div class="ttc" id="astructfrcnn__desc_html_aad29c63fa1eb6281ef264c413e9b124f"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#aad29c63fa1eb6281ef264c413e9b124f">frcnn_desc::rcnn_cls_pitch</a></div><div class="ttdeci">uint32_t rcnn_cls_pitch</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:142</div></div>
<div class="ttc" id="astructfrcnn__desc_html_ab3360db9380d3f908efd8fb6d8c0db6c"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#ab3360db9380d3f908efd8fb6d8c0db6c">frcnn_desc::fmap_scale</a></div><div class="ttdeci">uint32_t fmap_scale</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:126</div></div>
<div class="ttc" id="astructfrcnn__desc_html_acd0fea60ef48bbd685b5b858bf3f578b"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#acd0fea60ef48bbd685b5b858bf3f578b">frcnn_desc::fmap_height</a></div><div class="ttdeci">uint32_t fmap_height</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:129</div></div>
<div class="ttc" id="astructfrcnn__desc_html_acf87702e36ef3a7e8fb36f292c400299"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#acf87702e36ef3a7e8fb36f292c400299">frcnn_desc::cls_prob_threshold</a></div><div class="ttdeci">float cls_prob_threshold</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:146</div></div>
<div class="ttc" id="astructfrcnn__desc_html_ae664ac0bccf21fb86f6a8af7e2d23001"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#ae664ac0bccf21fb86f6a8af7e2d23001">frcnn_desc::num_anchor</a></div><div class="ttdeci">uint32_t num_anchor</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:118</div></div>
<div class="ttc" id="astructfrcnn__desc_html_aebcba508bbf559eb92f0adc6c579042b"><div class="ttname"><a href="../../de/d21/structfrcnn__desc.html#aebcba508bbf559eb92f0adc6c579042b">frcnn_desc::pooled_height</a></div><div class="ttdeci">uint32_t pooled_height</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:137</div></div>
<div class="ttc" id="astructhint__s_html"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html">hint_s</a></div></div>
<div class="ttc" id="astructhint__s_html_a2799cca21c05a4f99f4c8b3b178d0133"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#a2799cca21c05a4f99f4c8b3b178d0133">hint_s::str</a></div><div class="ttdeci">const char * str</div></div>
<div class="ttc" id="astructhint__s_html_aa56a50443afd9d2f7cf738fb7ffba168"><div class="ttname"><a href="../../../video/d2/d4b/structhint__s.html#aa56a50443afd9d2f7cf738fb7ffba168">hint_s::arg</a></div><div class="ttdeci">const char * arg</div></div>
<div class="ttc" id="astructinput__desc_html_a05b251f6f4721e4b738a9439a7eda472"><div class="ttname"><a href="../../d2/d45/structinput__desc.html#a05b251f6f4721e4b738a9439a7eda472">input_desc::no_mem</a></div><div class="ttdeci">IN uint32_t no_mem</div><div class="ttdef"><b>Definition:</b> nnctrl.h:290</div></div>
<div class="ttc" id="astructinput__desc_html_a32bea48d7aa93b31ae10943c1ba552ec"><div class="ttname"><a href="../../d2/d45/structinput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">input_desc::dim</a></div><div class="ttdeci">OUT struct io_dim dim</div><div class="ttdef"><b>Definition:</b> nnctrl.h:302</div></div>
<div class="ttc" id="astructinput__desc_html_a333fd20f0a0fe19d88d0a2ad740e9003"><div class="ttname"><a href="../../d2/d45/structinput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">input_desc::data_fmt</a></div><div class="ttdeci">OUT struct io_data_fmt data_fmt</div><div class="ttdef"><b>Definition:</b> nnctrl.h:303</div></div>
<div class="ttc" id="astructinput__desc_html_a7dc04adf5758857da0cf009c816560de"><div class="ttname"><a href="../../d2/d45/structinput__desc.html#a7dc04adf5758857da0cf009c816560de">input_desc::addr</a></div><div class="ttdeci">INOUT cv_daddr_t addr</div><div class="ttdef"><b>Definition:</b> nnctrl.h:286</div></div>
<div class="ttc" id="astructinput__desc_html_a8b1c668d1a96dde72c36f17898ae9e51"><div class="ttname"><a href="../../d2/d45/structinput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">input_desc::name</a></div><div class="ttdeci">INOUT const char * name</div><div class="ttdef"><b>Definition:</b> nnctrl.h:283</div></div>
<div class="ttc" id="astructinput__desc_html_abe4e3181b6f9f9243f03829322d3e235"><div class="ttname"><a href="../../d2/d45/structinput__desc.html#abe4e3181b6f9f9243f03829322d3e235">input_desc::size</a></div><div class="ttdeci">OUT unsigned long size</div><div class="ttdef"><b>Definition:</b> nnctrl.h:288</div></div>
<div class="ttc" id="astructio__data__fmt_html"><div class="ttname"><a href="../../d8/d06/structio__data__fmt.html">io_data_fmt</a></div><div class="ttdoc">The io data format description.</div><div class="ttdef"><b>Definition:</b> nnctrl.h:257</div></div>
<div class="ttc" id="astructio__data__fmt_html_a0e0ace816facf5d8b503eb83e8e798b8"><div class="ttname"><a href="../../d8/d06/structio__data__fmt.html#a0e0ace816facf5d8b503eb83e8e798b8">io_data_fmt::sign</a></div><div class="ttdeci">uint8_t sign</div><div class="ttdef"><b>Definition:</b> nnctrl.h:258</div></div>
<div class="ttc" id="astructio__data__fmt_html_a375c68753379e89f4548d93e5e41d41d"><div class="ttname"><a href="../../d8/d06/structio__data__fmt.html#a375c68753379e89f4548d93e5e41d41d">io_data_fmt::expoffset</a></div><div class="ttdeci">int8_t expoffset</div><div class="ttdef"><b>Definition:</b> nnctrl.h:260</div></div>
<div class="ttc" id="astructio__data__fmt_html_ad9cd444e0d5bf7539865ca6dc194d92e"><div class="ttname"><a href="../../d8/d06/structio__data__fmt.html#ad9cd444e0d5bf7539865ca6dc194d92e">io_data_fmt::expbits</a></div><div class="ttdeci">uint8_t expbits</div><div class="ttdef"><b>Definition:</b> nnctrl.h:261</div></div>
<div class="ttc" id="astructio__data__fmt_html_ae5dc6ffcd9b7605c7787791e40cc6bb0"><div class="ttname"><a href="../../d8/d06/structio__data__fmt.html#ae5dc6ffcd9b7605c7787791e40cc6bb0">io_data_fmt::size</a></div><div class="ttdeci">uint8_t size</div><div class="ttdef"><b>Definition:</b> nnctrl.h:259</div></div>
<div class="ttc" id="astructio__dim_html"><div class="ttname"><a href="../../db/de7/structio__dim.html">io_dim</a></div><div class="ttdoc">The io dimension description.</div><div class="ttdef"><b>Definition:</b> nnctrl.h:234</div></div>
<div class="ttc" id="astructio__dim_html_a2a80572814f32a23139da84a214f3e7e"><div class="ttname"><a href="../../db/de7/structio__dim.html#a2a80572814f32a23139da84a214f3e7e">io_dim::height</a></div><div class="ttdeci">unsigned long height</div><div class="ttdef"><b>Definition:</b> nnctrl.h:237</div></div>
<div class="ttc" id="astructio__dim_html_a3f3081bbf4aed5f1d478704ef9f0ec49"><div class="ttname"><a href="../../db/de7/structio__dim.html#a3f3081bbf4aed5f1d478704ef9f0ec49">io_dim::width</a></div><div class="ttdeci">unsigned long width</div><div class="ttdef"><b>Definition:</b> nnctrl.h:238</div></div>
<div class="ttc" id="astructio__dim_html_a5574b64abdcb1e8455471e18f6947d04"><div class="ttname"><a href="../../db/de7/structio__dim.html#a5574b64abdcb1e8455471e18f6947d04">io_dim::dram_fmt</a></div><div class="ttdeci">uint32_t dram_fmt</div><div class="ttdef"><b>Definition:</b> nnctrl.h:247</div></div>
<div class="ttc" id="astructio__dim_html_a6151b90948f9409a6ad67219369dd801"><div class="ttname"><a href="../../db/de7/structio__dim.html#a6151b90948f9409a6ad67219369dd801">io_dim::pitch</a></div><div class="ttdeci">unsigned long pitch</div><div class="ttdef"><b>Definition:</b> nnctrl.h:240</div></div>
<div class="ttc" id="astructio__dim_html_af3562adee51a826821063e1a6e7dcd5b"><div class="ttname"><a href="../../db/de7/structio__dim.html#af3562adee51a826821063e1a6e7dcd5b">io_dim::depth</a></div><div class="ttdeci">unsigned long depth</div><div class="ttdef"><b>Definition:</b> nnctrl.h:236</div></div>
<div class="ttc" id="astructio__dim_html_afab25cb00475c5e5167bd688c8935f1d"><div class="ttname"><a href="../../db/de7/structio__dim.html#afab25cb00475c5e5167bd688c8935f1d">io_dim::plane</a></div><div class="ttdeci">unsigned long plane</div><div class="ttdef"><b>Definition:</b> nnctrl.h:235</div></div>
<div class="ttc" id="astructnet__cfg_html"><div class="ttname"><a href="../../da/df5/structnet__cfg.html">net_cfg</a></div><div class="ttdoc">The network configuration in initialization.</div><div class="ttdef"><b>Definition:</b> nnctrl.h:139</div></div>
<div class="ttc" id="astructnet__input__cfg_html"><div class="ttname"><a href="../../dc/d4a/structnet__input__cfg.html">net_input_cfg</a></div><div class="ttdoc">Total input in network.</div><div class="ttdef"><b>Definition:</b> nnctrl.h:404</div></div>
<div class="ttc" id="astructnet__input__cfg_html_a3a5880ecbe548c42008d7dc292d80898"><div class="ttname"><a href="../../dc/d4a/structnet__input__cfg.html#a3a5880ecbe548c42008d7dc292d80898">net_input_cfg::in_desc</a></div><div class="ttdeci">struct input_desc in_desc[MAX_IO_NUM]</div><div class="ttdef"><b>Definition:</b> nnctrl.h:407</div></div>
<div class="ttc" id="astructnet__input__cfg_html_a88b08f224c035fa5cae2217e6d67afda"><div class="ttname"><a href="../../dc/d4a/structnet__input__cfg.html#a88b08f224c035fa5cae2217e6d67afda">net_input_cfg::in_num</a></div><div class="ttdeci">INOUT uint32_t in_num</div><div class="ttdef"><b>Definition:</b> nnctrl.h:405</div></div>
<div class="ttc" id="astructnet__mem_html"><div class="ttname"><a href="../../d5/ddc/structnet__mem.html">net_mem</a></div><div class="ttdoc">The network memory description.</div><div class="ttdef"><b>Definition:</b> nnctrl.h:220</div></div>
<div class="ttc" id="astructnet__mem_html_a339e3775da5b214b6eb5b98727f48ab9"><div class="ttname"><a href="../../d5/ddc/structnet__mem.html#a339e3775da5b214b6eb5b98727f48ab9">net_mem::virt_addr</a></div><div class="ttdeci">uint8_t * virt_addr</div><div class="ttdef"><b>Definition:</b> nnctrl.h:221</div></div>
<div class="ttc" id="astructnet__mem_html_a6a21f902348c92a852a41a6ad83cf469"><div class="ttname"><a href="../../d5/ddc/structnet__mem.html#a6a21f902348c92a852a41a6ad83cf469">net_mem::mem_size</a></div><div class="ttdeci">unsigned long mem_size</div><div class="ttdef"><b>Definition:</b> nnctrl.h:223</div></div>
<div class="ttc" id="astructnet__mem_html_ac2a50a5b0c6273765e5a0edd72db1525"><div class="ttname"><a href="../../d5/ddc/structnet__mem.html#ac2a50a5b0c6273765e5a0edd72db1525">net_mem::phy_addr</a></div><div class="ttdeci">cv_daddr_t phy_addr</div><div class="ttdef"><b>Definition:</b> nnctrl.h:222</div></div>
<div class="ttc" id="astructnet__output__cfg_html"><div class="ttname"><a href="../../d7/dfc/structnet__output__cfg.html">net_output_cfg</a></div><div class="ttdoc">Total output in network.</div><div class="ttdef"><b>Definition:</b> nnctrl.h:426</div></div>
<div class="ttc" id="astructnet__output__cfg_html_a17afdb10821678afccc3bec8d83e1625"><div class="ttname"><a href="../../d7/dfc/structnet__output__cfg.html#a17afdb10821678afccc3bec8d83e1625">net_output_cfg::out_num</a></div><div class="ttdeci">INOUT uint32_t out_num</div><div class="ttdef"><b>Definition:</b> nnctrl.h:427</div></div>
<div class="ttc" id="astructnet__output__cfg_html_ace8266e84fe6acd1f5ee7cbbf1429201"><div class="ttname"><a href="../../d7/dfc/structnet__output__cfg.html#ace8266e84fe6acd1f5ee7cbbf1429201">net_output_cfg::out_desc</a></div><div class="ttdeci">struct output_desc out_desc[MAX_IO_NUM]</div><div class="ttdef"><b>Definition:</b> nnctrl.h:429</div></div>
<div class="ttc" id="astructnet__result_html"><div class="ttname"><a href="../../d8/df3/structnet__result.html">net_result</a></div><div class="ttdoc">The result information after network done.</div><div class="ttdef"><b>Definition:</b> nnctrl.h:542</div></div>
<div class="ttc" id="astructnet__run__cfg_html"><div class="ttname"><a href="../../d3/deb/structnet__run__cfg.html">net_run_cfg</a></div><div class="ttdoc">Run-time change network configuration.</div><div class="ttdef"><b>Definition:</b> nnctrl.h:509</div></div>
<div class="ttc" id="astructnnctrl__version_html"><div class="ttname"><a href="../../d1/d44/structnnctrl__version.html">nnctrl_version</a></div><div class="ttdoc">The version of nnctrl library.</div><div class="ttdef"><b>Definition:</b> nnctrl.h:54</div></div>
<div class="ttc" id="astructopt__layers__version_html"><div class="ttname"><a href="../../d2/d52/structopt__layers__version.html">opt_layers_version</a></div><div class="ttdoc">The version of cavalry_opt_layers library.</div><div class="ttdef"><b>Definition:</b> opt_layers.hpp:58</div></div>
<div class="ttc" id="astructoutput__desc_html_a05b251f6f4721e4b738a9439a7eda472"><div class="ttname"><a href="../../d9/dcb/structoutput__desc.html#a05b251f6f4721e4b738a9439a7eda472">output_desc::no_mem</a></div><div class="ttdeci">IN uint32_t no_mem</div><div class="ttdef"><b>Definition:</b> nnctrl.h:351</div></div>
<div class="ttc" id="astructoutput__desc_html_a32bea48d7aa93b31ae10943c1ba552ec"><div class="ttname"><a href="../../d9/dcb/structoutput__desc.html#a32bea48d7aa93b31ae10943c1ba552ec">output_desc::dim</a></div><div class="ttdeci">OUT struct io_dim dim</div><div class="ttdef"><b>Definition:</b> nnctrl.h:361</div></div>
<div class="ttc" id="astructoutput__desc_html_a333fd20f0a0fe19d88d0a2ad740e9003"><div class="ttname"><a href="../../d9/dcb/structoutput__desc.html#a333fd20f0a0fe19d88d0a2ad740e9003">output_desc::data_fmt</a></div><div class="ttdeci">OUT struct io_data_fmt data_fmt</div><div class="ttdef"><b>Definition:</b> nnctrl.h:362</div></div>
<div class="ttc" id="astructoutput__desc_html_a7dc04adf5758857da0cf009c816560de"><div class="ttname"><a href="../../d9/dcb/structoutput__desc.html#a7dc04adf5758857da0cf009c816560de">output_desc::addr</a></div><div class="ttdeci">INOUT cv_daddr_t addr</div><div class="ttdef"><b>Definition:</b> nnctrl.h:347</div></div>
<div class="ttc" id="astructoutput__desc_html_a8b1c668d1a96dde72c36f17898ae9e51"><div class="ttname"><a href="../../d9/dcb/structoutput__desc.html#a8b1c668d1a96dde72c36f17898ae9e51">output_desc::name</a></div><div class="ttdeci">INOUT const char * name</div><div class="ttdef"><b>Definition:</b> nnctrl.h:344</div></div>
<div class="ttc" id="astructoutput__desc_html_abe4e3181b6f9f9243f03829322d3e235"><div class="ttname"><a href="../../d9/dcb/structoutput__desc.html#abe4e3181b6f9f9243f03829322d3e235">output_desc::size</a></div><div class="ttdeci">OUT unsigned long size</div><div class="ttdef"><b>Definition:</b> nnctrl.h:349</div></div>
<div class="ttc" id="atest__decode_8h_html_ab5fefa6fc4abffdc4b912255ea537aae"><div class="ttname"><a href="../../../video/d0/d7d/test__decode_8h.html#ab5fefa6fc4abffdc4b912255ea537aae">numeric_short_options</a></div><div class="ttdeci">numeric_short_options</div></div>
<div class="ttc" id="atest__fb_8h_html_a2d0022791143e08a64621257f48d9739"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#a2d0022791143e08a64621257f48d9739">NO_ARG</a></div><div class="ttdeci">#define NO_ARG</div></div>
<div class="ttc" id="atest__fb_8h_html_affec572f11fcba59ce0cd49cbcd0110f"><div class="ttname"><a href="../../../video/d3/d6c/test__fb_8h.html#affec572f11fcba59ce0cd49cbcd0110f">HAS_ARG</a></div><div class="ttdeci">#define HAS_ARG</div></div>
<div class="ttc" id="atest__smartfb_8c_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="../../dc/d60/test__smartfb_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> test_smartfb.c:1009</div></div>
<div class="ttc" id="atest__smartfb_8c_html_ad96d407a911fbb914fa8e4cfbf2faf0f"><div class="ttname"><a href="../../dc/d60/test__smartfb_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a></div><div class="ttdeci">static void usage(void)</div><div class="ttdef"><b>Definition:</b> test_smartfb.c:161</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
