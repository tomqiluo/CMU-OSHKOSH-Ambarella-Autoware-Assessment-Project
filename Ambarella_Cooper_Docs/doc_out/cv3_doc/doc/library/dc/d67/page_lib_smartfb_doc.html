<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: SmartFB Library API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Library<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dc/d67/page_lib_smartfb_doc.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">SmartFB Library API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="SmartFB_history"></a>
0. Revision History</h1>
<a class="anchor" id="lib_smartfb_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th align="left">Library Version </th><th>Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td rowspan="2">0.0.4 </td><td>20191111 </td><td>Initial Version </td></tr>
<tr>
<td>20220621 </td><td>Add the introduction about <a class="el" href="../../dc/d67/page_lib_smartfb_doc.html#SmartFB_clut">2.3 CLUT</a> </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="SmartFB_overview"></a>
1. Overview</h1>
<p >The smart frame buffer (SmartFB) library is a tool to overlap images on top of the original image by using Linux's FrameBuffer device. This document explains how to use the SmartFB library for IP cameras and other related devices.</p>
<p >SmartFB library fully follows the Linux standard framebuffer interface, users can get more information by understanding the FrameBuffer interface of Liunx. However, it should be noted in the SmartFB library that when the data is written to framebuffer, it is not directly displayed on video output (VOUT), but the data in framebuffer is resized by the digital signal processor (DSP), and then the resized image is overlapped on VOUT.</p>
<hr  />
<h1><a class="anchor" id="SmartFB_proc"></a>
2. SmartFB Library Process</h1>
<h2><a class="anchor" id="SmartFB_proc_dep"></a>
2.1   Dependency Library</h2>
<p >The source code for SmartFB can be found in the path <code>ambarella/packages/smartfb</code>.</p>
<p >To use this library, ensure "Build Ambarella SMARTFB library" is selected in menuconfig.</p>
<ul>
<li>For CV2x SDK 3.0 Amba build: <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">  [*] Ambarella Package Configuration  ---&gt;</div>
<div class="line">   [*]   Build Ambarella SMARTFB library</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  packages  ---&gt;</div>
<div class="line">     smartfb  ---&gt;</div>
<div class="line">         [*] libsmartfb (packages/smartfb/lib_amba_mk)</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  meta-ambalib  ---&gt;</div>
<div class="line">     recipes-eazyai  ---&gt;</div>
<div class="line">         [*] libsmartfb (meta-ambalib/recipes-eazyai/libsmartfb)</div>
</div><!-- fragment --> After the option to compile SmartFB library is selected correctly, other related dependent options will also be selected automatically. Users can refer to the following settings.</li>
<li>For CV2x SDK 3.0 Amba build: <div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">  [*] Ambarella Package Configuration  ---&gt;</div>
<div class="line">   [*]   Build Ambarella SMARTFB library</div>
<div class="line">   -*-   Build Ambarella textinsert library</div>
<div class="line">  [*] Ambarella File System Configuration  ---&gt;</div>
<div class="line">   Third Party Software / Libraries  ---&gt;</div>
<div class="line">    System Basic Libraries  ---&gt;</div>
<div class="line">       -*- Add freetype2 into root_fs  ---&gt;</div>
<div class="line">        -*- Add free fonts to file system</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  packages  ---&gt;</div>
<div class="line">     [*] libtextinsert (packages/textinsert)  ---&gt;</div>
<div class="line">     smartfb  ---&gt;</div>
<div class="line">         [*] libsmartfb (packages/smartfb/lib_amba_mk)</div>
<div class="line">  prebuild  ---&gt;</div>
<div class="line">     oss  ---&gt;</div>
<div class="line">         [*] prebuild-freetype (prebuild/oss/armv8-a/freetype)</div>
<div class="line">         noarch  ---&gt;</div>
<div class="line">             [*] prebuild-fonts (prebuild/oss/noarch/font)</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  meta-ambalib  ---&gt;</div>
<div class="line">     recipes-eazyai  ---&gt;</div>
<div class="line">         [*] libsmartfb (meta-ambalib/recipes-eazyai/libsmartfb)</div>
<div class="line">     recipes-video  ---&gt;</div>
<div class="line">         [*] libtextinsert (meta-ambalib/recipes-video/libtextinsert)  ---&gt;</div>
<div class="line">  meta-thirdparty  ---&gt;</div>
<div class="line">     recipes-prebuild  ---&gt;</div>
<div class="line">         [*] prebuild-fonts (meta-thirdparty/recipes-prebuild/prebuild-fonts)</div>
</div><!-- fragment --> </li>
</ul>
<h2><a class="anchor" id="SmartFB_color_mode"></a>
2.2 Color Mode</h2>
<p >The information in the SmartFB library typically consists of color values for every pixel to be shown on the display. Color values are commonly stored in 8-bit palettized, 16-bit high color，and 32-bit true color formats, but there are many different color modes. For the color mode, users can refer to the following code, or get more detailed information from <code>ambarella/kernel/linux-4.14/drivers/video/fbdev/ambarella/ambarella_fb.c</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>ambfb_format ambfb_formats[] = {</div>
<div class="line">    { <span class="stringliteral">&quot;clut8bpp&quot;</span>, 8, {0, 0}, {0, 0}, {0, 0}, {0, 0}, DRM_FORMAT_C8 },</div>
<div class="line">    { <span class="stringliteral">&quot;rgb565&quot;</span>, 16, {11, 5}, {5, 6}, {0, 5}, {0, 0}, DRM_FORMAT_RGB565 },</div>
<div class="line">    { <span class="stringliteral">&quot;vyu565&quot;</span>, 16, {11, 5}, {5, 6}, {0, 5}, {0, 0}, fourcc_code(<span class="charliteral">&#39;v&#39;</span>, <span class="charliteral">&#39;y&#39;</span>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;6&#39;</span>) },</div>
<div class="line">    { <span class="stringliteral">&quot;bgr565&quot;</span>, 16, {0, 5}, {5, 6}, {11, 5}, {0, 0}, DRM_FORMAT_BGR565 },</div>
<div class="line">    { <span class="stringliteral">&quot;uyv565&quot;</span>, 16, {0, 5}, {5, 6}, {11, 5}, {0, 0}, fourcc_code(<span class="charliteral">&#39;u&#39;</span>, <span class="charliteral">&#39;y&#39;</span>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;6&#39;</span>) },</div>
<div class="line">    { <span class="stringliteral">&quot;ayuv4444&quot;</span>, 16, {0, 4}, {8, 4}, {4, 4}, {12, 4}, fourcc_code(<span class="charliteral">&#39;a&#39;</span>, <span class="charliteral">&#39;y&#39;</span>, <span class="charliteral">&#39;u&#39;</span>, <span class="charliteral">&#39;v&#39;</span>) },</div>
<div class="line">    { <span class="stringliteral">&quot;rgba4444&quot;</span>, 16, {12, 4}, {8, 4}, {4, 4}, {0, 4}, DRM_FORMAT_RGBA4444 },</div>
<div class="line">    { <span class="stringliteral">&quot;bgra4444&quot;</span>, 16, {4, 4}, {8, 4}, {12, 4}, {0, 4}, DRM_FORMAT_BGRA4444 },</div>
<div class="line">    { <span class="stringliteral">&quot;abgr4444&quot;</span>, 16, {0, 4}, {4, 4}, {8, 4}, {12, 4}, DRM_FORMAT_ABGR4444 },</div>
<div class="line">    { <span class="stringliteral">&quot;argb4444&quot;</span>, 16, {8, 4}, {4, 4}, {0, 4}, {12, 4}, DRM_FORMAT_ARGB4444 },</div>
<div class="line">    { <span class="stringliteral">&quot;ayuv1555&quot;</span>, 16, {0, 5}, {10, 5}, {5, 5}, {15, 1}, fourcc_code(<span class="charliteral">&#39;a&#39;</span>, <span class="charliteral">&#39;y&#39;</span>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;5&#39;</span>) },</div>
<div class="line">    { <span class="stringliteral">&quot;rgba5551&quot;</span>, 16, {11, 5}, {6, 5}, {1, 5}, {0, 1}, DRM_FORMAT_RGBA5551 },</div>
<div class="line">    { <span class="stringliteral">&quot;bgra5551&quot;</span>, 16, {1, 5}, {6, 5}, {11, 5}, {0, 1}, DRM_FORMAT_BGRA5551 },</div>
<div class="line">    { <span class="stringliteral">&quot;abgr1555&quot;</span>, 16, {0, 5}, {5, 5}, {10, 5}, {15, 1}, DRM_FORMAT_ABGR1555 },</div>
<div class="line">    { <span class="stringliteral">&quot;argb1555&quot;</span>, 16, {10, 5}, {5, 5}, {0, 5}, {15, 1}, DRM_FORMAT_ARGB1555 },</div>
<div class="line">    { <span class="stringliteral">&quot;ayuv8888&quot;</span>, 32, {0, 8}, {16, 8}, {8, 8}, {24, 8}, DRM_FORMAT_AYUV },</div>
<div class="line">    { <span class="stringliteral">&quot;rgba8888&quot;</span>, 32, {24, 8}, {16, 8}, {8, 8}, {0, 8}, DRM_FORMAT_RGBA8888 },</div>
<div class="line">    { <span class="stringliteral">&quot;bgra8888&quot;</span>, 32, {8, 8}, {16, 8}, {24, 8}, {0, 8}, DRM_FORMAT_BGRA8888 },</div>
<div class="line">    { <span class="stringliteral">&quot;abgr8888&quot;</span>, 32, {0, 8}, {8, 8}, {16, 8}, {24, 8}, DRM_FORMAT_ABGR8888 },</div>
<div class="line">    { <span class="stringliteral">&quot;argb8888&quot;</span>, 32, {16, 8}, {8, 8}, {0, 8}, {24, 8}, DRM_FORMAT_ARGB8888 },</div>
<div class="line">};</div>
</div><!-- fragment --><p >It should be noted that the larger the bits of color is, the greater the expense of memory will be. Commonly used color modes are clut8bpp, rgb565, and argb8888, but currently SmartFB library only supports clut8bpp and argb8888. Users can set the color mode as required using the following command.</p>
<p >1.Set the color mode to clut8bpp. </p><div class="fragment"><div class="line">board# rmmod ambarella_fb; modprobe ambarella_fb mode=clut8bpp</div>
</div><!-- fragment --><p >2.Set the color mode to rgb565 (SmartFB library does not support this mode). </p><div class="fragment"><div class="line">board# rmmod ambarella_fb; modprobe ambarella_fb mode=rgb565</div>
</div><!-- fragment --><p >3.Set the color mode to argb8888. </p><div class="fragment"><div class="line">board# rmmod ambarella_fb; modprobe ambarella_fb mode=argb8888</div>
</div><!-- fragment --><p >If the user sets the color mode to clut8bpp, the color value is stored in 8-bit and only 256 colors can be represented. The problem with such small color depths is that a full range of colors cannot be produced. The solution to this problem was indexed color which adds a lookup table to the library. Each color stored in memory acts as a color index. The lookup table serves as a palette with a limited number of different colors, and it is called <b>Color Look Up Table (CLUT)</b>.</p>
<p >If the user sets the color mode to ARGB8888 (A is alpha, R is red, G is green, and B is blue), then A(alpha) uses 8bit, R(red) uses 8bit, G(green) uses 8bit, and B(blue) uses 8bit, so one pixel occupies 32-bit(four bytes), it will represent a full range of colors.</p>
<dl class="section note"><dt>Note</dt><dd>For the SmartFB library, the final image is overlapped on VOUT after resized by DSP. Due to the limitation of DSP, the maximum resolution that can be set is different for different color mode. The larger the bpp is, the smaller the maximum resolution gets. If the resolution exceeds the maximum resolution, the user may see an open error. It should be noted that the resolution is "WxH", "W" is width and "H" is height.</dd></dl>
<ul>
<li>When the color mode is set to clut8bpp(8bpp), the maximum width in resolution is 1920.</li>
<li>When the color mode is set to rgb565(16bpp), the maximum width in resolution is 960.</li>
<li>When the color mode is set to argb8888(32bpp), the maximum width in resolution is 480.</li>
<li>The above limitations are based on the default VOUT Profile. For the detailed information of different VOUT Profiles, refer to vout_special_cfg.</li>
</ul>
<h2><a class="anchor" id="SmartFB_clut"></a>
2.3 CLUT</h2>
<p >In the SmartFB library, there is a default <b>CLUT (clut8bpp)</b>, and 23 colors and 8 transparencies are predefined as follows.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_struct" href="../../df/d2b/structfb__color__t.html">fb_color_t</a> <a class="code hl_variable" href="../../d6/dfc/lib__smartfb_8c.html#a02a2e7dcad791b86940e82b1df68b388">default_color_clut</a>[<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a29253972fcee7fd0afbca376f1392f17">SMARTFB_COLOR_NUM</a>] = {</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a61cfdbfb100fe786a785850d657c6e8b">SMARTFB_COLOR_RED</a>] = {.<a class="code hl_variable" href="../../df/d2b/structfb__color__t.html#a2864cf00af8b32eaa497f8bc6948da0c">r</a> = 255, .g = 0, .b = 0},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a21740538fc1f95e43da451f3fee81a1a">SMARTFB_COLOR_LIME</a>] = {.r = 0, .g = 255, .b = 0},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2aabf604c38adfe77b3aa2262216724447">SMARTFB_COLOR_BLUE</a>] = {.r = 0, .g = 0, .b = 255},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a53b5829553aee571fe81f7ad497d03d9">SMARTFB_COLOR_MAGENTA</a>] = {.r = 255, .g = 0, .b = 255},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a43e8725245523c3a1c1fe21d5926d03b">SMARTFB_COLOR_SPRING_GREEN</a>] = {.r = 0, .g = 255, .b = 127},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2abebbffe6a719babfed434aa9cdc9b64d">SMARTFB_COLOR_MEDIUM_SLATE_BLUE</a>] = {.r = 127, .g = 127, .b = 255},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a3e3340f3ec7e27e8aa8b83c53a45c488">SMARTFB_COLOR_YELLOW</a>] = {.r = 255, .g = 255, .b = 0},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a4ad261935c868c21b1bae7def83ee13d">SMARTFB_COLOR_DARK_ORANGE</a>] = {.r = 255, .g = 127, .b = 0},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a5c62cdd78b6b25b45ce525473718560d">SMARTFB_COLOR_CYAN</a>] = {.r = 0, .g = 255, .b = 255},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a6d4b15097338f4b4a62df09c25a5bd8d">SMARTFB_COLOR_GREEN</a>] = {.r = 0, .g = 127, .b = 0},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2ab5c28c0bdc2593c335dab9baa1272595">SMARTFB_COLOR_BLUE_VIOLET</a>] = {.r = 127, .g = 0, .b = 255},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a868f906154f7bf6ed7bdd06c815235a0">SMARTFB_COLOR_VIOLET</a>] = {.r = 255, .g = 127, .b = 255},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a38afcdaf60e92d3f0229a7120f6efef7">SMARTFB_COLOR_DEEP_PINK</a>] = {.r = 255, .g = 0, .b = 127},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a9d579c7e8500fb190c1c41983e049dc5">SMARTFB_COLOR_NAVY</a>] = {.r = 0, .g = 0, .b = 127},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a47d155fb8134300b0b27f8d46e68876b">SMARTFB_COLOR_MAROON</a>] = {.r = 127, .g = 0, .b = 0},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2ae677d1a461ed0112c7470684c02e9157">SMARTFB_COLOR_PURPLE</a>] = {.r = 127, .g = 0, .b = 127},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2ac740203a18448edfba49be261937f088">SMARTFB_COLOR_SALMON</a>] = {.r = 255, .g = 127, .b = 127},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a497e3735adaeab28129ca0fba2d71704">SMARTFB_COLOR_OLIVE</a>] = {.r = 127, .g = 127, .b = 0},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a71eb96e39d1c2fe1444e8a605cc8a510">SMARTFB_COLOR_MOCCASIN</a>] = {.r = 255, .g = 255, .b = 180},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a4ce0462e232ec05186563f3bf00cc908">SMARTFB_COLOR_TEAL</a>] = {.r = 0, .g = 127, .b = 127},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2ab60dbde8b1be4f6effdf6c0fd0e9ba44">SMARTFB_COLOR_GRAY</a>] = {.r = 127, .g = 127, .b = 127},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a522699f409bb6e592be1b61a755f545d">SMARTFB_COLOR_WHITE</a>] = {.r = 255, .g = 255, .b = 255},</div>
<div class="line">    [<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a6f192a3804458370432932d460fcc68e">SMARTFB_COLOR_BLACK</a>] = {.r = 0, .g = 0, .b = 0},</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> <a class="code hl_variable" href="../../d6/dfc/lib__smartfb_8c.html#a2b7977bdd1a4545d4884dcea1d0ac9a9">default_alpha_clut</a>[<a class="code hl_enumvalue" href="../../d3/d3f/group__SmartFB-helper.html#gga3dac4432c8e7ea3db6cb7305486ed5ffaf0ad91aad2eaac6ecf3eb18e4b0c0122">SMARTFB_ALPHA_NUM</a>] =</div>
<div class="line">    { 0, 32, 64, 96, 128, 160, 192, 255 };</div>
<div class="ttc" id="aasf__structure_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="../../d2/d47/asf__structure_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div><div class="ttdef"><b>Definition:</b> asf_structure.h:46</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_gga3dac4432c8e7ea3db6cb7305486ed5ffaf0ad91aad2eaac6ecf3eb18e4b0c0122"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#gga3dac4432c8e7ea3db6cb7305486ed5ffaf0ad91aad2eaac6ecf3eb18e4b0c0122">SMARTFB_ALPHA_NUM</a></div><div class="ttdeci">@ SMARTFB_ALPHA_NUM</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:120</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a21740538fc1f95e43da451f3fee81a1a"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a21740538fc1f95e43da451f3fee81a1a">SMARTFB_COLOR_LIME</a></div><div class="ttdeci">@ SMARTFB_COLOR_LIME</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:83</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a29253972fcee7fd0afbca376f1392f17"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a29253972fcee7fd0afbca376f1392f17">SMARTFB_COLOR_NUM</a></div><div class="ttdeci">@ SMARTFB_COLOR_NUM</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:105</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a38afcdaf60e92d3f0229a7120f6efef7"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a38afcdaf60e92d3f0229a7120f6efef7">SMARTFB_COLOR_DEEP_PINK</a></div><div class="ttdeci">@ SMARTFB_COLOR_DEEP_PINK</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:94</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a3e3340f3ec7e27e8aa8b83c53a45c488"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a3e3340f3ec7e27e8aa8b83c53a45c488">SMARTFB_COLOR_YELLOW</a></div><div class="ttdeci">@ SMARTFB_COLOR_YELLOW</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:88</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a43e8725245523c3a1c1fe21d5926d03b"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a43e8725245523c3a1c1fe21d5926d03b">SMARTFB_COLOR_SPRING_GREEN</a></div><div class="ttdeci">@ SMARTFB_COLOR_SPRING_GREEN</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:86</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a47d155fb8134300b0b27f8d46e68876b"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a47d155fb8134300b0b27f8d46e68876b">SMARTFB_COLOR_MAROON</a></div><div class="ttdeci">@ SMARTFB_COLOR_MAROON</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:96</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a497e3735adaeab28129ca0fba2d71704"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a497e3735adaeab28129ca0fba2d71704">SMARTFB_COLOR_OLIVE</a></div><div class="ttdeci">@ SMARTFB_COLOR_OLIVE</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:99</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a4ad261935c868c21b1bae7def83ee13d"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a4ad261935c868c21b1bae7def83ee13d">SMARTFB_COLOR_DARK_ORANGE</a></div><div class="ttdeci">@ SMARTFB_COLOR_DARK_ORANGE</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:89</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a4ce0462e232ec05186563f3bf00cc908"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a4ce0462e232ec05186563f3bf00cc908">SMARTFB_COLOR_TEAL</a></div><div class="ttdeci">@ SMARTFB_COLOR_TEAL</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:101</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a522699f409bb6e592be1b61a755f545d"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a522699f409bb6e592be1b61a755f545d">SMARTFB_COLOR_WHITE</a></div><div class="ttdeci">@ SMARTFB_COLOR_WHITE</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:103</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a53b5829553aee571fe81f7ad497d03d9"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a53b5829553aee571fe81f7ad497d03d9">SMARTFB_COLOR_MAGENTA</a></div><div class="ttdeci">@ SMARTFB_COLOR_MAGENTA</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:85</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a5c62cdd78b6b25b45ce525473718560d"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a5c62cdd78b6b25b45ce525473718560d">SMARTFB_COLOR_CYAN</a></div><div class="ttdeci">@ SMARTFB_COLOR_CYAN</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:90</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a61cfdbfb100fe786a785850d657c6e8b"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a61cfdbfb100fe786a785850d657c6e8b">SMARTFB_COLOR_RED</a></div><div class="ttdeci">@ SMARTFB_COLOR_RED</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:82</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a6d4b15097338f4b4a62df09c25a5bd8d"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a6d4b15097338f4b4a62df09c25a5bd8d">SMARTFB_COLOR_GREEN</a></div><div class="ttdeci">@ SMARTFB_COLOR_GREEN</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:91</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a6f192a3804458370432932d460fcc68e"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a6f192a3804458370432932d460fcc68e">SMARTFB_COLOR_BLACK</a></div><div class="ttdeci">@ SMARTFB_COLOR_BLACK</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:104</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a71eb96e39d1c2fe1444e8a605cc8a510"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a71eb96e39d1c2fe1444e8a605cc8a510">SMARTFB_COLOR_MOCCASIN</a></div><div class="ttdeci">@ SMARTFB_COLOR_MOCCASIN</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:100</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a868f906154f7bf6ed7bdd06c815235a0"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a868f906154f7bf6ed7bdd06c815235a0">SMARTFB_COLOR_VIOLET</a></div><div class="ttdeci">@ SMARTFB_COLOR_VIOLET</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:93</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2a9d579c7e8500fb190c1c41983e049dc5"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2a9d579c7e8500fb190c1c41983e049dc5">SMARTFB_COLOR_NAVY</a></div><div class="ttdeci">@ SMARTFB_COLOR_NAVY</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:95</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2aabf604c38adfe77b3aa2262216724447"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2aabf604c38adfe77b3aa2262216724447">SMARTFB_COLOR_BLUE</a></div><div class="ttdeci">@ SMARTFB_COLOR_BLUE</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:84</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2ab5c28c0bdc2593c335dab9baa1272595"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2ab5c28c0bdc2593c335dab9baa1272595">SMARTFB_COLOR_BLUE_VIOLET</a></div><div class="ttdeci">@ SMARTFB_COLOR_BLUE_VIOLET</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:92</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2ab60dbde8b1be4f6effdf6c0fd0e9ba44"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2ab60dbde8b1be4f6effdf6c0fd0e9ba44">SMARTFB_COLOR_GRAY</a></div><div class="ttdeci">@ SMARTFB_COLOR_GRAY</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:102</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2abebbffe6a719babfed434aa9cdc9b64d"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2abebbffe6a719babfed434aa9cdc9b64d">SMARTFB_COLOR_MEDIUM_SLATE_BLUE</a></div><div class="ttdeci">@ SMARTFB_COLOR_MEDIUM_SLATE_BLUE</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:87</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2ac740203a18448edfba49be261937f088"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2ac740203a18448edfba49be261937f088">SMARTFB_COLOR_SALMON</a></div><div class="ttdeci">@ SMARTFB_COLOR_SALMON</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:98</div></div>
<div class="ttc" id="agroup__SmartFB-helper_html_ggad7e4de5c6057a0cab0e6ada35101a2f2ae677d1a461ed0112c7470684c02e9157"><div class="ttname"><a href="../../d3/d3f/group__SmartFB-helper.html#ggad7e4de5c6057a0cab0e6ada35101a2f2ae677d1a461ed0112c7470684c02e9157">SMARTFB_COLOR_PURPLE</a></div><div class="ttdeci">@ SMARTFB_COLOR_PURPLE</div><div class="ttdef"><b>Definition:</b> lib_smartfb.h:97</div></div>
<div class="ttc" id="alib__smartfb_8c_html_a02a2e7dcad791b86940e82b1df68b388"><div class="ttname"><a href="../../d6/dfc/lib__smartfb_8c.html#a02a2e7dcad791b86940e82b1df68b388">default_color_clut</a></div><div class="ttdeci">static fb_color_t default_color_clut[SMARTFB_COLOR_NUM]</div><div class="ttdef"><b>Definition:</b> lib_smartfb.c:117</div></div>
<div class="ttc" id="alib__smartfb_8c_html_a2b7977bdd1a4545d4884dcea1d0ac9a9"><div class="ttname"><a href="../../d6/dfc/lib__smartfb_8c.html#a2b7977bdd1a4545d4884dcea1d0ac9a9">default_alpha_clut</a></div><div class="ttdeci">static u32 default_alpha_clut[SMARTFB_ALPHA_NUM]</div><div class="ttdef"><b>Definition:</b> lib_smartfb.c:143</div></div>
<div class="ttc" id="astructfb__color__t_html"><div class="ttname"><a href="../../df/d2b/structfb__color__t.html">fb_color_t</a></div><div class="ttdef"><b>Definition:</b> lib_smartfb_priv.h:62</div></div>
<div class="ttc" id="astructfb__color__t_html_a2864cf00af8b32eaa497f8bc6948da0c"><div class="ttname"><a href="../../df/d2b/structfb__color__t.html#a2864cf00af8b32eaa497f8bc6948da0c">fb_color_t::r</a></div><div class="ttdeci">u16 r</div><div class="ttdef"><b>Definition:</b> lib_smartfb_priv.h:63</div></div>
</div><!-- fragment --><p >Here are some introductions of the default CLUT, refer to <a class="el" href="../../d6/dfc/lib__smartfb_8c.html#a61104a24ee4c0062d2909b41ac73ac7d">smartfb_color_init()</a> for details.</p>
<ol type="1">
<li>The first 184 indexes of this default CLUT are composed of 23 colors and 8 transparencies. Each color and 8 transparencies form 8 indexes, which are mainly used in the interface of drawing line, box, etc.</li>
<li>The 184 ~ 247 index (64 indexes) of this default CLUT include 64 opaque grayscales, which are mainly used for the interface of drawing mosaics.</li>
<li>The remaining 8 indexes of this default CLUT are set to transparent full black (values are 0), which are generally not used.</li>
</ol>
<h2><a class="anchor" id="SmartFB_cycle_buffer"></a>
2.4 Cycle-buffer Mechanism</h2>
<div class="image">
<img src="../../SmartFB_Double_buffer.jpg" alt=""/>
<div class="caption">
Figure 2-1. Double Buffer.</div></div>
<p >Most framebuffer uses double buffering mechanism, of course, it may be 3, 4 or more circular buffers. If the framebuffer uses a double buffering mechanism, the visual resolution of framebuffer is 640×400, the virtual resolution of framebuffer is 640×800. In the framebuffer model in the Linux kernel, there is a variable called "yoffset", which represents the specific vertical coordinate, and it's default value is 0. When yoffset is 0, the content in the vertical coordinate from 0 to 399 will be displayed. If yoffset changes, such as 400 in this example, the rest of the content will be displayed (its ordinate is 400-799).</p>
<p >When the system displays the first frame(the content of the ordinate is 0-399), the system can prepare the data of the second frame(the content of the ordinate is 400-799) in the background, so when the first frame is displayed, most of the time, the data for the second frame is also ready and can be displayed directly. Similarly, when the system displays the second frame, the system can prepare the data of the next frame. Cycle in this way, the image can be displayed smoothly and the display efficiency can be greatly improved.</p>
<p >The user can set the number of buffers through the following command.</p>
<div class="fragment"><div class="line"> board# rmmod ambarella_fb; modprobe ambarella_fb  buffernum=2 <span class="comment">/* Set the number of buffers to 2 */</span></div>
<div class="line">Or</div>
<div class="line"> board# rmmod ambarella_fb; modprobe ambarella_fb  buffernum=4 <span class="comment">/* Set the number of buffers to 4 */</span></div>
</div><!-- fragment --><h2><a class="anchor" id="SmartFB_structure"></a>
2.5 FrameBuffer Common Structure</h2>
<p >FrameBuffer has the following commonly used structures: "fb_var_screeninfo", "fb_fix_screeninfo", "fb_cmap", "ioctl". These structures are declared in <code>ambarella/kernel/linux-4.14/include/uapi/linux/fb.h</code>.</p>
<p >1.<b>fb_var_screeninfo</b></p>
<p >This structure is used to record user-modifiable display attribute parameters, including screen resolution, the number of bits per pixel, and so on.</p>
<p >There are some frequently used information in this structure, such as: offset (xoffset, yoffset), visible rows and columns of pixels (xres, yres), the number of bits per pixel (bits_per_pixel), virtual resolution (xres_virtual, Yres_virtual).</p>
<p >Ambarella can obtain these data through the ioctl() function, such as: <code>ioctl(fbfd, FBIOGET_FSCREENINFO, &amp;finfo)</code>. We can also re-assign and then set it into the system through ioctl(), such as: <code>ioctl(fbfd, FBIOPUT_VSCREENINFO, &amp;finfo)</code>.</p>
<div class="image">
<img src="../../SmartFB_fb_var_screeninfo.jpg" alt=""/>
<div class="caption">
fb_var_screeninfo</div></div>
<div class="fragment"><div class="line"><span class="keyword">struct </span>fb_var_screeninfo {</div>
<div class="line">   __u32 xres;         <span class="comment">/* visible resolution       */</span></div>
<div class="line">   __u32 yres;</div>
<div class="line">   __u32 xres_virtual;     <span class="comment">/* virtual resolution       */</span></div>
<div class="line">   __u32 yres_virtual;</div>
<div class="line">   __u32 xoffset;          <span class="comment">/* offset from virtual to visible */</span></div>
<div class="line">   __u32 yoffset;          <span class="comment">/* resolution           */</span></div>
<div class="line"> </div>
<div class="line">   __u32 bits_per_pixel;       <span class="comment">/* guess what           */</span></div>
<div class="line">   __u32 grayscale;        <span class="comment">/* 0 = color, 1 = grayscale,    */</span></div>
<div class="line">                   <span class="comment">/* &gt;1 = FOURCC          */</span></div>
<div class="line">   <span class="keyword">struct </span>fb_bitfield red;     <span class="comment">/* bitfield in fb mem if true color, */</span></div>
<div class="line">   <span class="keyword">struct </span>fb_bitfield green;   <span class="comment">/* else only length is significant */</span></div>
<div class="line">   <span class="keyword">struct </span>fb_bitfield blue;</div>
<div class="line">   <span class="keyword">struct </span>fb_bitfield transp;  <span class="comment">/* transparency         */</span></div>
<div class="line"> </div>
<div class="line">   __u32 nonstd;           <span class="comment">/* != 0 Non standard pixel format */</span></div>
<div class="line"> </div>
<div class="line">   __u32 activate;         <span class="comment">/* see FB_ACTIVATE_*        */</span></div>
<div class="line"> </div>
<div class="line">   __u32 height;           <span class="comment">/* height of picture in mm    */</span></div>
<div class="line">   __u32 width;            <span class="comment">/* width of picture in mm     */</span></div>
<div class="line"> </div>
<div class="line">   __u32 accel_flags;      <span class="comment">/* (OBSOLETE) see fb_info.flags */</span></div>
<div class="line"> </div>
<div class="line">   <span class="comment">/* Timing: All values in pixclocks, except pixclock (of course) */</span></div>
<div class="line">   __u32 pixclock;         <span class="comment">/* pixel clock in ps (pico seconds) */</span></div>
<div class="line">   __u32 left_margin;      <span class="comment">/* time from sync to picture    */</span></div>
<div class="line">   __u32 right_margin;     <span class="comment">/* time from picture to sync    */</span></div>
<div class="line">   __u32 upper_margin;     <span class="comment">/* time from sync to picture    */</span></div>
<div class="line">   __u32 lower_margin;</div>
<div class="line">   __u32 hsync_len;        <span class="comment">/* length of horizontal sync    */</span></div>
<div class="line">   __u32 vsync_len;        <span class="comment">/* length of vertical sync  */</span></div>
<div class="line">   __u32 sync;         <span class="comment">/* see FB_SYNC_*        */</span></div>
<div class="line">   __u32 vmode;            <span class="comment">/* see FB_VMODE_*       */</span></div>
<div class="line">   __u32 rotate;           <span class="comment">/* angle we rotate counter clockwise */</span></div>
<div class="line">   __u32 colorspace;       <span class="comment">/* colorspace for FOURCC-based modes */</span></div>
<div class="line">   __u32 reserved[4];      <span class="comment">/* Reserved for future compatibility */</span></div>
<div class="line">};</div>
</div><!-- fragment --><p >2.<b>fb_fix_screeninfo</b></p>
<p >This structure is mainly described with some fixed parameters. These parameters are set during driver initialization and cannot be modified by the user. For example: memory space size, memory start address, the number of bytes occupied by each line and so on.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>fb_fix_screeninfo {</div>
<div class="line">    <span class="keywordtype">char</span> <span class="keywordtype">id</span>[16];            <span class="comment">/* identification string eg &quot;TT Builtin&quot; */</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> smem_start;   <span class="comment">/* Start of frame buffer mem */</span></div>
<div class="line">                    <span class="comment">/* (physical address) */</span></div>
<div class="line">    __u32 smem_len;         <span class="comment">/* Length of frame buffer mem */</span></div>
<div class="line">    __u32 type;         <span class="comment">/* see FB_TYPE_*        */</span></div>
<div class="line">    __u32 type_aux;         <span class="comment">/* Interleave for interleaved Planes */</span></div>
<div class="line">    __u32 visual;           <span class="comment">/* see FB_VISUAL_*      */</span></div>
<div class="line">    __u16 xpanstep;         <span class="comment">/* zero if no hardware panning  */</span></div>
<div class="line">    __u16 ypanstep;         <span class="comment">/* zero if no hardware panning  */</span></div>
<div class="line">    __u16 ywrapstep;        <span class="comment">/* zero if no hardware ywrap    */</span></div>
<div class="line">    __u32 line_length;      <span class="comment">/* length of a line in bytes    */</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> mmio_start;   <span class="comment">/* Start of Memory Mapped I/O   */</span></div>
<div class="line">                    <span class="comment">/* (physical address) */</span></div>
<div class="line">    __u32 mmio_len;         <span class="comment">/* Length of Memory Mapped I/O  */</span></div>
<div class="line">    __u32 accel;            <span class="comment">/* Indicate to driver which */</span></div>
<div class="line">                    <span class="comment">/*  specific chip/card we have  */</span></div>
<div class="line">    __u16 capabilities;     <span class="comment">/* see FB_CAP_*         */</span></div>
<div class="line">    __u16 reserved[2];      <span class="comment">/* Reserved for future compatibility */</span></div>
<div class="line">};</div>
</div><!-- fragment --><p >3.<b>fb_cmap</b></p>
<p >This structure is mainly used to describe color mapping information. The color mapping information can be set or get through the ioctl() operation corresponding to FBIOGETCMAP and FBIOPUTCMAP.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>fb_cmap {</div>
<div class="line">    __u32 start;            <span class="comment">/* First entry  */</span></div>
<div class="line">    __u32 len;          <span class="comment">/* Number of entries */</span></div>
<div class="line">    __u16 *red;         <span class="comment">/* Red values   */</span></div>
<div class="line">    __u16 *green;</div>
<div class="line">    __u16 *blue;</div>
<div class="line">    __u16 *transp;          <span class="comment">/* transparency, can be NULL */</span></div>
<div class="line">};</div>
</div><!-- fragment --><p >4.<b>parameters_of_ioctl()</b></p>
<p >The commonly used request parameters in ioctl().</p>
<div class="fragment"><div class="line">- FBIOGET_VSCREENINFO <span class="comment">/* indicates that the user obtains the variable parameters of the screen; */</span></div>
<div class="line">- FBIOPUT_VSCREENINFO <span class="comment">/* indicates that the user sets variable screen parameters; */</span></div>
<div class="line">- FBIOGET_FSCREENINFO <span class="comment">/* indicates that the user obtains fixed parameters of the screen; */</span></div>
<div class="line">- FBIOBLANK   <span class="comment">/* clears the screen */</span></div>
<div class="line">- FBIOPUTCMAP <span class="comment">/* sets the color table of the screen */</span></div>
<div class="line">- FBIOGETCMAP <span class="comment">/* get color table */</span></div>
</div><!-- fragment --><h2><a class="anchor" id="SmartFB_proc_usage"></a>
2.6 FrameBuffer Usage Process</h2>
<p >The main uses of SmartFB library are as follows.</p>
<p >User can also refer to <code>ambarella/unit_test/private/package_test/arch_v5/test_smartfb.c</code>.</p>
<div class="image">
<img src="../../SmartFB_usage_process.jpg" alt=""/>
<div class="caption">
Usage Process</div></div>
<hr  />
<h1><a class="anchor" id="sec_SmartFB_test"></a>
3. Unit Test</h1>
<p >Locate the SmartFB library unit test file in the path below: <code>ambarella/unit_test/private/package_test/arch_v5/test_smartfb.c</code>.</p>
<h2><a class="anchor" id="SmartFB_test_lp"></a>
3.1 Main Loop</h2>
<ol type="1">
<li>Call function <a class="el" href="../../df/d1d/group__SmartFB-api.html#ga347c0b34a8d388ca39ad2cf7d461e92f">smartfb_init()</a> to initialize the library.</li>
<li>Call function <a class="el" href="../../df/d1d/group__SmartFB-api.html#ga0c27d3d65a023592e3775e8e35bce0fc">smartfb_get_fb_mode_name()</a> to set the framebuffer mode for the library.</li>
<li>Call function input_xxx_attr() to set the necessary parameters for the library.</li>
<li>Call function <a class="el" href="../../df/d1d/group__SmartFB-api.html#gaed20c8b8a98a2607e3b8441e44b350e5">smartfb_display()</a> to show image and switch the current cycle buffer to the next.</li>
<li>Call function <a class="el" href="../../df/d1d/group__SmartFB-api.html#gad639e235bdaf61d9f05575b34e40c7a4">smartfb_deinit()</a> to release the library session.</li>
</ol>
<h2><a class="anchor" id="SmartFB_test_examp"></a>
3.2 Examples</h2>
<p >Before executing the following unit test, please execute the following command to initialize framebuffer. </p><div class="fragment"><div class="line">board # rmmod ambarella_fb; modprobe ambarella_fb resolution=1920x1080 mode=clut8bpp buffernum=2</div>
</div><!-- fragment --><h3><a class="anchor" id="SmartFB_test_examp_solid_box"></a>
3.2.1 Draw Solid Box</h3>
<p >To draw solid box.</p>
<div class="fragment"><div class="line">board # test_smartfb</div>
<div class="line">board # Your choice: <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div>
<div class="line">board # Your choice: 1</div>
<div class="line">board # Input OBJ offset x: 100</div>
<div class="line">board # Input OBJ offset y: 100</div>
<div class="line">board # Input OBJ color: (Useless when special option is selected)</div>
<div class="line">board # 0</div>
<div class="line">board # Input OBJ bg_color:</div>
<div class="line">board # 2</div>
<div class="line">board # Input OBJ bg_alpha:</div>
<div class="line">board # 7</div>
<div class="line">board # Input Box width: 100</div>
<div class="line">board # Input Box height: 100</div>
<div class="line">board # Your choice: 7</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div><div class="ttdef"><b>Definition:</b> cJSON.h:255</div></div>
</div><!-- fragment --><h3><a class="anchor" id="SmartFB_test_examp_mosaic"></a>
3.2.2 Draw Mosaic</h3>
<p >To draw mosaic.</p>
<div class="fragment"><div class="line">board # test_smartfb</div>
<div class="line">board # Your choice: <a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div>
<div class="line">board # Your choice: 9</div>
<div class="line">board # Input the buffer_id(recommended value is 1) of fetched data: 1</div>
<div class="line">board # Input Mosaic fb_offset x: 100</div>
<div class="line">board # Input Mosaic fb_offset y: 100</div>
<div class="line">board # Input Mosaic fb_width: 100</div>
<div class="line">board # Input Mosaic fb_height: 100</div>
<div class="line">board # Input Mosaic fb_grid_width: 10</div>
<div class="line">board # Input Mosaic fb_grid_height: 10</div>
<div class="line">board # Your choice: 7</div>
</div><!-- fragment --><h3><a class="anchor" id="SmartFB_test_examp_other_objects"></a>
3.2.3 Draw Other Objects</h3>
<p >Users can draw other objects according to the prompts of test_smartfb.</p>
<hr  />
<h1><a class="anchor" id="sec_SmartFB_api"></a>
4. SmartFB API</h1>
<p >Visit the following link to find details of the API function.</p><ul>
<li><a class="el" href="../../df/d1d/group__SmartFB-api.html">SmartFB Library API Details</a> explains API functions.</li>
<li><a class="el" href="../../d3/d3f/group__SmartFB-helper.html">SmartFB Library API Helper</a> shows related structures, macros, and enumerations.</li>
</ul>
<hr  />
<h1><a class="anchor" id="sec_SmartFB_lic"></a>
5. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ( "Software" ) are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >This file includes sample code and is only for internal testing and evaluation. If you distribute this sample code (whether in source, object, or binary code form), it will be without any warranty or indemnity protection from Ambarella International LP or its affiliates.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
