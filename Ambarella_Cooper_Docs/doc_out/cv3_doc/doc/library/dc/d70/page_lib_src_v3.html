<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: SmartRC V3 Library API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Library<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dc/d70/page_lib_src_v3.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">SmartRC V3 Library API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="srcv3_history"></a>
0. Revision History</h1>
<a class="anchor" id="smartrcv3_lib_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Library Version </th><th align="left">Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td rowspan="2">3.0.0 </td><td>20200617 </td><td>1. Initial Version </td></tr>
<tr>
<td>20200917 </td><td>2. <b>[doxygen]</b> Added Section <a class="el" href="../../dc/d70/page_lib_src_v3.html#srcv3_lp">5. Lua Parser</a> </td></tr>
<tr>
<td>3.0.9 </td><td>20210506 </td><td><b>[SDK]</b> Added support for CV bounding box overlay feature </td></tr>
<tr>
<td>3.0.10 </td><td>20210728 </td><td><b>[SDK]</b> Added support for force control and update examples </td></tr>
<tr>
<td>3.0.11 </td><td>20210811 </td><td><b>[SDK]</b> Update buffer ID limitation from 4 to 12 </td></tr>
<tr>
<td rowspan="2">3.0.12</td><td>20211009 </td><td>1. <b>[SDK]</b> Fix lua parser bug and add IAV version check </td></tr>
<tr>
<td>20211213 </td><td>2. <b>[SDK]</b> Adjust the prebuild folder from "\prebuild\ambarella\library\smartrc3\lib" to "\prebuild\ambarella\library\smartrc3\lib\arch_v5" </td></tr>
<tr>
<td>3.0.14 </td><td>20220708 </td><td><b>[SDK]</b> Extend max encode resolution to 6720x4096 for CV2x </td></tr>
<tr>
<td>3.0.16 </td><td>20220708 </td><td><b>[SDK]</b> Extend max encode resolution to 7680x4320 for CV5x </td></tr>
<tr>
<td rowspan="7">3.0.18</td><td>20230317 </td><td>1. <b>[SDK]</b> Add support to disable low light profile </td></tr>
<tr>
<td>20230317 </td><td>2. <b>[SDK]</b> Add support to choose if apply ROI params for B frame </td></tr>
<tr>
<td>20230317 </td><td>3. <b>[SDK]</b> Add support to config threshold for motion and noise in lua script </td></tr>
<tr>
<td>20230317 </td><td>4. <b>[SDK]</b> Add option to disable frame sync for applying cv outpus bbox, set dsp_pts = 0 in non frame sync case </td></tr>
<tr>
<td>20230317 </td><td>5. <b>[SDK]</b> Add option to choose motion value is from preanalysis or cv outpus bbox when cv is enabled </td></tr>
<tr>
<td>20230317 </td><td>6. <b>[SDK]</b> Fix issue smartrc cv buf is full when the stream has no valid frame but still in encoding state </td></tr>
<tr>
<td>20230317 </td><td>7. <b>[SDK]</b> Fix the issue of SmartRC reset after 256th frame, due to u8 overflow in SmartRC V3 lib </td></tr>
<tr>
<td rowspan="4">3.0.19</td><td>20230410 </td><td>1. <b>[SDK]</b> Add new API to update log-level on the fly. </td></tr>
<tr>
<td>20230410 </td><td>2. <b>[SDK]</b> Keep the SmartRC thread running instead exiting when dealing with MJPEG stream </td></tr>
<tr>
<td>20230410 </td><td>3. <b>[SDK]</b> Reset profile to BIG_MOTION when stream is restarted </td></tr>
<tr>
<td>20230410 </td><td>4. <b>[SDK]</b> Fix stop thread block issue </td></tr>
<tr>
<td rowspan="3">3.0.20</td><td>20230330 </td><td>1. <b>[SDK]</b> Update overlay width algin to 64 for CV5x </td></tr>
<tr>
<td>20230330 </td><td>2. <b>[SDK]</b> Query pre-frame replace sw_pts with dsp_pst </td></tr>
<tr>
<td>20230330 </td><td>3. <b>[SDK]</b> Add force IDR support for CV5x </td></tr>
<tr>
<td>3.0.24 </td><td>20230425 </td><td>1. <b>[SDK]</b> Add API to query / reset profile information </td></tr>
<tr>
<td>3.1.0 </td><td>20230506 </td><td>1. <b>[SDK]</b> Add support DSP downscale me0 to save CPU loading </td></tr>
<tr>
<td rowspan="2">3.2.0 </td><td>20230704 </td><td>1. <b>[SDK]</b> Add support frame drop for static profile </td></tr>
<tr>
<td>20230704 </td><td>2. <b>[SDK]</b> Add user_class setting check for AVC </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="srcv3_overview"></a>
1. Overview</h1>
<p >The smart rate control (SRC) library is a tool that controls bit rate according to the specific scene and focus on the regions of interest (ROIs) to maintain video quality in these areas. SmartRC is designed for internet protocol (IP) cameras and other related devices. This document explains how to use the SRC library.</p>
<p >There is no standard SmartRC definition for either H.264 (advanced video coding (AVC)) or H.265 (high-efficiency video coding (HEVC)). It was designed to effectively increase the number of bits saved for various types of video and maintain improved quality in two methods:</p>
<ul>
<li>Frame-level control method: saves bits by changing the frame encoding parameters to lower the target bit rate for some specific scenes</li>
<li>Macroblock (MB)-level control method: saves the bits in macro encoding unit (MB or coding tree block (CTB)) aspects by setting the quantization parameter (QP) matrix tables to the macro encoding units</li>
</ul>
<p >There are many encoding tools used for these two types of control. <br  />
<b>All parameters rely on practical video resolution, frames per second (fps), and the complexity of specific scenes. For the software development kit (SDK), the SRC library supports both <b>H.264</b> (AVC) and <b>H.265</b> (HEVC).</b></p>
<p >As H.264 and H.265 are general video coder / decoder (codec) standards, it is difficult to optimize the specific scenes and ROIs. Rather than looking for a solution to optimize H.264 or H.265 for a generic scene, the SRC library seeks to improve the <b>given</b> scene. The figure below displays the typical rate of optimization. </p><div class="image">
<img src="../../src_codec.jpg" alt=""/>
<div class="caption">
Figure 1-1. H.264 / H.265 Mature Video Codec Standard.</div></div>
<p >Most security IP cameras function with situations A or B, and some are optimized to function with situation C. The LBR library has further improvement for situations D and E. In detail, it means that the SRC library not only inherits LBR's advantages, but also has its own characteristics. The SRC library conserves bits for static areas in a selected frame. Then, these saved bits are used for other areas of motion.</p>
<hr  />
<h1><a class="anchor" id="srcv3_build"></a>
2. Building</h1>
<p >Smartrc_v3 library, header files, unit test, configuration lua file path is as below. </p><div class="fragment"><div class="line">For CV2x SDK 3.0</div>
<div class="line">    1. LIB_PATH = ambarella/prebuild/ambarella/library/smartrc3/lib/arch_v5</div>
<div class="line">    2. LIB_HEADER_PATH = ambarella/prebuild/ambarella/library/smartrc3/include</div>
<div class="line">    3. UNIT_TEST_PATH = ambarella/unit_test/<span class="keyword">private</span>/package_test/arch_v5/</div>
<div class="line">    4. LUA_PATH = ambarella/unit_test/<span class="keyword">private</span>/package_test/arch_v5/scripts</div>
<div class="line"> </div>
<div class="line">For Cooper SDK (including CV2x SDK4.0)</div>
<div class="line">  For CV2x SDK4.0</div>
<div class="line">      1. LIB_PATH = ambarella/prebuild/library/smartrc3/lib/arch_v5</div>
<div class="line">      2. LIB_HEADER_PATH = ambarella/prebuild/library/smartrc3/arch_v5/include</div>
<div class="line">      3. UNIT_TEST_PATH = ambarella/prebuild/library/smartrc3/dsp_v6/unit_test</div>
<div class="line">      4. LUA_PATH = ambarella/prebuild/library/smartrc3/dsp_v5/unit_test</div>
<div class="line">  For CV5x Cooper SDK</div>
<div class="line">      1. LIB_PATH = ambarella/prebuild/library/smartrc3/lib/arch_v6</div>
<div class="line">      2. LIB_HEADER_PATH = ambarella/prebuild/library/smartrc3/arch_v6/include</div>
<div class="line">      3. UNIT_TEST_PATH = ambarella/prebuild/library/smartrc3/dsp_v6/unit_test</div>
<div class="line">      4. LUA_PATH = ambarella/prebuild/library/smartrc3/dsp_v6/unit_test</div>
</div><!-- fragment --><p >This library can be found in the path <code>LIB_PATH</code>.</p>
<p >To use this library, choose the following options in menuconfig to compile the SRC into an application.</p>
<ul>
<li>For CV2x SDK 3.0 Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  [*] Ambarella Prebuild  ---&gt;</div>
<div class="line">        [*]   Configure Ambarella smart rate pre-analysis library</div>
<div class="line">        [*]   Configure Ambarella smartrc library V3</div>
</div><!-- fragment --></li>
<li>For Cooper Amba build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">  prebuild  ---&gt;</div>
<div class="line">      library  ---&gt;</div>
<div class="line">          [*] prebuild-smartrc3 (prebuild/library/smartrc3/dsp_v6)</div>
<div class="line">          [*]   smartrc3-test (prebuild/library/smartrc3/dsp_v6)</div>
</div><!-- fragment --></li>
<li>For Cooper Yocto build: <div class="fragment"><div class="line">build # make menuconfig</div>
<div class="line">     meta-ambalib --&gt;</div>
<div class="line">         recipes-prebuild --&gt;</div>
<div class="line">             [*] prebuild-libpreanalysis (meta-ambalib/recipes-prebuild/prebuild-libpreanalysis)</div>
<div class="line">             [*] prebuild-smartrc3 (meta-ambalib/recipes-prebuild/prebuild-smartrc3)</div>
<div class="line">     meta-ambaapp --&gt;</div>
<div class="line">         recipes-test --&gt;</div>
<div class="line">             [*] smartrc3-test (meta-ambaapp/recipes-test/smartrc3-test)</div>
</div><!-- fragment --> <hr  />
</li>
</ul>
<h1><a class="anchor" id="srcv3_design"></a>
3. Design</h1>
<p >The SRC library defines several profiles according to the different levels of motion and noise; each profile has one set of encoding parameters including frame and MB-level parameters. Different from the normal codec standards, the library will set frame encoding parameters actively to decrease the bit rate, such as bit rate and group of pictures (GOP) length and more. Based on the MB-level parameters, the library attempts to improve or maintain the video quality for the ROI. </p><div class="image">
<img src="../../src_main_flow.jpg" alt=""/>
<div class="caption">
Figure 3-1. Workflow of the SmartRC Library.</div></div>
<h2><a class="anchor" id="srcv3_preanalysis"></a>
3.1 Preanalysis</h2>
<p >The SRC library performs precise motion detection with the input of 1/16-downscaled luma data. The outputs contain three types of maps: a motion map, an uncovered area (UA) map, and a static area map. The motion map records all of the moved pixels, and then compares this to the reference frames. The UA map records all pixels that cannot be located in the reference frames. The static area map records all background pixels and compares them to the reference frames. These maps will be referred to when performing frame-level and MB-level control.</p>
<h2><a class="anchor" id="srcv3_fctl"></a>
3.2 Frame-Level Control</h2>
<p >The maps are used to determine the current profile for the specific scene. The SRC library counts the motion map and caculates its percentage in one frame. It marks this frame as a static frame / small motion frame / mid-motion frame / big motion frame. The SRC library also counts these different motion type frames in one GOP, and decides to switch to different profiles by comparing these counts with the pre-defined or user-defined thresholds.</p>
<p >When switching to a new profile, the frame-level parameter settings for this profile will be updated to the digital signal processor (DSP). The structure of the frame encoding parameters is <a class="el" href="../../d6/ddc/structsmartrc__frame__params__table__t.html">smartrc_frame_params_table_t</a>. Frame-level controls affect the bit rate directly, and all frame-level parameters are in the file <code>LUA_PATH/smartrc_example.lua</code>.</p>
<p >The advantage of frame-level control is that the library can switch profiles and decrease the bit rate for static scenes. Using encoding tools, such as P-frame skip, frame-level control can maintain good quality at a low bit rate for static scenes. </p><div class="image">
<img src="../../src_static_compare.jpg" alt=""/>
<div class="caption">
Figure 3-2. H.264 100-Kbps Static Scene SRC On / Off.</div></div>
<h2><a class="anchor" id="srcv3_roictl"></a>
3.3 ROI-Level Control</h2>
<p >Along with the frame encoding parameters, each profile has a set of MB-level encoding parameters <a class="el" href="../../dd/d7a/structsmartrc__roi__params__table__t.html">smartrc_roi_params_table_t</a>. These parameters are filled into QP matrix tables according to the maps. As the unit of the matrix table is <a class="el" href="../../db/d98/structiav__h264__qproi__data.html">iav_h264_qproi_data</a> or <a class="el" href="../../de/d2c/structiav__h265__qproi__data.html">iav_h265_qproi_data</a>, and the resolution of the table is 1/16x1/16 (AVC) or 1/32x1/32 (HEVC) from the streams, the pixels in the maps can be mapped to the QP matrix table. This means that the MB-level parameters can be applied to specific areas, such as motion areas, in the QP matrix table.</p>
<p >The advantage of MB-level control is that the library can improve image quality for specific areas and skip the encoding of static pixels. The image below demonstrates the improvement on the moving hands. </p><div class="image">
<img src="../../src_motion_compare.jpg" alt=""/>
<div class="caption">
Figure 3-3. H.265 200-Kbps Motion Scene SRC On / Off.</div></div>
<p >Note that there are some limitations for the matrix number for HEVC, and complex GOP structures will require more matrixes (as different frame types must use different matrixes for HEVC). The table shows the relationship between the GOP structures and number of matrixes.</p>
<div class="image">
<img src="../../src_roi_matrixes.jpg" alt=""/>
<div class="caption">
Figure 3-4. ROI-Level Control.</div></div>
<p> The matrix number for each stream can be specified in the Lua script. </p><div class="fragment"><div class="line">streams_mem = {</div>
<div class="line"> {</div>
<div class="line">    qpm_possible = 1,</div>
<div class="line">    qpm_max_matrix_num = 2,  <span class="comment">// matrix number is 2</span></div>
<div class="line">    qpm_buf_max_num = 7,</div>
<div class="line">    max_stream = {1920, 1080},</div>
<div class="line"> },</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_cvctl"></a>
3.4 Computer Vision (CV) Control</h2>
<p >The SRC library supports improving video quality according to CV outputs. Once CV control is enabled, the server inside the library will be set up. The CV applications can then access the server and send the CV outputs to the SRC library. The SRC library performs frame-level and MB-level control with these outputs. The client application programming interfaces (APIs) can be found in <code>LIB_HEADER_PATH/lib_smartrc_client.h</code>, and the example code can be found in <code>UNIT_TEST_PATH/test_smartrc_ssd_live.c</code>. </p><div class="image">
<img src="../../src_cv_compare.jpg" alt=""/>
<div class="caption">
Figure 3-5. H.265 300-Kbps CV On / Off Person Detection.</div></div>
<hr  />
<h1><a class="anchor" id="srcv3_padj"></a>
4. Parameter Adjustment</h1>
<p >The file <code>LUA_PATH/smartrc_example.lua</code> includes all encoding parameters for SRC. These parameters are not fixed, as they depend on a variety of factors including the complexity of the scene, GOP structures, resolutions, and frames per second (fps). The parameters must be tuned for different cases. For example, a 100-Kbps bit rate may be suitable for a simple static scene, but if the scene is much more complex, the bit rate may be required to be inreased. For details of these frame-level and ROI-level parameters, refer to <a class="elRef" target="_blank" href="../../../video/d5/d14/fs_basic_codec.html">BASIC - H.264 / H.265 Codec</a>.</p>
<h2><a class="anchor" id="srcv3_frame_level_params"></a>
4.1 Frame-Level Parameters</h2>
<p >For frame-level parameters, decrease the average bit rate via the following steps:</p>
<ol type="1">
<li>The target bit rate can be reduced and the GOP length can be increased.</li>
<li>If the average bit rate exceeds or cannot reach the target bit rate in a specific profile, the QP limitation can be tuned. Increasing the minimum value of the limitations can decrease the size of the corresponding frames, and the frames' size will be increased when the maximum value of the limitations is decreased.</li>
<li>For static scenes, setting either frame_skip or frame_drop helps to use lower bit rates to obtain similar image quality. Note that only one parameter can be configured for static scenes; both parameters cannot be configured for non-static scenes.</li>
<li>Note that the bit rate is supposed to be increased when the motion level is increased. GOP length is also supposed to be decreased when the motion level is increased.</li>
</ol>
<h2><a class="anchor" id="srcv3_roi_level_params"></a>
4.2 ROI-Level Parameters</h2>
<p >There are two types of MB-level parameters:</p>
<ul>
<li>QP offset, which can be used to lower the QP value on MB / CTB if the QP offset is negative</li>
<li><p class="startli">Category (HEVC) and user_class (AVC), which can be used to affect the codec strategy (such as intra, inter, or skip) for each MB / CTB</p>
<p class="startli">When the user class is set to 1 for AVC, the MB will be encoded as skip type as often as is possible. Additionally, the MB will be encoded as intra or inter type as often as is possible when the user class is set to 2. Ambarella recommends using "user_class = 1" only for static maps. For details of user_class, refer to <a class="elRef" target="_blank" href="../../../video/d5/d14/fs_basic_codec.html#example_codec_roi_enc2">Set User Class Type for MB</a>.</p>
<p class="startli">For HEVC, the category can directly influence the codec type. If it is set to 1, the CTB motion vector (MV) will be processed as 0 (force zero motion vector (ZMV)). If it is set to 2, the CTB will be encoded as intra type. If it is set to 3, the QP offset will always take effect. If it is set to 4, the CTB will be encoded as skip type. For absolute static areas, the CTB category could be set to 4. For details on these category, refer to <a class="elRef" target="_blank" href="../../../video/d5/d14/fs_basic_codec.html#example_codec_roi_enc1">Set Category Lookup Table</a>.</p>
</li>
</ul>
<p >Note that applying negative QP offsets to large areas will cause the bit rate to increase. As smaller QP values for MB / CTB result in a greater size cost on the MB / CTB, Ambarella does not suggest applying negative numbers with large absolute values.</p>
<hr  />
<h1><a class="anchor" id="srcv3_lp"></a>
5. Lua Parser</h1>
<p >SRC Lua scripts are different from the Lua scripts used to enter the preview via test_encode. SRC Lua scripts are defined to configure the encoding parameters for the SRC library. All frame-level and MB-level parameters for each profile can be configured in the scripts. With the Lua parser, the scripts are parsed and the parameters are updated to the SRC library. The SRC Lua scripts can help users to more easily understand SRC control. The Lua scripts are saved in <code>LUA_PATH</code>, and there is a default Lua script for the SRC library, named <code>smartrc_example.lua</code>.</p>
<h2><a class="anchor" id="srcv3_lp_fw"></a>
5.1 Lua Description</h2>
<p >There are several profiles which can be configured in the script.</p>
<div class="fragment"><div class="line">_src_enc_cfg_ = {</div>
<div class="line">     version = 1,</div>
<div class="line">     log_level = 0,</div>
<div class="line">     profiles = {</div>
<div class="line">     profile_0,</div>
<div class="line">     profile_1,</div>
<div class="line">     profile_2,</div>
<div class="line">     profile_3,</div>
<div class="line">     profile_4,</div>
<div class="line"> },</div>
<div class="line"> </div>
<div class="line"> thresholds = { -- threshold_0 is <span class="keywordflow">for</span> motion threshold, threshold_1 is <span class="keywordflow">for</span> noise threshold</div>
<div class="line">     threshold_0,</div>
<div class="line">     threshold_1,</div>
<div class="line"> },</div>
<div class="line">},</div>
</div><!-- fragment --><p >The structure information of each profile can be configured, as shown below:</p>
<div class="fragment"><div class="line">profile_0 = {</div>
<div class="line">    profile_type = <span class="stringliteral">&quot;static_profile&quot;</span>,</div>
<div class="line">    frame_ctrl = {</div>
<div class="line">        force_idr = 1,</div>
<div class="line">        gop = {</div>
<div class="line">            ....</div>
<div class="line">        },</div>
<div class="line"> </div>
<div class="line">        qp_params = {</div>
<div class="line">            ....</div>
<div class="line">        },</div>
<div class="line"> </div>
<div class="line">        zmv_params = {</div>
<div class="line">            ....</div>
<div class="line">        },</div>
<div class="line"> </div>
<div class="line">        skip_params = {</div>
<div class="line">            ....</div>
<div class="line">        },</div>
<div class="line"> </div>
<div class="line">        drop_params = {</div>
<div class="line">            ....</div>
<div class="line">        },</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    roi_ctrl = {</div>
<div class="line">        matrix_0 = {</div>
<div class="line">            used_by = <span class="stringliteral">&quot;single_ref_P&quot;</span>,</div>
<div class="line">            maps = {</div>
<div class="line">                map_0 = {</div>
<div class="line">                    type = <span class="stringliteral">&quot;static_map&quot;</span>,</div>
<div class="line">                    ....</div>
<div class="line">                },</div>
<div class="line">                map_1 = {</div>
<div class="line">                    type = <span class="stringliteral">&quot;motion_map&quot;</span>,</div>
<div class="line">                    ....</div>
<div class="line">                },</div>
<div class="line">                map_2 = {</div>
<div class="line">                    type = <span class="stringliteral">&quot;uc_map&quot;</span>,</div>
<div class="line">                    ....</div>
<div class="line">                },</div>
<div class="line">            },</div>
<div class="line">            bbox_class = {</div>
<div class="line">                class_0 = {</div>
<div class="line">                    <span class="keywordtype">id</span> = 0,</div>
<div class="line">                    ....</div>
<div class="line">                }</div>
<div class="line">            },</div>
<div class="line">        }</div>
<div class="line">    },</div>
<div class="line">},</div>
</div><!-- fragment --><p >Profile information can be divided into the following parts:</p><ul>
<li>Specify the profile type smartrc_profile_type_e: There are several types of profiles for different scenes. The SRC library uses the parameters of different profiles according to the motions in the scenes</li>
<li>Specify motion and scene thresholds <a class="el" href="../../df/dfc/structsmartrc__level__thres__t.html">smartrc_level_thres_t</a> and smartrc_scene_thres_t: The threshold <a class="el" href="../../df/dfc/structsmartrc__level__thres__t.html">smartrc_level_thres_t</a> is used to determine the current frame level (static frame, small motion frame, mid-motion frame, big motion frame, or noise frame). The threshold <a class="el" href="../../de/d72/structsmartrc__scene__thres__t.html">smartrc_scene_thres_t</a> is used to determine the current scene level (static scene, small motion scene, mid-motion scene, big motion scene, or noise scene). Based on the accumulated scene level, SmartRC determines when to switch to a different profile</li>
<li>Parameters for frame-level control smartrc_frame_params_table_t: These parameters are used to tune video global quality. All of these parameters are coupled, so the bit rate may not achieve the target when tuning it alone. For more information about tuning frame-level parameters, refer to <a class="el" href="../../dc/d70/page_lib_src_v3.html#srcv3_padj">4. Parameter Adjustment</a></li>
<li>Parameters for MB-level control smartrc_roi_params_table_t: These parameters are used to tune ROI quality in the frames. For adjustment of these parameters, refer to <a class="el" href="../../dc/d70/page_lib_src_v3.html#srcv3_padj">4. Parameter Adjustment</a></li>
<li>Specify the matrix type: As mentioned in <a class="el" href="../../dc/d70/page_lib_src_v3.html#srcv3_roictl">3.3 ROI-Level Control</a>, there are up to three matrixes, and each matrix can be specified for use by a specific type of frame. For matrixes used by the DSP, the frame types can be divided into four types: I frames, single-reference P frames, two-reference P frames, and B frames. However, users are not required to perform any improvements at the MB-level for I frames, as they are used to specify the matrix for <b>single_ref_P</b>, <b>two_ref_P</b>, and <b>ref_B</b> </li>
<li>Specify ROI parameters @smartrc_roi_params_t for different maps smartrc_map_type_e: Different maps are used to record different types of pixels (such as static maps recording static pixels). The ROI parameters for static maps are applied to the static pixels when the frames are encoded</li>
<li>Specify ROI parameters @smartrc_roi_params_t for different types of objects detected by the CV algorithm: There are up to four classes of ROI parameters for CV which can be set. Note that the classes have no clear definition of the object category, meaning that the ROI parameters of class 0 can be used for any object. Users are required to specify the ROI parameters through the <b>roi_idx</b> in <a class="el" href="../../de/d67/structcv__bbox__info__t.html">cv_bbox_info_t</a> when sending the CV outputs to the SRC library</li>
</ul>
<hr  />
<h1><a class="anchor" id="srcv3_ut"></a>
6. Unit Test</h1>
<p >Locate the SmartRC library unit test file in the path <code>UNIT_TEST_PATH/test_smartrc_v3.c</code>. The example demonstrating how to use the SmartRC client library to send the outputs to the SRC library can be found in <code>UNIT_TEST_PATH/test_smartrc_ssd_live.c</code>.</p>
<h2><a class="anchor" id="srcv3_ut_src"></a>
6.1 Smart Rate Control Application</h2>
<ol type="1">
<li>Call the function <a class="el" href="../../df/d03/group__srcv3-general-api.html#ga0c4bc5668253a6d7ea7723cbf01450ea">smartrc_init_lib()</a> to initialize the library.</li>
<li>Call the function <a class="el" href="../../df/d03/group__srcv3-general-api.html#ga92af21a9ed2c0fc9d64f3bceaac192c7">smartrc_set_params_table()</a> to update the table of encoding parameters to the library.</li>
<li>Call the function <a class="el" href="../../df/d03/group__srcv3-general-api.html#ga19d04ddf70b10d040699a93077621b7f">smartrc_set_force_control_map()</a> to enable frame-level force control, if required.</li>
<li>Call the functions <a class="el" href="../../df/d03/group__srcv3-general-api.html#gaa13e6995619d693be84421be12be109c">smartrc_set_mask_info()</a> and <a class="el" href="../../df/d03/group__srcv3-general-api.html#ga9e2922b3265c08768ea4ded4e1bd6270">smartrc_set_file_info()</a> to set the debug settings.</li>
<li>Call the function <a class="el" href="../../df/d03/group__srcv3-general-api.html#gadd9107c960800a92f4f25c0a99531783">smartrc_enable_control()</a> to enable / disable frame-level or MB-level control.</li>
<li>Call the function <a class="el" href="../../df/d03/group__srcv3-general-api.html#ga93ff601162e39de0a514b1e6588b15cb">smartrc_enable_dynamic_gop()</a> to enable / disable dynamic GOP when frame-level control is enabled.</li>
<li>Call the functions <a class="el" href="../../df/d03/group__srcv3-general-api.html#gafb86787694db03d721dfc48ad9c41377">smartrc_start_process()</a> and <a class="el" href="../../df/d03/group__srcv3-general-api.html#gaee053b09f942aeae204637930a13a4c3">smartrc_stop_process()</a> to start / stop the SmartRC process on the fly.</li>
<li>Call the function <a class="el" href="../../d9/d55/group__srcv3-server-api.html#ga0fc45ac8de8482f03033ab3277566b26">smartrc_server_init()</a> to set up the socket server after <code><a class="el" href="../../df/d03/group__srcv3-general-api.html#ga0c4bc5668253a6d7ea7723cbf01450ea">smartrc_init_lib()</a></code> is called, and to perform bit-rate control on CV outputs if required.</li>
<li>Call the function <a class="el" href="../../df/d03/group__srcv3-general-api.html#ga00733f9a64d693553f45c8ef9a9e19dd">smartrc_deinit_lib()</a> to close the library.</li>
<li>Call the function <a class="el" href="../../d9/d55/group__srcv3-server-api.html#ga70c6ea1f75bf66ec626b5c213dbda100">smartrc_server_deinit()</a> to close the server.</li>
</ol>
<h2><a class="anchor" id="srcv3_ut_cv"></a>
6.2 Computer Vision Application</h2>
<ol type="1">
<li>Load the library <code>LIB_PATH/lib_smartrc_client.so</code> in the CV application.</li>
<li>Call the function <a class="el" href="../../da/dea/group__srcv3-client-api.html#ga9df185111b6f1216a9e04a63bfb0856e">smartrc_client_init()</a> to set up the client for the SRC server. Note that the server should be set up before the client setup request is received.</li>
<li>Call the function <a class="el" href="../../da/dea/group__srcv3-client-api.html#ga6e3417aa9867da50bf8cda64aacaabe8">smartrc_client_query_vcap_frame()</a> to query YUV information to perform an analysis.</li>
<li>Call the function <a class="el" href="../../da/dea/group__srcv3-client-api.html#gafbac38004f259364ca71b60f2d8173f1">smartrc_client_update_bbox()</a> to send bounding boxes to the SRC library.</li>
<li>Call the function <a class="el" href="../../da/dea/group__srcv3-client-api.html#ga5ff9a59162242d275c377aac354df3e7">smartrc_client_deinit()</a> to close the client.</li>
</ol>
<h2><a class="anchor" id="srcv3_ut_lp"></a>
6.3 Lua Application</h2>
<ol type="1">
<li>Call the function <a class="el" href="../../d8/d51/group__srcv3-lp-api.html#ga83cfbfdbcd64e6f53baf78b4052e509c">smartrc_parse_lua_cfg()</a> to parse the Lua scripts.</li>
<li>Call the function <a class="el" href="../../d8/d51/group__srcv3-lp-api.html#ga6e5a6e7073351cdbca5ce088d7af6a84">smartrc_create_lua_cfg()</a> to create the Lua scripts.</li>
</ol>
<hr  />
<h1><a class="anchor" id="srcv3_exp"></a>
7. Examples</h1>
<h2><a class="anchor" id="srcv3_exp_prev"></a>
7.1 Enter Preview</h2>
<p >Users are required to specify the extra buffer number for the stream-dummy-lantency feature. Modify the default configuration Lua as shown below: </p><div class="fragment"><div class="line">...</div>
<div class="line">canvas = {</div>
<div class="line">            {</div>
<div class="line">                type = <span class="stringliteral">&quot;encode&quot;</span>,</div>
<div class="line">                size = {0, 0}, -- min size to contain <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> buffers</div>
<div class="line">                <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> = {<span class="stringliteral">&quot;chan_0.main&quot;</span>,},</div>
<div class="line">                extra_dram_buf = 3,</div>
<div class="line">            },</div>
<div class="line">...</div>
<div class="ttc" id="avin__init_8c_html_a07a87b2e6ed927503e2f95f119c9fc23"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a></div><div class="ttdeci">int source</div></div>
</div><!-- fragment --><div class="fragment"><div class="line">board # init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
<div class="line">board # test_encode -A -h 1080p -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 --stream-dummy-latency 3 -e</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div><div class="ttdef"><b>Definition:</b> cJSON.h:255</div></div>
</div><!-- fragment --><p> Note that the <b>extra_dram_buf</b> of the corresponding canvas in the Lua and <b>`stream-dummy-latency`</b> in the command line should be set.<br  />
</p>
<h2><a class="anchor" id="srcv3_exp_frame"></a>
7.2 Frame-Level Control</h2>
<p >To enable frame-level control: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A --frame-control 1 -l 1</div>
</div><!-- fragment --><p> To disable dynamic GOP change when performing frame-level control: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A --frame-control 1 --dyn-gop 0 -l 1</div>
</div><!-- fragment --><p> To enable frame-level force control: If users specify frame-level control parameters without force control, the parameters will be stored in the configuration table of the current profile. The parameters take effect when the system changes back to the current motion at the next instance. If users specify the frame-level control parameters with force control, the parameters will take effect immediately. </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -l 1 --force-control 0x1F</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_roi"></a>
7.3 ROI-level Control</h2>
<p >To disable roi-level control: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A --roi-control 0 -l 1</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_roi_for_B"></a>
7.4 Apply ROI Matrix for B Frames</h2>
<p >By default, when there is a B frame in the GOP, the SRC library will skip to applying an ROI matrix to B frames in order to conserve CPU loading. Applying ROI matrixes for B frames with the option <b>enable-roi-for-B-frame</b> is also supported. </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A --roi-control 1 -l 3 --enable-roi-<span class="keywordflow">for</span>-B-frame 1</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_drwspt"></a>
7.5 Draw Spots</h2>
<p >To draw white spots on static areas in stream A: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -k -m 0 -c 255 -l 1</div>
</div><!-- fragment --><p> To draw white spots on motion areas in stream A: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -k -m 1 -c 255 -l 1</div>
</div><!-- fragment --><p> To draw black spots on uncovered areas in stream A: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -k -m 2 -c 0 -l 1</div>
</div><!-- fragment --><p> To draw black spots on bounding boxes in stream A, refer to the example <a class="el" href="../../dc/d70/page_lib_src_v3.html#srcv3_exp_cv">7.12 Cooperate with CV</a>. </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -r 8 --cv-enable 1 --cv-src 1 -l 1 -m 3</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_dm"></a>
7.6 Dump Maps</h2>
<p >Dump the static map for stream A, and save it in the <code>/tmp</code> folder: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -f /tmp/ -d 0 -l 1</div>
</div><!-- fragment --><p> Dump the motion map for stream A, and save it in the <code>/tmp</code> folder: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -f /tmp/ -d 1 -l 1</div>
</div><!-- fragment --><p> Dump the uncovered map for stream A, and save it in the <code>/tmp</code> folder: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -f /tmp/ -d 2 -l 1</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_at"></a>
7.7 Auto Tests</h2>
<p >Run the auto socket test, and draw black spots on the fake CV areas: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -r 8 --cv-enable 1 -t 0 -m 3 -c 0 -l 1</div>
</div><!-- fragment --><p> Run the auto start / stop process test: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -t 1 -l 1</div>
</div><!-- fragment --><p> Run the auto random frame control test: </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -t 2 -l 1</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_lp"></a>
7.8 Lua Script</h2>
<p >Specify the Lua scripts for the SRC library. </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -r 7 --lua /usr/local/bin/script/src_example.lua</div>
</div><!-- fragment --><p> Create Lua scripts with the parameters inside the library. </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -r 7 --lua /usr/local/bin/script/src_example.lua --lua-dump /tmp/src_dump.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_disable_low_light"></a>
7.9 Disable Low-Light Profiles</h2>
<p >There are a total of five profiles in the SmartRC Lua script; users can choose to disable low-light profiles. </p><div class="fragment"><div class="line">board # test_smartrc_v3 -A -r 15 --frame-control 1 --roi-control 1 --disable-low-light-profile 1</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_thres"></a>
7.10 Threshold of Motion and Noise in the Lua Script</h2>
<p >Ambarella supports configuring thresholds for motion / noise level and scenes in the Lua script. </p><div class="fragment"><div class="line">threshold_0 = {</div>
<div class="line">    is_valid = 1,  -- 0 : use <span class="keywordflow">default</span> threshold inside lib, 1 : use below threshold <span class="keywordflow">for</span> lib</div>
<div class="line">    threshold_type = <span class="stringliteral">&quot;motion_thres&quot;</span>,  -- motion threshold</div>
<div class="line">    level = {</div>
<div class="line">        none = 1,</div>
<div class="line">        low = 301,</div>
<div class="line">        mid = 30001,</div>
<div class="line">        high = 100001,</div>
<div class="line">    },</div>
<div class="line">    scene = {</div>
<div class="line">        none = 51,</div>
<div class="line">        low = 31,</div>
<div class="line">        mid = 21,</div>
<div class="line">        high = 4,</div>
<div class="line">    },</div>
<div class="line">}</div>
<div class="line">threshold_1 = {</div>
<div class="line">    is_valid = 1,  -- 0 : use <span class="keywordflow">default</span> threshold inside lib, 1 : use below threshold <span class="keywordflow">for</span> lib</div>
<div class="line">    threshold_type = <span class="stringliteral">&quot;noise_thres&quot;</span>,  -- noise threshold</div>
<div class="line">    level = {</div>
<div class="line">        none = 1,</div>
<div class="line">        low = 19,</div>
<div class="line">        mid = 21,</div>
<div class="line">        high = 25,</div>
<div class="line">   },</div>
<div class="line"> </div>
<div class="line">   scene = {</div>
<div class="line">       none = 121,</div>
<div class="line">       low = 61,</div>
<div class="line">       mid = 11,</div>
<div class="line">       high = 1,</div>
<div class="line">   },</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">board # test_smartrc_v3 -A -r 7 --lua /usr/local/bin/script/src_example.lua</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_apply_cv_output_with_non_frame_sync"></a>
7.11 Apply CV Output with Non-Frame Sync Mode</h2>
<p >By default, when CV is enabled, the SmartRC library performs frame synchronization with CV output; this means that CV applications can correct a YUV frame's <code>dsp_pts</code>. Non-frame sync is also supported without setting <code>dsp_pts</code>.</p>
<div class="fragment"><div class="line">board # test_smartrc_v3 -A -r 15 --frame-control 1 --roi-control 1 --cv-enable 1 --cv-src 0 -t 0 --disable-frame-sync-<span class="keywordflow">for</span>-cv 1</div>
</div><!-- fragment --><h2><a class="anchor" id="srcv3_exp_cv"></a>
7.12 Cooperate with CV</h2>
<p >Run the CV application to perform object detection and send the bounding boxes of humans to the SRC library for SRC control. Mark the human region(s) on the stream and on the high-definition multimedia interface (HDMIÂ®) video. </p><div class="fragment"><div class="line">board # init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # rmmod ambarella_fb;modprobe ambarella_fb resolution=720x480 mode=clut8bpp buffernum=4</div>
<div class="line">board # modprobe cavalry;cavalry_load -f /lib/firmware/cavalry.bin -r</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear_qp.lua --enc-mode 5 --resource-mem-cfg-enable 1</div>
<div class="line">        --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua -A -h1080p -b0 --stream-dummy-latency 2 --gop 0 --frame-factor 1/1 -e (<span class="keywordflow">for</span> cv5x cooper SDK)</div>
<div class="line">board # test_encode --resource-cfg /usr/local/bin/scripts/cv2_vin0_4k_linear_qp.lua --enc-mode 5 --resource-mem-cfg-enable 1</div>
<div class="line">        --hdmi 1080p -A -h1080p -b0 --stream-dummy-latency 2 --gop 0 --frame-factor 1/1 -e (<span class="keywordflow">for</span> cv2x SDK 3.0)</div>
<div class="line">board # test_smartrc_v3 -A -r 8 --cv-enable 1 --cv-src 1 -l 1 -m 3</div>
<div class="line">board # test_yolo_live_smartrc -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> /root/onnx_yolov3_cavalry.bin  -l /root/label_coco_80.txt --in input.1 --out 290 --out 352 --out 414</div>
<div class="line">        -a /root/live_yolov3_anchors.txt  -t 1 -c 80 -s 0 -n 0.7 --width 300 --height 300 (another console)</div>
</div><!-- fragment --><p> Note that the canvas settings should be configured in the Lua script for specific CV examples. The <b>`enc-dummy-latency`</b> should also be set, as it is used by the SRC library to synchronize CV outputs with preanalysis outputs.</p>
<p >The option <b>`-c`</b> of the CV application is used to specify the class ID in order to perform SRC control. The meaning of the class ID is as described below: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">CLASS NAME   </th><th class="markdownTableHeadCenter">CLASS ID    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BACKGROUND   </td><td class="markdownTableBodyCenter">0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">AEROPLANE   </td><td class="markdownTableBodyCenter">1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BICYCLE   </td><td class="markdownTableBodyCenter">2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">BIRD   </td><td class="markdownTableBodyCenter">3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BOAT   </td><td class="markdownTableBodyCenter">4    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">BOTTLE   </td><td class="markdownTableBodyCenter">5    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">BUS   </td><td class="markdownTableBodyCenter">6    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CAR   </td><td class="markdownTableBodyCenter">7    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CAT   </td><td class="markdownTableBodyCenter">8    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">CHAIR   </td><td class="markdownTableBodyCenter">9    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">COW   </td><td class="markdownTableBodyCenter">10    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">TABLE   </td><td class="markdownTableBodyCenter">11    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">DOG   </td><td class="markdownTableBodyCenter">12    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">HORSE   </td><td class="markdownTableBodyCenter">13    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MOTORBIKE   </td><td class="markdownTableBodyCenter">14    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">PERSON   </td><td class="markdownTableBodyCenter">15    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">PLANT   </td><td class="markdownTableBodyCenter">16    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SHEEP   </td><td class="markdownTableBodyCenter">17    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SOFA   </td><td class="markdownTableBodyCenter">18    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">TRAIN   </td><td class="markdownTableBodyCenter">19    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TV   </td><td class="markdownTableBodyCenter">20   </td></tr>
</table>
<h2><a class="anchor" id="srcv3_exp_cvo"></a>
7.13 Draw CV Boxes</h2>
<p >If users run cases with CV, they can draw CV box overlays on the stream with the options <b>`cv-overlay-enable`</b> and <b>`cv-overlay-color`</b>. </p><div class="fragment"><div class="line">board # init.sh --na;modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # rmmod ambarella_fb;modprobe ambarella_fb resolution=720x480 mode=clut8bpp buffernum=4</div>
<div class="line">board # modprobe cavalry;cavalry_load -f /lib/firmware/cavalry.bin -r</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear_qp.lua --enc-mode 5 --resource-mem-cfg-enable 1</div>
<div class="line">      --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua -A -h1080p -b0 --stream-dummy-latency 2 --gop 0 --frame-factor 1/1 -e (<span class="keywordflow">for</span> cv5x cooper SDK)</div>
<div class="line">board # test_encode --resource-cfg /usr/local/bin/scripts/cv2_vin0_4k_linear_qp.lua --enc-mode 5 --resource-mem-cfg-enable 1</div>
<div class="line">        --hdmi 1080p -A -h1080p -b0 --stream-dummy-latency 2 --gop 0 --frame-factor 1/1 -e (<span class="keywordflow">for</span> cv2x SDK 3.0)</div>
<div class="line">board # test_smartrc_v3 -A -r 8 --cv-enable 1 --cv-src 1 -l 1 --cv-overlay-enable 1 --cv-overlay-color 1</div>
<div class="line">board # test_yolo_live_smartrc -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> /root/onnx_yolov3_cavalry.bin  -l /root/label_coco_80.txt --in input.1 --out 290 --out 352 --out 414</div>
<div class="line">        -a /root/live_yolov3_anchors.txt  -t 1 -c 80 -s 41 -n 0.7 --width 300 --height 300 (another console)</div>
</div><!-- fragment --> <div class="image">
<img src="../../src_cv_overlay.png" alt=""/>
<div class="caption">
Figure 7-1. SmartRC CV Overlay.</div></div>
 <hr  />
<h2><a class="anchor" id="srcv3_exp_motion"></a>
7.14 Choose Motion from CV Bbox or PA Library</h2>
<p >If users run cases with CV, by default, the motion detection is from the CV Bbox. The option <b>`disable-motion-from-cv`</b> can be used to choose motion detection from the PA library. </p><div class="fragment"><div class="line">board # init.sh --imx290_mipi</div>
<div class="line">board # test_aaa_service -a &amp;</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_4k_linear_qp.lua --enc-mode 5 --resource-mem-cfg-enable 1</div>
<div class="line">      --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua -A -h1080p -b0 --stream-dummy-latency 2 --gop 0 --frame-factor 1/1 -e (<span class="keywordflow">for</span> cv5x cooper SDK)</div>
<div class="line">board # test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv25_vin0_1080p_linear_mem_cfg.lua --hdmi 720p --resource-mem-cfg-enable 1</div>
<div class="line">        --enc-dummy-latency 2 --ors 1280x720 -A -h 1920x1080 -<a class="code hl_variable" href="../../d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> 0 --stream-dummy-latency 2  --gop 6 --frame-factor 1/1 -e (<span class="keywordflow">for</span> CV2x SDK3.0)</div>
<div class="line">board # test_smartrc_v3 -A -r 15 --frame-control 1 --roi-control 1 --cv-enable 1 --cv-src 0 -t 0 -l 3 --disable-motion-from-cv 1</div>
</div><!-- fragment --> <hr  />
<h1><a class="anchor" id="srcv3_tuning"></a>
8. Tuning Guide</h1>
<p >Ambarella recommends tuning the <code>frame_level</code> parameters first, and then tuning the <code>roi_level</code> parameters.</p>
<h2><a class="anchor" id="srcv3_frame_level_tuning"></a>
8.1 Tuning Frame-Level Parameters</h2>
<p >There are too many frame-level parameters that can be tuned. Ambarella suggests tuning the GOP length, bit rate, QP limitations, and one-by-one QP reduction first. Then, tune the other parameters for final video quality and bit rate. All frame-level parameters can be found in the default Lua script (smartrc_example.lua).</p>
<h3><a class="anchor" id="srcv3_gop_tuning"></a>
8.1.1 GOP Length</h3>
<p >Determine the GOP length for different profiles.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The higher the profile, the smaller the GOP.</li>
</ul>
</dd></dl>
<p>The following is an example. Users can determine the GOP for their real use cases. </p><div class="fragment"><div class="line">Static profile: 180</div>
<div class="line">Small motion profile: 120</div>
<div class="line">Middle motion profile: 60</div>
<div class="line">Big motion profile:30</div>
<div class="line">Low light profile: 30</div>
</div><!-- fragment --><h3><a class="anchor" id="srcv3_bitrate_tuning"></a>
8.1.2 Bit Rate</h3>
<p >Determine the bit rate for different profiles.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The higher the profile, the larger the bit rate.</li>
</ul>
</dd></dl>
<p>Get the acceptable target bit rate via <code>test_encode</code> at this stage (do not use <code>test_smartrc_v3</code>).</p>
<p >Find the lowest-possible bit rate which results in acceptable video quality. For example, set the target bit rate to 1 Mbps for the specified 1080p30 stream of the real case scene at the beginning, and then increase the bit rate if the video quality is not acceptable (or decrease it if it is acceptable).</p>
<div class="fragment"><div class="line">board # test_encode -A -h 1080p -bitrate 800000 -N 60</div>
<div class="line">board # test_encode -A -h 1080p -bitrate 700000 -N 60</div>
<div class="line">board # test_encode -A -h 1080p -bitrate 600000 -N 60</div>
</div><!-- fragment --><p >When obtaining a reasonable bit rate for the real case scene, find the bit rate for big-motion scenes first. Once the big-motion bit rate is a reasonable value, users can set 80% of the big-motion bit rate for mid-motion profiles, and 80% of the mid-motion bit rate for small-motion profiles, and 80% of the small-motion bit rate for static scenes. 80% is a suggested value; users can determine the correct coefficient according to their real scenes.</p>
<h3><a class="anchor" id="srcv3_qp_limitation_tuning"></a>
8.1.3 QP Limitation</h3>
<p >Determine the QP limitation for different frames for different profiles.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>For I frames, users can set lower values for both the minimum / maximum of <code>i_qp_limit</code>, compared to P frames. This results in improved quality for I frames. Better I-frame quality allows for better video quality.</li>
<li>Users can set proportionally larger values for both the minimum / maximum of <code>qp_limit</code> for larger profiles, as they already have a greater bit rate.</li>
<li>Ambarella suggests setting a relatively wide range for <code>qp_limit</code> (do not set a narrow range).</li>
</ul>
</dd></dl>
<p>When obtaining a reasonable bit rate, the bit rate may lose control and exceed or fail to reach the target. This occurs due to unsuitable QP parameters, particularly QP limitations. Before analyzing these cases, it is important to note the following:</p>
<ul>
<li>The rate controller inside the DSP pre-allocates bits for each frame according to the target bit rate, GOP length, encoding fps, and the allocation for the former GOP. The bits for different types of frames are allocated with different weights, which are determined by the QP reduction parameters (such as <code>i_qp_reduce</code> and <code>p_qp_reduce</code>).</li>
<li>Once the bits are pre-allocated, the rate controller inside the DSP obtains a reference QP called "slice
QP". After adding the QP offset of ROI matrixes on the slice QP, the rate controller can obtain the QP for each MB / CTU.</li>
<li>However, it is not the final value, as the rate controller compares it with the QP limitations (which are specified by the userâs options). If the value is beyond the boundaries of the limitation, the controller uses the boundary values as the final QP for each MB / CTU. Otherwise, the QP is considered as valid, and it is used as the final QP for the MB / CTU.</li>
<li>Further, note that the controller allows the QP to exceed the boundaries within a certain range if the parameter <code>adapt-qp</code> is set.</li>
<li>The bits spent for each MB / CTU depends on the QP value and the codec type. The smaller the QP, the more bits are spent on each MB / CTU.</li>
</ul>
<p >The issue of the real bit rate being unable to reach the target value occurs because the target bit rate is too high, and the QP of each MB / CTU calculated according to the bit rate pre-allocation is smaller than the minimum value of the QP limitations, so the controller takes the boundary value instead of the QP value that was calculated. In this case, the real bit rate is limited by the QP limitations. To solve this issue, Ambarella recommends decreasing the minimum value of the QP limitations.</p>
<div class="fragment"><div class="line">board # test_encode -A -h 1080p --bitrate 800000 -N 60 --qp-limit-i 20~51</div>
<div class="line">board # test_encode -A -h 1080p --bitrate 800000 -N 60 --qp-limit-i 13~51</div>
</div><!-- fragment --><h3><a class="anchor" id="srcv3_qp_reduce_tuning"></a>
8.1.4 QP Reduction</h3>
<p >Determine QP reduction for different frames of different profiles.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>In cases when the bit rate is very sensitive, and the user requires a relatively low bit rate, the user can increase <code>i_qp_reduce</code>. This operation allocates more bits on the I frame, which results in improved video quality.</li>
<li>In cases when the final bit rate exceeds the target value, one possibility is that the target bit rate is too low, which leads to the decreased quality for the current frame. When next frame is encoded, the difference between reference frame is large, causing most of the MB / CTU to be encoded as intra or inter even in static scenes. Many more bits than expected are used in this case. To resolve this issue, increase the I frame QP reduction value. The encoder allocates more bits for the I frame and decreases the maximum value of I frame QP limitations, which results in an improved I frame, which is used as a reference. If this method does not resolve the issue, increase the target bit rate.</li>
</ul>
</dd></dl>
<div class="fragment"><div class="line">board # test_encode -A -h 1080p --bitrate 800000 -N 60 --qp-limit-i 20~51 --i-qp-reduce 4</div>
<div class="line">board # test_encode -A -h 1080p --bitrate 800000 -N 60 --qp-limit-i 13~51 --i-qp-reduce 6</div>
</div><!-- fragment --><h3><a class="anchor" id="srcv3_skip_frame_drop_frame_tuning"></a>
8.1.5 Skip_frame and Drop_frame</h3>
<p >Determine <code>skip_frame</code> and <code>drop_frame</code> only for static profiles.</p>
<p >For static profiles, users can enable <code>skip_frame</code> or <code>drop_frame</code> to save bit rates. Only one is supported for static profiles.</p>
<h3><a class="anchor" id="srcv3_chroma_qp_offset_tuning"></a>
8.1.6 Chroma_qp_offset</h3>
<p >Determine the chroma QP offset for different profiles.</p>
<p >When there is no bit rate margin, but there is a video color artifact, users can set a reasonable chroma QP offset for the real scene.</p>
<h3><a class="anchor" id="srcv3_zmv_threshold_qp_offset_tuning"></a>
8.1.7 Zmv_threshold_qp_offset</h3>
<p >Determine <code>zmv_threshold_qp_offset</code> for ZMV MBs.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li><code>zmv_threshold_qp_offset</code> is only supported for CV2x and H.264.</li>
<li>This should be combined with the ROI-level parameter <code>zmv_threshold</code>, which is used for rate control inside the DSP to figure out small noise on a stationary background. If there is a small amount of noise on a stationary background, the MB is encoded as skip; otherwise, the rate control will add <code>zmv_threshold_qp_offset</code> for these MBs.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="srcv3_roi_level_tuning"></a>
8.2 Tuning ROI-Level Parameters</h2>
<p >Due to the large number of ROI-level parameters, only some can be tuned at one time. There are different ROI maps (static maps, motions map, and UA maps) for different profiles; users can set different ROI-level parameters for these different MBs / CTUs based on the maps. All frame-level parameters can be found in the default Lua script.</p>
<h3><a class="anchor" id="srcv3_qp_adjust_tuning"></a>
8.2.1 QP Adjust (QP Offset)</h3>
<p >Determine the QP adjustment (QP offset) for different profiles. Users can get improve quality for the specific ROI area by setting a reasonable QP adjustment value.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The QP adjustment values for uncovered-area ROIs should be larger negative values than those of motion ROIs, and the QP adjustment values for motion ROIs should be more negative than those of static ROIs (for example, -8 for the uncovered-area ROI, -5 for the motion ROI, and 0 for the static ROI).</li>
<li>The larger the profile, the less negative the QP adjustment is (for example: -8 for big-motion profiles, -6 for uncovered-area ROIs, -4 for motion ROIs, 0 for static ROIs, -4 for mid-motion profiles, -8 for uncovered-area ROIs, -6 for motion ROIs, and -2 for static ROI).</li>
</ul>
</dd></dl>
<h3><a class="anchor" id="srcv3_user_class_tuning"></a>
8.2.2 User Class</h3>
<p >Determine <code>user_class</code> for different ROI. This is used for H.264 encoding.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>For static ROIs, set <code>user_class = 1</code> to be encoded as skip type for this MB in order to conserve static MB bit rates.</li>
<li>For motion and uncovered-area ROIs, <code>set user_class = 2</code> to be encoded as intra / cinter type for this MB.</li>
<li>Users can set <code>user_class = 0</code> for static / motion / uncovered-area ROIs, which enales the DSP to choose the encoding type for these MBs / CTUs.</li>
</ul>
</dd></dl>
<h3><a class="anchor" id="srcv3_category_tuning"></a>
8.2.3 Category</h3>
<p >Determine the category for different ROIs. This is used for H.265 encoding.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Set reasonable categories in the range [0, 4] for different ROIs.</li>
<li>For static ROIs, set <code>category = 4</code> to be force encoded as skip type. This can save static MB bit rates; Ambarella recommends that this is used in static profiles only.</li>
<li>For uncovered-area ROIs, set <code>category = 3</code> to be force encoded as UC.</li>
<li>For motion ROIs, set <code>category = 2</code> to be force encoded as intra type.</li>
<li>Users can set <code>category = 0</code> for all ROIs, which enables the DSP to choose the encoding type for these MBs / CTUs.</li>
</ul>
</dd></dl>
<h3><a class="anchor" id="srcv3_zmv_threshold_tuning"></a>
8.2.4 ZMV Threshold</h3>
<p >Determine the ZMV threshold for different ROIs.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>ZMV threshold is only supported on CV2x and for H.264 encoding.</li>
</ul>
</dd></dl>
<p>Ambarella recommends setting <code>zmv_threshold = 8 (or 16)</code> for static ROIs. This is used for rate control inside the DSP to mitigate small amounts of noise on a stationary background. If it is a small amout of noise, it will be encoded as skip type; otherwise, <code>zmv_threshold_qp_offset</code> will be applied on the MB.</p>
<p >Ambarella does not recommend setting <code>zmv_threshold</code> for other ROIs.</p>
<h2><a class="anchor" id="srcv3_fine_tuning"></a>
8.3 Fine-Tuning by EFR</h2>
<p >After reasonable frame-level parameters have been set, users can use <code>test_smartrc_v3</code> to tune ROI-level parameters to improve video quality and bit rate. Follow the steps below.</p>
<ol type="1">
<li>Capture high bit-rate (such as 20 MB) video clips under real use case scenes. Users can also capture YUV sequences. Ensure that the video clips include different motions under real use case scenes.</li>
<li>Decode the video clips to YUV sequences (NV12 format) with ffmpeg. This step is not required when YUV sequences are captured. <div class="fragment"><div class="line">ffmpeg -i input.mp4 -an -pix_fmt nv12 -s 2592x1944 -filter:v <span class="stringliteral">&quot;select=&#39;between(n\, 0\, 660)&#39;&quot;</span> output_nv12.yuv</div>
</div><!-- fragment --></li>
<li>Perform a raw encode with the NV12 YUV sequences, and then use it to begin encoding.</li>
<li>Run <code>test_smartrc_v3</code> with reasonable frame-level parameters, and tune the ROI-level parameters as needed.</li>
<li>Begin capturing this stream, which enables SmartRC. Check the stream's quality and bit rate.</li>
<li>Update the ROI-level parameters if the video quality or bit rate is not acceptable, then perform steps 4 and 5.</li>
</ol>
<hr  />
<h1><a class="anchor" id="srcv3_faq"></a>
9. FAQ</h1>
<p >This chapter lists possible questions and answers related to the SmartRC library, helping readers to understand SmartRC.</p>
<p ><b>Question:</b> Does the SmartRC library have different encoding standards for H.264 / AVC and H.265 / HEVC?</p>
<p ><b>Answer:</b> No, because the SmartRC library is an optimization of the H.264 / AVC and H.265 / HEVC encoder that is used in rate control to improve efficiency, especially for security IP cameras with a static background.</p>
<p ><b>Question:</b> What's the unit for threshold specified in smartrc lua script, and what is it used for?</p>
<p ><b>Answer:</b> </p><ol type="1">
<li>For threshold_0's level none / low / mid / high, it is frame-level threshold, its unit is a percentage with multipy 1000000, such as low = 300, mid = 30000, it means 300 / 1000000 = 0.03%, 30000 / 1000000 = 3%. When motion value is in range [0, low), this frame is a static frame; when it is in range [low, mid), it is a low-motion frame; when it is in range [mid high), it is a mid-motion frame; and when it is larger than high, it is a high-motion frame.</li>
<li>For threshold_0's scene none / low / mid / high, it is scene-level threshold, its unit is also percentage, it means how many different motion-type frame in one GOP. It is used for switching from low motion profile to high motion profile, in this situation, smartrc will switch profile immediately but not wait one GOP time. It is used to switch to different motion profiles.</li>
<li>For threshold_1's level none / low / mid / high, it is frame-level threshold, only low and high is valid, and its unit is sensor agc db value. When sensor agc db value is in range [0, low), it is a none-noise frame; when it is in range [low, hight), it is a low-nosie frame; when its value is larger than high, it is a high-noise frame.</li>
<li>For threshold_1's scene none / low / mid / high, it is scene-level threshold, only low and high is valid, its unit is noise frame counts, means how many different noise-type frame. It is used to switch to low light profile.</li>
</ol>
<p ><b>Question:</b> How and when does SmartRC library switch to a new profile?</p>
<p ><b>Answer:</b> Bacially, for each frame, SmartRC libarary calculates its motion value, and determines frame's motion level by comparing motion value with frame level threshold (determined inside lib or user specified by threshold_0's level none / low / mid / high value and threshold_1's level none / low / mid / high value). Meanwhile, SmartRC libarary counts different frame types (static frames / motion frames) in one GOP and determine scene motion level in this GOP based on the motion threshold (determined inside lib or user specified by threshold_0's scene none / low / mid / high value and threshold_1's scene none / low / mid / high value). If the scene motion level changed, then SmartRC switches to a new profile, different GOP length and different stream framerate may take different time for the switch. When switching to low motion profile, SmartRC libarary will switch proflie step by step : high motion --&gt; mid motion --&gt; low motion --&gt; static. When switching to high motion profile, SmartRC libarary will switch proflie immediately but doesn't wait one GOP.</p>
<p ><b>Question:</b> When does SmartRC libarary apply frame level parameters?</p>
<p ><b>Answer:</b> Smartrc libarary will apply new frame level encoding parameters to DSP when switching to a new profile, including GOP structure, qp parameters (including bitrate, qp_reduce, qp_limit, adapt_qp), ...</p>
<p ><b>Question:</b> When does SmartRC libarary apply ROI level parameters?</p>
<p ><b>Answer:</b> Smartrc libarary will apply new ROI level encoding parameters to DSP for every frame runtime no matter if switching to a new profile or not.</p>
<hr  />
<h1><a class="anchor" id="srcv3_api"></a>
10. SmartRC APIs</h1>
<p >Visit the following links for details of the API functions.</p><ul>
<li><a class="el" href="../../de/dc3/group__srcv3-api.html">SmartRC Library API</a> explains API functions.</li>
<li><a class="el" href="../../db/d15/group__srcv3-helper.html">SmartRC Library helper</a> shows related structures, macros, and enumerations.</li>
</ul>
<hr  />
<h1><a class="anchor" id="srcv3_lic"></a>
11. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ( "Software" ) are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
