<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Peripherals: EMMC</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Peripherals"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Peripherals<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/d93/si_emmc.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">EMMC </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="hardware_setting"></a>
1. Hardware Setting</h1>
<p >The Cooper system on chip (SoC) can be configured to enable the eMMC controller. When the power-on configuration uses eMMC, the system boots from the eMMC devices. Because the EVK board default configuration uses NAND flash as a storage / boot media, a hardware rework is required to support the eMMC devices, and an SDIO interface is used. If the eMMC is the boot up device, a proper POC setup is also required.<br  />
 Refer to <em>Ambarella DG Flexible Linux SDK NAND NOR Flash EMMC Selection Qualification</em> for verified eMMC information.</p>
<h2><a class="anchor" id="poc_setting"></a>
1.1 POC Setting</h2>
<p ><code>POC[5:4](BOOT MODE)</code> are used to set the booting media, POC[4:5]=0b01 means to boot up from eMMC.<br  />
 <code>POC[21, 20:14](BOOT OPTION[8:1])</code> are used to configure detailed options.<br  />
 Set them according to the hardware design and eMMC specifications. Bus width must be chosen between 4 bits and 8 bits.</p>
<a class="anchor" id="table_vsrc_lua"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th><div><b>POC</b></div> </th><th><div><b>POC Function</b></div> </th><th><div><b>POC Value 1</b></div> </th><th><div><b>POC Value 0</b></div> </th><th><div><b>Recommended Settings</b></div> </th></tr>
<tr>
<td>BOOT OPTION[8] </td><td>MMC controller choose </td><td>use legacy MMC controller </td><td>use Synposys MMC controller </td><td>1 </td></tr>
<tr>
<td>BOOT OPTION[6] </td><td>tRSCA sel boot delay </td><td>tRSCA=10000 SD clock cycles </td><td>tRSCA=75 SD clock cycles </td><td>0 by default Depends on the eMMC </td></tr>
<tr>
<td>BOOT OPTION[5] </td><td>tRSCA enable boot delay </td><td>Enable the tRSCA delay during the boot initialization </td><td>Disable the tRSCA delay during the boot initialization </td><td>1 </td></tr>
<tr>
<td>BOOT OPTION[4] </td><td>eMMC enable reset </td><td>Controller will drive sd_reset pin </td><td>Controller will not drive sd_reset pin </td><td>1 </td></tr>
<tr>
<td>BOOT OPTION[3] </td><td>eMMC boot sd pull </td><td>Internal pull-high on sd_cmd and sd_d[7:0] </td><td>No pull on sd_cmd and sd_d[7:0] </td><td>1 </td></tr>
<tr>
<td>BOOT OPTION[2] </td><td>4-bit bus width </td><td>Use 4-bit data pins for booting </td><td>x </td><td>Depends on the design </td></tr>
<tr>
<td>BOOT OPTION[1] </td><td>8-bit bus width </td><td>Use 8-bit data pins for booting </td><td>x </td><td>Depends on the design </td></tr>
</table>
<p><br  />
</p>
<div class="image">
<img src="../../emmc_example_of_trsca_timing_specification.png" alt=""/>
<div class="caption">
Figure 1-1. Example of tRSCA Timing Specification.</div></div>
<p >CV5 Timn EVK<br  />
</p><ul>
<li>SW7[7] â€“ ON, SW7[6] - OFF</li>
<li>SW6[1] - ON</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>For Option B, the Max Clock of SD0 needs to be lowered to <b>50MHz</b> (current is 100MHz).</dd></dl>
<p>The following shows pins, bits, and clock reates for eMMC boot options. </p><dl class="section user"><dt>Pins, Bits, and Clock Rates for eMMC Boot Options</dt><dd><a class="anchor" id="table_emmc_boot"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th><div>Option A</div> </th><th></th><th colspan="4"><div>For eMMC Boot</div> </th></tr>
<tr>
<td><b>Pins</b> </td><td><b>Bits</b> </td><td><b>POC17/<b> </b></b></td><td><b><b> <b>POC21</b> </b></b></td><td><b><b> <b>eMMC Boot</b> </b></b></td><td><b><b> <b>Max Clock(MHz)</b> </b></b></td></tr>
<tr>
<td><b><b> SD0 </b></b></td><td><b><b> 8 </b></b></td><td><b><b> 1 </b></b></td><td><b><b> 1 </b></b></td><td><b><b> o </b></b></td><td><b><b> 200 </b></b></td></tr>
<tr>
<td><b><b> SDIO0 </b></b></td><td><b><b> 4 </b></b></td><td><b><b> 1 </b></b></td><td><b><b> 1 </b></b></td><td><b><b> x </b></b></td><td><b><b> 200 </b></b></td></tr>
<tr>
<td><b><b> SDIO1 </b></b></td><td><b><b> 4 </b></b></td><td><b><b> 1 </b></b></td><td><b><b> 1 </b></b></td><td><b><b> x </b></b></td><td><b><b> 50 </b></b></td></tr>
<tr>
<th><b><b> <div>Option B</div> </b></b></th><th><b><b> </b></b></th><th colspan="4"><b><b> <div>For eMMC Boot</div> </b></b></th></tr>
<tr>
<td><b><b> <b>Pins</b> </b></b></td><td><b><b> <b>Bits</b> </b></b></td><td><b><b> <b>POC17/<b> </b></b></b></b></td><td><b><b><b><b> <b>POC21</b> </b></b></b></b></td><td><b><b><b><b> <b>eMMC Boot</b> </b></b></b></b></td><td><b><b><b><b> <b>Max Clock(MHz)</b> </b></b></b></b></td></tr>
<tr>
<td><b><b><b><b> SD0 </b></b></b></b></td><td><b><b><b><b> 8 </b></b></b></b></td><td><b><b><b><b> 1 </b></b></b></b></td><td><b><b><b><b> 1 </b></b></b></b></td><td><b><b><b><b> o </b></b></b></b></td><td><b><b><b><b> 50 </b></b></b></b></td></tr>
<tr>
<td><b><b><b><b> SDIO0 </b></b></b></b></td><td><b><b><b><b> 4 </b></b></b></b></td><td><b><b><b><b> 1 </b></b></b></b></td><td><b><b><b><b> 1 </b></b></b></b></td><td><b><b><b><b> x </b></b></b></b></td><td><b><b><b><b> 200 </b></b></b></b></td></tr>
<tr>
<td><b><b><b><b> SDIO1 </b></b></b></b></td><td><b><b><b><b> 4 </b></b></b></b></td><td><b><b><b><b> 1 </b></b></b></b></td><td><b><b><b><b> 1 </b></b></b></b></td><td><b><b><b><b> x </b></b></b></b></td><td><b><b><b><b> 200 </b></b></b></b></td></tr>
</table>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd><b><b><b><b><ul>
<li>Option A is eMMC boot and SD0 8-bit with maximum clock rate 200 MHz, but SDIO1 maximum clock reta supports 50 MHz only.<br  />
</li>
<li>Option B is eMMC boot and SD0 8-bit maximum clock rate 50 MHz, and the SDIO1 maximum clock reta can be up to 200 MHz.</li>
</ul>
</b></b></b></b></dd></dl>
<p>Contact the Ambarella support team for further questions.</p>
<p ><b><b><b><b></p><hr  />
<p></b></b></b></b></p>
<p ><b><b><b><b></b></b></b></b></p>
<h1><a class="anchor" id="configuration_and_compile"></a>
2. Configuration and Compile</h1>
<p ><b><b><b><b> The default eMMC configuration is as follows: </p><div class="fragment"><div class="line">build $ make cv5x_ipcam_emmc_config</div>
</div><!-- fragment --><p></b></b></b></b></p>
<p ><b><b><b><b>in <code>SDK/ambarella/board/cv5x_board</code>. </p><div class="fragment"><div class="line">build $ make sync_build_mkcfg</div>
<div class="line">build $ make cv5x_ipcam_emmc_config</div>
<div class="line">build $ make -j8</div>
</div><!-- fragment --><p></b></b></b></b></p>
<p ><b><b><b><b>Ambarella highly recommends that the eMMC boot functions with Ext4 file system, which is the default configuration. For more information about the Ext4 file system, refer to <a class="el" href="../../d4/d64/si_fs.html#fs_ext4"><ol type="1">
<li>Ext4</li>
</ol>
</a> <br  />
 When using eMMC boot, don't enable 'fdisk'. Because it is not supported by eMMC boot. If users download a firmware into the board with 'fdisk' enabled accidentally, they need to erase the whole eMMC before downloading a new firmware. Else, the board can't boot up normally. <br  />
 After building the binary, select the board configuration with "eMMC", and then download the binary to EVK boards.</b></b></b></b></p>
<p ><b><b><b><b></p><dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>Forcing USB boot is required to successfully flash the binary if the boot media is switched from NAND to eMMC (or vice versa). <br  />
</li>
<li>When downloading a firmware whose size is larger than 1 GB, users must increase the timeout period in case of hitting timeout issue. They should modify "TransTimeOutMS = 5000" in AmbaUSB.conf file, which locates in "ambausb/share/ambausb-x.x.x" of AmbaUSB installation folder. "TransTimeOutMS = 5000" means that the timeout is 5 s. They can enlarge it to "TransTimeOutMS = 10000"(10 s) or even larger depending on the firmware size. <br  />
</li>
<li>The maximum firmware size that can be downloaded by AmbaUSB must be less than CV5x set's DRAM size.</li>
<li>SD slot 2 cannot enable ultra high speed when EMMC boot is enabled. </li>
</ol>
</dd></dl>
<p></b></b></b></b></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
