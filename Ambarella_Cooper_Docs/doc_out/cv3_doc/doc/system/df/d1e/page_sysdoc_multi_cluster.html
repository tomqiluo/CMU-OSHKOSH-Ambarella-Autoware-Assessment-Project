<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>System: BASE - Multi-Clusters</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="System"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">System<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('df/d1e/page_sysdoc_multi_cluster.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">BASE - Multi-Clusters </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="multi_cluster_doc_history"></a>
0. Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">SDK Version   </th><th class="markdownTableHeadLeft">Updated Date   </th><th class="markdownTableHeadLeft">Modification    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Cooper SDK 1.6.0   </td><td class="markdownTableBodyLeft">20231225   </td><td class="markdownTableBodyLeft">Initial Version   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="multi_cluster_intro"></a>
1. Multi-Clusters Introduction</h1>
<h2><a class="anchor" id="Multi-multi_cluster_s1"></a>
1.1 Introduction</h2>
<p >This chapter describes the multiple clusters on Ambarella platforms. Currently, only CV3-DEV-H and CV3AD685 chips can support multiple clusters.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Platform   </th><th class="markdownTableHeadLeft">Cluster    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CV3-DEV-H   </td><td class="markdownTableBodyLeft">4 clusters x quad-A78    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">CV3AD685   </td><td class="markdownTableBodyLeft">3 clusters x quad-A78   </td></tr>
</table>
<p >Each cluster is assigned to an independent Linux kernel.</p>
<p >Clusters are able to communicate with each other by a <b>virtual ethernet</b> (<a class="el" href="../../df/d1e/page_sysdoc_multi_cluster.html#multi_cluster_blazenet_driver">Blazenet</a>).</p><ul>
<li>Each cluster has its own DRAM address space and IO resource.</li>
<li>Cluster 0 is the primary cluster, others are secondary clusters.</li>
<li>The primary cluster creates a network file system (NFS) service (<a class="el" href="../../df/d1e/page_sysdoc_multi_cluster.html#multi_cluster_nfs_rootfs">4. NFS Rootfs</a>) for secondary clusters.</li>
</ul>
<hr  />
<h1><a class="anchor" id="multi_cluster_design"></a>
2. Design</h1>
<p >Taking <code>cv3_dk_mini</code> board as an example to show the design concept of multiple clusters.</p>
<table class="doxtable">
<caption>Table 2-1. CV3 DK_mini IO Resource.</caption>
<tr>
<th>Resource </th><th>Description </th></tr>
<tr>
<td>Dynamic random access memory (DRAM) </td><td>32 GiB </td></tr>
<tr>
<td>Universal asynchronous receiver / transmitter (UART) </td><td>4 x USB to serial debug UART </td></tr>
<tr>
<td>Ethernet port </td><td>4 x port </td></tr>
</table>
<h2><a class="anchor" id="multi_cluster_design_mem_layout"></a>
2.1 Memory Layout</h2>
<p >The figure below describes the memory layout of multiple clusters.</p>
<div class="image">
<img src="../../cv3_dk_mini_multi_cluster_mem_layout.png" alt=""/>
<div class="caption">
Figure 2-1. CV3 Dk_mini Memory Layout.</div></div>
<p >Each secondary cluster has 4-GiB work memory. The work memory size of <b>primary cluster</b> is <b>20462 MiB</b>, it can be computed as below:</p>
<ul>
<li>20 GiB is equal to 20480 MiB.</li>
<li>KERNEL_RAM_START in <code>.config</code> is 0x1200000 (18 MiB).</li>
<li>The size of work memory assigned to primary cluster is 20480 - 18 = 20462 MiB.</li>
</ul>
<p ><b>Primary cluster</b>'s work memory is declared in bootargs(<code>cv3_dk_mini.dts</code>) </p><div class="fragment"><div class="line">bootargs = <span class="stringliteral">&quot;console=ttyS0 mem=20462M init=/linuxrc earlycon pci=nomsi ...</span></div>
</div><!-- fragment --><h2><a class="anchor" id="multi_cluster_design_io_res"></a>
2.2 IO Resource</h2>
<table class="doxtable">
<caption>Table 2-2. CV3 Dk_mini IO Assignment.</caption>
<tr>
<th>cluster </th><th>tty </th><th>ethernet </th><th>blazenet </th></tr>
<tr>
<td>0 </td><td>/dev/ttyS0 (APB_UART) </td><td>eth0 </td><td>blazenet@01/02/03 </td></tr>
<tr>
<td>1 </td><td>/dev/ttyS1 (AHB_UART0) </td><td>eth1 </td><td>blazenet@01 </td></tr>
<tr>
<td>2 </td><td>/dev/ttyS2 (AHB_UART1) </td><td>eth2 </td><td>blazenet@02 </td></tr>
<tr>
<td>3 </td><td>/dev/ttyS3 (AHB_UART2) </td><td>eth3 </td><td>blazenet@03 </td></tr>
</table>
<p >In order to simplify the system design, all physical Ethernet ports are assigned to the primary cluster by default. In customer own use case, they can also assign physical Ethernet to secondary cluster for different purpose.</p>
<h2><a class="anchor" id="multi_cluster_design_boot_flow"></a>
2.3 Boot Flow</h2>
<p >The following figure describes the boot flow of multiple clusters.</p>
<div class="image">
<img src="../../cv3_dk_mini_multi_cluster_boot_flow.png" alt=""/>
<div class="caption">
Figure 2-2. Multiple Clusters Boot Flow.</div></div>
<hr  />
<h1><a class="anchor" id="multi_cluster_blazenet_driver"></a>
3. Blazenet</h1>
<p >Blazenet is a virtual Ethernet driver which is based on remote processor messaging (rpmsg) device. Blazenet on primary cluster is in <code>rpmsg master</code> mode, on secondary cluster is in <code>rpmsg slave</code> mode.</p>
<p >However, Linux kernel does not support <code>rpmsg slave</code> mode, Ambarella implements an extra driver to support this mode.</p>
<p >Enable <b>blazenet</b> during configuration: </p><div class="fragment"><div class="line">$ make linux_menuconfig_single</div>
<div class="line">  -&gt; Device Drivers</div>
<div class="line">      -&gt; Rpmsg Drivers</div>
<div class="line">          -&gt; Ambarella RPMSG</div>
<div class="line">              &lt;*&gt; Blazenet driver</div>
<div class="line">              -*- Ambarella RPMSG driver</div>
<div class="line">              -*- RPMSG <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a> service announcement <span class="keywordflow">for</span> slave</div>
<div class="line">              -*- Virtio RPMSG bus driver <span class="keywordflow">for</span> slave</div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div></div>
</div><!-- fragment --><table class="doxtable">
<caption>Table 3-1. Blazenet IP Assignment in Each Cluster.</caption>
<tr>
<th></th><th>cluster-0 </th><th>cluster-1 </th><th>cluster-2 </th><th>cluster-3 </th></tr>
<tr>
<th>blazenet@01 </th><td>192.168.1.1 </td><td>192.168.1.2 </td><td>X </td><td>X </td></tr>
<tr>
<th>blazenet@02 </th><td>192.168.2.1 </td><td>X </td><td>192.168.2.2 </td><td>X </td></tr>
<tr>
<th>blazenet@03 </th><td>192.168.3.1 </td><td>X </td><td>X </td><td>192.168.3.2 </td></tr>
</table>
<p >Currently, Blazenet IP assignment is hardcode in script <code>rootfs/skeleton/initramfs_sysroot/usr/bin/create_cluster_nfs.sh</code>.</p>
<p >From secondary clusters' point of view, blazenet is to communicate with primary cluster only. Secondary clusters are unable to directly communicate with each other. Enable the <b>ip_forward</b> feature in the primary cluster so that secondary clusters can talk with each other. </p><div class="fragment"><div class="line">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</div>
</div><!-- fragment --><p >The figure below describes the network routing via primary cluster.</p>
<div class="image">
<img src="../../cv3_dk_mini_multi_cluster_blazenet.png" alt=""/>
<div class="caption">
Figure 3-1. Blazenet Network on CV3 Dk_mini.</div></div>
<hr  />
<h1><a class="anchor" id="multi_cluster_nfs_rootfs"></a>
4. NFS Rootfs</h1>
<p >Since seconary clusters are not assigned to any storge devices, customers use <b>NFS rootfs</b> as secondary clusters' rootfs.</p>
<p >The <b>NFS service</b> is created by primary cluster, the NFS shared folder is <code>/nfs</code>.</p>
<p >The following script is responsible for creating <b>NFS service</b>, <code>rootfs/skeleton/initramfs_sysroot/usr/bin/create_cluster_nfs.sh</code>.</p>
<p >The rootfs of primary and seconary clusters are stored on an extra SD card. There are two partitions on SD card, <code>/dev/mmcblk0p1</code> and <code>/dev/mmcblk0p2</code>.</p><ul>
<li>The <code>/dev/mmcblk0p1</code> is primary's rootfs.</li>
<li>The <code>/dev/mmcblk0p2</code> is seconary's rootfs, and it's mounted to <code>/nfs</code> by primary cluster, which means all seconary clusters share a same rootfs.</li>
</ul>
<p >Actually, users can specify the rootfs by Linux bootargs <code>cluster_nfsroot</code> (cluster_nfsroot=[primary device][, seconary device]), </p><div class="fragment"><div class="line">bootargs = <span class="stringliteral">&quot;... cluster_nfsroot=mmcblk0p1,mmcblk0p2&quot;</span>;</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="multi_cluster_boot"></a>
5. Boot Multiple Clusters for CV3 Dk_mini</h1>
<h2><a class="anchor" id="multi_cluster_boot_build"></a>
5.1 Build</h2>
<p >Use the following commands to build the firmware for CV3 Dk_mini: </p><div class="fragment"><div class="line">build $ cd ambarella/boards/cv3_dk_mini</div>
<div class="line">build $ <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> ../../build/env/amba-build.env</div>
<div class="line">build $ make ipcam_clusters_config</div>
<div class="line">build $ make -j 8</div>
<div class="ttc" id="avin__init_8c_html_a07a87b2e6ed927503e2f95f119c9fc23"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a></div><div class="ttdeci">int source</div></div>
</div><!-- fragment --><h2><a class="anchor" id="multi_cluster_boot_burn_fw"></a>
5.2 Burn the Firmware</h2>
<p >Burn the firmware <code>bst_bld_env_dtb_kernel.bin</code> or <code>bst_bld_env_dtb_kernel.elf</code> using <b>AmbaUSB-v6.x</b> version. </p><div class="fragment"><div class="line">build $ ls ../../out/amba_out/cv3_dk_mini/firmware/</div>
<div class="line">bld.bin  bld.fw   bst_bld_env_dtb_kernel.bin  bst_bld_env_dtb_kernel.fw  bst.fw   dtb.elf  env.bin  env.fw      kernel.elf</div>
<div class="line">bld.elf  bst.bin  bst_bld_env_dtb_kernel.elf  bst.elf                    dtb.bin  dtb.fw   env.elf  kernel.bin  kernel.fw</div>
</div><!-- fragment --><p >Open other 3 USBs to the serial devices at the PC side, after the system is booting up, the following will display.</p>
<div class="image">
<img src="../../cv3_dk_mini_multi_cluster_console.png" alt=""/>
<div class="caption">
Figure 5-1. CV3 Dk_mini console.</div></div>
<p >The primary cluster successfully enters Linux shell and seconary clusters are blocked waitting for NFS rootfs.</p>
<h2><a class="anchor" id="multi_cluster_boot_make_rootfs"></a>
5.3 Make Rootfs</h2>
<ol type="1">
<li>Ethernet is up, connect with host PC at <code>ETH0</code>.</li>
<li>Insert a micro SD card into the slot <code>MICRO SD</code></li>
</ol>
<div class="image">
<img src="../../cv3_dk_mini_multi_cluster_device_snapshot.png" alt=""/>
<div class="caption">
Figure 5-2. CV3 Dk_mini Device.</div></div>
<p >Follow the steps below to make the rootfs:</p>
<ol type="1">
<li>Ping the host PC in the console of primary cluster, ensure that the physical Ethernet can work properly. <div class="fragment"><div class="line">board # ping 10.0.0.120</div>
<div class="line">64 bytes from 10.0.0.120: seq=0 ttl=64 time=0.666 ms</div>
<div class="line">64 bytes from 10.0.0.120: seq=1 ttl=64 time=0.233 ms</div>
<div class="line">--- 10.0.0.120 ping statistics ---</div>
<div class="line">2 packets transmitted, 2 packets received, 0% packet loss</div>
<div class="line">round-trip min/avg/max = 0.233/0.449/0.666 ms</div>
</div><!-- fragment --></li>
<li><p class="startli">Transfer <b>rootfs.ext4</b> to the boards using FTP protocol. If the host PC is Linux, go to <code>out/amba_out/cv3_dk_mini/images</code>, and use tool <b>ftp</b> to transfer files. </p><div class="fragment"><div class="line">build $ ls</div>
<div class="line">ambust_ambausb_lpddr5_none_release.bin   bld.bin  cluster1_dtb.bin  cluster3_dtb.bin  dtb.bin  fwp.bin  initramfs.cpio.gz  rootfs.bin</div>
<div class="line">ambust_fastboot_lpddr5_none_release.bin  bst.bin  cluster2_dtb.bin  clusters_env.bin  env.bin  Image    kernel.bin         rootfs.ext4</div>
<div class="line">build $ ftp 10.0.0.2</div>
<div class="line">build $ Connected to 10.0.0.2.</div>
<div class="line">build $ 220 Operation successful</div>
<div class="line">build $ Name (10.0.0.2:build-machine): root</div>
<div class="line">build $ 331 Specify password</div>
<div class="line">build $ Password:           # <span class="stringliteral">&#39;press enter key&#39;</span></div>
<div class="line">build $ 230 Operation successful</div>
<div class="line">build $ Remote system type is UNIX.</div>
<div class="line">build $ Using binary mode to transfer files.</div>
<div class="line">build $ ftp&gt; put rootfs.ext4</div>
<div class="line">build $ local: rootfs.ext4 remote: rootfs.ext4</div>
<div class="line">build $ 200 Operation successful</div>
<div class="line">build $ 150 Ok to send data</div>
<div class="line">build $ 226 Operation successful</div>
<div class="line">build $ 252385280 bytes sent in 4.69 secs (51.2918 <a class="code hl_defineRef" target="_blank" href="../../../driver/d6/d56/iav__utils_8h.html#aa6b38d492364d98453284934ed7caee9">MB</a>/s)</div>
<div class="ttc" id="aiav__utils_8h_html_aa6b38d492364d98453284934ed7caee9"><div class="ttname"><a href="../../../driver/d6/d56/iav__utils_8h.html#aa6b38d492364d98453284934ed7caee9">MB</a></div><div class="ttdeci">#define MB</div></div>
</div><!-- fragment --><p class="startli">If the host PC is Windows, use FTP app <b>Filezilla</b> to transfer files. </p><div class="image">
<img src="../../cv3_dk_mini_multi_cluster_filezilla.png" alt=""/>
<div class="caption">
Figure 5-3. Filezilla.</div></div>
<p class="startli">After <code>rootfs.ext4</code> is successfully transferred to the board, users can find it under <code>/</code>, </p><div class="fragment"><div class="line">board # ls /rootfs.ext4</div>
<div class="line">rootfs.ext4</div>
</div><!-- fragment --></li>
<li>Create SD partitions. Two partitions are required to be created on SD card, each partition size should be larger than 1 GiB. <div class="fragment"><div class="line">board # fdisk /dev/mmcblk0</div>
</div><!-- fragment --> The number of cylinders for this disk is set to 489728. There is nothing wrong with that, but it is larger than 1024, and in certain setups it can cause the following issues: 1) Software that runs at boot time (for example, old versions of LILO) 2) Booting and partitioning software from other OSs (for example, DOS FDISK, OS/2 FDISK) <div class="fragment"><div class="line">Command (m <span class="keywordflow">for</span> help): p</div>
<div class="line">Disk /dev/mmcblk0: 15 GB, 16047407104 bytes, 31342592 sectors</div>
<div class="line">489728 cylinders, 4 heads, 16 sectors / track</div>
<div class="line">Units: sectors of 1 * 512 = 512 bytes</div>
<div class="line"> </div>
<div class="line">Device       Boot StartCHS    EndCHS        StartLBA     EndLBA    Sectors  Size Id Type</div>
<div class="line">/dev/mmcblk0p1    0,1,1       1023,3,16           16    2097167    2097152 1024M 83 Linux</div>
<div class="line">/dev/mmcblk0p2    1023,3,16   1023,3,16      2097168    4194319    2097152 1024M 83 Linux</div>
<div class="line"> </div>
<div class="line">Command (m for help): d</div>
<div class="line">Partition <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a01b4671c6b7cc8f831c951c000a37735">number</a> (1-4): 1</div>
<div class="line"> </div>
<div class="line">Command (m for help): d</div>
<div class="line">Selected partition 2</div>
<div class="line"> </div>
<div class="line">Command (m for help): d</div>
<div class="line">No partition is defined yet!</div>
<div class="line"> </div>
<div class="line">Command (m for help): p</div>
<div class="line">Disk /dev/mmcblk0: 15 GB, 16047407104 bytes, 31342592 sectors</div>
<div class="line">489728 cylinders, 4 heads, 16 sectors / track</div>
<div class="line">Units: sectors of 1 * 512 = 512 bytes</div>
<div class="line"> </div>
<div class="line">Device       Boot StartCHS    EndCHS        StartLBA     EndLBA    Sectors  Size Id Type</div>
<div class="line"> </div>
<div class="line">Command (m for help): n</div>
<div class="line">Partition type</div>
<div class="line">   p   primary partition (1-4)</div>
<div class="line">   e   extended</div>
<div class="line">p</div>
<div class="line">Partition <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a01b4671c6b7cc8f831c951c000a37735">number</a> (1-4): 1</div>
<div class="line">First sector (16-31342591, default 16):</div>
<div class="line">Using default value 16</div>
<div class="line">Last sector or +size{,K,M,G,T} (16-31342591, default 31342591): +2G</div>
<div class="line"> </div>
<div class="line">Command (m for help): n</div>
<div class="line">Partition type</div>
<div class="line">   p   primary partition (1-4)</div>
<div class="line">   e   extended</div>
<div class="line">p</div>
<div class="line">Partition <a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a01b4671c6b7cc8f831c951c000a37735">number</a> (1-4): 2</div>
<div class="line">First sector (4194320-31342591, default 4194320):</div>
<div class="line">Using default value 4194320</div>
<div class="line">Last sector or +size{,K,M,G,T} (4194320-31342591, default 31342591): +2G</div>
<div class="line"> </div>
<div class="line">Command (m for help): w</div>
<div class="line">The partition table has been altered.</div>
<div class="line">Calling ioctl() to re-read partition table</div>
<div class="ttc" id="acJSON_8h_html_a01b4671c6b7cc8f831c951c000a37735"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a01b4671c6b7cc8f831c951c000a37735">number</a></div><div class="ttdeci">const char *const const double number</div></div>
</div><!-- fragment --></li>
<li>Program <b>rootfs.ext4</b> into SD partition. <div class="fragment"><div class="line">board # dd <span class="keywordflow">if</span>=/tmp/rootfs.ext4 of=/dev/mmcblk0p1</div>
<div class="line">board # dd <span class="keywordflow">if</span>=/tmp/rootfs.ext4 of=/dev/mmcblk0p2</div>
</div><!-- fragment --></li>
</ol>
<p >Now, all clusters rootfs are ready, reboot the board.</p>
<p ><b>NOTE</b></p>
<ul>
<li>Add files to slave clusters' rootfs, please go to cluster0's directory <code>/nfs</code>.</li>
<li>Setup network with specified IP or MAC address, please refer to following script, and add them in <code>/nfs/etc/network/cluster-if.sh</code>, <div class="fragment"><div class="line"><span class="preprocessor">#!/bin/sh</span></div>
<div class="line">let addr=$1+100</div>
<div class="line"> </div>
<div class="line">MAC=8A:97:4F:39:0$1:AA</div>
<div class="line">IP=10.0.0.$addr</div>
<div class="line"> </div>
<div class="line">ifconfig eth0 hw ether $MAC</div>
<div class="line">ifconfig eth0 $IP</div>
</div><!-- fragment --> <hr  />
</li>
</ul>
<h1><a class="anchor" id="multi_cluster_cavalry"></a>
6. Cavalry in Multi-Cluster</h1>
<p >The Cavalry support on a multi-cluster system can provide users with the same user experience as in a single-cluster environment. Users can submit Cavalry jobs on any cluster, utilizing libraries such as NNCtrl, Cavalry_Mem, and tools like cavalry_top provided by Cavalry.</p>
<h2><a class="anchor" id="multi_cluster_cvr_mem_setup"></a>
6.1 Memory Setup</h2>
<p >In multi-cluster setup, each Cavalry driver instance on a cluster has its own separate private memory, and this can be configured through menuconfig.</p>
<dl class="section user"><dt>For Cooper Amba build:</dt><dd><div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">   -*- board (boards)  ---&gt;</div>
<div class="line">         Memory  ---&gt;</div>
<div class="line">            (128) CV Private Memory size in MB <span class="keywordflow">for</span> cluster 0</div>
<div class="line">            (128) CV Private Memory size in <a class="code hl_defineRef" target="_blank" href="../../../driver/d6/d56/iav__utils_8h.html#aa6b38d492364d98453284934ed7caee9">MB</a> <span class="keywordflow">for</span> cluster 1</div>
<div class="line">            (128) CV Private Memory size in MB <span class="keywordflow">for</span> cluster 2</div>
<div class="line">            (128) CV Private Memory size in MB for cluster 3</div>
</div><!-- fragment --></dd></dl>
<h2><a class="anchor" id="multi_cluster_cvr_limitations"></a>
6.2 Limitations</h2>
<p >Currently, there are certain limitations to the use of multi-cluster Cavalry driver :</p><ul>
<li>When starting the vector processor (VP), the primary CPU cluster (cluster-0) must start VP before the secondary clusters (cluster-1/2/3).</li>
<li>When stopping the VP, the primary cluster (cluster-0) can only stop VP after all secondary clusters (cluster-1/2/3) have already stopped VP.</li>
</ul>
<hr  />
<h1><a class="anchor" id="multi_cluster_license"></a>
7. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ( "Software" ) are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
