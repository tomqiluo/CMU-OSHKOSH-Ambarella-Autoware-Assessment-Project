<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>System: DESIGN - Docker Usage Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="System"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">System<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dc/d4a/page_sys_docker.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">DESIGN - Docker Usage Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="docker_history"></a>
0. Revision History</h1>
<a class="anchor" id="docker_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Updated Date </th><th>Modification </th></tr>
<tr>
<td>20221104 </td><td>Initial Version </td></tr>
<tr>
<td>20221129 </td><td>Updated Section <a class="el" href="../../dc/d4a/page_sys_docker.html#docker_ov">1. Overview</a> </td></tr>
<tr>
<td>20221201 </td><td>Added Section <a class="el" href="../../dc/d4a/page_sys_docker.html#docker_ssh_server">11. Support SSH server</a> </td></tr>
<tr>
<td>20230308 </td><td>Added Sections <a class="el" href="../../dc/d4a/page_sys_docker.html#docker_build_cv72">3. Build the Firmware for CV72 EVK</a> <a class="el" href="../../dc/d4a/page_sys_docker.html#docker_build_cv3">4. Build the Firmware for CV3x EVK</a> </td></tr>
<tr>
<td>20230407 </td><td>Added Section <a class="el" href="../../dc/d4a/page_sys_docker.html#docker_qa">12. Docker Q&amp;A</a> </td></tr>
<tr>
<td>20240110 </td><td>Updated Section <a class="el" href="../../dc/d4a/page_sys_docker.html#docker_ov">1. Overview</a> </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="docker_ov"></a>
1. Overview</h1>
<p >Ambarella provides Docker support for CV5x platforms. This document provides a guide for building a Docker environment and demonstrates how to run software development kit (SDK) functions under Docker.</p>
<h2><a class="anchor" id="docker_about"></a>
1.1 About Docker</h2>
<p >Docker is an open platform for developing, shipping, and running applications. Docker enables users to separate applications from infrastructure so they can quickly deliver software. With Docker, users can manage the infrastructure in the same way that they manage applications. By taking advantage of Docker methodologies for shipping, testing, and accelerated code deployment, users can significantly reduce the delay between writing code and running it in production.</p>
<p >Docker provides the functions for packing and running applications in a friendly isolated environment, which is called a container. Containers are lightweight and can run directly on the host's kernel without other additional management programs. At the same time, the isolation and security features of the environment enable multiple containers to run on a given host. Containers are independent of one other and multiple containers will not interfere with each other.</p>
<p >To download the latest Docker container and daemon applications running on Arm® V8 platforms, users can access the link <a href="https://download.docker.com/linux/static/stable/aarch64/">https://download.docker.com/linux/static/stable/aarch64/</a>.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The Docker binaries downloaded from the Docker link above all belong to <code>Docker Engine</code>, scope, which is licensed under the <b>Apache version 2.0 License</b>. Here is the reference <code><a href="https://docs.docker.com/engine/">https://docs.docker.com/engine/</a></code>.</li>
<li>For the differences between <code>Docker Engine</code> and <code>Docker Desktop</code>, refer to <code><a href="https://www.docker.com/products/docker-desktop/alternatives/">https://www.docker.com/products/docker-desktop/alternatives/</a></code>.</li>
</ul>
</dd></dl>
<hr  />
<h1><a class="anchor" id="docker_build_cv5"></a>
2. Build the Firmware for the CV5x Evaluation Kit (EVK)</h1>
<ol type="1">
<li>Build the firmware for the CV5 Timn EVK with the configuration file below. <div class="fragment"><div class="line">build $ make cv5_ipcam_emmc_docker_config</div>
<div class="line">build $ make defconfig_public_linux</div>
<div class="line">build $ make -j 8</div>
</div><!-- fragment --></li>
<li>Build the firmware for the CV52 Crco EVK with the configuration file below. DDR type: LPDDR4 <div class="fragment"><div class="line">build $ make cv52_ipcam_emmc_lp4_docker_config</div>
</div><!-- fragment --> DDR type: LPDDR5 <div class="fragment"><div class="line">build $ make cv52_ipcam_emmc_lp5_docker_config</div>
</div><!-- fragment --> <div class="fragment"><div class="line">build $ make defconfig_public_linux</div>
<div class="line">build $ make -j 8</div>
</div><!-- fragment --></li>
<li>Build the firmware for the CV52n Zr EVK with the configuration file below. <div class="fragment"><div class="line">build $ make cv52_ipcam_emmc_docker_config</div>
<div class="line">build $ make defconfig_public_linux</div>
<div class="line">build $ make -j 8</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="docker_build_cv72"></a>
3. Build the Firmware for the CV72 EVK</h1>
<ol type="1">
<li>Build the firmware for the CV72 Ga EVK with the configuration file below. <div class="fragment"><div class="line">build $ make cv72_ipcam_docker_config</div>
<div class="line">build $ make defconfig_public_linux</div>
<div class="line">build $ make -j 8</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="docker_build_cv3"></a>
4. Build the Firmware for the CV3x EVK</h1>
<ol type="1">
<li>Build the firmware for the CV3bub EVK with the configuration file below. <div class="fragment"><div class="line">build $ make cv3bub_ipcam_cavalry_docker_config</div>
<div class="line">build $ make defconfig_public_linux</div>
<div class="line">build $ make -j 8</div>
</div><!-- fragment --></li>
<li>Build the firmware for the CV3 Dk-mini EVK with the configuration file below. <div class="fragment"><div class="line">build $ make cv3_dk_mini_ipcam_cavalry_docker_config</div>
<div class="line">build $ make defconfig_public_linux</div>
<div class="line">build $ make -j 8</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="docker_network_set"></a>
5. Network Setup</h1>
<p >To build a Docker environment, users must ensure access to the internet. Then, they can set up the network according to the operation in <a class="elRef" target="_blank" href="../../../peripherals/db/d30/si_wifi.html">WiFi</a> and <a class="elRef" target="_blank" href="../../../peripherals/d3/d5b/si_ethernet.html">Ethernet</a>.</p>
<p >Test the network with the command below. The following information indicates that the connection to the internet is normal. </p><div class="fragment"><div class="line">board # ping www.google.com</div>
<div class="line">PING www.google.com (180.101.49.12): 56 data bytes</div>
<div class="line">64 bytes from 180.101.49.12: seq=0 ttl=49 time=9.787 ms</div>
<div class="line">64 bytes from 180.101.49.12: seq=1 ttl=49 time=18.995 ms</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="docker_configure"></a>
6. Configure Docker Image</h1>
<p >Before running Docker, users must configure the following:</p><ol type="1">
<li>Prepare a secure digital (SD) card and format it to EXT4.<br  />
 Copy the Docker daemon and client applications (CAs) from the master branch to the SD card. Users cannot build it into the firmware due to the size limit of the electronic logic gate NAND. Refer to <a class="elRef" target="_blank" href="../../../peripherals/d0/da5/si_sd_card.html">SD Card</a> for SD card contents.</li>
<li>Add domestic mirror sources.<br  />
 Create <code>daemon.json</code> and enter the following information: <div class="fragment"><div class="line">board # cat /etc/docker/daemon.json</div>
<div class="line">{</div>
<div class="line"><span class="stringliteral">&quot;data-root&quot;</span>:<span class="stringliteral">&quot;/sdcard/mmcblk0p1/docker_data_root&quot;</span>,</div>
<div class="line"><span class="stringliteral">&quot;registry-mirrors&quot;</span>:[<span class="stringliteral">&quot;https://hub-mirror.c.163.com&quot;</span>,<span class="stringliteral">&quot;http://f1361db2.m.daocloud.io&quot;</span>]</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The following configuration options are used:<br  />
</dd></dl>
</li>
</ol>
<ul>
<li><code>data-root</code>: The root path used by Docker runtime, default: <code>/var/lib/Docker</code><br  />
</li>
<li><code>registry-mirrors</code>: Sets the mirror acceleration, address: "https://hub-mirror.c.163.com""http://f1361db2.m.daocloud.io" These are for domestic use in China, and users can choose acceleration mirror addresses that are suitable for the network environment.</li>
</ul>
<ol type="1">
<li>Change the system time.<br  />
 Confirm that the system time is accurate; if not, set it to the correct time. <div class="fragment"><div class="line">board # date -s 2022-12-1</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="docker_run_daemons"></a>
7. Run Docker Daemons</h1>
<div class="fragment"><div class="line">board # export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/bin/X11:/usr/local/bin:/usr/local/sbin:/sdcard/mmcblk0p1/bin</div>
<div class="line">board # containerd &amp;</div>
<div class="line">board # dockerd &amp;</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="docker_load_ubuntu"></a>
8. Load Ubuntu</h1>
<p >Because <a class="el" href="../../dc/d4a/page_sys_docker.html#docker_network_set">Set Network</a> implements the connection to the internet, users can pull Ubuntu images from the Docker community. </p><div class="fragment"><div class="line">board # docker pull arm64v8/ubuntu</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The <code>docker pull arm64v8/ubuntu</code> command indicates that the pulled image version is the latest, such as <code>docker pull arm64v8/ubuntu:18.04</code>. Users can add the corresponding version after the image name.</dd></dl>
<hr  />
<h1><a class="anchor" id="docker_run_ubuntu"></a>
9. Run Ubuntu</h1>
<ol type="1">
<li>Create and start a new containter. <div class="fragment"><div class="line">board # docker run -itd --<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a> u1201 --privileged=<span class="keyword">true</span> -p 9554:554 -p 8049:2049 arm64v8/ubuntu</div>
<div class="ttc" id="acJSON_8h_html_a25d22ecc7e656d2c59332072684e8766"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a></div><div class="ttdeci">const char *const name</div></div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The following configuration options are used:<br  />
 The <code>--privileged=true</code> sets the root privilege<br  />
 The <code>-p</code> opens the port, which maps the port of the Docker container to the host port<br  />
 The <code>-name</code> sets the container name</dd></dl>
</li>
<li>Enter into the container. <div class="fragment"><div class="line">board # docker exec -it u1201 /bin/bash</div>
<div class="line">root@90ad03cbb159:/#</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="docker_implement_sdk"></a>
10. Implement SDK</h1>
<p >Users can implement the SDK functions in Docker through the following operations.</p><ol type="1">
<li>Copy SDK-related files to Docker. <div class="fragment"><div class="line">board # docker cp /usr/local/bin u1201:/usr/local/</div>
<div class="line">board # docker cp /usr/lib/   u1201:/usr/</div>
<div class="line">board # docker cp /usr/local/bin/   u1201:/usr/local/</div>
<div class="line">root@90ad03cbb159:/# mkdir -p /lib/modules/5.15.76  <span class="comment">// Need to enter the container to create the relevant directory.</span></div>
<div class="line">board # docker cp /lib/modules/5.15.76   u1201:/lib/modules</div>
<div class="line">board # docker cp /lib/firmware/   u1201:/lib/</div>
<div class="line">board # docker cp /etc/ambarella.conf  u1201:/etc/</div>
<div class="line">board # docker cp /sbin/modprobe   u1201:/sbin</div>
<div class="line">board # docker cp /usr/bin/kmod   u1201:/usr/bin/</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd><code>mkdir -p /lib/modules/5.15.76</code><br  />
 The name of the folder to be created must be consistent with the folder name under <code>/lib/modules/</code> outside Docker.</dd></dl>
</li>
<li>Start the basic image audio video (IAV) functions in the Docker container. 1) Operation outside Docker: <div class="fragment"><div class="line">board # init.sh --na</div>
<div class="line">board # modprobe imx274_mipi vinc_id=8 bus_id=3</div>
<div class="line">board # test_aaa_service -a&amp;</div>
</div><!-- fragment --> 2) Operation in Docker: <div class="fragment"><div class="line">board # docker exec -it u1201 /bin/bash</div>
<div class="line">root@90ad03cbb159:/# test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --></li>
<li>Start the Cavalry functions in the Docker container.<br  />
 For Cavalry content, refer to <a class="elRef" target="_blank" href="../../../driver/d4/d86/page_drv_cavalry_doc.html">Cavalry Driver API</a>.<br  />
 Users can package their own algorithms through Docker technology and run them on the CV5x board.<br  />
 The benefits are as follows:<br  />
 1) Continuous deployment and testing:<br  />
 The Docker container eliminates the difference between online and offline environments and ensures the consistency and standardization of the environment in the application life cycle. Developers use an image to build a standard development environment, and then migrate through an image that encapsulates the complete environment and application. This truly realizes the concept "build once, run everywhere". This enables test and operations personnel to directly deploy software images for testing and publishing, greatly simplifying the process of continuous integration, testing, and publishing.<br  />
 2) Cross-platform support:<br  />
 Because Docker technology decouples the application from the underlying environment, users can seamlessly run their applications on any chip platform.<br  />
 3) High resource utilization:<br  />
 The container does not have the extra overhead of the manager, but shares the operating system with the bottom layer. The user's application can access and process the bottom layer data with low load and make full use of system resources.<br  />
</li>
</ol>
<p >The location of algorithms in Docker in the computer vision (CV) software framework is shown below. </p><div class="image">
<img src="../../docker_algorithms.png" alt=""/>
<div class="caption">
Figure 10-1. Algorithms in Docker.</div></div>
<hr  />
<h1><a class="anchor" id="docker_ssh_server"></a>
11. Support Secure Shell (SSH) Server</h1>
<ol type="1">
<li>Ensure that the board's network is smooth.</li>
<li>Set the port to bind to the host when creating the container. <div class="fragment"><div class="line">board # docker run -itd --<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a> u1201 --privileged=<span class="keyword">true</span> -p 9022:22 arm64v8/ubuntu</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The option <code>-p</code> opens a port, which maps the port of the Docker container (22) to the host port (9022).<br  />
</dd></dl>
</li>
<li>Software source update (input in Docker). <div class="fragment"><div class="line">root@90ad03cbb159:~# apt-get update</div>
<div class="line">root@90ad03cbb159:~# apt-get upgrade</div>
</div><!-- fragment --></li>
<li>Install vim (input in Docker). <div class="fragment"><div class="line">root@90ad03cbb159:~# apt-get install -<a class="code hl_variableRef" target="_blank" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> vim</div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a></div><div class="ttdeci">u32 y</div></div>
</div><!-- fragment --></li>
<li>Set up the SSH server（input in Docker).<br  />
 1)Install openssh-server. <div class="fragment"><div class="line">root@90ad03cbb159:~# apt-get install -<a class="code hl_variableRef" target="_blank" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> openssh-server</div>
</div><!-- fragment --> 2)Open service. <div class="fragment"><div class="line">root@90ad03cbb159:~# /etc/init.d/ssh start</div>
</div><!-- fragment --> 3)Verify that it starts normally. <div class="fragment"><div class="line">root@90ad03cbb159:~# ps -e | grep ssh</div>
</div><!-- fragment --> 4)Edit sshd_config. <div class="fragment"><div class="line">root@90ad03cbb159:~# vi /etc/ssh/sshd_config</div>
</div><!-- fragment --> Remove the comment <code>#</code> before <code>PermitRootLogin prohibit-password</code> and change it to <code>PermitRootLogin yes</code>.<br  />
 5)Restart service. <div class="fragment"><div class="line">root@90ad03cbb159:~# /etc/init.d/ssh restart</div>
</div><!-- fragment --> 6)Set the SSH password. <div class="fragment"><div class="line">root@90ad03cbb159:~# passwd root</div>
</div><!-- fragment --></li>
<li>SSH access Docker<br  />
 Use secureCRT or other tools to connect to 10.0.0.2:9022 to verify that SSH function is normal. The user name is root, and the password is set previously.</li>
</ol>
<hr  />
<h1><a class="anchor" id="docker_ROS2"></a>
12. Support ROS2</h1>
<p >The robot operating system (ROS) is an open source project for building robot applications.<br  />
</p>
<ol type="1">
<li>Get the ROS2 image for arm64v8. <div class="fragment"><div class="line">board # docker pull arm64v8/ros</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>The <code>docker pull arm64v8/ros</code> command indicates that the pulled image version is the latest. Users can add the specified version after the image name, such as <code>docker pull arm64v8/ros:humble</code>.</dd></dl>
</li>
<li>Check the ROS image. <div class="fragment"><div class="line">board # docker image ls</div>
<div class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</div>
<div class="line">arm64v8/ros   latest    71fb575afde7   4 weeks ago     714<a class="code hl_defineRef" target="_blank" href="../../../driver/d6/d56/iav__utils_8h.html#aa6b38d492364d98453284934ed7caee9">MB</a></div>
<div class="ttc" id="aiav__utils_8h_html_aa6b38d492364d98453284934ed7caee9"><div class="ttname"><a href="../../../driver/d6/d56/iav__utils_8h.html#aa6b38d492364d98453284934ed7caee9">MB</a></div><div class="ttdeci">#define MB</div></div>
</div><!-- fragment --></li>
<li>Create a new containter for the <code>arm64v8/ros</code> image. <div class="fragment"><div class="line">board # docker run -it --net=host --<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a25d22ecc7e656d2c59332072684e8766">name</a> ros2_humble --privileged=<span class="keyword">true</span> --restart=always arm64v8/ros</div>
</div><!-- fragment --><ul>
<li><code>--net=host</code> indicates that the host network mode is used for the container. The container’s network stack is not isolated from the Docker host (the container shares the host’s networking namespace), and the container is not allocated its own IP address.</li>
<li><code>--restart=always</code> indicates that the container will always start on daemon startup, regardless of the current state of the container.</li>
</ul>
</li>
<li>Check the ROS container. <div class="fragment"><div class="line">board # docker ps -a</div>
<div class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED         STATUS                       PORTS     NAMES</div>
<div class="line">0ae11e3d8e06   arm64v8/ros   <span class="stringliteral">&quot;/ros_entrypoint.sh …&quot;</span>   2 days ago      Exited 6 hours ago                     ros2_humble</div>
</div><!-- fragment --> If the container is in <code>Exited</code> status, the user can use the following command to start it. <div class="fragment"><div class="line">board # docker start ros2_humble</div>
<div class="line">board # docker ps -a</div>
<div class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED         STATUS                       PORTS     NAMES</div>
<div class="line">0ae11e3d8e06   arm64v8/ros   <span class="stringliteral">&quot;/ros_entrypoint.sh …&quot;</span>   2 days ago      Up 15 seconds                          ros2_humble</div>
</div><!-- fragment --></li>
<li>Enter into the container. <div class="fragment"><div class="line">board # docker exec -it ros2_humble /bin/bash</div>
<div class="line">root@Ambarella:/#</div>
</div><!-- fragment --></li>
<li>Run the demo test application to publish information. <div class="fragment"><div class="line">root@Ambarella:/# <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> /opt/ros/humble/setup.bash</div>
<div class="line">root@Ambarella:/# apt-get update &amp;&amp; apt-get install -<a class="code hl_variableRef" target="_blank" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a> ros-${ROS_DISTRO}-demo-nodes-cpp</div>
<div class="line">root@Ambarella:/# ros2 run demo_nodes_cpp talker</div>
<div class="ttc" id="avin__init_8c_html_a07a87b2e6ed927503e2f95f119c9fc23"><div class="ttname"><a href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a></div><div class="ttdeci">int source</div></div>
</div><!-- fragment --> The user can run the demo test application to subscribe the information on another device or on a PC with the ROS2 image installed. <div class="fragment"><div class="line">root@Ambarella:/# <a class="code hl_variableRef" target="_blank" href="../../../video/d4/daa/vin__init_8c.html#a07a87b2e6ed927503e2f95f119c9fc23">source</a> /opt/ros/humble/setup.bash</div>
<div class="line">root@Ambarella:/# ros2 run demo_nodes_cpp listener</div>
</div><!-- fragment --></li>
<li>Visit the following links for useful documentation on ROS.<br  />
 How to use an <code>arm64v8:ros</code> image: <a href="https://hub.docker.com/r/arm64v8/ros">https://hub.docker.com/r/arm64v8/ros</a><br  />
 ROS official documentation: <a href="https://docs.ros.org/en/humble/Tutorials.html">https://docs.ros.org/en/humble/Tutorials.html</a></li>
</ol>
<dl class="section note"><dt>Note</dt><dd>In the Linux operating environment, each released version of ROS2 corresponds to an Ubuntu version, which is difficult to use on other versions. For example, ROS2 Humble must run on ubuntu22.04, while ROS2 Foxy must run on ubuntu20.04.</dd></dl>
<hr  />
<h1><a class="anchor" id="docker_qa"></a>
13. Docker Q &amp; A</h1>
<ol type="1">
<li><p class="startli">Why did Docker fail to start?<br  />
 Users may encounter different errors when running Docker, which is caused by the different configurations supported by the board.<br  />
 The following are the solutions for commonly-reported errors.<br  />
 1) How can the error below be resolved when running <code>dockerd &amp;</code>? </p><div class="fragment"><div class="line">failed to start daemon: failed to dial <span class="stringliteral">&quot;/run/containerd/containerd.sock&quot;</span>:</div>
<div class="line">unknown service containerd.services.namespaces.v1.Namespaces: not implemented</div>
</div><!-- fragment --><p class="startli">Method of resolution: </p><div class="fragment"><div class="line">board # rm /run/containerd/containerd.sock</div>
<div class="line">board # dockerd &amp;</div>
</div><!-- fragment --><p class="startli">2) How can the error below be resolved when running <code>dockerd &amp;</code>?<br  />
 </p><div class="fragment"><div class="line">WARN Your kernel does not support cgroup memory limit</div>
<div class="line">WARN Unable to find cpu cgroup in mounts</div>
<div class="line">WARN Unable to find blkio cgroup in mounts</div>
<div class="line">WARN Unable to find cpuset cgroup in mounts</div>
<div class="line">WARN Unable to find pids cgroup in mounts</div>
<div class="line">INFO stopping healthcheck following graceful shutdown  module=libcontainerd</div>
<div class="line">INFO stopping <span class="keyword">event</span> stream following graceful shutdown  error=<span class="stringliteral">&quot;context canceled&quot;</span> module=libcontainerd <span class="keyword">namespace</span>=plugins.moby</div>
<div class="line">failed to start daemon: Devices cgroup isn<span class="stringliteral">&#39;t mounted</span></div>
</div><!-- fragment --><p class="startli">Method of resolution:<br  />
 Execute <code>manual_mount.sh</code> in the <code>/bin directory</code>.<br  />
</p><ul>
<li>Execute <a href="../../script/manual_mount.sh" target="_blank"><b>manual_mount.sh</b></a> in /bin directory.<br  />
 <div class="fragment"><div class="line">board # cd /sdcard/mmcblk0p1/bin/</div>
<div class="line">board # chmod +<a class="code hl_variableRef" target="_blank" href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a> manual_mount.sh</div>
<div class="line">board # ./manual_mount.sh</div>
<div class="line">board # dockerd &amp;</div>
<div class="ttc" id="agroup__IAV_html_gaf80df1bdae91e5f76236e6ed1110825d"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#gaf80df1bdae91e5f76236e6ed1110825d">x</a></div><div class="ttdeci">u32 x</div></div>
</div><!-- fragment --></li>
</ul>
<p class="startli">3) How can the error below be resolved when running <code>dockerd &amp;</code>?<br  />
 </p><div class="fragment"><div class="line">WARN Failed to find iptables: exec: <span class="stringliteral">&quot;iptables&quot;</span>: executable file not found in $PATH</div>
<div class="line">INFO stopping <span class="keyword">event</span> stream following graceful shutdown  error=<span class="stringliteral">&quot;&lt;nil&gt;&quot;</span> module=libcontainerd <span class="keyword">namespace</span>=moby</div>
<div class="line">INFO stopping <span class="keyword">event</span> stream following graceful shutdown  error=<span class="stringliteral">&quot;context canceled&quot;</span> module=libcontainerd <span class="keyword">namespace</span>=plugins.moby</div>
<div class="line">INFO stopping healthcheck following graceful shutdown  module=libcontainerd</div>
<div class="line">failed to start daemon: Error initializing network controller: error obtaining controller instance: failed to create NAT chain DOCKER: Iptables not found</div>
</div><!-- fragment --><p class="startli">Methods of resolution:<br  />
</p><ul>
<li>Modify options in <code>/etc/docker/daemon.json</code>.<br  />
 <div class="fragment"><div class="line">- <span class="stringliteral">&quot;registry-mirrors&quot;</span>:[<span class="stringliteral">&quot;https://hub-mirror.c.163.com&quot;</span>,<span class="stringliteral">&quot;http://f1361db2.m.daocloud.io&quot;</span>]</div>
<div class="line">+ <span class="stringliteral">&quot;registry-mirrors&quot;</span>:[<span class="stringliteral">&quot;https://hub-mirror.c.163.com&quot;</span>,<span class="stringliteral">&quot;http://f1361db2.m.daocloud.io&quot;</span>],</div>
<div class="line">+ <span class="stringliteral">&quot;iptables&quot;</span>:<span class="keyword">false</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Add <code>CONFIG_AMBARELLA_IPTABLES_SUPPORT</code> to the board configuration.</li>
</ul>
<p class="startli">4) How can the error below be resolved when running <code>docker pull arm64v8/ubuntu</code>?<br  />
 </p><div class="fragment"><div class="line">Using <span class="keywordflow">default</span> tag: latest</div>
<div class="line">WARN[2021-11-14T09:45:55.936641160Z] Error getting v2 registry: Get <span class="stringliteral">&quot;https://registry-1.docker.io/v2/&quot;</span>:</div>
<div class="line">dial tcp: lookup registry-1.docker.io on [::1]:53: dial udp [::1]:53: socket: address family not supported by protocol&lt;br&gt;</div>
<div class="line">INFO[2021-11-14T09:45:55.936735420Z] Attempting next endpoint <span class="keywordflow">for</span> pull after error: Get <span class="stringliteral">&quot;https://registry-1.docker.io/v2/&quot;</span>:</div>
<div class="line">dial tcp: lookup registry-1.docker.io on [::1]:53: dial udp [::1]:53: socket: address family not supported by protocol&lt;br&gt;</div>
<div class="line">ERRO[2021-11-14T09:45:55.942925120Z] Handler <span class="keywordflow">for</span> POST /v1.43/images/create returned error: Get <span class="stringliteral">&quot;https://registry-1.docker.io/v2/&quot;</span>:</div>
<div class="line">dial tcp: lookup registry-1.docker.io on [::1]:53: dial udp [::1]:53: socket: address family not supported by protocol&lt;br&gt;</div>
<div class="line">Error response from daemon: Get <span class="stringliteral">&quot;https://registry-1.docker.io/v2/&quot;</span>: dial tcp: lookup registry-1.docker.io on [::1]:53:</div>
<div class="line">dial udp [::1]:53: socket: address family not supported by protocol</div>
</div><!-- fragment --><p class="startli">Methods of resolution:<br  />
</p><ul>
<li>Configure nameserver in <code>/etc/resolv.conf</code>.<br  />
 <div class="fragment"><div class="line">nameserver 8.8.8.8</div>
<div class="line">nameserver 8.8.4.4</div>
</div><!-- fragment --></li>
</ul>
<p class="startli">5) How can the error below be resolved when running <code>docker run -itd --name xxx --privileged=true -p 9554:554 -p 8049:2049 arm64v8/ubuntu</code>?<br  />
 </p><div class="fragment"><div class="line">ERRO[2023-11-20T19:46:54.338243660Z] Handler <span class="keywordflow">for</span> POST /v1.43/containers/9d3d8cd663f0df80f2ba2f0dcf0e0160152eb48d6bceafb619cc11fcd09788ec/start</div>
<div class="line">returned error: failed to create task <span class="keywordflow">for</span> container: failed to start shim: mkdir /var/lib/containerd/io.containerd.runtime.v2.task/moby: no space left on device: unknown&lt;br&gt;</div>
<div class="line">docker: Error response from daemon: failed to create task <span class="keywordflow">for</span> container: failed to start shim:</div>
<div class="line">mkdir /var/lib/containerd/io.containerd.runtime.v2.task/moby: no space left on device: unknown.</div>
</div><!-- fragment --><p> This error is usually caused by the Docker daemon being unable to create a task for the container.</p>
<p class="startli">Methods of resolution:<br  />
</p><ul>
<li>Check if the system resources are sufficient: RAM, storage space, CPU, and more.<br  />
</li>
<li>Users can stop the Docker service, delete the Docker data root directory and re-enable it.</li>
</ul>
<p class="startli">6) How can the error below be resolved when running <code>docker pull arm64v8/ubuntu</code>?<br  />
 </p><div class="fragment"><div class="line">Using <span class="keywordflow">default</span> tag: latest</div>
<div class="line">WARN[2023-11-30T00:00:22.437193920Z] Error getting v2 registry: Get <span class="stringliteral">&quot;https://hub-mirror.c.163.com/v2/&quot;</span>: x509: certificate <span class="keywordtype">signed</span> by unknown authority&lt;br&gt;</div>
<div class="line">INFO[2023-11-30T00:00:22.437284980Z] Attempting next endpoint <span class="keywordflow">for</span> pull after error: Get <span class="stringliteral">&quot;https://hub-mirror.c.163.com/v2/&quot;</span>: x509: certificate <span class="keywordtype">signed</span> by unknown authority&lt;br&gt;</div>
<div class="line">WARN[2023-11-30T00:00:23.240061920Z] Error getting v2 registry: Get <span class="stringliteral">&quot;http://f1361db2.m.daocloud.io/v2/&quot;</span>: dial tcp: lookup f1361db2.m.daocloud.io on 208.67.222.222:53: no such host &lt;br&gt;</div>
<div class="line">INFO[2023-11-30T00:00:23.240131980Z] Attempting next endpoint <span class="keywordflow">for</span> pull after error: Get <span class="stringliteral">&quot;http://f1361db2.m.daocloud.io/v2/&quot;</span>: dial tcp: lookup f1361db2.m.daocloud.io on 208.67.222.222:53: no such host &lt;br&gt;</div>
<div class="line">WARN[2023-11-30T00:00:23.676285300Z] Error getting v2 registry: Get <span class="stringliteral">&quot;https://registry-1.docker.io/v2/&quot;</span>: x509: certificate <span class="keywordtype">signed</span> by unknown authority &lt;br&gt;</div>
<div class="line">INFO[2023-11-30T00:00:23.676359100Z] Attempting next endpoint <span class="keywordflow">for</span> pull after error: Get <span class="stringliteral">&quot;https://registry-1.docker.io/v2/&quot;</span>: x509: certificate <span class="keywordtype">signed</span> by unknown authority&lt;br&gt;</div>
<div class="line">ERRO[2023-11-30T00:00:23.706194600Z] Handler <span class="keywordflow">for</span> POST /v1.41/images/create returned error: Get <span class="stringliteral">&quot;https://registry-1.docker.io/v2/&quot;</span>: x509: certificate <span class="keywordtype">signed</span> by unknown authority&lt;br&gt;</div>
<div class="line">Error response from daemon: Get <span class="stringliteral">&quot;https://registry-1.docker.io/v2/&quot;</span>: x509: certificate <span class="keywordtype">signed</span> by unknown authority&lt;br&gt;</div>
</div><!-- fragment --><p class="startli">The system defaults to not having a CA certificates root certificate, which makes it unable to recognize digital certificates carried by external HTTPS.</p>
<p class="startli">Methods of resolution:<br  />
 If the user is only in the testing phase, the option to disable TLS verify can be configured in /etc/docker/daemon.json. </p><div class="fragment"><div class="line">- <span class="stringliteral">&quot;registry-mirrors&quot;</span>:[<span class="stringliteral">&quot;https://hub-mirror.c.163.com&quot;</span>,<span class="stringliteral">&quot;http://f1361db2.m.daocloud.io&quot;</span>]</div>
<div class="line">+ <span class="stringliteral">&quot;registry-mirrors&quot;</span>:[<span class="stringliteral">&quot;https://hub-mirror.c.163.com&quot;</span>,<span class="stringliteral">&quot;http://f1361db2.m.daocloud.io&quot;</span>],</div>
<div class="line">+ <span class="stringliteral">&quot;tlsverify&quot;</span>: <span class="keyword">false</span></div>
<div class="line">}</div>
</div><!-- fragment --><p> Ambarella recommends the user downloads a digital certificate on the host side for security assurance.</p>
</li>
<li>How do users view the kernel options required for Docker?<br  />
 This can be detected with the following linked script:<br  />
 <code><a href="https://github.com/moby/moby/blob/master/contrib/check-config.sh">https://github.com/moby/moby/blob/master/contrib/check-config.sh</a></code></li>
<li>What are the suggested FS formats when using an SD card?<br  />
 Docker supports different file systems for different storage drivers. The following are the main types of storage drivers supported by Docker: <dl class="section user"><dt>overlay2</dt><dd>This is the recommended storage driver for the current release; it offers excellent performance without additional dependencies and configurations.<br  />
 Replace the overlay storage driver after version 18.09. It supports XFS (in case of ftype = 1) and EXT4 file systems.<br  />
 </dd></dl>
<dl class="section user"><dt>AUFS</dt><dd>The storage driver used in the early days of Docker is recommended before Docker version 18.06 and Ubuntu version 14.04. It supports XFS and EXT4 file systems.<br  />
 </dd></dl>
<dl class="section user"><dt>devicemapper</dt><dd>This is the recommended storage driver for earlier versions of Community Enterprise Operating System (CentOS) and Red Hat Enterprise Linux (RHEL) systems, as they do not support overlay2 and require direct-lvm support.<br  />
 </dd></dl>
<dl class="section user"><dt>BTRFS</dt><dd>Use only for BTRFS file systems. </dd></dl>
<dl class="section user"><dt>ZFS</dt><dd>Use only for ZFS file systems. </dd></dl>
<dl class="section user"><dt>VFS</dt><dd>This does not depend on the file system, but the performance is sub-optimal. Thus, it is mainly used for testing.<br  />
</dd></dl>
Users can select the corresponding file system format according to the driver system used.<br  />
 The Docker official recommendation is to choose the overlay2 storage driver.</li>
</ol>
<hr  />
<h1><a class="anchor" id="docker_license"></a>
14. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ("Software") are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
