<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>System: Migration Guide from CV5x Legacy SDK</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="System"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">System<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dc/dd9/page_sys_mg_legacy.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Migration Guide from CV5x Legacy SDK </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sys_mg_lgc_history"></a>
0. Revision History</h1>
<a class="anchor" id="sys_migration_guide_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td>20230427 </td><td>Initial Version </td></tr>
<tr>
<td rowspan="2">20230725 </td><td>1. Updated Section <a class="el" href="../../dc/dd9/page_sys_mg_legacy.html#sys_mg_lgc_sw_api_diff">3.1 Application Programming Interface (API) Differences</a> </td></tr>
<tr>
<td>2. Updated Section <a class="el" href="../../dc/dd9/page_sys_mg_legacy.html#sys_mg_lgc_ioctl_interface_s_chan_cfg">4.1 IAV_IOC_SET_CHAN_CONFIG</a> </td></tr>
<tr>
<td>20230803 </td><td>Updated Section <a class="el" href="../../dc/dd9/page_sys_mg_legacy.html#sys_mg_lgc_sw_api_diff_multi_vin">3.1.2 Multi-VIN Stitching</a> </td></tr>
<tr>
<td>20231025 </td><td>Added Section <a class="el" href="../../dc/dd9/page_sys_mg_legacy.html#sys_mg_lgc_highlights">2. Highlights for DSP APIs</a> </td></tr>
<tr>
<td>20240122 </td><td>Updated Section <a class="el" href="../../dc/dd9/page_sys_mg_legacy.html#sys_mg_lgc_highlights">2. Highlights for DSP APIs</a> </td></tr>
</table>
<h1><a class="anchor" id="sys_mg_lgc_overview"></a>
1. Overview</h1>
<p >This document provides users with instructions for migrating single- and multiple-video input (VIN) channel designs from the CV5x legacy software development kit (SDK) to the Cooper Linux SDK.</p>
<hr  />
<h1><a class="anchor" id="sys_mg_lgc_highlights"></a>
2. Highlights for DSP APIs</h1>
<p >This chapter describes the highlights for this SDK version, compared with the previous SDK version.</p>
<h2><a class="anchor" id="sys_mg_lgc_highlights_1_6"></a>
2.1 Highlights for DSP APIs in SDK 1.6</h2>
<ul>
<li>The custom SEI API is added to insert customized SEI for AVC / HEVC / MJPEG streams, and the working flow is refined inside DSP / IAV, and the API is not fully compatible with CV2x.</li>
<li>The ISP NN interface are added to support lite NN based motion detection in encode mode 5. The lite NN based motion detection feature is also called "True Motion".</li>
<li>The multiple pass API is added to support up to 2 passes. This feature is redesigned with 2 channels instead of 2 passes in the same channel. With the new design, it is possible to generate multiple source buffers from a multi-view canvas.</li>
<li>IDSP vertical slice related interfaces are added for IDSP veritical slicing feature. This can possibly improve the IDSP pipeline latency.</li>
<li>RAW fps can be specified in the channel cfg. It is the fps after VIN stage, and before IDSP stage. So this fps may possibly be different from sensor fps, and IDSP fps.</li>
<li>The blur color API is added to specify the blur color, if needed.</li>
<li>The stream overlay API is updated to support Y blend only, or UV blend only. Default is to blend both Y and UV.</li>
<li>The motion data API is added to support the motion data query.</li>
<li>The encoded frame num is supported into <a class="elRef" target="_blank" href="../../../library/d9/d2b/structiav__framedesc.html">iav_framedesc</a> and <a class="elRef" target="_blank" href="../../../library/de/d90/structiav__slicedesc.html">iav_slicedesc</a>, to report stream based frame number.</li>
<li>The new IAV memory IAV_PART_IMG_NN is added to support for image NN buffer, which can be used for NN based image processing.</li>
<li>The option "hevc_width_align_enable" is added in <a class="elRef" target="_blank" href="../../../library/d0/d9e/structiav__stream__resource.html">iav_stream_resource</a> and <a class="elRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> to enable padding to improve HEVC encoding efficiency.</li>
<li>The option "enc_extra_padding_enable" is added to support extra paddding for stream encoding, to eliminate the potential encoding boundary artifacts due to alignment.</li>
<li>The overlay / blur audit is added to audit frame sync failure count.</li>
<li>The IDSP audit is updated to support grouping frame drop count.</li>
</ul>
<h2><a class="anchor" id="sys_mg_lgc_highlights_1_5"></a>
2.2 Highlights for DSP APIs in SDK 1.5</h2>
<ul>
<li>IDSP channel num is increased from 8 to 16.</li>
<li>The MJPEG encoding width is limited to be 16 aligned, and height to be 8 aligned. In preview SDK versions, both width and height are incorrectly limited to 4 aligned. The valid values are 0 ~ 2, with value 0 weakest blur effect and 2 strongest blur effect.</li>
<li>The parameter vout_possible_map must be specified, if other than VOUT 1 may be supported.</li>
<li>VIN ROI related interfaces are added into VIN APIs.</li>
<li>The RAW width and height information is added into <a class="elRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> structure, which stands for the actual output RAW size information.</li>
<li>RAW slice related interfaces are added for RAW vertical slicing feature.</li>
<li>Blur coefficients parameters is added to achieve different blur effects.</li>
<li>The skip strengh is by default set to 2 for AVC / HEVC for better encoding efficiency.</li>
<li>The AVC scalelist strength is added for better encoding efficiency.</li>
<li>The blending DPTZ APIs are added to support blending DPTZ runtime update for the canvas.</li>
<li>The IDSP encode sync API is added to support synchronization for IDSP and encoder.</li>
<li>The image scalar audit API is added for IDSP clock audit.</li>
<li>The encoder audit API is added for encoder clock audit.</li>
<li>The IQ ADJ parameters has been refined with structure changes, so it is not fully compatible with previous SDK versions.</li>
</ul>
<hr  />
<h1><a class="anchor" id="sys_mg_lgc_sw"></a>
3. Software</h1>
<p >This chapter describes the migration of the software from the CV5x legacy SDK to the Cooper Linux SDK.</p>
<h2><a class="anchor" id="sys_mg_lgc_sw_api_diff"></a>
3.1 Application Programming Interface (API) Differences</h2>
<h3><a class="anchor" id="sys_mg_lgc_sw_api_diff_blur_insertion"></a>
3.1.1 Blur Insertion</h3>
<ul>
<li>The blur effect in the Cooper Linux SDK is improved to achive better consistency across preview buffers and create more visual effects. The maximum-supported blur strength level is extended to four, while there are only three strength levels in the legacy SDK. When mosaic-like blur is enabled, each mosaic block's size will be fixed to 8x8, 16x16, 32x32, or 64x64 pixels in the respective strength level. This presents more flexibilities for users to choose from different resolutions of preview buffers.</li>
<li>Pyramid is still required to be enabled for blur, but pyramid layer selection is managed entirely in the SDK. It is no longer required for users to enable the pyramid layer used by blur.</li>
<li>Channel groups are not required for blur in the Cooper Linux SDK.</li>
<li>The new blur coefficients are supported in the Cooper Linux SDK to achieve different blur effects. The valid values are 0 ~ 2, with value 0 weakest blur effect and 2 strongest blur effect.</li>
<li>The maximum blur number for a single stream is increased from 8 in CV5x Legacy SDK to 16 in Cooper Linux SDK.</li>
<li>There is less dynamic random-access memory (DRAM) footprint when the blur is enabled in the Cooper Linux SDK, compared to the CV5x legacy SDK.</li>
</ul>
<h3><a class="anchor" id="sys_mg_lgc_sw_api_diff_multi_vin"></a>
3.1.2 Multi-VIN Stitching</h3>
<ul>
<li>In the legacy SDK, each canvas's stitching is performed independently. In the Cooper Linux SDK, the stitching effect is decided by the layout of the main buffers. Stitching on sub-buffers is scaled from the main buffer and copied to sub-buffers.</li>
<li>To skip blend stitching for a certain sub-buffer, users should set "blend_stitch_type = 0" in the structure <a class="elRef" target="_blank" href="../../../library/dd/d01/structiav__canvas__cfg.html">iav_canvas_cfg</a> in the legacy SDK; and should set "srcbuf_to_skip_blend" in the structure <a class="elRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> in the Cooper Linux SDK.</li>
<li>In the Cooper Linux SDK, a preview buffer is sacrificed for stitching: the fifth buffer on CV5x, and the second buffer on other chips. In other words, the fifth buffer or the second buffer cannot be placed into any canvas or used as pyramid input when stitching is enabled.</li>
<li>In the Cooper Linux SDK, the sixth buffer cannot enable the stitch; this restriction doesn't exist in the legacy SDK.</li>
</ul>
<h3><a class="anchor" id="sys_mg_lgc_sw_api_diff_img_scale"></a>
3.1.3 Arbitrary Image Scaler</h3>
<ul>
<li>In the legacy SDK, the arbitrary image scaler only supports NV12 and NV16 formats, and the format is decided when entering into the preview. Ambarella does not support scaling different image formats after preview.</li>
<li>In the Cooper Linux SDK, the arbitrary image scaler supports NV12, NV16, and MONO formats. Users can send scaler jobs with mixed YUV formats after preview.</li>
<li>In the legacy SDK, the offset and size of the image scaler all must be aligned to four. While the width and x-offset must be aligned to four in the Cooper Linux SDK, the height and y-offset must be aligned only to 2.</li>
</ul>
<h3><a class="anchor" id="sys_mg_lgc_sw_api_diff_seventh_buf"></a>
3.1.4 Seventh Preview Buffer</h3>
<ul>
<li>The seventh preview buffer is not supported in the Cooper Linux SDK.</li>
</ul>
<h3><a class="anchor" id="sys_mg_lgc_sw_api_diff_eis"></a>
3.1.5 Electronic Image Stabilization</h3>
<ul>
<li>In the legacy SDK, electronic image stabilization (EIS) uses the two-channel approach, and the EIS source channel can run in mode 0 or mode 5.</li>
<li>In the Cooper Linux SDK, although EIS still uses the two-channel approach, the EIS source channel should run in mode 8. This saves system resources, as the first EIS channel is only used to generate 3A (auto exposure (AE) / auto white balance (AWB) / auto focus (AF)) statistics data.</li>
</ul>
<h3><a class="anchor" id="sys_mg_lgc_sw_api_diff_overlay"></a>
3.1.6 Overlay</h3>
<ul>
<li>The total overlay number of all streams cannot exceed 64 in the Cooper Linux SDK.</li>
</ul>
<h3><a class="anchor" id="sys_mg_lgc_sw_api_diff_vout"></a>
3.1.7 VOUT</h3>
<ul>
<li>With Cooper Linux SDK, the VOUT possible map parameter vout_possible_map must be specified when booting DSP, if there is potential requirement to use VOUT 0, 2, or multiple VOUT devices. If there is only potential VOUT 1 is needed, then there is no need to configure this.</li>
</ul>
<hr  />
<h1><a class="anchor" id="sys_mg_lgc_ioctl_interface"></a>
4. Input / Output Control (IOCTL) Interface</h1>
<p >The legacy SDK and the Cooper Linux SDK share the same API files, so they include identical IOCTLs and structures. Only some structure members may not be required in the Cooper Linux SDK, or they may be used for a different purpose.</p>
<p >This chapter describes software migration and provides IOCTL differences between the legacy SDK and the Cooper Linux SDK. The IOCTLs are as follows:</p><ul>
<li><a class="el" href="../../dc/dd9/page_sys_mg_legacy.html#sys_mg_lgc_ioctl_interface_s_chan_cfg">3.1 IAV_IOC_SET_CHAN_CONFIG</a></li>
<li><a class="el" href="../../dc/dd9/page_sys_mg_legacy.html#sys_mg_lgc_ioctl_interface_g_chan_cfg">3.2 IAV_IOC_GET_CHAN_CONFIG</a></li>
<li><a class="el" href="../../dc/dd9/page_sys_mg_legacy.html#sys_mg_lgc_ioctl_interface_s_system_resource">3.3 IAV_IOC_SET_SYSTEM_RESOURCE</a></li>
<li><a class="el" href="../../dc/dd9/page_sys_mg_legacy.html#sys_mg_lgc_ioctl_interface_g_system_resource">3.4 IAV_IOC_GET_SYSTEM_RESOURCE</a></li>
</ul>
<h2><a class="anchor" id="sys_mg_lgc_ioctl_interface_s_chan_cfg"></a>
4.1 IAV_IOC_SET_CHAN_CONFIG</h2>
<p >The structure parameter changes are listed below: </p><table class="doxtable">
<caption>Table 3-1. <a class="elRef" target="_blank" href="../../../library/d9/db4/structiav__chan__cfg.html">iav_chan_cfg</a> Structure Definition.</caption>
<tr>
<th>Parameter </th><th>Used in legacy </th><th>Used in Cooper </th></tr>
<tr>
<td>"vsrc_ctx_pattern" </td><td>✓ </td><td>Not implemented </td></tr>
<tr>
<td>"vsrc_ctx_pattern_mask" </td><td>✓ </td><td>Not implemented </td></tr>
<tr>
<td>"slice_cfg_enable" </td><td>✓ </td><td>- </td></tr>
<tr>
<td>"slice_num" </td><td>✓ </td><td>- </td></tr>
<tr>
<td>"warp_padding_width" </td><td>✓ </td><td>✓<br  />
For rotation pipeline only </td></tr>
<tr>
<td>"slice_width" </td><td>✓ </td><td>- </td></tr>
<tr>
<td>"c2y_slice_num" </td><td>✓ </td><td>- </td></tr>
<tr>
<td>"high_perf_enable" </td><td>- </td><td>- </td></tr>
<tr>
<td>"srcbuf_to_skip_blend" </td><td>- </td><td>✓ </td></tr>
</table>
<h2><a class="anchor" id="sys_mg_lgc_ioctl_interface_g_chan_cfg"></a>
4.2 IAV_IOC_GET_CHAN_CONFIG</h2>
<p >Refer to the structure parameter change from IOCTL <b>IAV_IOC_SET_CHAN_CONFIG</b>.</p>
<h2><a class="anchor" id="sys_mg_lgc_ioctl_interface_s_system_resource"></a>
4.3 IAV_IOC_SET_SYSTEM_RESOURCE</h2>
<p >Because the image format of arbitrary image scaler is not required to be specified at preview, the "format" member in the structure <a class="elRef" target="_blank" href="../../../library/d1/d04/structiav__img__scale__cfg.html">iav_img_scale_cfg</a> will not be used in the Cooper Linux SDK. The following lists the changes in the structure parameter <a class="elRef" target="_blank" href="../../../library/d1/d04/structiav__img__scale__cfg.html">iav_img_scale_cfg</a> for the IOCTL <b>IAV_IOC_SET_SYSTEM_RESOURCE</b>. </p><table class="doxtable">
<caption>Table 3-2. <a class="elRef" target="_blank" href="../../../library/d1/d04/structiav__img__scale__cfg.html">iav_img_scale_cfg</a> Structure Definition.</caption>
<tr>
<th>Parameter </th><th>Used in legacy </th><th>Used in Cooper </th></tr>
<tr>
<td>"format" </td><td>✓ </td><td>- </td></tr>
</table>
<h2><a class="anchor" id="sys_mg_lgc_ioctl_interface_g_system_resource"></a>
4.4 IAV_IOC_GET_SYSTEM_RESOURCE</h2>
<p >Refer to the structure parameter change from IOCTL <b>IAV_IOC_SET_SYSTEM_RESOURCE</b>.</p>
<hr  />
<h1><a class="anchor" id="sys_mg_lgc_tools"></a>
5. Tools</h1>
<p >CV5x legacy SDK and the Cooper Linux SDK use the same toolchain.</p>
<hr  />
<h1><a class="anchor" id="sys_mg_lgc_faq"></a>
6. Frequently Asked Questions (FAQ)</h1>
<p ><b>Question:</b> Is it difficult to migrate from the legacy SDK to the Cooper Linux SDK?</p>
<p ><b>Answer:</b> Migrating from the CV5x legacy SDK to the Cooper Linux SDK is simple, as they share the same API header files. Only a few changes are required for migration.</p>
<hr  />
<h1><a class="anchor" id="sys_mg_lgc_license"></a>
7. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ( "Software" ) are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
