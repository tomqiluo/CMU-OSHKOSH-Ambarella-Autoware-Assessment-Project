<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>System: OPTIMIZATION - Power Management</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="System"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">System<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d2/d90/page_sys_pm.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">OPTIMIZATION - Power Management </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sys_pm_history"></a>
0. Revision History</h1>
<a class="anchor" id="sys_opt_power_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Updated Date </th><th align="left">Modification </th></tr>
<tr>
<td>20220809 </td><td>Initial Version </td></tr>
<tr>
<td>20220812 </td><td>Updated <a class="el" href="../../d2/d90/page_sys_pm.html">OPTIMIZATION - Power Management</a> for detailed information </td></tr>
<tr>
<td>20220921 </td><td>Added Section <a class="el" href="../../d2/d90/page_sys_pm.html#sys_pm_adc">2.11 Analog-to-Digital Converter</a> </td></tr>
<tr>
<td>20230209 </td><td>Added Section <a class="el" href="../../d2/d90/page_sys_pm.html#sys_pm_ccidsp">2.2 CPU, Core, and IDSP Clock Runtime Update</a> </td></tr>
<tr>
<td rowspan="4">20230831 </td><td>1. Added Section <a class="el" href="../../d2/d90/page_sys_pm.html#sys_pm_pcie">2.12 Peripheral Component Interconnect Express</a> </td></tr>
<tr>
<td>2. Added Section <a class="el" href="../../d2/d90/page_sys_pm.html#sys_pm_hevc">2.13 High Efficiency Video Coding (HEVC)</a> </td></tr>
<tr>
<td>3. Added Section <a class="el" href="../../d2/d90/page_sys_pm.html#sys_pm_vout_video">2.7.4 Video (LCD)</a> </td></tr>
<tr>
<td>4. Updated Section <a class="el" href="../../d2/d90/page_sys_pm.html#sys_pm_vout">2.7 Video Output</a> </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="sys_pm_overview"></a>
1. Overview</h1>
<p >This document provides guidelines for power management with the Ambarella CV5x Flexible Linux Software Development Kit (SDK).</p>
<hr  />
<h1><a class="anchor" id="sys_pm_power_optimization"></a>
2. Power Optimization</h1>
<h2><a class="anchor" id="sys_pm_po_core_numbers"></a>
2.1 Core Numbers</h2>
<h3><a class="anchor" id="sys_pm_po_core_linux"></a>
2.1.1 Linux Boot Arguments Modification</h3>
<p >If the system load is minimal, the number of CPU cores can be set to two or less. This modification alters the Linux boot arguments (bootargs); a reboot is required to take effect.</p>
<ol type="1">
<li>If Arm速 trusted firmware (ATF) is enabled, then CONFIG_RELOAD_UNTRUSTED_DTB is also required in order for AMBoot modifications to take effect. <div class="fragment"><div class="line">build$ make menuconfig</div>
<div class="line">        Main menu</div>
<div class="line">         -&gt; boot</div>
<div class="line">           -&gt; amboot (boot/ambamk) (CONFIG_AMBOOT [=<a class="code hl_variableRef" target="_blank" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>])</div>
<div class="line">             -&gt; Ambarella Firmware Configuration</div>
<div class="line">               -&gt; AMBoot Options</div>
<div class="line">                 -&gt; Boot with TrustZone (CONFIG_AARCH64_TRUSTZONE [=<a class="code hl_variableRef" target="_blank" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>])</div>
<div class="line">                   -&gt; Secure DTB with Signature (SOC Firmware Config) (CONFIG_TRUSTZONE_DTB_SIGNED [=<a class="code hl_variableRef" target="_blank" href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a>])</div>
<div class="line">                     -&gt; Reload DTB in PTB partiton</div>
<div class="ttc" id="agroup__IAV_html_ga11e444dd61d48abbdd34eed23186cb4b"><div class="ttname"><a href="../../../driver/df/dc0/group__IAV.html#ga11e444dd61d48abbdd34eed23186cb4b">y</a></div><div class="ttdeci">u32 y</div></div>
</div><!-- fragment --></li>
<li>Enter into AMBoot and modify the bootargs. <div class="fragment"><div class="line">amboot&gt;  fdt cmdline</div>
<div class="line"> </div>
<div class="line">/chosen</div>
<div class="line">linux,stdout-path = /apb@20e4000000/uart@e4000000</div>
<div class="line">bootargs = console=ttyS0 ubi.mtd=lnx root=ubi0:rootfs rw rootfstype=ubifs init=/linuxrc</div>
<div class="line">pci=nomsi,pcie_bus_perf pcie_pme=nomsi</div>
<div class="line">ambarella,hibernate-lzo-enable</div>
<div class="line">amboot&gt;  fdt cmdline console=ttyS0 ubi.mtd=lnx root=ubi0:rootfs rw rootfstype=ubifs</div>
<div class="line">init=/linuxrc pci=nomsi,pcie_bus_perf pcie_pme=nomsi maxcpus=1 <span class="comment">//change to 1 CPU Cores</span></div>
<div class="line">amboot&gt; booti <span class="comment">//boot to linux</span></div>
</div><!-- fragment --></li>
<li>Boot into Linux and check the log below: <div class="fragment"><div class="line">[    0.336985] rcu: Hierarchical SRCU implementation.</div>
<div class="line">[    0.342039] smp: Bringing up secondary CPUs ...</div>
<div class="line">[    0.346583] smp: Brought up 1 node, 1 CPU</div>
<div class="line">[    0.270393] SMP: Total of 1 processors activated. <span class="comment">//total 1 CPU cores are up.</span></div>
</div><!-- fragment --></li>
</ol>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>CV5x chips do not support CPU core hotplug.</li>
<li>The CV72 chip does not support CPU core hotplug.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="sys_pm_ccidsp"></a>
2.2 CPU, Core, and IDSP Clock Runtime Update</h2>
<p >This feature enables users to update the CPU, core, and image digital signal processor (IDSP) clocks on the fly. This benefits users as it enables them to select the appropriate CPU, core, and IDSP clocks to conserve system power.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>In order to change the CPU and core clocks, ATF must be involved. For more details about ATF, refer to Section <a class="el" href="../../d2/d90/page_sys_pm.html#sys_pm_atf">3. Arm Trusted Firmware</a>.</li>
<li>If users request runtime updates of the CPU and core clocks, Amabrella recommends reserving the ATF partition at the NAND partition layout design.</li>
<li>When changing the core and IDSP clocks for the digital signal processor (DSP), the DSP must first be placed in the idle state.</li>
</ul>
</dd></dl>
<h3><a class="anchor" id="sys_pm_ccidsp_bF"></a>
2.2.1 Build the Firmware</h3>
<p >Suppose that users want to switch over among the following CPU, core, and IDSP clock combinations. </p><table class="doxtable">
<caption>Table 2-1. CPU, Core, and IDSP Clock Combinations.</caption>
<tr>
<th>CPU (MHz)</th><th>Core (MHz)</th><th>IDSP (MHz) </th></tr>
<tr>
<td>1608</td><td>1140</td><td>960 </td></tr>
<tr>
<td>1392</td><td>960</td><td>720 </td></tr>
<tr>
<td>600</td><td>336</td><td>360 </td></tr>
</table>
<p>Follow the steps below to build the firmware.</p>
<ol type="1">
<li>Change the CV5x device trees (DTS) to add the desired CPU and core clock combinations. The following provides an example using the CV5 system on chip (SoC):<br  />
 <div class="fragment"><div class="line">build $ vi ambarella/kernel/linux-5.15/arch/arm64/boot/dts/ambarella/ambarella-cv5.dtsi</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">     * MASK</div>
<div class="line">     * + --- + ----- + ----- +</div>
<div class="line">     * | bit |   1   |   0   |</div>
<div class="line">     * + --- + ----- + ----- +</div>
<div class="line">     * | clk |  CORE | CORTEX|</div>
<div class="line">     * + --- + ----- + ----- +</div>
<div class="line"> </div>
<div class="line">    cpufreq-mask = &lt;1&gt;;</div>
<div class="line">    amb,timer-freq-adjust-off;</div>
<div class="line">    clocks = &lt;&amp;gclk_cortex &amp;gclk_core&gt;;</div>
<div class="line">    clock-names = <span class="stringliteral">&quot;cortex_clk&quot;</span>, <span class="stringliteral">&quot;core_clk&quot;</span>;</div>
<div class="line">    clocks-frequency-cortex-core =</div>
<div class="line">        &lt;1608000  1140000&gt;,</div>
<div class="line">        &lt;1392000  960000&gt;,</div>
<div class="line">        &lt;600000   336000&gt;;</div>
<div class="line">        };</div>
</div><!-- fragment --></li>
<li>Select the following kernel configuration to enable CPU frequency scaling. <div class="fragment"><div class="line">build $ make sync_build_mkcfg</div>
<div class="line">build $ make cv5_ipcam_atf_config</div>
<div class="line">build $ make defconfig_public_linux</div>
<div class="line">build $ make menuconfig_public_linux</div>
<div class="line">  CPU Power Manager ---&gt;</div>
<div class="line">   CPU Frequency scaling ---&gt;</div>
<div class="line">    Default CPUFreq governor (userspace) ---&gt;</div>
<div class="line">    ( ) performance</div>
<div class="line">    (X) userspace</div>
<div class="line">    ( ) ondemand</div>
<div class="line">    ( ) conservative</div>
</div><!-- fragment --> Usage guidelines of the four options above are as follows:<ul>
<li><b>Performance:</b> the guaranteed performance</li>
<li><b>Userspace:</b> users can update on the fly</li>
<li><b>Ondemand:</b> users can update on the fly, according to the present requirements</li>
<li><b>Conservative:</b> users can update on the fly in a conservative manner</li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="sys_pm_change_clock"></a>
2.2.2 Change CPU, Core, and IDSP Clock</h3>
<p >Note that Ambarella recommends updating the clock in the Telnet client console rather than in the serial port.<br  />
</p><ol type="1">
<li>Open Telnet and perform the following operations.</li>
<li>Update frequency on the fly through the following commands:</li>
</ol>
<div class="fragment"><div class="line"><span class="comment">// Disabling kernel prints is required for extremely low frequency</span></div>
<div class="line">board # echo 1 1 1 1 &gt; /proc/sys/kernel/printk</div>
<div class="line">board # cd /sys/devices/system/cpu/cpu1/cpufreq</div>
<div class="line">board # cat scaling_available_frequencies   <span class="comment">// Check the available clock options</span></div>
<div class="line">1608000 1392000 600000</div>
<div class="line">board # echo 1392000 &gt; scaling_setspeed     <span class="comment">// Change CPU and Core clocks</span></div>
<div class="line">board # echo gclk_idsp 720000000 &gt; /proc/ambarella/clock        <span class="comment">// Change IDSP clock</span></div>
<div class="line">board # cat /proc/ambarella/clock       <span class="comment">// check whether clocks are set properly</span></div>
<div class="line">Clock Information:</div>
<div class="line"> </div>
<div class="line">        gclk_cortex:    1392000000 Hz</div>
<div class="line">        gclk_core:      1140000000 Hz</div>
<div class="line">        gclk_idsp:      720000000  Hz</div>
</div><!-- fragment --><p >Several options that can be set are in the folder <code>/sys/devices/system/cpu/cpu0/cpufreq</code>, and are listed as follows:<br  />
</p><ul>
<li><b>scaling_available_frequencies:</b> the supported frequencies to be updated</li>
<li><b>scaling_governor:</b> the current governor (performance / userspace / ondemand / conservative)</li>
<li><b>scaling_cur_freq:</b> the current frequency, in kHz; 24000 is 24 MHz</li>
<li><b>scaling_setspeed:</b> the frequency to be updated</li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>CPU, IDSP, and core clocks are independent from one another. Users can attempt any combination. For CPU clocks and core clocks, only frequencies listed in the DTSi are permitted to be set. Ensure that those values are multiples of 24 MHz.</li>
<li>The maximum CPU, IDSP, and core clocks CANNOT be greater than the specification of the corresponding CV5x system on chip (SoC).</li>
<li>If the clock is updated to a low value, such as 24000, the serial port may not function. However, the Telnet port may still function.</li>
<li>The CPU clock must be greater than 96 MHz due to the physical design limitation.</li>
<li>The core clock must be greater than 24 MHz. If a high-definition multimedia interface (HDMI速) is enabled with a resolution greater than 480p, a minimum value of 96 MHz for the core clock is suggested.</li>
</ul>
</dd></dl>
<h3><a class="anchor" id="sys_pm_measure_clock"></a>
2.2.3 Measure Clock Runtime-Switch Time</h3>
<p >The clock runtime-switch time includes the clock switching time and the re-running DSP time. The spent time varies according to different DSP use cases. Users can measure the clock runtime-switch time using the following method.<br  />
 Place the clock switching and unit test commands (to re-run the DSP) into a single script. Then, use the tool "time" to measure the time spent executing this script. The "time" tool outputs the spent time with the results displayed as three parts:</p>
<p ><b>Real:</b> total spent time <br  />
 <b>User:</b> user space spent time <br  />
 <b>Sys:</b> kernel space spent time <br  />
</p>
<p >For example, the script <code>clock_switch.sh</code> includes changing the IDSP clock commands and re-entering preview commands, as shown below: </p><div class="fragment"><div class="line"><span class="preprocessor">#!/bin/sh</span></div>
<div class="line"><span class="preprocessor"># put dsp to idle state before changing idsp clock</span></div>
<div class="line">test_encode --idle --nopreview</div>
<div class="line"><span class="preprocessor"># change idsp clock</span></div>
<div class="line">echo gclk_idsp 720000000 &gt; /proc/ambarella/clock</div>
<div class="line">sleep 1</div>
<div class="line"><span class="preprocessor"># re-enter preview state</span></div>
<div class="line">test_encode --resource-cfg /usr/share/ambarella/lua_scripts/cv5_vin0_1080p_linear.lua --vout-cfg /usr/share/ambarella/lua_scripts/vout_hdmi.lua</div>
</div><!-- fragment --><p> The user can measure the time on the board, as shown below. </p><div class="fragment"><div class="line">board # time ./clock_switch.sh</div>
<div class="line">...</div>
<div class="line">enable preview done</div>
<div class="line">real    0m 1.83s</div>
<div class="line">user    0m 0.06s</div>
<div class="line">sys     0m 0.26s</div>
</div><!-- fragment --><h2><a class="anchor" id="sys_pm_vector_processor"></a>
2.3 Vector Processor Clock Runtime Update</h2>
<p >The vector processor (VP) clock frequency can only be switched to a different frequency when the VP is not in use. Use <code>cavalry_load</code> to change the VP clock. </p><div class="fragment"><div class="line">board # cat /proc/ambarella/clock        <span class="comment">//check all the system clock</span></div>
<div class="line">Clock Information:</div>
<div class="line">...</div>
<div class="line">        gclk_vision:    1104000000Hz</div>
<div class="line">board # cavalry_load --vp-clk 1/2        <span class="comment">//set vp clock to 542 MHz</span></div>
<div class="line">Configure VP Clock Percentage: 552/1104</div>
<div class="line">board # cat /proc/ambarella/clock        <span class="comment">//check the clock again</span></div>
<div class="line">Clock Information:</div>
<div class="line">...</div>
<div class="line">        gclk_vision:    552000000 Hz</div>
<div class="line">board #</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd><ul>
<li>Because the VP clock setting in the .ini file is the runtime upper limit, the runtime VP clock change cannot exceed the value in the .ini file.</li>
<li>The VP clock must be an exact multiple of 24 MHz and cannot be set to 0. Users must calculate the fraction when updating the VP clock. Additionally, users must always check the clock frequency after setting it.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="sys_pm_vin"></a>
2.4 Video Input</h2>
<p >Contact the Ambarella SDK support team for connecting the video input (VIN) pins to the ground (GND).</p>
<h2><a class="anchor" id="sys_pm_mipi_interface"></a>
2.5 Mobile Industry Processor Interface</h2>
<p >If no mobile industry processor interface (MIPI速) sensor is used, the MIPI CSI-2 power can be lowered via the following commands: </p><div class="fragment"><div class="line">board # devmem 0x20ED2000E8 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed200124 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed200160 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed20019c 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed2001d8 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed200214 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed200250 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed20028c 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed2002c8 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed200304 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed200340 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed20037c 32 0x0d2b5c03</div>
<div class="line">board # devmem 0x20ed2000ec 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed200128 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed200164 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed2001a0 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed2001dc 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed200218 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed200254 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed200290 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed2002cc 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed200308 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed200344 32 0x024179a8</div>
<div class="line">board # devmem 0x20ed200380 32 0x024179a8</div>
</div><!-- fragment --><h2><a class="anchor" id="sys_pm_gpio"></a>
2.6 General Purpose Input / Output</h2>
<p >To conserve power, all floating inputs / outputs (I/Os) can be set to the general purpose input / output (GPIO) and enabled with an internal pull-low. Refer to the <em>Peripherals</em> Doxygen webpages for additional details regarding GPIO configuration. Then, use the following commands: </p><div class="fragment"><div class="line">board # devmem 0x20e002f068 32 0xffffffff</div>
<div class="line">board # devmem 0x20e002f06c 32 0xffffffff</div>
<div class="line">board # devmem 0x20e002f070 32 0xffffffff</div>
<div class="line">board # devmem 0x20e002f074 32 0xffffffff</div>
<div class="line">board # devmem 0x20e002f078 32 0xffffffff</div>
<div class="line">board # devmem 0x20ed080314 32 0x0</div>
<div class="line">board # devmem 0x20ed080318 32 0x0</div>
<div class="line">board # devmem 0x20ed08031c 32 0x0</div>
<div class="line">board # devmem 0x20ed080320 32 0x0</div>
<div class="line">board # devmem 0x20ed080324 32 0x0</div>
<div class="line">board # devmem 0x20ed080328 32 0x0</div>
<div class="line">board # devmem 0x20ed08032c 32 0x0</div>
<div class="line">board # devmem 0x20ed080330 32 0x0</div>
<div class="line">board # devmem 0x20ed08043c 32 0x0</div>
<div class="line">board # devmem 0x20ed080440 32 0x0</div>
<div class="line">board # devmem 0x20ed080444 32 0x0</div>
</div><!-- fragment --><p> Or, use <code>poweroff_pdev.sh</code> in the path <code>ambaralla/app/utility/amba_scripts</code>: </p><div class="fragment"><div class="line">board # poweroff_pdev.sh --gpio</div>
</div><!-- fragment --><h2><a class="anchor" id="sys_pm_vout"></a>
2.7 Video Output</h2>
<p >If video output (VOUT) is not required, contact the Ambarella SDK support team to disable it. VOUT B can be disabled using the following command: </p><div class="fragment"><div class="line">board # devmem 0x20e0008a04 32 0x00    <span class="comment">// disable vout a clock</span></div>
<div class="line">board # devmem 0x20e0008a08 32 0x00    <span class="comment">// disable vout b clock</span></div>
<div class="line">board # devmem 0x20e0008a1c 32 0x00    <span class="comment">// disable vout c clock</span></div>
</div><!-- fragment --><p> Alternatively, use <code>poweroff_pdev.sh</code>: </p><div class="fragment"><div class="line">board # poweroff_pdev.sh --vout</div>
</div><!-- fragment --><h3><a class="anchor" id="sys_pm_vout_cvbs"></a>
2.7.1 Composite Video Broadcast Signal</h3>
<p >If CVBS is not required, disable it using the following commands: </p><div class="fragment"><div class="line">board # devmem 0x20ed080688 32 0x40000000   <span class="comment">//  Disable CVBS</span></div>
</div><!-- fragment --><p> Alternatively, use <code>poweroff_pdev.sh</code>: </p><div class="fragment"><div class="line">board # poweroff_pdev.sh --cvbs</div>
</div><!-- fragment --><h3><a class="anchor" id="sys_pm_vout_hdmi"></a>
2.7.2 HDMI</h3>
<p >If HDMI is not required, disable it using the following commands: </p><div class="fragment"><div class="line">board # devmem 0x20ed080008 32 0x0c   <span class="comment">//  Power down HDMI</span></div>
<div class="line">board # devmem 0x20ed0801a8 32 0x14073021   <span class="comment">//  Power down the HDMI PLL</span></div>
<div class="line">board # devmem 0x20ed0801a8 32 0x14073020</div>
</div><!-- fragment --><p> Alternatively, use poweroff_pdev.sh: </p><div class="fragment"><div class="line">board # poweroff_pdev.sh --hdmi</div>
</div><!-- fragment --><h3><a class="anchor" id="sys_pm_vout_mipidsi"></a>
2.7.3 MIPI DSI</h3>
<p >If MIPI DSI速 is not required, disable it using the following commands: </p><div class="fragment"><div class="line">board # devmem 0x20ed200028 32 0x000300ff   <span class="comment">//  Power down the mipi dsi</span></div>
<div class="line">board # devmem 0x20ed200020 32 0x00000006</div>
</div><!-- fragment --><h3><a class="anchor" id="sys_pm_vout_video"></a>
2.7.4 Video (LCD)</h3>
<p >If LCD is not required, disable it using the following command: </p><div class="fragment"><div class="line">board # devmem 0x20ed0800c0 32 0x01078021</div>
<div class="line">board # devmem 0x20ed0800c0 32 0x01078020</div>
</div><!-- fragment --><h2><a class="anchor" id="sys_pm_cv"></a>
2.8 Computer Vision</h2>
<p >If computer vision (CV) is not required, disable it to save power. Contact the Ambarella SDK support team for further assistance. </p><div class="fragment"><div class="line">board # devmem 0x20ed0806e4 32 0x2f130020   <span class="comment">//  Disable clock for CV</span></div>
</div><!-- fragment --><p> Alternatively, use poweroff_pdev.sh: </p><div class="fragment"><div class="line">board # poweroff_pdev.sh --cv</div>
</div><!-- fragment --><h2><a class="anchor" id="sys_pm_sdio"></a>
2.9 Secure Digital Input / Output</h2>
<p >If secure digital input / output (SDIO) is not required, disable it using the following commands: </p><div class="fragment"><div class="line">board # devmem 0x20ed0804ac 32 0x16012021   <span class="comment">//  Power down sdio clk</span></div>
<div class="line">board # devmem 0x20ed0804ac 32 0x16012020</div>
</div><!-- fragment --><p> Alternatively, use poweroff_pdev.sh: </p><div class="fragment"><div class="line">board # poweroff_pdev.sh --sd</div>
</div><!-- fragment --><h2><a class="anchor" id="sys_pm_audio"></a>
2.10 Audio</h2>
<p >If audio is not required, disable it using the following commands: </p><div class="fragment"><div class="line">board # devmem 0x20e0024110 32 0x01   <span class="comment">//  Power down audio clk</span></div>
</div><!-- fragment --><p> Alternatively, use poweroff_pdev.sh: </p><div class="fragment"><div class="line">board # poweroff_pdev.sh --audio</div>
</div><!-- fragment --><h2><a class="anchor" id="sys_pm_adc"></a>
2.11 Analog-to-Digital Converter</h2>
<p >If the analog-to-digital converter (ADC) is not required, disable it using the following command: </p><div class="fragment"><div class="line">board # devmem 0x20ed080198 32 0x00000002   <span class="comment">//  Power down adc</span></div>
</div><!-- fragment --><p> Or use poweroff_pdev.sh: </p><div class="fragment"><div class="line">board # poweroff_pdev.sh --adc</div>
</div><!-- fragment --><h2><a class="anchor" id="sys_pm_pcie"></a>
2.12 Peripheral Component Interconnect Express</h2>
<p >If peripheral component interconnect express (PCIe) is not required, set the disable flag into the related DTS node: </p><div class="fragment"><div class="line">&amp;pciec_rc {</div>
<div class="line">    status = <span class="stringliteral">&quot;disabled&quot;</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="sys_pm_hevc"></a>
2.13 High Efficiency Video Coding (HEVC)</h2>
<p >If the system only encodes in H.264 format, then the H.265 state registers can be disabled using the following command. </p><div class="fragment"><div class="line">board # devmem 0x20ed08008c 32 0xffff7f7f   <span class="comment">//  Disable DSP HEVC STATE REG</span></div>
</div><!-- fragment --><p> Or, use poweroff_pdev.sh: </p><div class="fragment"><div class="line">board # poweroff_pdev.sh --hevc</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="sys_pm_atf"></a>
3. Arm Trusted Firmware</h1>
<p >Use the following steps to verify if ATF is properly configured.</p>
<ol type="1">
<li>Check the options from "menuconfig": <dl class="section user"><dt>For Cooper Amba build:</dt><dd><div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">  [*] boot (boot) ---&gt;</div>
<div class="line">    Bootloader ---&gt;</div>
<div class="line">      Ambarella Firmware Configuration ---&gt;</div>
<div class="line">        Memory Options ---&gt;</div>
<div class="line">             (0x01000000) AMBoot bootloader starting address</div>
<div class="line">             (0x04000000) Firmware programmer starting address</div>
<div class="line">        AMBoot Options ---&gt;</div>
<div class="line">          [*] Boot with TrustZone ---&gt;</div>
<div class="line">  -*- board (boards) ---&gt;</div>
<div class="line">    Memory ---&gt;</div>
<div class="line">      (0x01280000) Kernel start address</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>For Cooper Yocto build:</dt><dd><div class="fragment"><div class="line">build $ make menuconfig</div>
<div class="line">  meta-ambabsp ---&gt;</div>
<div class="line">    recipes-bsp ---&gt;</div>
<div class="line">      [*] boot (meta-ambabsp/recipes-bsp/boot) ---&gt;</div>
<div class="line">        Ambarella Firmware Configuration ---&gt;</div>
<div class="line">          Memory Options ---&gt;</div>
<div class="line">               (0x01000000) AMBoot bootloader starting address</div>
<div class="line">               (0x04000000) Firmware programmer starting address</div>
<div class="line">          AMBoot Options ---&gt;</div>
<div class="line">            [*] Boot with TrustZone ---&gt;</div>
<div class="line">      -*- board (meta-ambabsp/recipes-bsp/board) ---&gt;</div>
<div class="line">        Memory ---&gt;</div>
<div class="line">          (0x01280000) Kernel start address</div>
</div><!-- fragment --></dd></dl>
</li>
<li>Check if the ATF partition size is configured properly in <code>bsp.h</code>. <div class="fragment"><div class="line"><span class="preprocessor">#define AMBOOT_BLD_SIZE     (AMBOOT_MIN_PART_SIZE * 8)</span></div>
<div class="line"><span class="preprocessor">#define AMBOOT_PTB_SIZE     (AMBOOT_MIN_PART_SIZE * 7)</span></div>
<div class="line"><span class="preprocessor">#define AMBOOT_ATF_SIZE     (AMBOOT_MIN_PART_SIZE * 8)</span></div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="sys_pm_license"></a>
4. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ("Software") are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
