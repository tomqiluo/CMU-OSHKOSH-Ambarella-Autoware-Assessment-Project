<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>System: DESIGN - Porting Ubuntu System</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="System"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">System<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d0/de4/page_sys_porting_ubuntu_doc.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">DESIGN - Porting Ubuntu System </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="porting_ubuntu_system_history"></a>
0. Revision History</h1>
<a class="anchor" id="porting_ubuntu_system_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Updated Date </th><th>Modification </th></tr>
<tr>
<td>20230227 </td><td>Initial Version </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="porting_ubuntu_system_ov"></a>
1. Overview</h1>
<p >This document introduces transplanting Ubuntu system to Ambarella system on chip (SoC) platform without running the graphic user interface (GUI). At the same time, unit tests, the digital signal process (DSP) driver, and the vector process (VP) driver located in the software develop kit (SDK) are also transplanted into the Ubuntu system to implement encoding in the DSP and running convolutional neural network (CNN) algorithms.<br  />
</p>
<hr  />
<h1><a class="anchor" id="porting_ubuntu_system_bg"></a>
2. Background Introduction</h1>
<p >When users develop software on Ambarella SoC platform, third-party tools and libraries are often required. Users must cross-compile and transplant them on the device each time. If the Ubuntu system can run directly on the device, softwares can be installed via application, thus improving the efficiency of developing software.<br  />
</p>
<hr  />
<h1><a class="anchor" id="porting_ubuntu_system_preparation"></a>
3. Preparation of Ubuntu's Root File System (Rootfs)</h1>
<h2><a class="anchor" id="porting_ubuntu_system_download_core_sys"></a>
3.1 Download and Extract Ubuntu Core System</h2>
<p >The Ubuntu core system can be downloaded from the official Ubuntu website: <a href="http://cdimage.ubuntu.com/ubuntu-base/releases/">http://cdimage.ubuntu.com/ubuntu-base/releases/</a><br  />
</p>
<p >In this document, version 16.04 is used as an example:<br  />
</p>
<div class="image">
<img src="../../porting_ubuntu_version.png" alt=""/>
<div class="caption">
Figure 3-1. Ubuntu Version.</div></div>
<p >Download the <code>ubuntu-base-16.04.6-base-arm64.tar.gz</code> file and extract it to the working directory:<br  />
</p>
<div class="image">
<img src="../../porting_ubuntu_base_code.png" alt=""/>
<div class="caption">
Figure 3-2. Ubuntu Base Code.</div></div>
<p >Extract the download package to working directory:<br  />
</p>
<div class="fragment"><div class="line">Host $ tar -xvf ubuntu-base-16.04.6-base-arm64.tar.gz -C $work_dir (Your working directory)</div>
</div><!-- fragment --><h2><a class="anchor" id="porting_ubuntu_system_download_qemu"></a>
3.2 Download QEMU Simulator and Run Arm Ubuntu Core System</h2>
<p >Install the QEMU simulator on the host PC:</p>
<div class="fragment"><div class="line">Host $ sudo apt-get install qemu-user-<span class="keyword">static</span></div>
</div><!-- fragment --><p >QEMU is a powerful simulator that will be used to run the Ubuntu system that is to be ported to the PC. Copy "qemu-arm-static" to the Ubuntu core directory <code>usr/bin</code>.</p>
<div class="fragment"><div class="line">Host $ sudo cp /usr/bin/qemu-arm-<span class="keyword">static</span> $work_dir/usr/bin</div>
</div><!-- fragment --><p >Copy the host <code>resolv.conf</code> to the Ubuntu core directory <code>etc</code>. This step enables Ubuntu core system domain name service (DNS) to work normally.</p>
<div class="fragment"><div class="line">Host $ sudo cp -<a class="code hl_variableRef" target="_blank" href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a> /etc/resolv.conf $work_dir/etc/resolv.conf</div>
<div class="ttc" id="acJSON_8h_html_a1a175e87536301df98c805ac0636ad7c"><div class="ttname"><a href="../../../library/d1/d82/cJSON_8h.html#a1a175e87536301df98c805ac0636ad7c">b</a></div><div class="ttdeci">const cJSON *const b</div></div>
</div><!-- fragment --><p >Mount <code>proc</code>, <code>sys</code>, and <code>dev/pts</code> file systems, then and use "chroot" to enter into the Ubuntu core system.</p>
<div class="fragment"><div class="line">Host $ sudo ch-mount.sh -m $work_dir</div>
</div><!-- fragment --><p >Contents of <code>ch-mount.sh</code> are listed below:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#!/bin/bash</span></div>
<div class="line"> </div>
<div class="line">function mnt()</div>
<div class="line">{</div>
<div class="line">  echo <span class="stringliteral">&quot;MOUNTING&quot;</span></div>
<div class="line"> </div>
<div class="line">  sudo mount -t proc /proc ${2}proc</div>
<div class="line">  sudo mount -t sysfs /sys ${2}sys</div>
<div class="line">  sudo mount -o bind /dev  ${2}dev</div>
<div class="line">  sudo mount -o bind /dev/pts ${2}/dev/pts</div>
<div class="line">  sudo chroot ${2}</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">function umnt()</div>
<div class="line">{</div>
<div class="line">  echo <span class="stringliteral">&quot;UNMOUNTING&quot;</span></div>
<div class="line"> </div>
<div class="line">  sudo umount ${2}proc</div>
<div class="line">  sudo umount ${2}sys</div>
<div class="line">  sudo umount ${2}dev/pts</div>
<div class="line">  sudo umount ${2}dev</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> [ <span class="stringliteral">&quot;$1&quot;</span> == <span class="stringliteral">&quot;-m&quot;</span> ] &amp;&amp; [ -n <span class="stringliteral">&quot;$2&quot;</span> ]; then</div>
<div class="line">  mnt $1 $2</div>
<div class="line">elif [ <span class="stringliteral">&quot;$1&quot;</span> == <span class="stringliteral">&quot;-u&quot;</span> ] &amp;&amp; [ -n <span class="stringliteral">&quot;$2&quot;</span> ]; then</div>
<div class="line">  umnt $1 $2</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  echo <span class="stringliteral">&quot;&quot;</span></div>
<div class="line">  echo <span class="stringliteral">&quot;Either 1&#39;st, 2&#39;nd or both parameters were missing&quot;</span></div>
<div class="line">  echo <span class="stringliteral">&quot;&quot;</span></div>
<div class="line">  echo <span class="stringliteral">&quot;1&#39;st parameter can be one of these: -m(mount) OR -u(umount)&quot;</span></div>
<div class="line">  echo <span class="stringliteral">&quot;2&#39;nd parameter is the full path of the rootfs directory (with trailing &#39;/&#39;)&quot;</span></div>
<div class="line">  echo <span class="stringliteral">&quot;&quot;</span></div>
<div class="line">  echo <span class="stringliteral">&quot;For example: ch-mount -m /media/sdcard/&quot;</span></div>
<div class="line">  echo <span class="stringliteral">&quot;&quot;</span></div>
<div class="line">  echo 1st parameter : ${1}</div>
<div class="line">  echo 2nd parameter : ${2}</div>
<div class="line">fi</div>
</div><!-- fragment --><p >After mounting the file system, users can execute Ubuntu's operation in the simulator.</p>
<h2><a class="anchor" id="porting_ubuntu_system_configure_ubuntu_core"></a>
3.3 Configure Ubuntu Core System</h2>
<ol type="1">
<li>Set password for root:</li>
</ol>
<div class="fragment"><div class="line">ubuntu # passwd root</div>
</div><!-- fragment --><ol type="1">
<li>Add a new user:</li>
</ol>
<div class="fragment"><div class="line">ubuntu # adduser ambarella</div>
</div><!-- fragment --><ol type="1">
<li>Modify the download repositories of the Ubuntu core system. In China, users can choose University of Science and Technology, Tsinghua University, Alibaba, and Huawei. <br  />
</li>
<li>After the repositories have been configured, users can install the common softwares:<br  />
</li>
</ol>
<div class="fragment"><div class="line">ubuntu # sudo apt-get update --allow-insecure-repositories</div>
<div class="line">ubuntu # sudo apt-get install ssh net-tools ethtool vim kmod ... # any interested software</div>
</div><!-- fragment --><ol type="1">
<li>Serial configuration:</li>
</ol>
<p >As ttyS0 is the console serial port on Ambarella platform, the link <a href="#" onclick="location.href='mai'+'lto:'+'get'+'ty'+'@tt'+'yS'+'0.s'+'er'+'vic'+'e'; return false;">getty<span class="obfuscator">.nosp@m.</span>@tty<span class="obfuscator">.nosp@m.</span>S0.se<span class="obfuscator">.nosp@m.</span>rvic<span class="obfuscator">.nosp@m.</span>e</a> must be added to connect getty.service:<br  />
</p>
<div class="fragment"><div class="line">ubuntu # ln -s /lib/systemd/system/getty@.service /etc/systemd/system/getty.target.wants/getty@ttyS0.service</div>
</div><!-- fragment --><ol type="1">
<li>Network configuration:</li>
</ol>
<p >The gigabit netword card on Ambarella platform is eth0. Users must create the "eth0" file under <code>/etc/network/interfaces.d</code> and configure network-related parameters:<br  />
</p>
<div class="fragment"><div class="line">ubuntu # touch /etc/network/interfaces.d/eth0</div>
<div class="line">ubuntu # vim /etc/network/interfaces.d/eth0</div>
</div><!-- fragment --><p >If a static network is configured, the following parameters must be provided:<br  />
</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> eth0</div>
<div class="line">iface eth0 inet <span class="keyword">static</span></div>
<div class="line">address 192.168.137.2</div>
<div class="line">netmask 255.255.255.0</div>
<div class="line">gateway 192.168.137.1</div>
</div><!-- fragment --><p >If a dynamic network is configured, the following contents must be provided: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> eth0</div>
<div class="line">iface eth0 inet dhcp</div>
</div><!-- fragment --><ol type="1">
<li>As Ubuntu base rootfs doesn't contain kernel modules (.ko), they are required to be copied to Ubuntu core system from standard SDK</li>
<li>Copy the standard SDK's unit test binaries, lua, 3a binary, and DSP / VP firmware binaries to Ubuntu core system.<br  />
</li>
<li>Add Ambarella-related drivers that can be loaded automatically when the system boots up:<br  />
</li>
</ol>
<div class="fragment"><div class="line">ubuntu # touch /etc/modules-load.d/ambarella</div>
<div class="line">ubuntu # vim /etc/modules-load.d/ambarella</div>
</div><!-- fragment --><p >Input the driver list that must be loaded, for example:</p>
<div class="fragment"><div class="line">iav</div>
<div class="line">dsplog</div>
<div class="line">ambad</div>
<div class="line">ambdve</div>
<div class="line">ambhdmi</div>
<div class="line">ambarella_eth</div>
<div class="line">ehci-ambarella</div>
<div class="line">snd-soc-ak4951-amb</div>
<div class="line">snd-soc-ambdummy</div>
<div class="line">snd-soc-simple-card</div>
</div><!-- fragment --><ol type="1">
<li>Exit from the Ubuntu core chroot system:</li>
</ol>
<div class="fragment"><div class="line">ubuntu # exit</div>
</div><!-- fragment --><ol type="1">
<li>Uninstall the rootfs:</li>
</ol>
<div class="fragment"><div class="line">Host $ sudo ch-mount.sh -u $work_dir</div>
</div><!-- fragment --><ol type="1">
<li>Package the rootfs:</li>
</ol>
<div class="fragment"><div class="line">Host $ tar zcvf rootfs.tar $work_dir</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="porting_ubuntu_system_burn_system"></a>
4. Burn Root File System into the Device</h1>
<p >There are two scenarios to burn the rootfs into the evaluation kit (EVK) board:<br  />
</p>
<ul>
<li>The EVK board possesses an embedded multi-media controller / card (eMMC). The rootfs can be downloaded directly to the eMMC.</li>
<li>The EVK board just has a NAND and secure digital (SD) slot</li>
</ul>
<h2><a class="anchor" id="porting_ubuntu_system_burn_system_emmc"></a>
4.1 Burn the Root File System to eMMC</h2>
<ol type="1">
<li>Select the boot media for the eMMC on the EVK. Burn the normal firmware (bst_bld_kernel_lnx_release.elf) to the EVK board.</li>
<li><p class="startli">When the normal firmware has completed burning to the EVK board, boot up the board and format <code>/dev/mmcblk0p8</code>.</p>
<div class="fragment"><div class="line">board # mkfs.ext4 /dev/mmcblk0p8 -N 2000000</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The parameter "-N" indicates the number of inodes. Users must configure this parameter according to the actual situation. If the inode amount is too small, the file cannot be written sequentially, even if there is sufficient disk space.</dd></dl>
</li>
<li><p class="startli">Mount the Ubuntu file system partition.</p>
<div class="fragment"><div class="line">board # mkdir /temp</div>
<div class="line">board # mount -t ext4 /dev/mmcblk0p8 /temp/</div>
</div><!-- fragment --></li>
<li><p class="startli">Extract the Ubuntu file system (.tar.gz) to the partition mounted in step 3: </p><div class="fragment"><div class="line">board # mount -t cifs <span class="comment">//192.168.137.1/pcshare /mnt -o username=xxx,password=xxx,vers=3.0</span></div>
<div class="line">board # tar zxvf /mnt/rootfs.tar.gz -C /temp/</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The "mount" command enables users to access the rootfs.tar.gz package. Users can use other methods, such as "sdcard" or file transfer protocol (FTP).</dd></dl>
</li>
<li>Modify the Ubuntu file system permissions. <div class="fragment"><div class="line">board # chown -R root:root /temp</div>
</div><!-- fragment --></li>
<li>Unmount the Ubuntu file system partition. <div class="fragment"><div class="line">board # umount /temp</div>
</div><!-- fragment --></li>
<li><p class="startli">Reboot the system and enter into AMBoot to modify the booting command (cmdline).</p>
<div class="fragment"><div class="line">amboot&gt; fdt cmdline console=ttyS0 noinitrd root=/dev/mmcblk0p8 rw rootfstype=ext4 rootwait</div>
<div class="line">amboot&gt; boot</div>
</div><!-- fragment --></li>
<li>Reboot the system to enter into the Ubuntu system. Log in with the username and password when the rootfs is created.</li>
</ol>
<h2><a class="anchor" id="porting_ubuntu_system_burn_system_sd"></a>
4.2 Burn Root File System onto SD Card</h2>
<p >As the rootfs must be burned onto SD card, Ambarella SD driver must be compiled into the kernel (CV2 is used as an example):</p>
<ol type="1">
<li>Modify the kernel configuration and generate the firmware (the CV2_Chestnut EVK is used as an example) <dl class="section user"><dt>For CV2x SDK 3.0 Amba Build:</dt><dd><div class="fragment"><div class="line">Build $ make cv2_ipcam_config</div>
<div class="line">Build $ make defconfig_public_linux</div>
<div class="line">Build $ make menuconfig_public_linux</div>
<div class="line">        Device Driver ---&gt;</div>
<div class="line">          &lt;*&gt; MMC/SD/SDIO card support ---&gt;</div>
<div class="line">                &lt;*&gt; MMC block device driver</div>
<div class="line">                &lt;*&gt; Ambarella Media Processor SD/MMC Host Controller driver</div>
<div class="line"> </div>
<div class="line">        File System ---&gt;</div>
<div class="line">          &lt;*&gt; The Extended 4 (ext4) file system</div>
<div class="line">             [*] JBD2 (ext4) debugging support</div>
<div class="line"> </div>
<div class="line">Build $ make menuconfig</div>
<div class="line">        Ambarella File System Configuration ---&gt;</div>
<div class="line">          [*] Open Source Software (OSS) ---&gt;</div>
<div class="line">            [*] Filesystem Tools ---&gt;</div>
<div class="line">               [*] Add e2fsprogs app</div>
<div class="line"> </div>
<div class="line">Build $ make -j32</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>For Cooper Amba and Yocto Build:</dt><dd><div class="fragment"><div class="line">Build $ make ipcam_config</div>
<div class="line">Build $ make linux_menuconfig</div>
<div class="line">        Device Driver ---&gt;</div>
<div class="line">          &lt;*&gt; MMC/SD/SDIO card support ---&gt;</div>
<div class="line">                &lt;*&gt; MMC block device driver</div>
<div class="line">                &lt;*&gt; Ambarella Media Processor SD/MMC Host Controller driver</div>
<div class="line"> </div>
<div class="line">        File System ---&gt;</div>
<div class="line">          &lt;*&gt; The Extended 4 (ext4) file system</div>
<div class="line">             [*] JBD2 (ext4) debugging support</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>For Amba Build:</dt><dd><div class="fragment"><div class="line">Build $ make menuconfig</div>
<div class="line">        Ambarella File System Configuration ---&gt;</div>
<div class="line">          [*] Open Source Software (OSS) ---&gt;</div>
<div class="line">            [*] Filesystem Tools ---&gt;</div>
<div class="line">               [*] Add e2fsprogs app</div>
<div class="line"> </div>
<div class="line">Build $ make -j32</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>For Yocto Build:</dt><dd><div class="fragment"><div class="line">Build $ make menuconfig</div>
<div class="line">Build $ meta ---&gt;</div>
<div class="line">Build $   recipes-devtools ---&gt;</div>
<div class="line">Build $     [*] e2fsprogs (meta/recipes-devtools/e2fsprogs)</div>
<div class="line"> </div>
<div class="line">Build $ make</div>
</div><!-- fragment --></dd></dl>
</li>
<li>Burn the firmware to the board using the AmbaUSB tool.</li>
<li><p class="startli">Insert and format the SD card. </p><div class="fragment"><div class="line">board # mkfs.ext4 /dev/mmcblk1p1 -N 2000000</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The parameter "-N" indicates the number of inodes. Users must configure this parameter according to the actual situation. If the inode amount is too small, the file cannot be written sequentially, even if there is sufficient disk space.</dd></dl>
</li>
<li>Mount the SD card partition. <div class="fragment"><div class="line">board # mkdir /temp</div>
<div class="line">board # mount -t ext4 /dev/mmcblk1p1 /temp/</div>
</div><!-- fragment --></li>
<li><p class="startli">Extract the Ubuntu file system (.tar.gz) to the partition mounted in step 3: </p><div class="fragment"><div class="line">board # mount -t cifs <span class="comment">//192.168.137.1/pcshare /mnt -o username=xxx,password=xxx,vers=3.0</span></div>
<div class="line">board # tar zxvf /mnt/rootfs.tar.gz -C /temp/</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The "mount" command enables users to access the <code>rootfs.tar.gz</code> package. Users can use other methods, such as "sdcard" or FTP.</dd></dl>
</li>
<li><p class="startli">Modify the Ubuntu file system permission.</p>
<div class="fragment"><div class="line">board # chown -R root:root /temp</div>
</div><!-- fragment --></li>
<li>Unmount the Ubuntu file system partition. <div class="fragment"><div class="line">board # umount /temp</div>
</div><!-- fragment --></li>
<li><p class="startli">Reboot the system and enter into AMBoot to modify the booting command (cmdline).</p>
<div class="fragment"><div class="line">amboot&gt; fdt cmdline console=ttyS0 noinitrd root=/dev/mmcblk1p1 rw rootfstype=ext4 rootwait</div>
<div class="line">amboot&gt; boot</div>
</div><!-- fragment --></li>
<li><p class="startli">Reboot the system to enter into the Ubuntu system. Log in with the username and password when the rootfs is created.</p>
<p class="startli">Figure 4-1 is captured from the board's serial when the CV2 EVK board enters into the Ubuntu shell:</p>
</li>
</ol>
<div class="image">
<img src="../../porting_ubuntu_login.png" alt=""/>
<div class="caption">
Figure 4-1. Ubuntu login.</div></div>
<hr  />
<h1><a class="anchor" id="porting_ubuntu_system_faq"></a>
5. Frequently Asked Questions (FAQ)</h1>
<p >This section focuses on some issues during the migration process, and the corresponding solutions.<br  />
</p>
<p ><b>Question 1:</b> How can the "kmod" error be fixed when the system boots up?<br  />
 <b>Answer:</b> Connect to the network and install the "kmod" software using "sudo apt-get install kmod".</p>
<p ><b>Question 2:</b> How is "sudo" added by a common user?<br  />
 <b>Answer:</b></p>
<ol type="1">
<li>Log in with the root account.</li>
<li>Add writing permission to <code>/etc/sudoers</code>. <div class="fragment"><div class="line">board # chmod u+w /etc/sudoers</div>
</div><!-- fragment --></li>
<li>For example, add sudo permission to "ambarella": <div class="fragment"><div class="line"><span class="preprocessor"># User privilege specification</span></div>
<div class="line">root ALL=(ALL) ALL</div>
<div class="line">ambarella ALL=(ALL) ALL</div>
</div><!-- fragment --></li>
<li>Remove the writing permission from <code>/etc/sudoers</code>. <div class="fragment"><div class="line">board # chmod u-w /etc/sudoers</div>
</div><!-- fragment --></li>
<li>Grant "setuid" privileges to the sudo program. <div class="fragment"><div class="line">board # chmod 4755 /usr/bin/sudo</div>
</div><!-- fragment --></li>
</ol>
<p ><b>Question 3:</b> What is the solution for when the command user cannot restart the system?<br  />
 <b>Answer:</b> Install dbus-user-session software using "sudo apt-get install dbus-user-session", then execute "sudo reboot".</p>
<p ><b>Question 4:</b> What are the steps to update the Ubuntu 16.04 libc version from 2.23 to 2.29?<br  />
 <b>Answer:</b></p>
<ol type="1">
<li>Use the following commands to compile and install glic 2.29: <div class="fragment"><div class="line">board # wget http:<span class="comment">//ftp.gnu.org/pub/gnu/glibc/glibc-2.29.tar.gz</span></div>
<div class="line">board # tar -zxvf glibc-2.29.tar.gz</div>
<div class="line">board # cd glibc-2.29</div>
<div class="line">board # mkdir build &amp;&amp; cd build</div>
<div class="line">board # apt-get install make gcc gawk bison -you</div>
<div class="line">board # ../configure --prefix=/usr/</div>
<div class="line">board # make -j8</div>
<div class="line">board # make install DESTDIR={xxx}</div>
</div><!-- fragment --></li>
<li>Replace all <code>.so</code> files located in <code>/lib/aarch64-linux-gnu/</code> with the same file of xxx/lib64.<br  />
</li>
<li>Replace the soft link file /lib/ld-linux-aarch64.so.1 &mdash;&gt; aarch64-linux-gnu/ld-2.23.so with /lib/ld-linux-aarch64.so.1 &mdash;&gt; aarch64-linux-gnu/ld-2.29.so.</li>
</ol>
<p ><b>Question 5:</b> Where can the corresponding .so file for a new library be found?<br  />
 <b>Answer:</b> Execute the "ldconfig" command to find the <code>.so</code> file.</p>
<p ><b>Question 6:</b> The system cannot be entered when libc is updated. How do users solve this issue?<br  />
 <b>Answer:</b></p>
<ol type="1">
<li>Reboot the system and enter into the AMBoot shell to modify the command line: <div class="fragment"><div class="line">amboot&gt; fdt cmdline console=ttyS0 noinitrd root=/dev/mmcblk0p7 rw rootfstype=ext4</div>
<div class="line">amboot&gt; boot</div>
</div><!-- fragment --></li>
<li>Use "mount -t ext4 /dev/mmcblk0p8 /temp" to mount Ubuntu file system.</li>
<li>Enter into the Ubuntu system and modify the libc soft link: <div class="fragment"><div class="line">board # cd /temp/lib/</div>
<div class="line">board # rm -rf ld-linux-aarch64.so.1</div>
<div class="line">board # ln -s aarch64-linux-gnu/ld-2.29.so ld-linux-aarch64.so.1</div>
<div class="line">board # cd aarch64-linux-gnu</div>
<div class="line">board # rm -rf ld-linux-aarch64.so.1</div>
<div class="line">board # ln -s ld-2.29.so ld-linux-aarch64.so.1</div>
</div><!-- fragment --></li>
<li>Uninstall the Ubuntu file system: <div class="fragment"><div class="line">board # cd /</div>
<div class="line">board # umount /temp</div>
</div><!-- fragment --></li>
<li>Reboot the system and enter into the AMBoot shell to modify the command line: <div class="fragment"><div class="line">amboot&gt; fdt cmdline console=ttyS0 noinitrd root=/dev/mmcblk0p8 rw rootfstype=ext4</div>
<div class="line">amboot&gt; boot</div>
</div><!-- fragment --></li>
<li>To prevent subsequent updates to glibc, use the following commands to disable glibc updates: <div class="fragment"><div class="line">board # echo libc hold | dpkg --set-selections</div>
<div class="line">board # echo libc-bin hold | dpkg --set-selections</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="porting_ubuntu_system_license"></a>
6. License</h1>
<p >Copyright (c) 2024 Ambarella International LP.</p>
<p >This file and its contents ( "Software" ) are protected by intellectual property rights including, without limitation, U.S. and/or foreign copyrights. This Software is also the confidential and proprietary information of Ambarella International LP and its licensors. You may not use, reproduce, disclose, distribute, modify, or otherwise prepare derivative works of this Software or any portion thereof except pursuant to a signed license agreement or nondisclosure agreement with Ambarella International LP or its authorized affiliates. In the absence of such an agreement, you agree to promptly notify and return this Software to Ambarella International LP.</p>
<p >THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
