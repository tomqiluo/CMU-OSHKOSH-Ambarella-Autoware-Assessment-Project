<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Security: Migration Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Security"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign">
   <div id="projectname">Security<span id="projectnumber">&#160;Cooper_1.6.0 (CV72 &amp; CV3) @ 2024.07.10 14:12:44</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d2/dad/migration_guide.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Migration Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="migration_guide_history"></a>
0. Revision History</h1>
<a class="anchor" id="otp_rev_history"></a>
<table class="doxtable">
<caption></caption>
<tr>
<th>Version</th><th>Updated Date</th><th align="left">Modification </th></tr>
<tr>
<td>0.0.1</td><td>20221118</td><td>Initial Version </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="migration_guide_introduction"></a>
1. Introduction</h1>
<p >The points below aid customers through the migration process from CV2x to CV5x / CV7x / CV3.</p>
<hr  />
<h1><a class="anchor" id="key_alg"></a>
2. Key Algorithm</h1>
<p >In CV2x, Ambaella uses 'RSA2048 + SHA256' for secure boot. For secure enhancement, Ambaella uses 'ED25519 + SHA512' for secure boot in CV5x / CV7x / CV3. Due to the cryptography algorithm upgrade, there're some corresponding changes, such as key size and key slot number, key tools, and remote procedure call (RPC) toolkit version.</p>
<hr  />
<h1><a class="anchor" id="pub_key"></a>
3. Public Key Slot in OTP</h1>
<p >In CV2x, one-time programmable (OTP) can store three key pairs. In CV5x / CV7x / CV3, OTP can store sixteen key pairs;thus this is a capability enhancement.</p>
<hr  />
<h1><a class="anchor" id="poc6"></a>
4. POC[6] Behavior</h1>
<p >Due to changes in the key selection approach, Ambarella has introduced a new bootstrapper (BST): "BST with a binary header, which includes key index", and "BST without binary header". To maintain compatibility with the original BST header, the current design is as follows: when secure boot is enabled, ROM code will treat that the BST has a header; when secure boot is disabled, ROM code will treat the BST has no header. If customers choose secure boot firmware (FW), POC[6] must be always <b>ON</b>. <b>POC[6] is unable to 'toggle secure boot on/off' unlike CV2x. Because secure USB boot mode is available when secure boot is enabled, users can use USB boot to flash new FW. Secure boot is not required to be turned off (POC[6] does not need to be pulled off)</b>.</p>
<hr  />
<h1><a class="anchor" id="sec_usb_boot"></a>
5. Secure USB Boot</h1>
<p >When secure boot is enabled on CV5x / CV7x / CV3, <b>USB boot mode is still available</b> (UST also has a signature). If costumers want to disable secure USB boot, test_pogram_otp (firmware with TrustZone) or test_otp (firmware without TrustZone) can be used: </p><div class="fragment"><div class="line"><span class="preprocessor">#test_program_otp --dissecureusbboot</span></div>
</div><!-- fragment --><p> or, </p><div class="fragment"><div class="line"><span class="preprocessor">#test_otp -dissecureusbboot</span></div>
</div><!-- fragment --><p >Since secure USB boot also has signature protection, it's <b>NOT</b> recommended to disable this feature, secure USB boot can be used as a recovery mode in RMA process.</p>
<hr  />
<h1><a class="anchor" id="key_program"></a>
6. Key Program</h1>
<p >In CV5x / CV7x / CV3, secure boot will only take effect after "all key locked". <b>Customers must write all public keys into OTP and lock them once</b>.</p>
<p >If customers use the RPC approach, the remote server changed from tz_dev_server to tz_dev_server_v2, and the usage is the same (tz_dev_server_v2 &lt;db&gt; &lt;portnum_string&gt; [&ndash;autoapprove] [&ndash;maxaccount d]).</p>
<p >Below are the steps to program keys in CV5x / CV7x / CV3 (step 2 and 3 are additional steps with the RPC server):</p><ol type="1">
<li>Generate sixteen key pairs (use key_tool_ed25519 in <code>ambarella/packages/security/key_tools/prebuild/key_tool_ed25519</code>)</li>
<li>Name key0 (the first key used for the firmware) as pri_rot.bin and copy it to the RPC server's folder</li>
<li>Set up server and daemon (refer to <code>ambarella/packages/security/build/trustzone_secure_boot_toolkit_help.txt</code>)</li>
<li>Compile the firmware</li>
<li>Program sixteen keys into OTP and lock them</li>
<li>Program the firmware</li>
</ol>
<p >If root of trust (RoT) key revocation is required, the key index in FW and RoT key at the server side must always match. For example, the process is as shown: replace nth pri_rot.bin at the server side, restart the server, change BST's key index to nth and recompile the SDK. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
