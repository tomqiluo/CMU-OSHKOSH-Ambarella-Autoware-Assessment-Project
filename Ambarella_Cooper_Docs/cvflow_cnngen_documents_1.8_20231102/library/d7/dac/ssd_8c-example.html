<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Library: ssd.c</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Library"/>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="../../../library/mathjax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-ambarella.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Ambarella.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Library
   </div>
   <div id="projectbrief">CVflow_1.8 @ 2023.11.02</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,true,'search.html','Search');
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d7/dac/ssd_8c-example.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">ssd.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>This is a source code file of test_ssd_lpr.</p>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment"> * ssd.c</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * History:</span></div>
<div class="line"><span class="comment"> *  2022/05/10  - [Yang Cao] created</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2022 Ambarella International LP</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file and its contents ( &quot;Software&quot; ) are protected by intellectual</span></div>
<div class="line"><span class="comment"> * property rights including, without limitation, U.S. and/or foreign</span></div>
<div class="line"><span class="comment"> * copyrights. This Software is also the confidential and proprietary</span></div>
<div class="line"><span class="comment"> * information of Ambarella International LP and its licensors. You may not use, reproduce,</span></div>
<div class="line"><span class="comment"> * disclose, distribute, modify, or otherwise prepare derivative works of this</span></div>
<div class="line"><span class="comment"> * Software or any portion thereof except pursuant to a signed license agreement</span></div>
<div class="line"><span class="comment"> * or nondisclosure agreement with Ambarella International LP or its authorized affiliates.</span></div>
<div class="line"><span class="comment"> * In the absence of such an agreement, you agree to promptly notify and return</span></div>
<div class="line"><span class="comment"> * this Software to Ambarella International LP.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file includes sample code and is only for internal testing and evaluation.  If you</span></div>
<div class="line"><span class="comment"> * distribute this sample code (whether in source, object, or binary code form), it will be</span></div>
<div class="line"><span class="comment"> * without any warranty or indemnity protection from Ambarella International LP or its affiliates.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment"> * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF NON-INFRINGEMENT,</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL AMBARELLA INTERNATIONAL LP OR ITS AFFILIATES BE LIABLE FOR ANY DIRECT,</span></div>
<div class="line"><span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; COMPUTER FAILURE OR MALFUNCTION; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dd/dbe/eazyai_8h.html">eazyai.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;lua.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;lauxlib.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;lualib.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;nn_lua.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d2/d9b/nn__arm_8h.html">nn_arm.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;nn_arm_show_result.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ssd.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef max</span></div>
<div class="line"><span class="preprocessor">#define max(a,b) (((a) &gt; (b)) ? (a) : (b))</span></div>
<div class="line"><span class="preprocessor">#define min(a,b) (((a) &lt; (b)) ? (a) : (b))</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef EPSILON</span></div>
<div class="line"><span class="preprocessor">#define EPSILON (1e-6)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define true 1</span></div>
<div class="line"><span class="preprocessor">#define false 0</span></div>
<div class="line"> </div>
<div class="line"><a name="a0"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gabf4ab7c2d5fe62deac5689fad8a8296e">EA_LOG_DECLARE_LOCAL</a>(<a name="a1"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gga35915c50caa86eeec9606ef087bec6b5a11be6a6ac457a87220a879b8c4050ce6">EA_LOG_LEVEL_NOTICE</a>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><span class="preprocessor">#include &lt;omp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a name="_a2"></a><a class="code" href="../../d3/d26/structssd__tf__scale__factors__s.html">ssd_tf_scale_factors_s</a> {</div>
<div class="line">    uint32_t <a name="a3"></a><a class="code" href="../../d3/d26/structssd__tf__scale__factors__s.html#a6f38e75428607403ff781a3b0ab7b79a">center_x_scale</a>;</div>
<div class="line">    uint32_t <a name="a4"></a><a class="code" href="../../d3/d26/structssd__tf__scale__factors__s.html#a2b0fee07efca8196bdc9a3d5974e1a36">center_y_scale</a>;</div>
<div class="line">    uint32_t <a name="a5"></a><a class="code" href="../../d3/d26/structssd__tf__scale__factors__s.html#abaa83183be5d964b94ae65903048ec97">width_scale</a>;</div>
<div class="line">    uint32_t <a name="a6"></a><a class="code" href="../../d3/d26/structssd__tf__scale__factors__s.html#a5e9088eef5706c80641ab9f287bca685">height_scale</a>;</div>
<div class="line">} ssd_tf_scale_factors_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../df/d12/group__dproc-helper.html#ga0ad291b6f8763fa2b107f02e81dab6e6">amba_bbox_codetype_s</a> {</div>
<div class="line">    <a name="a7"></a><a class="code" href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6a2dce73dabed8848d2ab145b67747015c">AMBA_BBOX_CORNER</a>       = 0,</div>
<div class="line">    <a name="a8"></a><a class="code" href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6afb2c9a09afbaffb773345b552314d1b5">AMBA_BBOX_CENTER_SIZE</a>  = 1,</div>
<div class="line">    <a name="a9"></a><a class="code" href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6a2ff70b0e812a044acb8d69e45c1e6e38">AMBA_BBOX_CORNER_SIZE</a>  = 2,</div>
<div class="line">    <a name="a10"></a><a class="code" href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6a9a37325e2219ce6f0ca200bc71476eb6">AMBA_BBOX_NUM_CODETYPE</a>,</div>
<div class="line">} amba_bbox_codetype_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a name="_a11"></a><a class="code" href="../../d7/d68/structdproc__run__ssd__detection__output__param__s.html">dproc_run_ssd_detection_output_param_s</a> {</div>
<div class="line">    uint8_t *<a name="a12"></a><a class="code" href="../../d7/d68/structdproc__run__ssd__detection__output__param__s.html#aff0a18ed4f71bb29d9daad09b029c678">mbox_loc</a>;</div>
<div class="line">    uint8_t *<a name="a13"></a><a class="code" href="../../d7/d68/structdproc__run__ssd__detection__output__param__s.html#a95995e153df0e373990dc83bc7cc1f29">mbox_conf_flatten</a>;</div>
<div class="line">    <span class="keywordtype">float</span> *<a name="a14"></a><a class="code" href="../../d7/d68/structdproc__run__ssd__detection__output__param__s.html#a48daf9706e0791f8ce1c383e821dd50c">mbox_priorbox</a>;</div>
<div class="line">} dproc_run_ssd_detection_output_param_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a name="_a15"></a><a class="code" href="../../d7/d1a/structdproc__bbox__param__s.html">dproc_bbox_param_s</a> {</div>
<div class="line">    <span class="keywordtype">float</span> <a name="a16"></a><a class="code" href="../../d7/d1a/structdproc__bbox__param__s.html#ab56799f110a6fbd87dc59c9c171516dc">x_min</a>;</div>
<div class="line">    <span class="keywordtype">float</span> <a name="a17"></a><a class="code" href="../../d7/d1a/structdproc__bbox__param__s.html#a82405015dd45042774ac84009224bfe0">y_min</a>;</div>
<div class="line">    <span class="keywordtype">float</span> <a name="a18"></a><a class="code" href="../../d7/d1a/structdproc__bbox__param__s.html#a73fc13d83638687d92d5ccf9e4fe1722">x_max</a>;</div>
<div class="line">    <span class="keywordtype">float</span> <a name="a19"></a><a class="code" href="../../d7/d1a/structdproc__bbox__param__s.html#af518e87d5d4659e5d34c34c39253be31">y_max</a>;</div>
<div class="line">} dproc_bbox_param_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a name="_a20"></a><a class="code" href="../../d7/d9d/structdproc__ssd__detection__output__result__s.html">dproc_ssd_detection_output_result_s</a> {</div>
<div class="line">    <span class="keywordtype">int</span> <a name="a21"></a><a class="code" href="../../d7/d9d/structdproc__ssd__detection__output__result__s.html#a512bd2c8e2a962b00a6a6926befc170c">label</a>;</div>
<div class="line">    <span class="keywordtype">float</span> <a name="a22"></a><a class="code" href="../../d7/d9d/structdproc__ssd__detection__output__result__s.html#a8c5cd9b525ee73a24b1d9d8e34982d1c">score</a>;</div>
<div class="line">    dproc_bbox_param_t <a name="a23"></a><a class="code" href="../../d7/d9d/structdproc__ssd__detection__output__result__s.html#a673f254bc4e552fac228fdb58a610790">bbox</a>;</div>
<div class="line">} dproc_ssd_detection_output_result_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>ssd_net_final_result_s {</div>
<div class="line">    dproc_ssd_detection_output_result_t *dproc_ssd_result;</div>
<div class="line">    <span class="keywordtype">int</span> ssd_det_num;</div>
<div class="line">    <span class="keywordtype">int</span> labels[MAX_OUT_NUM][<a name="a24"></a><a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga58ce36916c399104e18d32ff090f21c6">MAX_STR_LEN</a>];</div>
<div class="line">} ssd_net_final_result_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a name="_a25"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html">dproc_ssd_detection_output_config_s</a> {</div>
<div class="line">    uint16_t <a name="a26"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a3a19e5b23a3eafbeaf7ab1b2c551bea5">img_width</a>;</div>
<div class="line">    uint16_t <a name="a27"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#aeb2b08013189ff5789523d71697f3858">img_height</a>;</div>
<div class="line">    uint32_t <a name="a28"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#aac475ad5fd925c09c1e056a5865bd8c0">num_classes</a>;</div>
<div class="line">    uint32_t <a name="a29"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a95615d0ddae699fe03964a1aa0b8c48a">background_label_id</a>;</div>
<div class="line">    uint32_t <a name="a30"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a174b476a80c5d50dccfde494e13c3fd7">mbox_loc_num_elements</a>;</div>
<div class="line">    uint32_t <a name="a31"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#ad81629e7085e6564183c6674760a1cc8">num_all_bboxes</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> <a name="a32"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#abbbcf57bd73507ab655d67c610177b7e">conf_threshold</a>;</div>
<div class="line">    uint32_t <a name="a33"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#aa69d925cba68194f263b484dfc8083bc">keep_top_k</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* nms related */</span></div>
<div class="line">    <span class="keywordtype">float</span> <a name="a34"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a363bfab5175aae09f069a69ff5072f2c">nms_threshold</a>;</div>
<div class="line">    uint32_t <a name="a35"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#ad530dba76e77adf996cd3197db03abf5">nms_top_k</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* bounding box related */</span></div>
<div class="line">    amba_bbox_codetype_t <a name="a36"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a2737d0c70fcd770d703ee569b4c82f5c">code_type</a>;</div>
<div class="line">    uint32_t <a name="a37"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a9f5b1eb8e7845488dc2ef6ed740dec66">share_location</a>;</div>
<div class="line">    uint32_t <a name="a38"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a30dcfd0359b90638c034e859e2385ed9">unnormalized</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* TF Related */</span></div>
<div class="line">    ssd_tf_scale_factors_t <a name="a39"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#acaac87a3c92f0714f9c73e9ca608905f">scale_factors</a>;</div>
<div class="line">    <span class="keywordtype">int</span> <a name="a40"></a><a class="code" href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a6cb28b18024c89478e7b82b6b3b53f37">thread_num</a>;</div>
<div class="line">} dproc_ssd_detection_output_config_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a name="_a41"></a><a class="code" href="../../df/dd4/structdproc__ssd__class__dbg__info__s.html">dproc_ssd_class_dbg_info_s</a> {</div>
<div class="line">    <span class="keywordtype">int</span> <a name="a42"></a><a class="code" href="../../df/dd4/structdproc__ssd__class__dbg__info__s.html#a944f4be93ff75e29edae479fcb08564d">num_bboxes_above_threshold</a>;</div>
<div class="line">    <span class="keywordtype">int</span> <a name="a43"></a><a class="code" href="../../df/dd4/structdproc__ssd__class__dbg__info__s.html#ac34013cb735a8d3752ec3ac937c2b6fe">num_bboxes_post_nms</a>;</div>
<div class="line">} dproc_ssd_class_dbg_info_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>dproc_ssd_detection_output_s {</div>
<div class="line">    dproc_ssd_detection_output_config_t config;</div>
<div class="line">    uint32_t max_objects;</div>
<div class="line">    dproc_bbox_param_t *bboxes;</div>
<div class="line">    dproc_ssd_detection_output_result_t *ssd_class;</div>
<div class="line">    uint8_t *bboxes_kept_idx_array;</div>
<div class="line">    dproc_ssd_detection_output_result_t *ssd_result;</div>
<div class="line">} dproc_ssd_detection_output_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>nnl_ssd_arm_cfg_s {</div>
<div class="line">    <span class="keywordtype">char</span> priorbox_path[<a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga58ce36916c399104e18d32ff090f21c6">MAX_STR_LEN</a> + 1];</div>
<div class="line">    ssd_tf_scale_factors_t *scale_factors;</div>
<div class="line">    <span class="keywordtype">float</span> *priorbox_buf;</div>
<div class="line"> </div>
<div class="line">    uint32_t all_bbox_num;</div>
<div class="line">    uint32_t class_num;</div>
<div class="line">    uint32_t background_label_id;</div>
<div class="line">    uint32_t nms_top_k;</div>
<div class="line">    <span class="keywordtype">float</span> nms_threshold;</div>
<div class="line">    uint32_t keep_top_k;</div>
<div class="line">    <span class="keywordtype">float</span> conf_threshold;</div>
<div class="line">    uint32_t unnormalized;</div>
<div class="line">    uint32_t thread_num;</div>
<div class="line">    <span class="keywordtype">char</span> output_loc_name[<a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga58ce36916c399104e18d32ff090f21c6">MAX_STR_LEN</a>];</div>
<div class="line">    <span class="keywordtype">char</span> output_conf_name[<a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga58ce36916c399104e18d32ff090f21c6">MAX_STR_LEN</a>];</div>
<div class="line">    dproc_ssd_detection_output_t ssd_output;</div>
<div class="line">    ssd_net_final_result_t ssd_result;</div>
<div class="line">    dproc_ssd_class_dbg_info_t *dproc_ssd_class_dbg_info;</div>
<div class="line">    <span class="keywordtype">int</span> debug_en;</div>
<div class="line">} nnl_ssd_arm_cfg_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">float</span> get_bbox_size(dproc_bbox_param_t *bbox)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">float</span> size = 0;</div>
<div class="line">    <span class="keywordtype">float</span> bbox_w = bbox-&gt;x_max - bbox-&gt;x_min;</div>
<div class="line">    <span class="keywordtype">float</span> bbox_h = bbox-&gt;y_max - bbox-&gt;y_min;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (bbox_w &gt; 0 &amp;&amp; bbox_h &gt; 0) {</div>
<div class="line">        size = bbox_w * bbox_h;</div>
<div class="line"> </div>
<div class="line">        <a name="a44"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;get_bbox_size: bbox min = (%f, %f), max = (%f, %f), size = %f\n&quot;</span>,</div>
<div class="line">            bbox-&gt;x_min, bbox-&gt;y_min, bbox-&gt;x_max, bbox-&gt;y_max, size);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> size;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> get_intersect_bbox(dproc_bbox_param_t *bbox1, dproc_bbox_param_t *bbox2, dproc_bbox_param_t *int_bbox)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (bbox2-&gt;x_min &gt; bbox1-&gt;x_max || bbox2-&gt;x_max &lt; bbox1-&gt;x_min ||</div>
<div class="line">        bbox2-&gt;y_min &gt; bbox1-&gt;y_max || bbox2-&gt;y_max &lt; bbox1-&gt;y_min) {</div>
<div class="line">        <span class="comment">/* no intersection*/</span></div>
<div class="line">        int_bbox-&gt;x_min = 0;</div>
<div class="line">        int_bbox-&gt;y_min = 0;</div>
<div class="line">        int_bbox-&gt;x_max = 0;</div>
<div class="line">        int_bbox-&gt;y_max = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">/* calculate intersection box */</span></div>
<div class="line">        int_bbox-&gt;x_min = max(bbox1-&gt;x_min, bbox2-&gt;x_min);</div>
<div class="line">        int_bbox-&gt;y_min = max(bbox1-&gt;y_min, bbox2-&gt;y_min);</div>
<div class="line">        int_bbox-&gt;x_max = min(bbox1-&gt;x_max, bbox2-&gt;x_max);</div>
<div class="line">        int_bbox-&gt;y_max = min(bbox1-&gt;y_max, bbox2-&gt;y_max);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;get_intersect_bbox: bbox1 min = (%f, %f), max = (%f, %f)\n&quot;</span>,</div>
<div class="line">        bbox1-&gt;x_min, bbox1-&gt;y_min, bbox1-&gt;x_max, bbox1-&gt;y_max);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;get_intersect_bbox: bbox2 min = (%f, %f), max = (%f, %f)\n&quot;</span>,</div>
<div class="line">        bbox2-&gt;x_min, bbox2-&gt;y_min, bbox2-&gt;x_max, bbox2-&gt;y_max);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;get_intersect_bbox: int_bbox min = (%f, %f), max = (%f, %f)\n&quot;</span>,</div>
<div class="line">        int_bbox-&gt;x_min, int_bbox-&gt;y_min, int_bbox-&gt;x_max, int_bbox-&gt;y_max);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> scale_bbox(dproc_bbox_param_t *bbox, <span class="keywordtype">int</span> scale_w, <span class="keywordtype">int</span> scale_h)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//clip_bbox(bbox);</span></div>
<div class="line"> </div>
<div class="line">    bbox-&gt;x_min = round(bbox-&gt;x_min * scale_w);</div>
<div class="line">    bbox-&gt;y_min = round(bbox-&gt;y_min * scale_h);</div>
<div class="line">    bbox-&gt;x_max = round(bbox-&gt;x_max * scale_w);</div>
<div class="line">    bbox-&gt;y_max = round(bbox-&gt;y_max * scale_h);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">float</span> jaccard_overlap(dproc_bbox_param_t *bbox1, dproc_bbox_param_t *bbox2)</div>
<div class="line">{</div>
<div class="line">    dproc_bbox_param_t int_bbox;</div>
<div class="line">    <span class="keywordtype">float</span> int_bbox_size;</div>
<div class="line">    <span class="keywordtype">float</span> bbox1_size = 0, bbox2_size = 0;</div>
<div class="line">    <span class="keywordtype">float</span> overlap = 0;</div>
<div class="line"> </div>
<div class="line">    get_intersect_bbox(bbox1, bbox2, &amp;int_bbox);</div>
<div class="line"> </div>
<div class="line">    int_bbox_size = get_bbox_size(&amp;int_bbox);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (int_bbox_size &gt; 0) {</div>
<div class="line">        bbox1_size = get_bbox_size(bbox1);</div>
<div class="line">        bbox2_size = get_bbox_size(bbox2);</div>
<div class="line">        overlap = int_bbox_size / (bbox1_size + bbox2_size - int_bbox_size);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;jaccard_overlap: bbox1_size = %f, bbox2_size = %f, int_bbox_size = %f, overlap = %f\n&quot;</span>,</div>
<div class="line">        bbox1_size, bbox2_size, int_bbox_size, overlap);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> overlap;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> swap_bbox(dproc_bbox_param_t *bbox)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">float</span> tmp;</div>
<div class="line"> </div>
<div class="line">    tmp = bbox-&gt;x_min;</div>
<div class="line">    bbox-&gt;x_min = bbox-&gt;y_min;</div>
<div class="line">    bbox-&gt;y_min = tmp;</div>
<div class="line"> </div>
<div class="line">    tmp = bbox-&gt;x_max;</div>
<div class="line">    bbox-&gt;x_max = bbox-&gt;y_max;</div>
<div class="line">    bbox-&gt;y_max = tmp;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/**********************************************</span></div>
<div class="line"><span class="comment">Function: sort_ssd_result_by_score</span></div>
<div class="line"><span class="comment">Description: sort ssd result array (bubble sort) in place in descending order</span></div>
<div class="line"><span class="comment">Input:</span></div>
<div class="line"><span class="comment">array, size</span></div>
<div class="line"><span class="comment">Output:</span></div>
<div class="line"><span class="comment">sorted array</span></div>
<div class="line"><span class="comment">**********************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sort_ssd_result_by_score(dproc_ssd_detection_output_result_t* array, <span class="keywordtype">int</span> size)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> step, i;</div>
<div class="line">    dproc_ssd_detection_output_result_t tmp;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* begin sort */</span></div>
<div class="line">    <span class="keywordflow">for</span> (step = 0; step &lt; (size - 1); step++) {</div>
<div class="line">        <span class="keywordflow">for</span>(i = 0; i &lt; (size - step - 1); i++) {</div>
<div class="line">            <span class="keywordflow">if</span>(array[i].score &lt; array[i+1].score) {  <span class="comment">/* To sort in ascending order, change &lt; to &gt; */</span></div>
<div class="line">                tmp = array[i];</div>
<div class="line">                array[i] = array[i+1];</div>
<div class="line">                array[i+1] = tmp;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/**********************************************</span></div>
<div class="line"><span class="comment">Function: ssd_bboxes_decode</span></div>
<div class="line"><span class="comment">Description: decode bounding box</span></div>
<div class="line"><span class="comment">Input:</span></div>
<div class="line"><span class="comment">mbox_priorbox</span></div>
<div class="line"><span class="comment">mbox_loc</span></div>
<div class="line"><span class="comment">num_all_boxes</span></div>
<div class="line"><span class="comment">Output:</span></div>
<div class="line"><span class="comment">bboxes</span></div>
<div class="line"><span class="comment">**********************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ssd_bboxes_decode(<span class="keywordtype">float</span> *mbox_priorbox, <span class="keywordtype">float</span> *mbox_loc, <span class="keywordtype">int</span> num_all_boxes,</div>
<div class="line">    dproc_bbox_param_t *bboxes, ssd_tf_scale_factors_t *tf_scale_factors, <span class="keywordtype">int</span> thread_num)</div>
<div class="line">{</div>
<div class="line">    dproc_bbox_param_t* mbox = (dproc_bbox_param_t*)mbox_loc;</div>
<div class="line">    dproc_bbox_param_t* priorbox = (dproc_bbox_param_t*)mbox_priorbox;</div>
<div class="line">    dproc_bbox_param_t* priorbox_var = (dproc_bbox_param_t*)(&amp;priorbox[num_all_boxes]);</div>
<div class="line">    <span class="keywordtype">float</span> prior_center_x, prior_center_y, prior_w, prior_h;</div>
<div class="line">    <span class="keywordtype">float</span> center_x, center_y, w, h;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;ssd_bboxes_decode enter\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line">    omp_set_num_threads(thread_num);</div>
<div class="line"><span class="preprocessor">    #pragma omp parallel for private(prior_center_x, prior_center_y, prior_w, prior_h, center_x, center_y, w, h)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_all_boxes; i++) {</div>
<div class="line">        prior_center_x = (priorbox[i].x_min + priorbox[i].x_max) / 2;</div>
<div class="line">        prior_center_y = (priorbox[i].y_min + priorbox[i].y_max) / 2;</div>
<div class="line">        prior_w = (priorbox[i].x_max - priorbox[i].x_min);</div>
<div class="line">        prior_h = (priorbox[i].y_max - priorbox[i].y_min);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((tf_scale_factors-&gt;center_x_scale == 0) || (tf_scale_factors-&gt;center_y_scale == 0)</div>
<div class="line">                || (tf_scale_factors-&gt;width_scale == 0) || (tf_scale_factors-&gt;height_scale == 0)) {</div>
<div class="line">            <span class="comment">/* Caffe Model */</span></div>
<div class="line">            center_x = mbox[i].x_min * priorbox_var[i].x_min * prior_w + prior_center_x;</div>
<div class="line">            center_y = mbox[i].y_min * priorbox_var[i].y_min * prior_h + prior_center_y;</div>
<div class="line">            w = prior_w * exp(mbox[i].x_max * priorbox_var[i].x_max);</div>
<div class="line">            h = prior_h * exp(mbox[i].y_max * priorbox_var[i].y_max);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">/* TF model */</span></div>
<div class="line">            center_x = mbox[i].x_min * prior_w / tf_scale_factors-&gt;center_x_scale + prior_center_x;</div>
<div class="line">            center_y = mbox[i].y_min * prior_h / tf_scale_factors-&gt;center_y_scale + prior_center_y;</div>
<div class="line">            w = prior_w * exp(mbox[i].x_max / tf_scale_factors-&gt;width_scale);</div>
<div class="line">            h = prior_h * exp(mbox[i].y_max / tf_scale_factors-&gt;height_scale);</div>
<div class="line">        }</div>
<div class="line">        bboxes[i].x_min = center_x - w / 2;</div>
<div class="line">        bboxes[i].y_min = center_y - h / 2;</div>
<div class="line">        bboxes[i].x_max = center_x + w / 2;</div>
<div class="line">        bboxes[i].y_max = center_y + h / 2;</div>
<div class="line">        bboxes[i].x_min = (bboxes[i].x_min &lt; 0.0f) ? 0.0f : ((bboxes[i].x_min &gt; 1.0f) ? 1.0f : bboxes[i].x_min);</div>
<div class="line">        bboxes[i].y_min = (bboxes[i].y_min &lt; 0.0f) ? 0.0f : ((bboxes[i].y_min &gt; 1.0f) ? 1.0f : bboxes[i].y_min);</div>
<div class="line">        bboxes[i].x_max = (bboxes[i].x_max &lt; 0.0f) ? 0.0f : ((bboxes[i].x_max &gt; 1.0f) ? 1.0f : bboxes[i].x_max);</div>
<div class="line">        bboxes[i].y_max = (bboxes[i].y_max &lt; 0.0f) ? 0.0f : ((bboxes[i].y_max &gt; 1.0f) ? 1.0f : bboxes[i].y_max);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;ssd_bboxes_decode exit: total box num %d\n&quot;</span>, num_all_boxes);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> filter_bboxes(<span class="keywordtype">float</span> *mbox_conf, <span class="keywordtype">int</span> class_id, dproc_bbox_param_t *bboxes,</div>
<div class="line">    <span class="keywordtype">int</span> num_all_bboxes, dproc_ssd_detection_output_config_t *config,</div>
<div class="line">    dproc_ssd_detection_output_result_t *ssd_info)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> num_bboxes = 0;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;filter_bboxes enter: num all bboxes: %d\n&quot;</span>, num_all_bboxes);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* For performance, instead of:</span></div>
<div class="line"><span class="comment">    1. sort all boxes base on their scores, then</span></div>
<div class="line"><span class="comment">    2. filter out lower than conf_threshold entries</span></div>
<div class="line"><span class="comment">    Do</span></div>
<div class="line"><span class="comment">    1. filter out lower than conf_threshold entries, then</span></div>
<div class="line"><span class="comment">    2. sort remaining boxes</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* step 1: filter */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; num_all_bboxes; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (mbox_conf[class_id + i*config-&gt;num_classes] &gt;= config-&gt;conf_threshold) {</div>
<div class="line">            ssd_info[num_bboxes].label = class_id;</div>
<div class="line">            ssd_info[num_bboxes].score = mbox_conf[class_id + i*config-&gt;num_classes];</div>
<div class="line">            ssd_info[num_bboxes].bbox = bboxes[i];</div>
<div class="line">            num_bboxes++;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* step 2: sort */</span></div>
<div class="line">    <span class="keywordflow">if</span> (num_bboxes) {</div>
<div class="line">        sort_ssd_result_by_score(ssd_info, num_bboxes);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;filter_bboxes exit: num bboxes filtered %d\n&quot;</span>, num_bboxes);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> num_bboxes;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/**********************************************</span></div>
<div class="line"><span class="comment">Function: nms</span></div>
<div class="line"><span class="comment">Input:</span></div>
<div class="line"><span class="comment">ssd class results</span></div>
<div class="line"><span class="comment">number of filtered bbox</span></div>
<div class="line"><span class="comment">nms threshold</span></div>
<div class="line"><span class="comment">Output:</span></div>
<div class="line"><span class="comment">ssd_result for kept bbox</span></div>
<div class="line"><span class="comment">bboxes_kept_num</span></div>
<div class="line"><span class="comment">**********************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> nms(dproc_ssd_detection_output_result_t *ssd_class, <span class="keywordtype">int</span> num_bboxes,</div>
<div class="line">    <span class="keywordtype">int</span> nms_top_k, <span class="keywordtype">float</span> th_nms, dproc_ssd_detection_output_result_t *ssd_result,</div>
<div class="line">    uint8_t *bboxes_kept_idx_array)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> bbox_idx, ancr_idx;</div>
<div class="line">    <span class="keywordtype">int</span> bboxes_kept_num = 0;</div>
<div class="line">    uint8_t keep_bbox;</div>
<div class="line">    <span class="keywordtype">float</span> overlap;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    dproc_bbox_param_t box_ancr, box_curr;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;nms enter: num bboxes: %d\n&quot;</span>, num_bboxes);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_bboxes &gt; nms_top_k) {</div>
<div class="line">        num_bboxes = nms_top_k;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_bboxes &gt; 0) {</div>
<div class="line">        <span class="keywordflow">for</span> (bbox_idx = 0; bbox_idx &lt; num_bboxes; bbox_idx++) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;Incoming bbox %d, (%f, %f), (%f, %f)\n&quot;</span>,</div>
<div class="line">                bbox_idx, ssd_class[bbox_idx].bbox.x_min, ssd_class[bbox_idx].bbox.y_min,</div>
<div class="line">                ssd_class[bbox_idx].bbox.x_max, ssd_class[bbox_idx].bbox.y_max);</div>
<div class="line">            keep_bbox = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; bboxes_kept_num; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (keep_bbox) {</div>
<div class="line">                    ancr_idx = bboxes_kept_idx_array[i];</div>
<div class="line">                    box_ancr = ssd_class[ancr_idx].bbox;</div>
<div class="line">                    box_curr = ssd_class[bbox_idx].bbox;</div>
<div class="line">                    overlap = jaccard_overlap(&amp;box_curr, &amp;box_ancr);</div>
<div class="line">                    <span class="keywordflow">if</span> (overlap &lt;= th_nms) {</div>
<div class="line">                        keep_bbox = <span class="keyword">true</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> {</div>
<div class="line">                        keep_bbox = <span class="keyword">false</span>;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;box_curr (%f, %f), (%f, %f)\n&quot;</span>,</div>
<div class="line">                        box_curr.x_min, box_curr.y_min, box_curr.x_max, box_curr.y_max);</div>
<div class="line">                    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;box_ancr (%f, %f), (%f, %f)\n&quot;</span>,</div>
<div class="line">                        box_ancr.x_min, box_ancr.y_min, box_ancr.x_max, box_ancr.y_max);</div>
<div class="line">                    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;th_nms %f, overlap %f\n&quot;</span>, th_nms, overlap);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (keep_bbox) {</div>
<div class="line">                bboxes_kept_idx_array[bboxes_kept_num] = bbox_idx;</div>
<div class="line">                ssd_result[bboxes_kept_num] = ssd_class[bbox_idx];</div>
<div class="line"> </div>
<div class="line">                bboxes_kept_num++;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;nms exit: kept bboxes: %d\n&quot;</span>, bboxes_kept_num);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> bboxes_kept_num;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/**********************************************</span></div>
<div class="line"><span class="comment">Function: keep_top_k</span></div>
<div class="line"><span class="comment">Input:</span></div>
<div class="line"><span class="comment">ssd results</span></div>
<div class="line"><span class="comment">ssd_result_num</span></div>
<div class="line"><span class="comment">keep_top_k_objs</span></div>
<div class="line"><span class="comment">Output:</span></div>
<div class="line"><span class="comment">sorted ssd_result</span></div>
<div class="line"><span class="comment">top_k ssd_result_num</span></div>
<div class="line"><span class="comment">**********************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> keep_top_k(dproc_ssd_detection_output_result_t *ssd_result, <span class="keywordtype">int</span> ssd_result_num,</div>
<div class="line">    <span class="keywordtype">int</span> keep_top_k_objs)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> result_num = ssd_result_num;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;keep_top_k enter: ssd_result_num %d\n&quot;</span>, ssd_result_num);</div>
<div class="line"> </div>
<div class="line">    sort_ssd_result_by_score(ssd_result, ssd_result_num);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((keep_top_k_objs &gt; -1) &amp;&amp; (ssd_result_num &gt; keep_top_k_objs)) {</div>
<div class="line">        result_num = keep_top_k_objs;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;keep_top_k exit: final detected num %d\n&quot;</span>, result_num);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> result_num;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/**********************************************</span></div>
<div class="line"><span class="comment">Function: detected_bboxes</span></div>
<div class="line"><span class="comment">Input:</span></div>
<div class="line"><span class="comment">mbox_conf_flatten</span></div>
<div class="line"><span class="comment">bboxes</span></div>
<div class="line"><span class="comment">config</span></div>
<div class="line"><span class="comment">Output:</span></div>
<div class="line"><span class="comment">ssd_result</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"># processing per class to make sure we can get the same result as SSD&#39;s ones</span></div>
<div class="line"><span class="comment"># step a: filter out the boxes if score under the th_conf</span></div>
<div class="line"><span class="comment"># step b: SSD&#39;s NMS</span></div>
<div class="line"><span class="comment"># after all classes finished step a &amp; b</span></div>
<div class="line"><span class="comment"># step c: keep keep_top_k_objects in one image for all</span></div>
<div class="line"><span class="comment">**********************************************/</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> detected_bboxes(<span class="keywordtype">float</span> *mbox_conf_flatten, dproc_bbox_param_t *bboxes,</div>
<div class="line">    <span class="keywordtype">int</span> num_all_bboxes, dproc_ssd_detection_output_t *ssd_detection_output,</div>
<div class="line">    dproc_ssd_detection_output_result_t *ssd_result, dproc_ssd_class_dbg_info_t *dbg_info,</div>
<div class="line">    dproc_ssd_detection_output_result_t *ssd_class, uint8_t *bboxes_kept_idx_array)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ssd_result_num = 0;</div>
<div class="line">    <span class="keywordtype">int</span> num_bboxes;</div>
<div class="line">    <span class="keywordtype">int</span> result_num[<a name="a45"></a><a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga2c86d87f22cfcba58a54ae8665caff41">MAX_CORE_NUMBER</a>];</div>
<div class="line">    <span class="keywordtype">int</span> num_bboxes_post_nms;</div>
<div class="line">    <span class="keywordtype">int</span> thread_id;</div>
<div class="line">    uint32_t class_id;</div>
<div class="line">    dproc_ssd_detection_output_config_t *config = &amp;(ssd_detection_output-&gt;config);</div>
<div class="line">    dproc_ssd_detection_output_result_t *p_ssd_class = NULL;</div>
<div class="line">    dproc_ssd_detection_output_result_t *p_ssd_result = NULL;</div>
<div class="line">    dproc_ssd_detection_output_result_t *ssd_result_temp = NULL;</div>
<div class="line">    uint8_t *p_idx_array = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;detected_bboxes enter\n&quot;</span>);</div>
<div class="line">        config-&gt;conf_threshold = max(0, config-&gt;conf_threshold);</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;ssd confidence threshold %f\n&quot;</span>, config-&gt;conf_threshold);</div>
<div class="line"> </div>
<div class="line">        memset(result_num, 0, <span class="keyword">sizeof</span>(result_num));</div>
<div class="line"><span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line">        ssd_result_temp = ssd_detection_output-&gt;ssd_result;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        ssd_result_temp = ssd_result;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if _OPENMP</span></div>
<div class="line">        omp_set_num_threads(config-&gt;thread_num);</div>
<div class="line"><span class="preprocessor">        #pragma omp parallel for private(num_bboxes, num_bboxes_post_nms, thread_id, p_ssd_class, p_ssd_result, p_idx_array)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <span class="keywordflow">for</span> (class_id = 0; class_id &lt; config-&gt;num_classes; class_id++) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;#################################################\n&quot;</span>);</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;SSD for class %d\n&quot;</span>, class_id);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if _OPENMP</span></div>
<div class="line">            thread_id = omp_get_thread_num();</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">            thread_id = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">            p_ssd_class = &amp;ssd_class[num_all_bboxes * thread_id];</div>
<div class="line">            p_ssd_result = &amp;ssd_result_temp[num_all_bboxes * thread_id];</div>
<div class="line">            p_idx_array = &amp;bboxes_kept_idx_array[config-&gt;nms_top_k * thread_id];</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* clear ssd result to 0 first for class */</span></div>
<div class="line">            memset(p_ssd_class, 0, num_all_bboxes * <span class="keyword">sizeof</span>(dproc_ssd_detection_output_result_t));</div>
<div class="line">            <span class="keywordflow">if</span> (class_id != config-&gt;background_label_id) {</div>
<div class="line">                <span class="comment">/* step a: filter out the boxes if score under the th_conf */</span></div>
<div class="line">                num_bboxes = filter_bboxes(mbox_conf_flatten, class_id, bboxes, num_all_bboxes, config, p_ssd_class);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">/* step b: NMS */</span></div>
<div class="line">                memset(p_idx_array, 0, config-&gt;nms_top_k * <span class="keyword">sizeof</span>(uint8_t));</div>
<div class="line">                num_bboxes_post_nms = nms(p_ssd_class, num_bboxes, config-&gt;nms_top_k,</div>
<div class="line">                    config-&gt;nms_threshold, &amp;p_ssd_result[result_num[thread_id]],</div>
<div class="line">                    p_idx_array);</div>
<div class="line">                result_num[thread_id] += num_bboxes_post_nms;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (dbg_info != NULL) {</div>
<div class="line">                    dbg_info[class_id].num_bboxes_above_threshold = num_bboxes;</div>
<div class="line">                    dbg_info[class_id].num_bboxes_post_nms = num_bboxes_post_nms;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;detected_bboxes: background class [%d] not handled\n&quot;</span>, class_id);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;#################################################\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if _OPENMP</span></div>
<div class="line">        <span class="keywordflow">for</span> (thread_id = 0; thread_id &lt; config-&gt;thread_num; thread_id++) {</div>
<div class="line">            memcpy(&amp;ssd_result[ssd_result_num],</div>
<div class="line">                &amp;ssd_result_temp[num_all_bboxes * thread_id],</div>
<div class="line">                result_num[thread_id] * <span class="keyword">sizeof</span>(dproc_ssd_detection_output_result_t));</div>
<div class="line">            ssd_result_num += result_num[thread_id];</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        ssd_result_num = result_num[0];</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* step c: keep keep_top_k_objects */</span></div>
<div class="line">        ssd_result_num = keep_top_k(ssd_result, ssd_result_num, config-&gt;keep_top_k);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;detected_bboxes exit\n&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ssd_result_num;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> check_detection_output_config(dproc_ssd_detection_output_config_t *config)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = <a name="a46"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (config == NULL) {</div>
<div class="line">            <a name="a47"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;Please define dproc parameters!\n&quot;</span>);</div>
<div class="line">            ret = <a name="a48"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (config-&gt;share_location != 1) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;share_location only can be 1!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (config-&gt;code_type != <a class="code" href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6afb2c9a09afbaffb773345b552314d1b5">AMBA_BBOX_CENTER_SIZE</a>) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;code_type only can be AMBA_BBOX_CENTER_SIZE!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (config-&gt;background_label_id &gt;= config-&gt;num_classes) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;background_label_id should be in range of (0~%d)!\n&quot;</span>, (config-&gt;num_classes - 1));</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (config-&gt;mbox_loc_num_elements == 0) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;mbox_loc_num_elements should not be 0!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (config-&gt;num_all_bboxes != (config-&gt;mbox_loc_num_elements &gt;&gt; 2)) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;num_all_bboxes should be 1/4 * mbox_loc_num_elements!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (config-&gt;conf_threshold &lt; 0 ) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;conf_threshold cannot smaller than 0!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> amba_ssd_detection_output_init(dproc_ssd_detection_output_t *ssd_detection_output,</div>
<div class="line">    dproc_ssd_detection_output_config_t *config)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>;</div>
<div class="line">    dproc_ssd_detection_output_config_t *amba_ssd_config = NULL;</div>
<div class="line">    dproc_bbox_param_t *bboxes = NULL;</div>
<div class="line">    dproc_ssd_detection_output_result_t *ssd_class = NULL;</div>
<div class="line">    dproc_ssd_detection_output_result_t *ssd_result = NULL;</div>
<div class="line">    uint8_t *bboxes_kept_idx_array = NULL;</div>
<div class="line">    uint32_t num_all_bboxes = 0, nms_top_k = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (config == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;dproc ssd coniguration is NULL!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ssd_detection_output == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;Invalid ssd_detection_output!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        config-&gt;share_location = 1;</div>
<div class="line">        config-&gt;code_type = <a class="code" href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6afb2c9a09afbaffb773345b552314d1b5">AMBA_BBOX_CENTER_SIZE</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (check_detection_output_config(config) &lt; 0) {</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        memset(ssd_detection_output, 0, <span class="keyword">sizeof</span>(dproc_ssd_detection_output_t));</div>
<div class="line">        amba_ssd_config = &amp;(ssd_detection_output-&gt;config);</div>
<div class="line">        memcpy(amba_ssd_config, config, <span class="keyword">sizeof</span>(dproc_ssd_detection_output_config_t));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (amba_ssd_config-&gt;thread_num &lt;= 0) {</div>
<div class="line">            amba_ssd_config-&gt;thread_num = 1;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (amba_ssd_config-&gt;thread_num &gt; <a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga2c86d87f22cfcba58a54ae8665caff41">MAX_CORE_NUMBER</a>) {</div>
<div class="line">            amba_ssd_config-&gt;thread_num = <a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga2c86d87f22cfcba58a54ae8665caff41">MAX_CORE_NUMBER</a>;</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;[DProc]Enable OpenMP for SSD, thread_num: %d\n&quot;</span>, amba_ssd_config-&gt;thread_num);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">        num_all_bboxes = config-&gt;num_all_bboxes;</div>
<div class="line">        bboxes = (dproc_bbox_param_t *)malloc(num_all_bboxes * <span class="keyword">sizeof</span>(dproc_bbox_param_t));</div>
<div class="line">        <span class="keywordflow">if</span> (bboxes == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;failed to malloc bboxes\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        memset(bboxes, 0, num_all_bboxes * <span class="keyword">sizeof</span>(dproc_bbox_param_t));</div>
<div class="line"> </div>
<div class="line">        ssd_class = (dproc_ssd_detection_output_result_t *)malloc(</div>
<div class="line">            amba_ssd_config-&gt;thread_num * num_all_bboxes * <span class="keyword">sizeof</span>(dproc_ssd_detection_output_result_t));</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_class == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;failed to malloc ssd_class\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        memset(ssd_class, 0, amba_ssd_config-&gt;thread_num * num_all_bboxes * <span class="keyword">sizeof</span>(dproc_ssd_detection_output_result_t));</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;malloc ssd_class\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        nms_top_k = config-&gt;nms_top_k;</div>
<div class="line">        bboxes_kept_idx_array = (uint8_t *)malloc(amba_ssd_config-&gt;thread_num * nms_top_k * <span class="keyword">sizeof</span>(uint8_t));</div>
<div class="line">        <span class="keywordflow">if</span> (bboxes_kept_idx_array == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;failed to malloc bboxes_kept_idx_array\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        memset(bboxes_kept_idx_array, 0, amba_ssd_config-&gt;thread_num * nms_top_k * <span class="keyword">sizeof</span>(uint8_t));</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a>(<span class="stringliteral">&quot;malloc bboxes_kept_idx_array\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        ssd_result = (dproc_ssd_detection_output_result_t *)malloc(</div>
<div class="line">            amba_ssd_config-&gt;thread_num * config-&gt;num_all_bboxes * <span class="keyword">sizeof</span>(dproc_ssd_detection_output_result_t));</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_result == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;failed to malloc ssd_result\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ssd_detection_output-&gt;bboxes = bboxes;</div>
<div class="line">        ssd_detection_output-&gt;ssd_class = ssd_class;</div>
<div class="line">        ssd_detection_output-&gt;bboxes_kept_idx_array = bboxes_kept_idx_array;</div>
<div class="line">        ssd_detection_output-&gt;ssd_result = ssd_result;</div>
<div class="line"> </div>
<div class="line">        ssd_detection_output-&gt;max_objects = num_all_bboxes * config-&gt;num_classes;</div>
<div class="line">        ret = ssd_detection_output-&gt;max_objects;</div>
<div class="line">    } <span class="keywordflow">while</span>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (bboxes != NULL) {</div>
<div class="line">            free(bboxes);</div>
<div class="line">            bboxes = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_class != NULL) {</div>
<div class="line">            free(ssd_class);</div>
<div class="line">            ssd_class = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (bboxes_kept_idx_array != NULL) {</div>
<div class="line">            free(bboxes_kept_idx_array);</div>
<div class="line">            bboxes_kept_idx_array = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_result != NULL) {</div>
<div class="line">            free(ssd_result);</div>
<div class="line">            ssd_result = NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> amba_ssd_detection_output_run(dproc_ssd_detection_output_t *ssd_detection_output,</div>
<div class="line">    dproc_run_ssd_detection_output_param_t *amba_ssd_param,</div>
<div class="line">    dproc_ssd_detection_output_result_t *amba_ssd_result, dproc_ssd_class_dbg_info_t *p_dbg_info)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line">    <span class="keywordtype">int</span> ssd_det_num = 0;</div>
<div class="line">    dproc_ssd_detection_output_config_t *ssd_detection_output_config = NULL;</div>
<div class="line">    dproc_bbox_param_t *bboxes = NULL;</div>
<div class="line">    dproc_ssd_detection_output_result_t *ssd_class = NULL;</div>
<div class="line">    uint8_t *bboxes_kept_idx_array = NULL;</div>
<div class="line">    <span class="keywordtype">float</span> *mbox_priorbox = NULL;</div>
<div class="line">    uint8_t *mbox_loc_virt_addr = NULL;</div>
<div class="line">    uint8_t *mbox_conf_flatten_virt_addr = NULL;</div>
<div class="line">    uint32_t unnormalized = 0;</div>
<div class="line">    uint32_t num_all_bboxes = 0;</div>
<div class="line">    ssd_tf_scale_factors_t *scale_factors = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_detection_output == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;Invalid ssd_detection_output!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (amba_ssd_result == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;Invalid dproc_ssd_detection_output_result_t!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (amba_ssd_param == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;Invalid dproc_run_ssd_detection_output_param_t!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((amba_ssd_param-&gt;mbox_loc == NULL)</div>
<div class="line">            || (amba_ssd_param-&gt;mbox_conf_flatten == NULL)</div>
<div class="line">            || (amba_ssd_param-&gt;mbox_priorbox == NULL)) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;Invalid pointer for detection output&#39;s input!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            mbox_priorbox = amba_ssd_param-&gt;mbox_priorbox;</div>
<div class="line">            mbox_loc_virt_addr = amba_ssd_param-&gt;mbox_loc;</div>
<div class="line">            mbox_conf_flatten_virt_addr = amba_ssd_param-&gt;mbox_conf_flatten;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ssd_detection_output_config = &amp;(ssd_detection_output-&gt;config);</div>
<div class="line">        unnormalized = ssd_detection_output_config-&gt;unnormalized;</div>
<div class="line">        num_all_bboxes = ssd_detection_output_config-&gt;num_all_bboxes;</div>
<div class="line"> </div>
<div class="line">        scale_factors = &amp;(ssd_detection_output_config-&gt;scale_factors);</div>
<div class="line">        bboxes = ssd_detection_output-&gt;bboxes;</div>
<div class="line">        ssd_bboxes_decode(mbox_priorbox, (<span class="keywordtype">float</span> *)mbox_loc_virt_addr, num_all_bboxes,</div>
<div class="line">            bboxes, scale_factors, ssd_detection_output_config-&gt;thread_num);</div>
<div class="line"> </div>
<div class="line">        ssd_class = ssd_detection_output-&gt;ssd_class;</div>
<div class="line">        bboxes_kept_idx_array = ssd_detection_output-&gt;bboxes_kept_idx_array;</div>
<div class="line">        ssd_det_num = detected_bboxes((<span class="keywordtype">float</span> *)mbox_conf_flatten_virt_addr, bboxes, num_all_bboxes,</div>
<div class="line">            ssd_detection_output, amba_ssd_result, p_dbg_info, ssd_class, bboxes_kept_idx_array);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Swap for TF */</span></div>
<div class="line">        <span class="keywordflow">if</span> ((scale_factors-&gt;center_x_scale != 0) &amp;&amp; (scale_factors-&gt;center_y_scale != 0)</div>
<div class="line">            &amp;&amp; (scale_factors-&gt;width_scale != 0) &amp;&amp; (scale_factors-&gt;height_scale !=0)) {</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; ssd_det_num; i++) {</div>
<div class="line">                swap_bbox(&amp;amba_ssd_result[i].bbox);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* scale normalized bbox to real bbox */</span></div>
<div class="line">        <span class="keywordflow">if</span> (unnormalized) {</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; ssd_det_num; i++) {</div>
<div class="line">                scale_bbox(&amp;amba_ssd_result[i].bbox, ssd_detection_output_config-&gt;img_width,</div>
<div class="line">                    ssd_detection_output_config-&gt;img_height);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ret = ssd_det_num;</div>
<div class="line">    } <span class="keywordflow">while</span>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> amba_ssd_detection_output_deinit(dproc_ssd_detection_output_t *ssd_detection_output)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_detection_output == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;Invalid ssd_detection_output!\n&quot;</span>);</div>
<div class="line">            ret = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ssd_detection_output-&gt;bboxes != NULL) {</div>
<div class="line">            free(ssd_detection_output-&gt;bboxes);</div>
<div class="line">            ssd_detection_output-&gt;bboxes = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_detection_output-&gt;ssd_class != NULL) {</div>
<div class="line">            free(ssd_detection_output-&gt;ssd_class);</div>
<div class="line">            ssd_detection_output-&gt;ssd_class = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_detection_output-&gt;bboxes_kept_idx_array != NULL) {</div>
<div class="line">            free(ssd_detection_output-&gt;bboxes_kept_idx_array);</div>
<div class="line">            ssd_detection_output-&gt;bboxes_kept_idx_array = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_detection_output-&gt;ssd_result != NULL) {</div>
<div class="line">            free(ssd_detection_output-&gt;ssd_result);</div>
<div class="line">            ssd_detection_output-&gt;ssd_result = NULL;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        memset(ssd_detection_output, 0, <span class="keyword">sizeof</span>(dproc_ssd_detection_output_t));</div>
<div class="line">    } <span class="keywordflow">while</span>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_dproc_ssd_config(dproc_ssd_detection_output_config_t *ssd_config)</div>
<div class="line">{</div>
<div class="line">    <a name="a49"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;******************************\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Dproc SSD config\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;******************************\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Image width:\t\t%d\n&quot;</span>, ssd_config-&gt;img_width);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Image height:\t\t%d\n&quot;</span>, ssd_config-&gt;img_height);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;All bboxes num:\t\t%d\n&quot;</span>, ssd_config-&gt;num_all_bboxes);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Number of classes:\t%d\n&quot;</span>, ssd_config-&gt;num_classes);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Background label id:\t%d\n&quot;</span>, ssd_config-&gt;background_label_id);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Share Location:\t\t%d\n&quot;</span>, ssd_config-&gt;share_location);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;BBox code type:\t\t%d\n&quot;</span>, ssd_config-&gt;code_type);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Confidence threshold:\t%.2f\n&quot;</span>, ssd_config-&gt;conf_threshold);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Keep top K objects:\t%d\n&quot;</span>, ssd_config-&gt;keep_top_k);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;NMS threshold:\t\t%.2f\n&quot;</span>, ssd_config-&gt;nms_threshold);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;NMS top K:\t\t%d\n&quot;</span>, ssd_config-&gt;nms_top_k);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Thread number for Arm task: %d\n&quot;</span>, ssd_config-&gt;thread_num);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;******************************\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_dproc_class_dbg_info(dproc_ssd_class_dbg_info_t *dbg_info, uint32_t all_bbox_num,</div>
<div class="line">    dproc_ssd_detection_output_config_t* config)</div>
<div class="line">{</div>
<div class="line">    uint32_t class_id = 0;</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;*******************************\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Dproc class debug info\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;*******************************\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Thread number for Arm task: %d\n&quot;</span>, config-&gt;thread_num);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Confidence threshold: %f\n&quot;</span>, config-&gt;conf_threshold);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Number of PriorBox: %d\n&quot;</span>, all_bbox_num);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;NMS Top K: %d\n&quot;</span>, config-&gt;nms_top_k);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;-------------------------------------------\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Class Index  Filtered Boxes  Post NMS Boxes\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;-------------------------------------------\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (class_id = 0; class_id &lt; config-&gt;num_classes; class_id++) {</div>
<div class="line">        <span class="keywordflow">if</span> (class_id != config-&gt;background_label_id &amp;&amp;</div>
<div class="line">            dbg_info[class_id].num_bboxes_above_threshold &gt; 0) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;%d\t\t%d\t\t%d\n&quot;</span>,</div>
<div class="line">            class_id,</div>
<div class="line">            dbg_info[class_id].num_bboxes_above_threshold,</div>
<div class="line">            dbg_info[class_id].num_bboxes_post_nms);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_dproc_ssd_results(dproc_ssd_detection_output_result_t *ssd_result,</div>
<div class="line">    <span class="keywordtype">int</span> ssd_result_num, <span class="keywordtype">int</span> unnormalized)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;*******************************\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Dproc SSD detection results\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;*******************************\n&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;Detected [%d] objects\n&quot;</span>, ssd_result_num);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ssd_result_num &gt; 0) {</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;-----------------------------------------------------------------------\n&quot;</span>);</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;#\tlabel\tmin(x, y)\t\tmax(x, y)\t\tscore\n&quot;</span>);</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;-----------------------------------------------------------------------\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; ssd_result_num; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (unnormalized) {</div>
<div class="line">                <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;%d\t%d\t(%4.0f, %4.0f)\t(%4.0f, %4.0f)\t%.5f\n&quot;</span>,</div>
<div class="line">                i+1, ssd_result[i].label,</div>
<div class="line">                ssd_result[i].bbox.x_min, ssd_result[i].bbox.y_min,</div>
<div class="line">                ssd_result[i].bbox.x_max, ssd_result[i].bbox.y_max,</div>
<div class="line">                ssd_result[i].score);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;%d\t%d\t(%1.5f, %1.5f)\t(%1.5f, %1.5f)\t%.5f\n&quot;</span>,</div>
<div class="line">                i+1, ssd_result[i].label,</div>
<div class="line">                ssd_result[i].bbox.x_min, ssd_result[i].bbox.y_min,</div>
<div class="line">                ssd_result[i].bbox.x_max, ssd_result[i].bbox.y_max,</div>
<div class="line">                ssd_result[i].score);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;-----------------------------------------------------------------------\n\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_byte_num_from_bin(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, uint32_t *byte_num)</div>
<div class="line">{</div>
<div class="line">    FILE* fp = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>, num = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        fp = fopen(filename, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (fp == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;get_byte_num_from_bin fopen error !\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (fseek(fp, 0, SEEK_END) != 0) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;get_byte_num_from_bin fseek error !\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        num = ftell(fp);</div>
<div class="line">        <span class="keywordflow">if</span> (num &lt; 0) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;get_byte_num_from_bin ftell error !\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        *byte_num = num;</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fp != NULL) {</div>
<div class="line">        fclose(fp);</div>
<div class="line">        fp = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_float_from_bin(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, uint32_t byte_num, <span class="keywordtype">float</span>* buffer)</div>
<div class="line">{</div>
<div class="line">    FILE* fp = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>;</div>
<div class="line">    uint32_t read_num = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        fp = fopen(filename, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (fp == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;get_float_from_bin fopen error !\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        read_num = fread(buffer, 1, byte_num, fp);</div>
<div class="line">        <span class="keywordflow">if</span> (read_num != byte_num) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;get_float_from_bin fread error !\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fp != NULL) {</div>
<div class="line">        fclose(fp);</div>
<div class="line">        fp = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ssd_net_run_arm_nms_init(nnl_ssd_arm_cfg_t *ssd_cfg, dproc_ssd_detection_output_config_t *config, vp_output_t *vp_output)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>;</div>
<div class="line">    <span class="keywordtype">int</span> max_dproc_ssd_result_num = 0;</div>
<div class="line">    uint32_t byte_num = 0;</div>
<div class="line">    <span class="keywordtype">float</span> *priorbox_buf = NULL;</div>
<div class="line">    dproc_ssd_detection_output_config_t *dproc_ssd_config = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Each bbox is represented by 4 float parameters*/</span></div>
<div class="line">    uint32_t loc_elements_num = 0;</div>
<div class="line">    <a class="code" href="../../d9/d79/group__eazyai-tensor-helper.html#ga2df9d3f13428a2486155ee1f330c1ed4">ea_tensor_t</a> *output_loc_tensor = NULL;</div>
<div class="line"> </div>
<div class="line">    uint32_t all_bbox_num = 0;;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        dproc_ssd_config = config;</div>
<div class="line">        <a name="a50"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gabfe3786470deb087a8c51c3516fa0a3e">RVAL_OK</a>(get_tensor_by_name_from_output(vp_output, ssd_cfg-&gt;output_loc_name, &amp;output_loc_tensor));</div>
<div class="line">        loc_elements_num= (<a name="a51"></a><a class="code" href="../../da/db2/group__eazyai-tensor-details.html#ga9b79faedabc098e2c0623530cdeba611">ea_tensor_shape</a>(output_loc_tensor)[0] * \</div>
<div class="line">                        ea_tensor_shape(output_loc_tensor)[1] * \</div>
<div class="line">                        ea_tensor_shape(output_loc_tensor)[2] * \</div>
<div class="line">                        ea_tensor_shape(output_loc_tensor)[3]);</div>
<div class="line">        all_bbox_num = loc_elements_num &gt;&gt; 2;</div>
<div class="line">        ssd_cfg-&gt;all_bbox_num = all_bbox_num;</div>
<div class="line">        <span class="keywordflow">if</span> (get_byte_num_from_bin(ssd_cfg-&gt;priorbox_path, &amp;byte_num) &lt; 0) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;get_byte_num from priorbox error!\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        priorbox_buf = (<span class="keywordtype">float</span> *)malloc(byte_num);</div>
<div class="line">        <span class="keywordflow">if</span> (priorbox_buf == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;failed to malloc priorbox_buf\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        memset(priorbox_buf, 0, byte_num);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (get_float_from_bin(ssd_cfg-&gt;priorbox_path, byte_num, priorbox_buf) &lt; 0) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;fail to get_float from priorbox_path[%s] !\n&quot;</span>, ssd_cfg-&gt;priorbox_path);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        ssd_cfg-&gt;priorbox_buf = priorbox_buf;</div>
<div class="line"> </div>
<div class="line">        dproc_ssd_config-&gt;mbox_loc_num_elements = loc_elements_num;</div>
<div class="line">        dproc_ssd_config-&gt;num_all_bboxes = all_bbox_num;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ssd_cfg-&gt;debug_en) {</div>
<div class="line">            print_dproc_ssd_config(dproc_ssd_config);</div>
<div class="line">            ssd_cfg-&gt;dproc_ssd_class_dbg_info = (dproc_ssd_class_dbg_info_t *)</div>
<div class="line">                malloc(ssd_cfg-&gt;class_num * <span class="keyword">sizeof</span>(dproc_ssd_class_dbg_info_t));</div>
<div class="line">            <span class="keywordflow">if</span> (ssd_cfg-&gt;dproc_ssd_class_dbg_info == NULL) {</div>
<div class="line">                <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;failed to malloc dproc_ssd_class_dbg_info\n&quot;</span>);</div>
<div class="line">                rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        max_dproc_ssd_result_num = amba_ssd_detection_output_init(&amp;ssd_cfg-&gt;ssd_output, dproc_ssd_config);</div>
<div class="line">        <span class="keywordflow">if</span> (max_dproc_ssd_result_num &lt; 0) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;dproc_init for ssd failed !\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        ssd_cfg-&gt;ssd_result.dproc_ssd_result = (dproc_ssd_detection_output_result_t *)malloc(<span class="keyword">sizeof</span>(dproc_ssd_detection_output_result_t) *</div>
<div class="line">            max_dproc_ssd_result_num);</div>
<div class="line">        <a name="a52"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a>(ssd_cfg-&gt;ssd_result.dproc_ssd_result != NULL);</div>
<div class="line"> </div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (priorbox_buf) {</div>
<div class="line">            free(priorbox_buf);</div>
<div class="line">            priorbox_buf = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_cfg-&gt;ssd_result.dproc_ssd_result) {</div>
<div class="line">            free(ssd_cfg-&gt;ssd_result.dproc_ssd_result);</div>
<div class="line">            ssd_cfg-&gt;ssd_result.dproc_ssd_result = NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ssd_net_run_arm_nms_deinit(nnl_ssd_arm_cfg_t *ssd_cfg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>;</div>
<div class="line">    <span class="keywordtype">float</span> *priorbox_buf = ssd_cfg-&gt;priorbox_buf;</div>
<div class="line">    dproc_ssd_class_dbg_info_t *dproc_ssd_class_dbg_info = ssd_cfg-&gt;dproc_ssd_class_dbg_info;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a>(ssd_cfg != NULL);</div>
<div class="line">        <span class="keywordflow">if</span> (amba_ssd_detection_output_deinit(&amp;ssd_cfg-&gt;ssd_output) &lt; 0){</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;dproc_deinit failed\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (dproc_ssd_class_dbg_info) {</div>
<div class="line">            free(dproc_ssd_class_dbg_info);</div>
<div class="line">            dproc_ssd_class_dbg_info = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (priorbox_buf) {</div>
<div class="line">            free(priorbox_buf);</div>
<div class="line">            priorbox_buf = NULL;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TF_SCALE_FACTORS_NUM 4</span></div>
<div class="line"><span class="keywordtype">int</span> ssd_arm_init(nn_arm_context_t *ctx, <span class="keyword">const</span> <span class="keywordtype">char</span> *lua_file)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> arm_nms_init_rval = -1;</div>
<div class="line">    <span class="keywordtype">int</span> rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>;</div>
<div class="line">    <span class="keywordtype">int</span> tf_scale[TF_SCALE_FACTORS_NUM];</div>
<div class="line">    lua_State *L = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> enable_log = 0;</div>
<div class="line">    nnl_ssd_arm_cfg_t *ssd_cfg = NULL;</div>
<div class="line">    dproc_ssd_detection_output_config_t config;</div>
<div class="line">    detection_result_t *res = NULL;</div>
<div class="line">    <span class="keywordtype">int</span> log_level;</div>
<div class="line">    <span class="keywordtype">size_t</span> squeeze = 0;</div>
<div class="line">    <span class="keywordtype">size_t</span> postprocessor = 0;</div>
<div class="line">    <span class="keywordtype">int</span> class_num = 0;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <a name="a53"></a><a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga4da64e8e9357c35fd8e1be1252a8bfe1">EA_LOG_SET_LOCAL</a>(<a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gga35915c50caa86eeec9606ef087bec6b5a11be6a6ac457a87220a879b8c4050ce6">EA_LOG_LEVEL_NOTICE</a>);</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a>(ctx != NULL);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ctx-&gt;label_count) {</div>
<div class="line">            <span class="keywordflow">if</span> (strncmp(ctx-&gt;arm_task-&gt;nn_arm_name, <span class="stringliteral">&quot;ssd&quot;</span>, 3) == 0) {</div>
<div class="line">                <span class="keywordflow">if</span> (ctx-&gt;vp_output-&gt;out_num == 2) {</div>
<div class="line">                    squeeze = <a class="code" href="../../da/db2/group__eazyai-tensor-details.html#ga9b79faedabc098e2c0623530cdeba611">ea_tensor_shape</a>(ctx-&gt;vp_output-&gt;out[0].out)[<a name="a54"></a><a class="code" href="../../d9/d79/group__eazyai-tensor-helper.html#ga5d73912292db66d1d55385bb0242920c">EA_W</a>];</div>
<div class="line">                    postprocessor = <a class="code" href="../../da/db2/group__eazyai-tensor-details.html#ga9b79faedabc098e2c0623530cdeba611">ea_tensor_shape</a>(ctx-&gt;vp_output-&gt;out[1].out)[<a class="code" href="../../d9/d79/group__eazyai-tensor-helper.html#ga5d73912292db66d1d55385bb0242920c">EA_W</a>];</div>
<div class="line">                    <span class="keywordflow">if</span> (postprocessor &gt; squeeze) {</div>
<div class="line">                        class_num = (int) (postprocessor / (squeeze / 4));</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        class_num = (int) (squeeze / (postprocessor / 4));</div>
<div class="line">                    }</div>
<div class="line">                    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a>(<span class="stringliteral">&quot;model class number: %d, label number:%d\n&quot;</span>, class_num, ctx-&gt;label_count);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (ctx-&gt;label_count != class_num) {</div>
<div class="line">                    <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;The label_count: *%d* dose not match the real network: *%d* !!!\n&quot;</span>,</div>
<div class="line">                                ctx-&gt;label_count, class_num);</div>
<div class="line">                    rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        memset(&amp;config, 0, <span class="keyword">sizeof</span>(dproc_ssd_detection_output_config_t));</div>
<div class="line">        ssd_cfg = (nnl_ssd_arm_cfg_t *)malloc(<span class="keyword">sizeof</span>(nnl_ssd_arm_cfg_t));</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_cfg == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;create ssd_cfg failed!\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        memset(ssd_cfg, 0, <span class="keyword">sizeof</span>(nnl_ssd_arm_cfg_t));</div>
<div class="line">        ctx-&gt;nn_arm_config = ssd_cfg;</div>
<div class="line">        <span class="keywordflow">if</span> (lua_file == NULL) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;The lua_file param is NULL!\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (nnl_init(&amp;L, lua_file) &lt; 0) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_integer(L, <span class="stringliteral">&quot;log_level&quot;</span>, (<span class="keywordtype">int</span> *)&amp;log_level, enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga4da64e8e9357c35fd8e1be1252a8bfe1">EA_LOG_SET_LOCAL</a>(log_level);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a>(ctx-&gt;extra_input != NULL);</div>
<div class="line">        snprintf(ssd_cfg-&gt;priorbox_path, <a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga58ce36916c399104e18d32ff090f21c6">MAX_STR_LEN</a>, <span class="stringliteral">&quot;%s&quot;</span>, ctx-&gt;extra_input);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_integer(L, <span class="stringliteral">&quot;ssd_debug&quot;</span>, (<span class="keywordtype">int</span> *)&amp;ssd_cfg-&gt;debug_en, enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_float(L, <span class="stringliteral">&quot;conf_threshold&quot;</span>, &amp;(ssd_cfg-&gt;conf_threshold), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((ssd_cfg-&gt;conf_threshold &lt; EPSILON) || ((ssd_cfg-&gt;conf_threshold - 1.0f) &gt; EPSILON)) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;conf_threshold(%f) should be in range (0.0 ~ 1.0)\n&quot;</span>,</div>
<div class="line">                ssd_cfg-&gt;conf_threshold);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        config.conf_threshold = ssd_cfg-&gt;conf_threshold;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_float(L, <span class="stringliteral">&quot;nms_threshold&quot;</span>, &amp;(ssd_cfg-&gt;nms_threshold), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ((ssd_cfg-&gt;nms_threshold &lt; EPSILON) || ((ssd_cfg-&gt;nms_threshold - 1.0f) &gt; EPSILON)) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;nms_threshold(%f) should be in range (0.0 ~ 1.0)\n&quot;</span>,</div>
<div class="line">                ssd_cfg-&gt;nms_threshold);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        config.nms_threshold = ssd_cfg-&gt;nms_threshold;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_integer(L, <span class="stringliteral">&quot;keep_top_k&quot;</span>, (<span class="keywordtype">int</span> *)&amp;(ssd_cfg-&gt;keep_top_k), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        config.keep_top_k = ssd_cfg-&gt;keep_top_k;</div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_integer(L, <span class="stringliteral">&quot;nms_top_k&quot;</span>, (<span class="keywordtype">int</span> *)&amp;(ssd_cfg-&gt;nms_top_k), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        config.nms_top_k = ssd_cfg-&gt;nms_top_k;</div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_integer(L, <span class="stringliteral">&quot;background_label_id&quot;</span>, (<span class="keywordtype">int</span> *)&amp;(ssd_cfg-&gt;background_label_id), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        config.background_label_id = ssd_cfg-&gt;background_label_id;</div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_integer(L, <span class="stringliteral">&quot;unnormalized&quot;</span>, (<span class="keywordtype">int</span> *)&amp;(ssd_cfg-&gt;unnormalized), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        config.unnormalized = ssd_cfg-&gt;unnormalized;</div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_integer(L, <span class="stringliteral">&quot;num_class&quot;</span>, (<span class="keywordtype">int</span> *)&amp;(ssd_cfg-&gt;class_num), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        config.num_classes = ssd_cfg-&gt;class_num;</div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_arrary_integer(L, <span class="stringliteral">&quot;tf_scale_factors&quot;</span>, TF_SCALE_FACTORS_NUM,</div>
<div class="line">            tf_scale, enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        config.scale_factors.center_x_scale = tf_scale[0];</div>
<div class="line">        config.scale_factors.center_y_scale = tf_scale[1];</div>
<div class="line">        config.scale_factors.width_scale = tf_scale[2];</div>
<div class="line">        config.scale_factors.height_scale = tf_scale[3];</div>
<div class="line">        config.img_width = <a class="code" href="../../da/db2/group__eazyai-tensor-details.html#ga9b79faedabc098e2c0623530cdeba611">ea_tensor_shape</a>(ctx-&gt;input)[<a class="code" href="../../d9/d79/group__eazyai-tensor-helper.html#ga5d73912292db66d1d55385bb0242920c">EA_W</a>];</div>
<div class="line">        config.img_height = <a class="code" href="../../da/db2/group__eazyai-tensor-details.html#ga9b79faedabc098e2c0623530cdeba611">ea_tensor_shape</a>(ctx-&gt;input)[<a name="a55"></a><a class="code" href="../../d9/d79/group__eazyai-tensor-helper.html#ga016dddbfd872085888b2c97812ed734e">EA_H</a>];</div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_integer(L, <span class="stringliteral">&quot;thread_num&quot;</span>, (<span class="keywordtype">int</span> *)&amp;(ssd_cfg-&gt;thread_num), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        config.thread_num = ssd_cfg-&gt;thread_num;</div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_str(L, <span class="stringliteral">&quot;output_loc_name&quot;</span>, &amp;(ssd_cfg-&gt;output_loc_name[0]), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (nnl_get_str(L, <span class="stringliteral">&quot;output_score_name&quot;</span>, &amp;(ssd_cfg-&gt;output_conf_name[0]), enable_log)</div>
<div class="line">            != NNL_SUCCESS) {</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// for arm nms</span></div>
<div class="line">        arm_nms_init_rval = ssd_net_run_arm_nms_init(ssd_cfg, &amp;config, ctx-&gt;vp_output);</div>
<div class="line">        <span class="keywordflow">if</span> (arm_nms_init_rval &lt; 0) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;ssd_net_run_arm_nms_init for ssd failed! \n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        res = (detection_result_t *)malloc(<span class="keyword">sizeof</span>(detection_result_t));</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a>(res != NULL);</div>
<div class="line">        ctx-&gt;result = res;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ctx-&gt;roi &amp;&amp; (ctx-&gt;roi-&gt;x != 0 ||</div>
<div class="line">            ctx-&gt;roi-&gt;y != 0 ||</div>
<div class="line">            ctx-&gt;roi-&gt;h != 0 ||</div>
<div class="line">            ctx-&gt;roi-&gt;w != 0)) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;ssd postprocess doesn&#39;t support using ROI option to crop image\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rval &lt; 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (arm_nms_init_rval == 0) {</div>
<div class="line">            ssd_net_run_arm_nms_deinit(ssd_cfg);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ctx-&gt;result) {</div>
<div class="line">            free(ctx-&gt;result);</div>
<div class="line">            ctx-&gt;result = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_cfg) {</div>
<div class="line">            free(ssd_cfg);</div>
<div class="line">            ssd_cfg = NULL;</div>
<div class="line">        }</div>
<div class="line">        ctx-&gt;nn_arm_config = NULL;</div>
<div class="line">    }</div>
<div class="line">    nnl_deinit(L);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ssd_arm_deinit(nn_arm_context_t *ctx)</div>
<div class="line">{</div>
<div class="line">    nnl_ssd_arm_cfg_t *ssd_cfg = NULL;</div>
<div class="line">    <span class="keywordflow">if</span> (ctx) {</div>
<div class="line">        ssd_cfg = (nnl_ssd_arm_cfg_t *)ctx-&gt;nn_arm_config;</div>
<div class="line">        if (ssd_cfg) {</div>
<div class="line">            ssd_net_run_arm_nms_deinit(ssd_cfg);</div>
<div class="line">            free(ssd_cfg);</div>
<div class="line">            ssd_cfg = NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (ctx-&gt;result) {</div>
<div class="line">        free(ctx-&gt;result);</div>
<div class="line">        ctx-&gt;result = NULL;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ssd_arm_post_process(nn_arm_context_t *ctx, vp_output_t *vp_output, nn_label_t *labels, <span class="keywordtype">int</span> label_count)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>, i = 0;</div>
<div class="line">    <span class="keywordtype">int</span> label_id = 0;</div>
<div class="line">    <span class="keywordtype">int</span> ssd_det_num = 0;</div>
<div class="line">    nnl_ssd_arm_cfg_t *ssd_cfg;</div>
<div class="line">    <a class="code" href="../../d9/d79/group__eazyai-tensor-helper.html#ga2df9d3f13428a2486155ee1f330c1ed4">ea_tensor_t</a> *out_loc = NULL;</div>
<div class="line">    <a class="code" href="../../d9/d79/group__eazyai-tensor-helper.html#ga2df9d3f13428a2486155ee1f330c1ed4">ea_tensor_t</a> *out_score = NULL;</div>
<div class="line">    dproc_run_ssd_detection_output_param_t ssd_param;</div>
<div class="line">    ssd_net_final_result_t *ssd_net_result = NULL;</div>
<div class="line">    detection_result_t *res = NULL;</div>
<div class="line">    dproc_ssd_detection_output_result_t *objects = NULL;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a>(ctx != NULL);</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a>(ctx-&gt;nn_arm_config != NULL);</div>
<div class="line">        ssd_cfg = (nnl_ssd_arm_cfg_t *)ctx-&gt;nn_arm_config;</div>
<div class="line"> </div>
<div class="line">        if (ssd_cfg-&gt;debug_en) { <span class="comment">// for debug</span></div>
<div class="line">            memset(ssd_cfg-&gt;dproc_ssd_class_dbg_info, 0, ssd_cfg-&gt;class_num * <span class="keyword">sizeof</span>(dproc_ssd_class_dbg_info_t));</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a>(ctx-&gt;result != NULL);</div>
<div class="line">        res = ( detection_result_t *)ctx-&gt;result;</div>
<div class="line">        ssd_net_result = &amp;ssd_cfg-&gt;ssd_result;</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gabfe3786470deb087a8c51c3516fa0a3e">RVAL_OK</a>(get_tensor_by_name_from_output(vp_output, ssd_cfg-&gt;output_loc_name, &amp;out_loc));</div>
<div class="line">        <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gabfe3786470deb087a8c51c3516fa0a3e">RVAL_OK</a>(get_tensor_by_name_from_output(vp_output, ssd_cfg-&gt;output_conf_name, &amp;out_score));</div>
<div class="line">        ssd_param.mbox_priorbox = ssd_cfg-&gt;priorbox_buf;</div>
<div class="line">        ssd_param.mbox_conf_flatten = (uint8_t *)<a name="a56"></a><a class="code" href="../../da/db2/group__eazyai-tensor-details.html#gabb70502d92d6eddb96124b51c695c26f">ea_tensor_data</a>(out_score);</div>
<div class="line">        ssd_param.mbox_loc = (uint8_t *)<a class="code" href="../../da/db2/group__eazyai-tensor-details.html#gabb70502d92d6eddb96124b51c695c26f">ea_tensor_data</a>(out_loc);</div>
<div class="line">        ssd_det_num = amba_ssd_detection_output_run(&amp;ssd_cfg-&gt;ssd_output, &amp;ssd_param, ssd_net_result-&gt;dproc_ssd_result, ssd_cfg-&gt;dproc_ssd_class_dbg_info);</div>
<div class="line">        <span class="keywordflow">if</span> (ssd_det_num &lt; 0) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a>(<span class="stringliteral">&quot;dproc run for ssd fail!\n&quot;</span>);</div>
<div class="line">            rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        ssd_net_result-&gt;ssd_det_num = ssd_det_num;</div>
<div class="line">        res-&gt;valid_det_count = 0;</div>
<div class="line">        objects = ssd_net_result-&gt;dproc_ssd_result;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; ssd_det_num &amp;&amp; i &lt;= MAX_OUT_NUM; i++) {</div>
<div class="line">            label_id = ssd_net_result-&gt;dproc_ssd_result[i].label;</div>
<div class="line">            memset(res-&gt;detections[res-&gt;valid_det_count].label, 0,</div>
<div class="line">                <a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga58ce36916c399104e18d32ff090f21c6">MAX_STR_LEN</a> + 6);</div>
<div class="line">            <span class="keywordflow">if</span> (labels != NULL) {</div>
<div class="line">                <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a>(label_id &lt; label_count);</div>
<div class="line">                memcpy(ssd_net_result-&gt;labels[i], labels[label_id].label, <a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga58ce36916c399104e18d32ff090f21c6">MAX_STR_LEN</a>);</div>
<div class="line">                snprintf(res-&gt;detections[res-&gt;valid_det_count].label,</div>
<div class="line">                    <a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga58ce36916c399104e18d32ff090f21c6">MAX_STR_LEN</a> + 6, <span class="stringliteral">&quot;%.3f %s&quot;</span>, objects[i].score, labels[objects[i].label].label);</div>
<div class="line">            }</div>
<div class="line">            res-&gt;detections[res-&gt;valid_det_count].x_start =</div>
<div class="line">                objects[i].bbox.x_min;</div>
<div class="line">            res-&gt;detections[res-&gt;valid_det_count].y_start =</div>
<div class="line">                objects[i].bbox.y_min;</div>
<div class="line">            res-&gt;detections[res-&gt;valid_det_count].x_end =</div>
<div class="line">                objects[i].bbox.x_max;</div>
<div class="line">            res-&gt;detections[res-&gt;valid_det_count].y_end =</div>
<div class="line">                objects[i].bbox.y_max;</div>
<div class="line">            res-&gt;detections[res-&gt;valid_det_count].score =</div>
<div class="line">                objects[i].score;</div>
<div class="line">            res-&gt;detections[res-&gt;valid_det_count].id = label_id;</div>
<div class="line">            res-&gt;valid_det_count++;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ssd_cfg-&gt;debug_en) { <span class="comment">// for debug</span></div>
<div class="line">            print_dproc_class_dbg_info(ssd_cfg-&gt;dproc_ssd_class_dbg_info, ssd_cfg-&gt;all_bbox_num, &amp;ssd_cfg-&gt;ssd_output.config);</div>
<div class="line">            print_dproc_ssd_results(ssd_net_result-&gt;dproc_ssd_result, ssd_det_num, ssd_cfg-&gt;unnormalized);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ssd_arm_show_result(nn_arm_context_t *ctx, <span class="keyword">const</span> <a class="code" href="../../d9/d79/group__eazyai-tensor-helper.html#ga2df9d3f13428a2486155ee1f330c1ed4">ea_tensor_t</a> *tensor)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> rval = <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a>;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (ctx-&gt;in_mode == <a name="a57"></a><a class="code" href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#gga48989a98a63799179f3630885d79a874ac894bc1b4cf6164b0927bd0e1ece0340">NN_ARM_RUN_LIVE_MODE</a>) {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gabfe3786470deb087a8c51c3516fa0a3e">RVAL_OK</a>(draw_detection_bbox_textbox(ctx, tensor));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code" href="../../d4/d96/group__eazyai-log-helper.html#gabfe3786470deb087a8c51c3516fa0a3e">RVAL_OK</a>(draw_detection_bbox_textbox(ctx, tensor));</div>
<div class="line"> </div>
<div class="line">            <span class="comment">//This will save detection results to txt file which is set by user in file mode.</span></div>
<div class="line">            <span class="keywordflow">if</span> (ctx-&gt;f_result &gt; 0) {</div>
<div class="line">                save_bbox_to_txt((detection_result_t *)ctx-&gt;result, ctx-&gt;file_path, ctx-&gt;f_result);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> rval;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_acaac87a3c92f0714f9c73e9ca608905f"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#acaac87a3c92f0714f9c73e9ca608905f">dproc_ssd_detection_output_config_s::scale_factors</a></div><div class="ttdeci">ssd_tf_scale_factors_t scale_factors</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:162</div></div>
<div class="ttc" id="agroup__eazyai-tensor-details_html_ga9b79faedabc098e2c0623530cdeba611"><div class="ttname"><a href="../../da/db2/group__eazyai-tensor-details.html#ga9b79faedabc098e2c0623530cdeba611">ea_tensor_shape</a></div><div class="ttdeci">const AMBA_API size_t * ea_tensor_shape(const ea_tensor_t *tensor)</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_aa69d925cba68194f263b484dfc8083bc"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#aa69d925cba68194f263b484dfc8083bc">dproc_ssd_detection_output_config_s::keep_top_k</a></div><div class="ttdeci">uint32_t keep_top_k</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:143</div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_gaed0d12d2c797fd90e7564ae681660a4f"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#gaed0d12d2c797fd90e7564ae681660a4f">RVAL_ASSERT</a></div><div class="ttdeci">#define RVAL_ASSERT</div><div class="ttdef"><b>Definition:</b> ea_log.h:215</div></div>
<div class="ttc" id="agroup__dproc-helper_html_gga0ad291b6f8763fa2b107f02e81dab6e6a9a37325e2219ce6f0ca200bc71476eb6"><div class="ttname"><a href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6a9a37325e2219ce6f0ca200bc71476eb6">AMBA_BBOX_NUM_CODETYPE</a></div><div class="ttdeci">@ AMBA_BBOX_NUM_CODETYPE</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:114</div></div>
<div class="ttc" id="astructssd__tf__scale__factors__s_html_a2b0fee07efca8196bdc9a3d5974e1a36"><div class="ttname"><a href="../../d3/d26/structssd__tf__scale__factors__s.html#a2b0fee07efca8196bdc9a3d5974e1a36">ssd_tf_scale_factors_s::center_y_scale</a></div><div class="ttdeci">uint32_t center_y_scale</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:123</div></div>
<div class="ttc" id="astructdproc__run__ssd__detection__output__param__s_html_a48daf9706e0791f8ce1c383e821dd50c"><div class="ttname"><a href="../../d7/d68/structdproc__run__ssd__detection__output__param__s.html#a48daf9706e0791f8ce1c383e821dd50c">dproc_run_ssd_detection_output_param_s::mbox_priorbox</a></div><div class="ttdeci">float * mbox_priorbox</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:176</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_ad530dba76e77adf996cd3197db03abf5"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#ad530dba76e77adf996cd3197db03abf5">dproc_ssd_detection_output_config_s::nms_top_k</a></div><div class="ttdeci">uint32_t nms_top_k</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:147</div></div>
<div class="ttc" id="agroup__eazyai-tensor-helper_html_ga016dddbfd872085888b2c97812ed734e"><div class="ttname"><a href="../../d9/d79/group__eazyai-tensor-helper.html#ga016dddbfd872085888b2c97812ed734e">EA_H</a></div><div class="ttdeci">#define EA_H</div><div class="ttdef"><b>Definition:</b> ea_tensor.h:49</div></div>
<div class="ttc" id="astructssd__tf__scale__factors__s_html_a5e9088eef5706c80641ab9f287bca685"><div class="ttname"><a href="../../d3/d26/structssd__tf__scale__factors__s.html#a5e9088eef5706c80641ab9f287bca685">ssd_tf_scale_factors_s::height_scale</a></div><div class="ttdeci">uint32_t height_scale</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:125</div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_ga895779c2c143d7ac350c9a6a28baa493"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#ga895779c2c143d7ac350c9a6a28baa493">EA_SUCCESS</a></div><div class="ttdeci">#define EA_SUCCESS</div><div class="ttdef"><b>Definition:</b> ea_log.h:49</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_aeb2b08013189ff5789523d71697f3858"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#aeb2b08013189ff5789523d71697f3858">dproc_ssd_detection_output_config_s::img_height</a></div><div class="ttdeci">uint16_t img_height</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:135</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_a363bfab5175aae09f069a69ff5072f2c"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a363bfab5175aae09f069a69ff5072f2c">dproc_ssd_detection_output_config_s::nms_threshold</a></div><div class="ttdeci">float nms_threshold</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:146</div></div>
<div class="ttc" id="aeazyai_8h_html"><div class="ttname"><a href="../../dd/dbe/eazyai_8h.html">eazyai.h</a></div><div class="ttdoc">The public interfaces of EazyAI framwork.</div></div>
<div class="ttc" id="astructdproc__run__ssd__detection__output__param__s_html_aff0a18ed4f71bb29d9daad09b029c678"><div class="ttname"><a href="../../d7/d68/structdproc__run__ssd__detection__output__param__s.html#aff0a18ed4f71bb29d9daad09b029c678">dproc_run_ssd_detection_output_param_s::mbox_loc</a></div><div class="ttdeci">uint8_t * mbox_loc</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:170</div></div>
<div class="ttc" id="astructdproc__ssd__class__dbg__info__s_html"><div class="ttname"><a href="../../df/dd4/structdproc__ssd__class__dbg__info__s.html">dproc_ssd_class_dbg_info_s</a></div><div class="ttdoc">Some debugging information for SSD.</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:102</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__result__s_html_a512bd2c8e2a962b00a6a6926befc170c"><div class="ttname"><a href="../../d7/d9d/structdproc__ssd__detection__output__result__s.html#a512bd2c8e2a962b00a6a6926befc170c">dproc_ssd_detection_output_result_s::label</a></div><div class="ttdeci">int label</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:183</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_a6cb28b18024c89478e7b82b6b3b53f37"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a6cb28b18024c89478e7b82b6b3b53f37">dproc_ssd_detection_output_config_s::thread_num</a></div><div class="ttdeci">int thread_num</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:163</div></div>
<div class="ttc" id="astructssd__tf__scale__factors__s_html_a6f38e75428607403ff781a3b0ab7b79a"><div class="ttname"><a href="../../d3/d26/structssd__tf__scale__factors__s.html#a6f38e75428607403ff781a3b0ab7b79a">ssd_tf_scale_factors_s::center_x_scale</a></div><div class="ttdeci">uint32_t center_x_scale</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:122</div></div>
<div class="ttc" id="astructssd__tf__scale__factors__s_html"><div class="ttname"><a href="../../d3/d26/structssd__tf__scale__factors__s.html">ssd_tf_scale_factors_s</a></div><div class="ttdoc">Description of the scale factors of SSD for TF.</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:121</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_a9f5b1eb8e7845488dc2ef6ed740dec66"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a9f5b1eb8e7845488dc2ef6ed740dec66">dproc_ssd_detection_output_config_s::share_location</a></div><div class="ttdeci">uint32_t share_location</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:154</div></div>
<div class="ttc" id="agroup__eazyai__arm__postprocess-helper_html_ga58ce36916c399104e18d32ff090f21c6"><div class="ttname"><a href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga58ce36916c399104e18d32ff090f21c6">MAX_STR_LEN</a></div><div class="ttdeci">#define MAX_STR_LEN</div><div class="ttdef"><b>Definition:</b> nn_arm.h:59</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_abbbcf57bd73507ab655d67c610177b7e"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#abbbcf57bd73507ab655d67c610177b7e">dproc_ssd_detection_output_config_s::conf_threshold</a></div><div class="ttdeci">float conf_threshold</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:142</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__result__s_html_a8c5cd9b525ee73a24b1d9d8e34982d1c"><div class="ttname"><a href="../../d7/d9d/structdproc__ssd__detection__output__result__s.html#a8c5cd9b525ee73a24b1d9d8e34982d1c">dproc_ssd_detection_output_result_s::score</a></div><div class="ttdeci">float score</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:184</div></div>
<div class="ttc" id="agroup__dproc-helper_html_ga0ad291b6f8763fa2b107f02e81dab6e6"><div class="ttname"><a href="../../df/d12/group__dproc-helper.html#ga0ad291b6f8763fa2b107f02e81dab6e6">amba_bbox_codetype_s</a></div><div class="ttdeci">amba_bbox_codetype_s</div><div class="ttdoc">Description of the coordinate type of the bounding box.</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:110</div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_gadb50ef003362974157bd5ba706c600e2"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#gadb50ef003362974157bd5ba706c600e2">EA_LOG_DEBUG</a></div><div class="ttdeci">#define EA_LOG_DEBUG(format, args...)</div><div class="ttdef"><b>Definition:</b> ea_log.h:150</div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_gabf4ab7c2d5fe62deac5689fad8a8296e"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#gabf4ab7c2d5fe62deac5689fad8a8296e">EA_LOG_DECLARE_LOCAL</a></div><div class="ttdeci">#define EA_LOG_DECLARE_LOCAL(level)</div><div class="ttdef"><b>Definition:</b> ea_log.h:69</div></div>
<div class="ttc" id="astructssd__tf__scale__factors__s_html_abaa83183be5d964b94ae65903048ec97"><div class="ttname"><a href="../../d3/d26/structssd__tf__scale__factors__s.html#abaa83183be5d964b94ae65903048ec97">ssd_tf_scale_factors_s::width_scale</a></div><div class="ttdeci">uint32_t width_scale</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:124</div></div>
<div class="ttc" id="agroup__dproc-helper_html_gga0ad291b6f8763fa2b107f02e81dab6e6a2ff70b0e812a044acb8d69e45c1e6e38"><div class="ttname"><a href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6a2ff70b0e812a044acb8d69e45c1e6e38">AMBA_BBOX_CORNER_SIZE</a></div><div class="ttdeci">@ AMBA_BBOX_CORNER_SIZE</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:113</div></div>
<div class="ttc" id="astructdproc__bbox__param__s_html_a73fc13d83638687d92d5ccf9e4fe1722"><div class="ttname"><a href="../../d7/d1a/structdproc__bbox__param__s.html#a73fc13d83638687d92d5ccf9e4fe1722">dproc_bbox_param_s::x_max</a></div><div class="ttdeci">float x_max</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:92</div></div>
<div class="ttc" id="agroup__eazyai-tensor-helper_html_ga2df9d3f13428a2486155ee1f330c1ed4"><div class="ttname"><a href="../../d9/d79/group__eazyai-tensor-helper.html#ga2df9d3f13428a2486155ee1f330c1ed4">ea_tensor_t</a></div><div class="ttdeci">struct ea_tensor_s ea_tensor_t</div><div class="ttdef"><b>Definition:</b> ea_tensor.h:141</div></div>
<div class="ttc" id="agroup__dproc-helper_html_gga0ad291b6f8763fa2b107f02e81dab6e6afb2c9a09afbaffb773345b552314d1b5"><div class="ttname"><a href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6afb2c9a09afbaffb773345b552314d1b5">AMBA_BBOX_CENTER_SIZE</a></div><div class="ttdeci">@ AMBA_BBOX_CENTER_SIZE</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:112</div></div>
<div class="ttc" id="astructdproc__run__ssd__detection__output__param__s_html_a95995e153df0e373990dc83bc7cc1f29"><div class="ttname"><a href="../../d7/d68/structdproc__run__ssd__detection__output__param__s.html#a95995e153df0e373990dc83bc7cc1f29">dproc_run_ssd_detection_output_param_s::mbox_conf_flatten</a></div><div class="ttdeci">uint8_t * mbox_conf_flatten</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:171</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html">dproc_ssd_detection_output_config_s</a></div><div class="ttdoc">Description of the configuration of SSD detection output.</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:132</div></div>
<div class="ttc" id="astructdproc__bbox__param__s_html_a82405015dd45042774ac84009224bfe0"><div class="ttname"><a href="../../d7/d1a/structdproc__bbox__param__s.html#a82405015dd45042774ac84009224bfe0">dproc_bbox_param_s::y_min</a></div><div class="ttdeci">float y_min</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:91</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_a2737d0c70fcd770d703ee569b4c82f5c"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a2737d0c70fcd770d703ee569b4c82f5c">dproc_ssd_detection_output_config_s::code_type</a></div><div class="ttdeci">amba_bbox_codetype_t code_type</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:153</div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_gga35915c50caa86eeec9606ef087bec6b5a11be6a6ac457a87220a879b8c4050ce6"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#gga35915c50caa86eeec9606ef087bec6b5a11be6a6ac457a87220a879b8c4050ce6">EA_LOG_LEVEL_NOTICE</a></div><div class="ttdeci">@ EA_LOG_LEVEL_NOTICE</div><div class="ttdef"><b>Definition:</b> ea_log.h:62</div></div>
<div class="ttc" id="agroup__eazyai__arm__postprocess-helper_html_gga48989a98a63799179f3630885d79a874ac894bc1b4cf6164b0927bd0e1ece0340"><div class="ttname"><a href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#gga48989a98a63799179f3630885d79a874ac894bc1b4cf6164b0927bd0e1ece0340">NN_ARM_RUN_LIVE_MODE</a></div><div class="ttdeci">@ NN_ARM_RUN_LIVE_MODE</div><div class="ttdef"><b>Definition:</b> nn_arm.h:71</div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_gabfe3786470deb087a8c51c3516fa0a3e"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#gabfe3786470deb087a8c51c3516fa0a3e">RVAL_OK</a></div><div class="ttdeci">#define RVAL_OK</div><div class="ttdef"><b>Definition:</b> ea_log.h:214</div></div>
<div class="ttc" id="agroup__eazyai-tensor-details_html_gabb70502d92d6eddb96124b51c695c26f"><div class="ttname"><a href="../../da/db2/group__eazyai-tensor-details.html#gabb70502d92d6eddb96124b51c695c26f">ea_tensor_data</a></div><div class="ttdeci">AMBA_API void * ea_tensor_data(ea_tensor_t *tensor)</div></div>
<div class="ttc" id="astructdproc__bbox__param__s_html_ab56799f110a6fbd87dc59c9c171516dc"><div class="ttname"><a href="../../d7/d1a/structdproc__bbox__param__s.html#ab56799f110a6fbd87dc59c9c171516dc">dproc_bbox_param_s::x_min</a></div><div class="ttdeci">float x_min</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:90</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__result__s_html"><div class="ttname"><a href="../../d7/d9d/structdproc__ssd__detection__output__result__s.html">dproc_ssd_detection_output_result_s</a></div><div class="ttdoc">Description of the result of SSD detection output.</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:182</div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_ga3e9336d24bc7decc7970963474bea5cf"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#ga3e9336d24bc7decc7970963474bea5cf">EA_FAIL</a></div><div class="ttdeci">#define EA_FAIL</div><div class="ttdef"><b>Definition:</b> ea_log.h:51</div></div>
<div class="ttc" id="agroup__eazyai__arm__postprocess-helper_html_ga2c86d87f22cfcba58a54ae8665caff41"><div class="ttname"><a href="../../d9/dd3/group__eazyai__arm__postprocess-helper.html#ga2c86d87f22cfcba58a54ae8665caff41">MAX_CORE_NUMBER</a></div><div class="ttdeci">#define MAX_CORE_NUMBER</div><div class="ttdef"><b>Definition:</b> nn_arm.h:64</div></div>
<div class="ttc" id="astructdproc__run__ssd__detection__output__param__s_html"><div class="ttname"><a href="../../d7/d68/structdproc__run__ssd__detection__output__param__s.html">dproc_run_ssd_detection_output_param_s</a></div><div class="ttdoc">Output parameters after running SSD.</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:169</div></div>
<div class="ttc" id="astructdproc__bbox__param__s_html"><div class="ttname"><a href="../../d7/d1a/structdproc__bbox__param__s.html">dproc_bbox_param_s</a></div><div class="ttdoc">Description of the parameters of the bounding box.</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:89</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_ad81629e7085e6564183c6674760a1cc8"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#ad81629e7085e6564183c6674760a1cc8">dproc_ssd_detection_output_config_s::num_all_bboxes</a></div><div class="ttdeci">uint32_t num_all_bboxes</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:139</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_a3a19e5b23a3eafbeaf7ab1b2c551bea5"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a3a19e5b23a3eafbeaf7ab1b2c551bea5">dproc_ssd_detection_output_config_s::img_width</a></div><div class="ttdeci">uint16_t img_width</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:134</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_aac475ad5fd925c09c1e056a5865bd8c0"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#aac475ad5fd925c09c1e056a5865bd8c0">dproc_ssd_detection_output_config_s::num_classes</a></div><div class="ttdeci">uint32_t num_classes</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:136</div></div>
<div class="ttc" id="astructdproc__bbox__param__s_html_af518e87d5d4659e5d34c34c39253be31"><div class="ttname"><a href="../../d7/d1a/structdproc__bbox__param__s.html#af518e87d5d4659e5d34c34c39253be31">dproc_bbox_param_s::y_max</a></div><div class="ttdeci">float y_max</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:93</div></div>
<div class="ttc" id="agroup__dproc-helper_html_gga0ad291b6f8763fa2b107f02e81dab6e6a2dce73dabed8848d2ab145b67747015c"><div class="ttname"><a href="../../df/d12/group__dproc-helper.html#gga0ad291b6f8763fa2b107f02e81dab6e6a2dce73dabed8848d2ab145b67747015c">AMBA_BBOX_CORNER</a></div><div class="ttdeci">@ AMBA_BBOX_CORNER</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:111</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_a174b476a80c5d50dccfde494e13c3fd7"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a174b476a80c5d50dccfde494e13c3fd7">dproc_ssd_detection_output_config_s::mbox_loc_num_elements</a></div><div class="ttdeci">uint32_t mbox_loc_num_elements</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:138</div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_gadff5cc953d26853718e397ac1be6ef8e"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#gadff5cc953d26853718e397ac1be6ef8e">EA_LOG_NOTICE</a></div><div class="ttdeci">#define EA_LOG_NOTICE(format, args...)</div><div class="ttdef"><b>Definition:</b> ea_log.h:153</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_a30dcfd0359b90638c034e859e2385ed9"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a30dcfd0359b90638c034e859e2385ed9">dproc_ssd_detection_output_config_s::unnormalized</a></div><div class="ttdeci">uint32_t unnormalized</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:155</div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_ga90cd35cff1406b5b8f71c2a9a108bd6d"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#ga90cd35cff1406b5b8f71c2a9a108bd6d">EA_LOG_ERROR</a></div><div class="ttdeci">#define EA_LOG_ERROR(format, args...)</div><div class="ttdef"><b>Definition:</b> ea_log.h:156</div></div>
<div class="ttc" id="astructdproc__ssd__class__dbg__info__s_html_a944f4be93ff75e29edae479fcb08564d"><div class="ttname"><a href="../../df/dd4/structdproc__ssd__class__dbg__info__s.html#a944f4be93ff75e29edae479fcb08564d">dproc_ssd_class_dbg_info_s::num_bboxes_above_threshold</a></div><div class="ttdeci">int num_bboxes_above_threshold</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:103</div></div>
<div class="ttc" id="ann__arm_8h_html"><div class="ttname"><a href="../../d2/d9b/nn__arm_8h.html">nn_arm.h</a></div></div>
<div class="ttc" id="agroup__eazyai-log-helper_html_ga4da64e8e9357c35fd8e1be1252a8bfe1"><div class="ttname"><a href="../../d4/d96/group__eazyai-log-helper.html#ga4da64e8e9357c35fd8e1be1252a8bfe1">EA_LOG_SET_LOCAL</a></div><div class="ttdeci">#define EA_LOG_SET_LOCAL(level)</div><div class="ttdef"><b>Definition:</b> ea_log.h:72</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__config__s_html_a95615d0ddae699fe03964a1aa0b8c48a"><div class="ttname"><a href="../../d8/dd6/structdproc__ssd__detection__output__config__s.html#a95615d0ddae699fe03964a1aa0b8c48a">dproc_ssd_detection_output_config_s::background_label_id</a></div><div class="ttdeci">uint32_t background_label_id</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:137</div></div>
<div class="ttc" id="astructdproc__ssd__class__dbg__info__s_html_ac34013cb735a8d3752ec3ac937c2b6fe"><div class="ttname"><a href="../../df/dd4/structdproc__ssd__class__dbg__info__s.html#ac34013cb735a8d3752ec3ac937c2b6fe">dproc_ssd_class_dbg_info_s::num_bboxes_post_nms</a></div><div class="ttdeci">int num_bboxes_post_nms</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:104</div></div>
<div class="ttc" id="astructdproc__ssd__detection__output__result__s_html_a673f254bc4e552fac228fdb58a610790"><div class="ttname"><a href="../../d7/d9d/structdproc__ssd__detection__output__result__s.html#a673f254bc4e552fac228fdb58a610790">dproc_ssd_detection_output_result_s::bbox</a></div><div class="ttdeci">dproc_bbox_param_t bbox</div><div class="ttdef"><b>Definition:</b> lib_data_process.h:186</div></div>
<div class="ttc" id="agroup__eazyai-tensor-helper_html_ga5d73912292db66d1d55385bb0242920c"><div class="ttname"><a href="../../d9/d79/group__eazyai-tensor-helper.html#ga5d73912292db66d1d55385bb0242920c">EA_W</a></div><div class="ttdeci">#define EA_W</div><div class="ttdef"><b>Definition:</b> ea_tensor.h:50</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
